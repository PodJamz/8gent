{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/design-canvas/nodes/DeviceFrame.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport { motion } from 'framer-motion';\nimport { cn } from '@/lib/utils';\n\n// Device presets matching schema.ts\nconst DEVICE_PRESETS = {\n  'iphone-15-pro': {\n    width: 393,\n    height: 852,\n    cornerRadius: 55,\n    safeAreaTop: 59,\n    safeAreaBottom: 34,\n    hasDynamicIsland: true,\n    scale: 0.5, // Scale for canvas display\n  },\n  'iphone-15': {\n    width: 393,\n    height: 852,\n    cornerRadius: 55,\n    safeAreaTop: 59,\n    safeAreaBottom: 34,\n    hasDynamicIsland: true,\n    scale: 0.5,\n  },\n  'iphone-se': {\n    width: 375,\n    height: 667,\n    cornerRadius: 40,\n    safeAreaTop: 20,\n    safeAreaBottom: 0,\n    hasDynamicIsland: false,\n    scale: 0.5,\n  },\n  'ipad-pro-11': {\n    width: 834,\n    height: 1194,\n    cornerRadius: 18,\n    safeAreaTop: 24,\n    safeAreaBottom: 20,\n    hasDynamicIsland: false,\n    scale: 0.35,\n  },\n} as const;\n\ntype DeviceType = keyof typeof DEVICE_PRESETS;\n\ninterface DeviceFrameProps {\n  deviceType?: DeviceType;\n  screenTitle?: string;\n  screenContent?: React.ReactNode;\n  isSelected?: boolean;\n  className?: string;\n  showStatusBar?: boolean;\n  showHomeIndicator?: boolean;\n  backgroundColor?: string;\n}\n\n// iOS Status Bar Component\nfunction IOSStatusBar({ time = '9:41', hasDynamicIsland = true }: { time?: string; hasDynamicIsland?: boolean }) {\n  return (\n    <div className=\"absolute top-0 left-0 right-0 flex items-center justify-between px-6 pt-3 text-[11px] font-semibold text-white z-10\">\n      {/* Left: Time */}\n      <span className={cn(hasDynamicIsland && 'ml-1')}>{time}</span>\n\n      {/* Center: Dynamic Island */}\n      {hasDynamicIsland && (\n        <div className=\"absolute left-1/2 -translate-x-1/2 top-3 w-[126px] h-[37px] bg-black rounded-full\" />\n      )}\n\n      {/* Right: Icons */}\n      <div className=\"flex items-center gap-1\">\n        {/* Signal */}\n        <svg width=\"18\" height=\"12\" viewBox=\"0 0 18 12\" fill=\"currentColor\" className=\"opacity-90\">\n          <rect x=\"0\" y=\"6\" width=\"3\" height=\"6\" rx=\"1\" />\n          <rect x=\"5\" y=\"4\" width=\"3\" height=\"8\" rx=\"1\" />\n          <rect x=\"10\" y=\"2\" width=\"3\" height=\"10\" rx=\"1\" />\n          <rect x=\"15\" y=\"0\" width=\"3\" height=\"12\" rx=\"1\" />\n        </svg>\n        {/* WiFi */}\n        <svg width=\"16\" height=\"12\" viewBox=\"0 0 16 12\" fill=\"currentColor\" className=\"opacity-90\">\n          <path d=\"M8 2.5C10.5 2.5 12.7 3.5 14.3 5.1L15.7 3.7C13.7 1.7 11 0.5 8 0.5C5 0.5 2.3 1.7 0.3 3.7L1.7 5.1C3.3 3.5 5.5 2.5 8 2.5Z\" />\n          <path d=\"M8 6C9.7 6 11.2 6.7 12.3 7.8L13.7 6.4C12.2 4.9 10.2 4 8 4C5.8 4 3.8 4.9 2.3 6.4L3.7 7.8C4.8 6.7 6.3 6 8 6Z\" />\n          <circle cx=\"8\" cy=\"10\" r=\"2\" />\n        </svg>\n        {/* Battery */}\n        <div className=\"flex items-center gap-0.5\">\n          <div className=\"w-[25px] h-[12px] border border-current rounded-[3px] p-[1px] opacity-90\">\n            <div className=\"w-[80%] h-full bg-current rounded-[1px]\" />\n          </div>\n          <div className=\"w-[1.5px] h-[5px] bg-current rounded-r-sm opacity-90\" />\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Home Indicator\nfunction HomeIndicator() {\n  return (\n    <div className=\"absolute bottom-2 left-1/2 -translate-x-1/2 w-[134px] h-[5px] bg-white/30 rounded-full\" />\n  );\n}\n\nexport function DeviceFrame({\n  deviceType = 'iphone-15-pro',\n  screenTitle,\n  screenContent,\n  isSelected = false,\n  className,\n  showStatusBar = true,\n  showHomeIndicator = true,\n  backgroundColor = '#000000',\n}: DeviceFrameProps) {\n  const preset = DEVICE_PRESETS[deviceType];\n  const displayWidth = preset.width * preset.scale;\n  const displayHeight = preset.height * preset.scale;\n\n  return (\n    <motion.div\n      className={cn(\n        'relative select-none',\n        isSelected && 'ring-2 ring-blue-500 ring-offset-2 ring-offset-transparent',\n        className\n      )}\n      style={{\n        width: displayWidth,\n        height: displayHeight,\n      }}\n    >\n      {/* Device Frame */}\n      <div\n        className=\"absolute inset-0 bg-[#1c1c1e] shadow-2xl\"\n        style={{\n          borderRadius: preset.cornerRadius * preset.scale,\n          border: '2px solid #3a3a3c',\n        }}\n      >\n        {/* Screen Area */}\n        <div\n          className=\"absolute inset-[3px] overflow-hidden\"\n          style={{\n            borderRadius: (preset.cornerRadius - 3) * preset.scale,\n            backgroundColor,\n          }}\n        >\n          {/* Status Bar */}\n          {showStatusBar && (\n            <div style={{ transform: `scale(${preset.scale})`, transformOrigin: 'top left' }}>\n              <IOSStatusBar hasDynamicIsland={preset.hasDynamicIsland} />\n            </div>\n          )}\n\n          {/* Screen Content */}\n          <div\n            className=\"absolute left-0 right-0 overflow-hidden\"\n            style={{\n              top: preset.safeAreaTop * preset.scale,\n              bottom: preset.safeAreaBottom * preset.scale,\n            }}\n          >\n            {screenContent || (\n              <div className=\"flex items-center justify-center h-full text-white/50 text-xs\">\n                {screenTitle || 'Screen'}\n              </div>\n            )}\n          </div>\n\n          {/* Home Indicator */}\n          {showHomeIndicator && preset.safeAreaBottom > 0 && (\n            <div style={{ transform: `scale(${preset.scale})`, transformOrigin: 'bottom center' }}>\n              <HomeIndicator />\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Screen Title Label */}\n      {screenTitle && (\n        <div className=\"absolute -bottom-6 left-1/2 -translate-x-1/2 text-xs text-white/70 font-medium whitespace-nowrap\">\n          {screenTitle}\n        </div>\n      )}\n    </motion.div>\n  );\n}\n\n// iOS Component Primitives for use inside device frames\n\nexport function IOSNavBar({\n  title,\n  leftButton,\n  rightButton,\n  className,\n}: {\n  title: string;\n  leftButton?: React.ReactNode;\n  rightButton?: React.ReactNode;\n  className?: string;\n}) {\n  return (\n    <div className={cn('flex items-center justify-between px-4 py-3 bg-black/20 backdrop-blur-xl', className)}>\n      <div className=\"w-16 flex justify-start text-blue-400 text-sm\">{leftButton}</div>\n      <span className=\"font-semibold text-white text-[17px]\">{title}</span>\n      <div className=\"w-16 flex justify-end text-blue-400 text-sm\">{rightButton}</div>\n    </div>\n  );\n}\n\nexport function IOSTabBar({\n  tabs,\n  activeIndex = 0,\n  className,\n}: {\n  tabs: Array<{ icon: React.ReactNode; label: string }>;\n  activeIndex?: number;\n  className?: string;\n}) {\n  return (\n    <div className={cn('flex items-center justify-around px-2 py-2 bg-black/20 backdrop-blur-xl border-t border-white/10', className)}>\n      {tabs.map((tab, i) => (\n        <div\n          key={i}\n          className={cn(\n            'flex flex-col items-center gap-1 px-3',\n            i === activeIndex ? 'text-blue-400' : 'text-white/50'\n          )}\n        >\n          {tab.icon}\n          <span className=\"text-[10px]\">{tab.label}</span>\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport function IOSButton({\n  variant = 'primary',\n  label,\n  fullWidth = false,\n  className,\n}: {\n  variant?: 'primary' | 'secondary' | 'destructive' | 'ghost';\n  label: string;\n  fullWidth?: boolean;\n  className?: string;\n}) {\n  const variants = {\n    primary: 'bg-blue-500 text-white',\n    secondary: 'bg-white/10 text-white',\n    destructive: 'bg-red-500 text-white',\n    ghost: 'bg-transparent text-blue-400',\n  };\n\n  return (\n    <div\n      className={cn(\n        'px-6 py-3 rounded-xl text-center font-semibold text-[17px]',\n        variants[variant],\n        fullWidth && 'w-full',\n        className\n      )}\n    >\n      {label}\n    </div>\n  );\n}\n\nexport function IOSCard({\n  title,\n  subtitle,\n  children,\n  className,\n}: {\n  title?: string;\n  subtitle?: string;\n  children?: React.ReactNode;\n  className?: string;\n}) {\n  return (\n    <div className={cn('bg-white/10 backdrop-blur-sm rounded-2xl p-4', className)}>\n      {title && <div className=\"font-semibold text-white text-[17px]\">{title}</div>}\n      {subtitle && <div className=\"text-white/60 text-sm mt-0.5\">{subtitle}</div>}\n      {children && <div className=\"mt-3\">{children}</div>}\n    </div>\n  );\n}\n\nexport function IOSListItem({\n  icon,\n  label,\n  value,\n  hasChevron = true,\n  className,\n}: {\n  icon?: React.ReactNode;\n  label: string;\n  value?: string;\n  hasChevron?: boolean;\n  className?: string;\n}) {\n  return (\n    <div className={cn('flex items-center gap-3 px-4 py-3 bg-white/5', className)}>\n      {icon && <div className=\"text-white/60\">{icon}</div>}\n      <span className=\"flex-1 text-white text-[17px]\">{label}</span>\n      {value && <span className=\"text-white/50 text-[17px]\">{value}</span>}\n      {hasChevron && (\n        <svg width=\"8\" height=\"13\" viewBox=\"0 0 8 13\" fill=\"none\" className=\"text-white/30\">\n          <path d=\"M1 1L6.5 6.5L1 12\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\n        </svg>\n      )}\n    </div>\n  );\n}\n\nexport function IOSTextField({\n  placeholder,\n  value,\n  className,\n}: {\n  placeholder?: string;\n  value?: string;\n  className?: string;\n}) {\n  return (\n    <div className={cn('px-4 py-3 bg-white/10 rounded-xl text-white', className)}>\n      {value || <span className=\"text-white/40\">{placeholder || 'Enter text...'}</span>}\n    </div>\n  );\n}\n\nexport function IOSToggle({\n  isOn = false,\n  className,\n}: {\n  isOn?: boolean;\n  className?: string;\n}) {\n  return (\n    <div\n      className={cn(\n        'w-[51px] h-[31px] rounded-full p-[2px] transition-colors',\n        isOn ? 'bg-green-500' : 'bg-white/20',\n        className\n      )}\n    >\n      <div\n        className={cn(\n          'w-[27px] h-[27px] rounded-full bg-white shadow-sm transition-transform',\n          isOn && 'translate-x-[20px]'\n        )}\n      />\n    </div>\n  );\n}\n\nexport function IOSSegmentedControl({\n  segments,\n  activeIndex = 0,\n  className,\n}: {\n  segments: string[];\n  activeIndex?: number;\n  className?: string;\n}) {\n  return (\n    <div className={cn('flex bg-white/10 rounded-lg p-[2px]', className)}>\n      {segments.map((segment, i) => (\n        <div\n          key={i}\n          className={cn(\n            'flex-1 py-1.5 px-3 text-center text-sm font-medium rounded-md transition-colors',\n            i === activeIndex ? 'bg-white/20 text-white' : 'text-white/60'\n          )}\n        >\n          {segment}\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport function IOSProgressBar({\n  value,\n  max = 100,\n  className,\n}: {\n  value: number;\n  max?: number;\n  className?: string;\n}) {\n  const percentage = Math.min(100, Math.max(0, (value / max) * 100));\n\n  return (\n    <div className={cn('h-1 bg-white/20 rounded-full overflow-hidden', className)}>\n      <div className=\"h-full bg-blue-500 rounded-full transition-all\" style={{ width: `${percentage}%` }} />\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 614, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/design-canvas/nodes/FlowNodes.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport { motion } from 'framer-motion';\nimport { cn } from '@/lib/utils';\nimport {\n  Play,\n  Square,\n  Diamond,\n  MonitorSmartphone,\n  Database,\n  HardDrive,\n  Layers,\n} from 'lucide-react';\n\ntype FlowNodeType =\n  | 'flow-start'\n  | 'flow-end'\n  | 'flow-decision'\n  | 'flow-process'\n  | 'flow-screen'\n  | 'flow-data'\n  | 'flow-subprocess';\n\ninterface FlowNodeProps {\n  type: FlowNodeType;\n  label: string;\n  description?: string;\n  isSelected?: boolean;\n  width?: number;\n  height?: number;\n  style?: {\n    fill?: string;\n    stroke?: string;\n    strokeWidth?: number;\n  };\n  className?: string;\n}\n\n// Color presets for flow nodes\nconst FLOW_NODE_COLORS: Record<FlowNodeType, { fill: string; stroke: string; text: string }> = {\n  'flow-start': { fill: '#10b981', stroke: '#059669', text: '#ffffff' },\n  'flow-end': { fill: '#ef4444', stroke: '#dc2626', text: '#ffffff' },\n  'flow-decision': { fill: '#f59e0b', stroke: '#d97706', text: '#000000' },\n  'flow-process': { fill: '#3b82f6', stroke: '#2563eb', text: '#ffffff' },\n  'flow-screen': { fill: '#8b5cf6', stroke: '#7c3aed', text: '#ffffff' },\n  'flow-data': { fill: '#06b6d4', stroke: '#0891b2', text: '#ffffff' },\n  'flow-subprocess': { fill: '#6366f1', stroke: '#4f46e5', text: '#ffffff' },\n};\n\n// Default dimensions for each node type\nconst FLOW_NODE_DIMENSIONS: Record<FlowNodeType, { width: number; height: number }> = {\n  'flow-start': { width: 120, height: 50 },\n  'flow-end': { width: 120, height: 50 },\n  'flow-decision': { width: 140, height: 100 },\n  'flow-process': { width: 160, height: 80 },\n  'flow-screen': { width: 140, height: 90 },\n  'flow-data': { width: 150, height: 70 },\n  'flow-subprocess': { width: 160, height: 80 },\n};\n\n// Icons for each node type\nconst FLOW_NODE_ICONS: Record<FlowNodeType, React.ReactNode> = {\n  'flow-start': <Play className=\"w-4 h-4\" />,\n  'flow-end': <Square className=\"w-4 h-4\" />,\n  'flow-decision': <Diamond className=\"w-4 h-4\" />,\n  'flow-process': <Layers className=\"w-4 h-4\" />,\n  'flow-screen': <MonitorSmartphone className=\"w-4 h-4\" />,\n  'flow-data': <Database className=\"w-4 h-4\" />,\n  'flow-subprocess': <HardDrive className=\"w-4 h-4\" />,\n};\n\n// Start/End Node - Rounded pill shape\nfunction StartEndNode({\n  label,\n  isStart,\n  colors,\n  width,\n  height,\n  isSelected,\n}: {\n  label: string;\n  isStart: boolean;\n  colors: { fill: string; stroke: string; text: string };\n  width: number;\n  height: number;\n  isSelected: boolean;\n}) {\n  return (\n    <div\n      className={cn(\n        'flex items-center justify-center gap-2 font-medium text-sm',\n        isSelected && 'ring-2 ring-white ring-offset-2 ring-offset-transparent'\n      )}\n      style={{\n        width,\n        height,\n        backgroundColor: colors.fill,\n        border: `2px solid ${colors.stroke}`,\n        borderRadius: height / 2,\n        color: colors.text,\n      }}\n    >\n      {isStart ? <Play className=\"w-3 h-3\" /> : <Square className=\"w-3 h-3\" />}\n      {label}\n    </div>\n  );\n}\n\n// Decision Node - Diamond shape\nfunction DecisionNode({\n  label,\n  colors,\n  width,\n  height,\n  isSelected,\n}: {\n  label: string;\n  colors: { fill: string; stroke: string; text: string };\n  width: number;\n  height: number;\n  isSelected: boolean;\n}) {\n  return (\n    <div\n      className={cn(\n        'relative flex items-center justify-center',\n        isSelected && 'filter drop-shadow-[0_0_4px_rgba(255,255,255,0.8)]'\n      )}\n      style={{ width, height }}\n    >\n      {/* Diamond shape using CSS transform */}\n      <div\n        className=\"absolute inset-[10%]\"\n        style={{\n          backgroundColor: colors.fill,\n          border: `2px solid ${colors.stroke}`,\n          transform: 'rotate(45deg)',\n          borderRadius: 4,\n        }}\n      />\n      {/* Label */}\n      <span\n        className=\"relative z-10 font-medium text-sm text-center px-2 max-w-[80%]\"\n        style={{ color: colors.text }}\n      >\n        {label}\n      </span>\n    </div>\n  );\n}\n\n// Process Node - Rounded rectangle\nfunction ProcessNode({\n  label,\n  description,\n  colors,\n  width,\n  height,\n  isSelected,\n}: {\n  label: string;\n  description?: string;\n  colors: { fill: string; stroke: string; text: string };\n  width: number;\n  height: number;\n  isSelected: boolean;\n}) {\n  return (\n    <div\n      className={cn(\n        'flex flex-col items-center justify-center p-3 rounded-lg',\n        isSelected && 'ring-2 ring-white ring-offset-2 ring-offset-transparent'\n      )}\n      style={{\n        width,\n        height,\n        backgroundColor: colors.fill,\n        border: `2px solid ${colors.stroke}`,\n      }}\n    >\n      <span className=\"font-medium text-sm\" style={{ color: colors.text }}>\n        {label}\n      </span>\n      {description && (\n        <span className=\"text-xs mt-1 opacity-80\" style={{ color: colors.text }}>\n          {description}\n        </span>\n      )}\n    </div>\n  );\n}\n\n// Screen Reference Node - Rectangle with screen icon\nfunction ScreenNode({\n  label,\n  colors,\n  width,\n  height,\n  isSelected,\n}: {\n  label: string;\n  colors: { fill: string; stroke: string; text: string };\n  width: number;\n  height: number;\n  isSelected: boolean;\n}) {\n  return (\n    <div\n      className={cn(\n        'flex flex-col items-center justify-center p-3 rounded-lg',\n        isSelected && 'ring-2 ring-white ring-offset-2 ring-offset-transparent'\n      )}\n      style={{\n        width,\n        height,\n        backgroundColor: colors.fill,\n        border: `2px solid ${colors.stroke}`,\n      }}\n    >\n      <MonitorSmartphone className=\"w-5 h-5 mb-1\" style={{ color: colors.text }} />\n      <span className=\"font-medium text-sm text-center\" style={{ color: colors.text }}>\n        {label}\n      </span>\n    </div>\n  );\n}\n\n// Data/Storage Node - Parallelogram shape\nfunction DataNode({\n  label,\n  colors,\n  width,\n  height,\n  isSelected,\n}: {\n  label: string;\n  colors: { fill: string; stroke: string; text: string };\n  width: number;\n  height: number;\n  isSelected: boolean;\n}) {\n  return (\n    <div\n      className={cn(\n        'relative flex items-center justify-center',\n        isSelected && 'filter drop-shadow-[0_0_4px_rgba(255,255,255,0.8)]'\n      )}\n      style={{ width, height }}\n    >\n      {/* Parallelogram using skew transform */}\n      <div\n        className=\"absolute inset-0\"\n        style={{\n          backgroundColor: colors.fill,\n          border: `2px solid ${colors.stroke}`,\n          transform: 'skewX(-10deg)',\n          borderRadius: 4,\n        }}\n      />\n      {/* Label */}\n      <div className=\"relative z-10 flex items-center gap-2\">\n        <Database className=\"w-4 h-4\" style={{ color: colors.text }} />\n        <span className=\"font-medium text-sm\" style={{ color: colors.text }}>\n          {label}\n        </span>\n      </div>\n    </div>\n  );\n}\n\n// Subprocess Node - Double-bordered rectangle\nfunction SubprocessNode({\n  label,\n  colors,\n  width,\n  height,\n  isSelected,\n}: {\n  label: string;\n  colors: { fill: string; stroke: string; text: string };\n  width: number;\n  height: number;\n  isSelected: boolean;\n}) {\n  return (\n    <div\n      className={cn(\n        'relative flex items-center justify-center p-3 rounded-lg',\n        isSelected && 'ring-2 ring-white ring-offset-2 ring-offset-transparent'\n      )}\n      style={{\n        width,\n        height,\n        backgroundColor: colors.fill,\n        border: `2px solid ${colors.stroke}`,\n      }}\n    >\n      {/* Inner border for subprocess indication */}\n      <div\n        className=\"absolute inset-2 rounded border-2 pointer-events-none\"\n        style={{ borderColor: colors.stroke, opacity: 0.5 }}\n      />\n      <span className=\"font-medium text-sm\" style={{ color: colors.text }}>\n        {label}\n      </span>\n    </div>\n  );\n}\n\n// Main FlowNode component\nexport function FlowNode({\n  type,\n  label,\n  description,\n  isSelected = false,\n  width: customWidth,\n  height: customHeight,\n  style,\n  className,\n}: FlowNodeProps) {\n  const defaultDimensions = FLOW_NODE_DIMENSIONS[type];\n  const defaultColors = FLOW_NODE_COLORS[type];\n\n  const width = customWidth ?? defaultDimensions.width;\n  const height = customHeight ?? defaultDimensions.height;\n\n  const colors = {\n    fill: style?.fill ?? defaultColors.fill,\n    stroke: style?.stroke ?? defaultColors.stroke,\n    text: defaultColors.text,\n  };\n\n  const renderNode = () => {\n    switch (type) {\n      case 'flow-start':\n        return <StartEndNode label={label} isStart={true} colors={colors} width={width} height={height} isSelected={isSelected} />;\n      case 'flow-end':\n        return <StartEndNode label={label} isStart={false} colors={colors} width={width} height={height} isSelected={isSelected} />;\n      case 'flow-decision':\n        return <DecisionNode label={label} colors={colors} width={width} height={height} isSelected={isSelected} />;\n      case 'flow-process':\n        return <ProcessNode label={label} description={description} colors={colors} width={width} height={height} isSelected={isSelected} />;\n      case 'flow-screen':\n        return <ScreenNode label={label} colors={colors} width={width} height={height} isSelected={isSelected} />;\n      case 'flow-data':\n        return <DataNode label={label} colors={colors} width={width} height={height} isSelected={isSelected} />;\n      case 'flow-subprocess':\n        return <SubprocessNode label={label} colors={colors} width={width} height={height} isSelected={isSelected} />;\n      default:\n        return <ProcessNode label={label} description={description} colors={colors} width={width} height={height} isSelected={isSelected} />;\n    }\n  };\n\n  return (\n    <motion.div\n      className={cn('cursor-pointer select-none', className)}\n      whileHover={{ scale: 1.02 }}\n      whileTap={{ scale: 0.98 }}\n    >\n      {renderNode()}\n    </motion.div>\n  );\n}\n\n// Architecture Nodes\ntype ArchNodeType =\n  | 'arch-service'\n  | 'arch-database'\n  | 'arch-client'\n  | 'arch-api'\n  | 'arch-queue'\n  | 'arch-cache'\n  | 'arch-cdn'\n  | 'arch-cloud';\n\nconst ARCH_NODE_COLORS: Record<ArchNodeType, { fill: string; stroke: string; text: string }> = {\n  'arch-service': { fill: '#3b82f6', stroke: '#2563eb', text: '#ffffff' },\n  'arch-database': { fill: '#10b981', stroke: '#059669', text: '#ffffff' },\n  'arch-client': { fill: '#8b5cf6', stroke: '#7c3aed', text: '#ffffff' },\n  'arch-api': { fill: '#f59e0b', stroke: '#d97706', text: '#000000' },\n  'arch-queue': { fill: '#ec4899', stroke: '#db2777', text: '#ffffff' },\n  'arch-cache': { fill: '#ef4444', stroke: '#dc2626', text: '#ffffff' },\n  'arch-cdn': { fill: '#06b6d4', stroke: '#0891b2', text: '#ffffff' },\n  'arch-cloud': { fill: '#1e293b', stroke: '#475569', text: '#ffffff' },\n};\n\ninterface ArchNodeProps {\n  type: ArchNodeType;\n  label: string;\n  description?: string;\n  isSelected?: boolean;\n  width?: number;\n  height?: number;\n  className?: string;\n}\n\n// Database cylinder shape\nfunction DatabaseCylinder({\n  label,\n  description,\n  colors,\n  width,\n  height,\n  isSelected,\n}: {\n  label: string;\n  description?: string;\n  colors: { fill: string; stroke: string; text: string };\n  width: number;\n  height: number;\n  isSelected: boolean;\n}) {\n  const ellipseHeight = height * 0.15;\n\n  return (\n    <div\n      className={cn(\n        'relative flex flex-col items-center justify-center',\n        isSelected && 'filter drop-shadow-[0_0_4px_rgba(255,255,255,0.8)]'\n      )}\n      style={{ width, height }}\n    >\n      {/* Top ellipse */}\n      <div\n        className=\"absolute top-0 left-0 right-0\"\n        style={{\n          height: ellipseHeight * 2,\n          backgroundColor: colors.fill,\n          borderRadius: '50%',\n          border: `2px solid ${colors.stroke}`,\n        }}\n      />\n      {/* Body */}\n      <div\n        className=\"absolute left-0 right-0\"\n        style={{\n          top: ellipseHeight,\n          bottom: ellipseHeight,\n          backgroundColor: colors.fill,\n          borderLeft: `2px solid ${colors.stroke}`,\n          borderRight: `2px solid ${colors.stroke}`,\n        }}\n      />\n      {/* Bottom ellipse */}\n      <div\n        className=\"absolute bottom-0 left-0 right-0\"\n        style={{\n          height: ellipseHeight * 2,\n          backgroundColor: colors.fill,\n          borderRadius: '50%',\n          border: `2px solid ${colors.stroke}`,\n        }}\n      />\n      {/* Content */}\n      <div className=\"relative z-10 flex flex-col items-center\">\n        <Database className=\"w-5 h-5 mb-1\" style={{ color: colors.text }} />\n        <span className=\"font-medium text-sm\" style={{ color: colors.text }}>\n          {label}\n        </span>\n        {description && (\n          <span className=\"text-xs opacity-80\" style={{ color: colors.text }}>\n            {description}\n          </span>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport function ArchNode({\n  type,\n  label,\n  description,\n  isSelected = false,\n  width = 140,\n  height = 100,\n  className,\n}: ArchNodeProps) {\n  const colors = ARCH_NODE_COLORS[type];\n\n  if (type === 'arch-database') {\n    return (\n      <motion.div\n        className={cn('cursor-pointer select-none', className)}\n        whileHover={{ scale: 1.02 }}\n        whileTap={{ scale: 0.98 }}\n      >\n        <DatabaseCylinder\n          label={label}\n          description={description}\n          colors={colors}\n          width={width}\n          height={height}\n          isSelected={isSelected}\n        />\n      </motion.div>\n    );\n  }\n\n  // Default box style for other arch nodes\n  return (\n    <motion.div\n      className={cn('cursor-pointer select-none', className)}\n      whileHover={{ scale: 1.02 }}\n      whileTap={{ scale: 0.98 }}\n    >\n      <div\n        className={cn(\n          'flex flex-col items-center justify-center p-4 rounded-xl',\n          isSelected && 'ring-2 ring-white ring-offset-2 ring-offset-transparent',\n          type === 'arch-cloud' && 'border-dashed'\n        )}\n        style={{\n          width,\n          height,\n          backgroundColor: colors.fill,\n          border: `2px ${type === 'arch-cloud' ? 'dashed' : 'solid'} ${colors.stroke}`,\n        }}\n      >\n        <span className=\"font-semibold text-sm\" style={{ color: colors.text }}>\n          {label}\n        </span>\n        {description && (\n          <span className=\"text-xs mt-1 opacity-80 text-center\" style={{ color: colors.text }}>\n            {description}\n          </span>\n        )}\n      </div>\n    </motion.div>\n  );\n}\n\n// Export helper to get node icon\nexport function getFlowNodeIcon(type: FlowNodeType) {\n  return FLOW_NODE_ICONS[type];\n}\n\n// Export color presets\nexport { FLOW_NODE_COLORS, ARCH_NODE_COLORS, FLOW_NODE_DIMENSIONS };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1396, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/design-canvas/nodes/VideoNode.tsx"],"sourcesContent":["'use client';\n\n/**\n * Video Node - Remotion video composition node for the canvas\n *\n * Displays video compositions with inline preview and controls.\n * Supports lyric videos, text overlays, and custom compositions.\n */\n\nimport React, { useState, useCallback } from 'react';\nimport { motion } from 'framer-motion';\nimport {\n  Video,\n  Play,\n  Pause,\n  Settings2,\n  Maximize2,\n  Download,\n  Music,\n  Type,\n  Layers,\n  Clock,\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface VideoCompositionData {\n  id: string;\n  name: string;\n  type: 'lyric-video' | 'presentation' | 'text-overlay' | 'social-story' | 'music-visualizer' | 'slideshow' | 'custom';\n  preset: string;\n  width: number;\n  height: number;\n  fps: number;\n  durationInFrames: number;\n  layers: Array<{\n    id: string;\n    type: string;\n    [key: string]: unknown;\n  }>;\n  audio?: { src: string; volume: number };\n  backgroundColor?: string;\n  backgroundGradient?: string;\n}\n\nexport interface VideoNodeProps {\n  composition: VideoCompositionData;\n  isSelected?: boolean;\n  onSelect?: () => void;\n  onDelete?: () => void;\n  onExpand?: () => void;\n  onEdit?: () => void;\n  width?: number;\n  height?: number;\n}\n\n// ============================================================================\n// Type Colors\n// ============================================================================\n\nconst TYPE_COLORS: Record<string, string> = {\n  'lyric-video': '#f59e0b', // amber\n  'presentation': '#3b82f6', // blue\n  'text-overlay': '#8b5cf6', // violet\n  'social-story': '#ec4899', // pink\n  'music-visualizer': '#10b981', // emerald\n  'slideshow': '#6366f1', // indigo\n  'custom': '#64748b', // slate\n};\n\nconst TYPE_ICONS: Record<string, React.ReactNode> = {\n  'lyric-video': <Music className=\"w-3.5 h-3.5\" />,\n  'presentation': <Layers className=\"w-3.5 h-3.5\" />,\n  'text-overlay': <Type className=\"w-3.5 h-3.5\" />,\n  'social-story': <Video className=\"w-3.5 h-3.5\" />,\n  'music-visualizer': <Music className=\"w-3.5 h-3.5\" />,\n  'slideshow': <Layers className=\"w-3.5 h-3.5\" />,\n  'custom': <Video className=\"w-3.5 h-3.5\" />,\n};\n\n// ============================================================================\n// Video Node Header\n// ============================================================================\n\nfunction VideoNodeHeader({\n  composition,\n  isPlaying,\n  onPlayPause,\n  onExpand,\n  onEdit,\n}: {\n  composition: VideoCompositionData;\n  isPlaying: boolean;\n  onPlayPause: () => void;\n  onExpand?: () => void;\n  onEdit?: () => void;\n}) {\n  const color = TYPE_COLORS[composition.type] || TYPE_COLORS.custom;\n  const icon = TYPE_ICONS[composition.type] || TYPE_ICONS.custom;\n  const durationSeconds = composition.durationInFrames / composition.fps;\n\n  return (\n    <div\n      className=\"flex items-center justify-between px-3 py-2 border-b border-white/10\"\n      style={{ backgroundColor: `${color}15` }}\n    >\n      <div className=\"flex items-center gap-2\">\n        <span style={{ color }}>{icon}</span>\n        <span className=\"text-xs font-medium text-white/80 truncate max-w-[150px]\">\n          {composition.name}\n        </span>\n        <span className=\"text-[10px] text-white/40 flex items-center gap-1\">\n          <Clock className=\"w-2.5 h-2.5\" />\n          {durationSeconds.toFixed(1)}s\n        </span>\n      </div>\n\n      <div className=\"flex items-center gap-1\">\n        <button\n          onClick={(e) => {\n            e.stopPropagation();\n            onPlayPause();\n          }}\n          className=\"p-1 rounded hover:bg-white/10 transition-colors\"\n          title={isPlaying ? 'Pause' : 'Play'}\n        >\n          {isPlaying ? (\n            <Pause className=\"w-3.5 h-3.5 text-white/60\" />\n          ) : (\n            <Play className=\"w-3.5 h-3.5 text-white/60\" />\n          )}\n        </button>\n        {onEdit && (\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              onEdit();\n            }}\n            className=\"p-1 rounded hover:bg-white/10 transition-colors\"\n            title=\"Edit composition\"\n          >\n            <Settings2 className=\"w-3.5 h-3.5 text-white/60\" />\n          </button>\n        )}\n        {onExpand && (\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              onExpand();\n            }}\n            className=\"p-1 rounded hover:bg-white/10 transition-colors\"\n            title=\"Expand\"\n          >\n            <Maximize2 className=\"w-3.5 h-3.5 text-white/60\" />\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}\n\n// ============================================================================\n// Video Preview\n// ============================================================================\n\nfunction VideoPreview({\n  composition,\n  isPlaying,\n}: {\n  composition: VideoCompositionData;\n  isPlaying: boolean;\n}) {\n  const aspectRatio = composition.width / composition.height;\n  const color = TYPE_COLORS[composition.type] || TYPE_COLORS.custom;\n\n  return (\n    <div\n      className=\"relative bg-black/50 rounded overflow-hidden\"\n      style={{ aspectRatio }}\n    >\n      {/* Gradient background preview */}\n      <div\n        className=\"absolute inset-0\"\n        style={{\n          background:\n            composition.backgroundGradient ||\n            composition.backgroundColor ||\n            `linear-gradient(135deg, ${color}30 0%, ${color}10 100%)`,\n        }}\n      />\n\n      {/* Layer previews */}\n      <div className=\"absolute inset-0 flex items-center justify-center\">\n        {composition.layers.length === 0 ? (\n          <div className=\"text-center\">\n            <Video className=\"w-8 h-8 text-white/20 mx-auto mb-2\" />\n            <p className=\"text-[10px] text-white/30\">No layers yet</p>\n          </div>\n        ) : (\n          <div className=\"text-center\">\n            {/* Layer count badge */}\n            <div className=\"flex items-center justify-center gap-1 mb-2\">\n              <Layers className=\"w-4 h-4 text-white/40\" />\n              <span className=\"text-xs text-white/60\">{composition.layers.length}</span>\n            </div>\n\n            {/* Layer type summary */}\n            <div className=\"flex flex-wrap gap-1 justify-center px-4\">\n              {Array.from(\n                new Set(composition.layers.map((l) => l.type))\n              ).map((type) => (\n                <span\n                  key={type}\n                  className=\"text-[9px] px-1.5 py-0.5 bg-white/10 rounded text-white/50\"\n                >\n                  {type}\n                </span>\n              ))}\n            </div>\n\n            {/* Audio indicator */}\n            {composition.audio && (\n              <div className=\"mt-2 flex items-center justify-center gap-1 text-white/40\">\n                <Music className=\"w-3 h-3\" />\n                <span className=\"text-[10px]\">Audio</span>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      {/* Playing indicator */}\n      {isPlaying && (\n        <div className=\"absolute top-2 left-2 flex items-center gap-1 px-1.5 py-0.5 bg-red-500/80 rounded text-[9px] text-white\">\n          <div className=\"w-1.5 h-1.5 bg-white rounded-full animate-pulse\" />\n          PREVIEW\n        </div>\n      )}\n\n      {/* Preset badge */}\n      <div className=\"absolute bottom-2 right-2 text-[9px] px-1.5 py-0.5 bg-black/50 rounded text-white/60\">\n        {composition.preset} • {composition.fps}fps\n      </div>\n    </div>\n  );\n}\n\n// ============================================================================\n// Video Node Footer\n// ============================================================================\n\nfunction VideoNodeFooter({ composition }: { composition: VideoCompositionData }) {\n  return (\n    <div className=\"px-3 py-2 border-t border-white/5 flex items-center justify-between text-[10px] text-white/40\">\n      <span>\n        {composition.width}×{composition.height}\n      </span>\n      <span className=\"flex items-center gap-1\">\n        <Layers className=\"w-3 h-3\" />\n        {composition.layers.length} layer{composition.layers.length !== 1 ? 's' : ''}\n      </span>\n    </div>\n  );\n}\n\n// ============================================================================\n// Main Video Node Component\n// ============================================================================\n\nexport function VideoNode({\n  composition,\n  isSelected,\n  onSelect,\n  onDelete,\n  onExpand,\n  onEdit,\n  width = 300,\n  height,\n}: VideoNodeProps) {\n  const [isPlaying, setIsPlaying] = useState(false);\n  const color = TYPE_COLORS[composition.type] || TYPE_COLORS.custom;\n\n  const handlePlayPause = useCallback(() => {\n    setIsPlaying((prev) => !prev);\n    // In a real implementation, this would control the RemotionPlayer\n  }, []);\n\n  return (\n    <motion.div\n      className={cn(\n        'rounded-lg overflow-hidden backdrop-blur-sm border transition-all',\n        isSelected\n          ? 'ring-2 ring-offset-2 ring-offset-black/50'\n          : 'hover:border-white/20'\n      )}\n      style={{\n        width,\n        backgroundColor: 'rgba(0, 0, 0, 0.6)',\n        borderColor: isSelected ? color : 'rgba(255, 255, 255, 0.1)',\n        // Use CSS variable for ring color\n        ['--tw-ring-color' as string]: color,\n      }}\n      onClick={onSelect}\n      initial={{ opacity: 0, scale: 0.95 }}\n      animate={{ opacity: 1, scale: 1 }}\n      exit={{ opacity: 0, scale: 0.95 }}\n    >\n      <VideoNodeHeader\n        composition={composition}\n        isPlaying={isPlaying}\n        onPlayPause={handlePlayPause}\n        onExpand={onExpand}\n        onEdit={onEdit}\n      />\n\n      <div className=\"p-3\">\n        <VideoPreview composition={composition} isPlaying={isPlaying} />\n      </div>\n\n      <VideoNodeFooter composition={composition} />\n    </motion.div>\n  );\n}\n\n// ============================================================================\n// Mini Video Node (for thumbnail views)\n// ============================================================================\n\nexport function MiniVideoNode({\n  composition,\n  onClick,\n}: {\n  composition: VideoCompositionData;\n  onClick?: () => void;\n}) {\n  const color = TYPE_COLORS[composition.type] || TYPE_COLORS.custom;\n  const icon = TYPE_ICONS[composition.type] || TYPE_ICONS.custom;\n\n  return (\n    <button\n      onClick={onClick}\n      className={cn(\n        'flex items-center gap-2 px-2 py-1.5 rounded border border-white/10',\n        'bg-black/40 hover:bg-black/60 hover:border-white/20 transition-all',\n        'text-left w-full'\n      )}\n    >\n      <span style={{ color }}>{icon}</span>\n      <div className=\"flex-1 min-w-0\">\n        <p className=\"text-xs text-white/80 truncate\">{composition.name}</p>\n        <p className=\"text-[10px] text-white/40\">\n          {(composition.durationInFrames / composition.fps).toFixed(1)}s •{' '}\n          {composition.layers.length} layers\n        </p>\n      </div>\n    </button>\n  );\n}\n\nexport default VideoNode;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1984, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/design-canvas/nodes/TalkingVideoNode.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useCallback } from \"react\";\nimport { motion } from \"framer-motion\";\nimport {\n  Video,\n  Sparkles,\n  Mic,\n  Film,\n  Volume2,\n  Play,\n  Loader2,\n  Check,\n  Download,\n  ChevronDown,\n  ChevronUp,\n  RefreshCw,\n} from \"lucide-react\";\nimport type { TalkingVideoStatus, SceneStyle } from \"@/lib/talking-video/types\";\n\ninterface TalkingVideoNodeProps {\n  topic?: string;\n  sourcePhotoUrl?: string;\n  sceneStyle?: SceneStyle;\n  status?: TalkingVideoStatus;\n  script?: string;\n  audioUrl?: string;\n  finalVideoUrl?: string;\n  isSelected: boolean;\n  width?: number;\n  onGenerate?: (data: {\n    topic: string;\n    sourcePhotoUrl: string;\n    sceneStyle: SceneStyle;\n  }) => void;\n}\n\nexport function TalkingVideoNode({\n  topic: initialTopic,\n  sourcePhotoUrl: initialPhotoUrl,\n  sceneStyle: initialSceneStyle = \"podcast_studio\",\n  status = \"draft\",\n  script,\n  audioUrl,\n  finalVideoUrl,\n  isSelected,\n  width = 320,\n  onGenerate,\n}: TalkingVideoNodeProps) {\n  const [topic, setTopic] = useState(initialTopic || \"\");\n  const [photoUrl, setPhotoUrl] = useState(initialPhotoUrl || \"\");\n  const [sceneStyle, setSceneStyle] = useState<SceneStyle>(initialSceneStyle);\n  const [isExpanded, setIsExpanded] = useState(!finalVideoUrl);\n  const [isGenerating, setIsGenerating] = useState(false);\n\n  const handleGenerate = useCallback(async () => {\n    if (!topic || !photoUrl) return;\n\n    setIsGenerating(true);\n\n    if (onGenerate) {\n      onGenerate({ topic, sourcePhotoUrl: photoUrl, sceneStyle });\n    } else {\n      // Direct API call if no handler provided\n      try {\n        const response = await fetch(\"/api/talking-video\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            action: \"run_workflow\",\n            topic,\n            sourcePhotoUrl: photoUrl,\n            sceneStyle,\n          }),\n        });\n        const result = await response.json();\n        console.log(\"Talking video result:\", result);\n      } catch (error) {\n        console.error(\"Error generating talking video:\", error);\n      }\n    }\n\n    setIsGenerating(false);\n  }, [topic, photoUrl, sceneStyle, onGenerate]);\n\n  const getStatusIcon = () => {\n    switch (status) {\n      case \"generating_script\":\n        return <Sparkles className=\"w-4 h-4 animate-pulse\" />;\n      case \"generating_voice\":\n        return <Mic className=\"w-4 h-4 animate-pulse\" />;\n      case \"generating_background\":\n        return <Film className=\"w-4 h-4 animate-pulse\" />;\n      case \"lip_syncing\":\n        return <Volume2 className=\"w-4 h-4 animate-pulse\" />;\n      case \"complete\":\n        return <Check className=\"w-4 h-4 text-green-400\" />;\n      case \"error\":\n        return <RefreshCw className=\"w-4 h-4 text-red-400\" />;\n      default:\n        return <Video className=\"w-4 h-4\" />;\n    }\n  };\n\n  const getStatusText = () => {\n    switch (status) {\n      case \"generating_script\":\n        return \"Writing script...\";\n      case \"script_ready\":\n        return \"Script ready\";\n      case \"generating_voice\":\n        return \"Generating voice...\";\n      case \"voice_ready\":\n        return \"Voice ready\";\n      case \"generating_background\":\n        return \"Creating background...\";\n      case \"background_ready\":\n        return \"Background ready\";\n      case \"lip_syncing\":\n        return \"Syncing lips...\";\n      case \"complete\":\n        return \"Complete!\";\n      case \"error\":\n        return \"Error\";\n      default:\n        return \"Ready to generate\";\n    }\n  };\n\n  const isInProgress = [\n    \"generating_script\",\n    \"generating_voice\",\n    \"generating_background\",\n    \"lip_syncing\",\n  ].includes(status);\n\n  return (\n    <motion.div\n      className={`bg-gradient-to-br from-purple-900/40 to-pink-900/40 rounded-xl border overflow-hidden ${\n        isSelected ? \"border-purple-500 ring-2 ring-purple-500/30\" : \"border-white/10\"\n      }`}\n      style={{ width }}\n      initial={{ opacity: 0, scale: 0.9 }}\n      animate={{ opacity: 1, scale: 1 }}\n    >\n      {/* Header */}\n      <div className=\"flex items-center justify-between px-3 py-2 bg-black/30 border-b border-white/10\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"p-1.5 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg\">\n            <Video className=\"w-3.5 h-3.5 text-white\" />\n          </div>\n          <span className=\"text-sm font-medium text-white\">Talking Video</span>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <div className=\"flex items-center gap-1 text-xs text-white/60\">\n            {getStatusIcon()}\n            <span>{getStatusText()}</span>\n          </div>\n          <button\n            onClick={() => setIsExpanded(!isExpanded)}\n            className=\"p-1 hover:bg-white/10 rounded transition-colors\"\n          >\n            {isExpanded ? (\n              <ChevronUp className=\"w-4 h-4 text-white/60\" />\n            ) : (\n              <ChevronDown className=\"w-4 h-4 text-white/60\" />\n            )}\n          </button>\n        </div>\n      </div>\n\n      {/* Video preview or form */}\n      {finalVideoUrl ? (\n        <div className=\"p-2\">\n          <video\n            src={finalVideoUrl}\n            controls\n            className=\"w-full rounded-lg\"\n            poster={photoUrl}\n          />\n          {isExpanded && script && (\n            <div className=\"mt-2 p-2 bg-black/30 rounded-lg\">\n              <p className=\"text-xs text-white/50 mb-1\">Script:</p>\n              <p className=\"text-xs text-white/80 line-clamp-3\">{script}</p>\n            </div>\n          )}\n          <a\n            href={finalVideoUrl}\n            download\n            className=\"mt-2 flex items-center justify-center gap-2 px-3 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-sm transition-colors\"\n          >\n            <Download className=\"w-4 h-4\" />\n            Download\n          </a>\n        </div>\n      ) : isExpanded ? (\n        <div className=\"p-3 space-y-3\">\n          {/* Topic input */}\n          <div>\n            <label className=\"text-xs text-white/50 mb-1 block\">Topic</label>\n            <textarea\n              value={topic}\n              onChange={(e) => setTopic(e.target.value)}\n              placeholder=\"What should the video be about?\"\n              className=\"w-full bg-black/30 rounded-lg px-3 py-2 text-sm placeholder:text-white/30 focus:outline-none focus:ring-1 focus:ring-purple-500/50 resize-none\"\n              rows={2}\n              disabled={isInProgress}\n            />\n          </div>\n\n          {/* Photo URL */}\n          <div>\n            <label className=\"text-xs text-white/50 mb-1 block\">Photo URL</label>\n            <input\n              type=\"url\"\n              value={photoUrl}\n              onChange={(e) => setPhotoUrl(e.target.value)}\n              placeholder=\"https://example.com/photo.jpg\"\n              className=\"w-full bg-black/30 rounded-lg px-3 py-2 text-sm placeholder:text-white/30 focus:outline-none focus:ring-1 focus:ring-purple-500/50\"\n              disabled={isInProgress}\n            />\n          </div>\n\n          {/* Scene style */}\n          <div>\n            <label className=\"text-xs text-white/50 mb-1 block\">Scene</label>\n            <select\n              value={sceneStyle}\n              onChange={(e) => setSceneStyle(e.target.value as SceneStyle)}\n              className=\"w-full bg-black/30 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-purple-500/50\"\n              disabled={isInProgress}\n            >\n              <option value=\"podcast_studio\">Podcast Studio</option>\n              <option value=\"office\">Office</option>\n              <option value=\"outdoor\">Outdoor</option>\n              <option value=\"news_desk\">News Desk</option>\n              <option value=\"living_room\">Living Room</option>\n              <option value=\"conference\">Conference Room</option>\n            </select>\n          </div>\n\n          {/* Generate button */}\n          <button\n            onClick={handleGenerate}\n            disabled={!topic || !photoUrl || isInProgress || isGenerating}\n            className=\"w-full flex items-center justify-center gap-2 py-2.5 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed transition-all hover:scale-[1.02] active:scale-[0.98]\"\n          >\n            {isInProgress || isGenerating ? (\n              <>\n                <Loader2 className=\"w-4 h-4 animate-spin\" />\n                Generating...\n              </>\n            ) : (\n              <>\n                <Play className=\"w-4 h-4\" />\n                Generate Video\n              </>\n            )}\n          </button>\n        </div>\n      ) : (\n        <div className=\"p-3\">\n          <p className=\"text-sm text-white/60 text-center\">\n            {topic ? topic : \"No topic set\"}\n          </p>\n        </div>\n      )}\n\n      {/* Progress indicator for in-progress generation */}\n      {isInProgress && (\n        <div className=\"px-3 pb-3\">\n          <div className=\"flex gap-1\">\n            {[\"generating_script\", \"generating_voice\", \"generating_background\", \"lip_syncing\"].map(\n              (step, i) => {\n                const steps = [\n                  \"generating_script\",\n                  \"script_ready\",\n                  \"generating_voice\",\n                  \"voice_ready\",\n                  \"generating_background\",\n                  \"background_ready\",\n                  \"lip_syncing\",\n                ];\n                const currentIndex = steps.indexOf(status);\n                const stepIndex = i * 2;\n                const isComplete = currentIndex > stepIndex;\n                const isActive = currentIndex === stepIndex || currentIndex === stepIndex + 1;\n\n                return (\n                  <div\n                    key={step}\n                    className={`flex-1 h-1 rounded-full transition-colors ${\n                      isComplete\n                        ? \"bg-green-500\"\n                        : isActive\n                          ? \"bg-purple-500 animate-pulse\"\n                          : \"bg-white/20\"\n                    }`}\n                  />\n                );\n              }\n            )}\n          </div>\n        </div>\n      )}\n    </motion.div>\n  );\n}\n\nexport default TalkingVideoNode;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2557, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/design-canvas/ContextReferencePicker.tsx"],"sourcesContent":["'use client';\n\n/**\n * ContextReferencePicker - Allows users to pull in context from their data layer\n *\n * Triggered by @ in text input, shows searchable list of:\n * - Tickets (@ticket:)\n * - PRDs (@prd:)\n * - Projects (@project:)\n * - Tasks (@task:)\n * - Canvas (@canvas:)\n * - Memories (@memory:)\n * - Tracks/Lyrics (@track:)\n */\n\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useQuery } from '@/lib/openclaw/hooks';\nimport { api } from '@/lib/convex-shim';\nimport {\n  Search,\n  FileText,\n  Layers,\n  CheckSquare,\n  Music,\n  Brain,\n  LayoutGrid,\n  Target,\n  Ticket,\n  Hash,\n  Sparkles,\n  Eye,\n  Wrench,\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport type { ReferenceType, ContextReference } from '@/lib/canvas/artifacts';\nimport {\n  SKILL_COMMANDS,\n  DIMENSION_COMMANDS,\n  TOOL_COMMANDS,\n} from '@/lib/claw-ai/slash-command-registry';\n\n// ============================================================================\n// Types\n// ============================================================================\n\ninterface ReferenceCategory {\n  type: ReferenceType;\n  label: string;\n  icon: React.ReactNode;\n  color: string;\n}\n\ninterface ContextReferencePickerProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSelect: (reference: ContextReference) => void;\n  searchQuery?: string;\n  position?: { x: number; y: number };\n  filterType?: ReferenceType;\n}\n\n// ============================================================================\n// Reference Categories\n// ============================================================================\n\nconst REFERENCE_CATEGORIES: ReferenceCategory[] = [\n  { type: 'ticket', label: 'Tickets', icon: <Ticket className=\"w-4 h-4\" />, color: '#f59e0b' },\n  { type: 'prd', label: 'PRDs', icon: <FileText className=\"w-4 h-4\" />, color: '#ec4899' },\n  { type: 'project', label: 'Projects', icon: <Layers className=\"w-4 h-4\" />, color: '#8b5cf6' },\n  { type: 'task', label: 'Tasks', icon: <CheckSquare className=\"w-4 h-4\" />, color: '#3b82f6' },\n  { type: 'canvas', label: 'Canvas', icon: <LayoutGrid className=\"w-4 h-4\" />, color: '#10b981' },\n  { type: 'memory', label: 'Memories', icon: <Brain className=\"w-4 h-4\" />, color: '#6366f1' },\n  { type: 'track', label: 'Tracks', icon: <Music className=\"w-4 h-4\" />, color: '#ef4444' },\n  { type: 'skill', label: 'Skills', icon: <Sparkles className=\"w-4 h-4\" />, color: '#a855f7' },\n  { type: 'dimension', label: 'Dimensions', icon: <Eye className=\"w-4 h-4\" />, color: '#14b8a6' },\n  { type: 'tool', label: 'Tools', icon: <Wrench className=\"w-4 h-4\" />, color: '#0ea5e9' },\n];\n\n// ============================================================================\n// Component\n// ============================================================================\n\nexport function ContextReferencePicker({\n  isOpen,\n  onClose,\n  onSelect,\n  searchQuery: initialQuery = '',\n  position,\n  filterType,\n}: ContextReferencePickerProps) {\n  const [searchQuery, setSearchQuery] = useState(initialQuery);\n  const [selectedCategory, setSelectedCategory] = useState<ReferenceType | null>(filterType || null);\n  const [selectedIndex, setSelectedIndex] = useState(0);\n\n  // Query data from Convex\n  // Note: Using type assertion for designCanvas.listCanvases (types regenerate on convex dev)\n  const tickets = useQuery(api.agentic.listTickets, { limit: 50 });\n  const prds = useQuery(api.agentic.listPRDs, { limit: 20 });\n  const projects = useQuery(api.agentic.listProjects, {});\n  const tasks = useQuery(api.kanban.getTasks, {});\n  const canvases = useQuery((api as any).designCanvas?.listCanvases, { limit: 20 });\n\n  // SECURITY FIX: Pass userId to searchMemories to prevent cross-user data exposure\n  // TODO: Get actual userId from auth context - for now skip memory search\n  const memories = useQuery(api.memories.searchMemories, 'skip');\n\n  const tracks = useQuery(api.jamz.listTracks, { limit: 20 });\n\n  // Build searchable items\n  const allItems = useMemo(() => {\n    const items: ContextReference[] = [];\n\n    // Add tickets\n    if (tickets) {\n      tickets.forEach((t: any) => {\n        items.push({\n          type: 'ticket',\n          id: t._id,\n          displayName: t.ticketId || t.title || 'Untitled Ticket',\n          preview: t.iWant ? `As a ${t.asA}, I want ${t.iWant}` : t.description,\n          data: t,\n        });\n      });\n    }\n\n    // Add PRDs\n    if (prds) {\n      prds.forEach((p: any) => {\n        items.push({\n          type: 'prd',\n          id: p._id,\n          displayName: p.title || 'Untitled PRD',\n          preview: p.executiveSummary || p.problemStatement,\n          data: p,\n        });\n      });\n    }\n\n    // Add projects\n    if (projects) {\n      projects.forEach((p: any) => {\n        items.push({\n          type: 'project',\n          id: p._id,\n          displayName: p.name || 'Untitled Project',\n          preview: p.description,\n          data: p,\n        });\n      });\n    }\n\n    // Add tasks\n    if (tasks) {\n      tasks.forEach((t: any) => {\n        items.push({\n          type: 'task',\n          id: t._id,\n          displayName: t.title || 'Untitled Task',\n          preview: t.description,\n          data: t,\n        });\n      });\n    }\n\n    // Add canvases\n    if (canvases) {\n      canvases.forEach((c: any) => {\n        items.push({\n          type: 'canvas',\n          id: c._id,\n          displayName: c.name || 'Untitled Canvas',\n          preview: c.description || `${c.canvasType} canvas`,\n          data: c,\n        });\n      });\n    }\n\n    // Add memories\n    if (memories) {\n      memories.forEach((m: any) => {\n        items.push({\n          type: 'memory',\n          id: m._id,\n          displayName: m.content?.slice(0, 50) || 'Memory',\n          preview: m.content,\n          data: m,\n        });\n      });\n    }\n\n    // Add tracks\n    if (tracks) {\n      tracks.forEach((t: any) => {\n        items.push({\n          type: 'track',\n          id: t._id,\n          displayName: t.title || 'Untitled Track',\n          preview: t.lyrics?.slice(0, 100) || t.description,\n          data: t,\n        });\n      });\n    }\n\n    // Add skills from slash command registry\n    SKILL_COMMANDS.forEach((skill) => {\n      items.push({\n        type: 'skill',\n        id: skill.name,\n        displayName: skill.label,\n        preview: skill.description,\n        data: { contextType: skill.contextType, color: skill.color },\n      });\n    });\n\n    // Add dimensions from slash command registry\n    DIMENSION_COMMANDS.forEach((dim) => {\n      items.push({\n        type: 'dimension',\n        id: dim.name,\n        displayName: dim.label,\n        preview: dim.description,\n        data: { contextType: dim.contextType, color: dim.color },\n      });\n    });\n\n    // Add tools from slash command registry\n    TOOL_COMMANDS.forEach((tool) => {\n      items.push({\n        type: 'tool',\n        id: tool.name,\n        displayName: tool.label,\n        preview: tool.description,\n        data: { toolName: tool.toolName || tool.name, color: tool.color },\n      });\n    });\n\n    return items;\n  }, [tickets, prds, projects, tasks, canvases, memories, tracks]);\n\n  // Filter items by search and category\n  const filteredItems = useMemo(() => {\n    let items = allItems;\n\n    // Filter by category\n    if (selectedCategory) {\n      items = items.filter(item => item.type === selectedCategory);\n    }\n\n    // Filter by search query\n    if (searchQuery) {\n      const query = searchQuery.toLowerCase();\n      items = items.filter(item =>\n        item.displayName.toLowerCase().includes(query) ||\n        (item.preview && item.preview.toLowerCase().includes(query))\n      );\n    }\n\n    return items.slice(0, 20); // Limit results\n  }, [allItems, selectedCategory, searchQuery]);\n\n  // Reset selected index when filtered items change\n  useEffect(() => {\n    setSelectedIndex(0);\n  }, [filteredItems.length]);\n\n  // Keyboard navigation\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\n    switch (e.key) {\n      case 'ArrowDown':\n        e.preventDefault();\n        setSelectedIndex(prev => Math.min(prev + 1, filteredItems.length - 1));\n        break;\n      case 'ArrowUp':\n        e.preventDefault();\n        setSelectedIndex(prev => Math.max(prev - 1, 0));\n        break;\n      case 'Enter':\n        e.preventDefault();\n        if (filteredItems[selectedIndex]) {\n          onSelect(filteredItems[selectedIndex]);\n          onClose();\n        }\n        break;\n      case 'Escape':\n        e.preventDefault();\n        onClose();\n        break;\n      case 'Tab':\n        e.preventDefault();\n        // Cycle through categories\n        const currentIdx = selectedCategory\n          ? REFERENCE_CATEGORIES.findIndex(c => c.type === selectedCategory)\n          : -1;\n        const nextIdx = (currentIdx + 1) % (REFERENCE_CATEGORIES.length + 1);\n        setSelectedCategory(nextIdx === REFERENCE_CATEGORIES.length ? null : REFERENCE_CATEGORIES[nextIdx].type);\n        break;\n    }\n  }, [filteredItems, selectedIndex, selectedCategory, onSelect, onClose]);\n\n  // Get icon for reference type\n  const getIcon = (type: ReferenceType) => {\n    const category = REFERENCE_CATEGORIES.find(c => c.type === type);\n    return category?.icon || <Hash className=\"w-4 h-4\" />;\n  };\n\n  // Get color for reference type\n  const getColor = (type: ReferenceType) => {\n    const category = REFERENCE_CATEGORIES.find(c => c.type === type);\n    return category?.color || '#6b7280';\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: -10 }}\n      animate={{ opacity: 1, y: 0 }}\n      exit={{ opacity: 0, y: -10 }}\n      className=\"absolute z-50 w-96 max-h-[400px] bg-[#1a1a2e] border border-white/10 rounded-xl shadow-2xl overflow-hidden\"\n      style={position ? { left: position.x, top: position.y } : { left: 0, bottom: '100%', marginBottom: 8 }}\n      onKeyDown={handleKeyDown}\n    >\n      {/* Search Header */}\n      <div className=\"p-3 border-b border-white/10\">\n        <div className=\"flex items-center gap-2 px-3 py-2 bg-white/5 rounded-lg\">\n          <Search className=\"w-4 h-4 text-white/40\" />\n          <input\n            type=\"text\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            placeholder=\"Search your data...\"\n            className=\"flex-1 bg-transparent border-none outline-none text-white text-sm placeholder-white/40\"\n            autoFocus\n          />\n          {searchQuery && (\n            <button\n              onClick={() => setSearchQuery('')}\n              className=\"text-white/40 hover:text-white/60\"\n            >\n              ×\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Category Tabs */}\n      <div className=\"flex items-center gap-1 p-2 border-b border-white/10 overflow-x-auto\">\n        <button\n          onClick={() => setSelectedCategory(null)}\n          className={cn(\n            'px-3 py-1.5 rounded-lg text-xs font-medium transition-colors whitespace-nowrap',\n            !selectedCategory\n              ? 'bg-white/10 text-white'\n              : 'text-white/50 hover:text-white/70 hover:bg-white/5'\n          )}\n        >\n          All\n        </button>\n        {REFERENCE_CATEGORIES.map((category) => (\n          <button\n            key={category.type}\n            onClick={() => setSelectedCategory(category.type)}\n            className={cn(\n              'flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors whitespace-nowrap',\n              selectedCategory === category.type\n                ? 'bg-white/10 text-white'\n                : 'text-white/50 hover:text-white/70 hover:bg-white/5'\n            )}\n            style={selectedCategory === category.type ? { color: category.color } : {}}\n          >\n            {category.icon}\n            {category.label}\n          </button>\n        ))}\n      </div>\n\n      {/* Results List */}\n      <div className=\"max-h-[280px] overflow-y-auto\">\n        {filteredItems.length === 0 ? (\n          <div className=\"p-8 text-center\">\n            <Search className=\"w-8 h-8 mx-auto mb-2 text-white/20\" />\n            <p className=\"text-sm text-white/40\">No results found</p>\n            <p className=\"text-xs text-white/30 mt-1\">Try a different search or category</p>\n          </div>\n        ) : (\n          filteredItems.map((item, index) => (\n            <button\n              key={`${item.type}-${item.id}`}\n              onClick={() => {\n                onSelect(item);\n                onClose();\n              }}\n              className={cn(\n                'w-full flex items-start gap-3 p-3 text-left transition-colors',\n                index === selectedIndex\n                  ? 'bg-white/10'\n                  : 'hover:bg-white/5'\n              )}\n            >\n              {/* Icon */}\n              <div\n                className=\"w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0\"\n                style={{ backgroundColor: `${getColor(item.type)}20`, color: getColor(item.type) }}\n              >\n                {getIcon(item.type)}\n              </div>\n\n              {/* Content */}\n              <div className=\"flex-1 min-w-0\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-sm font-medium text-white truncate\">\n                    {item.displayName}\n                  </span>\n                  <span\n                    className=\"text-[10px] px-1.5 py-0.5 rounded-full font-medium\"\n                    style={{ backgroundColor: `${getColor(item.type)}20`, color: getColor(item.type) }}\n                  >\n                    {item.type}\n                  </span>\n                </div>\n                {item.preview && (\n                  <p className=\"text-xs text-white/50 mt-0.5 line-clamp-2\">\n                    {item.preview}\n                  </p>\n                )}\n              </div>\n            </button>\n          ))\n        )}\n      </div>\n\n      {/* Footer Hint */}\n      <div className=\"p-2 border-t border-white/10 bg-white/5\">\n        <p className=\"text-[10px] text-white/40 text-center\">\n          <kbd className=\"px-1 py-0.5 bg-white/10 rounded text-white/60\">↑↓</kbd> navigate\n          {' '}<kbd className=\"px-1 py-0.5 bg-white/10 rounded text-white/60\">Tab</kbd> switch category\n          {' '}<kbd className=\"px-1 py-0.5 bg-white/10 rounded text-white/60\">Enter</kbd> select\n        </p>\n      </div>\n    </motion.div>\n  );\n}\n\nexport default ContextReferencePicker;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3288, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/design-canvas/ContextMenu.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Type,\n  StickyNote,\n  Image,\n  Square,\n  Code,\n  Video,\n  Music,\n  Sparkles,\n  Smartphone,\n  GitBranch,\n  Database,\n  Copy,\n  Scissors,\n  Clipboard,\n  Trash2,\n  Edit3,\n  RefreshCw,\n  Palette,\n  Link,\n  Pin,\n  Lock,\n  ArrowUpToLine,\n  ArrowDownToLine,\n  Expand,\n  ChevronRight,\n  ZoomIn,\n  Target,\n  Settings,\n  Layers,\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\nexport type ContextMenuType = 'canvas' | 'node';\n\nexport interface ContextMenuPosition {\n  x: number;\n  y: number;\n  type: ContextMenuType;\n  nodeId?: string;\n  nodeType?: string;\n}\n\ninterface MenuItem {\n  id: string;\n  label: string;\n  icon?: React.ReactNode;\n  shortcut?: string;\n  divider?: boolean;\n  disabled?: boolean;\n  danger?: boolean;\n  submenu?: MenuItem[];\n  action?: () => void;\n}\n\ninterface ContextMenuProps {\n  position: ContextMenuPosition | null;\n  onClose: () => void;\n  onAddNode: (type: string, x: number, y: number) => void;\n  onCopy: () => void;\n  onCut: () => void;\n  onPaste: () => void;\n  onDelete: () => void;\n  onDuplicate: () => void;\n  onEdit: () => void;\n  onRegenerate?: () => void;\n  onChangeStyle?: () => void;\n  onAddConnection?: () => void;\n  onAddToContext?: () => void;\n  onLock?: () => void;\n  onBringToFront?: () => void;\n  onSendToBack?: () => void;\n  onZoomToFit?: () => void;\n  onCenterView?: () => void;\n  onSelectAll?: () => void;\n  onCanvasSettings?: () => void;\n  isLocked?: boolean;\n  canRegenerate?: boolean;\n}\n\nexport function ContextMenu({\n  position,\n  onClose,\n  onAddNode,\n  onCopy,\n  onCut,\n  onPaste,\n  onDelete,\n  onDuplicate,\n  onEdit,\n  onRegenerate,\n  onChangeStyle,\n  onAddConnection,\n  onAddToContext,\n  onLock,\n  onBringToFront,\n  onSendToBack,\n  onZoomToFit,\n  onCenterView,\n  onSelectAll,\n  onCanvasSettings,\n  isLocked = false,\n  canRegenerate = false,\n}: ContextMenuProps) {\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  // Close on outside click\n  useEffect(() => {\n    if (!position) return;\n\n    const handleClickOutside = (e: MouseEvent) => {\n      if (menuRef.current && !menuRef.current.contains(e.target as Node)) {\n        onClose();\n      }\n    };\n\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        onClose();\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    document.addEventListener('keydown', handleEscape);\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n      document.removeEventListener('keydown', handleEscape);\n    };\n  }, [position, onClose]);\n\n  if (!position) return null;\n\n  const addNodeItems: MenuItem[] = [\n    { id: 'text', label: 'Text', icon: <Type className=\"w-4 h-4\" /> },\n    { id: 'sticky', label: 'Sticky Note', icon: <StickyNote className=\"w-4 h-4\" /> },\n    { id: 'image', label: 'Image', icon: <Image className=\"w-4 h-4\" /> },\n    { id: 'shape', label: 'Shape', icon: <Square className=\"w-4 h-4\" /> },\n    { id: 'code', label: 'Code Block', icon: <Code className=\"w-4 h-4\" /> },\n    { id: 'divider-1', label: '', divider: true },\n    { id: 'video', label: 'Video', icon: <Video className=\"w-4 h-4\" /> },\n    { id: 'audio-beat-sync', label: 'Audio / Beat Sync', icon: <Music className=\"w-4 h-4\" /> },\n    { id: 'ai_generation', label: 'AI Generator', icon: <Sparkles className=\"w-4 h-4\" /> },\n    { id: 'divider-2', label: '', divider: true },\n    { id: 'device-frame', label: 'Device Frame', icon: <Smartphone className=\"w-4 h-4\" /> },\n    { id: 'flow-process', label: 'Flow Node', icon: <GitBranch className=\"w-4 h-4\" /> },\n    { id: 'arch-service', label: 'Architecture Node', icon: <Database className=\"w-4 h-4\" /> },\n  ];\n\n  const canvasMenuItems: MenuItem[] = [\n    {\n      id: 'add-node',\n      label: 'Add Node',\n      icon: <Layers className=\"w-4 h-4\" />,\n      submenu: addNodeItems,\n    },\n    { id: 'divider-1', label: '', divider: true },\n    { id: 'paste', label: 'Paste', icon: <Clipboard className=\"w-4 h-4\" />, shortcut: '⌘V', action: onPaste },\n    { id: 'select-all', label: 'Select All', icon: <Square className=\"w-4 h-4\" />, shortcut: '⌘A', action: onSelectAll },\n    { id: 'divider-2', label: '', divider: true },\n    { id: 'zoom-fit', label: 'Zoom to Fit', icon: <ZoomIn className=\"w-4 h-4\" />, action: onZoomToFit },\n    { id: 'center', label: 'Center View', icon: <Target className=\"w-4 h-4\" />, shortcut: '⌘0', action: onCenterView },\n    { id: 'divider-3', label: '', divider: true },\n    { id: 'settings', label: 'Canvas Settings', icon: <Settings className=\"w-4 h-4\" />, action: onCanvasSettings },\n  ];\n\n  const nodeMenuItems: MenuItem[] = [\n    { id: 'edit', label: 'Edit', icon: <Edit3 className=\"w-4 h-4\" />, shortcut: 'Enter', action: onEdit },\n    ...(canRegenerate\n      ? [{ id: 'regenerate', label: 'Regenerate', icon: <RefreshCw className=\"w-4 h-4\" />, action: onRegenerate }]\n      : []),\n    { id: 'divider-1', label: '', divider: true },\n    { id: 'copy', label: 'Copy', icon: <Copy className=\"w-4 h-4\" />, shortcut: '⌘C', action: onCopy },\n    { id: 'cut', label: 'Cut', icon: <Scissors className=\"w-4 h-4\" />, shortcut: '⌘X', action: onCut },\n    { id: 'duplicate', label: 'Duplicate', icon: <Copy className=\"w-4 h-4\" />, shortcut: '⌘D', action: onDuplicate },\n    { id: 'delete', label: 'Delete', icon: <Trash2 className=\"w-4 h-4\" />, shortcut: '⌫', danger: true, action: onDelete },\n    { id: 'divider-2', label: '', divider: true },\n    { id: 'style', label: 'Change Style', icon: <Palette className=\"w-4 h-4\" />, action: onChangeStyle },\n    { id: 'resize', label: 'Resize', icon: <Expand className=\"w-4 h-4\" /> },\n    { id: 'connection', label: 'Add Connection', icon: <Link className=\"w-4 h-4\" />, action: onAddConnection },\n    { id: 'context', label: 'Add to Context', icon: <Pin className=\"w-4 h-4\" />, action: onAddToContext },\n    { id: 'divider-3', label: '', divider: true },\n    {\n      id: 'lock',\n      label: isLocked ? 'Unlock Position' : 'Lock Position',\n      icon: <Lock className=\"w-4 h-4\" />,\n      action: onLock,\n    },\n    { id: 'front', label: 'Bring to Front', icon: <ArrowUpToLine className=\"w-4 h-4\" />, shortcut: ']', action: onBringToFront },\n    { id: 'back', label: 'Send to Back', icon: <ArrowDownToLine className=\"w-4 h-4\" />, shortcut: '[', action: onSendToBack },\n  ];\n\n  const menuItems = position.type === 'canvas' ? canvasMenuItems : nodeMenuItems;\n\n  // Calculate position to keep menu in viewport\n  const adjustPosition = (x: number, y: number) => {\n    const menuWidth = 220;\n    const menuHeight = 400;\n    const padding = 8;\n\n    let adjustedX = x;\n    let adjustedY = y;\n\n    if (typeof window !== 'undefined') {\n      if (x + menuWidth > window.innerWidth - padding) {\n        adjustedX = window.innerWidth - menuWidth - padding;\n      }\n      if (y + menuHeight > window.innerHeight - padding) {\n        adjustedY = window.innerHeight - menuHeight - padding;\n      }\n    }\n\n    return { x: adjustedX, y: adjustedY };\n  };\n\n  const { x, y } = adjustPosition(position.x, position.y);\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        ref={menuRef}\n        initial={{ opacity: 0, scale: 0.95, y: -5 }}\n        animate={{ opacity: 1, scale: 1, y: 0 }}\n        exit={{ opacity: 0, scale: 0.95 }}\n        transition={{ duration: 0.12, ease: 'easeOut' }}\n        className=\"fixed z-[9999] min-w-[200px] py-1.5 rounded-xl bg-background/95 backdrop-blur-xl border border-border shadow-2xl\"\n        style={{ left: x, top: y }}\n      >\n        {menuItems.map((item) => {\n          if (item.divider) {\n            return <div key={item.id} className=\"my-1.5 h-px bg-border/50\" />;\n          }\n\n          if (item.submenu) {\n            return (\n              <SubmenuItem\n                key={item.id}\n                item={item}\n                onSelect={(subItem) => {\n                  onAddNode(subItem.id, position.x, position.y);\n                  onClose();\n                }}\n              />\n            );\n          }\n\n          return (\n            <button\n              key={item.id}\n              onClick={() => {\n                item.action?.();\n                onClose();\n              }}\n              disabled={item.disabled}\n              className={cn(\n                'w-full flex items-center gap-3 px-3 py-2 text-sm text-left',\n                'hover:bg-accent/50 transition-colors duration-100',\n                'disabled:opacity-50 disabled:cursor-not-allowed',\n                item.danger && 'text-destructive hover:bg-destructive/10'\n              )}\n            >\n              {item.icon && <span className=\"text-muted-foreground\">{item.icon}</span>}\n              <span className=\"flex-1\">{item.label}</span>\n              {item.shortcut && (\n                <span className=\"text-xs text-muted-foreground/70\">{item.shortcut}</span>\n              )}\n            </button>\n          );\n        })}\n      </motion.div>\n    </AnimatePresence>\n  );\n}\n\nfunction SubmenuItem({\n  item,\n  onSelect,\n}: {\n  item: MenuItem;\n  onSelect: (item: MenuItem) => void;\n}) {\n  return (\n    <div className=\"relative group\">\n      <button\n        className={cn(\n          'w-full flex items-center gap-3 px-3 py-2 text-sm text-left',\n          'hover:bg-accent/50 transition-colors duration-100'\n        )}\n      >\n        {item.icon && <span className=\"text-muted-foreground\">{item.icon}</span>}\n        <span className=\"flex-1\">{item.label}</span>\n        <ChevronRight className=\"w-4 h-4 text-muted-foreground\" />\n      </button>\n\n      <div className=\"absolute left-full top-0 ml-1 hidden group-hover:block\">\n        <motion.div\n          initial={{ opacity: 0, x: -5 }}\n          animate={{ opacity: 1, x: 0 }}\n          className=\"min-w-[180px] py-1.5 rounded-xl bg-background/95 backdrop-blur-xl border border-border shadow-2xl\"\n        >\n          {item.submenu?.map((subItem) => {\n            if (subItem.divider) {\n              return <div key={subItem.id} className=\"my-1.5 h-px bg-border/50\" />;\n            }\n\n            return (\n              <button\n                key={subItem.id}\n                onClick={() => onSelect(subItem)}\n                className={cn(\n                  'w-full flex items-center gap-3 px-3 py-2 text-sm text-left',\n                  'hover:bg-accent/50 transition-colors duration-100'\n                )}\n              >\n                {subItem.icon && <span className=\"text-muted-foreground\">{subItem.icon}</span>}\n                <span className=\"flex-1\">{subItem.label}</span>\n              </button>\n            );\n          })}\n        </motion.div>\n      </div>\n    </div>\n  );\n}\n\nexport default ContextMenu;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4014, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/design-canvas/nodes/waveform/PremiumWaveform.tsx"],"sourcesContent":["'use client';\n\nimport { useRef, useEffect, useCallback, useState, useMemo } from 'react';\nimport { motion, AnimatePresence, useSpring, useTransform } from 'framer-motion';\nimport { cn } from '@/lib/utils';\nimport { springs, motionConfig } from '@/components/motion/config';\nimport type { Beat, Section } from '../AudioBeatSyncNode';\n\n// =============================================================================\n// TYPES\n// =============================================================================\n\nexport interface PremiumWaveformProps {\n  /** Normalized waveform data (0-1 values) */\n  waveformData: number[];\n  /** Beat markers with timing and type */\n  beats: Beat[];\n  /** Song sections for background coloring */\n  sections: Section[];\n  /** Current playback time in seconds */\n  currentTime: number;\n  /** Total duration in seconds */\n  duration: number;\n  /** Whether audio is currently playing */\n  isPlaying: boolean;\n  /** Callback when user seeks to a position */\n  onSeek: (timeSeconds: number) => void;\n  /** Width of the component */\n  width: number;\n  /** Height of the waveform area */\n  height?: number;\n  /** Whether to show beat markers */\n  showBeats?: boolean;\n  /** Whether to show section labels */\n  showSections?: boolean;\n  /** Custom accent color (defaults to theme primary) */\n  accentColor?: string;\n}\n\n// Color palette for sections (theme-aware with fallbacks)\nconst SECTION_COLORS: Record<string, { bg: string; border: string; glow: string }> = {\n  intro: { bg: 'rgba(59, 130, 246, 0.15)', border: 'rgba(59, 130, 246, 0.4)', glow: 'rgba(59, 130, 246, 0.3)' },\n  verse: { bg: 'rgba(34, 197, 94, 0.15)', border: 'rgba(34, 197, 94, 0.4)', glow: 'rgba(34, 197, 94, 0.3)' },\n  prechorus: { bg: 'rgba(168, 85, 247, 0.15)', border: 'rgba(168, 85, 247, 0.4)', glow: 'rgba(168, 85, 247, 0.3)' },\n  chorus: { bg: 'rgba(168, 85, 247, 0.2)', border: 'rgba(168, 85, 247, 0.5)', glow: 'rgba(168, 85, 247, 0.4)' },\n  bridge: { bg: 'rgba(249, 115, 22, 0.15)', border: 'rgba(249, 115, 22, 0.4)', glow: 'rgba(249, 115, 22, 0.3)' },\n  outro: { bg: 'rgba(107, 114, 128, 0.15)', border: 'rgba(107, 114, 128, 0.4)', glow: 'rgba(107, 114, 128, 0.3)' },\n  break: { bg: 'rgba(236, 72, 153, 0.15)', border: 'rgba(236, 72, 153, 0.4)', glow: 'rgba(236, 72, 153, 0.3)' },\n  solo: { bg: 'rgba(234, 179, 8, 0.15)', border: 'rgba(234, 179, 8, 0.4)', glow: 'rgba(234, 179, 8, 0.3)' },\n};\n\n// Beat colors\nconst BEAT_COLORS = {\n  kick: { color: '#EF4444', glow: 'rgba(239, 68, 68, 0.6)' },\n  snare: { color: '#3B82F6', glow: 'rgba(59, 130, 246, 0.6)' },\n  hihat: { color: '#EAB308', glow: 'rgba(234, 179, 8, 0.4)' },\n  crash: { color: '#EC4899', glow: 'rgba(236, 72, 153, 0.6)' },\n  other: { color: '#6B7280', glow: 'rgba(107, 114, 128, 0.4)' },\n};\n\n// =============================================================================\n// COMPONENT\n// =============================================================================\n\nexport function PremiumWaveform({\n  waveformData,\n  beats,\n  sections,\n  currentTime,\n  duration,\n  isPlaying,\n  onSeek,\n  width,\n  height = 120,\n  showBeats = true,\n  showSections = true,\n  accentColor,\n}: PremiumWaveformProps) {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const animationFrameRef = useRef<number | null>(null);\n  const [hoveredTime, setHoveredTime] = useState<number | null>(null);\n  const [isDragging, setIsDragging] = useState(false);\n  const [activeBeat, setActiveBeat] = useState<Beat | null>(null);\n\n  // Spring-animated playhead position for smooth movement\n  const playheadProgress = useSpring(0, { ...springs.smooth, bounce: 0 });\n\n  // Memoize computed values\n  const progressPercent = useMemo(() =>\n    duration > 0 ? (currentTime / duration) * 100 : 0\n  , [currentTime, duration]);\n\n  // Update spring value when currentTime changes\n  useEffect(() => {\n    playheadProgress.set(progressPercent);\n  }, [progressPercent, playheadProgress]);\n\n  // Find current section\n  const currentSection = useMemo(() => {\n    if (!sections.length || !duration) return null;\n    const currentMs = currentTime * 1000;\n    return sections.find(s => currentMs >= s.startMs && currentMs < s.endMs);\n  }, [sections, currentTime, duration]);\n\n  // Find active beat (within 50ms of current time)\n  useEffect(() => {\n    if (!isPlaying || !beats.length) {\n      setActiveBeat(null);\n      return;\n    }\n\n    const currentMs = currentTime * 1000;\n    const nearBeat = beats.find(b =>\n      Math.abs(b.timeMs - currentMs) < 50 && b.intensity > 0.5\n    );\n\n    if (nearBeat) {\n      setActiveBeat(nearBeat);\n      // Clear after animation duration\n      const timeout = setTimeout(() => setActiveBeat(null), 150);\n      return () => clearTimeout(timeout);\n    }\n  }, [currentTime, beats, isPlaying]);\n\n  // =============================================================================\n  // CANVAS RENDERING\n  // =============================================================================\n\n  const drawWaveform = useCallback(() => {\n    const canvas = canvasRef.current;\n    if (!canvas || !waveformData.length) return;\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    const dpr = window.devicePixelRatio || 1;\n    const w = canvas.width / dpr;\n    const h = canvas.height / dpr;\n    const centerY = h / 2;\n    const barWidth = w / waveformData.length;\n    const playedWidth = duration > 0 ? (currentTime / duration) * w : 0;\n\n    ctx.clearRect(0, 0, w * dpr, h * dpr);\n    ctx.scale(dpr, dpr);\n\n    // -- Draw section backgrounds --\n    if (showSections && sections.length && duration > 0) {\n      sections.forEach(section => {\n        const startX = (section.startMs / 1000 / duration) * w;\n        const endX = (section.endMs / 1000 / duration) * w;\n        const sectionWidth = endX - startX;\n        const colors = SECTION_COLORS[section.type] || SECTION_COLORS.verse;\n\n        // Section background\n        ctx.fillStyle = colors.bg;\n        ctx.fillRect(startX, 0, sectionWidth, h);\n\n        // Section border (left edge)\n        if (section.startMs > 0) {\n          ctx.fillStyle = colors.border;\n          ctx.fillRect(startX, 0, 1, h);\n        }\n      });\n    }\n\n    // -- Draw waveform bars --\n    waveformData.forEach((amplitude, i) => {\n      const x = i * barWidth;\n      const barHeight = Math.max(2, amplitude * h * 0.85);\n      const isPlayed = x < playedWidth;\n\n      // Create gradient for each bar\n      const gradient = ctx.createLinearGradient(x, centerY - barHeight / 2, x, centerY + barHeight / 2);\n\n      if (isPlayed) {\n        // Played portion - vibrant accent color\n        gradient.addColorStop(0, accentColor || 'rgba(168, 85, 247, 0.9)');\n        gradient.addColorStop(0.5, accentColor || 'rgba(139, 92, 246, 1)');\n        gradient.addColorStop(1, accentColor || 'rgba(168, 85, 247, 0.9)');\n      } else {\n        // Unplayed portion - muted\n        gradient.addColorStop(0, 'rgba(139, 92, 246, 0.25)');\n        gradient.addColorStop(0.5, 'rgba(139, 92, 246, 0.35)');\n        gradient.addColorStop(1, 'rgba(139, 92, 246, 0.25)');\n      }\n\n      ctx.fillStyle = gradient;\n\n      // Draw mirrored bars (top and bottom from center)\n      const gap = Math.max(1, barWidth * 0.15);\n      ctx.fillRect(x, centerY - barHeight / 2, barWidth - gap, barHeight);\n    });\n\n    // -- Draw beat markers --\n    if (showBeats && beats.length && duration > 0) {\n      beats.forEach(beat => {\n        const x = (beat.timeMs / 1000 / duration) * w;\n        const beatColors = BEAT_COLORS[beat.type] || BEAT_COLORS.other;\n\n        // Draw beat line\n        ctx.beginPath();\n        ctx.strokeStyle = beatColors.color;\n        ctx.lineWidth = beat.isDownbeat ? 2.5 : 1.5;\n        ctx.globalAlpha = beat.intensity * 0.7;\n\n        // Dashed line for non-downbeats\n        if (!beat.isDownbeat) {\n          ctx.setLineDash([2, 4]);\n        } else {\n          ctx.setLineDash([]);\n        }\n\n        ctx.moveTo(x, 0);\n        ctx.lineTo(x, h);\n        ctx.stroke();\n        ctx.globalAlpha = 1;\n        ctx.setLineDash([]);\n\n        // Draw downbeat indicators (small circles at top)\n        if (beat.isDownbeat) {\n          ctx.beginPath();\n          ctx.fillStyle = beatColors.color;\n          ctx.arc(x, 6, 3, 0, Math.PI * 2);\n          ctx.fill();\n        }\n      });\n    }\n\n    // -- Draw hover time indicator --\n    if (hoveredTime !== null && duration > 0) {\n      const hoverX = (hoveredTime / duration) * w;\n      ctx.beginPath();\n      ctx.strokeStyle = 'rgba(255, 255, 255, 0.6)';\n      ctx.lineWidth = 1;\n      ctx.setLineDash([3, 3]);\n      ctx.moveTo(hoverX, 0);\n      ctx.lineTo(hoverX, h);\n      ctx.stroke();\n      ctx.setLineDash([]);\n    }\n\n    // Reset transform\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n  }, [waveformData, beats, sections, currentTime, duration, showBeats, showSections, hoveredTime, accentColor]);\n\n  // Set up canvas with proper DPR\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const dpr = window.devicePixelRatio || 1;\n    canvas.width = width * dpr;\n    canvas.height = height * dpr;\n    canvas.style.width = `${width}px`;\n    canvas.style.height = `${height}px`;\n  }, [width, height]);\n\n  // Animation loop for smooth rendering\n  useEffect(() => {\n    const animate = () => {\n      drawWaveform();\n      if (isPlaying) {\n        animationFrameRef.current = requestAnimationFrame(animate);\n      }\n    };\n\n    animate();\n\n    return () => {\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n    };\n  }, [drawWaveform, isPlaying]);\n\n  // Redraw on data changes\n  useEffect(() => {\n    drawWaveform();\n  }, [drawWaveform, waveformData, beats, sections, currentTime, hoveredTime]);\n\n  // =============================================================================\n  // INTERACTION HANDLERS\n  // =============================================================================\n\n  const getTimeFromPosition = useCallback((clientX: number) => {\n    const container = containerRef.current;\n    if (!container || !duration) return 0;\n\n    const rect = container.getBoundingClientRect();\n    const x = clientX - rect.left;\n    const percent = Math.max(0, Math.min(1, x / rect.width));\n    return percent * duration;\n  }, [duration]);\n\n  const handleMouseMove = useCallback((e: React.MouseEvent) => {\n    const time = getTimeFromPosition(e.clientX);\n    setHoveredTime(time);\n\n    if (isDragging) {\n      onSeek(time);\n    }\n  }, [getTimeFromPosition, isDragging, onSeek]);\n\n  const handleMouseDown = useCallback((e: React.MouseEvent) => {\n    setIsDragging(true);\n    const time = getTimeFromPosition(e.clientX);\n    onSeek(time);\n  }, [getTimeFromPosition, onSeek]);\n\n  const handleMouseUp = useCallback(() => {\n    setIsDragging(false);\n  }, []);\n\n  const handleMouseLeave = useCallback(() => {\n    setHoveredTime(null);\n    setIsDragging(false);\n  }, []);\n\n  // Global mouse up handler for drag release\n  useEffect(() => {\n    if (isDragging) {\n      const handleGlobalMouseUp = () => setIsDragging(false);\n      window.addEventListener('mouseup', handleGlobalMouseUp);\n      return () => window.removeEventListener('mouseup', handleGlobalMouseUp);\n    }\n  }, [isDragging]);\n\n  // Format time for display\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  // =============================================================================\n  // RENDER\n  // =============================================================================\n\n  return (\n    <div className=\"relative\">\n      {/* Waveform Container */}\n      <div\n        ref={containerRef}\n        className={cn(\n          'relative rounded-xl overflow-hidden cursor-pointer',\n          'bg-gradient-to-b from-background/50 to-muted/30',\n          'ring-1 ring-border/30',\n          'transition-shadow duration-200',\n          isDragging && 'ring-2 ring-primary/50 shadow-lg shadow-primary/20'\n        )}\n        style={{ width, height }}\n        onMouseMove={handleMouseMove}\n        onMouseDown={handleMouseDown}\n        onMouseUp={handleMouseUp}\n        onMouseLeave={handleMouseLeave}\n      >\n        {/* Canvas Layer */}\n        <canvas\n          ref={canvasRef}\n          className=\"absolute inset-0\"\n          style={{ width, height }}\n        />\n\n        {/* Animated Playhead */}\n        <motion.div\n          className=\"absolute top-0 bottom-0 w-0.5 pointer-events-none z-10\"\n          style={{\n            left: useTransform(playheadProgress, v => `${v}%`),\n            background: 'linear-gradient(to bottom, rgba(34, 197, 94, 0.8), rgba(34, 197, 94, 1), rgba(34, 197, 94, 0.8))',\n            boxShadow: isPlaying\n              ? '0 0 8px rgba(34, 197, 94, 0.8), 0 0 16px rgba(34, 197, 94, 0.4)'\n              : '0 0 4px rgba(34, 197, 94, 0.5)',\n          }}\n        >\n          {/* Playhead Handle */}\n          <motion.div\n            className={cn(\n              'absolute -top-1 left-1/2 -translate-x-1/2',\n              'w-3 h-3 rounded-full',\n              'bg-green-500 border-2 border-white shadow-lg'\n            )}\n            animate={{\n              scale: isPlaying ? [1, 1.1, 1] : 1,\n            }}\n            transition={{\n              duration: 0.5,\n              repeat: isPlaying ? Infinity : 0,\n              ease: 'easeInOut',\n            }}\n          />\n        </motion.div>\n\n        {/* Beat Flash Overlay */}\n        <AnimatePresence>\n          {activeBeat && (\n            <motion.div\n              key={activeBeat.timeMs}\n              className=\"absolute inset-0 pointer-events-none\"\n              initial={{ opacity: 0.6 }}\n              animate={{ opacity: 0 }}\n              exit={{ opacity: 0 }}\n              transition={{ duration: 0.15 }}\n              style={{\n                background: activeBeat.isDownbeat\n                  ? `radial-gradient(circle at 50% 50%, ${BEAT_COLORS[activeBeat.type].glow}, transparent 70%)`\n                  : 'transparent',\n              }}\n            />\n          )}\n        </AnimatePresence>\n\n        {/* Hover Time Tooltip */}\n        <AnimatePresence>\n          {hoveredTime !== null && !isDragging && (\n            <motion.div\n              className={cn(\n                'absolute top-2 px-2 py-1 rounded-md',\n                'bg-background/90 backdrop-blur-sm',\n                'text-xs font-mono text-foreground',\n                'border border-border/50 shadow-lg',\n                'pointer-events-none z-20'\n              )}\n              initial={{ opacity: 0, y: 4 }}\n              animate={{ opacity: 1, y: 0 }}\n              exit={{ opacity: 0, y: 4 }}\n              transition={springs.snappy}\n              style={{\n                left: `${(hoveredTime / duration) * 100}%`,\n                transform: 'translateX(-50%)',\n              }}\n            >\n              {formatTime(hoveredTime)}\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </div>\n\n      {/* Section Labels */}\n      {showSections && sections.length > 0 && (\n        <div className=\"flex gap-0.5 mt-2\" style={{ width }}>\n          {sections.map((section, i) => {\n            const sectionWidth = ((section.endMs - section.startMs) / 1000 / duration) * 100;\n            const colors = SECTION_COLORS[section.type] || SECTION_COLORS.verse;\n            const isActive = currentSection?.startMs === section.startMs;\n\n            return (\n              <motion.div\n                key={i}\n                className={cn(\n                  'relative rounded-md px-1.5 py-1',\n                  'text-[10px] font-medium text-center truncate',\n                  'border transition-all duration-200',\n                  isActive && 'ring-1 ring-primary/50'\n                )}\n                style={{\n                  width: `${sectionWidth}%`,\n                  backgroundColor: colors.bg,\n                  borderColor: colors.border,\n                  boxShadow: isActive ? `0 0 8px ${colors.glow}` : 'none',\n                }}\n                animate={{\n                  scale: isActive ? 1.02 : 1,\n                }}\n                transition={springs.snappy}\n              >\n                <span className=\"opacity-80\">{section.label}</span>\n              </motion.div>\n            );\n          })}\n        </div>\n      )}\n\n      {/* Time Display */}\n      <div className=\"flex justify-between mt-2 px-1 text-xs font-mono text-muted-foreground\">\n        <span>{formatTime(currentTime)}</span>\n        <span className=\"text-foreground/60\">\n          {currentSection && (\n            <span className=\"mr-2 text-primary\">{currentSection.label}</span>\n          )}\n        </span>\n        <span>{formatTime(duration)}</span>\n      </div>\n    </div>\n  );\n}\n\nexport default PremiumWaveform;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4649, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/design-canvas/nodes/waveform/AudioControls.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Play,\n  Pause,\n  SkipBack,\n  SkipForward,\n  Volume2,\n  VolumeX,\n  Volume1,\n  Repeat,\n  Shuffle,\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { springs } from '@/components/motion/config';\n\nexport interface AudioControlsProps {\n  isPlaying: boolean;\n  onPlayPause: () => void;\n  onSkipBack: () => void;\n  onSkipForward: () => void;\n  volume: number;\n  onVolumeChange: (volume: number) => void;\n  isMuted: boolean;\n  onToggleMute: () => void;\n  currentTime: number;\n  duration: number;\n  disabled?: boolean;\n  size?: 'sm' | 'md' | 'lg';\n  showVolumeSlider?: boolean;\n  className?: string;\n}\n\nexport function AudioControls({\n  isPlaying,\n  onPlayPause,\n  onSkipBack,\n  onSkipForward,\n  volume,\n  onVolumeChange,\n  isMuted,\n  onToggleMute,\n  currentTime,\n  duration,\n  disabled = false,\n  size = 'md',\n  showVolumeSlider = true,\n  className,\n}: AudioControlsProps) {\n  const [isVolumeHovered, setIsVolumeHovered] = useState(false);\n\n  const sizeConfig = {\n    sm: { icon: 'w-3.5 h-3.5', playIcon: 'w-4 h-4', playBtn: 'w-8 h-8', btn: 'w-6 h-6 p-1' },\n    md: { icon: 'w-4 h-4', playIcon: 'w-5 h-5', playBtn: 'w-10 h-10', btn: 'w-8 h-8 p-1.5' },\n    lg: { icon: 'w-5 h-5', playIcon: 'w-6 h-6', playBtn: 'w-12 h-12', btn: 'w-10 h-10 p-2' },\n  };\n\n  const config = sizeConfig[size];\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const VolumeIcon = isMuted || volume === 0 ? VolumeX : volume < 0.5 ? Volume1 : Volume2;\n\n  return (\n    <div className={cn('flex items-center gap-3', className)}>\n      {/* Transport Controls */}\n      <div className=\"flex items-center gap-1\">\n        {/* Skip Back */}\n        <motion.button\n          onClick={onSkipBack}\n          disabled={disabled}\n          className={cn(\n            'rounded-lg flex items-center justify-center',\n            'text-muted-foreground hover:text-foreground',\n            'hover:bg-accent/50 active:bg-accent',\n            'transition-colors duration-150',\n            'disabled:opacity-40 disabled:cursor-not-allowed',\n            config.btn\n          )}\n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.95 }}\n        >\n          <SkipBack className={config.icon} />\n        </motion.button>\n\n        {/* Play/Pause */}\n        <motion.button\n          onClick={onPlayPause}\n          disabled={disabled}\n          className={cn(\n            'rounded-full flex items-center justify-center',\n            'bg-primary text-primary-foreground',\n            'hover:bg-primary/90 active:bg-primary/80',\n            'disabled:opacity-40 disabled:cursor-not-allowed',\n            'shadow-lg shadow-primary/20',\n            'transition-all duration-200',\n            config.playBtn\n          )}\n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.92 }}\n          animate={{\n            boxShadow: isPlaying\n              ? ['0 4px 12px rgba(139, 92, 246, 0.3)', '0 4px 20px rgba(139, 92, 246, 0.5)', '0 4px 12px rgba(139, 92, 246, 0.3)']\n              : '0 4px 12px rgba(139, 92, 246, 0.3)',\n          }}\n          transition={{\n            boxShadow: {\n              duration: 1.5,\n              repeat: isPlaying ? Infinity : 0,\n              ease: 'easeInOut',\n            },\n          }}\n        >\n          <AnimatePresence mode=\"wait\">\n            <motion.div\n              key={isPlaying ? 'pause' : 'play'}\n              initial={{ scale: 0.5, opacity: 0 }}\n              animate={{ scale: 1, opacity: 1 }}\n              exit={{ scale: 0.5, opacity: 0 }}\n              transition={springs.snappy}\n            >\n              {isPlaying ? (\n                <Pause className={config.playIcon} />\n              ) : (\n                <Play className={cn(config.playIcon, 'ml-0.5')} />\n              )}\n            </motion.div>\n          </AnimatePresence>\n        </motion.button>\n\n        {/* Skip Forward */}\n        <motion.button\n          onClick={onSkipForward}\n          disabled={disabled}\n          className={cn(\n            'rounded-lg flex items-center justify-center',\n            'text-muted-foreground hover:text-foreground',\n            'hover:bg-accent/50 active:bg-accent',\n            'transition-colors duration-150',\n            'disabled:opacity-40 disabled:cursor-not-allowed',\n            config.btn\n          )}\n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.95 }}\n        >\n          <SkipForward className={config.icon} />\n        </motion.button>\n      </div>\n\n      {/* Volume Control */}\n      <div\n        className=\"relative flex items-center gap-1.5\"\n        onMouseEnter={() => setIsVolumeHovered(true)}\n        onMouseLeave={() => setIsVolumeHovered(false)}\n      >\n        <motion.button\n          onClick={onToggleMute}\n          className={cn(\n            'rounded-lg flex items-center justify-center',\n            'text-muted-foreground hover:text-foreground',\n            'hover:bg-accent/50 active:bg-accent',\n            'transition-colors duration-150',\n            config.btn\n          )}\n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.95 }}\n        >\n          <VolumeIcon className={config.icon} />\n        </motion.button>\n\n        {/* Volume Slider */}\n        <AnimatePresence>\n          {(showVolumeSlider || isVolumeHovered) && (\n            <motion.div\n              className=\"flex items-center\"\n              initial={{ width: 0, opacity: 0 }}\n              animate={{ width: 80, opacity: 1 }}\n              exit={{ width: 0, opacity: 0 }}\n              transition={springs.snappy}\n            >\n              <div className=\"relative w-20 h-1.5 bg-muted rounded-full overflow-hidden\">\n                {/* Volume Fill */}\n                <motion.div\n                  className=\"absolute inset-y-0 left-0 bg-primary rounded-full\"\n                  style={{ width: `${(isMuted ? 0 : volume) * 100}%` }}\n                  layout\n                  transition={springs.snappy}\n                />\n\n                {/* Slider Input */}\n                <input\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"1\"\n                  step=\"0.05\"\n                  value={isMuted ? 0 : volume}\n                  onChange={(e) => onVolumeChange(parseFloat(e.target.value))}\n                  className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer\"\n                />\n\n                {/* Volume Thumb */}\n                <motion.div\n                  className=\"absolute top-1/2 -translate-y-1/2 w-3 h-3 rounded-full bg-primary shadow-md\"\n                  style={{ left: `calc(${(isMuted ? 0 : volume) * 100}% - 6px)` }}\n                  whileHover={{ scale: 1.2 }}\n                  transition={springs.snappy}\n                />\n              </div>\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </div>\n\n      {/* Time Display */}\n      <div className=\"flex items-center gap-1 text-xs font-mono text-muted-foreground ml-auto\">\n        <span className=\"tabular-nums\">{formatTime(currentTime)}</span>\n        <span className=\"text-foreground/30\">/</span>\n        <span className=\"tabular-nums opacity-70\">{formatTime(duration)}</span>\n      </div>\n    </div>\n  );\n}\n\nexport default AudioControls;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4988, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/design-canvas/nodes/waveform/BeatLegend.tsx"],"sourcesContent":["'use client';\n\nimport { motion } from 'framer-motion';\nimport { cn } from '@/lib/utils';\nimport type { Beat } from '../AudioBeatSyncNode';\n\ninterface BeatLegendProps {\n  beats: Beat[];\n  showCounts?: boolean;\n  className?: string;\n}\n\nconst BEAT_CONFIG = {\n  kick: {\n    color: 'bg-red-500',\n    label: 'Kick',\n    ring: 'ring-red-500/30',\n  },\n  snare: {\n    color: 'bg-blue-500',\n    label: 'Snare',\n    ring: 'ring-blue-500/30',\n  },\n  hihat: {\n    color: 'bg-yellow-500',\n    label: 'Hi-hat',\n    ring: 'ring-yellow-500/30',\n  },\n  crash: {\n    color: 'bg-pink-500',\n    label: 'Crash',\n    ring: 'ring-pink-500/30',\n  },\n  other: {\n    color: 'bg-gray-400',\n    label: 'Other',\n    ring: 'ring-gray-400/30',\n  },\n};\n\nexport function BeatLegend({ beats, showCounts = true, className }: BeatLegendProps) {\n  // Count beats by type\n  const beatCounts = beats.reduce((acc, beat) => {\n    acc[beat.type] = (acc[beat.type] || 0) + 1;\n    return acc;\n  }, {} as Record<string, number>);\n\n  const downbeatCount = beats.filter(b => b.isDownbeat).length;\n\n  return (\n    <div className={cn('flex flex-wrap items-center gap-3 text-[10px]', className)}>\n      {Object.entries(BEAT_CONFIG).map(([type, config]) => {\n        const count = beatCounts[type] || 0;\n        if (count === 0 && showCounts) return null;\n\n        return (\n          <motion.div\n            key={type}\n            className=\"flex items-center gap-1.5\"\n            initial={{ opacity: 0, scale: 0.9 }}\n            animate={{ opacity: 1, scale: 1 }}\n            transition={{ duration: 0.2 }}\n          >\n            <div className={cn('w-2.5 h-2.5 rounded-full ring-2', config.color, config.ring)} />\n            <span className=\"text-muted-foreground\">\n              {config.label}\n              {showCounts && count > 0 && (\n                <span className=\"ml-1 font-mono text-foreground/70\">({count})</span>\n              )}\n            </span>\n          </motion.div>\n        );\n      })}\n\n      {/* Downbeat indicator */}\n      <div className=\"flex items-center gap-1.5 ml-2 pl-2 border-l border-border/50\">\n        <div className=\"w-4 h-0.5 bg-white ring-1 ring-white/40 rounded-full\" />\n        <span className=\"text-muted-foreground\">\n          Downbeat\n          {showCounts && downbeatCount > 0 && (\n            <span className=\"ml-1 font-mono text-foreground/70\">({downbeatCount})</span>\n          )}\n        </span>\n      </div>\n    </div>\n  );\n}\n\nexport default BeatLegend;\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAHA;;;;AAYA,MAAM,cAAc;IAClB,MAAM;QACJ,OAAO;QACP,OAAO;QACP,MAAM;IACR;IACA,OAAO;QACL,OAAO;QACP,OAAO;QACP,MAAM;IACR;IACA,OAAO;QACL,OAAO;QACP,OAAO;QACP,MAAM;IACR;IACA,OAAO;QACL,OAAO;QACP,OAAO;QACP,MAAM;IACR;IACA,OAAO;QACL,OAAO;QACP,OAAO;QACP,MAAM;IACR;AACF;AAEO,SAAS,WAAW,EAAE,KAAK,EAAE,aAAa,IAAI,EAAE,SAAS,EAAmB;IACjF,sBAAsB;IACtB,MAAM,aAAa,MAAM,MAAM,CAAC,CAAC,KAAK;QACpC,GAAG,CAAC,KAAK,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,KAAK,IAAI,CAAC,IAAI,CAAC,IAAI;QACzC,OAAO;IACT,GAAG,CAAC;IAEJ,MAAM,gBAAgB,MAAM,MAAM,CAAC,CAAA,IAAK,EAAE,UAAU,EAAE,MAAM;IAE5D,qBACE,sYAAC;QAAI,WAAW,IAAA,4HAAE,EAAC,iDAAiD;;YACjE,OAAO,OAAO,CAAC,aAAa,GAAG,CAAC,CAAC,CAAC,MAAM,OAAO;gBAC9C,MAAM,QAAQ,UAAU,CAAC,KAAK,IAAI;gBAClC,IAAI,UAAU,KAAK,YAAY,OAAO;gBAEtC,qBACE,sYAAC,mVAAM,CAAC,GAAG;oBAET,WAAU;oBACV,SAAS;wBAAE,SAAS;wBAAG,OAAO;oBAAI;oBAClC,SAAS;wBAAE,SAAS;wBAAG,OAAO;oBAAE;oBAChC,YAAY;wBAAE,UAAU;oBAAI;;sCAE5B,sYAAC;4BAAI,WAAW,IAAA,4HAAE,EAAC,mCAAmC,OAAO,KAAK,EAAE,OAAO,IAAI;;;;;;sCAC/E,sYAAC;4BAAK,WAAU;;gCACb,OAAO,KAAK;gCACZ,cAAc,QAAQ,mBACrB,sYAAC;oCAAK,WAAU;;wCAAoC;wCAAE;wCAAM;;;;;;;;;;;;;;mBAV3D;;;;;YAeX;0BAGA,sYAAC;gBAAI,WAAU;;kCACb,sYAAC;wBAAI,WAAU;;;;;;kCACf,sYAAC;wBAAK,WAAU;;4BAAwB;4BAErC,cAAc,gBAAgB,mBAC7B,sYAAC;gCAAK,WAAU;;oCAAoC;oCAAE;oCAAc;;;;;;;;;;;;;;;;;;;;;;;;;AAMhF;KA9CgB;uCAgDD"}},
    {"offset": {"line": 5147, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/design-canvas/nodes/AudioBeatSyncNode.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useEffect, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Music,\n  AudioWaveform,\n  Zap,\n  Link2,\n  Download,\n  Settings,\n  RefreshCw,\n  Loader2,\n  Sparkles,\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { springs } from '@/components/motion/config';\nimport { PremiumWaveform } from './waveform/PremiumWaveform';\nimport { AudioControls } from './waveform/AudioControls';\nimport { BeatLegend } from './waveform/BeatLegend';\nimport { analyzeBeatsWebAudio } from '@/lib/episode/beat-analyzer';\n\n// Types\nexport interface Beat {\n  timeMs: number;\n  type: 'kick' | 'snare' | 'hihat' | 'crash' | 'other';\n  intensity: number; // 0-1\n  isDownbeat?: boolean;\n  measure?: number;\n  beatInMeasure?: number;\n}\n\nexport interface Section {\n  type: 'intro' | 'verse' | 'chorus' | 'bridge' | 'outro' | 'break' | 'prechorus' | 'solo';\n  startMs: number;\n  endMs: number;\n  label: string;\n  energy: number; // 0-1\n}\n\nexport interface SyncPoint {\n  nodeId: string;\n  nodeName?: string;\n  beatOffset: number;\n  beatCount?: number;\n  animationType: 'pulse' | 'flash' | 'rotate' | 'color' | 'cut' | 'crossfade';\n  intensity?: number;\n}\n\nexport interface AudioBeatSyncContent {\n  audioUrl?: string;\n  audioName?: string;\n  bpm?: number;\n  timeSignature?: string;\n  key?: string;\n  analyzeStatus: 'idle' | 'analyzing' | 'complete' | 'error';\n  beats: Beat[];\n  sections: Section[];\n  syncedNodes: SyncPoint[];\n  waveformData?: number[]; // Normalized 0-1 array\n  energyCurve?: { timeMs: number; energy: number }[];\n}\n\ninterface AudioBeatSyncNodeProps {\n  id: string;\n  content: AudioBeatSyncContent;\n  isSelected: boolean;\n  onContentChange: (content: AudioBeatSyncContent) => void;\n  onSyncNode?: (nodeId: string, config: Partial<SyncPoint>) => void;\n  width?: number;\n  height?: number;\n}\n\nexport function AudioBeatSyncNode({\n  id,\n  content,\n  isSelected,\n  onContentChange,\n  onSyncNode,\n  width = 620,\n  height = 500,\n}: AudioBeatSyncNodeProps) {\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [duration, setDuration] = useState(0);\n  const [volume, setVolume] = useState(0.8);\n  const [isMuted, setIsMuted] = useState(false);\n  const [showSettings, setShowSettings] = useState(false);\n  const [audioBuffer, setAudioBuffer] = useState<AudioBuffer | null>(null);\n\n  const audioRef = useRef<HTMLAudioElement | null>(null);\n  const audioContextRef = useRef<AudioContext | null>(null);\n\n  // Initialize audio and load buffer for analysis\n  useEffect(() => {\n    if (!content.audioUrl) return;\n\n    // Create audio element for playback\n    if (!audioRef.current) {\n      audioRef.current = new Audio(content.audioUrl);\n      audioRef.current.volume = volume;\n\n      audioRef.current.addEventListener('loadedmetadata', () => {\n        setDuration(audioRef.current?.duration || 0);\n      });\n\n      audioRef.current.addEventListener('timeupdate', () => {\n        setCurrentTime(audioRef.current?.currentTime || 0);\n      });\n\n      audioRef.current.addEventListener('ended', () => {\n        setIsPlaying(false);\n      });\n    }\n\n    // Load audio buffer for analysis (separate from playback)\n    const loadBuffer = async () => {\n      try {\n        if (!audioContextRef.current) {\n          audioContextRef.current = new AudioContext();\n        }\n        const response = await fetch(content.audioUrl!);\n        const arrayBuffer = await response.arrayBuffer();\n        const buffer = await audioContextRef.current.decodeAudioData(arrayBuffer);\n        setAudioBuffer(buffer);\n\n        // Generate waveform peaks if not already present\n        if (!content.waveformData?.length) {\n          const peaks = generateWaveformPeaks(buffer, 200);\n          onContentChange({\n            ...content,\n            waveformData: peaks,\n          });\n        }\n      } catch (err) {\n        console.error('Failed to load audio buffer:', err);\n      }\n    };\n\n    loadBuffer();\n\n    return () => {\n      if (audioRef.current) {\n        audioRef.current.pause();\n        audioRef.current = null;\n      }\n    };\n  }, [content.audioUrl]);\n\n  // Update volume when it changes\n  useEffect(() => {\n    if (audioRef.current) {\n      audioRef.current.volume = isMuted ? 0 : volume;\n    }\n  }, [volume, isMuted]);\n\n  // Generate waveform peaks from audio buffer\n  const generateWaveformPeaks = (buffer: AudioBuffer, numPeaks: number): number[] => {\n    const channelData = buffer.getChannelData(0);\n    const samplesPerPeak = Math.floor(channelData.length / numPeaks);\n    const peaks: number[] = [];\n\n    for (let i = 0; i < numPeaks; i++) {\n      let max = 0;\n      const start = i * samplesPerPeak;\n      const end = Math.min(start + samplesPerPeak, channelData.length);\n\n      for (let j = start; j < end; j++) {\n        const abs = Math.abs(channelData[j]);\n        if (abs > max) max = abs;\n      }\n      peaks.push(max);\n    }\n    return peaks;\n  };\n\n  // Playback controls\n  const togglePlayback = useCallback(() => {\n    if (!audioRef.current) return;\n\n    if (isPlaying) {\n      audioRef.current.pause();\n    } else {\n      audioRef.current.play();\n    }\n    setIsPlaying(!isPlaying);\n  }, [isPlaying]);\n\n  const handleSeek = useCallback((timeSeconds: number) => {\n    if (!audioRef.current) return;\n    audioRef.current.currentTime = timeSeconds;\n    setCurrentTime(timeSeconds);\n  }, []);\n\n  const skipBack = useCallback(() => {\n    if (!audioRef.current) return;\n    audioRef.current.currentTime = Math.max(0, audioRef.current.currentTime - 5);\n  }, []);\n\n  const skipForward = useCallback(() => {\n    if (!audioRef.current || !duration) return;\n    audioRef.current.currentTime = Math.min(duration, audioRef.current.currentTime + 5);\n  }, [duration]);\n\n  const toggleMute = useCallback(() => {\n    setIsMuted(!isMuted);\n  }, [isMuted]);\n\n  const handleVolumeChange = useCallback((newVolume: number) => {\n    setVolume(newVolume);\n    if (newVolume > 0 && isMuted) setIsMuted(false);\n  }, [isMuted]);\n\n  // Real beat analysis using Web Audio API\n  const analyzeBeats = useCallback(async () => {\n    if (!audioBuffer) {\n      console.error('No audio buffer available for analysis');\n      return;\n    }\n\n    onContentChange({\n      ...content,\n      analyzeStatus: 'analyzing',\n    });\n\n    try {\n      // Use the real beat analyzer\n      const beatMap = await analyzeBeatsWebAudio(audioBuffer);\n\n      // Generate waveform peaks if not present\n      const waveformData = content.waveformData?.length\n        ? content.waveformData\n        : generateWaveformPeaks(audioBuffer, 200);\n\n      onContentChange({\n        ...content,\n        bpm: beatMap.bpm,\n        timeSignature: beatMap.timeSignature,\n        analyzeStatus: 'complete',\n        beats: beatMap.beats,\n        sections: beatMap.sections,\n        waveformData,\n        energyCurve: beatMap.energyCurve,\n      });\n    } catch (error) {\n      console.error('Beat analysis failed:', error);\n      onContentChange({\n        ...content,\n        analyzeStatus: 'error',\n      });\n    }\n  }, [audioBuffer, content, onContentChange]);\n\n  return (\n    <motion.div\n      className={cn(\n        'relative rounded-2xl overflow-hidden',\n        'bg-gradient-to-br from-background/95 via-background/90 to-muted/50',\n        'backdrop-blur-xl',\n        'border-2 transition-all duration-300',\n        isSelected\n          ? 'border-primary/60 shadow-2xl shadow-primary/20 ring-2 ring-primary/20'\n          : 'border-border/40 shadow-xl'\n      )}\n      style={{ width, height }}\n      initial={{ opacity: 0, scale: 0.95 }}\n      animate={{ opacity: 1, scale: 1 }}\n      transition={springs.smooth}\n    >\n      {/* Header */}\n      <div className=\"flex items-center justify-between px-5 py-3 border-b border-border/30 bg-gradient-to-r from-purple-500/5 via-transparent to-emerald-500/5\">\n        <div className=\"flex items-center gap-3\">\n          <motion.div\n            className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 via-violet-500 to-emerald-500 flex items-center justify-center shadow-lg shadow-purple-500/30\"\n            animate={{\n              boxShadow: isPlaying\n                ? ['0 4px 12px rgba(139, 92, 246, 0.3)', '0 4px 24px rgba(139, 92, 246, 0.5)', '0 4px 12px rgba(139, 92, 246, 0.3)']\n                : '0 4px 12px rgba(139, 92, 246, 0.3)',\n            }}\n            transition={{\n              duration: 1.5,\n              repeat: isPlaying ? Infinity : 0,\n              ease: 'easeInOut',\n            }}\n          >\n            <Music className=\"w-5 h-5 text-white\" />\n          </motion.div>\n          <div>\n            <h3 className=\"font-semibold text-sm flex items-center gap-2\">\n              Beat Sync Engine\n              {content.analyzeStatus === 'complete' && (\n                <Sparkles className=\"w-3.5 h-3.5 text-emerald-500\" />\n              )}\n            </h3>\n            <p className=\"text-xs text-muted-foreground truncate max-w-[200px]\">\n              {content.audioName || 'Drop audio to analyze'}\n            </p>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          {/* Stats badges */}\n          {content.bpm && (\n            <motion.div\n              className=\"px-2.5 py-1 rounded-full bg-purple-500/15 border border-purple-500/30 text-xs font-mono font-bold text-purple-400\"\n              initial={{ scale: 0 }}\n              animate={{ scale: 1 }}\n              transition={springs.bouncy}\n            >\n              {Math.round(content.bpm)} BPM\n            </motion.div>\n          )}\n          {content.timeSignature && (\n            <motion.div\n              className=\"px-2.5 py-1 rounded-full bg-emerald-500/15 border border-emerald-500/30 text-xs font-mono font-bold text-emerald-400\"\n              initial={{ scale: 0 }}\n              animate={{ scale: 1 }}\n              transition={{ ...springs.bouncy, delay: 0.1 }}\n            >\n              {content.timeSignature}\n            </motion.div>\n          )}\n          <button\n            onClick={() => setShowSettings(!showSettings)}\n            className=\"p-2 rounded-lg hover:bg-accent/50 transition-colors\"\n          >\n            <Settings className=\"w-4 h-4\" />\n          </button>\n        </div>\n      </div>\n\n      {/* Premium Waveform */}\n      <div className=\"px-5 py-4\">\n        {content.waveformData?.length ? (\n          <PremiumWaveform\n            waveformData={content.waveformData}\n            beats={content.beats}\n            sections={content.sections}\n            currentTime={currentTime}\n            duration={duration}\n            isPlaying={isPlaying}\n            onSeek={handleSeek}\n            width={width - 40}\n            height={140}\n            showBeats={content.analyzeStatus === 'complete'}\n            showSections={content.analyzeStatus === 'complete'}\n          />\n        ) : (\n          <div\n            className=\"flex items-center justify-center rounded-xl bg-muted/30 border border-dashed border-border/50\"\n            style={{ width: width - 40, height: 140 }}\n          >\n            <div className=\"text-center text-muted-foreground\">\n              <AudioWaveform className=\"w-8 h-8 mx-auto mb-2 opacity-40\" />\n              <p className=\"text-xs\">Load audio to visualize waveform</p>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Playback Controls */}\n      <div className=\"px-5 pb-3\">\n        <AudioControls\n          isPlaying={isPlaying}\n          onPlayPause={togglePlayback}\n          onSkipBack={skipBack}\n          onSkipForward={skipForward}\n          volume={volume}\n          onVolumeChange={handleVolumeChange}\n          isMuted={isMuted}\n          onToggleMute={toggleMute}\n          currentTime={currentTime}\n          duration={duration}\n          disabled={!content.audioUrl}\n          size=\"md\"\n        />\n      </div>\n\n      {/* Synced Nodes */}\n      <AnimatePresence>\n        {content.syncedNodes.length > 0 && (\n          <motion.div\n            className=\"px-5 py-3 border-t border-border/20\"\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={springs.smooth}\n          >\n            <p className=\"text-xs font-medium text-muted-foreground mb-2 flex items-center gap-1.5\">\n              <Link2 className=\"w-3.5 h-3.5\" />\n              Synced Nodes ({content.syncedNodes.length})\n            </p>\n            <div className=\"space-y-1.5\">\n              {content.syncedNodes.map((sync, i) => (\n                <motion.div\n                  key={i}\n                  className=\"flex items-center justify-between text-xs px-3 py-2 rounded-lg bg-accent/30 border border-border/30\"\n                  initial={{ opacity: 0, x: -10 }}\n                  animate={{ opacity: 1, x: 0 }}\n                  transition={{ delay: i * 0.05 }}\n                >\n                  <span className=\"font-medium\">{sync.nodeName || sync.nodeId}</span>\n                  <span className=\"text-muted-foreground font-mono\">\n                    Beat {sync.beatOffset} • {sync.animationType}\n                  </span>\n                </motion.div>\n              ))}\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Action Buttons */}\n      <div className=\"px-5 py-3 border-t border-border/20 bg-muted/10 flex gap-2\">\n        <motion.button\n          onClick={analyzeBeats}\n          disabled={content.analyzeStatus === 'analyzing' || !audioBuffer}\n          className={cn(\n            'flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold',\n            'bg-gradient-to-r from-purple-500 to-emerald-500 text-white',\n            'hover:from-purple-600 hover:to-emerald-600',\n            'shadow-lg shadow-purple-500/20',\n            'transition-all duration-200',\n            'disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none'\n          )}\n          whileHover={{ scale: 1.02 }}\n          whileTap={{ scale: 0.98 }}\n        >\n          {content.analyzeStatus === 'analyzing' ? (\n            <>\n              <Loader2 className=\"w-4 h-4 animate-spin\" />\n              Analyzing Beats...\n            </>\n          ) : content.analyzeStatus === 'complete' ? (\n            <>\n              <RefreshCw className=\"w-4 h-4\" />\n              Re-analyze\n            </>\n          ) : (\n            <>\n              <AudioWaveform className=\"w-4 h-4\" />\n              Analyze Beats\n            </>\n          )}\n        </motion.button>\n\n        <motion.button\n          onClick={() => onSyncNode?.(id, {})}\n          disabled={content.beats.length === 0}\n          className={cn(\n            'flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-sm font-medium',\n            'border-2 border-border/50 hover:border-primary/50 hover:bg-primary/5',\n            'transition-all duration-200',\n            'disabled:opacity-40 disabled:cursor-not-allowed'\n          )}\n          whileHover={{ scale: 1.02 }}\n          whileTap={{ scale: 0.98 }}\n        >\n          <Zap className=\"w-4 h-4\" />\n          Sync\n        </motion.button>\n\n        <motion.button\n          disabled={content.beats.length === 0}\n          className={cn(\n            'flex items-center justify-center px-3 py-2.5 rounded-xl',\n            'border-2 border-border/50 hover:border-border hover:bg-accent/30',\n            'transition-all duration-200',\n            'disabled:opacity-40 disabled:cursor-not-allowed'\n          )}\n          whileHover={{ scale: 1.02 }}\n          whileTap={{ scale: 0.98 }}\n        >\n          <Download className=\"w-4 h-4\" />\n        </motion.button>\n      </div>\n\n      {/* Beat Legend */}\n      <div className=\"px-5 py-3 border-t border-border/20 bg-background/50\">\n        <BeatLegend beats={content.beats} showCounts={content.analyzeStatus === 'complete'} />\n      </div>\n    </motion.div>\n  );\n}\n\n// Factory function\nexport function createAudioBeatSyncContent(\n  audioUrl?: string,\n  audioName?: string\n): AudioBeatSyncContent {\n  return {\n    audioUrl,\n    audioName,\n    analyzeStatus: 'idle',\n    beats: [],\n    sections: [],\n    syncedNodes: [],\n  };\n}\n\nexport default AudioBeatSyncNode;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5854, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/design-canvas/InfiniteCanvas.tsx"],"sourcesContent":["\"use client\";\n\nimport { useRef, useState, useCallback, useEffect, MouseEvent, WheelEvent, TouchEvent, useMemo } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { cn } from \"@/lib/utils\";\nimport { Mic, MicOff, Sparkles, Play, Pause, Volume2, Image, Video, Music, GitBranch, Trash2, Palette, Plus, Edit3, Copy, ChevronRight, ChevronLeft, ChevronUp, ChevronDown, Scissors, Clipboard, Lock, Unlock, ArrowUpToLine, ArrowDownToLine, MoreHorizontal, RefreshCw, Link, Maximize2 } from \"lucide-react\";\nimport { NODE_COLORS, NodeColor } from \"@/lib/canvas/grid-system\";\nimport { DeviceFrame } from \"./nodes/DeviceFrame\";\nimport { FlowNode, ArchNode } from \"./nodes/FlowNodes\";\nimport { VideoNode, type VideoCompositionData } from \"./nodes/VideoNode\";\nimport { TalkingVideoNode } from \"./nodes/TalkingVideoNode\";\nimport type { TalkingVideoStatus, SceneStyle } from \"@/lib/talking-video/types\";\nimport { ContextReferenceInput } from \"@/components/ui/ContextReferenceInput\";\nimport { ContextMenu, type ContextMenuPosition } from \"./ContextMenu\";\nimport { FormattingToolbar, type TextFormatting } from \"./FormattingToolbar\";\nimport { AudioBeatSyncNode, createAudioBeatSyncContent, type AudioBeatSyncContent } from \"./nodes/AudioBeatSyncNode\";\n\nexport interface CanvasNode {\n  id: string;\n  type: string;\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  content: string;\n  style?: Record<string, unknown>;\n  mediaUrl?: string;\n  mediaType?: \"image\" | \"audio\" | \"video\";\n  locked?: boolean;\n}\n\nexport interface CanvasEdge {\n  id: string;\n  source: string;\n  target: string;\n  type: string;\n}\n\nexport interface CanvasData {\n  nodes: CanvasNode[];\n  edges: CanvasEdge[];\n  viewport: { x: number; y: number; zoom: number };\n}\n\ninterface InfiniteCanvasProps {\n  data: CanvasData;\n  onChange: (data: CanvasData) => void;\n  selectedTool: string;\n  onToolChange?: (tool: string) => void;\n  gridEnabled?: boolean;\n  gridSize?: number;\n  backgroundColor?: string;\n  onVoicePrompt?: (transcript: string) => void;\n}\n\n// Keyboard shortcut mappings (matching FloatingToolDock)\nconst TOOL_SHORTCUTS: Record<string, string> = {\n  v: \"select\",\n  h: \"pan\",\n  p: \"pen\",\n  l: \"connector\",\n  r: \"rectangle\",\n  o: \"ellipse\",\n  t: \"text\",\n  s: \"sticky\",\n  i: \"image\",\n  k: \"lock\",\n  e: \"eraser\",\n  // Legacy shortcuts from previous toolbar\n  m: \"mindmap\",\n  d: \"diagram\",\n  u: \"audio\",\n  w: \"video\",\n  c: \"code\",\n  g: \"ai\",\n};\n\nexport function InfiniteCanvas({\n  data,\n  onChange,\n  selectedTool,\n  onToolChange,\n  gridEnabled = true,\n  gridSize = 20,\n  backgroundColor,\n}: InfiniteCanvasProps) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [isPanning, setIsPanning] = useState(false);\n  const [panStart, setPanStart] = useState({ x: 0, y: 0 });\n  const [selectedNodeId, setSelectedNodeId] = useState<string | null>(null);\n  const [isDraggingNode, setIsDraggingNode] = useState(false);\n  const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n\n  // Touch state for pinch-zoom\n  const [touchState, setTouchState] = useState<{\n    initialDistance: number;\n    initialZoom: number;\n    initialCenter: { x: number; y: number };\n  } | null>(null);\n  const lastTouchRef = useRef<{ x: number; y: number } | null>(null);\n\n  // Double-tap detection for mobile\n  const lastTapRef = useRef<{ time: number; x: number; y: number } | null>(null);\n  const DOUBLE_TAP_DELAY = 300; // ms\n\n  // File upload state\n  const [isUploading, setIsUploading] = useState(false);\n  const [isDragOver, setIsDragOver] = useState(false);\n\n  // Context menu state\n  const [contextMenu, setContextMenu] = useState<ContextMenuPosition | null>(null);\n\n  // Formatting toolbar state (for text editing)\n  const [textFormatting, setTextFormatting] = useState<TextFormatting>({});\n  const [showFormattingToolbar, setShowFormattingToolbar] = useState(false);\n  const [formattingToolbarPosition, setFormattingToolbarPosition] = useState({ x: 0, y: 0 });\n\n  // Transform mouse/touch position to canvas coordinates\n  const toCanvasCoords = useCallback((clientX: number, clientY: number) => {\n    const container = containerRef.current;\n    if (!container) return { x: 0, y: 0 };\n\n    const rect = container.getBoundingClientRect();\n    const x = (clientX - rect.left - data.viewport.x) / data.viewport.zoom;\n    const y = (clientY - rect.top - data.viewport.y) / data.viewport.zoom;\n    return { x, y };\n  }, [data.viewport]);\n\n  // Add node at position\n  const addNodeAtPosition = useCallback((x: number, y: number, type: string = \"text\") => {\n    const nodeConfigs: Record<string, Partial<CanvasNode>> = {\n      text: { type: \"text\", width: 200, height: 40, content: \"Click to edit\" },\n      sticky: { type: \"sticky\", width: 180, height: 140, content: \"New note\", style: { fill: \"#fef08a\" } },\n      mindmap: { type: \"mindmap\", width: 160, height: 60, content: \"New idea\", style: { fill: \"#c4b5fd\" } },\n      shape: { type: \"shape\", width: 100, height: 100, content: \"rectangle\", style: { fill: \"#3b82f6\", stroke: \"#1d4ed8\" } },\n      image: { type: \"ai_generation\", width: 200, height: 200, content: \"Tap to generate with AI\" },\n      ai: { type: \"ai_generation\", width: 200, height: 200, content: \"AI Generation\" },\n      audio: { type: \"audio\", width: 280, height: 80, content: \"Audio node\" },\n      \"audio-beat-sync\": { type: \"audio-beat-sync\", width: 620, height: 500, content: JSON.stringify(createAudioBeatSyncContent()) },\n      video: { type: \"video\", width: 320, height: 180, content: \"Video node\" },\n      multimodal: { type: \"multimodal\", width: 280, height: 200, content: \"Multi-modal node\" },\n      code: { type: \"code\", width: 300, height: 200, content: \"// Code here\" },\n      // Flow nodes\n      \"flow-start\": { type: \"flow-start\", width: 120, height: 50, content: \"Start\" },\n      \"flow-end\": { type: \"flow-end\", width: 120, height: 50, content: \"End\" },\n      \"flow-process\": { type: \"flow-process\", width: 160, height: 80, content: \"Process\" },\n      \"flow-decision\": { type: \"flow-decision\", width: 120, height: 120, content: \"Decision?\" },\n      // Architecture nodes\n      \"arch-service\": { type: \"arch-service\", width: 140, height: 80, content: \"Service\" },\n      \"arch-database\": { type: \"arch-database\", width: 100, height: 120, content: \"Database\" },\n      // Device frame\n      \"device-frame\": { type: \"device-frame\", width: 375, height: 812, content: \"iPhone 14 Pro\" },\n    };\n\n    const config = nodeConfigs[type] || nodeConfigs.text;\n    const newNode: CanvasNode = {\n      id: `node-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      x: x - (config.width || 200) / 2,\n      y: y - (config.height || 40) / 2,\n      ...config,\n    } as CanvasNode;\n\n    console.log(\"Adding node:\", newNode);\n\n    onChange({\n      ...data,\n      nodes: [...data.nodes, newNode],\n    });\n\n    setSelectedNodeId(newNode.id);\n    return newNode.id;\n  }, [data, onChange]);\n\n  // Upload file to Vercel Blob and create node\n  const uploadFileAndCreateNode = useCallback(async (\n    file: File,\n    x: number,\n    y: number\n  ) => {\n    setIsUploading(true);\n    try {\n      const formData = new FormData();\n      formData.append(\"file\", file);\n\n      const response = await fetch(\"/api/canvas/upload\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        console.error(\"Upload failed:\", error);\n        return;\n      }\n\n      const result = await response.json();\n      const { url, mediaType } = result;\n\n      // Determine node type and dimensions based on media type\n      const nodeConfig: Partial<CanvasNode> = mediaType === \"image\"\n        ? { type: \"image\", width: 300, height: 200, content: file.name }\n        : mediaType === \"audio\"\n        ? { type: \"audio\", width: 300, height: 100, content: file.name }\n        : { type: \"video\", width: 400, height: 225, content: file.name };\n\n      const newNode: CanvasNode = {\n        id: `node-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n        x: x - (nodeConfig.width || 200) / 2,\n        y: y - (nodeConfig.height || 200) / 2,\n        mediaUrl: url,\n        mediaType,\n        ...nodeConfig,\n      } as CanvasNode;\n\n      onChange({\n        ...data,\n        nodes: [...data.nodes, newNode],\n      });\n\n      setSelectedNodeId(newNode.id);\n    } catch (error) {\n      console.error(\"File upload error:\", error);\n    } finally {\n      setIsUploading(false);\n    }\n  }, [data, onChange]);\n\n  // Handle drag over for file drop\n  const handleDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.dataTransfer.types.includes(\"Files\")) {\n      setIsDragOver(true);\n    }\n  }, []);\n\n  // Handle drag leave\n  const handleDragLeave = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(false);\n  }, []);\n\n  // Handle file drop onto canvas\n  const handleDrop = useCallback(async (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(false);\n\n    const files = Array.from(e.dataTransfer.files);\n    if (files.length === 0) return;\n\n    const canvasCoords = toCanvasCoords(e.clientX, e.clientY);\n\n    // Process each file\n    for (let i = 0; i < files.length; i++) {\n      const file = files[i];\n      const offsetX = i * 20; // Stagger multiple files\n      const offsetY = i * 20;\n      await uploadFileAndCreateNode(file, canvasCoords.x + offsetX, canvasCoords.y + offsetY);\n    }\n  }, [toCanvasCoords, uploadFileAndCreateNode]);\n\n  // Handle paste event for images and text\n  useEffect(() => {\n    const handlePaste = async (e: ClipboardEvent) => {\n      // Don't handle paste if we're in an input field\n      if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) {\n        return;\n      }\n\n      const items = Array.from(e.clipboardData?.items || []);\n      const container = containerRef.current;\n      if (!container) return;\n\n      // Get center of viewport for paste position\n      const rect = container.getBoundingClientRect();\n      const centerX = rect.width / 2;\n      const centerY = rect.height / 2;\n      const canvasCoords = toCanvasCoords(rect.left + centerX, rect.top + centerY);\n\n      // Check for image data first\n      const imageItem = items.find(item => item.type.startsWith(\"image/\"));\n      if (imageItem) {\n        e.preventDefault();\n        const file = imageItem.getAsFile();\n        if (file) {\n          await uploadFileAndCreateNode(file, canvasCoords.x, canvasCoords.y);\n        }\n        return;\n      }\n\n      // Check for text data - create sticky note\n      const textItem = items.find(item => item.type === \"text/plain\");\n      if (textItem) {\n        textItem.getAsString((text) => {\n          if (text && text.trim()) {\n            e.preventDefault();\n            // Create sticky note with pasted text\n            const newNode: CanvasNode = {\n              id: `node-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n              type: \"sticky\",\n              x: canvasCoords.x - 90,\n              y: canvasCoords.y - 70,\n              width: 180,\n              height: Math.min(140 + Math.floor(text.length / 50) * 20, 300),\n              content: text.trim().substring(0, 500), // Limit text length\n              style: { fill: \"#fef08a\" },\n            };\n\n            onChange({\n              ...data,\n              nodes: [...data.nodes, newNode],\n            });\n\n            setSelectedNodeId(newNode.id);\n          }\n        });\n      }\n    };\n\n    window.addEventListener(\"paste\", handlePaste);\n    return () => window.removeEventListener(\"paste\", handlePaste);\n  }, [data, onChange, toCanvasCoords, uploadFileAndCreateNode]);\n\n  // Calculate distance between two touch points\n  const getTouchDistance = (touches: React.TouchList) => {\n    if (touches.length < 2) return 0;\n    const dx = touches[0].clientX - touches[1].clientX;\n    const dy = touches[0].clientY - touches[1].clientY;\n    return Math.sqrt(dx * dx + dy * dy);\n  };\n\n  // Get center point of two touches\n  const getTouchCenter = (touches: React.TouchList) => {\n    if (touches.length < 2) return { x: touches[0].clientX, y: touches[0].clientY };\n    return {\n      x: (touches[0].clientX + touches[1].clientX) / 2,\n      y: (touches[0].clientY + touches[1].clientY) / 2,\n    };\n  };\n\n  // Handle touch start with double-tap detection\n  const handleTouchStart = useCallback((e: TouchEvent) => {\n    if (e.touches.length === 2) {\n      e.preventDefault();\n      const distance = getTouchDistance(e.touches);\n      const center = getTouchCenter(e.touches);\n      setTouchState({\n        initialDistance: distance,\n        initialZoom: data.viewport.zoom,\n        initialCenter: center,\n      });\n      lastTapRef.current = null; // Reset double-tap on multi-touch\n    } else if (e.touches.length === 1) {\n      const touch = e.touches[0];\n      const now = Date.now();\n\n      // Check for double-tap\n      if (lastTapRef.current) {\n        const timeSinceLastTap = now - lastTapRef.current.time;\n        const distance = Math.sqrt(\n          Math.pow(touch.clientX - lastTapRef.current.x, 2) +\n          Math.pow(touch.clientY - lastTapRef.current.y, 2)\n        );\n\n        // Double-tap detected (within time and distance threshold)\n        if (timeSinceLastTap < DOUBLE_TAP_DELAY && distance < 50) {\n          e.preventDefault();\n          const target = e.target as HTMLElement;\n          if (!target.closest('[data-node-id]')) {\n            const canvasCoords = toCanvasCoords(touch.clientX, touch.clientY);\n            addNodeAtPosition(canvasCoords.x, canvasCoords.y, \"sticky\");\n          }\n          lastTapRef.current = null;\n          return;\n        }\n      }\n\n      // Record this tap for potential double-tap\n      lastTapRef.current = { time: now, x: touch.clientX, y: touch.clientY };\n\n      lastTouchRef.current = { x: touch.clientX, y: touch.clientY };\n      setPanStart({ x: touch.clientX - data.viewport.x, y: touch.clientY - data.viewport.y });\n      setIsPanning(true);\n    }\n  }, [data.viewport, toCanvasCoords, addNodeAtPosition]);\n\n  // Handle touch move\n  const handleTouchMove = useCallback((e: TouchEvent) => {\n    if (e.touches.length === 2 && touchState) {\n      e.preventDefault();\n      const distance = getTouchDistance(e.touches);\n      const scale = distance / touchState.initialDistance;\n      // Higher minimum zoom (0.25) to prevent content disappearing\n      const newZoom = Math.min(Math.max(touchState.initialZoom * scale, 0.25), 4);\n\n      const container = containerRef.current;\n      if (!container) return;\n\n      const rect = container.getBoundingClientRect();\n      const center = getTouchCenter(e.touches);\n      const centerX = center.x - rect.left;\n      const centerY = center.y - rect.top;\n\n      const zoomRatio = newZoom / data.viewport.zoom;\n      let newX = centerX - (centerX - data.viewport.x) * zoomRatio;\n      let newY = centerY - (centerY - data.viewport.y) * zoomRatio;\n\n      // Clamp viewport to keep content in view\n      const maxDrift = Math.max(rect.width, rect.height) * (2 / newZoom);\n      newX = Math.max(-maxDrift, Math.min(maxDrift, newX));\n      newY = Math.max(-maxDrift, Math.min(maxDrift, newY));\n\n      onChange({\n        ...data,\n        viewport: { x: newX, y: newY, zoom: newZoom },\n      });\n    } else if (e.touches.length === 1 && isPanning) {\n      const touch = e.touches[0];\n      onChange({\n        ...data,\n        viewport: {\n          ...data.viewport,\n          x: touch.clientX - panStart.x,\n          y: touch.clientY - panStart.y,\n        },\n      });\n      lastTouchRef.current = { x: touch.clientX, y: touch.clientY };\n    }\n  }, [touchState, isPanning, panStart, data, onChange]);\n\n  // Handle touch end\n  const handleTouchEnd = useCallback((e: TouchEvent) => {\n    if (e.touches.length === 0) {\n      setTouchState(null);\n      setIsPanning(false);\n      lastTouchRef.current = null;\n    } else if (e.touches.length === 1) {\n      setTouchState(null);\n      const touch = e.touches[0];\n      lastTouchRef.current = { x: touch.clientX, y: touch.clientY };\n      setPanStart({ x: touch.clientX - data.viewport.x, y: touch.clientY - data.viewport.y });\n    }\n  }, [data.viewport]);\n\n  // Handle mouse wheel for zoom - smooth and centered\n  const handleWheel = useCallback((e: WheelEvent) => {\n    e.preventDefault();\n\n    const container = containerRef.current;\n    if (!container) return;\n\n    const rect = container.getBoundingClientRect();\n\n    // Use center of viewport for zoom anchor (more stable)\n    const centerX = rect.width / 2;\n    const centerY = rect.height / 2;\n\n    // Much more gradual zoom (3% per tick instead of 10%)\n    const zoomFactor = e.deltaY > 0 ? 0.97 : 1.03;\n    // Higher minimum zoom (0.25) to prevent content from becoming too small\n    const newZoom = Math.min(Math.max(data.viewport.zoom * zoomFactor, 0.25), 4);\n\n    // If zoom didn't change, don't update\n    if (newZoom === data.viewport.zoom) return;\n\n    const zoomRatio = newZoom / data.viewport.zoom;\n    let newX = centerX - (centerX - data.viewport.x) * zoomRatio;\n    let newY = centerY - (centerY - data.viewport.y) * zoomRatio;\n\n    // Clamp viewport to keep content reasonably centered\n    // Prevent drifting too far from origin when zoomed out\n    const maxDrift = Math.max(rect.width, rect.height) * (2 / newZoom);\n    newX = Math.max(-maxDrift, Math.min(maxDrift, newX));\n    newY = Math.max(-maxDrift, Math.min(maxDrift, newY));\n\n    onChange({\n      ...data,\n      viewport: { x: newX, y: newY, zoom: newZoom },\n    });\n  }, [data, onChange]);\n\n  // Handle pan start\n  const handleMouseDown = useCallback((e: MouseEvent) => {\n    // Check if we clicked on a node\n    const target = e.target as HTMLElement;\n    if (target.closest('[data-node-id]')) {\n      return; // Let node handle it\n    }\n\n    if (e.button === 1 || (e.button === 0 && (selectedTool === \"pan\" || e.shiftKey))) {\n      setIsPanning(true);\n      setPanStart({ x: e.clientX - data.viewport.x, y: e.clientY - data.viewport.y });\n      e.preventDefault();\n    } else if (e.button === 0 && selectedTool === \"select\") {\n      setSelectedNodeId(null);\n    }\n  }, [selectedTool, data.viewport]);\n\n  // Handle pan move\n  const handleMouseMove = useCallback((e: MouseEvent) => {\n    if (isPanning) {\n      onChange({\n        ...data,\n        viewport: {\n          ...data.viewport,\n          x: e.clientX - panStart.x,\n          y: e.clientY - panStart.y,\n        },\n      });\n    } else if (isDraggingNode && selectedNodeId) {\n      const canvasCoords = toCanvasCoords(e.clientX, e.clientY);\n      onChange({\n        ...data,\n        nodes: data.nodes.map((node) =>\n          node.id === selectedNodeId\n            ? { ...node, x: canvasCoords.x - dragOffset.x, y: canvasCoords.y - dragOffset.y }\n            : node\n        ),\n      });\n    }\n  }, [isPanning, isDraggingNode, selectedNodeId, data, panStart, onChange, toCanvasCoords, dragOffset]);\n\n  // Handle pan end\n  const handleMouseUp = useCallback(() => {\n    setIsPanning(false);\n    setIsDraggingNode(false);\n  }, []);\n\n  // Handle context menu (right-click)\n  const handleContextMenu = useCallback((e: MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const target = e.target as HTMLElement;\n    const nodeElement = target.closest('[data-node-id]');\n\n    if (nodeElement) {\n      const nodeId = nodeElement.getAttribute('data-node-id');\n      const node = data.nodes.find((n) => n.id === nodeId);\n      if (node && nodeId) {\n        setSelectedNodeId(nodeId);\n        setContextMenu({\n          x: e.clientX,\n          y: e.clientY,\n          type: 'node',\n          nodeId,\n          nodeType: node.type,\n        });\n      }\n    } else {\n      setSelectedNodeId(null);\n      setContextMenu({\n        x: e.clientX,\n        y: e.clientY,\n        type: 'canvas',\n      });\n    }\n  }, [data.nodes]);\n\n  // Close context menu\n  const closeContextMenu = useCallback(() => {\n    setContextMenu(null);\n  }, []);\n\n  // Context menu actions\n  const handleCopyNode = useCallback(async () => {\n    if (!selectedNodeId) return;\n    const node = data.nodes.find((n) => n.id === selectedNodeId);\n    if (node) {\n      try {\n        await navigator.clipboard.writeText(JSON.stringify(node));\n        console.log('[Canvas] Copied node to clipboard:', node.id);\n      } catch (err) {\n        console.error('[Canvas] Failed to copy:', err);\n      }\n    }\n  }, [selectedNodeId, data.nodes]);\n\n  const handleCutNode = useCallback(async () => {\n    if (!selectedNodeId) return;\n    const node = data.nodes.find((n) => n.id === selectedNodeId);\n    if (node) {\n      try {\n        await navigator.clipboard.writeText(JSON.stringify(node));\n        console.log('[Canvas] Cut node to clipboard:', node.id);\n        // Now delete the node\n        onChange({\n          ...data,\n          nodes: data.nodes.filter((n) => n.id !== selectedNodeId),\n          edges: data.edges.filter((e) => e.source !== selectedNodeId && e.target !== selectedNodeId),\n        });\n        setSelectedNodeId(null);\n      } catch (err) {\n        console.error('[Canvas] Failed to cut:', err);\n      }\n    }\n  }, [selectedNodeId, data, onChange]);\n\n  const handleDeleteNode = useCallback(() => {\n    if (!selectedNodeId) return;\n    onChange({\n      ...data,\n      nodes: data.nodes.filter((n) => n.id !== selectedNodeId),\n      edges: data.edges.filter((e) => e.source !== selectedNodeId && e.target !== selectedNodeId),\n    });\n    setSelectedNodeId(null);\n  }, [selectedNodeId, data, onChange]);\n\n  const handleDuplicateNode = useCallback(() => {\n    if (!selectedNodeId) return;\n    const node = data.nodes.find((n) => n.id === selectedNodeId);\n    if (node) {\n      const newNode: CanvasNode = {\n        ...node,\n        id: `node-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n        x: node.x + 20,\n        y: node.y + 20,\n      };\n      onChange({\n        ...data,\n        nodes: [...data.nodes, newNode],\n      });\n      setSelectedNodeId(newNode.id);\n    }\n  }, [selectedNodeId, data, onChange]);\n\n  const handleBringToFront = useCallback(() => {\n    if (!selectedNodeId) return;\n    const nodeIndex = data.nodes.findIndex((n) => n.id === selectedNodeId);\n    if (nodeIndex === -1) return;\n    const node = data.nodes[nodeIndex];\n    const newNodes = [...data.nodes.filter((n) => n.id !== selectedNodeId), node];\n    onChange({ ...data, nodes: newNodes });\n  }, [selectedNodeId, data, onChange]);\n\n  const handleSendToBack = useCallback(() => {\n    if (!selectedNodeId) return;\n    const nodeIndex = data.nodes.findIndex((n) => n.id === selectedNodeId);\n    if (nodeIndex === -1) return;\n    const node = data.nodes[nodeIndex];\n    const newNodes = [node, ...data.nodes.filter((n) => n.id !== selectedNodeId)];\n    onChange({ ...data, nodes: newNodes });\n  }, [selectedNodeId, data, onChange]);\n\n  const handleLockNode = useCallback(() => {\n    if (!selectedNodeId) return;\n    onChange({\n      ...data,\n      nodes: data.nodes.map((n) =>\n        n.id === selectedNodeId ? { ...n, locked: !n.locked } : n\n      ),\n    });\n  }, [selectedNodeId, data, onChange]);\n\n  // Handle node mouse down\n  const handleNodeMouseDown = useCallback((e: MouseEvent, nodeId: string) => {\n    if (selectedTool === \"select\" || selectedTool === \"pan\") {\n      e.stopPropagation();\n      setSelectedNodeId(nodeId);\n\n      const node = data.nodes.find((n) => n.id === nodeId);\n      if (node && selectedTool === \"select\") {\n        const canvasCoords = toCanvasCoords(e.clientX, e.clientY);\n        setDragOffset({ x: canvasCoords.x - node.x, y: canvasCoords.y - node.y });\n        setIsDraggingNode(true);\n      }\n    }\n  }, [selectedTool, data.nodes, toCanvasCoords]);\n\n  // Handle touch on node\n  const handleNodeTouchStart = useCallback((e: TouchEvent<HTMLDivElement>, nodeId: string) => {\n    if (e.touches.length === 1 && selectedTool === \"select\") {\n      e.stopPropagation();\n      setSelectedNodeId(nodeId);\n\n      const touch = e.touches[0];\n      const node = data.nodes.find((n) => n.id === nodeId);\n      if (node) {\n        const canvasCoords = toCanvasCoords(touch.clientX, touch.clientY);\n        setDragOffset({ x: canvasCoords.x - node.x, y: canvasCoords.y - node.y });\n        setIsDraggingNode(true);\n      }\n    }\n  }, [selectedTool, data.nodes, toCanvasCoords]);\n\n  // Handle double click to add nodes\n  const handleDoubleClick = useCallback((e: MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    // Don't add if we double-clicked on a node\n    const target = e.target as HTMLElement;\n    if (target.closest('[data-node-id]')) {\n      return;\n    }\n\n    const canvasCoords = toCanvasCoords(e.clientX, e.clientY);\n\n    const toolToType: Record<string, string> = {\n      select: \"sticky\",  // Default to sticky note on double-click\n      pan: \"sticky\",\n      text: \"text\",\n      sticky: \"sticky\",\n      mindmap: \"mindmap\",\n      shape: \"shape\",\n      rectangle: \"shape\",\n      ellipse: \"shape\",\n      image: \"image\",\n      ai: \"ai\",\n      audio: \"audio\",\n      video: \"video\",\n      code: \"code\",\n      multimodal: \"multimodal\",\n      pen: \"sticky\",  // Pen tool - creates sticky for now (drawing not yet implemented)\n      connector: \"sticky\",  // Connector tool - TODO: implement edge creation\n      eraser: \"sticky\",  // Eraser doesn't create nodes\n    };\n\n    // Don't create nodes for eraser tool\n    if (selectedTool === \"eraser\") return;\n\n    addNodeAtPosition(canvasCoords.x, canvasCoords.y, toolToType[selectedTool] || \"sticky\");\n  }, [selectedTool, toCanvasCoords, addNodeAtPosition]);\n\n  // Handle single click to add with certain tools\n  const handleClick = useCallback((e: MouseEvent) => {\n    const target = e.target as HTMLElement;\n    if (target.closest('[data-node-id]')) {\n      return;\n    }\n\n    // For certain tools, single click should add a node\n    const singleClickTools = [\"sticky\", \"mindmap\", \"shape\", \"rectangle\", \"ellipse\", \"image\", \"ai\", \"audio\", \"video\", \"code\", \"multimodal\", \"text\"];\n    if (singleClickTools.includes(selectedTool)) {\n      const canvasCoords = toCanvasCoords(e.clientX, e.clientY);\n      // Map rectangle/ellipse to shape type\n      const nodeType = (selectedTool === \"rectangle\" || selectedTool === \"ellipse\") ? \"shape\" : selectedTool;\n      addNodeAtPosition(canvasCoords.x, canvasCoords.y, nodeType);\n    }\n  }, [selectedTool, toCanvasCoords, addNodeAtPosition]);\n\n  // Keyboard shortcuts\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Ignore if typing in an input\n      if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) {\n        return;\n      }\n\n      const key = e.key.toLowerCase();\n\n      // Tool shortcuts\n      if (!e.ctrlKey && !e.metaKey && TOOL_SHORTCUTS[key]) {\n        e.preventDefault();\n        onToolChange?.(TOOL_SHORTCUTS[key]);\n        return;\n      }\n\n      // Delete selected node\n      if ((e.key === \"Delete\" || e.key === \"Backspace\") && selectedNodeId) {\n        e.preventDefault();\n        onChange({\n          ...data,\n          nodes: data.nodes.filter((n) => n.id !== selectedNodeId),\n          edges: data.edges.filter(\n            (edge) => edge.source !== selectedNodeId && edge.target !== selectedNodeId\n          ),\n        });\n        setSelectedNodeId(null);\n        return;\n      }\n\n      // Escape to deselect\n      if (e.key === \"Escape\") {\n        setSelectedNodeId(null);\n        return;\n      }\n\n      // Ctrl/Cmd shortcuts\n      if (e.ctrlKey || e.metaKey) {\n        switch (key) {\n          case \"a\":\n            // Select all - select first node for now\n            e.preventDefault();\n            if (data.nodes.length > 0) {\n              setSelectedNodeId(data.nodes[0].id);\n            }\n            break;\n          case \"d\":\n            // Duplicate selected node\n            e.preventDefault();\n            if (selectedNodeId) {\n              const node = data.nodes.find((n) => n.id === selectedNodeId);\n              if (node) {\n                const newNode: CanvasNode = {\n                  ...node,\n                  id: `node-${Date.now()}`,\n                  x: node.x + 20,\n                  y: node.y + 20,\n                };\n                onChange({\n                  ...data,\n                  nodes: [...data.nodes, newNode],\n                });\n                setSelectedNodeId(newNode.id);\n              }\n            }\n            break;\n          case \"0\":\n            // Reset zoom\n            e.preventDefault();\n            onChange({\n              ...data,\n              viewport: { x: 0, y: 0, zoom: 1 },\n            });\n            break;\n          case \"=\":\n          case \"+\":\n            // Zoom in (10% - more gradual)\n            e.preventDefault();\n            onChange({\n              ...data,\n              viewport: { ...data.viewport, zoom: Math.min(data.viewport.zoom * 1.1, 4) },\n            });\n            break;\n          case \"-\":\n            // Zoom out (10% - more gradual, min 0.25)\n            e.preventDefault();\n            onChange({\n              ...data,\n              viewport: { ...data.viewport, zoom: Math.max(data.viewport.zoom / 1.1, 0.25) },\n            });\n            break;\n        }\n      }\n\n      // Space for temporary pan mode\n      if (e.code === \"Space\" && !isPanning) {\n        e.preventDefault();\n        onToolChange?.(\"pan\");\n      }\n    };\n\n    const handleKeyUp = (e: KeyboardEvent) => {\n      // Release space to go back to select\n      if (e.code === \"Space\") {\n        onToolChange?.(\"select\");\n      }\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown);\n    window.addEventListener(\"keyup\", handleKeyUp);\n    return () => {\n      window.removeEventListener(\"keydown\", handleKeyDown);\n      window.removeEventListener(\"keyup\", handleKeyUp);\n    };\n  }, [selectedNodeId, data, onChange, onToolChange, isPanning]);\n\n  // Attach touch and wheel listeners with { passive: false } to allow preventDefault\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container) return;\n\n    // Use native event types and cast to React event types for handlers\n    const wheelHandler = (e: globalThis.WheelEvent) => handleWheel(e as unknown as React.WheelEvent);\n    const touchStartHandler = (e: globalThis.TouchEvent) => handleTouchStart(e as unknown as React.TouchEvent);\n    const touchMoveHandler = (e: globalThis.TouchEvent) => handleTouchMove(e as unknown as React.TouchEvent);\n    const touchEndHandler = (e: globalThis.TouchEvent) => handleTouchEnd(e as unknown as React.TouchEvent);\n\n    container.addEventListener(\"wheel\", wheelHandler, { passive: false });\n    container.addEventListener(\"touchstart\", touchStartHandler, { passive: false });\n    container.addEventListener(\"touchmove\", touchMoveHandler, { passive: false });\n    container.addEventListener(\"touchend\", touchEndHandler, { passive: false });\n\n    return () => {\n      container.removeEventListener(\"wheel\", wheelHandler);\n      container.removeEventListener(\"touchstart\", touchStartHandler);\n      container.removeEventListener(\"touchmove\", touchMoveHandler);\n      container.removeEventListener(\"touchend\", touchEndHandler);\n    };\n  }, [handleWheel, handleTouchStart, handleTouchMove, handleTouchEnd]);\n\n  // Generate grid pattern - subtle dot grid (the dots you know)\n  const gridPattern = gridEnabled ? (\n    <defs>\n      <pattern\n        id=\"grid\"\n        width={gridSize}\n        height={gridSize}\n        patternUnits=\"userSpaceOnUse\"\n      >\n        <circle\n          cx={gridSize / 2}\n          cy={gridSize / 2}\n          r={1}\n          fill=\"rgba(150, 150, 150, 0.5)\"\n        />\n      </pattern>\n    </defs>\n  ) : null;\n\n  return (\n    <div\n      ref={containerRef}\n      className={cn(\n        \"w-full h-full overflow-hidden relative touch-none select-none\",\n        isPanning ? \"cursor-grabbing\" : selectedTool === \"pan\" ? \"cursor-grab\" : \"cursor-crosshair\",\n        isDragOver && \"ring-2 ring-primary ring-inset\"\n      )}\n      onMouseDown={handleMouseDown}\n      onMouseMove={handleMouseMove}\n      onMouseUp={handleMouseUp}\n      onMouseLeave={handleMouseUp}\n      onDoubleClick={handleDoubleClick}\n      onClick={handleClick}\n      onContextMenu={handleContextMenu}\n      onDragOver={handleDragOver}\n      onDragLeave={handleDragLeave}\n      onDrop={handleDrop}\n      style={{ backgroundColor: backgroundColor || \"hsl(var(--background))\" }}\n      tabIndex={0}\n    >\n      {/* Canvas content with transform */}\n      <div\n        className=\"absolute will-change-transform\"\n        style={{\n          transform: `translate(${data.viewport.x}px, ${data.viewport.y}px) scale(${data.viewport.zoom})`,\n          transformOrigin: \"0 0\",\n          transition: isPanning || isDraggingNode ? \"none\" : \"transform 0.1s ease-out\",\n          width: \"10000px\",\n          height: \"10000px\",\n          marginLeft: \"-5000px\",\n          marginTop: \"-5000px\",\n          pointerEvents: \"none\",\n        }}\n      >\n        {/* Grid */}\n        {gridEnabled && (\n          <svg\n            className=\"absolute inset-0 pointer-events-none\"\n            width=\"100%\"\n            height=\"100%\"\n          >\n            {gridPattern}\n            <rect width=\"100%\" height=\"100%\" fill=\"url(#grid)\" />\n          </svg>\n        )}\n\n        {/* Edges */}\n        <svg\n          className=\"absolute inset-0 pointer-events-none\"\n          style={{ overflow: \"visible\" }}\n        >\n          {data.edges.map((edge) => {\n            const sourceNode = data.nodes.find((n) => n.id === edge.source);\n            const targetNode = data.nodes.find((n) => n.id === edge.target);\n            if (!sourceNode || !targetNode) return null;\n\n            const x1 = sourceNode.x + sourceNode.width / 2 + 5000;\n            const y1 = sourceNode.y + sourceNode.height / 2 + 5000;\n            const x2 = targetNode.x + targetNode.width / 2 + 5000;\n            const y2 = targetNode.y + targetNode.height / 2 + 5000;\n\n            return (\n              <line\n                key={edge.id}\n                x1={x1}\n                y1={y1}\n                x2={x2}\n                y2={y2}\n                stroke=\"#6b7280\"\n                strokeWidth={2}\n                markerEnd=\"url(#arrowhead)\"\n              />\n            );\n          })}\n          <defs>\n            <marker\n              id=\"arrowhead\"\n              markerWidth=\"10\"\n              markerHeight=\"7\"\n              refX=\"10\"\n              refY=\"3.5\"\n              orient=\"auto\"\n            >\n              <polygon points=\"0 0, 10 3.5, 0 7\" fill=\"#6b7280\" />\n            </marker>\n          </defs>\n        </svg>\n\n        {/* Nodes - with pointer-events enabled */}\n        <div className=\"absolute inset-0\" style={{ pointerEvents: \"auto\" }}>\n          {data.nodes.map((node) => (\n            <CanvasNodeComponent\n              key={node.id}\n              node={node}\n              isSelected={node.id === selectedNodeId}\n              onMouseDown={(e) => handleNodeMouseDown(e, node.id)}\n              onTouchStart={(e) => handleNodeTouchStart(e, node.id)}\n              onContentChange={(content) => {\n                onChange({\n                  ...data,\n                  nodes: data.nodes.map((n) =>\n                    n.id === node.id ? { ...n, content } : n\n                  ),\n                });\n              }}\n              onMediaChange={(mediaUrl, mediaType) => {\n                onChange({\n                  ...data,\n                  nodes: data.nodes.map((n) =>\n                    n.id === node.id ? { ...n, mediaUrl, mediaType } : n\n                  ),\n                });\n              }}\n            />\n          ))}\n        </div>\n      </div>\n\n      {/* Mobile-friendly info overlay */}\n      <div className=\"absolute bottom-4 left-4 right-4 sm:right-auto px-3 py-2 bg-background/80 backdrop-blur-sm rounded-lg text-xs text-muted-foreground border flex items-center justify-between sm:justify-start gap-4\">\n        <span>{data.nodes.length} nodes</span>\n        <span className=\"hidden sm:inline\">|</span>\n        <span>{Math.round(data.viewport.zoom * 100)}%</span>\n        <span className=\"sm:hidden text-muted-foreground/50\">Pinch to zoom</span>\n      </div>\n\n      {/* Keyboard shortcuts hint */}\n      <div className=\"absolute bottom-4 right-4 hidden md:block px-3 py-2 bg-background/80 backdrop-blur-sm rounded-lg text-xs text-muted-foreground border\">\n        <div className=\"flex gap-3\">\n          <span><kbd className=\"px-1 bg-muted rounded\">V</kbd> Select</span>\n          <span><kbd className=\"px-1 bg-muted rounded\">T</kbd> Text</span>\n          <span><kbd className=\"px-1 bg-muted rounded\">N</kbd> Sticky</span>\n          <span><kbd className=\"px-1 bg-muted rounded\">R</kbd> Shape</span>\n          <span><kbd className=\"px-1 bg-muted rounded\">G</kbd> AI</span>\n          <span><kbd className=\"px-1 bg-muted rounded\">Space</kbd> Pan</span>\n        </div>\n      </div>\n\n      {/* Empty state - mobile optimized */}\n      {data.nodes.length === 0 && (\n        <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none p-4\">\n          <div className=\"text-center text-muted-foreground max-w-xs\">\n            <div className=\"text-4xl mb-4 opacity-20\">+</div>\n            <p className=\"text-base font-medium mb-2\">Start Creating</p>\n            <p className=\"text-sm mb-1\">Double-click or tap to add elements</p>\n            <p className=\"text-sm mb-1\">Scroll to zoom, drag to pan</p>\n            <p className=\"text-sm text-muted-foreground/70\">Press <kbd className=\"px-1 bg-muted rounded\">G</kbd> for AI generation</p>\n          </div>\n        </div>\n      )}\n\n      {/* Floating Node Toolbar - appears above selected node */}\n      <FloatingNodeToolbar\n        node={selectedNodeId ? data.nodes.find(n => n.id === selectedNodeId) : undefined}\n        viewport={data.viewport}\n        containerRef={containerRef}\n        onDelete={() => {\n          if (selectedNodeId) {\n            onChange({\n              ...data,\n              nodes: data.nodes.filter(n => n.id !== selectedNodeId),\n              edges: data.edges.filter(e => e.source !== selectedNodeId && e.target !== selectedNodeId),\n            });\n            setSelectedNodeId(null);\n          }\n        }}\n        onColorChange={(color) => {\n          if (selectedNodeId) {\n            onChange({\n              ...data,\n              nodes: data.nodes.map(n =>\n                n.id === selectedNodeId\n                  ? { ...n, style: { ...n.style, fill: color } }\n                  : n\n              ),\n            });\n          }\n        }}\n        onDuplicate={() => {\n          if (selectedNodeId) {\n            const node = data.nodes.find(n => n.id === selectedNodeId);\n            if (node) {\n              const newNode: CanvasNode = {\n                ...node,\n                id: `node-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n                x: node.x + 30,\n                y: node.y + 30,\n              };\n              onChange({\n                ...data,\n                nodes: [...data.nodes, newNode],\n              });\n              setSelectedNodeId(newNode.id);\n            }\n          }\n        }}\n        onAddBranch={(direction) => {\n          if (selectedNodeId) {\n            const parentNode = data.nodes.find(n => n.id === selectedNodeId);\n            if (parentNode) {\n              // Calculate offset based on direction\n              const offsets: Record<string, { x: number; y: number }> = {\n                right: { x: 200, y: 0 },\n                left: { x: -200, y: 0 },\n                up: { x: 0, y: -120 },\n                down: { x: 0, y: 120 },\n              };\n              const offset = offsets[direction] || offsets.right;\n\n              const newNode: CanvasNode = {\n                id: `node-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n                type: parentNode.type,\n                x: parentNode.x + offset.x,\n                y: parentNode.y + offset.y,\n                width: parentNode.width,\n                height: parentNode.height,\n                content: \"New branch\",\n                style: parentNode.style,\n              };\n\n              const newEdge: CanvasEdge = {\n                id: `edge-${Date.now()}`,\n                source: selectedNodeId,\n                target: newNode.id,\n                type: \"default\",\n              };\n\n              onChange({\n                ...data,\n                nodes: [...data.nodes, newNode],\n                edges: [...data.edges, newEdge],\n              });\n              setSelectedNodeId(newNode.id);\n            }\n          }\n        }}\n        onEditContent={(nodeId) => {\n          // Trigger edit mode for the node - this simulates a double-click\n          const nodeEl = document.querySelector(`[data-node-id=\"${nodeId}\"]`);\n          if (nodeEl) {\n            const event = new window.MouseEvent('dblclick', { bubbles: true });\n            nodeEl.dispatchEvent(event);\n          }\n        }}\n        onReplaceMedia={(nodeId) => {\n          // This is handled by the file input in the toolbar\n          console.log('[Canvas] Replace media for node:', nodeId);\n        }}\n        onCopy={handleCopyNode}\n        onCut={handleCutNode}\n        onLock={handleLockNode}\n        onBringToFront={handleBringToFront}\n        onSendToBack={handleSendToBack}\n        isLocked={selectedNodeId ? data.nodes.find(n => n.id === selectedNodeId)?.locked : false}\n      />\n\n      {/* Drag overlay indicator */}\n      <AnimatePresence>\n        {isDragOver && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"absolute inset-0 bg-primary/10 pointer-events-none flex items-center justify-center z-40\"\n          >\n            <div className=\"bg-background/95 backdrop-blur-sm px-6 py-4 rounded-xl border-2 border-dashed border-primary\">\n              <p className=\"text-lg font-medium text-primary\">Drop files to add to canvas</p>\n              <p className=\"text-sm text-muted-foreground mt-1\">Images, audio, or video</p>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Upload indicator */}\n      <AnimatePresence>\n        {isUploading && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"absolute top-4 left-1/2 -translate-x-1/2 z-50\"\n          >\n            <div className=\"bg-background/95 backdrop-blur-sm px-4 py-2 rounded-lg border shadow-lg flex items-center gap-3\">\n              <div className=\"w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin\" />\n              <span className=\"text-sm\">Uploading...</span>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Context Menu */}\n      <ContextMenu\n        position={contextMenu}\n        onClose={closeContextMenu}\n        onAddNode={(type, x, y) => {\n          const canvasCoords = toCanvasCoords(x, y);\n          addNodeAtPosition(canvasCoords.x, canvasCoords.y, type);\n        }}\n        onCopy={handleCopyNode}\n        onCut={handleCutNode}\n        onPaste={() => {\n          navigator.clipboard.readText().then((text) => {\n            try {\n              const node = JSON.parse(text);\n              if (node && node.type) {\n                const newNode = {\n                  ...node,\n                  id: `node-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n                  x: node.x + 20,\n                  y: node.y + 20,\n                };\n                onChange({\n                  ...data,\n                  nodes: [...data.nodes, newNode],\n                });\n                setSelectedNodeId(newNode.id);\n              }\n            } catch {\n              // Not a valid node JSON\n            }\n          });\n        }}\n        onDelete={handleDeleteNode}\n        onDuplicate={handleDuplicateNode}\n        onEdit={() => {\n          if (selectedNodeId) {\n            const nodeEl = document.querySelector(`[data-node-id=\"${selectedNodeId}\"]`);\n            if (nodeEl) {\n              const event = new window.MouseEvent('dblclick', { bubbles: true });\n              nodeEl.dispatchEvent(event);\n            }\n          }\n        }}\n        onBringToFront={handleBringToFront}\n        onSendToBack={handleSendToBack}\n        onZoomToFit={() => {\n          // Reset zoom to fit all nodes\n          onChange({\n            ...data,\n            viewport: { x: 0, y: 0, zoom: 1 },\n          });\n        }}\n        onCenterView={() => {\n          onChange({\n            ...data,\n            viewport: { ...data.viewport, x: 0, y: 0 },\n          });\n        }}\n        onSelectAll={() => {\n          // Select first node (multi-select not implemented yet)\n          if (data.nodes.length > 0) {\n            setSelectedNodeId(data.nodes[0].id);\n          }\n        }}\n        canRegenerate={\n          selectedNodeId\n            ? data.nodes.find((n) => n.id === selectedNodeId)?.type === 'ai_generation'\n            : false\n        }\n      />\n    </div>\n  );\n}\n\n// ============================================================================\n// Floating Node Toolbar - Appears above selected node\n// ============================================================================\n\ninterface FloatingNodeToolbarProps {\n  node: CanvasNode | undefined;\n  viewport: { x: number; y: number; zoom: number };\n  containerRef: React.RefObject<HTMLDivElement | null>;\n  onDelete: () => void;\n  onColorChange: (color: string) => void;\n  onDuplicate: () => void;\n  onAddBranch: (direction: 'right' | 'left' | 'up' | 'down') => void;\n  onReplaceMedia?: (nodeId: string) => void;\n  onEditContent?: (nodeId: string) => void;\n  onCopy?: () => void;\n  onCut?: () => void;\n  onLock?: () => void;\n  onBringToFront?: () => void;\n  onSendToBack?: () => void;\n  onRegenerate?: () => void;\n  isLocked?: boolean;\n}\n\nfunction FloatingNodeToolbar({\n  node,\n  viewport,\n  containerRef,\n  onDelete,\n  onColorChange,\n  onDuplicate,\n  onAddBranch,\n  onReplaceMedia,\n  onEditContent,\n  onCopy,\n  onCut,\n  onLock,\n  onBringToFront,\n  onSendToBack,\n  onRegenerate,\n  isLocked = false,\n}: FloatingNodeToolbarProps) {\n  const [showColorPicker, setShowColorPicker] = useState(false);\n  const [showBranchPicker, setShowBranchPicker] = useState(false);\n  const [showArrangePicker, setShowArrangePicker] = useState(false);\n  const [showMoreMenu, setShowMoreMenu] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  // Close all menus\n  const closeAllMenus = () => {\n    setShowColorPicker(false);\n    setShowBranchPicker(false);\n    setShowArrangePicker(false);\n    setShowMoreMenu(false);\n  };\n\n  if (!node) return null;\n\n  // Determine which actions to show based on node type\n  const isMediaNode = ['image', 'video', 'audio', 'ai', 'ai_generation'].includes(node.type);\n  const isTextNode = ['text', 'sticky', 'code'].includes(node.type);\n  const isAINode = node.type === 'ai_generation' || node.type === 'ai';\n\n  // Calculate screen position from canvas coordinates\n  const container = containerRef.current;\n  if (!container) return null;\n\n  const rect = container.getBoundingClientRect();\n\n  // Node center in canvas space (with 5000px offset)\n  const nodeCenterX = node.x + 5000 + node.width / 2;\n  const nodeCenterY = node.y + 5000;\n\n  // Transform to screen space\n  const screenX = nodeCenterX * viewport.zoom + viewport.x;\n  const screenY = nodeCenterY * viewport.zoom + viewport.y;\n\n  // Position toolbar above the node with some padding\n  const toolbarY = screenY - 60;\n\n  // Keep toolbar within viewport bounds\n  const clampedX = Math.max(100, Math.min(screenX, rect.width - 100));\n  const clampedY = Math.max(50, toolbarY);\n\n  // Available colors for the color picker\n  const colorOptions = Object.entries(NODE_COLORS).slice(0, 6); // First 6 colors\n\n  // Should we show branch controls? (for mindmap or sticky nodes)\n  const showBranchControls = node.type === 'mindmap' || node.type === 'sticky';\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0, y: 10, scale: 0.95 }}\n        animate={{ opacity: 1, y: 0, scale: 1 }}\n        exit={{ opacity: 0, y: 10, scale: 0.95 }}\n        transition={{ duration: 0.15 }}\n        className=\"absolute z-50 pointer-events-auto\"\n        style={{\n          left: clampedX,\n          top: clampedY,\n          transform: 'translateX(-50%)',\n        }}\n      >\n        <div className=\"flex items-center gap-1 px-2 py-1.5 bg-background/95 backdrop-blur-md rounded-xl shadow-lg border border-border/50\">\n          {/* Edit button for text/content nodes */}\n          {isTextNode && (\n            <button\n              onClick={() => onEditContent?.(node.id)}\n              className=\"p-2 rounded-lg hover:bg-muted transition-colors\"\n              title=\"Edit content\"\n            >\n              <Edit3 className=\"w-4 h-4\" />\n            </button>\n          )}\n\n          {/* Replace media button for media nodes */}\n          {isMediaNode && (\n            <>\n              <button\n                onClick={() => fileInputRef.current?.click()}\n                className=\"p-2 rounded-lg hover:bg-muted transition-colors\"\n                title={`Replace ${node.type}`}\n              >\n                {node.type === 'video' ? <Video className=\"w-4 h-4\" /> :\n                 node.type === 'audio' ? <Music className=\"w-4 h-4\" /> :\n                 <Image className=\"w-4 h-4\" />}\n              </button>\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                className=\"hidden\"\n                accept={\n                  node.type === 'video' ? 'video/*' :\n                  node.type === 'audio' ? 'audio/*' :\n                  'image/*'\n                }\n                onChange={(e) => {\n                  const file = e.target.files?.[0];\n                  if (file) {\n                    onReplaceMedia?.(node.id);\n                  }\n                }}\n              />\n            </>\n          )}\n\n          {/* Color picker - Expandable */}\n          <div className=\"relative\">\n            <button\n              onClick={() => {\n                closeAllMenus();\n                setShowColorPicker(!showColorPicker);\n              }}\n              className=\"p-2 rounded-lg hover:bg-muted transition-colors\"\n              title=\"Colors\"\n            >\n              <Palette className=\"w-4 h-4\" />\n            </button>\n\n            {showColorPicker && (\n              <motion.div\n                initial={{ opacity: 0, y: -5, scale: 0.95 }}\n                animate={{ opacity: 1, y: 0, scale: 1 }}\n                className=\"absolute top-full left-1/2 -translate-x-1/2 mt-2 p-3 bg-background/95 backdrop-blur-md rounded-xl shadow-lg border z-10\"\n              >\n                <p className=\"text-[10px] text-muted-foreground mb-2 font-medium\">Colors</p>\n                <div className=\"grid grid-cols-4 gap-2\">\n                  {Object.entries(NODE_COLORS).map(([name, hex]) => (\n                    <button\n                      key={name}\n                      onClick={() => {\n                        onColorChange(hex);\n                        setShowColorPicker(false);\n                      }}\n                      className=\"w-7 h-7 rounded-lg border-2 border-white/10 hover:scale-110 hover:border-white/30 transition-all\"\n                      style={{ backgroundColor: hex }}\n                      title={name}\n                    />\n                  ))}\n                </div>\n              </motion.div>\n            )}\n          </div>\n\n          {/* Copy */}\n          <button\n            onClick={() => { onCopy?.(); }}\n            className=\"p-2 rounded-lg hover:bg-muted transition-colors\"\n            title=\"Copy (⌘C)\"\n          >\n            <Copy className=\"w-4 h-4\" />\n          </button>\n\n          {/* Duplicate */}\n          <button\n            onClick={onDuplicate}\n            className=\"p-2 rounded-lg hover:bg-muted transition-colors\"\n            title=\"Duplicate (⌘D)\"\n          >\n            <Plus className=\"w-4 h-4\" />\n          </button>\n\n          {/* Regenerate for AI nodes */}\n          {isAINode && (\n            <button\n              onClick={() => onRegenerate?.()}\n              className=\"p-2 rounded-lg hover:bg-muted transition-colors\"\n              title=\"Regenerate\"\n            >\n              <RefreshCw className=\"w-4 h-4\" />\n            </button>\n          )}\n\n          {/* Add branch (for mindmap/sticky) */}\n          {showBranchControls && (\n            <div className=\"relative\">\n              <button\n                onClick={() => {\n                  closeAllMenus();\n                  setShowBranchPicker(!showBranchPicker);\n                }}\n                className=\"p-2 rounded-lg hover:bg-muted transition-colors\"\n                title=\"Add branch\"\n              >\n                <GitBranch className=\"w-4 h-4\" />\n              </button>\n\n              {showBranchPicker && (\n                <motion.div\n                  initial={{ opacity: 0, y: -5, scale: 0.95 }}\n                  animate={{ opacity: 1, y: 0, scale: 1 }}\n                  className=\"absolute top-full left-1/2 -translate-x-1/2 mt-2 p-2 bg-background/95 backdrop-blur-md rounded-xl shadow-lg border z-10\"\n                >\n                  <p className=\"text-[10px] text-muted-foreground mb-2 font-medium text-center\">Add Branch</p>\n                  <div className=\"grid grid-cols-3 gap-1 w-20\">\n                    <div />\n                    <button\n                      onClick={() => { onAddBranch('up'); setShowBranchPicker(false); }}\n                      className=\"p-1.5 rounded-lg hover:bg-muted transition-colors flex items-center justify-center\"\n                    >\n                      <ChevronUp className=\"w-4 h-4\" />\n                    </button>\n                    <div />\n                    <button\n                      onClick={() => { onAddBranch('left'); setShowBranchPicker(false); }}\n                      className=\"p-1.5 rounded-lg hover:bg-muted transition-colors flex items-center justify-center\"\n                    >\n                      <ChevronLeft className=\"w-4 h-4\" />\n                    </button>\n                    <div className=\"w-6 h-6 rounded-lg bg-muted/50 flex items-center justify-center\">\n                      <div className=\"w-2 h-2 rounded-full bg-primary/50\" />\n                    </div>\n                    <button\n                      onClick={() => { onAddBranch('right'); setShowBranchPicker(false); }}\n                      className=\"p-1.5 rounded-lg hover:bg-muted transition-colors flex items-center justify-center\"\n                    >\n                      <ChevronRight className=\"w-4 h-4\" />\n                    </button>\n                    <div />\n                    <button\n                      onClick={() => { onAddBranch('down'); setShowBranchPicker(false); }}\n                      className=\"p-1.5 rounded-lg hover:bg-muted transition-colors flex items-center justify-center\"\n                    >\n                      <ChevronDown className=\"w-4 h-4\" />\n                    </button>\n                    <div />\n                  </div>\n                </motion.div>\n              )}\n            </div>\n          )}\n\n          {/* Arrange menu - Expandable */}\n          <div className=\"relative\">\n            <button\n              onClick={() => {\n                closeAllMenus();\n                setShowArrangePicker(!showArrangePicker);\n              }}\n              className=\"p-2 rounded-lg hover:bg-muted transition-colors\"\n              title=\"Arrange\"\n            >\n              <Maximize2 className=\"w-4 h-4\" />\n            </button>\n\n            {showArrangePicker && (\n              <motion.div\n                initial={{ opacity: 0, y: -5, scale: 0.95 }}\n                animate={{ opacity: 1, y: 0, scale: 1 }}\n                className=\"absolute top-full left-1/2 -translate-x-1/2 mt-2 p-2 bg-background/95 backdrop-blur-md rounded-xl shadow-lg border z-10 min-w-[140px]\"\n              >\n                <p className=\"text-[10px] text-muted-foreground mb-2 font-medium\">Arrange</p>\n                <div className=\"space-y-0.5\">\n                  <button\n                    onClick={() => { onBringToFront?.(); setShowArrangePicker(false); }}\n                    className=\"w-full flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-muted transition-colors text-xs\"\n                  >\n                    <ArrowUpToLine className=\"w-3.5 h-3.5\" />\n                    <span>Bring to Front</span>\n                  </button>\n                  <button\n                    onClick={() => { onSendToBack?.(); setShowArrangePicker(false); }}\n                    className=\"w-full flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-muted transition-colors text-xs\"\n                  >\n                    <ArrowDownToLine className=\"w-3.5 h-3.5\" />\n                    <span>Send to Back</span>\n                  </button>\n                  <div className=\"h-px bg-border my-1\" />\n                  <button\n                    onClick={() => { onLock?.(); setShowArrangePicker(false); }}\n                    className=\"w-full flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-muted transition-colors text-xs\"\n                  >\n                    {isLocked ? <Unlock className=\"w-3.5 h-3.5\" /> : <Lock className=\"w-3.5 h-3.5\" />}\n                    <span>{isLocked ? 'Unlock' : 'Lock Position'}</span>\n                  </button>\n                </div>\n              </motion.div>\n            )}\n          </div>\n\n          {/* More menu - Expandable */}\n          <div className=\"relative\">\n            <button\n              onClick={() => {\n                closeAllMenus();\n                setShowMoreMenu(!showMoreMenu);\n              }}\n              className=\"p-2 rounded-lg hover:bg-muted transition-colors\"\n              title=\"More actions\"\n            >\n              <MoreHorizontal className=\"w-4 h-4\" />\n            </button>\n\n            {showMoreMenu && (\n              <motion.div\n                initial={{ opacity: 0, y: -5, scale: 0.95 }}\n                animate={{ opacity: 1, y: 0, scale: 1 }}\n                className=\"absolute top-full right-0 mt-2 p-2 bg-background/95 backdrop-blur-md rounded-xl shadow-lg border z-10 min-w-[140px]\"\n              >\n                <p className=\"text-[10px] text-muted-foreground mb-2 font-medium\">More</p>\n                <div className=\"space-y-0.5\">\n                  <button\n                    onClick={() => { onCut?.(); setShowMoreMenu(false); }}\n                    className=\"w-full flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-muted transition-colors text-xs\"\n                  >\n                    <Scissors className=\"w-3.5 h-3.5\" />\n                    <span>Cut</span>\n                    <span className=\"ml-auto text-muted-foreground text-[10px]\">⌘X</span>\n                  </button>\n                  <button\n                    onClick={() => { onCopy?.(); setShowMoreMenu(false); }}\n                    className=\"w-full flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-muted transition-colors text-xs\"\n                  >\n                    <Copy className=\"w-3.5 h-3.5\" />\n                    <span>Copy</span>\n                    <span className=\"ml-auto text-muted-foreground text-[10px]\">⌘C</span>\n                  </button>\n                  <div className=\"h-px bg-border my-1\" />\n                  <button\n                    onClick={() => { onEditContent?.(node.id); setShowMoreMenu(false); }}\n                    className=\"w-full flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-muted transition-colors text-xs\"\n                  >\n                    <Edit3 className=\"w-3.5 h-3.5\" />\n                    <span>Edit</span>\n                  </button>\n                  <button\n                    onClick={() => { /* TODO: Add connection */ setShowMoreMenu(false); }}\n                    className=\"w-full flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-muted transition-colors text-xs\"\n                  >\n                    <Link className=\"w-3.5 h-3.5\" />\n                    <span>Connect</span>\n                  </button>\n                </div>\n              </motion.div>\n            )}\n          </div>\n\n          {/* Divider */}\n          <div className=\"w-px h-5 bg-border mx-0.5\" />\n\n          {/* Delete */}\n          <button\n            onClick={onDelete}\n            className=\"p-2 rounded-lg hover:bg-destructive/10 text-muted-foreground hover:text-destructive transition-colors\"\n            title=\"Delete (⌫)\"\n          >\n            <Trash2 className=\"w-4 h-4\" />\n          </button>\n        </div>\n      </motion.div>\n    </AnimatePresence>\n  );\n}\n\n// ============================================================================\n// Individual node component with multi-modal support\n// ============================================================================\n\ninterface CanvasNodeComponentProps {\n  node: CanvasNode;\n  isSelected: boolean;\n  onMouseDown: (e: MouseEvent) => void;\n  onTouchStart: (e: TouchEvent<HTMLDivElement>) => void;\n  onContentChange: (content: string) => void;\n  onMediaChange: (mediaUrl: string, mediaType: \"image\" | \"audio\" | \"video\") => void;\n}\n\nfunction CanvasNodeComponent({\n  node,\n  isSelected,\n  onMouseDown,\n  onTouchStart,\n  onContentChange,\n}: CanvasNodeComponentProps) {\n  const [isEditing, setIsEditing] = useState(false);\n  const [editContent, setEditContent] = useState(node.content);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const audioRef = useRef<HTMLAudioElement>(null);\n  const videoRef = useRef<HTMLVideoElement>(null);\n\n  const handleDoubleClick = (e: MouseEvent) => {\n    e.stopPropagation();\n    if (node.type === \"text\" || node.type === \"sticky\" || node.type === \"code\" || node.type === \"multimodal\") {\n      setIsEditing(true);\n      setEditContent(node.content);\n    }\n  };\n\n  const handleBlur = () => {\n    setIsEditing(false);\n    if (editContent !== node.content) {\n      onContentChange(editContent);\n    }\n  };\n\n  const togglePlayback = () => {\n    if (node.type === \"audio\" && audioRef.current) {\n      if (isPlaying) {\n        audioRef.current.pause();\n      } else {\n        audioRef.current.play();\n      }\n      setIsPlaying(!isPlaying);\n    }\n    if (node.type === \"video\" && videoRef.current) {\n      if (isPlaying) {\n        videoRef.current.pause();\n      } else {\n        videoRef.current.play();\n      }\n      setIsPlaying(!isPlaying);\n    }\n  };\n\n  // Position is relative to the 5000px offset\n  const baseStyle: React.CSSProperties = {\n    position: \"absolute\",\n    left: node.x + 5000,\n    top: node.y + 5000,\n    width: node.width,\n    height: node.height,\n    touchAction: \"none\",\n  };\n\n  if (node.type === \"text\") {\n    return (\n      <motion.div\n        data-node-id={node.id}\n        style={baseStyle}\n        className={cn(\n          \"flex items-center justify-center rounded-lg px-3 py-2\",\n          \"bg-background border shadow-sm cursor-move\",\n          isSelected && \"ring-2 ring-primary ring-offset-2\"\n        )}\n        onMouseDown={onMouseDown as any}\n        onTouchStart={onTouchStart as any}\n        onDoubleClick={handleDoubleClick as any}\n        whileHover={{ scale: 1.02 }}\n        whileTap={{ scale: 0.98 }}\n      >\n        {isEditing ? (\n          <ContextReferenceInput\n            className=\"w-full bg-transparent text-center outline-none text-sm\"\n            value={editContent}\n            onChange={setEditContent}\n            onKeyDown={(e) => {\n              if (e.key === \"Enter\") handleBlur();\n              e.stopPropagation();\n            }}\n            autoFocus\n            placeholder=\"Type @ to reference...\"\n          />\n        ) : (\n          <span className=\"text-sm\">{node.content}</span>\n        )}\n      </motion.div>\n    );\n  }\n\n  if (node.type === \"sticky\") {\n    const fill = (node.style?.fill as string) || \"#fef08a\";\n    return (\n      <motion.div\n        data-node-id={node.id}\n        style={{ ...baseStyle, backgroundColor: fill }}\n        className={cn(\n          \"rounded-lg p-3 shadow-lg cursor-move\",\n          isSelected && \"ring-2 ring-primary ring-offset-2\"\n        )}\n        onMouseDown={onMouseDown as any}\n        onTouchStart={onTouchStart as any}\n        onDoubleClick={handleDoubleClick as any}\n        whileHover={{ scale: 1.02, rotate: 1 }}\n        whileTap={{ scale: 0.98 }}\n      >\n        {isEditing ? (\n          <ContextReferenceInput\n            className=\"w-full h-full bg-transparent resize-none outline-none text-sm text-gray-800\"\n            value={editContent}\n            onChange={setEditContent}\n            onKeyDown={(e) => e.stopPropagation()}\n            multiline\n            rows={4}\n            autoFocus\n            placeholder=\"Type @ to reference...\"\n          />\n        ) : (\n          <p className=\"text-sm whitespace-pre-wrap text-gray-800\">{node.content}</p>\n        )}\n      </motion.div>\n    );\n  }\n\n  if (node.type === \"shape\") {\n    const fill = (node.style?.fill as string) || \"#3b82f6\";\n    const stroke = (node.style?.stroke as string) || \"#1d4ed8\";\n    return (\n      <motion.div\n        data-node-id={node.id}\n        style={{ ...baseStyle, backgroundColor: fill, borderColor: stroke }}\n        className={cn(\n          \"rounded-lg border-2 cursor-move\",\n          isSelected && \"ring-2 ring-primary ring-offset-2\"\n        )}\n        onMouseDown={onMouseDown as any}\n        onTouchStart={onTouchStart as any}\n        whileHover={{ scale: 1.02 }}\n        whileTap={{ scale: 0.98 }}\n      />\n    );\n  }\n\n  if (node.type === \"ai_generation\") {\n    return (\n      <motion.div\n        data-node-id={node.id}\n        style={baseStyle}\n        className={cn(\n          \"flex flex-col items-center justify-center rounded-xl cursor-move\",\n          \"bg-gradient-to-br from-purple-500/10 to-blue-500/10 border-2 border-dashed border-purple-500/30\",\n          isSelected && \"ring-2 ring-purple-500 ring-offset-2\"\n        )}\n        onMouseDown={onMouseDown as any}\n        onTouchStart={onTouchStart as any}\n        whileHover={{ scale: 1.02 }}\n        whileTap={{ scale: 0.98 }}\n      >\n        <Sparkles className=\"h-8 w-8 text-purple-500/50 mb-2\" />\n        <span className=\"text-xs text-muted-foreground text-center px-2\">\n          {node.content}\n        </span>\n      </motion.div>\n    );\n  }\n\n  if (node.type === \"image\") {\n    return (\n      <motion.div\n        data-node-id={node.id}\n        style={baseStyle}\n        className={cn(\n          \"rounded-lg overflow-hidden cursor-move\",\n          isSelected && \"ring-2 ring-primary ring-offset-2\"\n        )}\n        onMouseDown={onMouseDown as any}\n        onTouchStart={onTouchStart as any}\n        whileHover={{ scale: 1.02 }}\n        whileTap={{ scale: 0.98 }}\n      >\n        {node.mediaUrl ? (\n          <img\n            src={node.mediaUrl}\n            alt=\"Canvas image\"\n            className=\"w-full h-full object-cover\"\n            draggable={false}\n          />\n        ) : (\n          <div className=\"w-full h-full flex items-center justify-center bg-muted\">\n            <Image className=\"h-8 w-8 text-muted-foreground\" />\n          </div>\n        )}\n      </motion.div>\n    );\n  }\n\n  // For basic audio nodes, convert them to use AudioBeatSyncNode for premium visualization\n  if (node.type === \"audio\") {\n    // Parse content to extract audio info\n    let audioInfo: { audioUrl?: string; audioName?: string; title?: string; artist?: string } = {};\n    try {\n      if (typeof node.content === 'string' && node.content.startsWith('{')) {\n        audioInfo = JSON.parse(node.content);\n      }\n    } catch {\n      // Content is plain text\n    }\n\n    const audioUrl = node.mediaUrl || audioInfo.audioUrl;\n    const audioName = audioInfo.audioName || audioInfo.title || (audioInfo.artist ? `${audioInfo.title} - ${audioInfo.artist}` : node.content);\n\n    // Create AudioBeatSyncContent for premium visualization\n    const beatSyncContent: AudioBeatSyncContent = {\n      audioUrl,\n      audioName: typeof audioName === 'string' ? audioName : 'Audio',\n      analyzeStatus: 'idle',\n      beats: [],\n      sections: [],\n      syncedNodes: [],\n    };\n\n    return (\n      <div\n        data-node-id={node.id}\n        style={{\n          ...baseStyle,\n          width: Math.max(node.width, 500),\n          height: Math.max(node.height, 380),\n        }}\n        onMouseDown={onMouseDown as any}\n        onTouchStart={onTouchStart as any}\n      >\n        <AudioBeatSyncNode\n          id={node.id}\n          content={beatSyncContent}\n          isSelected={isSelected}\n          onContentChange={(newContent) => {\n            onContentChange(JSON.stringify(newContent));\n          }}\n          width={Math.max(node.width, 500)}\n          height={Math.max(node.height, 380)}\n        />\n      </div>\n    );\n  }\n\n  // Audio Beat Sync Node - Beat detection and sync planning\n  if (node.type === \"audio-beat-sync\") {\n    let beatSyncContent: AudioBeatSyncContent;\n    try {\n      const parsed = typeof node.content === 'string'\n        ? JSON.parse(node.content)\n        : node.content as Record<string, unknown>;\n\n      // Handle legacy format: { title, artist, sections: [{label, startTime, color}] }\n      // Convert to new format: { audioName, analyzeStatus, beats, sections, syncedNodes }\n      if (parsed && typeof parsed === 'object') {\n        // Check if it's legacy format (has 'title' instead of 'audioName')\n        const legacy = parsed as { title?: string; artist?: string; sections?: Array<{ label: string; startTime: number; color: string }> };\n        if (legacy.title && !('analyzeStatus' in parsed)) {\n          // Convert legacy sections to new Section format\n          const convertedSections = (legacy.sections || []).map((s, i, arr) => ({\n            type: s.label.toLowerCase().includes('intro') ? 'intro' as const :\n                  s.label.toLowerCase().includes('verse') ? 'verse' as const :\n                  s.label.toLowerCase().includes('chorus') ? 'chorus' as const :\n                  s.label.toLowerCase().includes('bridge') ? 'bridge' as const :\n                  s.label.toLowerCase().includes('outro') ? 'outro' as const : 'break' as const,\n            startMs: (s.startTime || 0) * 1000,\n            endMs: arr[i + 1] ? (arr[i + 1].startTime || 0) * 1000 : ((s.startTime || 0) + 30) * 1000,\n            label: s.label,\n            energy: 0.7,\n          }));\n\n          beatSyncContent = {\n            audioUrl: parsed.audioUrl as string | undefined,\n            audioName: `${legacy.title}${legacy.artist ? ` - ${legacy.artist}` : ''}`,\n            analyzeStatus: 'complete',\n            beats: [],\n            sections: convertedSections,\n            syncedNodes: [],\n          };\n        } else {\n          // Already in new format or partial\n          beatSyncContent = {\n            audioUrl: parsed.audioUrl as string | undefined,\n            audioName: parsed.audioName as string | undefined,\n            analyzeStatus: (parsed.analyzeStatus as AudioBeatSyncContent['analyzeStatus']) || 'idle',\n            beats: (parsed.beats as AudioBeatSyncContent['beats']) || [],\n            sections: (parsed.sections as AudioBeatSyncContent['sections']) || [],\n            syncedNodes: (parsed.syncedNodes as AudioBeatSyncContent['syncedNodes']) || [],\n            bpm: parsed.bpm as number | undefined,\n            key: parsed.key as string | undefined,\n            timeSignature: parsed.timeSignature as string | undefined,\n            waveformData: parsed.waveformData as number[] | undefined,\n          };\n        }\n      } else {\n        beatSyncContent = createAudioBeatSyncContent();\n      }\n    } catch {\n      beatSyncContent = createAudioBeatSyncContent();\n    }\n\n    return (\n      <motion.div\n        data-node-id={node.id}\n        style={baseStyle}\n        className=\"cursor-move\"\n        onMouseDown={onMouseDown as any}\n        onTouchStart={onTouchStart as any}\n      >\n        <AudioBeatSyncNode\n          id={node.id}\n          content={beatSyncContent}\n          isSelected={isSelected}\n          width={node.width}\n          height={node.height}\n          onContentChange={(newContent) => {\n            onContentChange(JSON.stringify(newContent));\n          }}\n        />\n      </motion.div>\n    );\n  }\n\n  if (node.type === \"video\") {\n    return (\n      <motion.div\n        data-node-id={node.id}\n        style={baseStyle}\n        className={cn(\n          \"rounded-xl overflow-hidden cursor-move\",\n          \"bg-black\",\n          isSelected && \"ring-2 ring-red-500 ring-offset-2\"\n        )}\n        onMouseDown={onMouseDown as any}\n        onTouchStart={onTouchStart as any}\n        whileHover={{ scale: 1.02 }}\n        whileTap={{ scale: 0.98 }}\n      >\n        {node.mediaUrl ? (\n          <video\n            ref={videoRef}\n            src={node.mediaUrl}\n            className=\"w-full h-full object-cover\"\n            onEnded={() => setIsPlaying(false)}\n          />\n        ) : (\n          <div className=\"w-full h-full flex flex-col items-center justify-center bg-zinc-900 text-white/50\">\n            <Video className=\"h-8 w-8 mb-2\" />\n            <span className=\"text-xs\">{node.content}</span>\n          </div>\n        )}\n        <button\n          onClick={(e) => { e.stopPropagation(); togglePlayback(); }}\n          className=\"absolute inset-0 flex items-center justify-center bg-black/30 opacity-0 hover:opacity-100 transition-opacity\"\n        >\n          {isPlaying ? <Pause className=\"h-8 w-8 text-white\" /> : <Play className=\"h-8 w-8 text-white\" />}\n        </button>\n      </motion.div>\n    );\n  }\n\n  // Remotion video composition\n  if (node.type === \"video-composition\") {\n    // Parse composition data from node.content (JSON string)\n    let compositionData: VideoCompositionData | null = null;\n    try {\n      compositionData = JSON.parse(node.content) as VideoCompositionData;\n    } catch {\n      // Invalid composition data\n    }\n\n    if (!compositionData) {\n      return (\n        <motion.div\n          data-node-id={node.id}\n          style={baseStyle}\n          className={cn(\n            \"rounded-xl overflow-hidden cursor-move\",\n            \"bg-zinc-900 border border-red-500/50\",\n            isSelected && \"ring-2 ring-red-500 ring-offset-2\"\n          )}\n          onMouseDown={onMouseDown as React.MouseEventHandler}\n          onTouchStart={onTouchStart as React.TouchEventHandler}\n        >\n          <div className=\"w-full h-full flex items-center justify-center text-red-400 text-sm\">\n            Invalid composition data\n          </div>\n        </motion.div>\n      );\n    }\n\n    return (\n      <div\n        data-node-id={node.id}\n        style={{\n          ...baseStyle,\n          pointerEvents: \"auto\",\n        }}\n        onMouseDown={onMouseDown as React.MouseEventHandler}\n        onTouchStart={onTouchStart as React.TouchEventHandler}\n      >\n        <VideoNode\n          composition={compositionData}\n          isSelected={isSelected}\n          width={node.width}\n        />\n      </div>\n    );\n  }\n\n  // Talking video node (AI avatar videos)\n  if (node.type === \"talking-video\") {\n    // Parse talking video data from node.content (JSON string)\n    interface TalkingVideoData {\n      topic?: string;\n      sourcePhotoUrl?: string;\n      sceneStyle?: SceneStyle;\n      status?: TalkingVideoStatus;\n      script?: string;\n      audioUrl?: string;\n      finalVideoUrl?: string;\n    }\n    let talkingVideoData: TalkingVideoData = {};\n    try {\n      talkingVideoData = JSON.parse(node.content || \"{}\") as TalkingVideoData;\n    } catch {\n      // Use defaults\n    }\n\n    return (\n      <div\n        data-node-id={node.id}\n        style={{\n          ...baseStyle,\n          pointerEvents: \"auto\",\n        }}\n        onMouseDown={onMouseDown as React.MouseEventHandler}\n        onTouchStart={onTouchStart as React.TouchEventHandler}\n      >\n        <TalkingVideoNode\n          topic={talkingVideoData.topic}\n          sourcePhotoUrl={talkingVideoData.sourcePhotoUrl}\n          sceneStyle={talkingVideoData.sceneStyle}\n          status={talkingVideoData.status}\n          script={talkingVideoData.script}\n          audioUrl={talkingVideoData.audioUrl}\n          finalVideoUrl={talkingVideoData.finalVideoUrl}\n          isSelected={isSelected}\n          width={node.width || 320}\n        />\n      </div>\n    );\n  }\n\n  if (node.type === \"code\") {\n    return (\n      <motion.div\n        data-node-id={node.id}\n        style={baseStyle}\n        className={cn(\n          \"rounded-xl overflow-hidden cursor-move\",\n          \"bg-zinc-900 border border-zinc-700\",\n          isSelected && \"ring-2 ring-blue-500 ring-offset-2\"\n        )}\n        onMouseDown={onMouseDown as any}\n        onTouchStart={onTouchStart as any}\n        onDoubleClick={handleDoubleClick as any}\n        whileHover={{ scale: 1.02 }}\n        whileTap={{ scale: 0.98 }}\n      >\n        <div className=\"px-3 py-1.5 bg-zinc-800 border-b border-zinc-700 flex items-center gap-2\">\n          <div className=\"flex gap-1.5\">\n            <div className=\"w-3 h-3 rounded-full bg-red-500\" />\n            <div className=\"w-3 h-3 rounded-full bg-yellow-500\" />\n            <div className=\"w-3 h-3 rounded-full bg-green-500\" />\n          </div>\n          <span className=\"text-xs text-zinc-400 ml-2\">code</span>\n        </div>\n        {isEditing ? (\n          <ContextReferenceInput\n            className=\"w-full h-[calc(100%-32px)] p-3 bg-transparent resize-none outline-none text-sm font-mono text-green-400\"\n            value={editContent}\n            onChange={setEditContent}\n            onKeyDown={(e) => e.stopPropagation()}\n            multiline\n            rows={8}\n            autoFocus\n            placeholder=\"Type code or @ to reference...\"\n          />\n        ) : (\n          <pre className=\"p-3 text-sm font-mono text-green-400 overflow-auto h-[calc(100%-32px)]\">\n            <code>{node.content}</code>\n          </pre>\n        )}\n      </motion.div>\n    );\n  }\n\n  if (node.type === \"multimodal\") {\n    return (\n      <motion.div\n        data-node-id={node.id}\n        style={baseStyle}\n        className={cn(\n          \"rounded-xl p-3 flex flex-col cursor-move\",\n          \"bg-gradient-to-br from-indigo-500/10 via-purple-500/10 to-pink-500/10 border border-purple-500/30\",\n          isSelected && \"ring-2 ring-purple-500 ring-offset-2\"\n        )}\n        onMouseDown={onMouseDown as any}\n        onTouchStart={onTouchStart as any}\n        onDoubleClick={handleDoubleClick as any}\n        whileHover={{ scale: 1.02 }}\n        whileTap={{ scale: 0.98 }}\n      >\n        <div className=\"flex gap-1 mb-2\">\n          <span className=\"px-2 py-0.5 rounded-full bg-purple-500/20 text-purple-500 text-xs\">Multi-modal</span>\n        </div>\n        {isEditing ? (\n          <ContextReferenceInput\n            className=\"flex-1 bg-transparent resize-none outline-none text-sm\"\n            value={editContent}\n            onChange={setEditContent}\n            onKeyDown={(e) => e.stopPropagation()}\n            multiline\n            rows={4}\n            autoFocus\n            placeholder=\"Type @ to reference data...\"\n          />\n        ) : (\n          <p className=\"text-sm flex-1 whitespace-pre-wrap\">{node.content}</p>\n        )}\n        <div className=\"flex gap-2 mt-2 pt-2 border-t border-purple-500/20\">\n          <button aria-label=\"Add image\" title=\"Add image\" className=\"p-1.5 rounded-lg bg-purple-500/10 hover:bg-purple-500/20 transition-colors\">\n            <Image className=\"h-4 w-4 text-purple-500\" />\n          </button>\n          <button aria-label=\"Add music\" title=\"Add music\" className=\"p-1.5 rounded-lg bg-purple-500/10 hover:bg-purple-500/20 transition-colors\">\n            <Music className=\"h-4 w-4 text-purple-500\" />\n          </button>\n          <button aria-label=\"Add video\" title=\"Add video\" className=\"p-1.5 rounded-lg bg-purple-500/10 hover:bg-purple-500/20 transition-colors\">\n            <Video className=\"h-4 w-4 text-purple-500\" />\n          </button>\n          <button aria-label=\"AI generate\" title=\"AI generate\" className=\"p-1.5 rounded-lg bg-purple-500/10 hover:bg-purple-500/20 transition-colors\">\n            <Sparkles className=\"h-4 w-4 text-purple-500\" />\n          </button>\n        </div>\n      </motion.div>\n    );\n  }\n\n  // Device Frame for UI Mockups\n  if (node.type === \"device-frame\") {\n    const content = typeof node.content === 'string' ? { title: node.content } : node.content as { title?: string };\n    return (\n      <motion.div\n        data-node-id={node.id}\n        style={{ ...baseStyle, background: 'transparent' }}\n        className=\"cursor-move\"\n        onMouseDown={onMouseDown as any}\n        onTouchStart={onTouchStart as any}\n      >\n        <DeviceFrame\n          deviceType=\"iphone-15-pro\"\n          screenTitle={content?.title || 'Screen'}\n          isSelected={isSelected}\n          backgroundColor={(node.style?.fill as string) || '#1c1c1e'}\n        />\n      </motion.div>\n    );\n  }\n\n  // Flow Diagram Nodes\n  if (node.type.startsWith(\"flow-\")) {\n    const flowType = node.type as 'flow-start' | 'flow-end' | 'flow-decision' | 'flow-process' | 'flow-screen' | 'flow-data' | 'flow-subprocess';\n    return (\n      <motion.div\n        data-node-id={node.id}\n        style={{ ...baseStyle, background: 'transparent' }}\n        className=\"cursor-move\"\n        onMouseDown={onMouseDown as any}\n        onTouchStart={onTouchStart as any}\n      >\n        <FlowNode\n          type={flowType}\n          label={typeof node.content === 'string' ? node.content : 'Node'}\n          isSelected={isSelected}\n          width={node.width}\n          height={node.height}\n          style={{\n            fill: node.style?.fill as string,\n            stroke: node.style?.stroke as string,\n          }}\n        />\n      </motion.div>\n    );\n  }\n\n  // Architecture Diagram Nodes\n  if (node.type.startsWith(\"arch-\")) {\n    const archType = node.type as 'arch-service' | 'arch-database' | 'arch-client' | 'arch-api' | 'arch-queue' | 'arch-cache' | 'arch-cdn' | 'arch-cloud';\n    const content = typeof node.content === 'string' ? node.content : '';\n    const metadata = node.style?.metadata as { description?: string } | undefined;\n    return (\n      <motion.div\n        data-node-id={node.id}\n        style={{ ...baseStyle, background: 'transparent' }}\n        className=\"cursor-move\"\n        onMouseDown={onMouseDown as any}\n        onTouchStart={onTouchStart as any}\n      >\n        <ArchNode\n          type={archType}\n          label={content}\n          description={metadata?.description}\n          isSelected={isSelected}\n          width={node.width}\n          height={node.height}\n        />\n      </motion.div>\n    );\n  }\n\n  // iOS Component Nodes (for inside device frames)\n  if (node.type.startsWith(\"ios-\")) {\n    const fill = (node.style?.fill as string) || '#ffffff20';\n    return (\n      <motion.div\n        data-node-id={node.id}\n        style={{ ...baseStyle, backgroundColor: fill }}\n        className={cn(\n          \"rounded-xl p-2 flex items-center justify-center cursor-move\",\n          \"backdrop-blur-sm border border-white/10\",\n          isSelected && \"ring-2 ring-blue-500 ring-offset-2\"\n        )}\n        onMouseDown={onMouseDown as any}\n        onTouchStart={onTouchStart as any}\n        whileHover={{ scale: 1.02 }}\n        whileTap={{ scale: 0.98 }}\n      >\n        <span className=\"text-sm text-white/80\">{node.content}</span>\n      </motion.div>\n    );\n  }\n\n  // Mindmap Node - for branching thought structures\n  if (node.type === \"mindmap\") {\n    const fill = (node.style?.fill as string) || \"#c4b5fd\";\n    const hasConnections = true; // Could be determined by checking edges\n    return (\n      <motion.div\n        data-node-id={node.id}\n        style={{ ...baseStyle, backgroundColor: fill }}\n        className={cn(\n          \"rounded-2xl p-3 shadow-lg cursor-move relative\",\n          \"border-2 border-white/20\",\n          isSelected && \"ring-2 ring-purple-500 ring-offset-2\"\n        )}\n        onMouseDown={onMouseDown as any}\n        onTouchStart={onTouchStart as any}\n        onDoubleClick={handleDoubleClick as any}\n        whileHover={{ scale: 1.03 }}\n        whileTap={{ scale: 0.97 }}\n      >\n        {/* Branch indicator */}\n        <div className=\"absolute -top-1 -right-1 w-5 h-5 rounded-full bg-purple-500 flex items-center justify-center shadow-md\">\n          <GitBranch className=\"w-3 h-3 text-white\" />\n        </div>\n\n        {isEditing ? (\n          <ContextReferenceInput\n            className=\"w-full h-full bg-transparent resize-none outline-none text-sm text-gray-800 font-medium\"\n            value={editContent}\n            onChange={setEditContent}\n            onKeyDown={(e) => e.stopPropagation()}\n            multiline\n            rows={2}\n            autoFocus\n            placeholder=\"Mind map node...\"\n          />\n        ) : (\n          <p className=\"text-sm font-medium whitespace-pre-wrap text-gray-800\">{node.content}</p>\n        )}\n      </motion.div>\n    );\n  }\n\n  // Default fallback\n  return (\n    <motion.div\n      data-node-id={node.id}\n      style={{ ...baseStyle, backgroundColor: \"#e5e7eb\" }}\n      className={cn(\n        \"rounded-lg flex items-center justify-center cursor-move\",\n        isSelected && \"ring-2 ring-primary ring-offset-2\"\n      )}\n      onMouseDown={onMouseDown as any}\n      onTouchStart={onTouchStart as any}\n      whileHover={{ scale: 1.02 }}\n      whileTap={{ scale: 0.98 }}\n    >\n      <span className=\"text-xs text-muted-foreground\">{node.type}</span>\n    </motion.div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9618, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/design-canvas/FloatingToolDock.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useCallback } from \"react\";\nimport { motion } from \"framer-motion\";\nimport { cn } from \"@/lib/utils\";\nimport {\n  MousePointer2,\n  Hand,\n  Pencil,\n  Square,\n  Circle,\n  Type,\n  StickyNote,\n  Image,\n  Spline,\n  Eraser,\n  GripVertical,\n  Undo,\n  Redo,\n} from \"lucide-react\";\n\nexport type DrawingTool =\n  | \"select\"\n  | \"pan\"\n  | \"pen\"\n  | \"rectangle\"\n  | \"ellipse\"\n  | \"text\"\n  | \"sticky\"\n  | \"image\"\n  | \"connector\"\n  | \"eraser\";\n\ninterface FloatingToolDockProps {\n  selectedTool: string;\n  onToolChange: (tool: string) => void;\n  onUndo?: () => void;\n  onRedo?: () => void;\n  canUndo?: boolean;\n  canRedo?: boolean;\n}\n\nconst tools: Array<{\n  id: DrawingTool;\n  icon: typeof MousePointer2;\n  label: string;\n  shortcut?: string;\n}> = [\n  { id: \"select\", icon: MousePointer2, label: \"Select\", shortcut: \"V\" },\n  { id: \"pan\", icon: Hand, label: \"Pan\", shortcut: \"H\" },\n  { id: \"pen\", icon: Pencil, label: \"Draw\", shortcut: \"P\" },\n  { id: \"connector\", icon: Spline, label: \"Connect\", shortcut: \"L\" },\n  { id: \"rectangle\", icon: Square, label: \"Rectangle\", shortcut: \"R\" },\n  { id: \"ellipse\", icon: Circle, label: \"Ellipse\", shortcut: \"O\" },\n  { id: \"text\", icon: Type, label: \"Text\", shortcut: \"T\" },\n  { id: \"sticky\", icon: StickyNote, label: \"Sticky\", shortcut: \"S\" },\n  { id: \"image\", icon: Image, label: \"Image\", shortcut: \"I\" },\n  { id: \"eraser\", icon: Eraser, label: \"Eraser\", shortcut: \"E\" },\n];\n\nexport function FloatingToolDock({\n  selectedTool,\n  onToolChange,\n  onUndo,\n  onRedo,\n  canUndo = false,\n  canRedo = false,\n}: FloatingToolDockProps) {\n  // Draggable state\n  const [position, setPosition] = useState({ x: 16, y: 100 });\n  const [isDragging, setIsDragging] = useState(false);\n  const dragStartRef = useRef({ x: 0, y: 0, posX: 0, posY: 0 });\n\n  const handleDragStart = useCallback((e: React.MouseEvent | React.TouchEvent) => {\n    e.preventDefault();\n    setIsDragging(true);\n\n    const clientX = 'touches' in e ? e.touches[0].clientX : e.clientX;\n    const clientY = 'touches' in e ? e.touches[0].clientY : e.clientY;\n\n    dragStartRef.current = {\n      x: clientX,\n      y: clientY,\n      posX: position.x,\n      posY: position.y,\n    };\n\n    const handleMove = (moveEvent: MouseEvent | TouchEvent) => {\n      const moveX = 'touches' in moveEvent ? moveEvent.touches[0].clientX : moveEvent.clientX;\n      const moveY = 'touches' in moveEvent ? moveEvent.touches[0].clientY : moveEvent.clientY;\n\n      const deltaX = moveX - dragStartRef.current.x;\n      const deltaY = moveY - dragStartRef.current.y;\n\n      setPosition({\n        x: Math.max(0, Math.min(window.innerWidth - 60, dragStartRef.current.posX + deltaX)),\n        y: Math.max(0, Math.min(window.innerHeight - 400, dragStartRef.current.posY + deltaY)),\n      });\n    };\n\n    const handleEnd = () => {\n      setIsDragging(false);\n      window.removeEventListener('mousemove', handleMove);\n      window.removeEventListener('mouseup', handleEnd);\n      window.removeEventListener('touchmove', handleMove);\n      window.removeEventListener('touchend', handleEnd);\n    };\n\n    window.addEventListener('mousemove', handleMove);\n    window.addEventListener('mouseup', handleEnd);\n    window.addEventListener('touchmove', handleMove);\n    window.addEventListener('touchend', handleEnd);\n  }, [position]);\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, scale: 0.9 }}\n      animate={{ opacity: 1, scale: 1 }}\n      style={{\n        position: 'fixed',\n        left: position.x,\n        top: position.y,\n        zIndex: 40,\n        cursor: isDragging ? 'grabbing' : 'default',\n      }}\n    >\n      <div className=\"bg-background/95 backdrop-blur-xl border rounded-2xl shadow-lg p-1.5 flex flex-col gap-1\">\n        {/* Drag handle */}\n        <div\n          className=\"w-10 h-6 rounded-lg flex items-center justify-center cursor-grab active:cursor-grabbing hover:bg-muted transition-colors\"\n          onMouseDown={handleDragStart}\n          onTouchStart={handleDragStart}\n        >\n          <GripVertical className=\"h-4 w-4 text-muted-foreground\" />\n        </div>\n\n        {/* Divider */}\n        <div className=\"h-px bg-border\" />\n\n        {/* Main tools */}\n        {tools.map((tool) => {\n          const Icon = tool.icon;\n          const isSelected = selectedTool === tool.id;\n\n          return (\n            <button\n              key={tool.id}\n              onClick={() => onToolChange(tool.id)}\n              className={cn(\n                \"relative w-10 h-10 rounded-xl flex items-center justify-center transition-all\",\n                \"hover:bg-muted\",\n                isSelected && \"bg-primary text-primary-foreground hover:bg-primary/90\"\n              )}\n              title={`${tool.label}${tool.shortcut ? ` (${tool.shortcut})` : \"\"}`}\n            >\n              <Icon className=\"h-5 w-5\" />\n              {tool.shortcut && (\n                <span className=\"absolute -right-0.5 -bottom-0.5 text-[8px] font-medium opacity-50\">\n                  {tool.shortcut}\n                </span>\n              )}\n            </button>\n          );\n        })}\n\n        {/* Undo/Redo section (if handlers provided) */}\n        {(onUndo || onRedo) && (\n          <>\n            <div className=\"h-px bg-border my-1\" />\n            <button\n              onClick={onUndo}\n              disabled={!canUndo}\n              className={cn(\n                \"w-10 h-10 rounded-xl flex items-center justify-center transition-all\",\n                \"hover:bg-muted\",\n                !canUndo && \"opacity-30 cursor-not-allowed\"\n              )}\n              title=\"Undo (Cmd+Z)\"\n            >\n              <Undo className=\"h-5 w-5\" />\n            </button>\n            <button\n              onClick={onRedo}\n              disabled={!canRedo}\n              className={cn(\n                \"w-10 h-10 rounded-xl flex items-center justify-center transition-all\",\n                \"hover:bg-muted\",\n                !canRedo && \"opacity-30 cursor-not-allowed\"\n              )}\n              title=\"Redo (Cmd+Shift+Z)\"\n            >\n              <Redo className=\"h-5 w-5\" />\n            </button>\n          </>\n        )}\n      </div>\n    </motion.div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9903, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/design-canvas/PromptLibrary.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Search,\n  X,\n  Sparkles,\n  Image,\n  Layout,\n  Palette,\n  Box,\n  Music,\n  Video,\n  Code2,\n  Wand2,\n  Star,\n  TrendingUp,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface PromptLibraryProps {\n  onSelectPrompt: (prompt: {\n    prompt: string;\n    negativePrompt?: string;\n    provider: string;\n    model?: string;\n    category: string;\n  }) => void;\n  onClose: () => void;\n}\n\ninterface Prompt {\n  id: string;\n  name: string;\n  description?: string;\n  prompt: string;\n  negativePrompt?: string;\n  category: string;\n  provider: string;\n  modelId?: string;\n  tags: string[];\n  usageCount: number;\n  isFeatured: boolean;\n}\n\n// Default prompts\nconst defaultPrompts: Prompt[] = [\n  {\n    id: \"1\",\n    name: \"Modern UI Component\",\n    description: \"Clean, minimalist UI component design\",\n    prompt: \"A sleek, modern UI component with glass morphism effects, subtle gradients, rounded corners, and a dark theme. Professional and polished.\",\n    category: \"ui_design\",\n    provider: \"any\",\n    tags: [\"ui\", \"glassmorphism\", \"modern\"],\n    usageCount: 150,\n    isFeatured: true,\n  },\n  {\n    id: \"2\",\n    name: \"Abstract Gradient Art\",\n    description: \"Flowing abstract gradients\",\n    prompt: \"Abstract flowing gradient art with vibrant colors blending seamlessly, ethereal glow effects, 4K quality, digital art masterpiece\",\n    category: \"abstract\",\n    provider: \"any\",\n    tags: [\"abstract\", \"gradient\", \"colorful\"],\n    usageCount: 120,\n    isFeatured: true,\n  },\n  {\n    id: \"3\",\n    name: \"Product Hero Shot\",\n    description: \"Professional product photography\",\n    prompt: \"Professional product photography, studio lighting, clean white background, subtle shadows, commercial quality, 8K resolution\",\n    category: \"photo\",\n    provider: \"any\",\n    tags: [\"product\", \"photography\", \"commercial\"],\n    usageCount: 95,\n    isFeatured: false,\n  },\n  {\n    id: \"4\",\n    name: \"Isometric 3D Scene\",\n    description: \"Cute isometric illustration\",\n    prompt: \"Cute isometric 3D illustration, soft pastel colors, minimal design, clean geometric shapes, playful and modern\",\n    category: \"3d\",\n    provider: \"any\",\n    tags: [\"3d\", \"isometric\", \"cute\"],\n    usageCount: 88,\n    isFeatured: true,\n  },\n  {\n    id: \"5\",\n    name: \"App Icon Design\",\n    description: \"Modern app icon\",\n    prompt: \"Modern app icon design, bold gradient colors, simple shape, iOS style, glossy finish, professional quality\",\n    category: \"icon\",\n    provider: \"any\",\n    tags: [\"icon\", \"app\", \"ios\"],\n    usageCount: 75,\n    isFeatured: false,\n  },\n  {\n    id: \"6\",\n    name: \"Character Portrait\",\n    description: \"Stylized character art\",\n    prompt: \"Stylized character portrait, vibrant colors, expressive eyes, anime-inspired, professional digital art, detailed shading\",\n    category: \"character\",\n    provider: \"any\",\n    tags: [\"character\", \"portrait\", \"anime\"],\n    usageCount: 110,\n    isFeatured: true,\n  },\n  {\n    id: \"7\",\n    name: \"Fantasy Landscape\",\n    description: \"Magical environment\",\n    prompt: \"Magical fantasy landscape, ethereal lighting, floating islands, waterfalls, lush vegetation, cinematic composition, concept art quality\",\n    category: \"landscape\",\n    provider: \"any\",\n    tags: [\"landscape\", \"fantasy\", \"magical\"],\n    usageCount: 100,\n    isFeatured: false,\n  },\n  {\n    id: \"8\",\n    name: \"Seamless Pattern\",\n    description: \"Tileable texture pattern\",\n    prompt: \"Seamless tileable pattern, geometric shapes, modern design, subtle colors, perfect for backgrounds, high quality texture\",\n    category: \"texture\",\n    provider: \"any\",\n    tags: [\"pattern\", \"texture\", \"seamless\"],\n    usageCount: 65,\n    isFeatured: false,\n  },\n];\n\nconst categoryIcons: Record<string, React.ReactNode> = {\n  ui_design: <Layout className=\"h-4 w-4\" />,\n  illustration: <Palette className=\"h-4 w-4\" />,\n  photo: <Image className=\"h-4 w-4\" />,\n  \"3d\": <Box className=\"h-4 w-4\" />,\n  icon: <Sparkles className=\"h-4 w-4\" />,\n  texture: <Layout className=\"h-4 w-4\" />,\n  character: <Wand2 className=\"h-4 w-4\" />,\n  landscape: <Image className=\"h-4 w-4\" />,\n  abstract: <Palette className=\"h-4 w-4\" />,\n  code: <Code2 className=\"h-4 w-4\" />,\n  audio: <Music className=\"h-4 w-4\" />,\n  video: <Video className=\"h-4 w-4\" />,\n  other: <Sparkles className=\"h-4 w-4\" />,\n};\n\nconst categories = [\n  { id: \"all\", label: \"All\" },\n  { id: \"ui_design\", label: \"UI\" },\n  { id: \"illustration\", label: \"Art\" },\n  { id: \"photo\", label: \"Photo\" },\n  { id: \"3d\", label: \"3D\" },\n  { id: \"character\", label: \"Character\" },\n  { id: \"landscape\", label: \"Landscape\" },\n];\n\nexport function PromptLibrary({ onSelectPrompt, onClose }: PromptLibraryProps) {\n  const [search, setSearch] = useState(\"\");\n  const [selectedCategory, setSelectedCategory] = useState(\"all\");\n  const [activeTab, setActiveTab] = useState<\"featured\" | \"popular\" | \"all\">(\"featured\");\n\n  const prompts = defaultPrompts;\n\n  // Filter prompts\n  const filteredPrompts = prompts.filter((prompt) => {\n    const matchesSearch =\n      !search ||\n      prompt.name.toLowerCase().includes(search.toLowerCase()) ||\n      prompt.prompt.toLowerCase().includes(search.toLowerCase()) ||\n      prompt.tags.some((tag) => tag.toLowerCase().includes(search.toLowerCase()));\n\n    const matchesCategory =\n      selectedCategory === \"all\" || prompt.category === selectedCategory;\n\n    const matchesTab =\n      activeTab === \"all\" ||\n      (activeTab === \"featured\" && prompt.isFeatured) ||\n      (activeTab === \"popular\" && prompt.usageCount > 80);\n\n    return matchesSearch && matchesCategory && matchesTab;\n  });\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      {/* Header */}\n      <div className=\"p-4 border-b\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <h3 className=\"font-semibold flex items-center gap-2\">\n            <Sparkles className=\"h-4 w-4 text-purple-500\" />\n            AI Prompt Library\n          </h3>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={onClose}>\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <input\n            type=\"text\"\n            placeholder=\"Search prompts...\"\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n            className=\"w-full pl-9 pr-3 py-2 rounded-lg border bg-background text-sm focus:outline-none focus:ring-2 focus:ring-primary\"\n          />\n        </div>\n      </div>\n\n      {/* Tabs */}\n      <div className=\"px-4 pt-2\">\n        <div className=\"flex gap-1 p-1 rounded-lg bg-muted\">\n          {([\"featured\", \"popular\", \"all\"] as const).map((tab) => (\n            <button\n              key={tab}\n              onClick={() => setActiveTab(tab)}\n              className={cn(\n                \"flex-1 py-1.5 px-2 text-xs font-medium rounded-md transition-colors\",\n                activeTab === tab\n                  ? \"bg-background shadow-sm\"\n                  : \"text-muted-foreground hover:text-foreground\"\n              )}\n            >\n              {tab === \"featured\" && <Star className=\"inline h-3 w-3 mr-1\" />}\n              {tab === \"popular\" && <TrendingUp className=\"inline h-3 w-3 mr-1\" />}\n              {tab.charAt(0).toUpperCase() + tab.slice(1)}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Category filters */}\n      <div className=\"px-4 py-2 flex gap-1 overflow-x-auto\">\n        {categories.map((cat) => (\n          <Button\n            key={cat.id}\n            variant={selectedCategory === cat.id ? \"secondary\" : \"ghost\"}\n            size=\"sm\"\n            className=\"h-7 text-xs whitespace-nowrap\"\n            onClick={() => setSelectedCategory(cat.id)}\n          >\n            {cat.label}\n          </Button>\n        ))}\n      </div>\n\n      {/* Prompt list */}\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\n        {filteredPrompts.length === 0 ? (\n          <div className=\"text-center py-8 text-muted-foreground\">\n            <Sparkles className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n            <p className=\"text-sm\">No prompts found</p>\n          </div>\n        ) : (\n          filteredPrompts.map((prompt) => (\n            <PromptCard\n              key={prompt.id}\n              prompt={prompt}\n              onClick={() =>\n                onSelectPrompt({\n                  prompt: prompt.prompt,\n                  negativePrompt: prompt.negativePrompt,\n                  provider: prompt.provider,\n                  model: prompt.modelId,\n                  category: prompt.category,\n                })\n              }\n            />\n          ))\n        )}\n      </div>\n\n      {/* AI Provider info */}\n      <div className=\"p-4 border-t bg-muted/30\">\n        <p className=\"text-xs text-muted-foreground text-center\">\n          Ready for Fal AI, Replicate, and HuggingFace\n        </p>\n        <div className=\"flex justify-center gap-2 mt-2\">\n          <Badge variant=\"outline\" className=\"text-xs\">Fal AI</Badge>\n          <Badge variant=\"outline\" className=\"text-xs\">Replicate</Badge>\n          <Badge variant=\"outline\" className=\"text-xs\">HuggingFace</Badge>\n        </div>\n      </div>\n    </div>\n  );\n}\n\ninterface PromptCardProps {\n  prompt: Prompt;\n  onClick: () => void;\n}\n\nfunction PromptCard({ prompt, onClick }: PromptCardProps) {\n  return (\n    <button\n      className={cn(\n        \"w-full text-left p-3 rounded-lg border bg-card hover:bg-accent/50 transition-colors\",\n        prompt.isFeatured && \"border-purple-500/30 bg-purple-500/5\"\n      )}\n      onClick={onClick}\n    >\n      <div className=\"flex items-start gap-2 mb-2\">\n        <div className=\"p-1.5 rounded-md bg-muted\">\n          {categoryIcons[prompt.category] || <Sparkles className=\"h-4 w-4\" />}\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          <h4 className=\"font-medium text-sm truncate\">{prompt.name}</h4>\n          {prompt.description && (\n            <p className=\"text-xs text-muted-foreground truncate\">\n              {prompt.description}\n            </p>\n          )}\n        </div>\n        {prompt.isFeatured && (\n          <Star className=\"h-4 w-4 text-yellow-500 fill-yellow-500 shrink-0\" />\n        )}\n      </div>\n      <p className=\"text-xs text-muted-foreground line-clamp-2 mb-2\">\n        {prompt.prompt}\n      </p>\n      <div className=\"flex items-center gap-2\">\n        <div className=\"flex gap-1 flex-wrap flex-1\">\n          {prompt.tags.slice(0, 3).map((tag) => (\n            <Badge key={tag} variant=\"secondary\" className=\"text-xs px-1.5 py-0\">\n              {tag}\n            </Badge>\n          ))}\n        </div>\n        <span className=\"text-xs text-muted-foreground\">\n          {prompt.usageCount} uses\n        </span>\n      </div>\n    </button>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10563, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/design-canvas/CanvasList.tsx"],"sourcesContent":["\"use client\";\n\nimport { motion } from \"framer-motion\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Plus,\n  Layout,\n  Layers,\n  Map,\n  Film,\n  GitBranch,\n  Workflow,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface Canvas {\n  _id: string;\n  name: string;\n  description?: string;\n  canvasType: string;\n  status: string;\n  createdAt: number;\n  updatedAt: number;\n  thumbnailUrl?: string;\n}\n\ninterface CanvasListProps {\n  canvases: Canvas[];\n  onSelect: (canvasId: string) => void;\n  onCreateNew: () => void;\n}\n\nconst canvasTypeIcons: Record<string, React.ReactNode> = {\n  freeform: <Layout className=\"h-5 w-5\" />,\n  wireframe: <Layers className=\"h-5 w-5\" />,\n  moodboard: <Map className=\"h-5 w-5\" />,\n  storyboard: <Film className=\"h-5 w-5\" />,\n  mindmap: <GitBranch className=\"h-5 w-5\" />,\n  flowchart: <Workflow className=\"h-5 w-5\" />,\n};\n\nconst canvasTypeColors: Record<string, string> = {\n  freeform: \"from-blue-500 to-cyan-500\",\n  wireframe: \"from-gray-500 to-slate-600\",\n  moodboard: \"from-pink-500 to-rose-500\",\n  storyboard: \"from-purple-500 to-violet-500\",\n  mindmap: \"from-green-500 to-emerald-500\",\n  flowchart: \"from-orange-500 to-amber-500\",\n};\n\n// Simple relative time formatter\nfunction formatRelativeTime(timestamp: number): string {\n  const now = Date.now();\n  const diff = now - timestamp;\n  const seconds = Math.floor(diff / 1000);\n  const minutes = Math.floor(seconds / 60);\n  const hours = Math.floor(minutes / 60);\n  const days = Math.floor(hours / 24);\n\n  if (days > 0) return `${days}d ago`;\n  if (hours > 0) return `${hours}h ago`;\n  if (minutes > 0) return `${minutes}m ago`;\n  return \"just now\";\n}\n\nexport function CanvasList({ canvases, onSelect, onCreateNew }: CanvasListProps) {\n  if (canvases.length === 0) {\n    return <EmptyState onCreateNew={onCreateNew} />;\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Recent canvases section */}\n      <section>\n        <div className=\"flex items-center justify-between mb-4\">\n          <h2 className=\"text-lg font-semibold\">Your Canvases</h2>\n          <Button onClick={onCreateNew} size=\"sm\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            New Canvas\n          </Button>\n        </div>\n\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4\">\n          {canvases.map((canvas, index) => (\n            <CanvasCard\n              key={canvas._id}\n              canvas={canvas}\n              onClick={() => onSelect(canvas._id)}\n              index={index}\n            />\n          ))}\n        </div>\n      </section>\n    </div>\n  );\n}\n\ninterface CanvasCardProps {\n  canvas: Canvas;\n  onClick: () => void;\n  index: number;\n}\n\nfunction CanvasCard({ canvas, onClick, index }: CanvasCardProps) {\n  const gradient = canvasTypeColors[canvas.canvasType] || canvasTypeColors.freeform;\n  const icon = canvasTypeIcons[canvas.canvasType] || canvasTypeIcons.freeform;\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ delay: index * 0.05 }}\n      className=\"group relative\"\n    >\n      <button\n        onClick={onClick}\n        className=\"w-full text-left rounded-xl border bg-card overflow-hidden hover:shadow-lg transition-all hover:border-primary/50\"\n      >\n        {/* Thumbnail / Gradient */}\n        <div className={cn(\"aspect-video relative bg-gradient-to-br\", gradient)}>\n          {canvas.thumbnailUrl ? (\n            <img\n              src={canvas.thumbnailUrl}\n              alt={canvas.name}\n              className=\"w-full h-full object-cover\"\n            />\n          ) : (\n            <div className=\"absolute inset-0 flex items-center justify-center text-white/80\">\n              {icon}\n            </div>\n          )}\n\n          {/* Status badge */}\n          {canvas.status === \"template\" && (\n            <Badge className=\"absolute top-2 left-2 bg-white/20 backdrop-blur-sm text-white\">\n              Template\n            </Badge>\n          )}\n        </div>\n\n        {/* Content */}\n        <div className=\"p-3\">\n          <h3 className=\"font-medium truncate\">{canvas.name}</h3>\n          {canvas.description && (\n            <p className=\"text-sm text-muted-foreground truncate mt-0.5\">\n              {canvas.description}\n            </p>\n          )}\n          <div className=\"flex items-center justify-between mt-2\">\n            <Badge variant=\"secondary\" className=\"text-xs capitalize\">\n              {canvas.canvasType}\n            </Badge>\n            <span className=\"text-xs text-muted-foreground\">\n              {formatRelativeTime(canvas.updatedAt)}\n            </span>\n          </div>\n        </div>\n      </button>\n    </motion.div>\n  );\n}\n\nfunction EmptyState({ onCreateNew }: { onCreateNew: () => void }) {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      className=\"flex flex-col items-center justify-center py-16 px-4\"\n    >\n      <div className=\"w-24 h-24 rounded-full bg-gradient-to-br from-purple-500/20 to-blue-500/20 flex items-center justify-center mb-6\">\n        <Layout className=\"h-10 w-10 text-purple-500\" />\n      </div>\n\n      <h2 className=\"text-2xl font-bold mb-2\">Start Your First Canvas</h2>\n      <p className=\"text-muted-foreground text-center max-w-md mb-6\">\n        Create infinite canvases to explore ideas, design interfaces, plan projects,\n        and generate AI art - all in one place.\n      </p>\n\n      <Button onClick={onCreateNew} size=\"lg\" className=\"gap-2\">\n        <Plus className=\"h-5 w-5\" />\n        Create Your First Canvas\n      </Button>\n\n      {/* Feature highlights */}\n      <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4 mt-12 max-w-2xl\">\n        <FeatureCard\n          icon={<Layout className=\"h-5 w-5\" />}\n          title=\"Infinite Space\"\n          description=\"Unlimited canvas to explore any idea\"\n        />\n        <FeatureCard\n          icon={<Layers className=\"h-5 w-5\" />}\n          title=\"Project Linked\"\n          description=\"Connect canvases to your projects\"\n        />\n        <FeatureCard\n          icon={<Layout className=\"h-5 w-5\" />}\n          title=\"AI Generation\"\n          description=\"Generate images, code, and more\"\n        />\n      </div>\n    </motion.div>\n  );\n}\n\nfunction FeatureCard({\n  icon,\n  title,\n  description,\n}: {\n  icon: React.ReactNode;\n  title: string;\n  description: string;\n}) {\n  return (\n    <div className=\"text-center p-4 rounded-lg bg-muted/50\">\n      <div className=\"inline-flex p-2 rounded-lg bg-primary/10 text-primary mb-2\">\n        {icon}\n      </div>\n      <h3 className=\"font-medium text-sm\">{title}</h3>\n      <p className=\"text-xs text-muted-foreground mt-1\">{description}</p>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 11017, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/design-canvas/ImageBrowser.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  X,\n  FolderOpen,\n  Image as ImageIcon,\n  RefreshCw,\n  ChevronRight,\n  Trash2,\n} from \"lucide-react\";\n\ninterface ContentImage {\n  filename: string;\n  path: string;\n  url?: string; // Blob URL if available\n  size: number;\n  modified: string;\n}\n\ninterface ImageBrowserProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSelectImage: (imageUrl: string, filename: string) => void;\n}\n\nconst FOLDERS = [\n  { id: \"ep01/style-tests\", label: \"Style Tests\" },\n  { id: \"ep01/frames\", label: \"Frames\" },\n  { id: \"ep01/storyboard\", label: \"Storyboard\" },\n  { id: \"ep01/characters\", label: \"Characters\" },\n];\n\nexport function ImageBrowser({\n  isOpen,\n  onClose,\n  onSelectImage,\n}: ImageBrowserProps) {\n  const [images, setImages] = useState<ContentImage[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [selectedFolder, setSelectedFolder] = useState(FOLDERS[0].id);\n  const [error, setError] = useState<string | null>(null);\n  const [deleting, setDeleting] = useState<string | null>(null);\n\n  const handleDelete = async (image: ContentImage, e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (!confirm(`Delete ${image.filename}?`)) return;\n\n    setDeleting(image.filename);\n    try {\n      // Delete from blob if URL exists\n      if (image.url) {\n        await fetch(\"/api/blob/delete\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ url: image.url }),\n        });\n      }\n      // Delete local file\n      await fetch(`/api/content-images/file?path=${encodeURIComponent(\n        `${selectedFolder}/${image.filename}`\n      )}`, { method: \"DELETE\" });\n\n      // Remove from list\n      setImages((prev) => prev.filter((i) => i.filename !== image.filename));\n    } catch (err) {\n      console.error(\"Delete failed:\", err);\n    } finally {\n      setDeleting(null);\n    }\n  };\n\n  const fetchImages = async (folder: string) => {\n    setLoading(true);\n    setError(null);\n    try {\n      const res = await fetch(\n        `/api/content-images?folder=${encodeURIComponent(folder)}`\n      );\n      const data = await res.json();\n      if (data.images) {\n        setImages(data.images);\n      } else {\n        setError(\"No images found\");\n        setImages([]);\n      }\n    } catch (err) {\n      setError(\"Failed to load images\");\n      setImages([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    if (isOpen) {\n      fetchImages(selectedFolder);\n    }\n  }, [isOpen, selectedFolder]);\n\n  const formatSize = (bytes: number) => {\n    if (bytes < 1024) return `${bytes}B`;\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)}KB`;\n    return `${(bytes / (1024 * 1024)).toFixed(1)}MB`;\n  };\n\n  const formatName = (filename: string) => {\n    // Clean up filenames like nick-pov-shoulders_1770576016454.png\n    return filename\n      .replace(/\\.(png|jpg|jpeg|webp|gif)$/i, \"\")\n      .replace(/_\\d+$/, \"\")\n      .replace(/-/g, \" \")\n      .replace(/\\b\\w/g, (c) => c.toUpperCase());\n  };\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <motion.div\n          initial={{ x: \"100%\", opacity: 0 }}\n          animate={{ x: 0, opacity: 1 }}\n          exit={{ x: \"100%\", opacity: 0 }}\n          transition={{ type: \"spring\", damping: 25, stiffness: 300 }}\n          className=\"fixed right-0 top-0 bottom-0 w-80 bg-background/95 backdrop-blur-xl border-l shadow-2xl z-50 flex flex-col\"\n        >\n          {/* Header */}\n          <div className=\"flex items-center justify-between p-4 border-b\">\n            <div className=\"flex items-center gap-2\">\n              <ImageIcon className=\"h-5 w-5 text-primary\" />\n              <h2 className=\"font-semibold\">Content Images</h2>\n            </div>\n            <div className=\"flex items-center gap-1\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"h-8 w-8\"\n                onClick={() => fetchImages(selectedFolder)}\n              >\n                <RefreshCw\n                  className={cn(\"h-4 w-4\", loading && \"animate-spin\")}\n                />\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"h-8 w-8\"\n                onClick={onClose}\n              >\n                <X className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n\n          {/* Folder Selector */}\n          <div className=\"p-3 border-b bg-muted/30\">\n            <div className=\"flex items-center gap-2 mb-2 text-sm text-muted-foreground\">\n              <FolderOpen className=\"h-4 w-4\" />\n              <span>Folder</span>\n            </div>\n            <div className=\"flex flex-wrap gap-1\">\n              {FOLDERS.map((folder) => (\n                <Button\n                  key={folder.id}\n                  variant={selectedFolder === folder.id ? \"secondary\" : \"ghost\"}\n                  size=\"sm\"\n                  className=\"text-xs h-7\"\n                  onClick={() => setSelectedFolder(folder.id)}\n                >\n                  {folder.label}\n                </Button>\n              ))}\n            </div>\n          </div>\n\n          {/* Image Grid */}\n          <div className=\"flex-1 overflow-y-auto p-3\">\n            {loading ? (\n              <div className=\"flex items-center justify-center h-32\">\n                <RefreshCw className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n              </div>\n            ) : error ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                {error}\n              </div>\n            ) : images.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                No images in this folder\n              </div>\n            ) : (\n              <div className=\"grid grid-cols-2 gap-2\">\n                {images.map((image) => (\n                  <motion.button\n                    key={image.filename}\n                    whileHover={{ scale: 1.02 }}\n                    whileTap={{ scale: 0.98 }}\n                    className=\"group relative aspect-square rounded-lg overflow-hidden border bg-muted/50 hover:border-primary transition-colors\"\n                    onClick={() => onSelectImage(image.url || image.path, image.filename)}\n                  >\n                    {/* eslint-disable-next-line @next/next/no-img-element */}\n                    <img\n                      src={image.url || image.path}\n                      alt={image.filename}\n                      className=\"w-full h-full object-cover\"\n                      loading=\"lazy\"\n                    />\n                    <div className=\"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 to-transparent p-2 opacity-0 group-hover:opacity-100 transition-opacity\">\n                      <p className=\"text-[10px] text-white truncate\">\n                        {formatName(image.filename)}\n                      </p>\n                      <p className=\"text-[8px] text-white/70\">\n                        {formatSize(image.size)}\n                      </p>\n                    </div>\n                    <div className=\"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1\">\n                      <button\n                        onClick={(e) => handleDelete(image, e)}\n                        className=\"bg-red-500 hover:bg-red-600 text-white rounded-full p-1 transition-colors\"\n                        disabled={deleting === image.filename}\n                      >\n                        {deleting === image.filename ? (\n                          <RefreshCw className=\"h-3 w-3 animate-spin\" />\n                        ) : (\n                          <Trash2 className=\"h-3 w-3\" />\n                        )}\n                      </button>\n                      <div className=\"bg-primary text-primary-foreground rounded-full p-1\">\n                        <ChevronRight className=\"h-3 w-3\" />\n                      </div>\n                    </div>\n                  </motion.button>\n                ))}\n              </div>\n            )}\n          </div>\n\n          {/* Footer */}\n          <div className=\"p-3 border-t bg-muted/30 text-xs text-muted-foreground text-center\">\n            Click an image to add it to the canvas\n          </div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 11448, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/design-canvas/MermaidDialog.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useCallback, useEffect } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { cn } from \"@/lib/utils\";\nimport { X, Play, Download, Sparkles, GitBranch, Code2, Upload, ChevronDown } from \"lucide-react\";\nimport DOMPurify from \"dompurify\";\nimport { MERMAID_TEMPLATES, mermaidToCanvas, canvasToMermaid, buildDiagramPrompt } from \"@/lib/canvas/diagram-utils\";\n\ninterface MermaidDialogProps {\n  open: boolean;\n  onClose: () => void;\n  onInsert: (\n    nodes: Array<{\n      id: string;\n      type: string;\n      x: number;\n      y: number;\n      width: number;\n      height: number;\n      content: string;\n      style?: Record<string, unknown>;\n    }>,\n    edges: Array<{\n      id: string;\n      source: string;\n      target: string;\n      type: string;\n      label?: string;\n    }>\n  ) => void;\n  existingNodes?: Array<{ id: string; type: string; x: number; y: number; width: number; height: number; content: string; style?: Record<string, unknown> }>;\n  existingEdges?: Array<{ id: string; source: string; target: string; type: string; label?: string }>;\n}\n\nexport function MermaidDialog({ open, onClose, onInsert, existingNodes, existingEdges }: MermaidDialogProps) {\n  const [tab, setTab] = useState<\"mermaid\" | \"ai\">(\"mermaid\");\n  const [definition, setDefinition] = useState(MERMAID_TEMPLATES.flowchart.code);\n  const [aiPrompt, setAiPrompt] = useState(\"\");\n  const [error, setError] = useState<string | null>(null);\n  const [previewSvg, setPreviewSvg] = useState<string>(\"\");\n  const [isRendering, setIsRendering] = useState(false);\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [showTemplates, setShowTemplates] = useState(false);\n  const previewRef = useRef<HTMLDivElement>(null);\n\n  // Render Mermaid preview\n  const renderPreview = useCallback(async () => {\n    if (!definition.trim()) {\n      setPreviewSvg(\"\");\n      setError(null);\n      return;\n    }\n\n    setIsRendering(true);\n    setError(null);\n\n    try {\n      const mermaidModule = await import(\"mermaid\");\n      const mermaid = mermaidModule.default;\n      mermaid.initialize({\n        startOnLoad: false,\n        theme: \"dark\",\n        themeVariables: {\n          primaryColor: \"#3b82f6\",\n          primaryTextColor: \"#ffffff\",\n          primaryBorderColor: \"#1d4ed8\",\n          lineColor: \"#6b7280\",\n          secondaryColor: \"#8b5cf6\",\n          tertiaryColor: \"#22c55e\",\n        },\n      });\n\n      const uniqueId = `mermaid-preview-${Date.now()}`;\n      const { svg } = await mermaid.render(uniqueId, definition);\n      setPreviewSvg(svg);\n    } catch (err) {\n      const message = err instanceof Error ? err.message : \"Failed to parse Mermaid syntax\";\n      setError(message);\n      setPreviewSvg(\"\");\n    } finally {\n      setIsRendering(false);\n    }\n  }, [definition]);\n\n  // Auto-render on definition change (debounced)\n  useEffect(() => {\n    if (!open) return;\n    const timer = setTimeout(renderPreview, 500);\n    return () => clearTimeout(timer);\n  }, [definition, open, renderPreview]);\n\n  // Insert diagram to canvas\n  const handleInsert = useCallback(async () => {\n    try {\n      const { nodes, edges } = await mermaidToCanvas(definition);\n      if (nodes.length === 0) {\n        setError(\"No diagram elements found. Check your Mermaid syntax.\");\n        return;\n      }\n      onInsert(nodes, edges);\n      onClose();\n    } catch (err) {\n      setError(\"Failed to convert diagram. Please check the syntax.\");\n    }\n  }, [definition, onInsert, onClose]);\n\n  // Generate Mermaid from AI\n  const handleAIGenerate = useCallback(async () => {\n    if (!aiPrompt.trim()) return;\n    setIsGenerating(true);\n    setError(null);\n\n    try {\n      const prompt = buildDiagramPrompt(aiPrompt);\n      const response = await fetch(\"/api/chat\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          messages: [{ role: \"user\", content: prompt }],\n          model: \"claude\",\n        }),\n      });\n\n      if (!response.ok) throw new Error(\"AI generation failed\");\n\n      const data = await response.json();\n      const generatedText = data.content || data.message?.content || \"\";\n      \n      // Clean up the response - extract just the Mermaid code\n      let mermaidCode = generatedText\n        .replace(/```mermaid\\n?/g, \"\")\n        .replace(/```\\n?/g, \"\")\n        .trim();\n\n      if (mermaidCode) {\n        setDefinition(mermaidCode);\n        setTab(\"mermaid\");\n      } else {\n        setError(\"AI could not generate a valid diagram. Try a more specific description.\");\n      }\n    } catch (err) {\n      setError(\"Failed to generate diagram. Please try again.\");\n    } finally {\n      setIsGenerating(false);\n    }\n  }, [aiPrompt]);\n\n  // Reverse engineer: canvas to Mermaid\n  const handleReverseEngineer = useCallback(() => {\n    if (!existingNodes || existingNodes.length === 0) {\n      setError(\"No canvas elements to reverse engineer.\");\n      return;\n    }\n    const mermaid = canvasToMermaid(existingNodes, existingEdges || []);\n    setDefinition(mermaid);\n    setTab(\"mermaid\");\n  }, [existingNodes, existingEdges]);\n\n  if (!open) return null;\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4\"\n        onClick={onClose}\n      >\n        <motion.div\n          initial={{ opacity: 0, scale: 0.95, y: 20 }}\n          animate={{ opacity: 1, scale: 1, y: 0 }}\n          exit={{ opacity: 0, scale: 0.95, y: 20 }}\n          transition={{ duration: 0.2 }}\n          className=\"w-full max-w-4xl max-h-[85vh] bg-background border border-border rounded-2xl shadow-2xl flex flex-col overflow-hidden\"\n          onClick={(e) => e.stopPropagation()}\n        >\n          {/* Header */}\n          <div className=\"flex items-center justify-between px-6 py-4 border-b\">\n            <div className=\"flex items-center gap-3\">\n              <GitBranch className=\"w-5 h-5 text-primary\" />\n              <h2 className=\"text-lg font-semibold\">Text to Diagram</h2>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              {existingNodes && existingNodes.length > 0 && (\n                <button\n                  onClick={handleReverseEngineer}\n                  className=\"px-3 py-1.5 text-sm rounded-lg bg-muted hover:bg-muted/80 transition-colors flex items-center gap-1.5\"\n                >\n                  <Upload className=\"w-3.5 h-3.5\" />\n                  From Canvas\n                </button>\n              )}\n              <button onClick={onClose} className=\"p-2 rounded-lg hover:bg-muted transition-colors\">\n                <X className=\"w-4 h-4\" />\n              </button>\n            </div>\n          </div>\n\n          {/* Tabs */}\n          <div className=\"flex border-b px-6\">\n            <button\n              onClick={() => setTab(\"mermaid\")}\n              className={cn(\n                \"px-4 py-2.5 text-sm font-medium border-b-2 transition-colors -mb-px\",\n                tab === \"mermaid\"\n                  ? \"border-primary text-foreground\"\n                  : \"border-transparent text-muted-foreground hover:text-foreground\"\n              )}\n            >\n              <Code2 className=\"w-4 h-4 inline mr-1.5\" />\n              Mermaid\n            </button>\n            <button\n              onClick={() => setTab(\"ai\")}\n              className={cn(\n                \"px-4 py-2.5 text-sm font-medium border-b-2 transition-colors -mb-px\",\n                tab === \"ai\"\n                  ? \"border-primary text-foreground\"\n                  : \"border-transparent text-muted-foreground hover:text-foreground\"\n              )}\n            >\n              <Sparkles className=\"w-4 h-4 inline mr-1.5\" />\n              AI Generate\n            </button>\n          </div>\n\n          {/* Content */}\n          <div className=\"flex-1 flex flex-col md:flex-row overflow-hidden\">\n            {/* Left: Input */}\n            <div className=\"flex-1 flex flex-col border-r min-h-0\">\n              {tab === \"mermaid\" ? (\n                <>\n                  {/* Template selector */}\n                  <div className=\"px-4 py-2 border-b\">\n                    <div className=\"relative\">\n                      <button\n                        onClick={() => setShowTemplates(!showTemplates)}\n                        className=\"flex items-center gap-1.5 text-sm text-muted-foreground hover:text-foreground transition-colors\"\n                      >\n                        Templates\n                        <ChevronDown className={cn(\"w-3.5 h-3.5 transition-transform\", showTemplates && \"rotate-180\")} />\n                      </button>\n                      {showTemplates && (\n                        <div className=\"absolute top-full left-0 mt-1 z-10 bg-background border rounded-lg shadow-lg py-1 min-w-[180px]\">\n                          {Object.entries(MERMAID_TEMPLATES).map(([key, template]) => (\n                            <button\n                              key={key}\n                              onClick={() => {\n                                setDefinition(template.code);\n                                setShowTemplates(false);\n                              }}\n                              className=\"w-full text-left px-3 py-2 text-sm hover:bg-muted transition-colors\"\n                            >\n                              {template.label}\n                            </button>\n                          ))}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                  <textarea\n                    value={definition}\n                    onChange={(e) => setDefinition(e.target.value)}\n                    className=\"flex-1 p-4 bg-transparent font-mono text-sm resize-none outline-none min-h-[200px]\"\n                    placeholder=\"Enter Mermaid diagram syntax...\"\n                    spellCheck={false}\n                  />\n                </>\n              ) : (\n                <div className=\"flex-1 flex flex-col p-4 gap-4\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    Describe your diagram in natural language and AI will generate the Mermaid syntax.\n                  </p>\n                  <textarea\n                    value={aiPrompt}\n                    onChange={(e) => setAiPrompt(e.target.value)}\n                    className=\"flex-1 p-3 bg-muted/30 rounded-lg text-sm resize-none outline-none border focus:border-primary transition-colors min-h-[150px]\"\n                    placeholder=\"e.g., A user authentication flow with login, registration, password reset, and email verification...\"\n                  />\n                  <button\n                    onClick={handleAIGenerate}\n                    disabled={isGenerating || !aiPrompt.trim()}\n                    className={cn(\n                      \"flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors\",\n                      isGenerating\n                        ? \"bg-muted text-muted-foreground cursor-wait\"\n                        : \"bg-primary text-primary-foreground hover:bg-primary/90\"\n                    )}\n                  >\n                    <Sparkles className={cn(\"w-4 h-4\", isGenerating && \"animate-spin\")} />\n                    {isGenerating ? \"Generating...\" : \"Generate Diagram\"}\n                  </button>\n                </div>\n              )}\n            </div>\n\n            {/* Right: Preview */}\n            <div className=\"flex-1 flex flex-col min-h-0\">\n              <div className=\"px-4 py-2 border-b flex items-center justify-between\">\n                <span className=\"text-sm font-medium text-muted-foreground\">Preview</span>\n                {isRendering && (\n                  <span className=\"text-xs text-muted-foreground animate-pulse\">Rendering...</span>\n                )}\n              </div>\n              <div\n                ref={previewRef}\n                className=\"flex-1 overflow-auto p-4 flex items-center justify-center min-h-[200px]\"\n              >\n                {previewSvg ? (\n                  <div\n                    className=\"max-w-full [&_svg]:max-w-full [&_svg]:h-auto\"\n                    dangerouslySetInnerHTML={{ __html: previewSvg }}\n                  />\n                ) : error ? (\n                  <div className=\"text-center text-sm\">\n                    <div className=\"text-red-400 mb-2\">Syntax Error</div>\n                    <div className=\"text-muted-foreground text-xs max-w-xs\">{error}</div>\n                  </div>\n                ) : (\n                  <div className=\"text-muted-foreground text-sm text-center\">\n                    <GitBranch className=\"w-8 h-8 mx-auto mb-2 opacity-30\" />\n                    <p>Enter Mermaid syntax to see preview</p>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* Error bar */}\n          {error && tab === \"mermaid\" && (\n            <div className=\"px-6 py-2 bg-red-500/10 border-t border-red-500/20\">\n              <p className=\"text-sm text-red-400\">{error}</p>\n            </div>\n          )}\n\n          {/* Footer */}\n          <div className=\"flex items-center justify-between px-6 py-4 border-t\">\n            <button\n              onClick={onClose}\n              className=\"px-4 py-2 text-sm rounded-lg hover:bg-muted transition-colors\"\n            >\n              Cancel\n            </button>\n            <div className=\"flex items-center gap-2\">\n              <button\n                onClick={renderPreview}\n                className=\"flex items-center gap-1.5 px-4 py-2 text-sm rounded-lg bg-muted hover:bg-muted/80 transition-colors\"\n              >\n                <Play className=\"w-3.5 h-3.5\" />\n                Preview\n              </button>\n              <button\n                onClick={handleInsert}\n                disabled={!definition.trim()}\n                className={cn(\n                  \"flex items-center gap-1.5 px-4 py-2 text-sm rounded-lg font-medium transition-colors\",\n                  definition.trim()\n                    ? \"bg-primary text-primary-foreground hover:bg-primary/90\"\n                    : \"bg-muted text-muted-foreground cursor-not-allowed\"\n                )}\n              >\n                <Download className=\"w-3.5 h-3.5\" />\n                Insert to Canvas\n              </button>\n            </div>\n          </div>\n        </motion.div>\n      </motion.div>\n    </AnimatePresence>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}