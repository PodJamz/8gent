{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/agent/AgentSidebar.tsx"],"sourcesContent":["'use client';\n\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Plus,\n  MessageSquare,\n  Trash2,\n  X,\n  Brain,\n  Database,\n  Clock,\n  ChevronRight,\n  Zap,\n  AtSign,\n  FileCode,\n  Folder,\n  FileText,\n} from 'lucide-react';\nimport { ChatThread } from '@/hooks/useChatThreads';\nimport { cn } from '@/lib/utils';\n\n// Import theme styles\nimport '@/lib/themes/themes.css';\n\n// =============================================================================\n// Types\n// =============================================================================\n\ninterface MemoryStats {\n  episodic: number;\n  semantic: number;\n  working: number;\n}\n\ninterface RecentMention {\n  id: string;\n  type: 'project' | 'prd' | 'ticket' | 'file';\n  name: string;\n  timestamp: number;\n}\n\ninterface ActiveTask {\n  id: string;\n  title: string;\n  status: 'pending' | 'running' | 'paused' | 'completed' | 'failed';\n  progress?: number;\n}\n\ninterface AgentSidebarProps {\n  isOpen: boolean;\n  onClose: () => void;\n  threads: ChatThread[];\n  activeThreadId: string | null;\n  onNewThread: () => void;\n  onSelectThread: (threadId: string) => void;\n  onDeleteThread: (threadId: string) => void;\n  memoryStats?: MemoryStats;\n  recentMentions?: RecentMention[];\n  activeTask?: ActiveTask | null;\n  onMentionClick?: (mention: RecentMention) => void;\n}\n\n// =============================================================================\n// Utility Functions\n// =============================================================================\n\nfunction formatTimeAgo(timestamp: number): string {\n  const now = Date.now();\n  const diff = now - timestamp;\n\n  const minutes = Math.floor(diff / 60000);\n  const hours = Math.floor(diff / 3600000);\n  const days = Math.floor(diff / 86400000);\n\n  if (minutes < 1) return 'Just now';\n  if (minutes < 60) return `${minutes}m ago`;\n  if (hours < 24) return `${hours}h ago`;\n  if (days < 7) return `${days}d ago`;\n\n  return new Date(timestamp).toLocaleDateString();\n}\n\nfunction getMentionIcon(type: RecentMention['type']) {\n  switch (type) {\n    case 'project':\n      return Folder;\n    case 'prd':\n      return FileText;\n    case 'ticket':\n      return FileCode;\n    case 'file':\n      return FileCode;\n    default:\n      return AtSign;\n  }\n}\n\nfunction getStatusColor(status: ActiveTask['status']) {\n  switch (status) {\n    case 'running':\n      return 'text-green-400';\n    case 'paused':\n      return 'text-yellow-400';\n    case 'failed':\n      return 'text-red-400';\n    case 'completed':\n      return 'text-blue-400';\n    default:\n      return 'text-muted-foreground';\n  }\n}\n\n// =============================================================================\n// Component\n// =============================================================================\n\nexport function AgentSidebar({\n  isOpen,\n  onClose,\n  threads,\n  activeThreadId,\n  onNewThread,\n  onSelectThread,\n  onDeleteThread,\n  memoryStats = { episodic: 0, semantic: 0, working: 0 },\n  recentMentions = [],\n  activeTask = null,\n  onMentionClick,\n}: AgentSidebarProps) {\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          {/* Backdrop - mobile only */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            transition={{ duration: 0.2 }}\n            onClick={onClose}\n            className=\"fixed inset-0 bg-black/40 backdrop-blur-sm z-40 lg:hidden\"\n          />\n\n          {/* Sidebar */}\n          <motion.aside\n            initial={{ x: '-100%', opacity: 0 }}\n            animate={{ x: 0, opacity: 1 }}\n            exit={{ x: '-100%', opacity: 0 }}\n            transition={{ type: 'spring', damping: 30, stiffness: 300 }}\n            className={cn(\n              'fixed lg:relative inset-y-0 left-0 z-50 lg:z-auto',\n              'w-80 max-w-[85vw] lg:w-72 xl:w-80',\n              'flex flex-col',\n              'touch-none lg:touch-auto'\n            )}\n            style={{\n              paddingTop: 'env(safe-area-inset-top, 0px)',\n              paddingBottom: 'env(safe-area-inset-bottom, 0px)',\n              background: 'hsl(var(--theme-chat-sidebar-bg, var(--theme-card)))',\n              borderRight: '1px solid hsl(var(--theme-chat-sidebar-border, var(--theme-border)))',\n              fontFamily: 'var(--theme-font)',\n            }}\n          >\n            {/* Header */}\n            <div\n              className=\"flex items-center justify-between px-4 py-4\"\n              style={{ borderBottom: '1px solid hsl(var(--theme-border))' }}\n            >\n              <div className=\"flex items-center gap-2\">\n                <div\n                  className=\"w-8 h-8 rounded-lg flex items-center justify-center\"\n                  style={{ background: 'hsl(var(--theme-primary) / 0.2)' }}\n                >\n                  <Zap className=\"w-4 h-4\" style={{ color: 'hsl(var(--theme-primary))' }} />\n                </div>\n                <h2 className=\"text-lg font-semibold\" style={{ color: 'hsl(var(--theme-foreground))' }}>\n                  Agent\n                </h2>\n              </div>\n              <button\n                onClick={onClose}\n                className=\"p-2 rounded-full transition-colors lg:hidden\"\n                style={{ color: 'hsl(var(--theme-muted-foreground))' }}\n                onMouseEnter={(e) => e.currentTarget.style.background = 'hsl(var(--theme-muted))'}\n                onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}\n              >\n                <X className=\"w-5 h-5\" />\n              </button>\n            </div>\n\n            {/* New Chat Button */}\n            <div className=\"px-3 py-3\">\n              <button\n                onClick={() => {\n                  onNewThread();\n                  onClose();\n                }}\n                className=\"w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all\"\n                style={{\n                  background: 'hsl(var(--theme-primary))',\n                  color: 'hsl(var(--theme-primary-foreground))',\n                }}\n                onMouseEnter={(e) => e.currentTarget.style.opacity = '0.9'}\n                onMouseLeave={(e) => e.currentTarget.style.opacity = '1'}\n              >\n                <Plus className=\"w-5 h-5\" />\n                <span className=\"font-medium\">New session</span>\n              </button>\n            </div>\n\n            {/* Active Task (if any) */}\n            {activeTask && (\n              <div className=\"px-3 pb-2\">\n                <div className=\"px-3 py-2.5 rounded-lg bg-muted/50 border border-border\">\n                  <div className=\"flex items-center gap-2 mb-1\">\n                    <div className={cn('w-2 h-2 rounded-full',\n                      activeTask.status === 'running' && 'bg-green-400 animate-pulse',\n                      activeTask.status === 'paused' && 'bg-yellow-400',\n                      activeTask.status === 'completed' && 'bg-blue-400',\n                      activeTask.status === 'failed' && 'bg-red-400',\n                      activeTask.status === 'pending' && 'bg-muted-foreground'\n                    )} />\n                    <span className={cn('text-xs font-medium uppercase', getStatusColor(activeTask.status))}>\n                      {activeTask.status}\n                    </span>\n                  </div>\n                  <p className=\"text-sm text-foreground truncate\">{activeTask.title}</p>\n                  {activeTask.progress !== undefined && (\n                    <div className=\"mt-2 h-1 rounded-full bg-muted overflow-hidden\">\n                      <motion.div\n                        className=\"h-full bg-primary\"\n                        initial={{ width: 0 }}\n                        animate={{ width: `${activeTask.progress}%` }}\n                        transition={{ duration: 0.3 }}\n                      />\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n\n            {/* Memory Indicator */}\n            <div className=\"px-3 pb-2\">\n              <div\n                className=\"px-3 py-2 rounded-lg\"\n                style={{ background: 'hsl(var(--theme-muted) / 0.3)' }}\n              >\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <Brain className=\"w-4 h-4\" style={{ color: 'hsl(var(--theme-muted-foreground))' }} />\n                  <span\n                    className=\"text-xs font-medium uppercase tracking-wide\"\n                    style={{ color: 'hsl(var(--theme-muted-foreground))' }}\n                  >\n                    Memory\n                  </span>\n                </div>\n                <div className=\"grid grid-cols-3 gap-2\">\n                  <div className=\"text-center\">\n                    <div className=\"text-lg font-semibold\" style={{ color: 'hsl(var(--theme-foreground))' }}>{memoryStats.episodic}</div>\n                    <div className=\"text-[10px]\" style={{ color: 'hsl(var(--theme-muted-foreground))' }}>Episodic</div>\n                  </div>\n                  <div className=\"text-center\">\n                    <div className=\"text-lg font-semibold\" style={{ color: 'hsl(var(--theme-foreground))' }}>{memoryStats.semantic}</div>\n                    <div className=\"text-[10px]\" style={{ color: 'hsl(var(--theme-muted-foreground))' }}>Semantic</div>\n                  </div>\n                  <div className=\"text-center\">\n                    <div className=\"text-lg font-semibold\" style={{ color: 'hsl(var(--theme-foreground))' }}>{memoryStats.working}</div>\n                    <div className=\"text-[10px]\" style={{ color: 'hsl(var(--theme-muted-foreground))' }}>Working</div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Recent @ Mentions */}\n            {recentMentions.length > 0 && (\n              <div className=\"px-3 pb-2\">\n                <div className=\"px-1 mb-2\">\n                  <span\n                    className=\"text-xs font-medium uppercase tracking-wide flex items-center gap-1.5\"\n                    style={{ color: 'hsl(var(--theme-muted-foreground))' }}\n                  >\n                    <AtSign className=\"w-3 h-3\" />\n                    Recent Mentions\n                  </span>\n                </div>\n                <div className=\"space-y-1\">\n                  {recentMentions.slice(0, 5).map((mention) => {\n                    const Icon = getMentionIcon(mention.type);\n                    return (\n                      <button\n                        key={mention.id}\n                        onClick={() => onMentionClick?.(mention)}\n                        className=\"w-full flex items-center gap-2 px-2 py-1.5 rounded-md transition-colors text-left\"\n                        onMouseEnter={(e) => e.currentTarget.style.background = 'hsl(var(--theme-muted))'}\n                        onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}\n                      >\n                        <Icon className=\"w-3.5 h-3.5 flex-shrink-0\" style={{ color: 'hsl(var(--theme-muted-foreground))' }} />\n                        <span className=\"text-sm truncate flex-1\" style={{ color: 'hsl(var(--theme-foreground))' }}>\n                          @{mention.name}\n                        </span>\n                        <ChevronRight className=\"w-3 h-3\" style={{ color: 'hsl(var(--theme-muted-foreground) / 0.5)' }} />\n                      </button>\n                    );\n                  })}\n                </div>\n              </div>\n            )}\n\n            {/* Thread List */}\n            <div className=\"flex-1 overflow-y-auto px-3 pb-3\">\n              <div className=\"px-1 mb-2\">\n                <span\n                  className=\"text-xs font-medium uppercase tracking-wide flex items-center gap-1.5\"\n                  style={{ color: 'hsl(var(--theme-muted-foreground))' }}\n                >\n                  <MessageSquare className=\"w-3 h-3\" />\n                  Sessions\n                </span>\n              </div>\n\n              {threads.length === 0 ? (\n                <div className=\"text-center py-8 px-4\">\n                  <MessageSquare className=\"w-12 h-12 mx-auto mb-3\" style={{ color: 'hsl(var(--theme-muted-foreground) / 0.3)' }} />\n                  <p className=\"text-sm\" style={{ color: 'hsl(var(--theme-muted-foreground))' }}>No sessions yet</p>\n                  <p className=\"text-xs mt-1\" style={{ color: 'hsl(var(--theme-muted-foreground) / 0.7)' }}>\n                    Start a new session to begin\n                  </p>\n                </div>\n              ) : (\n                <div className=\"space-y-1\">\n                  {threads.map((thread) => (\n                    <motion.div\n                      key={thread.id}\n                      layout\n                      initial={{ opacity: 0, y: 10 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      className=\"group relative\"\n                    >\n                      <button\n                        onClick={() => {\n                          onSelectThread(thread.id);\n                          // Only close on mobile\n                          if (window.innerWidth < 1024) {\n                            onClose();\n                          }\n                        }}\n                        className=\"w-full text-left px-3 py-2.5 rounded-lg transition-all\"\n                        style={{\n                          background: thread.id === activeThreadId ? 'hsl(var(--theme-primary) / 0.1)' : 'transparent',\n                          borderLeft: thread.id === activeThreadId\n                            ? '2px solid hsl(var(--theme-chat-sidebar-active, var(--theme-primary)))'\n                            : '2px solid transparent',\n                        }}\n                        onMouseEnter={(e) => {\n                          if (thread.id !== activeThreadId) e.currentTarget.style.background = 'hsl(var(--theme-chat-sidebar-hover, var(--theme-muted)))';\n                        }}\n                        onMouseLeave={(e) => {\n                          if (thread.id !== activeThreadId) e.currentTarget.style.background = 'transparent';\n                        }}\n                      >\n                        <div className=\"flex items-start gap-2.5\">\n                          <MessageSquare\n                            className=\"w-4 h-4 mt-0.5 flex-shrink-0\"\n                            style={{\n                              color: thread.id === activeThreadId\n                                ? 'hsl(var(--theme-primary))'\n                                : 'hsl(var(--theme-muted-foreground))',\n                            }}\n                          />\n                          <div className=\"flex-1 min-w-0\">\n                            <p\n                              className=\"text-sm font-medium truncate\"\n                              style={{\n                                color: thread.id === activeThreadId\n                                  ? 'hsl(var(--theme-foreground))'\n                                  : 'hsl(var(--theme-muted-foreground))',\n                              }}\n                            >\n                              {thread.title}\n                            </p>\n                            <div className=\"flex items-center gap-2 mt-0.5\">\n                              <span className=\"text-[10px]\" style={{ color: 'hsl(var(--theme-muted-foreground) / 0.7)' }}>\n                                {thread.messages.length} msg{thread.messages.length !== 1 ? 's' : ''}\n                              </span>\n                              <span className=\"text-[10px]\" style={{ color: 'hsl(var(--theme-muted-foreground) / 0.5)' }}>Â·</span>\n                              <span className=\"text-[10px]\" style={{ color: 'hsl(var(--theme-muted-foreground) / 0.7)' }}>\n                                {formatTimeAgo(thread.lastModified)}\n                              </span>\n                            </div>\n                          </div>\n                        </div>\n                      </button>\n\n                      {/* Delete button (on hover) */}\n                      <button\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          onDeleteThread(thread.id);\n                        }}\n                        className=\"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 rounded-md opacity-0 group-hover:opacity-100 focus:opacity-100 transition-opacity\"\n                        aria-label=\"Delete session\"\n                        style={{ background: 'hsl(var(--theme-muted))' }}\n                        onMouseEnter={(e) => e.currentTarget.style.background = 'hsl(0 84% 60% / 0.2)'}\n                        onMouseLeave={(e) => e.currentTarget.style.background = 'hsl(var(--theme-muted))'}\n                      >\n                        <Trash2 className=\"w-3.5 h-3.5\" style={{ color: 'hsl(var(--theme-muted-foreground))' }} />\n                      </button>\n                    </motion.div>\n                  ))}\n                </div>\n              )}\n            </div>\n\n            {/* Footer */}\n            <div\n              className=\"px-4 py-3\"\n              style={{ borderTop: '1px solid hsl(var(--theme-border))' }}\n            >\n              <div className=\"flex items-center justify-between text-xs\" style={{ color: 'hsl(var(--theme-muted-foreground))' }}>\n                <span>{threads.length} session{threads.length !== 1 ? 's' : ''}</span>\n                <div className=\"flex items-center gap-1.5\">\n                  <Database className=\"w-3 h-3\" />\n                  <span>Convex</span>\n                </div>\n              </div>\n            </div>\n          </motion.aside>\n        </>\n      )}\n    </AnimatePresence>\n  );\n}\n\nexport default AgentSidebar;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 875, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/agent/ContextBar.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  ChevronRight,\n  ChevronDown,\n  Folder,\n  FileText,\n  FileCode,\n  Ticket,\n  X,\n  Layers,\n  Eye,\n  Code,\n  Kanban,\n  BookOpen,\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport type ContextEntityType = 'project' | 'prd' | 'epic' | 'ticket' | 'file';\nexport type ViewDimension = 'chat' | 'code' | 'kanban' | 'docs';\n\nexport interface ContextEntity {\n  id: string;\n  type: ContextEntityType;\n  name: string;\n  description?: string;\n  status?: string;\n  metadata?: Record<string, unknown>;\n}\n\ninterface ContextBarProps {\n  contextChain: ContextEntity[];\n  currentView: ViewDimension;\n  onViewChange: (view: ViewDimension) => void;\n  onEntityClick: (entity: ContextEntity) => void;\n  onRemoveEntity: (entityId: string) => void;\n  onClearContext: () => void;\n  className?: string;\n}\n\n// =============================================================================\n// Config\n// =============================================================================\n\nconst ENTITY_CONFIG: Record<ContextEntityType, { icon: typeof Folder; color: string; label: string }> = {\n  project: { icon: Folder, color: 'text-blue-400', label: 'Project' },\n  prd: { icon: FileText, color: 'text-purple-400', label: 'PRD' },\n  epic: { icon: Layers, color: 'text-amber-400', label: 'Epic' },\n  ticket: { icon: Ticket, color: 'text-green-400', label: 'Ticket' },\n  file: { icon: FileCode, color: 'text-orange-400', label: 'File' },\n};\n\nconst VIEW_CONFIG: Record<ViewDimension, { icon: typeof Eye; label: string }> = {\n  chat: { icon: Eye, label: 'Chat' },\n  code: { icon: Code, label: 'Code' },\n  kanban: { icon: Kanban, label: 'Kanban' },\n  docs: { icon: BookOpen, label: 'Docs' },\n};\n\n// =============================================================================\n// Entity Chip Component\n// =============================================================================\n\ninterface EntityChipProps {\n  entity: ContextEntity;\n  isLast: boolean;\n  onClick: () => void;\n  onRemove: () => void;\n}\n\nfunction EntityChip({ entity, isLast, onClick, onRemove }: EntityChipProps) {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const config = ENTITY_CONFIG[entity.type];\n  const Icon = config.icon;\n\n  return (\n    <div className=\"flex items-center\">\n      <motion.div\n        layout\n        className={cn(\n          'relative group flex items-center gap-1.5 px-2 py-1 rounded-md',\n          'transition-colors cursor-pointer',\n          isExpanded ? 'bg-muted' : 'hover:bg-muted/50'\n        )}\n        onClick={onClick}\n      >\n        <Icon className={cn('w-3.5 h-3.5', config.color)} />\n        <span className=\"text-sm text-foreground font-medium\">\n          @{entity.name}\n        </span>\n\n        {/* Status badge if present */}\n        {entity.status && (\n          <span className=\"text-[10px] px-1.5 py-0.5 rounded bg-muted text-muted-foreground uppercase\">\n            {entity.status}\n          </span>\n        )}\n\n        {/* Remove button on hover */}\n        <button\n          onClick={(e) => {\n            e.stopPropagation();\n            onRemove();\n          }}\n          className=\"absolute -right-1 -top-1 w-4 h-4 rounded-full bg-muted-foreground/20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity hover:bg-destructive/50\"\n        >\n          <X className=\"w-2.5 h-2.5 text-muted-foreground\" />\n        </button>\n\n        {/* Expanded details */}\n        <AnimatePresence>\n          {isExpanded && entity.description && (\n            <motion.div\n              initial={{ opacity: 0, y: -5 }}\n              animate={{ opacity: 1, y: 0 }}\n              exit={{ opacity: 0, y: -5 }}\n              className=\"absolute top-full left-0 mt-1 z-50 w-64 p-3 rounded-lg bg-popover border border-border shadow-lg\"\n              onClick={(e) => e.stopPropagation()}\n            >\n              <div className=\"flex items-center gap-2 mb-2\">\n                <Icon className={cn('w-4 h-4', config.color)} />\n                <span className=\"text-xs font-medium text-muted-foreground uppercase\">\n                  {config.label}\n                </span>\n              </div>\n              <p className=\"text-sm text-foreground font-medium mb-1\">\n                {entity.name}\n              </p>\n              <p className=\"text-xs text-muted-foreground line-clamp-3\">\n                {entity.description}\n              </p>\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </motion.div>\n\n      {/* Arrow separator */}\n      {!isLast && (\n        <ChevronRight className=\"w-4 h-4 text-muted-foreground/50 mx-1 flex-shrink-0\" />\n      )}\n    </div>\n  );\n}\n\n// =============================================================================\n// View Switcher Component\n// =============================================================================\n\ninterface ViewSwitcherProps {\n  currentView: ViewDimension;\n  onViewChange: (view: ViewDimension) => void;\n}\n\nfunction ViewSwitcher({ currentView, onViewChange }: ViewSwitcherProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n\n  const currentConfig = VIEW_CONFIG[currentView];\n  const CurrentIcon = currentConfig.icon;\n\n  // Close on click outside\n  useEffect(() => {\n    function handleClickOutside(event: MouseEvent) {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n      }\n    }\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  return (\n    <div className=\"relative\" ref={dropdownRef}>\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className={cn(\n          'flex items-center gap-2 px-3 py-1.5 rounded-md',\n          'text-sm font-medium transition-colors',\n          'bg-muted/50 hover:bg-muted text-foreground'\n        )}\n      >\n        <CurrentIcon className=\"w-4 h-4\" />\n        <span>{currentConfig.label}</span>\n        <ChevronDown className={cn(\n          'w-3.5 h-3.5 transition-transform',\n          isOpen && 'rotate-180'\n        )} />\n      </button>\n\n      <AnimatePresence>\n        {isOpen && (\n          <motion.div\n            initial={{ opacity: 0, y: -5 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: -5 }}\n            className=\"absolute top-full right-0 mt-1 z-50 w-40 rounded-lg bg-popover border border-border shadow-lg overflow-hidden\"\n          >\n            {Object.entries(VIEW_CONFIG).map(([key, config]) => {\n              const Icon = config.icon;\n              const view = key as ViewDimension;\n              return (\n                <button\n                  key={key}\n                  onClick={() => {\n                    onViewChange(view);\n                    setIsOpen(false);\n                  }}\n                  className={cn(\n                    'w-full flex items-center gap-2 px-3 py-2 text-sm transition-colors',\n                    view === currentView\n                      ? 'bg-primary/10 text-primary'\n                      : 'hover:bg-muted text-foreground'\n                  )}\n                >\n                  <Icon className=\"w-4 h-4\" />\n                  <span>{config.label}</span>\n                </button>\n              );\n            })}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// =============================================================================\n// Main Component\n// =============================================================================\n\nexport function ContextBar({\n  contextChain,\n  currentView,\n  onViewChange,\n  onEntityClick,\n  onRemoveEntity,\n  onClearContext,\n  className,\n}: ContextBarProps) {\n  return (\n    <div\n      className={cn(\n        'flex items-center justify-between gap-4 px-4 py-2',\n        'bg-card/50 border-b border-border backdrop-blur-sm',\n        className\n      )}\n    >\n      {/* Context Chain */}\n      <div className=\"flex items-center gap-1 overflow-x-auto hide-scrollbar\">\n        {contextChain.length === 0 ? (\n          <span className=\"text-sm text-muted-foreground italic\">\n            No context selected - type @ to add\n          </span>\n        ) : (\n          <>\n            {contextChain.map((entity, index) => (\n              <EntityChip\n                key={entity.id}\n                entity={entity}\n                isLast={index === contextChain.length - 1}\n                onClick={() => onEntityClick(entity)}\n                onRemove={() => onRemoveEntity(entity.id)}\n              />\n            ))}\n\n            {/* Clear all button */}\n            {contextChain.length > 1 && (\n              <button\n                onClick={onClearContext}\n                className=\"ml-2 p-1 rounded hover:bg-muted transition-colors\"\n                title=\"Clear all context\"\n              >\n                <X className=\"w-4 h-4 text-muted-foreground\" />\n              </button>\n            )}\n          </>\n        )}\n      </div>\n\n      {/* View Switcher */}\n      <ViewSwitcher currentView={currentView} onViewChange={onViewChange} />\n    </div>\n  );\n}\n\nexport default ContextBar;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1296, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/agent/CodePanel.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Code,\n  FolderTree,\n  Terminal,\n  Eye,\n  ChevronUp,\n  ChevronDown,\n  X,\n  Maximize2,\n  Minimize2,\n  File,\n  Folder,\n  ChevronRight,\n  Play,\n  Copy,\n  Check,\n  RefreshCw,\n  ExternalLink,\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport type CodePanelTab = 'code' | 'files' | 'terminal' | 'preview';\n\nexport interface FileNode {\n  name: string;\n  path: string;\n  type: 'file' | 'folder';\n  children?: FileNode[];\n  language?: string;\n  isOpen?: boolean;\n}\n\nexport interface TerminalOutput {\n  id: string;\n  type: 'command' | 'output' | 'error';\n  content: string;\n  timestamp: number;\n}\n\ninterface CodePanelProps {\n  isVisible: boolean;\n  isExpanded: boolean;\n  activeTab: CodePanelTab;\n  onTabChange: (tab: CodePanelTab) => void;\n  onToggleExpanded: () => void;\n  onClose: () => void;\n  // Code editor props\n  code: string;\n  language: string;\n  currentFile?: string;\n  onCodeChange?: (code: string) => void;\n  // File tree props\n  files: FileNode[];\n  onFileSelect?: (path: string) => void;\n  // Terminal props\n  terminalOutput: TerminalOutput[];\n  onRunCommand?: (command: string) => void;\n  isRunning?: boolean;\n  // Preview props\n  previewUrl?: string;\n  onRefreshPreview?: () => void;\n}\n\n// =============================================================================\n// Tab Button Component\n// =============================================================================\n\ninterface TabButtonProps {\n  tab: CodePanelTab;\n  isActive: boolean;\n  onClick: () => void;\n  icon: typeof Code;\n  label: string;\n  badge?: number;\n}\n\nfunction TabButton({ tab, isActive, onClick, icon: Icon, label, badge }: TabButtonProps) {\n  return (\n    <button\n      onClick={onClick}\n      className={cn(\n        'flex items-center gap-2 px-3 py-2 text-sm font-medium transition-colors relative',\n        isActive\n          ? 'text-primary border-b-2 border-primary'\n          : 'text-muted-foreground hover:text-foreground'\n      )}\n    >\n      <Icon className=\"w-4 h-4\" />\n      <span className=\"hidden sm:inline\">{label}</span>\n      {badge !== undefined && badge > 0 && (\n        <span className=\"absolute -top-1 -right-1 w-4 h-4 rounded-full bg-primary text-primary-foreground text-[10px] flex items-center justify-center\">\n          {badge}\n        </span>\n      )}\n    </button>\n  );\n}\n\n// =============================================================================\n// File Tree Component\n// =============================================================================\n\ninterface FileTreeItemProps {\n  node: FileNode;\n  depth: number;\n  onSelect: (path: string) => void;\n  selectedPath?: string;\n}\n\nfunction FileTreeItem({ node, depth, onSelect, selectedPath }: FileTreeItemProps) {\n  const [isOpen, setIsOpen] = useState(node.isOpen ?? false);\n  const isSelected = selectedPath === node.path;\n\n  const handleClick = () => {\n    if (node.type === 'folder') {\n      setIsOpen(!isOpen);\n    } else {\n      onSelect(node.path);\n    }\n  };\n\n  return (\n    <div>\n      <button\n        onClick={handleClick}\n        className={cn(\n          'w-full flex items-center gap-1.5 px-2 py-1 text-sm transition-colors rounded',\n          isSelected ? 'bg-primary/20 text-primary' : 'hover:bg-muted text-foreground'\n        )}\n        style={{ paddingLeft: `${depth * 12 + 8}px` }}\n      >\n        {node.type === 'folder' ? (\n          <>\n            <ChevronRight\n              className={cn(\n                'w-3 h-3 text-muted-foreground transition-transform',\n                isOpen && 'rotate-90'\n              )}\n            />\n            <Folder className=\"w-4 h-4 text-amber-400\" />\n          </>\n        ) : (\n          <>\n            <span className=\"w-3\" />\n            <File className=\"w-4 h-4 text-blue-400\" />\n          </>\n        )}\n        <span className=\"truncate\">{node.name}</span>\n      </button>\n\n      {node.type === 'folder' && isOpen && node.children && (\n        <div>\n          {node.children.map((child) => (\n            <FileTreeItem\n              key={child.path}\n              node={child}\n              depth={depth + 1}\n              onSelect={onSelect}\n              selectedPath={selectedPath}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n\n// =============================================================================\n// Simple Code Editor Component\n// =============================================================================\n\ninterface CodeEditorProps {\n  code: string;\n  language: string;\n  onChange?: (code: string) => void;\n  readOnly?: boolean;\n}\n\nfunction CodeEditor({ code, language, onChange, readOnly = false }: CodeEditorProps) {\n  const [copied, setCopied] = useState(false);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n\n  const handleCopy = async () => {\n    await navigator.clipboard.writeText(code);\n    setCopied(true);\n    setTimeout(() => setCopied(false), 2000);\n  };\n\n  // Line numbers\n  const lineCount = code.split('\\n').length;\n  const lineNumbers = Array.from({ length: lineCount }, (_, i) => i + 1);\n\n  return (\n    <div className=\"relative h-full flex flex-col bg-[#1e1e1e] rounded-lg overflow-hidden\">\n      {/* Toolbar */}\n      <div className=\"flex items-center justify-between px-3 py-2 border-b border-white/10\">\n        <span className=\"text-xs text-muted-foreground font-mono\">{language}</span>\n        <button\n          onClick={handleCopy}\n          className=\"p-1.5 rounded hover:bg-white/10 transition-colors\"\n          title=\"Copy code\"\n        >\n          {copied ? (\n            <Check className=\"w-4 h-4 text-green-400\" />\n          ) : (\n            <Copy className=\"w-4 h-4 text-muted-foreground\" />\n          )}\n        </button>\n      </div>\n\n      {/* Editor */}\n      <div className=\"flex-1 flex overflow-auto\">\n        {/* Line numbers */}\n        <div className=\"flex-shrink-0 px-3 py-2 text-right text-xs text-muted-foreground/50 font-mono select-none border-r border-white/5\">\n          {lineNumbers.map((n) => (\n            <div key={n} className=\"leading-6\">{n}</div>\n          ))}\n        </div>\n\n        {/* Code area */}\n        <div className=\"flex-1 relative\">\n          <textarea\n            ref={textareaRef}\n            value={code}\n            onChange={(e) => onChange?.(e.target.value)}\n            readOnly={readOnly}\n            className={cn(\n              'absolute inset-0 w-full h-full px-4 py-2 bg-transparent resize-none',\n              'font-mono text-sm text-white leading-6',\n              'focus:outline-none',\n              readOnly && 'cursor-default'\n            )}\n            spellCheck={false}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// =============================================================================\n// Terminal Component\n// =============================================================================\n\ninterface TerminalViewProps {\n  output: TerminalOutput[];\n  onRunCommand: (command: string) => void;\n  isRunning: boolean;\n}\n\nfunction TerminalView({ output, onRunCommand, isRunning }: TerminalViewProps) {\n  const [command, setCommand] = useState('');\n  const outputRef = useRef<HTMLDivElement>(null);\n\n  // Auto-scroll to bottom\n  useEffect(() => {\n    if (outputRef.current) {\n      outputRef.current.scrollTop = outputRef.current.scrollHeight;\n    }\n  }, [output]);\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (command.trim() && !isRunning) {\n      onRunCommand(command.trim());\n      setCommand('');\n    }\n  };\n\n  return (\n    <div className=\"h-full flex flex-col bg-[#1e1e1e] rounded-lg overflow-hidden font-mono\">\n      {/* Output */}\n      <div ref={outputRef} className=\"flex-1 overflow-auto p-3 space-y-1\">\n        {output.length === 0 ? (\n          <div className=\"text-muted-foreground text-sm\">\n            Terminal ready. Type a command to get started.\n          </div>\n        ) : (\n          output.map((line) => (\n            <div\n              key={line.id}\n              className={cn(\n                'text-sm whitespace-pre-wrap',\n                line.type === 'command' && 'text-green-400',\n                line.type === 'output' && 'text-white/80',\n                line.type === 'error' && 'text-red-400'\n              )}\n            >\n              {line.type === 'command' && <span className=\"text-muted-foreground\">$ </span>}\n              {line.content}\n            </div>\n          ))\n        )}\n        {isRunning && (\n          <div className=\"flex items-center gap-2 text-muted-foreground text-sm\">\n            <div className=\"w-2 h-2 rounded-full bg-green-400 animate-pulse\" />\n            Running...\n          </div>\n        )}\n      </div>\n\n      {/* Input */}\n      <form onSubmit={handleSubmit} className=\"flex items-center gap-2 px-3 py-2 border-t border-white/10\">\n        <span className=\"text-green-400 text-sm\">$</span>\n        <input\n          type=\"text\"\n          value={command}\n          onChange={(e) => setCommand(e.target.value)}\n          disabled={isRunning}\n          className=\"flex-1 bg-transparent text-sm text-white focus:outline-none disabled:opacity-50\"\n          placeholder=\"Enter command...\"\n          autoCapitalize=\"off\"\n          autoCorrect=\"off\"\n          autoComplete=\"off\"\n          spellCheck={false}\n        />\n        <button\n          type=\"submit\"\n          disabled={!command.trim() || isRunning}\n          className=\"p-1.5 rounded hover:bg-white/10 transition-colors disabled:opacity-50\"\n        >\n          <Play className=\"w-4 h-4 text-green-400\" />\n        </button>\n      </form>\n    </div>\n  );\n}\n\n// =============================================================================\n// Preview Component\n// =============================================================================\n\ninterface PreviewViewProps {\n  url?: string;\n  onRefresh: () => void;\n}\n\nfunction PreviewView({ url, onRefresh }: PreviewViewProps) {\n  const [isLoading, setIsLoading] = useState(true);\n\n  if (!url) {\n    return (\n      <div className=\"h-full flex flex-col items-center justify-center bg-muted/20 rounded-lg\">\n        <Eye className=\"w-12 h-12 text-muted-foreground/30 mb-3\" />\n        <p className=\"text-sm text-muted-foreground\">No preview available</p>\n        <p className=\"text-xs text-muted-foreground/70 mt-1\">\n          Run a dev server to see the preview\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full flex flex-col bg-card rounded-lg overflow-hidden\">\n      {/* URL bar */}\n      <div className=\"flex items-center gap-2 px-3 py-2 border-b border-border\">\n        <button\n          onClick={onRefresh}\n          className=\"p-1.5 rounded hover:bg-muted transition-colors\"\n          title=\"Refresh\"\n        >\n          <RefreshCw className={cn('w-4 h-4 text-muted-foreground', isLoading && 'animate-spin')} />\n        </button>\n        <div className=\"flex-1 px-3 py-1.5 rounded bg-muted text-sm text-muted-foreground truncate\">\n          {url}\n        </div>\n        <a\n          href={url}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          className=\"p-1.5 rounded hover:bg-muted transition-colors\"\n          title=\"Open in new tab\"\n        >\n          <ExternalLink className=\"w-4 h-4 text-muted-foreground\" />\n        </a>\n      </div>\n\n      {/* iframe */}\n      <div className=\"flex-1 relative\">\n        {isLoading && (\n          <div className=\"absolute inset-0 flex items-center justify-center bg-muted/50\">\n            <RefreshCw className=\"w-6 h-6 text-muted-foreground animate-spin\" />\n          </div>\n        )}\n        <iframe\n          src={url}\n          className=\"w-full h-full border-0\"\n          onLoad={() => setIsLoading(false)}\n          title=\"Preview\"\n        />\n      </div>\n    </div>\n  );\n}\n\n// =============================================================================\n// Main Component\n// =============================================================================\n\nexport function CodePanel({\n  isVisible,\n  isExpanded,\n  activeTab,\n  onTabChange,\n  onToggleExpanded,\n  onClose,\n  code,\n  language,\n  currentFile,\n  onCodeChange,\n  files,\n  onFileSelect,\n  terminalOutput,\n  onRunCommand,\n  isRunning = false,\n  previewUrl,\n  onRefreshPreview,\n}: CodePanelProps) {\n  if (!isVisible) return null;\n\n  return (\n    <motion.div\n      initial={{ y: '100%' }}\n      animate={{ y: 0 }}\n      exit={{ y: '100%' }}\n      transition={{ type: 'spring', damping: 30, stiffness: 300 }}\n      className={cn(\n        'bg-card border-t border-border flex flex-col',\n        isExpanded ? 'h-[70vh]' : 'h-[300px] md:h-[350px]'\n      )}\n    >\n      {/* Header */}\n      <div className=\"flex items-center justify-between px-4 border-b border-border\">\n        {/* Tabs */}\n        <div className=\"flex items-center gap-1\">\n          <TabButton\n            tab=\"code\"\n            isActive={activeTab === 'code'}\n            onClick={() => onTabChange('code')}\n            icon={Code}\n            label=\"Code\"\n          />\n          <TabButton\n            tab=\"files\"\n            isActive={activeTab === 'files'}\n            onClick={() => onTabChange('files')}\n            icon={FolderTree}\n            label=\"Files\"\n          />\n          <TabButton\n            tab=\"terminal\"\n            isActive={activeTab === 'terminal'}\n            onClick={() => onTabChange('terminal')}\n            icon={Terminal}\n            label=\"Terminal\"\n            badge={terminalOutput.filter((o) => o.type === 'error').length}\n          />\n          <TabButton\n            tab=\"preview\"\n            isActive={activeTab === 'preview'}\n            onClick={() => onTabChange('preview')}\n            icon={Eye}\n            label=\"Preview\"\n          />\n        </div>\n\n        {/* Controls */}\n        <div className=\"flex items-center gap-1\">\n          {currentFile && (\n            <span className=\"text-xs text-muted-foreground mr-2 hidden sm:block\">\n              {currentFile}\n            </span>\n          )}\n          <button\n            onClick={onToggleExpanded}\n            className=\"p-2 rounded hover:bg-muted transition-colors\"\n            title={isExpanded ? 'Minimize' : 'Maximize'}\n          >\n            {isExpanded ? (\n              <Minimize2 className=\"w-4 h-4 text-muted-foreground\" />\n            ) : (\n              <Maximize2 className=\"w-4 h-4 text-muted-foreground\" />\n            )}\n          </button>\n          <button\n            onClick={onClose}\n            className=\"p-2 rounded hover:bg-muted transition-colors\"\n            title=\"Close\"\n          >\n            <X className=\"w-4 h-4 text-muted-foreground\" />\n          </button>\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"flex-1 overflow-hidden p-3\">\n        <AnimatePresence mode=\"wait\">\n          {activeTab === 'code' && (\n            <motion.div\n              key=\"code\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"h-full\"\n            >\n              <CodeEditor\n                code={code}\n                language={language}\n                onChange={onCodeChange}\n              />\n            </motion.div>\n          )}\n\n          {activeTab === 'files' && (\n            <motion.div\n              key=\"files\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"h-full overflow-auto\"\n            >\n              <div className=\"space-y-0.5\">\n                {files.length === 0 ? (\n                  <div className=\"text-sm text-muted-foreground text-center py-8\">\n                    No files in workspace\n                  </div>\n                ) : (\n                  files.map((file) => (\n                    <FileTreeItem\n                      key={file.path}\n                      node={file}\n                      depth={0}\n                      onSelect={onFileSelect || (() => {})}\n                      selectedPath={currentFile}\n                    />\n                  ))\n                )}\n              </div>\n            </motion.div>\n          )}\n\n          {activeTab === 'terminal' && (\n            <motion.div\n              key=\"terminal\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"h-full\"\n            >\n              <TerminalView\n                output={terminalOutput}\n                onRunCommand={onRunCommand || (() => {})}\n                isRunning={isRunning}\n              />\n            </motion.div>\n          )}\n\n          {activeTab === 'preview' && (\n            <motion.div\n              key=\"preview\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"h-full\"\n            >\n              <PreviewView\n                url={previewUrl}\n                onRefresh={onRefreshPreview || (() => {})}\n              />\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </div>\n    </motion.div>\n  );\n}\n\nexport default CodePanel;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2125, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/agent/AgentChat.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useEffect, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Send,\n  Mic,\n  MicOff,\n  Loader2,\n  User,\n  AtSign,\n  Folder,\n  FileText,\n  FileCode,\n  Ticket,\n  ChevronRight,\n  Check,\n  X,\n  Sparkles,\n  StopCircle,\n  Paperclip,\n  Image as ImageIcon,\n  File,\n} from 'lucide-react';\nimport { useFileAttachment, FileAttachment } from '@/hooks/useFileAttachment';\nimport { ClawAIAvatar } from '@/components/claw-ai/ClawAIAvatar';\nimport { cn } from '@/lib/utils';\nimport { ContextEntity, ContextEntityType } from './ContextBar';\n\n// Import theme styles\nimport '@/lib/themes/themes.css';\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface ChatMessage {\n  id: string;\n  role: 'user' | 'assistant' | 'system';\n  content: string;\n  timestamp: Date;\n  isStreaming?: boolean;\n  toolCalls?: ToolCall[];\n  mentions?: ContextEntity[];\n}\n\nexport interface ToolCall {\n  id: string;\n  name: string;\n  status: 'pending' | 'executing' | 'complete' | 'error';\n  args?: Record<string, unknown>;\n  result?: {\n    success: boolean;\n    data?: Record<string, unknown>;\n    error?: string;\n  };\n}\n\nexport interface MentionSuggestion {\n  id: string;\n  type: ContextEntityType;\n  name: string;\n  description?: string;\n}\n\ninterface AgentChatProps {\n  messages: ChatMessage[];\n  isStreaming: boolean;\n  onSendMessage: (content: string, mentions?: ContextEntity[]) => void;\n  onAbort?: () => void;\n  mentionSuggestions?: MentionSuggestion[];\n  onMentionSearch?: (query: string) => void;\n  onMentionSelect?: (mention: MentionSuggestion) => void;\n  onVoiceInput?: (transcript: string) => void;\n  isVoiceEnabled?: boolean;\n  className?: string;\n}\n\n// =============================================================================\n// Entity Config\n// =============================================================================\n\nconst ENTITY_ICONS: Record<ContextEntityType, typeof Folder> = {\n  project: Folder,\n  prd: FileText,\n  epic: FileText,\n  ticket: Ticket,\n  file: FileCode,\n};\n\nconst ENTITY_COLORS: Record<ContextEntityType, string> = {\n  project: 'text-blue-400',\n  prd: 'text-purple-400',\n  epic: 'text-amber-400',\n  ticket: 'text-green-400',\n  file: 'text-orange-400',\n};\n\n// =============================================================================\n// Tool Execution Card\n// =============================================================================\n\ninterface ToolExecutionCardProps {\n  tool: ToolCall;\n}\n\nfunction ToolExecutionCard({ tool }: ToolExecutionCardProps) {\n  return (\n    <div\n      className=\"rounded-lg p-3\"\n      style={{\n        background: 'hsl(var(--theme-muted) / 0.5)',\n        border: '1px solid hsl(var(--theme-border))',\n      }}\n    >\n      <div className=\"flex items-center gap-2 mb-2\">\n        <div\n          className=\"w-6 h-6 rounded-md flex items-center justify-center\"\n          style={{\n            background:\n              tool.status === 'complete' && tool.result?.success\n                ? 'hsl(142 70% 45% / 0.2)'\n                : tool.status === 'complete' && !tool.result?.success\n                ? 'hsl(0 84% 60% / 0.2)'\n                : tool.status === 'executing'\n                ? 'hsl(var(--theme-primary) / 0.2)'\n                : 'hsl(var(--theme-muted))',\n          }}\n        >\n          {tool.status === 'executing' ? (\n            <Loader2 className=\"w-3.5 h-3.5 animate-spin\" style={{ color: 'hsl(var(--theme-primary))' }} />\n          ) : tool.status === 'complete' && tool.result?.success ? (\n            <Check className=\"w-3.5 h-3.5\" style={{ color: 'hsl(142 70% 45%)' }} />\n          ) : tool.status === 'complete' && !tool.result?.success ? (\n            <X className=\"w-3.5 h-3.5\" style={{ color: 'hsl(0 84% 60%)' }} />\n          ) : (\n            <Sparkles className=\"w-3.5 h-3.5\" style={{ color: 'hsl(var(--theme-muted-foreground))' }} />\n          )}\n        </div>\n        <span className=\"text-sm font-medium\" style={{ color: 'hsl(var(--theme-foreground))' }}>\n          {tool.name.replace(/_/g, ' ')}\n        </span>\n        {tool.status === 'executing' && (\n          <span className=\"text-xs animate-pulse\" style={{ color: 'hsl(var(--theme-muted-foreground))' }}>\n            Running...\n          </span>\n        )}\n      </div>\n\n      {/* Show result if complete */}\n      {tool.status === 'complete' && tool.result && (\n        <div className=\"mt-2 text-xs\">\n          {tool.result.success ? (\n            <div style={{ color: 'hsl(var(--theme-muted-foreground))' }}>\n              {tool.result.data && Object.keys(tool.result.data).length > 0 && (\n                <pre\n                  className=\"rounded p-2 overflow-auto max-h-24\"\n                  style={{ background: 'hsl(var(--theme-background))' }}\n                >\n                  {JSON.stringify(tool.result.data, null, 2)}\n                </pre>\n              )}\n            </div>\n          ) : (\n            <div style={{ color: 'hsl(0 84% 60%)' }}>\n              Error: {tool.result.error}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\n// =============================================================================\n// Entity Preview Card\n// =============================================================================\n\ninterface EntityPreviewProps {\n  entity: ContextEntity;\n}\n\nfunction EntityPreview({ entity }: EntityPreviewProps) {\n  const Icon = ENTITY_ICONS[entity.type];\n  const colorClass = ENTITY_COLORS[entity.type];\n\n  return (\n    <div\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 rounded-md\"\n      style={{ background: 'hsl(var(--theme-muted))' }}\n    >\n      <Icon className={cn('w-3.5 h-3.5', colorClass)} />\n      <span className=\"text-sm font-medium\" style={{ color: 'hsl(var(--theme-foreground))' }}>\n        @{entity.name}\n      </span>\n    </div>\n  );\n}\n\n// =============================================================================\n// Message Bubble\n// =============================================================================\n\ninterface MessageBubbleProps {\n  message: ChatMessage;\n}\n\nfunction MessageBubble({ message }: MessageBubbleProps) {\n  const isUser = message.role === 'user';\n  const isSystem = message.role === 'system';\n\n  if (isSystem) {\n    return (\n      <div className=\"flex justify-center my-4\">\n        <div\n          className=\"px-3 py-1.5 rounded-full text-xs\"\n          style={{\n            background: 'hsl(var(--theme-muted))',\n            color: 'hsl(var(--theme-muted-foreground))',\n          }}\n        >\n          {message.content}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      className={cn('flex gap-3 mb-4', isUser && 'flex-row-reverse')}\n      style={{ gap: 'var(--theme-chat-message-gap, 0.75rem)' }}\n    >\n      {/* Avatar */}\n      {isUser ? (\n        <div\n          className=\"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0\"\n          style={{\n            background: 'hsl(var(--theme-chat-avatar-user, var(--theme-primary)))',\n          }}\n        >\n          <User className=\"w-4 h-4\" style={{ color: 'hsl(var(--theme-primary-foreground))' }} />\n        </div>\n      ) : (\n        <ClawAIAvatar size={32} isActive={message.isStreaming} />\n      )}\n\n      {/* Content */}\n      <div\n        className={cn('flex-1 space-y-2', isUser && 'flex flex-col items-end')}\n        style={{ maxWidth: 'var(--theme-chat-max-width, 85%)' }}\n      >\n        {/* Mentions */}\n        {message.mentions && message.mentions.length > 0 && (\n          <div className=\"flex flex-wrap gap-1.5 mb-1\">\n            {message.mentions.map((mention) => (\n              <EntityPreview key={mention.id} entity={mention} />\n            ))}\n          </div>\n        )}\n\n        {/* Message text */}\n        <div\n          className=\"px-4 py-2.5\"\n          style={{\n            background: isUser\n              ? 'var(--theme-chat-user-bg, hsl(var(--theme-primary)))'\n              : 'hsl(var(--theme-chat-assistant-bg, var(--theme-muted)))',\n            color: isUser\n              ? 'hsl(var(--theme-chat-user-fg, var(--theme-primary-foreground)))'\n              : 'hsl(var(--theme-chat-assistant-fg, var(--theme-foreground)))',\n            borderRadius: isUser\n              ? 'var(--theme-chat-bubble-radius, 1rem) var(--theme-chat-bubble-radius, 1rem) var(--theme-chat-bubble-radius-tail, 0.25rem) var(--theme-chat-bubble-radius, 1rem)'\n              : 'var(--theme-chat-bubble-radius-tail, 0.25rem) var(--theme-chat-bubble-radius, 1rem) var(--theme-chat-bubble-radius, 1rem) var(--theme-chat-bubble-radius, 1rem)',\n          }}\n        >\n          <p className=\"text-sm whitespace-pre-wrap\">\n            {message.content}\n            {message.isStreaming && (\n              <span className=\"inline-block w-1.5 h-4 ml-1 bg-current animate-pulse\" />\n            )}\n          </p>\n        </div>\n\n        {/* Tool calls */}\n        {message.toolCalls && message.toolCalls.length > 0 && (\n          <div className=\"space-y-2 w-full\">\n            {message.toolCalls.map((tool) => (\n              <ToolExecutionCard key={tool.id} tool={tool} />\n            ))}\n          </div>\n        )}\n\n        {/* Timestamp */}\n        <span className=\"text-[10px]\" style={{ color: 'hsl(var(--theme-muted-foreground) / 0.7)' }}>\n          {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n        </span>\n      </div>\n    </motion.div>\n  );\n}\n\n// =============================================================================\n// Mention Autocomplete\n// =============================================================================\n\ninterface MentionAutocompleteProps {\n  suggestions: MentionSuggestion[];\n  selectedIndex: number;\n  onSelect: (suggestion: MentionSuggestion) => void;\n}\n\nfunction MentionAutocomplete({ suggestions, selectedIndex, onSelect }: MentionAutocompleteProps) {\n  if (suggestions.length === 0) return null;\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      exit={{ opacity: 0, y: 10 }}\n      className=\"absolute bottom-full left-0 right-0 mb-2 rounded-lg shadow-lg overflow-hidden z-50\"\n      style={{\n        background: 'hsl(var(--theme-card))',\n        border: '1px solid hsl(var(--theme-border))',\n      }}\n    >\n      <div className=\"max-h-48 overflow-y-auto\">\n        {suggestions.map((suggestion, index) => {\n          const Icon = ENTITY_ICONS[suggestion.type];\n          const colorClass = ENTITY_COLORS[suggestion.type];\n\n          return (\n            <button\n              key={suggestion.id}\n              onClick={() => onSelect(suggestion)}\n              className=\"w-full flex items-center gap-3 px-3 py-2 transition-colors\"\n              style={{\n                background: index === selectedIndex ? 'hsl(var(--theme-muted))' : 'transparent',\n              }}\n              onMouseEnter={(e) => {\n                if (index !== selectedIndex) e.currentTarget.style.background = 'hsl(var(--theme-muted) / 0.5)';\n              }}\n              onMouseLeave={(e) => {\n                if (index !== selectedIndex) e.currentTarget.style.background = 'transparent';\n              }}\n            >\n              <Icon className={cn('w-4 h-4', colorClass)} />\n              <div className=\"flex-1 text-left\">\n                <p className=\"text-sm font-medium\" style={{ color: 'hsl(var(--theme-foreground))' }}>\n                  @{suggestion.name}\n                </p>\n                {suggestion.description && (\n                  <p className=\"text-xs truncate\" style={{ color: 'hsl(var(--theme-muted-foreground))' }}>\n                    {suggestion.description}\n                  </p>\n                )}\n              </div>\n              <span className=\"text-[10px] uppercase\" style={{ color: 'hsl(var(--theme-muted-foreground))' }}>\n                {suggestion.type}\n              </span>\n            </button>\n          );\n        })}\n      </div>\n    </motion.div>\n  );\n}\n\n// =============================================================================\n// Main Component\n// =============================================================================\n\nexport function AgentChat({\n  messages,\n  isStreaming,\n  onSendMessage,\n  onAbort,\n  mentionSuggestions = [],\n  onMentionSearch,\n  onMentionSelect,\n  onVoiceInput,\n  isVoiceEnabled = false,\n  className,\n}: AgentChatProps) {\n  const [input, setInput] = useState('');\n  const [showMentions, setShowMentions] = useState(false);\n  const [mentionQuery, setMentionQuery] = useState('');\n  const [selectedMentionIndex, setSelectedMentionIndex] = useState(0);\n  const [selectedMentions, setSelectedMentions] = useState<ContextEntity[]>([]);\n  const [isRecording, setIsRecording] = useState(false);\n\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLTextAreaElement>(null);\n\n  // File attachment support\n  const fileAttachment = useFileAttachment({\n    maxFiles: 5,\n    maxSizeBytes: 10 * 1024 * 1024, // 10MB\n    onError: (error) => console.error('[AgentChat] Attachment error:', error),\n  });\n\n  // Auto-scroll to bottom\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  // Handle input change and @ detection\n  const handleInputChange = (value: string) => {\n    setInput(value);\n\n    // Check for @ mention\n    const lastAtIndex = value.lastIndexOf('@');\n    if (lastAtIndex !== -1) {\n      const afterAt = value.slice(lastAtIndex + 1);\n      // Check if we're still typing the mention (no space after @)\n      if (!afterAt.includes(' ') && afterAt.length <= 20) {\n        setMentionQuery(afterAt);\n        setShowMentions(true);\n        onMentionSearch?.(afterAt);\n        return;\n      }\n    }\n    setShowMentions(false);\n  };\n\n  // Handle mention selection\n  const handleMentionSelect = (suggestion: MentionSuggestion) => {\n    const lastAtIndex = input.lastIndexOf('@');\n    const newInput = input.slice(0, lastAtIndex) + `@${suggestion.name} `;\n    setInput(newInput);\n    setShowMentions(false);\n    setSelectedMentionIndex(0);\n\n    // Add to selected mentions\n    const entity: ContextEntity = {\n      id: suggestion.id,\n      type: suggestion.type,\n      name: suggestion.name,\n      description: suggestion.description,\n    };\n    setSelectedMentions((prev) => [...prev, entity]);\n\n    onMentionSelect?.(suggestion);\n    inputRef.current?.focus();\n  };\n\n  // Handle keyboard navigation in autocomplete\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (showMentions && mentionSuggestions.length > 0) {\n      if (e.key === 'ArrowDown') {\n        e.preventDefault();\n        setSelectedMentionIndex((prev) => (prev + 1) % mentionSuggestions.length);\n      } else if (e.key === 'ArrowUp') {\n        e.preventDefault();\n        setSelectedMentionIndex((prev) => (prev - 1 + mentionSuggestions.length) % mentionSuggestions.length);\n      } else if (e.key === 'Enter' && !e.shiftKey) {\n        e.preventDefault();\n        handleMentionSelect(mentionSuggestions[selectedMentionIndex]);\n      } else if (e.key === 'Escape') {\n        setShowMentions(false);\n      }\n    } else if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  };\n\n  // Handle send\n  const handleSend = () => {\n    const hasText = input.trim().length > 0;\n    const hasAttachments = fileAttachment.hasAttachments;\n\n    if ((!hasText && !hasAttachments) || isStreaming) return;\n\n    // Build message content including attachment info\n    let messageContent = input.trim();\n    if (fileAttachment.attachments.length > 0) {\n      const attachmentNames = fileAttachment.attachments.map(a => a.name).join(', ');\n      messageContent = messageContent\n        ? `${messageContent}\\n\\n[Attached: ${attachmentNames}]`\n        : `[Attached: ${attachmentNames}]`;\n    }\n\n    onSendMessage(messageContent || 'Please analyze the attached files.', selectedMentions);\n    setInput('');\n    setSelectedMentions([]);\n    fileAttachment.clearAttachments();\n  };\n\n  // Handle voice toggle\n  const handleVoiceToggle = () => {\n    if (isRecording) {\n      setIsRecording(false);\n      // Stop recording logic would go here\n    } else {\n      setIsRecording(true);\n      // Start recording logic would go here\n    }\n  };\n\n  // Auto-resize textarea\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.style.height = 'auto';\n      inputRef.current.style.height = `${Math.min(inputRef.current.scrollHeight, 150)}px`;\n    }\n  }, [input]);\n\n  return (\n    <div\n      className={cn('flex flex-col h-full', className)}\n      style={{\n        background: 'hsl(var(--theme-background))',\n        fontFamily: 'var(--theme-font)',\n      }}\n    >\n      {/* Messages */}\n      <div className=\"flex-1 overflow-y-auto px-4 py-4\">\n        {messages.length === 0 ? (\n          <div className=\"h-full flex flex-col items-center justify-center text-center\">\n            <div className=\"mb-4\">\n              <ClawAIAvatar size={64} isActive={false} />\n            </div>\n            <h3 className=\"text-lg font-semibold mb-2\" style={{ color: 'hsl(var(--theme-foreground))' }}>\n              Start a conversation\n            </h3>\n            <p className=\"text-sm max-w-sm\" style={{ color: 'hsl(var(--theme-muted-foreground))' }}>\n              Ask me to help with code, design, or product work.\n              Use @ to reference projects, PRDs, or tickets.\n            </p>\n          </div>\n        ) : (\n          messages.map((message) => (\n            <MessageBubble key={message.id} message={message} />\n          ))\n        )}\n        <div ref={messagesEndRef} />\n      </div>\n\n      {/* Input Area */}\n      <div\n        className=\"p-4\"\n        style={{ borderTop: '1px solid hsl(var(--theme-border))' }}\n      >\n        {/* Selected mentions preview */}\n        {selectedMentions.length > 0 && (\n          <div className=\"flex flex-wrap gap-1.5 mb-2\">\n            {selectedMentions.map((mention) => (\n              <div\n                key={mention.id}\n                className=\"flex items-center gap-1 px-2 py-1 rounded-md\"\n                style={{ background: 'hsl(var(--theme-muted))' }}\n              >\n                <EntityPreview entity={mention} />\n                <button\n                  onClick={() => setSelectedMentions((prev) => prev.filter((m) => m.id !== mention.id))}\n                  className=\"p-0.5 rounded transition-colors\"\n                  style={{ color: 'hsl(var(--theme-muted-foreground))' }}\n                  onMouseEnter={(e) => e.currentTarget.style.background = 'hsl(var(--theme-muted-foreground) / 0.2)'}\n                  onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}\n                >\n                  <X className=\"w-3 h-3\" />\n                </button>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {/* Hidden file input */}\n        <input\n          ref={fileAttachment.fileInputRef}\n          type=\"file\"\n          accept={fileAttachment.acceptedTypesString}\n          multiple\n          onChange={fileAttachment.handleFileInputChange}\n          className=\"hidden\"\n        />\n\n        {/* Attachment preview */}\n        <AnimatePresence>\n          {fileAttachment.hasAttachments && (\n            <motion.div\n              initial={{ opacity: 0, height: 0 }}\n              animate={{ opacity: 1, height: 'auto' }}\n              exit={{ opacity: 0, height: 0 }}\n              className=\"mb-2\"\n            >\n              <div\n                className=\"flex flex-wrap gap-2 p-2 rounded-lg\"\n                style={{\n                  background: 'hsl(var(--theme-muted) / 0.5)',\n                  border: '1px solid hsl(var(--theme-border) / 0.5)',\n                }}\n              >\n                {fileAttachment.attachments.map((attachment) => {\n                  const FileIcon = attachment.type.startsWith('image/') ? ImageIcon\n                    : attachment.type === 'application/pdf' || attachment.type.startsWith('text/') ? FileText\n                    : File;\n\n                  return (\n                    <div key={attachment.id} className=\"relative group\">\n                      {attachment.preview ? (\n                        <div className=\"relative w-16 h-16 rounded-lg overflow-hidden\">\n                          <img\n                            src={attachment.preview}\n                            alt={attachment.name}\n                            className=\"w-full h-full object-cover\"\n                          />\n                          <div className=\"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity\" />\n                        </div>\n                      ) : (\n                        <div\n                          className=\"w-16 h-16 rounded-lg flex flex-col items-center justify-center gap-1 p-1\"\n                          style={{ background: 'hsl(var(--theme-muted))' }}\n                        >\n                          <FileIcon className=\"w-5 h-5\" style={{ color: 'hsl(var(--theme-primary))' }} />\n                          <span\n                            className=\"text-[9px] truncate w-full text-center\"\n                            style={{ color: 'hsl(var(--theme-muted-foreground))' }}\n                          >\n                            {attachment.name.length > 10 ? `${attachment.name.slice(0, 8)}...` : attachment.name}\n                          </span>\n                        </div>\n                      )}\n\n                      <button\n                        type=\"button\"\n                        onClick={() => fileAttachment.removeAttachment(attachment.id)}\n                        className=\"absolute -top-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\"\n                        style={{ background: 'hsl(0 84% 60%)', color: 'white' }}\n                        aria-label={`Remove ${attachment.name}`}\n                      >\n                        <X className=\"w-3 h-3\" />\n                      </button>\n                    </div>\n                  );\n                })}\n              </div>\n            </motion.div>\n          )}\n        </AnimatePresence>\n\n        {/* Input container */}\n        <div className=\"relative\">\n          {/* Mention autocomplete */}\n          <AnimatePresence>\n            {showMentions && mentionSuggestions.length > 0 && (\n              <MentionAutocomplete\n                suggestions={mentionSuggestions}\n                selectedIndex={selectedMentionIndex}\n                onSelect={handleMentionSelect}\n              />\n            )}\n          </AnimatePresence>\n\n          {/* Input field */}\n          <div\n            className=\"flex items-end gap-2 rounded-xl p-2\"\n            style={{\n              background: 'hsl(var(--theme-chat-input-bg, var(--theme-muted)))',\n              border: '1px solid hsl(var(--theme-chat-input-border, var(--theme-border)) / 0.5)',\n            }}\n          >\n            {/* Attachment button */}\n            <button\n              onClick={fileAttachment.openFilePicker}\n              disabled={isStreaming}\n              className=\"p-2 rounded-lg transition-colors disabled:opacity-50\"\n              title=\"Attach file\"\n              style={{ color: 'hsl(var(--theme-muted-foreground))' }}\n              onMouseEnter={(e) => e.currentTarget.style.background = 'hsl(var(--theme-background))'}\n              onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}\n            >\n              <Paperclip className=\"w-5 h-5\" />\n            </button>\n\n            {/* @ mention button */}\n            <button\n              onClick={() => {\n                setInput((prev) => prev + '@');\n                setShowMentions(true);\n                onMentionSearch?.('');\n                inputRef.current?.focus();\n              }}\n              className=\"p-2 rounded-lg transition-colors\"\n              title=\"Add mention\"\n              style={{ color: 'hsl(var(--theme-muted-foreground))' }}\n              onMouseEnter={(e) => e.currentTarget.style.background = 'hsl(var(--theme-background))'}\n              onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}\n            >\n              <AtSign className=\"w-5 h-5\" />\n            </button>\n\n            {/* Text input */}\n            <textarea\n              ref={inputRef}\n              value={input}\n              onChange={(e) => handleInputChange(e.target.value)}\n              onKeyDown={handleKeyDown}\n              placeholder=\"Ask anything... (@ to mention)\"\n              rows={1}\n              className=\"flex-1 bg-transparent resize-none focus:outline-none text-sm py-2\"\n              style={{\n                maxHeight: '150px',\n                color: 'hsl(var(--theme-chat-input-fg, var(--theme-foreground)))',\n              }}\n            />\n\n            {/* Voice button */}\n            {isVoiceEnabled && (\n              <button\n                onClick={handleVoiceToggle}\n                className=\"p-2 rounded-lg transition-colors\"\n                title={isRecording ? 'Stop recording' : 'Voice input'}\n                style={{\n                  background: isRecording ? 'hsl(0 84% 60% / 0.2)' : 'transparent',\n                  color: isRecording ? 'hsl(0 84% 60%)' : 'hsl(var(--theme-muted-foreground))',\n                }}\n                onMouseEnter={(e) => {\n                  if (!isRecording) e.currentTarget.style.background = 'hsl(var(--theme-background))';\n                }}\n                onMouseLeave={(e) => {\n                  if (!isRecording) e.currentTarget.style.background = 'transparent';\n                }}\n              >\n                {isRecording ? (\n                  <MicOff className=\"w-5 h-5\" />\n                ) : (\n                  <Mic className=\"w-5 h-5\" />\n                )}\n              </button>\n            )}\n\n            {/* Send / Stop button */}\n            {isStreaming ? (\n              <button\n                onClick={onAbort}\n                className=\"p-2 rounded-lg transition-colors\"\n                title=\"Stop generating\"\n                style={{\n                  background: 'hsl(0 84% 60% / 0.2)',\n                  color: 'hsl(0 84% 60%)',\n                }}\n                onMouseEnter={(e) => e.currentTarget.style.background = 'hsl(0 84% 60% / 0.3)'}\n                onMouseLeave={(e) => e.currentTarget.style.background = 'hsl(0 84% 60% / 0.2)'}\n              >\n                <StopCircle className=\"w-5 h-5\" />\n              </button>\n            ) : (\n              <button\n                onClick={handleSend}\n                disabled={!input.trim() && !fileAttachment.hasAttachments}\n                className=\"p-2 rounded-lg transition-colors\"\n                title=\"Send message\"\n                style={{\n                  background: (input.trim() || fileAttachment.hasAttachments)\n                    ? 'hsl(var(--theme-chat-send-bg, var(--theme-primary)))'\n                    : 'hsl(var(--theme-chat-send-disabled-bg, var(--theme-muted-foreground) / 0.2))',\n                  color: (input.trim() || fileAttachment.hasAttachments)\n                    ? 'hsl(var(--theme-chat-send-fg, var(--theme-primary-foreground)))'\n                    : 'hsl(var(--theme-chat-send-disabled-fg, var(--theme-muted-foreground)))',\n                  cursor: (input.trim() || fileAttachment.hasAttachments) ? 'pointer' : 'not-allowed',\n                }}\n              >\n                <Send className=\"w-5 h-5\" />\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default AgentChat;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3216, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/auth/GitHubAuthModal.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Github, X, Shield, Code2, Terminal, AlertTriangle, ExternalLink } from 'lucide-react';\nimport { useUser } from '@clerk/nextjs';\n\n// Check at module load time if Clerk is configured\nconst CLERK_CONFIGURED = typeof window !== 'undefined' &&\n  typeof process !== 'undefined' &&\n  !!process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY;\n\ninterface GitHubAuthModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onAuthenticated?: () => void;\n  errorMessage?: string;\n}\n\n/**\n * GitHubAuthModal - Prompts owner to authenticate via GitHub when sandbox auth fails\n *\n * This appears when:\n * - Sandbox returns \"Authentication required\" error\n * - Any GitHub OAuth related error occurs\n * - Only shown to the owner (verified via Clerk)\n *\n * If already signed in, directs user to connect GitHub in settings.\n * If not signed in, shows SignIn button.\n */\nexport function GitHubAuthModal({\n  isOpen,\n  onClose,\n  onAuthenticated,\n  errorMessage,\n}: GitHubAuthModalProps) {\n  const { user, isSignedIn } = useUser();\n  const [isHovering, setIsHovering] = useState(false);\n  const [SignInButtonComponent, setSignInButtonComponent] = useState<\n    React.ComponentType<{ mode: string; children: React.ReactNode }> | null\n  >(null);\n\n  // Check if user has GitHub connected\n  const hasGitHub = user?.externalAccounts?.some(\n    (account) => account.provider === 'github'\n  );\n\n  // Dynamically load Clerk SignInButton\n  useEffect(() => {\n    if (!CLERK_CONFIGURED || isSignedIn) {\n      return;\n    }\n\n    let isMounted = true;\n\n    const loadClerk = async () => {\n      try {\n        const clerk = await import('@clerk/nextjs');\n        if (isMounted) {\n          setSignInButtonComponent(\n            () => clerk.SignInButton as React.ComponentType<{ mode: string; children: React.ReactNode }>\n          );\n        }\n      } catch {\n        // Clerk failed to load\n      }\n    };\n\n    loadClerk();\n\n    return () => {\n      isMounted = false;\n    };\n  }, [isSignedIn]);\n\n  // Handle connecting GitHub for signed-in users\n  const handleConnectGitHub = useCallback(() => {\n    // Redirect to integrations settings page\n    window.location.href = '/settings/integrations';\n  }, []);\n\n  // If Clerk isn't configured, allow bypass\n  if (!CLERK_CONFIGURED && isOpen) {\n    onAuthenticated?.();\n    onClose();\n    return null;\n  }\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"fixed inset-0 z-50 bg-black/80 backdrop-blur-sm\"\n            onClick={onClose}\n          />\n\n          {/* Modal */}\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\n            transition={{ type: 'spring', stiffness: 300, damping: 30 }}\n            className=\"fixed inset-0 z-50 flex items-center justify-center p-4\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            <div className=\"w-full max-w-md bg-gradient-to-b from-neutral-900 to-black rounded-3xl border border-white/10 overflow-hidden shadow-2xl\">\n              {/* Close button */}\n              <button\n                onClick={onClose}\n                className=\"absolute top-4 right-4 p-2 text-white/40 hover:text-white/80 transition-colors rounded-full hover:bg-white/5\"\n              >\n                <X className=\"w-5 h-5\" />\n              </button>\n\n              {/* Header */}\n              <div className=\"px-6 pt-8 pb-6 text-center\">\n                {/* Animated Orb */}\n                <motion.div\n                  className=\"w-20 h-20 mx-auto mb-4 relative\"\n                  animate={{\n                    boxShadow: isHovering\n                      ? [\n                          '0 0 30px rgba(34, 197, 94, 0.5)',\n                          '0 0 50px rgba(34, 197, 94, 0.7)',\n                          '0 0 30px rgba(34, 197, 94, 0.5)',\n                        ]\n                      : [\n                          '0 0 20px rgba(34, 197, 94, 0.3)',\n                          '0 0 30px rgba(34, 197, 94, 0.4)',\n                          '0 0 20px rgba(34, 197, 94, 0.3)',\n                        ],\n                  }}\n                  transition={{ duration: 2, repeat: Infinity }}\n                  style={{ borderRadius: '50%' }}\n                >\n                  <div className=\"w-full h-full rounded-full bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center\">\n                    <Github className=\"w-8 h-8 text-white\" />\n                  </div>\n                </motion.div>\n\n                {/* Error indicator */}\n                {errorMessage && (\n                  <div className=\"flex items-center justify-center gap-2 mb-4 px-3 py-2 rounded-lg bg-red-500/10 border border-red-500/20\">\n                    <AlertTriangle className=\"w-4 h-4 text-red-400\" />\n                    <span className=\"text-sm text-red-300\">{errorMessage}</span>\n                  </div>\n                )}\n\n                {/* Message */}\n                <h2 className=\"text-xl font-bold text-white mb-2\">\n                  GitHub Authentication Required\n                </h2>\n                <p className=\"text-white/50 text-sm leading-relaxed\">\n                  {isSignedIn && !hasGitHub\n                    ? 'Connect your GitHub account to enable sandbox features.'\n                    : 'To use the sandbox environment, you need to authenticate with GitHub. This enables secure code execution and repository access.'}\n                </p>\n              </div>\n\n              {/* Features */}\n              <div className=\"px-6 pb-6\">\n                <div className=\"bg-white/5 rounded-2xl p-4 space-y-3\">\n                  <div className=\"flex items-center gap-3 text-sm\">\n                    <div className=\"w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center\">\n                      <Shield className=\"w-4 h-4 text-white/60\" />\n                    </div>\n                    <div>\n                      <p className=\"text-white/80\">Secure Sandbox Access</p>\n                      <p className=\"text-white/40 text-xs\">Run code in isolated cloud environments</p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-3 text-sm\">\n                    <div className=\"w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center\">\n                      <Code2 className=\"w-4 h-4 text-white/60\" />\n                    </div>\n                    <div>\n                      <p className=\"text-white/80\">Repository Integration</p>\n                      <p className=\"text-white/40 text-xs\">Clone, commit, and push to your repos</p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-3 text-sm\">\n                    <div className=\"w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center\">\n                      <Terminal className=\"w-4 h-4 text-white/60\" />\n                    </div>\n                    <div>\n                      <p className=\"text-white/80\">Full Terminal Access</p>\n                      <p className=\"text-white/40 text-xs\">Run commands and build projects</p>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Action Button */}\n              <div className=\"px-6 pb-8\">\n                {isSignedIn ? (\n                  // User is signed in - direct to connect GitHub\n                  <button\n                    onClick={handleConnectGitHub}\n                    onMouseEnter={() => setIsHovering(true)}\n                    onMouseLeave={() => setIsHovering(false)}\n                    className=\"w-full flex items-center justify-center gap-3 px-6 py-4 rounded-2xl bg-gradient-to-r from-green-500 to-green-600 hover:from-green-400 hover:to-green-500 text-white font-semibold transition-all shadow-lg shadow-green-500/25\"\n                  >\n                    <Github className=\"w-5 h-5\" />\n                    <span>Connect GitHub Account</span>\n                    <ExternalLink className=\"w-4 h-4 opacity-60\" />\n                  </button>\n                ) : SignInButtonComponent ? (\n                  <SignInButtonComponent mode=\"modal\">\n                    <button\n                      onMouseEnter={() => setIsHovering(true)}\n                      onMouseLeave={() => setIsHovering(false)}\n                      className=\"w-full flex items-center justify-center gap-3 px-6 py-4 rounded-2xl bg-gradient-to-r from-green-500 to-green-600 hover:from-green-400 hover:to-green-500 text-white font-semibold transition-all shadow-lg shadow-green-500/25\"\n                    >\n                      <Github className=\"w-5 h-5\" />\n                      <span>Sign in with GitHub</span>\n                    </button>\n                  </SignInButtonComponent>\n                ) : (\n                  <button\n                    onClick={() => {\n                      onAuthenticated?.();\n                      onClose();\n                    }}\n                    className=\"w-full flex items-center justify-center gap-3 px-6 py-4 rounded-2xl bg-gradient-to-r from-green-500 to-green-600 hover:from-green-400 hover:to-green-500 text-white font-semibold transition-all shadow-lg shadow-green-500/25\"\n                  >\n                    <Github className=\"w-5 h-5\" />\n                    <span>Continue</span>\n                  </button>\n                )}\n\n                <p className=\"text-center text-white/30 text-xs mt-4\">\n                  {isSignedIn\n                    ? 'You\\'ll be redirected to connect your GitHub account'\n                    : 'Authentication is required for sandbox operations'}\n                </p>\n              </div>\n\n              {/* Cancel option */}\n              <div className=\"px-6 pb-6 text-center\">\n                <button\n                  onClick={onClose}\n                  className=\"text-white/40 hover:text-white/60 text-sm transition-colors\"\n                >\n                  Cancel and go back\n                </button>\n              </div>\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n}\n\nexport default GitHubAuthModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3760, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/auth/AgentAccessRestricted.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useRef, useCallback } from 'react';\nimport { motion } from 'framer-motion';\nimport { Heart, ArrowLeft, Sparkles, Github, Volume2, VolumeX, Copy, Check, Database } from 'lucide-react';\nimport Link from 'next/link';\nimport Image from 'next/image';\nimport { SignInButton, SignedOut } from '@clerk/nextjs';\n\ninterface AgentAccessRestrictedProps {\n  isLoading?: boolean;\n  isSignedIn?: boolean;\n  clerkId?: string;\n  userEmail?: string;\n}\n\n// James's warm rejection messages\nconst JAMES_MESSAGES = [\n  \"Ah, here's the thing...\",\n  \"I'd love to let you into the workshop, truly I would. But this particular room is where I keep all the sharp tools and live wires.\",\n  \"The OpenClaw can execute code, push to repos, and deploy to production. So I keep it locked up tight. Nothing personal, just being a responsible host.\",\n];\n\n// Full message for TTS (all messages combined)\nconst JAMES_FULL_MESSAGE = JAMES_MESSAGES.join(' ');\n\n// Try Eleven Labs first, fall back to OpenAI (same pattern as VoiceScreen)\nasync function generateSpeech(text: string): Promise<Blob> {\n  // Try Eleven Labs first\n  try {\n    const elevenLabsRes = await fetch('/api/tts/elevenlabs', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        text,\n        stability: 0.5,\n        similarityBoost: 0.75,\n      }),\n    });\n\n    if (elevenLabsRes.ok) {\n      const blob = await elevenLabsRes.blob();\n      if (blob.size > 0) {\n        console.log('[AgentAccessRestricted] Using Eleven Labs TTS');\n        return blob;\n      }\n    }\n\n    // Check if we should fallback\n    const errorJson = await elevenLabsRes.json().catch(() => null);\n    if (errorJson?.fallback !== 'openai') {\n      throw new Error('Eleven Labs failed without fallback');\n    }\n  } catch (e) {\n    console.log('[AgentAccessRestricted] Eleven Labs unavailable, trying OpenAI:', e);\n  }\n\n  // Fallback to OpenAI\n  console.log('[AgentAccessRestricted] Using OpenAI TTS fallback');\n  const openaiRes = await fetch('/api/tts', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      text,\n      voice: 'onyx', // Warm male voice\n      model: 'tts-1-hd',\n      speed: 1.0,\n    }),\n  });\n\n  if (!openaiRes.ok) {\n    throw new Error('Both TTS services failed');\n  }\n\n  return openaiRes.blob();\n}\n\n/**\n * AgentAccessRestricted - Claw AI gracefully declines access to non-owners\n *\n * The agent/sandbox feature is owner-only for security reasons:\n * - It can execute arbitrary code\n * - It has access to GitHub repositories\n * - It can deploy to Vercel\n *\n * But we do it with warmth and charm, as James would.\n */\nexport function AgentAccessRestricted({ isLoading, isSignedIn, clerkId, userEmail }: AgentAccessRestrictedProps) {\n  // Typewriter state (must be before any early returns - hooks rule)\n  const [currentMessageIndex, setCurrentMessageIndex] = useState(0);\n  const [displayedText, setDisplayedText] = useState('');\n  const [isTyping, setIsTyping] = useState(true);\n  const [showActions, setShowActions] = useState(false);\n  const [copied, setCopied] = useState(false);\n\n  // Audio state\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [isMuted, setIsMuted] = useState(false);\n  const audioRef = useRef<HTMLAudioElement | null>(null);\n  const hasStartedAudio = useRef(false);\n\n  // Copy Clerk ID to clipboard\n  const copyClerkId = useCallback(() => {\n    if (clerkId) {\n      navigator.clipboard.writeText(clerkId);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n    }\n  }, [clerkId]);\n\n  // Cache key for the audio (static message, so we can cache it forever)\n  const AUDIO_CACHE_KEY = 'james_restricted_audio_v1';\n\n  // Generate and play TTS audio when component mounts (not loading)\n  // Uses localStorage cache to avoid regenerating on every visit\n  useEffect(() => {\n    if (isLoading || hasStartedAudio.current) return;\n    hasStartedAudio.current = true;\n\n    const loadAndPlayAudio = async () => {\n      try {\n        let audioUrl: string;\n\n        // Check cache first\n        const cachedAudio = localStorage.getItem(AUDIO_CACHE_KEY);\n        if (cachedAudio) {\n          console.log('[AgentAccessRestricted] Using cached audio');\n          audioUrl = cachedAudio;\n        } else {\n          console.log('[AgentAccessRestricted] Generating speech (will cache)...');\n          const audioBlob = await generateSpeech(JAMES_FULL_MESSAGE);\n\n          // Convert blob to base64 data URL for caching\n          const reader = new FileReader();\n          audioUrl = await new Promise((resolve) => {\n            reader.onloadend = () => resolve(reader.result as string);\n            reader.readAsDataURL(audioBlob);\n          });\n\n          // Cache the audio\n          try {\n            localStorage.setItem(AUDIO_CACHE_KEY, audioUrl);\n            console.log('[AgentAccessRestricted] Audio cached');\n          } catch (storageErr) {\n            console.warn('[AgentAccessRestricted] Could not cache audio:', storageErr);\n          }\n        }\n\n        const audio = new Audio(audioUrl);\n\n        audio.onended = () => {\n          setIsPlaying(false);\n          console.log('[AgentAccessRestricted] Audio ended');\n        };\n\n        audio.onerror = (e) => {\n          console.error('[AgentAccessRestricted] Audio error:', e);\n          setIsPlaying(false);\n          // Clear cache on error in case it's corrupted\n          localStorage.removeItem(AUDIO_CACHE_KEY);\n        };\n\n        audioRef.current = audio;\n\n        // Try to autoplay\n        try {\n          await audio.play();\n          setIsPlaying(true);\n          console.log('[AgentAccessRestricted] Audio playing');\n        } catch (playError) {\n          console.warn('[AgentAccessRestricted] Autoplay blocked:', playError);\n          // User will need to click to play\n        }\n      } catch (err) {\n        console.error('[AgentAccessRestricted] TTS error:', err);\n      }\n    };\n\n    loadAndPlayAudio();\n\n    return () => {\n      if (audioRef.current) {\n        audioRef.current.pause();\n        audioRef.current = null;\n      }\n    };\n  }, [isLoading]);\n\n  // Toggle mute\n  const toggleMute = useCallback(() => {\n    if (audioRef.current) {\n      if (isMuted) {\n        audioRef.current.muted = false;\n        setIsMuted(false);\n      } else {\n        audioRef.current.muted = true;\n        setIsMuted(true);\n      }\n    }\n  }, [isMuted]);\n\n  // Play audio if not already playing (for autoplay blocked scenario)\n  const handlePlayClick = useCallback(async () => {\n    if (audioRef.current && !isPlaying) {\n      try {\n        await audioRef.current.play();\n        setIsPlaying(true);\n      } catch (err) {\n        console.error('[AgentAccessRestricted] Play failed:', err);\n      }\n    }\n  }, [isPlaying]);\n\n  // Typewriter effect - types out each message, then moves to next\n  useEffect(() => {\n    // Don't run typewriter when loading\n    if (isLoading) return;\n\n    if (currentMessageIndex >= JAMES_MESSAGES.length) {\n      setIsTyping(false);\n      // Show actions after all messages are typed\n      const timer = setTimeout(() => setShowActions(true), 500);\n      return () => clearTimeout(timer);\n    }\n\n    const currentMessage = JAMES_MESSAGES[currentMessageIndex];\n    let charIndex = 0;\n    setDisplayedText('');\n    setIsTyping(true);\n\n    const typeInterval = setInterval(() => {\n      if (charIndex < currentMessage.length) {\n        setDisplayedText(currentMessage.slice(0, charIndex + 1));\n        charIndex++;\n      } else {\n        clearInterval(typeInterval);\n        // Pause before next message\n        setTimeout(() => {\n          setCurrentMessageIndex(prev => prev + 1);\n        }, currentMessageIndex === 0 ? 800 : 1200); // Shorter pause after title\n      }\n    }, 30); // 30ms per character, same as onboarding\n\n    return () => clearInterval(typeInterval);\n  }, [currentMessageIndex, isLoading]);\n\n  // Loading state\n  if (isLoading) {\n    return (\n      <div\n        className=\"min-h-screen flex items-center justify-center\"\n        style={{\n          background: 'hsl(var(--theme-background))',\n          color: 'hsl(var(--theme-foreground))',\n        }}\n      >\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          className=\"flex flex-col items-center gap-4\"\n        >\n          {/* James's avatar with gentle pulse */}\n          <motion.div\n            className=\"w-16 h-16 rounded-full overflow-hidden ring-4 ring-[hsl(var(--theme-primary)/0.3)]\"\n            animate={{\n              boxShadow: [\n                '0 0 20px hsl(var(--theme-primary) / 0.2)',\n                '0 0 40px hsl(var(--theme-primary) / 0.4)',\n                '0 0 20px hsl(var(--theme-primary) / 0.2)',\n              ],\n            }}\n            transition={{ duration: 2, repeat: Infinity }}\n          >\n            <Image\n              src=\"/openclaw-logo.png\"\n              alt=\"James\"\n              width={64}\n              height={64}\n              className=\"w-full h-full object-cover\"\n            />\n          </motion.div>\n          <p className=\"text-sm\" style={{ color: 'hsl(var(--theme-muted-foreground))' }}>\n            One moment...\n          </p>\n        </motion.div>\n      </div>\n    );\n  }\n\n  return (\n    <div\n      className=\"min-h-screen flex items-center justify-center p-4\"\n      style={{\n        background: 'hsl(var(--theme-background))',\n        color: 'hsl(var(--theme-foreground))',\n      }}\n    >\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5 }}\n        className=\"max-w-md w-full text-center\"\n      >\n        {/* James's Avatar with warm glow and speaking indicator */}\n        <div className=\"relative w-24 h-24 mx-auto mb-6\">\n          <motion.div\n            className=\"w-full h-full rounded-full overflow-hidden ring-4 ring-[hsl(var(--theme-primary)/0.3)]\"\n            initial={{ scale: 0.8 }}\n            animate={{\n              scale: 1,\n              boxShadow: isPlaying ? [\n                '0 0 20px hsl(var(--theme-primary) / 0.3)',\n                '0 0 40px hsl(var(--theme-primary) / 0.5)',\n                '0 0 20px hsl(var(--theme-primary) / 0.3)',\n              ] : [\n                '0 0 20px hsl(var(--theme-primary) / 0.2)',\n                '0 0 30px hsl(var(--theme-primary) / 0.3)',\n                '0 0 20px hsl(var(--theme-primary) / 0.2)',\n              ],\n            }}\n            transition={{\n              scale: { type: 'spring', stiffness: 200, delay: 0.1 },\n              boxShadow: { duration: isPlaying ? 1 : 3, repeat: Infinity }\n            }}\n          >\n            <Image\n              src=\"/openclaw-logo.png\"\n              alt=\"James\"\n              width={96}\n              height={96}\n              className=\"w-full h-full object-cover\"\n            />\n          </motion.div>\n\n          {/* Audio control button */}\n          <motion.button\n            onClick={isPlaying ? toggleMute : handlePlayClick}\n            className=\"absolute -bottom-1 -right-1 w-8 h-8 rounded-full flex items-center justify-center transition-colors\"\n            style={{\n              background: 'hsl(var(--theme-primary))',\n              color: 'white',\n            }}\n            whileHover={{ scale: 1.1 }}\n            whileTap={{ scale: 0.95 }}\n            initial={{ opacity: 0, scale: 0 }}\n            animate={{ opacity: 1, scale: 1 }}\n            transition={{ delay: 0.5 }}\n            title={isPlaying ? (isMuted ? 'Unmute' : 'Mute') : 'Play audio'}\n          >\n            {isPlaying ? (\n              isMuted ? <VolumeX className=\"w-4 h-4\" /> : <Volume2 className=\"w-4 h-4\" />\n            ) : (\n              <Volume2 className=\"w-4 h-4\" />\n            )}\n          </motion.button>\n\n          {/* Speaking indicator */}\n          {isPlaying && !isMuted && (\n            <motion.div\n              className=\"absolute -top-1 -right-1 flex gap-0.5\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n            >\n              {[0, 0.1, 0.2].map((delay, i) => (\n                <motion.div\n                  key={i}\n                  className=\"w-1 rounded-full\"\n                  style={{ background: 'hsl(var(--theme-primary))' }}\n                  animate={{ height: [4, 12, 4] }}\n                  transition={{ duration: 0.4, repeat: Infinity, delay }}\n                />\n              ))}\n            </motion.div>\n          )}\n        </div>\n\n        {/* Streaming text display */}\n        <div className=\"min-h-[200px] flex flex-col justify-start\">\n          {/* Title (first message) */}\n          {currentMessageIndex >= 0 && (\n            <motion.h1\n              className=\"text-2xl font-bold mb-4\"\n              style={{ color: 'hsl(var(--theme-foreground))' }}\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n            >\n              {currentMessageIndex === 0 ? (\n                <>\n                  {displayedText}\n                  {isTyping && (\n                    <motion.span\n                      animate={{ opacity: [1, 0] }}\n                      transition={{ duration: 0.5, repeat: Infinity }}\n                      className=\"inline-block w-0.5 h-6 bg-current ml-0.5 align-middle\"\n                    />\n                  )}\n                </>\n              ) : (\n                JAMES_MESSAGES[0]\n              )}\n            </motion.h1>\n          )}\n\n          {/* First paragraph */}\n          {currentMessageIndex >= 1 && (\n            <motion.p\n              className=\"text-base mb-4 leading-relaxed\"\n              style={{ color: 'hsl(var(--theme-muted-foreground))' }}\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n            >\n              {currentMessageIndex === 1 ? (\n                <>\n                  {displayedText}\n                  {isTyping && (\n                    <motion.span\n                      animate={{ opacity: [1, 0] }}\n                      transition={{ duration: 0.5, repeat: Infinity }}\n                      className=\"inline-block w-0.5 h-5 bg-current ml-0.5 align-middle\"\n                    />\n                  )}\n                </>\n              ) : (\n                JAMES_MESSAGES[1]\n              )}\n            </motion.p>\n          )}\n\n          {/* Second paragraph */}\n          {currentMessageIndex >= 2 && (\n            <motion.p\n              className=\"text-base mb-6 leading-relaxed\"\n              style={{ color: 'hsl(var(--theme-muted-foreground))' }}\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n            >\n              {currentMessageIndex === 2 ? (\n                <>\n                  {displayedText}\n                  {isTyping && (\n                    <motion.span\n                      animate={{ opacity: [1, 0] }}\n                      transition={{ duration: 0.5, repeat: Infinity }}\n                      className=\"inline-block w-0.5 h-5 bg-current ml-0.5 align-middle\"\n                    />\n                  )}\n                </>\n              ) : (\n                JAMES_MESSAGES[2]\n              )}\n            </motion.p>\n          )}\n        </div>\n\n        {/* Actions - only show after typing completes */}\n        {showActions && (\n          <>\n            {/* If signed in but not in database - show Clerk ID */}\n            {isSignedIn && clerkId ? (\n              <motion.div\n                className=\"mb-6 p-4 rounded-xl text-left\"\n                style={{ background: 'hsl(var(--theme-primary) / 0.1)' }}\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.05 }}\n              >\n                <div className=\"flex items-center gap-2 mb-3\">\n                  <Database className=\"w-4 h-4\" style={{ color: 'hsl(var(--theme-primary))' }} />\n                  <span className=\"text-sm font-medium\" style={{ color: 'hsl(var(--theme-primary))' }}>\n                    Almost there! Run this in your terminal:\n                  </span>\n                </div>\n                <div className=\"mt-3 p-3 rounded-lg font-mono text-xs overflow-x-auto\" style={{ background: 'hsl(var(--theme-background))' }}>\n                  <code style={{ color: 'hsl(var(--theme-muted-foreground))' }}>\n                    npx convex run userManagement:seedOwner {`'{\"email\":\"${userEmail || 'your@email.com'}\",\"displayName\":\"Your Name\",\"clerkId\":\"${clerkId}\"}'`}\n                  </code>\n                </div>\n                <button\n                  onClick={() => {\n                    const cmd = `npx convex run userManagement:seedOwner '{\"email\":\"${userEmail || 'your@email.com'}\",\"displayName\":\"Your Name\",\"clerkId\":\"${clerkId}\"}'`;\n                    navigator.clipboard.writeText(cmd);\n                    setCopied(true);\n                    setTimeout(() => setCopied(false), 2000);\n                  }}\n                  className=\"mt-3 inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all hover:scale-[1.02]\"\n                  style={{\n                    background: 'hsl(var(--theme-primary))',\n                    color: 'white',\n                  }}\n                >\n                  {copied ? <Check className=\"w-4 h-4\" /> : <Copy className=\"w-4 h-4\" />}\n                  {copied ? 'Copied!' : 'Copy Command'}\n                </button>\n                <p className=\"mt-3 text-xs\" style={{ color: 'hsl(var(--theme-muted-foreground) / 0.7)' }}>\n                  This sets up owner permissions automatically. Refresh after running.\n                </p>\n              </motion.div>\n            ) : (\n              /* Sign in option for the owner */\n              <SignedOut>\n                <motion.div\n                  className=\"mb-6\"\n                  initial={{ opacity: 0, y: 10 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ delay: 0.05 }}\n                >\n                  <p\n                    className=\"text-sm mb-3\"\n                    style={{ color: 'hsl(var(--theme-muted-foreground))' }}\n                  >\n                    Wait, are you the owner?\n                  </p>\n                  <SignInButton mode=\"modal\">\n                    <button\n                      className=\"inline-flex items-center gap-2 px-6 py-3 rounded-xl font-medium transition-all hover:scale-[1.02] active:scale-[0.98]\"\n                      style={{\n                        background: 'hsl(142 70% 45%)',\n                        color: 'white',\n                      }}\n                    >\n                      <Github className=\"w-4 h-4\" />\n                      Sign in to prove it\n                    </button>\n                  </SignInButton>\n                </motion.div>\n              </SignedOut>\n            )}\n\n            {/* Divider */}\n            <motion.div\n              className=\"flex items-center gap-4 mb-6\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              transition={{ delay: 0.1 }}\n            >\n              <div className=\"flex-1 h-px\" style={{ background: 'hsl(var(--theme-border))' }} />\n              <span className=\"text-xs\" style={{ color: 'hsl(var(--theme-muted-foreground))' }}>or</span>\n              <div className=\"flex-1 h-px\" style={{ background: 'hsl(var(--theme-border))' }} />\n            </motion.div>\n\n            {/* Friendly note */}\n            <motion.div\n              className=\"flex items-center justify-center gap-2 mb-6 px-4 py-3 rounded-xl\"\n              style={{ background: 'hsl(var(--theme-primary) / 0.1)' }}\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.15 }}\n            >\n              <Heart className=\"w-4 h-4\" style={{ color: 'hsl(var(--theme-primary))' }} />\n              <span className=\"text-sm\" style={{ color: 'hsl(var(--theme-primary))' }}>\n                Thanks for understanding\n              </span>\n            </motion.div>\n\n            {/* Back Button */}\n            <motion.div\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.2 }}\n            >\n              <Link href=\"/\">\n                <motion.button\n                  whileHover={{ scale: 1.02 }}\n                  whileTap={{ scale: 0.98 }}\n                  className=\"inline-flex items-center gap-2 px-6 py-3 rounded-xl font-medium transition-colors\"\n                  style={{\n                    background: 'hsl(var(--theme-muted))',\n                    color: 'hsl(var(--theme-foreground))',\n                  }}\n                >\n                  <ArrowLeft className=\"w-4 h-4\" />\n                  Let&apos;s explore something else\n                </motion.button>\n              </Link>\n            </motion.div>\n\n            {/* Gentle suggestion */}\n            <motion.p\n              className=\"text-sm mt-8 flex items-center justify-center gap-2\"\n              style={{ color: 'hsl(var(--theme-muted-foreground) / 0.7)' }}\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              transition={{ delay: 0.3 }}\n            >\n              <Sparkles className=\"w-3 h-3\" />\n              Plenty of other interesting corners to discover\n              <Sparkles className=\"w-3 h-3\" />\n            </motion.p>\n          </>\n        )}\n      </motion.div>\n    </div>\n  );\n}\n\nexport default AgentAccessRestricted;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4777, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/lib/sandbox/tools.ts"],"sourcesContent":["/**\n * AI SDK Tools for Vercel Sandbox\n *\n * These tools enable AI models to interact with the sandbox\n * for code execution, file operations, and preview management.\n *\n * NOTE: These tools should only be used in server-side contexts\n * (e.g., API routes, server components) where the AI SDK is available.\n */\n\nimport { tool } from 'ai';\nimport { z } from 'zod';\nimport type { SandboxManager } from './index';\n\n/**\n * Create sandbox tools bound to a specific manager instance\n */\nexport function createSandboxTools(manager: SandboxManager) {\n  return {\n    /**\n     * Create a new sandbox environment\n     */\n    createSandbox: tool({\n      description:\n        'Create a new sandbox environment for code execution. Call this first before running any commands or writing files.',\n      inputSchema: z.object({\n        timeout: z\n          .number()\n          .optional()\n          .describe('Timeout in milliseconds (default: 600000)'),\n        ports: z\n          .array(z.number())\n          .optional()\n          .describe('Ports to expose (default: [3000])'),\n      }),\n      execute: async ({ timeout, ports }) => {\n        try {\n          const sandboxId = await manager.create({ timeout, ports });\n          return {\n            success: true,\n            sandboxId,\n            message: `Sandbox created with ID: ${sandboxId}`,\n          };\n        } catch (error) {\n          return {\n            success: false,\n            error: error instanceof Error ? error.message : 'Failed to create sandbox',\n          };\n        }\n      },\n    }),\n\n    /**\n     * Run a command in the sandbox\n     */\n    runCommand: tool({\n      description:\n        'Run a shell command in the sandbox. Use this for npm install, build commands, running scripts, etc.',\n      inputSchema: z.object({\n        command: z.string().describe('The command to run (e.g., \"npm\", \"node\", \"ls\")'),\n        args: z\n          .array(z.string())\n          .optional()\n          .describe('Arguments for the command'),\n        wait: z\n          .boolean()\n          .optional()\n          .describe('Wait for the command to complete (default: true)'),\n      }),\n      execute: async ({ command, args, wait = true }) => {\n        try {\n          const result = await manager.runCommand({ command, args, wait });\n          return {\n            success: true,\n            status: result.status,\n            exitCode: result.exitCode,\n            stdout: result.stdout,\n            stderr: result.stderr,\n          };\n        } catch (error) {\n          return {\n            success: false,\n            error: error instanceof Error ? error.message : 'Failed to run command',\n          };\n        }\n      },\n    }),\n\n    /**\n     * Write a file to the sandbox\n     */\n    writeFile: tool({\n      description:\n        'Write content to a file in the sandbox. Creates the file if it does not exist.',\n      inputSchema: z.object({\n        path: z.string().describe('The file path (e.g., \"src/app/page.tsx\")'),\n        content: z.string().describe('The content to write to the file'),\n      }),\n      execute: async ({ path, content }) => {\n        try {\n          await manager.writeFile({ path, content });\n          return {\n            success: true,\n            message: `File written: ${path}`,\n          };\n        } catch (error) {\n          return {\n            success: false,\n            error: error instanceof Error ? error.message : 'Failed to write file',\n          };\n        }\n      },\n    }),\n\n    /**\n     * Write multiple files to the sandbox\n     */\n    writeFiles: tool({\n      description:\n        'Write multiple files to the sandbox at once. More efficient than writing files one by one.',\n      inputSchema: z.object({\n        files: z\n          .array(\n            z.object({\n              path: z.string().describe('The file path'),\n              content: z.string().describe('The file content'),\n            })\n          )\n          .describe('Array of files to write'),\n      }),\n      execute: async ({ files }) => {\n        try {\n          await manager.writeFiles(files);\n          return {\n            success: true,\n            message: `${files.length} files written successfully`,\n            paths: files.map((f) => f.path),\n          };\n        } catch (error) {\n          return {\n            success: false,\n            error: error instanceof Error ? error.message : 'Failed to write files',\n          };\n        }\n      },\n    }),\n\n    /**\n     * Read a file from the sandbox\n     */\n    readFile: tool({\n      description: 'Read the contents of a file from the sandbox.',\n      inputSchema: z.object({\n        path: z.string().describe('The file path to read'),\n      }),\n      execute: async ({ path }) => {\n        try {\n          const content = await manager.readFile(path);\n          return {\n            success: true,\n            path,\n            content,\n          };\n        } catch (error) {\n          return {\n            success: false,\n            error: error instanceof Error ? error.message : 'Failed to read file',\n          };\n        }\n      },\n    }),\n\n    /**\n     * List files in a directory\n     */\n    listFiles: tool({\n      description: 'List files and directories in the sandbox.',\n      inputSchema: z.object({\n        path: z\n          .string()\n          .optional()\n          .describe('Directory path to list (default: /vercel/sandbox)'),\n      }),\n      execute: async ({ path }) => {\n        try {\n          await manager.listFiles(path);\n          const state = manager.getState();\n          return {\n            success: true,\n            path: path || '/vercel/sandbox',\n            files: state.files,\n          };\n        } catch (error) {\n          return {\n            success: false,\n            error: error instanceof Error ? error.message : 'Failed to list files',\n          };\n        }\n      },\n    }),\n\n    /**\n     * Get the preview URL for the sandbox\n     */\n    getPreviewUrl: tool({\n      description:\n        'Get the preview URL for viewing the running application in the sandbox.',\n      inputSchema: z.object({\n        port: z\n          .number()\n          .optional()\n          .describe('The port to get the preview URL for (default: 3000)'),\n      }),\n      execute: async ({ port }) => {\n        try {\n          const url = await manager.getPreviewUrl(port);\n          return {\n            success: true,\n            url,\n            port: port || 3000,\n          };\n        } catch (error) {\n          return {\n            success: false,\n            error: error instanceof Error ? error.message : 'Failed to get preview URL',\n          };\n        }\n      },\n    }),\n\n    /**\n     * Terminate the sandbox\n     */\n    terminateSandbox: tool({\n      description: 'Terminate the sandbox and clean up resources.',\n      inputSchema: z.object({}),\n      execute: async () => {\n        try {\n          await manager.terminate();\n          return {\n            success: true,\n            message: 'Sandbox terminated',\n          };\n        } catch (error) {\n          return {\n            success: false,\n            error: error instanceof Error ? error.message : 'Failed to terminate sandbox',\n          };\n        }\n      },\n    }),\n  };\n}\n\n/**\n * Type for all sandbox tools\n */\nexport type SandboxTools = ReturnType<typeof createSandboxTools>;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5004, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/lib/sandbox/index.ts"],"sourcesContent":["/**\n * Vercel Sandbox Integration for OpenClaw-OS Prototyping\n *\n * This provides real code execution capabilities using Vercel's cloud sandbox infrastructure.\n * The sandbox runs in a secure cloud container with full Node.js environment.\n *\n * NOTE: All sandbox operations are performed via API routes since @vercel/sandbox\n * is a server-only package that cannot be bundled for the browser.\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\n// File info returned by sandbox listFiles\nexport interface FileInfo {\n  path: string;\n  type: 'file' | 'directory';\n  size?: number;\n}\n\nexport interface SandboxState {\n  sandboxId: string | null;\n  status: 'idle' | 'creating' | 'ready' | 'error' | 'terminated';\n  previewUrl: string | null;\n  files: FileInfo[];\n  activeCommands: Map<string, CommandState>;\n  error: string | null;\n  createdAt: number | null;\n  timeout: number;\n}\n\nexport interface CommandState {\n  cmdId: string;\n  command: string;\n  args: string[];\n  status: 'running' | 'completed' | 'error';\n  exitCode?: number;\n  stdout?: string;\n  stderr?: string;\n  startedAt: number;\n}\n\nexport interface CreateSandboxOptions {\n  timeout?: number; // ms, default 600000 (10 min)\n  ports?: number[]; // ports to expose, e.g. [3000]\n}\n\nexport interface RunCommandOptions {\n  command: string;\n  args?: string[];\n  sudo?: boolean;\n  wait?: boolean; // wait for completion\n  cwd?: string;\n}\n\nexport interface WriteFileOptions {\n  path: string;\n  content: string;\n}\n\n// ============================================================================\n// Initial State\n// ============================================================================\n\nexport function createInitialSandboxState(): SandboxState {\n  return {\n    sandboxId: null,\n    status: 'idle',\n    previewUrl: null,\n    files: [],\n    activeCommands: new Map(),\n    error: null,\n    createdAt: null,\n    timeout: 600000,\n  };\n}\n\n// ============================================================================\n// API Client Helper\n// ============================================================================\n\nasync function callSandboxApi(action: string, params: Record<string, unknown> = {}) {\n  // Clone operations can take a while - use longer timeout\n  const timeout = action === 'cloneRepo' ? 120000 : 30000; // 2 min for clone, 30s for others\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n  try {\n    console.log(`[SandboxAPI] ${action}`, params);\n    const response = await fetch('/api/sandbox', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ action, ...params }),\n      signal: controller.signal,\n    });\n\n    clearTimeout(timeoutId);\n\n    const data = await response.json();\n    console.log(`[SandboxAPI] ${action} response:`, data);\n\n    if (!data.success) {\n      throw new Error(data.error || 'Sandbox API error');\n    }\n    return data;\n  } catch (error) {\n    clearTimeout(timeoutId);\n    if (error instanceof Error && error.name === 'AbortError') {\n      throw new Error(`${action} timed out after ${timeout / 1000}s`);\n    }\n    throw error;\n  }\n}\n\n// ============================================================================\n// Sandbox Manager Class\n// ============================================================================\n\nexport class SandboxManager {\n  private sandboxId: string | null = null;\n  private state: SandboxState = createInitialSandboxState();\n  private listeners: Set<(state: SandboxState) => void> = new Set();\n\n  /**\n   * Subscribe to state changes\n   */\n  subscribe(listener: (state: SandboxState) => void): () => void {\n    this.listeners.add(listener);\n    return () => this.listeners.delete(listener);\n  }\n\n  /**\n   * Get current state\n   */\n  getState(): SandboxState {\n    return { ...this.state };\n  }\n\n  /**\n   * Update state and notify listeners\n   */\n  private setState(updates: Partial<SandboxState>) {\n    this.state = { ...this.state, ...updates };\n    this.listeners.forEach((listener) => listener(this.state));\n  }\n\n  /**\n   * Create a new sandbox\n   */\n  async create(options: CreateSandboxOptions = {}): Promise<string> {\n    if (this.state.status === 'creating') {\n      throw new Error('Sandbox creation already in progress');\n    }\n\n    this.setState({ status: 'creating', error: null });\n\n    try {\n      const result = await callSandboxApi('create', {\n        timeout: options.timeout ?? 600000,\n        ports: options.ports ?? [3000],\n      });\n\n      this.sandboxId = result.sandboxId;\n      this.setState({\n        sandboxId: result.sandboxId,\n        status: 'ready',\n        createdAt: Date.now(),\n        timeout: options.timeout ?? 600000,\n      });\n\n      return result.sandboxId;\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      this.setState({ status: 'error', error: message });\n      throw error;\n    }\n  }\n\n  /**\n   * Connect to existing sandbox\n   */\n  async connect(sandboxId: string): Promise<void> {\n    this.setState({ status: 'creating', error: null });\n\n    try {\n      await callSandboxApi('connect', { sandboxId });\n      this.sandboxId = sandboxId;\n      this.setState({\n        sandboxId,\n        status: 'ready',\n      });\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      this.setState({ status: 'error', error: message });\n      throw error;\n    }\n  }\n\n  /**\n   * Run a command in the sandbox\n   */\n  async runCommand(options: RunCommandOptions): Promise<CommandState> {\n    if (!this.sandboxId) {\n      throw new Error('No sandbox connected');\n    }\n\n    const cmdState: CommandState = {\n      cmdId: `cmd_${Date.now()}`,\n      command: options.command,\n      args: options.args || [],\n      status: 'running',\n      startedAt: Date.now(),\n    };\n\n    // Add to active commands\n    const newCommands = new Map(this.state.activeCommands);\n    newCommands.set(cmdState.cmdId, cmdState);\n    this.setState({ activeCommands: newCommands });\n\n    try {\n      const result = await callSandboxApi('runCommand', {\n        sandboxId: this.sandboxId,\n        command: options.command,\n        args: options.args,\n        sudo: options.sudo,\n        wait: options.wait ?? true,\n      });\n\n      cmdState.cmdId = result.cmdId;\n      cmdState.status = result.status;\n      cmdState.exitCode = result.exitCode;\n      cmdState.stdout = result.stdout;\n      cmdState.stderr = result.stderr;\n\n      // Update command state\n      const updatedCommands = new Map(this.state.activeCommands);\n      updatedCommands.set(cmdState.cmdId, cmdState);\n      this.setState({ activeCommands: updatedCommands });\n\n      return cmdState;\n    } catch (error) {\n      cmdState.status = 'error';\n      cmdState.stderr = error instanceof Error ? error.message : 'Unknown error';\n\n      const updatedCommands = new Map(this.state.activeCommands);\n      updatedCommands.set(cmdState.cmdId, cmdState);\n      this.setState({ activeCommands: updatedCommands });\n\n      throw error;\n    }\n  }\n\n  /**\n   * Write a file to the sandbox\n   */\n  async writeFile(options: WriteFileOptions): Promise<void> {\n    if (!this.sandboxId) {\n      throw new Error('No sandbox connected');\n    }\n\n    await callSandboxApi('writeFile', {\n      sandboxId: this.sandboxId,\n      path: options.path,\n      content: options.content,\n    });\n\n    // Refresh file list\n    await this.listFiles();\n  }\n\n  /**\n   * Write multiple files to the sandbox\n   */\n  async writeFiles(files: WriteFileOptions[]): Promise<void> {\n    if (!this.sandboxId) {\n      throw new Error('No sandbox connected');\n    }\n\n    await callSandboxApi('writeFiles', {\n      sandboxId: this.sandboxId,\n      files,\n    });\n\n    // Refresh file list\n    await this.listFiles();\n  }\n\n  /**\n   * Read a file from the sandbox\n   */\n  async readFile(path: string): Promise<string> {\n    if (!this.sandboxId) {\n      throw new Error('No sandbox connected');\n    }\n\n    const result = await callSandboxApi('readFile', {\n      sandboxId: this.sandboxId,\n      path,\n    });\n\n    return result.content;\n  }\n\n  /**\n   * List files in the sandbox\n   */\n  async listFiles(path: string = '.'): Promise<FileInfo[]> {\n    if (!this.sandboxId) {\n      throw new Error('No sandbox connected');\n    }\n\n    try {\n      console.log('[listFiles] Listing files in:', path);\n      const result = await callSandboxApi('listFiles', {\n        sandboxId: this.sandboxId,\n        path,\n      });\n\n      const files: FileInfo[] = result.files;\n      console.log('[listFiles] Got files:', files.length, files.map(f => f.path).slice(0, 5));\n      this.setState({ files });\n      return files;\n    } catch (error) {\n      console.error('[listFiles] Error:', error);\n      // Return empty array if listing fails\n      const files: FileInfo[] = [];\n      this.setState({ files });\n      return files;\n    }\n  }\n\n  /**\n   * Get the preview URL for the sandbox\n   */\n  async getPreviewUrl(port: number = 3000): Promise<string> {\n    if (!this.sandboxId) {\n      throw new Error('No sandbox connected');\n    }\n\n    const result = await callSandboxApi('getPreviewUrl', {\n      sandboxId: this.sandboxId,\n      port,\n    });\n\n    this.setState({ previewUrl: result.url });\n    return result.url;\n  }\n\n  /**\n   * Clone a repository using GitHub authentication from Clerk\n   * This allows cloning private repos the user has access to\n   */\n  async cloneRepo(repoUrl: string): Promise<{ success: boolean; projectDir?: string; error?: string }> {\n    if (!this.sandboxId) {\n      throw new Error('No sandbox connected');\n    }\n\n    const result = await callSandboxApi('cloneRepo', {\n      sandboxId: this.sandboxId,\n      repoUrl,\n    });\n\n    // Refresh file list to show cloned repo\n    await this.listFiles('/workspace/project');\n\n    return {\n      success: result.success,\n      projectDir: result.projectDir,\n      error: result.error,\n    };\n  }\n\n  /**\n   * Terminate the sandbox\n   */\n  async terminate(): Promise<void> {\n    if (this.sandboxId) {\n      await callSandboxApi('terminate', { sandboxId: this.sandboxId });\n      this.sandboxId = null;\n    }\n\n    this.setState({\n      sandboxId: null,\n      status: 'terminated',\n      previewUrl: null,\n      files: [],\n      activeCommands: new Map(),\n    });\n  }\n\n  /**\n   * Check if sandbox is connected\n   */\n  isConnected(): boolean {\n    return this.sandboxId !== null && this.state.status === 'ready';\n  }\n}\n\n// ============================================================================\n// Singleton Instance\n// ============================================================================\n\nlet sandboxManager: SandboxManager | null = null;\n\nexport function getSandboxManager(): SandboxManager {\n  if (!sandboxManager) {\n    sandboxManager = new SandboxManager();\n  }\n  return sandboxManager;\n}\n\n// ============================================================================\n// Exports\n// ============================================================================\n\n// Export tools\nexport { createSandboxTools, type SandboxTools } from './tools';\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5354, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/contexts/SandboxContext.tsx"],"sourcesContent":["'use client';\n\nimport React, { createContext, useContext, useEffect, useState, useCallback } from 'react';\nimport type { SandboxState, CommandState } from '@/lib/sandbox';\nimport { createInitialSandboxState } from '@/lib/sandbox';\n\n// ============================================================================\n// Types\n// ============================================================================\n\ninterface SandboxContextValue {\n  // State\n  state: SandboxState;\n  isConnected: boolean;\n  isCreating: boolean;\n  error: string | null;\n\n  // Actions\n  create: (options?: { timeout?: number; ports?: number[] }) => Promise<string | null>;\n  connect: (sandboxId: string) => Promise<void>;\n  terminate: () => Promise<void>;\n\n  // File operations\n  writeFile: (path: string, content: string) => Promise<void>;\n  writeFiles: (files: { path: string; content: string }[]) => Promise<void>;\n  readFile: (path: string) => Promise<string>;\n  listFiles: (path?: string) => Promise<void>;\n\n  // Command execution\n  runCommand: (\n    command: string,\n    args?: string[],\n    options?: { wait?: boolean; sudo?: boolean }\n  ) => Promise<CommandState>;\n  runAndWait: (command: string, args?: string[]) => Promise<CommandState>;\n\n  // Preview\n  getPreviewUrl: (port?: number) => Promise<string>;\n\n  // Repository operations (with GitHub auth from Clerk)\n  cloneRepo: (repoUrl: string) => Promise<{ success: boolean; projectDir?: string; error?: string }>;\n\n  // Logs\n  logs: LogEntry[];\n  clearLogs: () => void;\n}\n\nexport interface LogEntry {\n  id: string;\n  timestamp: number;\n  type: 'command' | 'output' | 'error' | 'system';\n  message: string;\n  details?: string;\n}\n\n// ============================================================================\n// Context\n// ============================================================================\n\nconst SandboxContext = createContext<SandboxContextValue | null>(null);\n\n// ============================================================================\n// Provider\n// ============================================================================\n\nexport function SandboxProvider({ children }: { children: React.ReactNode }) {\n  const [state, setState] = useState<SandboxState>(createInitialSandboxState());\n  const [logs, setLogs] = useState<LogEntry[]>([]);\n  const [manager, setManager] = useState<import('@/lib/sandbox').SandboxManager | null>(\n    null\n  );\n\n  // Initialize manager on mount\n  useEffect(() => {\n    let mounted = true;\n\n    const initManager = async () => {\n      const { getSandboxManager } = await import('@/lib/sandbox');\n      if (!mounted) return;\n\n      const mgr = getSandboxManager();\n      setManager(mgr);\n\n      // Subscribe to state changes\n      const unsubscribe = mgr.subscribe((newState) => {\n        if (mounted) {\n          setState(newState);\n        }\n      });\n\n      // Set initial state\n      setState(mgr.getState());\n\n      return unsubscribe;\n    };\n\n    const unsubscribePromise = initManager();\n\n    return () => {\n      mounted = false;\n      unsubscribePromise.then((unsub) => unsub?.());\n    };\n  }, []);\n\n  // Helper to add log entry\n  const addLog = useCallback(\n    (type: LogEntry['type'], message: string, details?: string) => {\n      setLogs((prev) => [\n        ...prev,\n        {\n          id: `log_${Date.now()}_${Math.random().toString(36).slice(2)}`,\n          timestamp: Date.now(),\n          type,\n          message,\n          details,\n        },\n      ]);\n    },\n    []\n  );\n\n  // Clear logs\n  const clearLogs = useCallback(() => {\n    setLogs([]);\n  }, []);\n\n  // Create sandbox\n  const create = useCallback(\n    async (options?: { timeout?: number; ports?: number[] }) => {\n      if (!manager) throw new Error('Manager not initialized');\n\n      addLog('system', 'Creating sandbox...');\n      try {\n        const sandboxId = await manager.create(options);\n        addLog('system', `Sandbox created: ${sandboxId}`);\n        return sandboxId;\n      } catch (error) {\n        // Don't re-throw - error is captured in manager.error state\n        // This allows the UI to show auth modal instead of crashing\n        addLog('error', 'Failed to create sandbox', String(error));\n        return null;\n      }\n    },\n    [manager, addLog]\n  );\n\n  // Connect to existing sandbox\n  const connect = useCallback(\n    async (sandboxId: string) => {\n      if (!manager) throw new Error('Manager not initialized');\n\n      addLog('system', `Connecting to sandbox: ${sandboxId}`);\n      try {\n        await manager.connect(sandboxId);\n        addLog('system', 'Connected to sandbox');\n      } catch (error) {\n        addLog('error', 'Failed to connect', String(error));\n        throw error;\n      }\n    },\n    [manager, addLog]\n  );\n\n  // Terminate sandbox\n  const terminate = useCallback(async () => {\n    if (!manager) throw new Error('Manager not initialized');\n\n    addLog('system', 'Terminating sandbox...');\n    try {\n      await manager.terminate();\n      addLog('system', 'Sandbox terminated');\n    } catch (error) {\n      addLog('error', 'Failed to terminate', String(error));\n      throw error;\n    }\n  }, [manager, addLog]);\n\n  // Write file\n  const writeFile = useCallback(\n    async (path: string, content: string) => {\n      if (!manager) throw new Error('Manager not initialized');\n\n      addLog('command', `Writing file: ${path}`);\n      try {\n        await manager.writeFile({ path, content });\n        addLog('output', `File written: ${path}`);\n      } catch (error) {\n        addLog('error', `Failed to write file: ${path}`, String(error));\n        throw error;\n      }\n    },\n    [manager, addLog]\n  );\n\n  // Write multiple files\n  const writeFiles = useCallback(\n    async (files: { path: string; content: string }[]) => {\n      if (!manager) throw new Error('Manager not initialized');\n\n      addLog('command', `Writing ${files.length} files...`);\n      try {\n        await manager.writeFiles(files);\n        addLog('output', `${files.length} files written`);\n      } catch (error) {\n        addLog('error', 'Failed to write files', String(error));\n        throw error;\n      }\n    },\n    [manager, addLog]\n  );\n\n  // Read file\n  const readFile = useCallback(\n    async (path: string) => {\n      if (!manager) throw new Error('Manager not initialized');\n      return manager.readFile(path);\n    },\n    [manager]\n  );\n\n  // List files\n  const listFiles = useCallback(\n    async (path?: string) => {\n      if (!manager) throw new Error('Manager not initialized');\n      await manager.listFiles(path);\n    },\n    [manager]\n  );\n\n  // Run command\n  const runCommand = useCallback(\n    async (\n      command: string,\n      args?: string[],\n      options?: { wait?: boolean; sudo?: boolean }\n    ) => {\n      if (!manager) throw new Error('Manager not initialized');\n\n      const cmdStr = args ? `${command} ${args.join(' ')}` : command;\n      addLog('command', `$ ${cmdStr}`);\n\n      try {\n        const result = await manager.runCommand({\n          command,\n          args,\n          wait: options?.wait ?? true,\n          sudo: options?.sudo,\n        });\n\n        if (result.stdout) {\n          addLog('output', result.stdout);\n        }\n        if (result.stderr) {\n          addLog('error', result.stderr);\n        }\n        if (result.exitCode !== undefined && result.exitCode !== 0) {\n          addLog('error', `Exit code: ${result.exitCode}`);\n        }\n\n        return result;\n      } catch (error) {\n        addLog('error', `Command failed: ${cmdStr}`, String(error));\n        throw error;\n      }\n    },\n    [manager, addLog]\n  );\n\n  // Run command and wait\n  const runAndWait = useCallback(\n    async (command: string, args?: string[]) => {\n      return runCommand(command, args, { wait: true });\n    },\n    [runCommand]\n  );\n\n  // Get preview URL\n  const getPreviewUrl = useCallback(\n    async (port?: number) => {\n      if (!manager) throw new Error('Manager not initialized');\n\n      try {\n        const url = await manager.getPreviewUrl(port);\n        addLog('system', `Preview URL: ${url}`);\n        return url;\n      } catch (error) {\n        addLog('error', 'Failed to get preview URL', String(error));\n        throw error;\n      }\n    },\n    [manager, addLog]\n  );\n\n  // Clone repository with GitHub auth from Clerk\n  const cloneRepo = useCallback(\n    async (repoUrl: string) => {\n      if (!manager) throw new Error('Manager not initialized');\n\n      addLog('command', `git clone ${repoUrl}`);\n      try {\n        const result = await manager.cloneRepo(repoUrl);\n        if (result.success) {\n          addLog('system', `Repository cloned to ${result.projectDir}`);\n        } else {\n          addLog('error', result.error || 'Failed to clone repository');\n        }\n        return result;\n      } catch (error) {\n        addLog('error', 'Failed to clone repository', String(error));\n        throw error;\n      }\n    },\n    [manager, addLog]\n  );\n\n  const value: SandboxContextValue = {\n    state,\n    isConnected: state.status === 'ready',\n    isCreating: state.status === 'creating',\n    error: state.error,\n\n    create,\n    connect,\n    terminate,\n\n    writeFile,\n    writeFiles,\n    readFile,\n    listFiles,\n\n    runCommand,\n    runAndWait,\n\n    getPreviewUrl,\n    cloneRepo,\n\n    logs,\n    clearLogs,\n  };\n\n  return <SandboxContext.Provider value={value}>{children}</SandboxContext.Provider>;\n}\n\n// ============================================================================\n// Hook\n// ============================================================================\n\nexport function useSandboxContext(): SandboxContextValue {\n  const context = useContext(SandboxContext);\n  if (!context) {\n    throw new Error('useSandboxContext must be used within a SandboxProvider');\n  }\n  return context;\n}\n\nexport default SandboxContext;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5675, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/hooks/useChatThreads.ts"],"sourcesContent":["'use client';\n\nimport { useState, useCallback, useEffect } from 'react';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface ChatThread {\n  id: string;\n  title: string;\n  messages: Array<{\n    id: string;\n    role: 'user' | 'assistant';\n    content: string;\n    timestamp: number;\n  }>;\n  createdAt: number;\n  lastModified: number;\n}\n\n// ============================================================================\n// Storage\n// ============================================================================\n\nconst STORAGE_KEY = 'openclaw_chat_threads';\nconst ACTIVE_THREAD_KEY = 'openclaw_active_thread';\n\nfunction generateId(): string {\n  return `thread_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;\n}\n\nfunction generateMessageId(): string {\n  return `msg_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;\n}\n\nfunction generateTitle(messages: ChatThread['messages']): string {\n  // Get first user message for title\n  const firstUserMessage = messages.find(m => m.role === 'user');\n  if (firstUserMessage) {\n    const words = firstUserMessage.content.split(' ').slice(0, 6).join(' ');\n    return words.length < firstUserMessage.content.length ? `${words}...` : words;\n  }\n  return 'New conversation';\n}\n\n// ============================================================================\n// Hook\n// ============================================================================\n\nexport function useChatThreads() {\n  const [threads, setThreads] = useState<ChatThread[]>([]);\n  const [activeThreadId, setActiveThreadId] = useState<string | null>(null);\n  const [isLoaded, setIsLoaded] = useState(false);\n\n  // Load from localStorage on mount\n  useEffect(() => {\n    try {\n      const savedThreads = localStorage.getItem(STORAGE_KEY);\n      const savedActiveId = localStorage.getItem(ACTIVE_THREAD_KEY);\n\n      if (savedThreads) {\n        const parsed = JSON.parse(savedThreads) as ChatThread[];\n        setThreads(parsed);\n\n        // Set active thread\n        if (savedActiveId && parsed.some(t => t.id === savedActiveId)) {\n          setActiveThreadId(savedActiveId);\n        } else if (parsed.length > 0) {\n          setActiveThreadId(parsed[0].id);\n        }\n      }\n    } catch (e) {\n      console.error('Failed to load chat threads:', e);\n    }\n    setIsLoaded(true);\n  }, []);\n\n  // Save to localStorage on changes\n  useEffect(() => {\n    if (!isLoaded) return;\n\n    try {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(threads));\n      if (activeThreadId) {\n        localStorage.setItem(ACTIVE_THREAD_KEY, activeThreadId);\n      }\n    } catch (e) {\n      console.error('Failed to save chat threads:', e);\n    }\n  }, [threads, activeThreadId, isLoaded]);\n\n  // Get active thread\n  const activeThread = threads.find(t => t.id === activeThreadId) || null;\n\n  // Create new thread\n  const createThread = useCallback((): ChatThread => {\n    const newThread: ChatThread = {\n      id: generateId(),\n      title: 'New conversation',\n      messages: [],\n      createdAt: Date.now(),\n      lastModified: Date.now(),\n    };\n\n    setThreads(prev => [newThread, ...prev]);\n    setActiveThreadId(newThread.id);\n\n    return newThread;\n  }, []);\n\n  // Switch to thread\n  const switchThread = useCallback((threadId: string) => {\n    if (threads.some(t => t.id === threadId)) {\n      setActiveThreadId(threadId);\n    }\n  }, [threads]);\n\n  // Delete thread\n  const deleteThread = useCallback((threadId: string) => {\n    setThreads(prev => {\n      const filtered = prev.filter(t => t.id !== threadId);\n\n      // If we deleted the active thread, switch to another\n      if (activeThreadId === threadId) {\n        if (filtered.length > 0) {\n          setActiveThreadId(filtered[0].id);\n        } else {\n          setActiveThreadId(null);\n        }\n      }\n\n      return filtered;\n    });\n  }, [activeThreadId]);\n\n  // Add message to active thread\n  const addMessage = useCallback((\n    role: 'user' | 'assistant',\n    content: string\n  ) => {\n    if (!activeThreadId) return null;\n\n    const message = {\n      id: generateMessageId(),\n      role,\n      content,\n      timestamp: Date.now(),\n    };\n\n    setThreads(prev => prev.map(thread => {\n      if (thread.id !== activeThreadId) return thread;\n\n      const updatedMessages = [...thread.messages, message];\n      return {\n        ...thread,\n        messages: updatedMessages,\n        title: thread.messages.length === 0 && role === 'user'\n          ? generateTitle([message])\n          : thread.title,\n        lastModified: Date.now(),\n      };\n    }));\n\n    return message;\n  }, [activeThreadId]);\n\n  // Clear active thread messages\n  const clearActiveThread = useCallback(() => {\n    if (!activeThreadId) return;\n\n    setThreads(prev => prev.map(thread => {\n      if (thread.id !== activeThreadId) return thread;\n      return {\n        ...thread,\n        messages: [],\n        title: 'New conversation',\n        lastModified: Date.now(),\n      };\n    }));\n  }, [activeThreadId]);\n\n  // Get messages for active thread\n  const getMessages = useCallback(() => {\n    return activeThread?.messages || [];\n  }, [activeThread]);\n\n  // Ensure a thread exists (create one if none)\n  const ensureThread = useCallback(() => {\n    if (threads.length === 0 || !activeThreadId) {\n      return createThread();\n    }\n    return activeThread;\n  }, [threads.length, activeThreadId, createThread, activeThread]);\n\n  return {\n    threads,\n    activeThread,\n    activeThreadId,\n    isLoaded,\n    createThread,\n    switchThread,\n    deleteThread,\n    addMessage,\n    clearActiveThread,\n    getMessages,\n    ensureThread,\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5906, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/hooks/useStreamingChat.ts"],"sourcesContent":["'use client';\n\nimport { useState, useCallback, useRef } from 'react';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type ToolStatus = 'pending' | 'executing' | 'complete' | 'error' | 'denied';\n\nexport interface ActiveToolCall {\n  id: string;\n  name: string;\n  status: ToolStatus;\n  result?: unknown;\n  error?: string;\n}\n\nexport interface ChatMessage {\n  id: string;\n  role: 'user' | 'assistant' | 'system';\n  content: string;\n  timestamp: Date;\n  isStreaming?: boolean;\n  /** Chain-of-thought reasoning (from local models like Ollama with thinking) */\n  thinking?: string;\n  /** Whether thinking is still being streamed */\n  isThinkingStreaming?: boolean;\n  /** Active tool calls for this message */\n  toolCalls?: ActiveToolCall[];\n}\n\nexport interface UseStreamingChatOptions {\n  /** Model to use (claude, opus, sonnet, default) */\n  model?: string;\n  /** Optional theme context to include in system prompt */\n  themeContext?: string;\n  /** Callback when streaming starts */\n  onStreamStart?: () => void;\n  /** Callback when streaming ends */\n  onStreamEnd?: () => void;\n  /** Callback on error */\n  onError?: (error: Error) => void;\n}\n\nexport interface UseStreamingChatReturn {\n  messages: ChatMessage[];\n  isStreaming: boolean;\n  error: string | null;\n  /** Currently active tool calls (from streaming message) */\n  activeToolCalls: ActiveToolCall[];\n  sendMessage: (content: string) => Promise<void>;\n  clearMessages: () => void;\n  setMessages: React.Dispatch<React.SetStateAction<ChatMessage[]>>;\n  abortStream: () => void;\n}\n\n// ============================================================================\n// Hook\n// ============================================================================\n\nexport function useStreamingChat(\n  options: UseStreamingChatOptions = {}\n): UseStreamingChatReturn {\n  const { model = 'default', themeContext, onStreamStart, onStreamEnd, onError } = options;\n\n  const [messages, setMessages] = useState<ChatMessage[]>([]);\n  const [isStreaming, setIsStreaming] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [activeToolCalls, setActiveToolCalls] = useState<ActiveToolCall[]>([]);\n  const abortControllerRef = useRef<AbortController | null>(null);\n\n  const generateId = () => `msg_${Date.now()}_${Math.random().toString(36).slice(2, 9)}`;\n\n  const sendMessage = useCallback(\n    async (content: string) => {\n      if (!content.trim() || isStreaming) return;\n\n      setError(null);\n\n      // Create user message\n      const userMessage: ChatMessage = {\n        id: generateId(),\n        role: 'user',\n        content: content.trim(),\n        timestamp: new Date(),\n      };\n\n      // Create placeholder for assistant response\n      const assistantMessage: ChatMessage = {\n        id: generateId(),\n        role: 'assistant',\n        content: '',\n        timestamp: new Date(),\n        isStreaming: true,\n        thinking: '',\n        isThinkingStreaming: false,\n      };\n\n      setMessages((prev) => [...prev, userMessage, assistantMessage]);\n      setIsStreaming(true);\n      onStreamStart?.();\n\n      // Create abort controller for this request\n      abortControllerRef.current = new AbortController();\n\n      try {\n        // Prepare messages for API (exclude the placeholder)\n        const apiMessages = [...messages, userMessage].map((m) => ({\n          role: m.role,\n          content: m.content,\n        }));\n\n        const response = await fetch('/api/chat/stream', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            messages: apiMessages,\n            model,\n            themeContext,\n          }),\n          signal: abortControllerRef.current.signal,\n        });\n\n        if (!response.ok) {\n          const errorData = await response.json().catch(() => ({}));\n          throw new Error(errorData.error || 'Failed to get response');\n        }\n\n        const reader = response.body?.getReader();\n        if (!reader) {\n          throw new Error('No response body');\n        }\n\n        const decoder = new TextDecoder();\n        let accumulatedContent = '';\n        let accumulatedThinking = '';\n\n        while (true) {\n          const { done, value } = await reader.read();\n          if (done) break;\n\n          const chunk = decoder.decode(value, { stream: true });\n          const lines = chunk.split('\\n');\n\n          for (const line of lines) {\n            if (line.startsWith('data: ')) {\n              const data = line.slice(6);\n              if (data === '[DONE]') continue;\n\n              try {\n                const parsed = JSON.parse(data);\n\n                // Handle content (main response)\n                if (parsed.content) {\n                  accumulatedContent += parsed.content;\n                  // Update the assistant message with accumulated content\n                  setMessages((prev) =>\n                    prev.map((m) =>\n                      m.id === assistantMessage.id\n                        ? { ...m, content: accumulatedContent, isThinkingStreaming: false }\n                        : m\n                    )\n                  );\n                }\n\n                // Handle thinking/reasoning (chain of thought)\n                if (parsed.thinking) {\n                  accumulatedThinking += parsed.thinking;\n                  // Update the assistant message with accumulated thinking\n                  setMessages((prev) =>\n                    prev.map((m) =>\n                      m.id === assistantMessage.id\n                        ? { ...m, thinking: accumulatedThinking, isThinkingStreaming: true }\n                        : m\n                    )\n                  );\n                }\n\n                // Handle tool call start\n                if (parsed.toolCall) {\n                  const { id, name, status } = parsed.toolCall;\n                  setActiveToolCalls((prev) => {\n                    const existing = prev.find((tc) => tc.id === id);\n                    if (existing) {\n                      return prev.map((tc) =>\n                        tc.id === id ? { ...tc, status: status as ToolStatus } : tc\n                      );\n                    }\n                    return [...prev, { id, name, status: status as ToolStatus }];\n                  });\n                }\n\n                // Handle tool result\n                if (parsed.toolResult) {\n                  const { id, name, result } = parsed.toolResult;\n                  setActiveToolCalls((prev) =>\n                    prev.map((tc) =>\n                      tc.id === id ? { ...tc, status: 'complete' as ToolStatus, result } : tc\n                    )\n                  );\n                }\n\n                // Handle tool error\n                if (parsed.toolError) {\n                  const { id, error: toolError } = parsed.toolError;\n                  setActiveToolCalls((prev) =>\n                    prev.map((tc) =>\n                      tc.id === id ? { ...tc, status: 'error' as ToolStatus, error: toolError } : tc\n                    )\n                  );\n                }\n\n                // Handle tool denied (access control)\n                if (parsed.toolDenied) {\n                  const { name, reason } = parsed.toolDenied;\n                  const deniedId = `denied_${Date.now()}`;\n                  setActiveToolCalls((prev) => [\n                    ...prev,\n                    { id: deniedId, name, status: 'denied' as ToolStatus, error: reason },\n                  ]);\n                }\n              } catch {\n                // Skip invalid JSON\n              }\n            }\n          }\n        }\n\n        // Mark streaming as complete and attach tool calls to message\n        setActiveToolCalls((currentTools) => {\n          // Capture final tools before clearing\n          setMessages((prev) =>\n            prev.map((m) =>\n              m.id === assistantMessage.id\n                ? {\n                    ...m,\n                    isStreaming: false,\n                    isThinkingStreaming: false,\n                    toolCalls: currentTools.length > 0 ? [...currentTools] : undefined,\n                  }\n                : m\n            )\n          );\n          return []; // Clear active tool calls\n        });\n      } catch (err) {\n        if (err instanceof Error && err.name === 'AbortError') {\n          // Request was aborted, just mark streaming as complete\n          setMessages((prev) =>\n            prev.map((m) =>\n              m.id === assistantMessage.id\n                ? { ...m, isStreaming: false, content: m.content || 'Request cancelled.' }\n                : m\n            )\n          );\n        } else {\n          const errorMessage = err instanceof Error ? err.message : 'Unknown error';\n          setError(errorMessage);\n          onError?.(err instanceof Error ? err : new Error(errorMessage));\n\n          // Update the assistant message with error\n          setMessages((prev) =>\n            prev.map((m) =>\n              m.id === assistantMessage.id\n                ? {\n                    ...m,\n                    isStreaming: false,\n                    content: `Sorry, I encountered an error: ${errorMessage}. Please try again.`,\n                  }\n                : m\n            )\n          );\n        }\n      } finally {\n        setIsStreaming(false);\n        abortControllerRef.current = null;\n        onStreamEnd?.();\n      }\n    },\n    [messages, isStreaming, model, themeContext, onStreamStart, onStreamEnd, onError]\n  );\n\n  const clearMessages = useCallback(() => {\n    setMessages([]);\n    setError(null);\n    setActiveToolCalls([]);\n  }, []);\n\n  const abortStream = useCallback(() => {\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort();\n    }\n  }, []);\n\n  return {\n    messages,\n    isStreaming,\n    error,\n    activeToolCalls,\n    sendMessage,\n    clearMessages,\n    setMessages,\n    abortStream,\n  };\n}\n\nexport default useStreamingChat;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6204, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/hooks/useAgentSandbox.ts"],"sourcesContent":["'use client';\n\nimport { useCallback, useState, useRef, useEffect } from 'react';\nimport { useSandboxContext, type LogEntry } from '@/contexts/SandboxContext';\nimport type { ToolAction } from '@/lib/claw-ai/tools';\nimport type { FileInfo, CommandState } from '@/lib/sandbox';\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface SandboxFile {\n  path: string;\n  content?: string;\n  language?: string;\n}\n\nexport interface AgentSandboxState {\n  // Sandbox status\n  isConnected: boolean;\n  isCreating: boolean;\n  sandboxId: string | null;\n  previewUrl: string | null;\n  error: string | null;\n\n  // Files\n  files: FileInfo[];\n  currentFile: SandboxFile | null;\n\n  // Terminal\n  terminalOutput: TerminalLine[];\n  isRunning: boolean;\n\n  // Git\n  gitStatus: GitStatus | null;\n}\n\nexport interface TerminalLine {\n  id: string;\n  type: 'command' | 'output' | 'error' | 'system';\n  content: string;\n  timestamp: number;\n}\n\nexport interface GitStatus {\n  branch: string;\n  modified: string[];\n  staged: string[];\n  untracked: string[];\n}\n\nexport interface UseAgentSandboxReturn extends AgentSandboxState {\n  // Sandbox lifecycle\n  startSandbox: () => Promise<void>;\n  stopSandbox: () => Promise<void>;\n\n  // Execute tool actions from AI\n  executeToolAction: (action: ToolAction) => Promise<void>;\n\n  // Manual operations\n  cloneRepository: (url: string, branch?: string) => Promise<void>;\n  readFile: (path: string) => Promise<string>;\n  writeFile: (path: string, content: string) => Promise<void>;\n  runCommand: (command: string) => Promise<CommandState>;\n  startDevServer: (command?: string, port?: number) => Promise<string>;\n  refreshFiles: () => Promise<void>;\n\n  // Logs\n  logs: LogEntry[];\n  clearLogs: () => void;\n}\n\n// =============================================================================\n// Helper: Detect language from file path\n// =============================================================================\n\nfunction detectLanguage(path: string): string {\n  const ext = path.split('.').pop()?.toLowerCase();\n  const langMap: Record<string, string> = {\n    ts: 'typescript',\n    tsx: 'typescript',\n    js: 'javascript',\n    jsx: 'javascript',\n    json: 'json',\n    md: 'markdown',\n    mdx: 'markdown',\n    css: 'css',\n    scss: 'scss',\n    html: 'html',\n    py: 'python',\n    rs: 'rust',\n    go: 'go',\n    sh: 'shell',\n    bash: 'shell',\n    yml: 'yaml',\n    yaml: 'yaml',\n    toml: 'toml',\n    sql: 'sql',\n  };\n  return langMap[ext || ''] || 'plaintext';\n}\n\n// =============================================================================\n// Hook\n// =============================================================================\n\nexport function useAgentSandbox(): UseAgentSandboxReturn {\n  const sandbox = useSandboxContext();\n\n  // Local state\n  const [currentFile, setCurrentFile] = useState<SandboxFile | null>(null);\n  const [terminalOutput, setTerminalOutput] = useState<TerminalLine[]>([]);\n  const [isRunning, setIsRunning] = useState(false);\n  const [gitStatus, setGitStatus] = useState<GitStatus | null>(null);\n\n  // Terminal output helper\n  const addTerminalLine = useCallback(\n    (type: TerminalLine['type'], content: string) => {\n      setTerminalOutput((prev) => [\n        ...prev,\n        {\n          id: `term_${Date.now()}_${Math.random().toString(36).slice(2)}`,\n          type,\n          content,\n          timestamp: Date.now(),\n        },\n      ]);\n    },\n    []\n  );\n\n  // Start sandbox\n  const startSandbox = useCallback(async () => {\n    try {\n      addTerminalLine('system', 'Starting sandbox environment...');\n      await sandbox.create({ timeout: 600000, ports: [3000, 5173, 8080] });\n      await sandbox.listFiles('.');\n      addTerminalLine('system', 'Sandbox ready!');\n    } catch (error) {\n      // Don't re-throw - let the error be handled by the auth modal detection\n      // The error is already in sandbox.error and terminal output\n      addTerminalLine('error', `Failed to start sandbox: ${error}`);\n    }\n  }, [sandbox, addTerminalLine]);\n\n  // Stop sandbox\n  const stopSandbox = useCallback(async () => {\n    try {\n      addTerminalLine('system', 'Terminating sandbox...');\n      await sandbox.terminate();\n      setCurrentFile(null);\n      setGitStatus(null);\n      addTerminalLine('system', 'Sandbox terminated');\n    } catch (error) {\n      addTerminalLine('error', `Failed to stop sandbox: ${error}`);\n    }\n  }, [sandbox, addTerminalLine]);\n\n  // Clone repository (uses GitHub auth from Clerk for private repos)\n  const cloneRepository = useCallback(\n    async (url: string, _branch?: string) => {\n      if (!sandbox.isConnected) {\n        await startSandbox();\n      }\n\n      addTerminalLine('command', `git clone ${url} (authenticated via GitHub)`);\n      setIsRunning(true);\n\n      try {\n        // Use the server-side cloneRepo which handles GitHub auth\n        const result = await sandbox.cloneRepo(url);\n\n        if (result.success) {\n          addTerminalLine('system', `Repository cloned to ${result.projectDir}`);\n          // Refresh file list\n          await sandbox.listFiles(result.projectDir || './project');\n        } else {\n          addTerminalLine('error', result.error || 'Failed to clone repository');\n        }\n      } catch (error) {\n        addTerminalLine('error', `Clone failed: ${error}`);\n      } finally {\n        setIsRunning(false);\n      }\n    },\n    [sandbox, startSandbox, addTerminalLine]\n  );\n\n  // Read file\n  const readFile = useCallback(\n    async (path: string): Promise<string> => {\n      const content = await sandbox.readFile(path);\n      setCurrentFile({\n        path,\n        content,\n        language: detectLanguage(path),\n      });\n      return content;\n    },\n    [sandbox]\n  );\n\n  // Write file\n  const writeFile = useCallback(\n    async (path: string, content: string) => {\n      await sandbox.writeFile(path, content);\n      addTerminalLine('system', `Wrote file: ${path}`);\n\n      // Update current file if it's the same\n      if (currentFile?.path === path) {\n        setCurrentFile({ ...currentFile, content });\n      }\n    },\n    [sandbox, currentFile, addTerminalLine]\n  );\n\n  // Run command\n  const runCommand = useCallback(\n    async (command: string) => {\n      addTerminalLine('command', `$ ${command}`);\n      setIsRunning(true);\n\n      try {\n        // Intercept git clone commands to use authenticated cloning\n        const gitCloneMatch = command.match(/^git\\s+clone\\s+(\\S+)(?:\\s+(\\S+))?$/i);\n        if (gitCloneMatch) {\n          const repoUrl = gitCloneMatch[1];\n          addTerminalLine('system', 'Using authenticated clone...');\n          addTerminalLine('system', `Fetching GitHub token and cloning ${repoUrl}...`);\n\n          try {\n            const cloneResult = await sandbox.cloneRepo(repoUrl);\n            console.log('[Clone] Result:', cloneResult);\n\n            if (cloneResult.success) {\n              addTerminalLine('output', `â Cloned successfully to ${cloneResult.projectDir}`);\n              addTerminalLine('system', 'Refreshing file list...');\n              // Refresh file list after clone\n              await sandbox.listFiles(cloneResult.projectDir);\n              addTerminalLine('output', 'Ready! Use \"ls\" to see files.');\n            } else {\n              addTerminalLine('error', `â Clone failed: ${cloneResult.error || 'Unknown error'}`);\n            }\n            // Return a CommandState-compatible object\n            return {\n              cmdId: `cmd_clone_${Date.now()}`,\n              command: 'git',\n              args: ['clone', repoUrl],\n              status: (cloneResult.success ? 'completed' : 'error') as 'completed' | 'error',\n              startedAt: Date.now(),\n              exitCode: cloneResult.success ? 0 : 1,\n              stdout: cloneResult.success ? `Cloned to ${cloneResult.projectDir}` : '',\n              stderr: cloneResult.error || '',\n            };\n          } catch (cloneError) {\n            console.error('[Clone] Error:', cloneError);\n            const errorMsg = cloneError instanceof Error ? cloneError.message : 'Clone failed';\n            addTerminalLine('error', `â ${errorMsg}`);\n            return {\n              cmdId: `cmd_clone_${Date.now()}`,\n              command: 'git',\n              args: ['clone', repoUrl],\n              status: 'error' as const,\n              startedAt: Date.now(),\n              exitCode: 1,\n              stdout: '',\n              stderr: errorMsg,\n            };\n          }\n        }\n\n        // Parse command and args\n        const parts = command.split(' ');\n        const cmd = parts[0];\n        const args = parts.slice(1);\n\n        const result = await sandbox.runCommand(cmd, args);\n\n        if (result.stdout) addTerminalLine('output', result.stdout);\n        if (result.stderr) addTerminalLine('error', result.stderr);\n\n        return result;\n      } finally {\n        setIsRunning(false);\n      }\n    },\n    [sandbox, addTerminalLine]\n  );\n\n  // Start dev server\n  const startDevServer = useCallback(\n    async (command: string = 'npm run dev', port: number = 3000): Promise<string> => {\n      addTerminalLine('command', `$ ${command}`);\n      setIsRunning(true);\n\n      try {\n        // Run dev command (don't wait for completion as it's a long-running process)\n        const parts = command.split(' ');\n        await sandbox.runCommand(parts[0], parts.slice(1), { wait: false });\n\n        // Wait a moment for server to start\n        await new Promise((resolve) => setTimeout(resolve, 3000));\n\n        // Get preview URL\n        const url = await sandbox.getPreviewUrl(port);\n        addTerminalLine('system', `Dev server started at ${url}`);\n        return url;\n      } finally {\n        setIsRunning(false);\n      }\n    },\n    [sandbox, addTerminalLine]\n  );\n\n  // Refresh files\n  const refreshFiles = useCallback(async () => {\n    if (sandbox.isConnected) {\n      await sandbox.listFiles();\n    }\n  }, [sandbox]);\n\n  // Execute tool action from AI\n  const executeToolAction = useCallback(\n    async (action: ToolAction) => {\n      const { type, payload } = action;\n\n      switch (type) {\n        case 'repo_cloned': {\n          const { url, branch } = payload as { url: string; branch?: string };\n          await cloneRepository(url, branch);\n          break;\n        }\n\n        case 'file_read': {\n          const { path } = payload as { path: string };\n          await readFile(path);\n          break;\n        }\n\n        case 'file_written': {\n          const { path, content } = payload as { path: string; content: string };\n          await writeFile(path, content);\n          break;\n        }\n\n        case 'command_executed': {\n          const { command } = payload as { command: string };\n          await runCommand(command);\n          break;\n        }\n\n        case 'server_started': {\n          const { command, port } = payload as { command?: string; port?: number };\n          await startDevServer(command, port);\n          break;\n        }\n\n        case 'preview_ready': {\n          const { port } = payload as { port?: number };\n          await sandbox.getPreviewUrl(port || 3000);\n          break;\n        }\n\n        case 'git_status': {\n          const result = await runCommand('git status --porcelain');\n          // Parse git status output\n          const lines = (result as { stdout?: string }).stdout?.split('\\n').filter(Boolean) || [];\n          const status: GitStatus = {\n            branch: 'main', // Would need to parse from git branch\n            modified: [],\n            staged: [],\n            untracked: [],\n          };\n          lines.forEach((line) => {\n            const code = line.substring(0, 2);\n            const file = line.substring(3);\n            if (code.includes('M')) status.modified.push(file);\n            if (code.includes('A')) status.staged.push(file);\n            if (code === '??') status.untracked.push(file);\n          });\n          setGitStatus(status);\n          break;\n        }\n\n        case 'git_diff': {\n          const { path } = payload as { path?: string };\n          await runCommand(path ? `git diff ${path}` : 'git diff');\n          break;\n        }\n\n        case 'git_committed': {\n          const { message } = payload as { message: string };\n          await runCommand(`git add -A && git commit -m \"${message}\"`);\n          break;\n        }\n\n        case 'git_pushed': {\n          const { branch } = payload as { branch?: string };\n          await runCommand(branch ? `git push origin ${branch}` : 'git push');\n          break;\n        }\n\n        case 'branch_created': {\n          const { name } = payload as { name: string };\n          await runCommand(`git checkout -b ${name}`);\n          break;\n        }\n\n        case 'directory_listed': {\n          const { path } = payload as { path?: string };\n          await sandbox.listFiles(path || '.');\n          break;\n        }\n\n        case 'files_searched': {\n          const { pattern, path: searchPath } = payload as { pattern: string; path?: string };\n          await runCommand(`grep -r \"${pattern}\" ${searchPath || '.'}`);\n          break;\n        }\n\n        default:\n          // Other actions handled elsewhere (Convex mutations, etc.)\n          console.log('Unhandled sandbox action:', type, payload);\n      }\n    },\n    [cloneRepository, readFile, writeFile, runCommand, startDevServer, sandbox]\n  );\n\n  return {\n    // Status\n    isConnected: sandbox.isConnected,\n    isCreating: sandbox.isCreating,\n    sandboxId: sandbox.state.sandboxId,\n    previewUrl: sandbox.state.previewUrl,\n    error: sandbox.error,\n\n    // Files\n    files: sandbox.state.files,\n    currentFile,\n\n    // Terminal\n    terminalOutput,\n    isRunning,\n\n    // Git\n    gitStatus,\n\n    // Actions\n    startSandbox,\n    stopSandbox,\n    executeToolAction,\n    cloneRepository,\n    readFile,\n    writeFile,\n    runCommand,\n    startDevServer,\n    refreshFiles,\n\n    // Logs\n    logs: sandbox.logs,\n    clearLogs: sandbox.clearLogs,\n  };\n}\n\nexport default useAgentSandbox;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6637, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/app/agent/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useCallback, useEffect, useMemo, useRef } from 'react';\nimport dynamic from 'next/dynamic';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Menu, PanelLeftClose, PanelLeft, Code, Play, Square, Loader2 } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { useQuery } from '@/lib/openclaw/hooks';\nimport { useUser } from '@clerk/nextjs';\n\n// Components\nimport { AgentSidebar } from '@/components/agent/AgentSidebar';\nimport { ContextBar, ContextEntity, ViewDimension } from '@/components/agent/ContextBar';\nimport { CodePanel, CodePanelTab, FileNode, TerminalOutput } from '@/components/agent/CodePanel';\nimport { AgentChat, ChatMessage, MentionSuggestion } from '@/components/agent/AgentChat';\nimport { GitHubAuthModal } from '@/components/auth/GitHubAuthModal';\nimport { AgentAccessRestricted } from '@/components/auth/AgentAccessRestricted';\n\n// Contexts & Providers\nimport { SandboxProvider } from '@/contexts/SandboxContext';\n\n// Theme support\nimport '@/lib/themes/themes.css';\n\n// Hooks\nimport { useChatThreads } from '@/hooks/useChatThreads';\nimport { useStreamingChat } from '@/hooks/useStreamingChat';\nimport { useAgentSandbox } from '@/hooks/useAgentSandbox';\nimport type { FileInfo } from '@/lib/sandbox';\n\n// Import Convex API (userManagement may not be configured in all deployments)\nimport { api } from '@/lib/convex-shim';\n\n// Type-safe check for userManagement API\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst getManagedUserQuery = (api as any)?.userManagement?.getManagedUserByClerkId ?? null;\n\n// =============================================================================\n// Sample Data (will be replaced with real data from Convex)\n// =============================================================================\n\nconst SAMPLE_MEMORY_STATS = {\n  episodic: 42,\n  semantic: 18,\n  working: 3,\n};\n\nconst SAMPLE_MENTIONS: MentionSuggestion[] = [\n  { id: 'proj-1', type: 'project', name: 'OpenClaw-OS', description: 'Professional agentic operating system' },\n  { id: 'proj-2', type: 'project', name: 'OpenClaw', description: 'Next-gen agent platform' },\n  { id: 'prd-1', type: 'prd', name: 'infinity-agent', description: 'PRD for coding agent integration' },\n  { id: 'ticket-1', type: 'ticket', name: 'ARC-001', description: 'Implement context bar component' },\n  { id: 'ticket-2', type: 'ticket', name: 'ARC-002', description: 'Add code panel with monaco editor' },\n  { id: 'file-1', type: 'file', name: 'agent/page.tsx', description: 'Main agent page component' },\n];\n\n// =============================================================================\n// Convert FileInfo to FileNode for tree view\n// =============================================================================\n\nfunction convertFilesToTree(files: FileInfo[]): FileNode[] {\n  const root: FileNode[] = [];\n  const pathMap = new Map<string, FileNode>();\n\n  // Sort files so directories come first\n  const sorted = [...files].sort((a, b) => {\n    if (a.type === 'directory' && b.type === 'file') return -1;\n    if (a.type === 'file' && b.type === 'directory') return 1;\n    return a.path.localeCompare(b.path);\n  });\n\n  for (const file of sorted) {\n    const parts = file.path.split('/').filter(Boolean);\n    const name = parts[parts.length - 1];\n    const parentPath = '/' + parts.slice(0, -1).join('/');\n\n    const node: FileNode = {\n      name,\n      path: file.path,\n      type: file.type === 'directory' ? 'folder' : 'file',\n      children: file.type === 'directory' ? [] : undefined,\n      language: file.type === 'file' ? detectLanguage(name) : undefined,\n    };\n\n    pathMap.set(file.path, node);\n\n    if (parts.length === 1 || parentPath === '/home/user' || parentPath === '/home') {\n      root.push(node);\n    } else {\n      const parent = pathMap.get(parentPath);\n      if (parent && parent.children) {\n        parent.children.push(node);\n      } else {\n        root.push(node);\n      }\n    }\n  }\n\n  return root;\n}\n\nfunction detectLanguage(filename: string): string {\n  const ext = filename.split('.').pop()?.toLowerCase();\n  const langMap: Record<string, string> = {\n    ts: 'typescript',\n    tsx: 'typescript',\n    js: 'javascript',\n    jsx: 'javascript',\n    json: 'json',\n    md: 'markdown',\n    css: 'css',\n    html: 'html',\n    py: 'python',\n  };\n  return langMap[ext || ''] || 'plaintext';\n}\n\n// =============================================================================\n// Auth error detection helpers\n// =============================================================================\n\nconst AUTH_ERROR_PATTERNS = [\n  'Authentication required',\n  'authentication required',\n  'Unauthorized',\n  'unauthorized',\n  'GitHub OAuth',\n  'OAuth',\n  'oauth',\n  'token expired',\n  'Token expired',\n  'invalid token',\n  'Invalid token',\n  'access denied',\n  'Access denied',\n  'not authenticated',\n  'Not authenticated',\n  'Status code 400', // Sandbox API returns 400 when auth is missing\n  'Status code 401',\n  'Status code 403',\n];\n\nfunction isAuthError(error: string | null): boolean {\n  if (!error) return false;\n  return AUTH_ERROR_PATTERNS.some((pattern) => error.includes(pattern));\n}\n\n// =============================================================================\n// Main Page Content (with sandbox context)\n// =============================================================================\n\n// =============================================================================\n// Owner Check Wrapper - Separates auth logic from main content\n// =============================================================================\n\nfunction OwnerGate({ children }: { children: React.ReactNode }) {\n  const { user, isLoaded: isClerkLoaded } = useUser();\n  const clerkId = user?.id;\n\n  // IMPORTANT: Always call useQuery with the same query reference to maintain hook stability\n  // If getManagedUserQuery is null, we pass 'skip' to skip the query entirely\n  const managedUser = useQuery(\n    getManagedUserQuery!,\n    getManagedUserQuery && clerkId ? { clerkId } : 'skip'\n  );\n\n  // Determine loading and owner status\n  const isLoading = !isClerkLoaded || (getManagedUserQuery && clerkId && managedUser === undefined);\n\n  // If no user management API configured, allow access (backwards compat)\n  // Otherwise, check if user is owner/admin\n  const isOwner = !getManagedUserQuery || managedUser?.role === 'owner' || managedUser?.role === 'admin';\n\n  // Check if user is signed in but not in the database\n  const isSignedInButNotInDb = isClerkLoaded && user && getManagedUserQuery && managedUser === null;\n\n  if (isLoading) {\n    return <AgentAccessRestricted isLoading />;\n  }\n\n  if (!isOwner) {\n    // Pass user info for the \"signed in but not owner\" case\n    return (\n      <AgentAccessRestricted\n        isSignedIn={!!user}\n        clerkId={clerkId}\n        userEmail={user?.primaryEmailAddress?.emailAddress}\n      />\n    );\n  }\n\n  return <>{children}</>;\n}\n\n// =============================================================================\n// Main Page Content (with sandbox context)\n// =============================================================================\n\nfunction AgentPageContent() {\n  // Auth modal state\n  const [isAuthModalOpen, setIsAuthModalOpen] = useState(false);\n  const [authErrorMessage, setAuthErrorMessage] = useState<string | undefined>();\n  const previousErrorRef = useRef<string | null>(null);\n\n  // Sidebar state\n  const [isSidebarOpen, setIsSidebarOpen] = useState(true);\n  const [isSidebarCollapsed, setIsSidebarCollapsed] = useState(false);\n\n  // Context state\n  const [contextChain, setContextChain] = useState<ContextEntity[]>([]);\n  const [currentView, setCurrentView] = useState<ViewDimension>('chat');\n\n  // Code panel state\n  const [isCodePanelVisible, setIsCodePanelVisible] = useState(false);\n  const [isCodePanelExpanded, setIsCodePanelExpanded] = useState(false);\n  const [activeCodeTab, setActiveCodeTab] = useState<CodePanelTab>('code');\n\n  // Chat state\n  const [mentionSuggestions, setMentionSuggestions] = useState<MentionSuggestion[]>([]);\n\n  // Sandbox hook\n  const sandbox = useAgentSandbox();\n\n  // Detect auth errors from sandbox and show modal\n  useEffect(() => {\n    const currentError = sandbox.error;\n\n    // Only trigger modal if error changed and is an auth error\n    if (currentError !== previousErrorRef.current && isAuthError(currentError)) {\n      setAuthErrorMessage(currentError || 'Authentication required');\n      setIsAuthModalOpen(true);\n    }\n\n    previousErrorRef.current = currentError;\n  }, [sandbox.error]);\n\n  // Also detect auth errors from terminal output\n  useEffect(() => {\n    const lastTerminalLine = sandbox.terminalOutput[sandbox.terminalOutput.length - 1];\n    if (lastTerminalLine?.type === 'error' && isAuthError(lastTerminalLine.content)) {\n      setAuthErrorMessage(lastTerminalLine.content);\n      setIsAuthModalOpen(true);\n    }\n  }, [sandbox.terminalOutput]);\n\n  // Convert sandbox files to tree structure (must be before early returns - hooks rule)\n  const fileTree = useMemo(() => convertFilesToTree(sandbox.files), [sandbox.files]);\n\n  // Convert terminal output to CodePanel format\n  const terminalOutput: TerminalOutput[] = useMemo(\n    () =>\n      sandbox.terminalOutput.map((line) => ({\n        id: line.id,\n        type: line.type === 'command' ? 'command' : line.type === 'error' ? 'error' : 'output',\n        content: line.content,\n        timestamp: line.timestamp,\n      })),\n    [sandbox.terminalOutput]\n  );\n\n  // Chat hooks (must be before early returns - hooks rule)\n  const {\n    threads,\n    activeThreadId,\n    createThread,\n    switchThread,\n    deleteThread,\n    ensureThread,\n  } = useChatThreads();\n\n  const {\n    messages: streamingMessages,\n    isStreaming,\n    sendMessage: sendStreamingMessage,\n    abortStream,\n  } = useStreamingChat({\n    onStreamStart: () => console.log('Stream started'),\n    onStreamEnd: () => console.log('Stream ended'),\n  });\n\n  // Convert streaming messages to ChatMessage format\n  const chatMessages: ChatMessage[] = useMemo(() => streamingMessages.map((m) => ({\n    id: m.id,\n    role: m.role,\n    content: m.content,\n    timestamp: m.timestamp,\n    isStreaming: m.isStreaming,\n  })), [streamingMessages]);\n\n  // Handle successful authentication\n  const handleAuthenticated = useCallback(() => {\n    setIsAuthModalOpen(false);\n    setAuthErrorMessage(undefined);\n    // Retry starting sandbox after auth\n    sandbox.startSandbox();\n  }, [sandbox]);\n\n  // Handle sending message\n  const handleSendMessage = useCallback(\n    (content: string, mentions?: ContextEntity[]) => {\n      // Ensure we have a thread\n      ensureThread();\n\n      // Add mentions to context chain if any\n      if (mentions && mentions.length > 0) {\n        setContextChain((prev) => {\n          const newChain = [...prev];\n          mentions.forEach((m) => {\n            if (!newChain.find((e) => e.id === m.id)) {\n              newChain.push(m);\n            }\n          });\n          return newChain;\n        });\n      }\n\n      // Build context info\n      let contextInfo = '';\n\n      // Add sandbox capabilities when connected\n      if (sandbox.isConnected) {\n        contextInfo += '\\n\\n[SANDBOX CONNECTED - You have full coding capabilities: clone repos with git, run terminal commands, create/edit files, install packages, run dev servers. Use the terminal below to execute commands.]';\n      }\n\n      // Add active context chain\n      if (contextChain.length > 0) {\n        contextInfo += `\\n\\n[Active Context: ${contextChain.map(c => `@${c.type}:${c.name}`).join(', ')}]`;\n      }\n\n      sendStreamingMessage(content + contextInfo);\n\n      // If the message contains code-related keywords, show code panel\n      const codeKeywords = ['code', 'implement', 'create', 'build', 'fix', 'debug', 'file', 'component', 'clone', 'repo', 'git'];\n      if (codeKeywords.some((kw) => content.toLowerCase().includes(kw))) {\n        setIsCodePanelVisible(true);\n      }\n    },\n    [ensureThread, sendStreamingMessage, contextChain, sandbox.isConnected]\n  );\n\n  // Handle mention search\n  const handleMentionSearch = useCallback((query: string) => {\n    const filtered = SAMPLE_MENTIONS.filter(\n      (m) =>\n        m.name.toLowerCase().includes(query.toLowerCase()) ||\n        m.description?.toLowerCase().includes(query.toLowerCase())\n    );\n    setMentionSuggestions(filtered);\n  }, []);\n\n  // Handle mention select\n  const handleMentionSelect = useCallback((mention: MentionSuggestion) => {\n    const entity: ContextEntity = {\n      id: mention.id,\n      type: mention.type,\n      name: mention.name,\n      description: mention.description,\n    };\n    setContextChain((prev) => {\n      if (prev.find((e) => e.id === entity.id)) return prev;\n      return [...prev, entity];\n    });\n  }, []);\n\n  // Handle context chain changes\n  const handleRemoveEntity = useCallback((entityId: string) => {\n    setContextChain((prev) => prev.filter((e) => e.id !== entityId));\n  }, []);\n\n  const handleClearContext = useCallback(() => {\n    setContextChain([]);\n  }, []);\n\n  // Handle file selection\n  const handleFileSelect = useCallback(\n    async (path: string) => {\n      if (sandbox.isConnected) {\n        try {\n          await sandbox.readFile(path);\n          setActiveCodeTab('code');\n        } catch (error) {\n          console.error('Failed to read file:', error);\n        }\n      }\n    },\n    [sandbox]\n  );\n\n  // Handle terminal command\n  const handleRunCommand = useCallback(\n    async (command: string) => {\n      if (sandbox.isConnected) {\n        await sandbox.runCommand(command);\n      }\n    },\n    [sandbox]\n  );\n\n  // Handle mobile sidebar toggle\n  const handleMobileSidebarToggle = useCallback(() => {\n    setIsSidebarOpen((prev) => !prev);\n  }, []);\n\n  // Handle desktop sidebar collapse\n  const handleDesktopSidebarToggle = useCallback(() => {\n    setIsSidebarCollapsed((prev) => !prev);\n  }, []);\n\n  // Close sidebar on mobile when clicking outside\n  useEffect(() => {\n    const handleResize = () => {\n      if (window.innerWidth >= 1024) {\n        setIsSidebarOpen(true);\n      }\n    };\n\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  return (\n    <>\n      {/* GitHub Auth Modal - shown on auth errors for owner */}\n      <GitHubAuthModal\n        isOpen={isAuthModalOpen}\n        onClose={() => setIsAuthModalOpen(false)}\n        onAuthenticated={handleAuthenticated}\n        errorMessage={authErrorMessage}\n      />\n\n      <div\n        className=\"h-screen flex flex-col overflow-hidden\"\n        style={{\n          background: 'hsl(var(--theme-background))',\n          color: 'hsl(var(--theme-foreground))',\n          fontFamily: 'var(--theme-font)',\n        }}\n      >\n        {/* Main Layout */}\n        <div className=\"flex-1 flex overflow-hidden\">\n          {/* Sidebar */}\n          <AnimatePresence>\n            {(isSidebarOpen || (typeof window !== 'undefined' && window.innerWidth >= 1024)) &&\n              !isSidebarCollapsed && (\n                <AgentSidebar\n                  isOpen={isSidebarOpen}\n                  onClose={() => setIsSidebarOpen(false)}\n                  threads={threads}\n                  activeThreadId={activeThreadId}\n                  onNewThread={createThread}\n                  onSelectThread={switchThread}\n                  onDeleteThread={deleteThread}\n                  memoryStats={SAMPLE_MEMORY_STATS}\n                  recentMentions={contextChain.slice(-5).map((c) => ({\n                    id: c.id,\n                    type: c.type as 'project' | 'prd' | 'ticket' | 'file',\n                    name: c.name,\n                    timestamp: Date.now(),\n                  }))}\n                  onMentionClick={(mention) => {\n                    const entity = contextChain.find((e) => e.id === mention.id);\n                    if (entity) {\n                      console.log('Clicked mention:', entity);\n                    }\n                  }}\n                />\n              )}\n          </AnimatePresence>\n\n          {/* Main Content */}\n          <div className=\"flex-1 flex flex-col min-w-0\">\n            {/* Top Bar */}\n            <div\n              className=\"flex items-center gap-2 px-4 py-2\"\n              style={{\n                background: 'hsl(var(--theme-card))',\n                borderBottom: '1px solid hsl(var(--theme-border))',\n              }}\n            >\n              {/* Mobile menu button */}\n              <button\n                onClick={handleMobileSidebarToggle}\n                className=\"p-2 rounded-lg transition-colors lg:hidden\"\n                style={{ color: 'hsl(var(--theme-foreground))' }}\n                onMouseEnter={(e) => e.currentTarget.style.background = 'hsl(var(--theme-muted))'}\n                onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}\n              >\n                <Menu className=\"w-5 h-5\" />\n              </button>\n\n              {/* Desktop sidebar toggle */}\n              <button\n                onClick={handleDesktopSidebarToggle}\n                className=\"p-2 rounded-lg transition-colors hidden lg:flex\"\n                title={isSidebarCollapsed ? 'Show sidebar' : 'Hide sidebar'}\n                style={{ color: 'hsl(var(--theme-foreground))' }}\n                onMouseEnter={(e) => e.currentTarget.style.background = 'hsl(var(--theme-muted))'}\n                onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}\n              >\n                {isSidebarCollapsed ? (\n                  <PanelLeft className=\"w-5 h-5\" />\n                ) : (\n                  <PanelLeftClose className=\"w-5 h-5\" />\n                )}\n              </button>\n\n              {/* Title */}\n              <h1\n                className=\"text-lg font-semibold\"\n                style={{ color: 'hsl(var(--theme-foreground))' }}\n              >\n                OpenClaw AI\n              </h1>\n\n              {/* Spacer */}\n              <div className=\"flex-1\" />\n\n              {/* Sandbox controls */}\n              <div className=\"flex items-center gap-2\">\n                {!sandbox.isConnected ? (\n                  <button\n                    onClick={sandbox.startSandbox}\n                    disabled={sandbox.isCreating}\n                    className={cn(\n                      'flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm transition-colors',\n                      'disabled:opacity-50 disabled:cursor-not-allowed'\n                    )}\n                    style={{\n                      background: 'hsl(var(--theme-primary) / 0.2)',\n                      color: 'hsl(var(--theme-primary))',\n                    }}\n                    onMouseEnter={(e) => e.currentTarget.style.background = 'hsl(var(--theme-primary) / 0.3)'}\n                    onMouseLeave={(e) => e.currentTarget.style.background = 'hsl(var(--theme-primary) / 0.2)'}\n                  >\n                    {sandbox.isCreating ? (\n                      <>\n                        <Loader2 className=\"w-4 h-4 animate-spin\" />\n                        Starting...\n                      </>\n                    ) : (\n                      <>\n                        <Play className=\"w-4 h-4\" />\n                        Start Sandbox\n                      </>\n                    )}\n                  </button>\n                ) : (\n                  <button\n                    onClick={sandbox.stopSandbox}\n                    className=\"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm transition-colors\"\n                    style={{\n                      background: 'hsl(0 84% 60% / 0.2)',\n                      color: 'hsl(0 84% 60%)',\n                    }}\n                    onMouseEnter={(e) => e.currentTarget.style.background = 'hsl(0 84% 60% / 0.3)'}\n                    onMouseLeave={(e) => e.currentTarget.style.background = 'hsl(0 84% 60% / 0.2)'}\n                  >\n                    <Square className=\"w-4 h-4\" />\n                    Stop\n                  </button>\n                )}\n\n                {sandbox.isConnected && (\n                  <span className=\"text-xs font-medium\" style={{ color: 'hsl(142 70% 45%)' }}>â Connected</span>\n                )}\n              </div>\n\n              {/* Code panel toggle */}\n              <button\n                onClick={() => setIsCodePanelVisible((prev) => !prev)}\n                className=\"p-2 rounded-lg transition-colors\"\n                title={isCodePanelVisible ? 'Hide code panel' : 'Show code panel'}\n                style={{\n                  background: isCodePanelVisible ? 'hsl(var(--theme-primary) / 0.2)' : 'transparent',\n                  color: isCodePanelVisible ? 'hsl(var(--theme-primary))' : 'hsl(var(--theme-muted-foreground))',\n                }}\n                onMouseEnter={(e) => {\n                  if (!isCodePanelVisible) e.currentTarget.style.background = 'hsl(var(--theme-muted))';\n                }}\n                onMouseLeave={(e) => {\n                  if (!isCodePanelVisible) e.currentTarget.style.background = 'transparent';\n                }}\n              >\n                <Code className=\"w-5 h-5\" />\n              </button>\n            </div>\n\n            {/* Context Bar */}\n            <ContextBar\n              contextChain={contextChain}\n              currentView={currentView}\n              onViewChange={setCurrentView}\n              onEntityClick={(entity) => console.log('Entity clicked:', entity)}\n              onRemoveEntity={handleRemoveEntity}\n              onClearContext={handleClearContext}\n            />\n\n            {/* Chat Area */}\n            <div className=\"flex-1 min-h-0\">\n              <AgentChat\n                messages={chatMessages}\n                isStreaming={isStreaming}\n                onSendMessage={handleSendMessage}\n                onAbort={abortStream}\n                mentionSuggestions={mentionSuggestions}\n                onMentionSearch={handleMentionSearch}\n                onMentionSelect={handleMentionSelect}\n                isVoiceEnabled={true}\n              />\n            </div>\n\n            {/* Code Panel */}\n            <AnimatePresence>\n              {isCodePanelVisible && (\n                <CodePanel\n                  isVisible={isCodePanelVisible}\n                  isExpanded={isCodePanelExpanded}\n                  activeTab={activeCodeTab}\n                  onTabChange={setActiveCodeTab}\n                  onToggleExpanded={() => setIsCodePanelExpanded((prev) => !prev)}\n                  onClose={() => setIsCodePanelVisible(false)}\n                  code={sandbox.currentFile?.content || '// Select a file or start coding...'}\n                  language={sandbox.currentFile?.language || 'typescript'}\n                  currentFile={sandbox.currentFile?.path}\n                  onCodeChange={(code) => {\n                    if (sandbox.currentFile?.path) {\n                      sandbox.writeFile(sandbox.currentFile.path, code);\n                    }\n                  }}\n                  files={fileTree}\n                  onFileSelect={handleFileSelect}\n                  terminalOutput={terminalOutput}\n                  onRunCommand={handleRunCommand}\n                  isRunning={sandbox.isRunning}\n                  previewUrl={sandbox.previewUrl || undefined}\n                  onRefreshPreview={() => {\n                    if (sandbox.isConnected) {\n                      sandbox.startDevServer();\n                    }\n                  }}\n                />\n              )}\n            </AnimatePresence>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n}\n\n// =============================================================================\n// Main Page Component with Provider\n// =============================================================================\n\nfunction AgentPage() {\n  return (\n    <OwnerGate>\n      <SandboxProvider>\n        <AgentPageContent />\n      </SandboxProvider>\n    </OwnerGate>\n  );\n}\n\n// Use dynamic import with SSR disabled to prevent pre-render errors\n// This is required because useUser needs ClerkProvider which is only available client-side\nexport default dynamic(() => Promise.resolve(AgentPage), {\n  ssr: false,\n  loading: () => <AgentAccessRestricted isLoading />,\n});\n"],"names":[],"mappings":"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"}}]
}