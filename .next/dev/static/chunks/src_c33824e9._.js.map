{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/lib/claw-ai/slash-command-registry.ts"],"sourcesContent":["/**\n * Slash Command Registry - Comprehensive command system for Claw AI Chat\n *\n * Exposes all tools, skills, dimensions, and context as / commands and @ references\n */\n\nimport {\n  Search,\n  Compass,\n  Calendar,\n  FileText,\n  Brain,\n  Code,\n  Layers,\n  Palette,\n  Music,\n  Terminal,\n  GitBranch,\n  MessageSquare,\n  Video,\n  Zap,\n  Settings,\n  HelpCircle,\n  Sparkles,\n  Target,\n  Clock,\n  LayoutGrid,\n  Table,\n  LineChart,\n  List,\n  Users,\n  BookOpen,\n  Shield,\n  Cpu,\n  Image,\n  Mic,\n  Play,\n  Globe,\n  Folder,\n  Database,\n  Bot,\n  Wand2,\n  PenTool,\n  Eye,\n  Accessibility,\n  Smartphone,\n  Move3D,\n  Boxes,\n  FlaskConical,\n  type LucideIcon,\n} from 'lucide-react';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type CommandCategory =\n  | 'navigation'\n  | 'tools'\n  | 'skills'\n  | 'dimensions'\n  | 'context'\n  | 'media'\n  | 'code'\n  | 'memory'\n  | 'product'\n  | 'quick';\n\nexport interface SlashCommand {\n  /** Command name without the leading slash */\n  name: string;\n  /** Aliases that also trigger this command */\n  aliases?: string[];\n  /** Human-readable label */\n  label: string;\n  /** Description shown in picker */\n  description: string;\n  /** Category for grouping */\n  category: CommandCategory;\n  /** Icon component */\n  icon: LucideIcon;\n  /** Color for the icon */\n  color: string;\n  /** If true, only available to owner */\n  ownerOnly?: boolean;\n  /** If the command takes a parameter, describe it */\n  parameter?: {\n    name: string;\n    description: string;\n    required?: boolean;\n    type: 'text' | 'select' | 'reference';\n    options?: string[];\n  };\n  /** The actual tool name to call (if different from name) */\n  toolName?: string;\n  /** For navigation commands, the destination */\n  destination?: string;\n  /** For context commands, the context type to insert */\n  contextType?: string;\n}\n\n// ============================================================================\n// Navigation Commands\n// ============================================================================\n\nexport const NAVIGATION_COMMANDS: SlashCommand[] = [\n  {\n    name: 'home',\n    aliases: ['start', 'main'],\n    label: 'Home',\n    description: 'Go to the home screen',\n    category: 'navigation',\n    icon: Compass,\n    color: '#f59e0b',\n    destination: '/',\n  },\n  {\n    name: 'chat',\n    label: 'Chat',\n    description: 'Open full chat interface',\n    category: 'navigation',\n    icon: MessageSquare,\n    color: '#3b82f6',\n    destination: '/chat',\n  },\n  {\n    name: 'canvas',\n    aliases: ['design-canvas'],\n    label: 'Design Canvas',\n    description: 'Open the infinite design canvas',\n    category: 'navigation',\n    icon: LayoutGrid,\n    color: '#10b981',\n    destination: '/canvas',\n  },\n  {\n    name: 'projects',\n    aliases: ['kanban', 'tasks'],\n    label: 'Projects',\n    description: 'View projects and kanban board',\n    category: 'navigation',\n    icon: Layers,\n    color: '#8b5cf6',\n    destination: '/projects',\n  },\n  {\n    name: 'design',\n    aliases: ['themes'],\n    label: 'Design Themes',\n    description: 'Explore 50+ design themes',\n    category: 'navigation',\n    icon: Palette,\n    color: '#ec4899',\n    destination: '/design',\n  },\n  {\n    name: 'resume',\n    aliases: ['cv', 'about'],\n    label: 'Resume',\n    description: 'View James\\'s resume',\n    category: 'navigation',\n    icon: FileText,\n    color: '#6366f1',\n    destination: '/resume',\n  },\n  {\n    name: 'music',\n    aliases: ['jamz', 'tracks'],\n    label: 'Music',\n    description: 'Listen to music and tracks',\n    category: 'navigation',\n    icon: Music,\n    color: '#ef4444',\n    destination: '/music',\n  },\n  {\n    name: 'video',\n    aliases: ['studio'],\n    label: 'Video Studio',\n    description: 'Create and edit videos',\n    category: 'navigation',\n    icon: Video,\n    color: '#f97316',\n    destination: '/video',\n  },\n  {\n    name: 'agent',\n    aliases: ['infinity', 'coding'],\n    label: 'Agent',\n    description: 'Open the coding agent',\n    category: 'navigation',\n    icon: Bot,\n    color: '#14b8a6',\n    destination: '/agent',\n    ownerOnly: true,\n  },\n  {\n    name: 'memory',\n    aliases: ['memories'],\n    label: 'Memory Control',\n    description: 'View and manage AI memories',\n    category: 'navigation',\n    icon: Brain,\n    color: '#a855f7',\n    destination: '/memory',\n    ownerOnly: true,\n  },\n  {\n    name: 'settings',\n    label: 'Settings',\n    description: 'Open settings',\n    category: 'navigation',\n    icon: Settings,\n    color: '#6b7280',\n    destination: '/settings',\n    ownerOnly: true,\n  },\n];\n\n// ============================================================================\n// Tool Commands (mapped from CLAW_AI_TOOLS)\n// ============================================================================\n\nexport const TOOL_COMMANDS: SlashCommand[] = [\n  // Search & Discovery\n  {\n    name: 'search',\n    aliases: ['find', 'lookup'],\n    label: 'Search Portfolio',\n    description: 'Search projects, skills, and experience',\n    category: 'tools',\n    icon: Search,\n    color: '#3b82f6',\n    toolName: 'search_portfolio',\n    parameter: {\n      name: 'query',\n      description: 'What to search for',\n      required: true,\n      type: 'text',\n    },\n  },\n  {\n    name: 'weather',\n    label: 'Weather',\n    description: 'Show weather widget',\n    category: 'tools',\n    icon: Globe,\n    color: '#0ea5e9',\n    toolName: 'show_weather',\n    parameter: {\n      name: 'location',\n      description: 'Location (default: San Francisco)',\n      type: 'text',\n    },\n  },\n  {\n    name: 'photos',\n    aliases: ['gallery', 'images'],\n    label: 'Photos',\n    description: 'Show photo gallery',\n    category: 'tools',\n    icon: Image,\n    color: '#f472b6',\n    toolName: 'show_photos',\n  },\n\n  // Scheduling\n  {\n    name: 'schedule',\n    aliases: ['book', 'meeting'],\n    label: 'Schedule Call',\n    description: 'Schedule a call with James',\n    category: 'tools',\n    icon: Calendar,\n    color: '#22c55e',\n    toolName: 'schedule_call',\n    parameter: {\n      name: 'topic',\n      description: 'Topic for the call',\n      type: 'text',\n    },\n  },\n  {\n    name: 'availability',\n    aliases: ['times', 'free'],\n    label: 'Check Availability',\n    description: 'See available meeting times',\n    category: 'tools',\n    icon: Clock,\n    color: '#22c55e',\n    toolName: 'get_available_times',\n    parameter: {\n      name: 'date',\n      description: 'Date to check (YYYY-MM-DD)',\n      type: 'text',\n    },\n  },\n\n  // Memory\n  {\n    name: 'remember',\n    aliases: ['recall'],\n    label: 'Remember',\n    description: 'Search AI memories',\n    category: 'memory',\n    icon: Brain,\n    color: '#a855f7',\n    toolName: 'remember',\n    parameter: {\n      name: 'query',\n      description: 'What to remember',\n      required: true,\n      type: 'text',\n    },\n  },\n  {\n    name: 'memorize',\n    aliases: ['store'],\n    label: 'Memorize',\n    description: 'Store a new memory',\n    category: 'memory',\n    icon: Brain,\n    color: '#a855f7',\n    toolName: 'memorize',\n    ownerOnly: true,\n    parameter: {\n      name: 'content',\n      description: 'Memory content',\n      required: true,\n      type: 'text',\n    },\n  },\n  {\n    name: 'learn',\n    label: 'Learn',\n    description: 'Teach AI a new fact',\n    category: 'memory',\n    icon: BookOpen,\n    color: '#a855f7',\n    toolName: 'learn',\n    ownerOnly: true,\n    parameter: {\n      name: 'knowledge',\n      description: 'What to learn',\n      required: true,\n      type: 'text',\n    },\n  },\n\n  // Product Lifecycle\n  {\n    name: 'project',\n    aliases: ['new-project'],\n    label: 'Create Project',\n    description: 'Create a new product project',\n    category: 'product',\n    icon: Layers,\n    color: '#8b5cf6',\n    toolName: 'create_project',\n    ownerOnly: true,\n    parameter: {\n      name: 'name',\n      description: 'Project name',\n      required: true,\n      type: 'text',\n    },\n  },\n  {\n    name: 'prd',\n    aliases: ['spec', 'requirements'],\n    label: 'Create PRD',\n    description: 'Create Product Requirements Document',\n    category: 'product',\n    icon: FileText,\n    color: '#ec4899',\n    toolName: 'create_prd',\n    ownerOnly: true,\n    parameter: {\n      name: 'title',\n      description: 'PRD title',\n      required: true,\n      type: 'text',\n    },\n  },\n  {\n    name: 'ticket',\n    aliases: ['story', 'task'],\n    label: 'Create Ticket',\n    description: 'Create BMAD user story ticket',\n    category: 'product',\n    icon: Target,\n    color: '#f59e0b',\n    toolName: 'create_ticket',\n    ownerOnly: true,\n    parameter: {\n      name: 'title',\n      description: 'Ticket title',\n      required: true,\n      type: 'text',\n    },\n  },\n  {\n    name: 'kanban',\n    aliases: ['board'],\n    label: 'Show Kanban',\n    description: 'Display kanban board',\n    category: 'product',\n    icon: LayoutGrid,\n    color: '#3b82f6',\n    toolName: 'show_kanban_tasks',\n    parameter: {\n      name: 'filter',\n      description: 'Status filter',\n      type: 'select',\n      options: ['all', 'todo', 'in-progress', 'done', 'backlog'],\n    },\n  },\n\n  // Code & Execution\n  {\n    name: 'clone',\n    aliases: ['repo'],\n    label: 'Clone Repository',\n    description: 'Clone a git repository',\n    category: 'code',\n    icon: GitBranch,\n    color: '#6366f1',\n    toolName: 'clone_repository',\n    ownerOnly: true,\n    parameter: {\n      name: 'url',\n      description: 'Repository URL',\n      required: true,\n      type: 'text',\n    },\n  },\n  {\n    name: 'run',\n    aliases: ['exec', 'cmd'],\n    label: 'Run Command',\n    description: 'Execute a shell command',\n    category: 'code',\n    icon: Terminal,\n    color: '#22c55e',\n    toolName: 'run_command',\n    ownerOnly: true,\n    parameter: {\n      name: 'command',\n      description: 'Command to run',\n      required: true,\n      type: 'text',\n    },\n  },\n  {\n    name: 'read',\n    aliases: ['cat', 'view'],\n    label: 'Read File',\n    description: 'Read a file\\'s contents',\n    category: 'code',\n    icon: FileText,\n    color: '#6366f1',\n    toolName: 'read_file',\n    ownerOnly: true,\n    parameter: {\n      name: 'path',\n      description: 'File path',\n      required: true,\n      type: 'text',\n    },\n  },\n  {\n    name: 'write',\n    aliases: ['save'],\n    label: 'Write File',\n    description: 'Write content to a file',\n    category: 'code',\n    icon: PenTool,\n    color: '#6366f1',\n    toolName: 'write_file',\n    ownerOnly: true,\n    parameter: {\n      name: 'path',\n      description: 'File path',\n      required: true,\n      type: 'text',\n    },\n  },\n  {\n    name: 'search-code',\n    aliases: ['grep'],\n    label: 'Search Codebase',\n    description: 'Search code with regex',\n    category: 'code',\n    icon: Code,\n    color: '#6366f1',\n    toolName: 'search_codebase',\n    ownerOnly: true,\n    parameter: {\n      name: 'pattern',\n      description: 'Search pattern',\n      required: true,\n      type: 'text',\n    },\n  },\n\n  // Media Generation\n  {\n    name: 'generate',\n    aliases: ['create', 'ai'],\n    label: 'Generate',\n    description: 'AI generation on canvas',\n    category: 'media',\n    icon: Sparkles,\n    color: '#f59e0b',\n    toolName: 'generate_on_canvas',\n    parameter: {\n      name: 'prompt',\n      description: 'Generation prompt',\n      required: true,\n      type: 'text',\n    },\n  },\n  {\n    name: 'video-create',\n    aliases: ['render'],\n    label: 'Create Video',\n    description: 'Create a video composition',\n    category: 'media',\n    icon: Video,\n    color: '#f97316',\n    toolName: 'create_video_composition',\n    ownerOnly: true,\n    parameter: {\n      name: 'name',\n      description: 'Video name',\n      required: true,\n      type: 'text',\n    },\n  },\n  {\n    name: 'tts',\n    aliases: ['speak', 'voice'],\n    label: 'Text to Speech',\n    description: 'Generate speech from text',\n    category: 'media',\n    icon: Mic,\n    color: '#22c55e',\n    toolName: 'generate_voice',\n    parameter: {\n      name: 'text',\n      description: 'Text to speak',\n      required: true,\n      type: 'text',\n    },\n  },\n\n  // Channels & Messaging\n  {\n    name: 'message',\n    aliases: ['send'],\n    label: 'Send Message',\n    description: 'Send a channel message',\n    category: 'tools',\n    icon: MessageSquare,\n    color: '#3b82f6',\n    toolName: 'send_channel_message',\n    ownerOnly: true,\n    parameter: {\n      name: 'content',\n      description: 'Message content',\n      required: true,\n      type: 'text',\n    },\n  },\n\n  // Utility\n  {\n    name: 'ui',\n    aliases: ['render'],\n    label: 'Render UI',\n    description: 'Render custom UI components',\n    category: 'tools',\n    icon: Boxes,\n    color: '#8b5cf6',\n    toolName: 'render_ui',\n  },\n  {\n    name: 'cron',\n    aliases: ['schedule-job'],\n    label: 'Create Cron Job',\n    description: 'Create a scheduled job',\n    category: 'tools',\n    icon: Clock,\n    color: '#f59e0b',\n    toolName: 'create_cron_job',\n    ownerOnly: true,\n    parameter: {\n      name: 'expression',\n      description: 'Cron expression',\n      required: true,\n      type: 'text',\n    },\n  },\n];\n\n// ============================================================================\n// Skill Commands (from .claude/skills/)\n// ============================================================================\n\nexport const SKILL_COMMANDS: SlashCommand[] = [\n  // Design Skills\n  {\n    name: 'skill-design',\n    aliases: ['design-excellence'],\n    label: 'Design Excellence',\n    description: 'High-impact interface design principles',\n    category: 'skills',\n    icon: Palette,\n    color: '#ec4899',\n    contextType: 'skill:design-excellence',\n  },\n  {\n    name: 'skill-ui',\n    aliases: ['ui-constraints'],\n    label: 'UI Constraints',\n    description: 'Opinionated UI guidelines (Tailwind, no gradients)',\n    category: 'skills',\n    icon: PenTool,\n    color: '#ec4899',\n    contextType: 'skill:ui',\n  },\n  {\n    name: 'skill-interface',\n    aliases: ['interface-craft'],\n    label: 'Interface Craft',\n    description: 'Intentional design: clarity, structure, beauty',\n    category: 'skills',\n    icon: Wand2,\n    color: '#ec4899',\n    contextType: 'skill:interface-craft',\n  },\n  {\n    name: 'skill-motion',\n    aliases: ['animation'],\n    label: 'Motion Design',\n    description: 'Animation principles: 100-500ms timing, easing',\n    category: 'skills',\n    icon: Play,\n    color: '#f97316',\n    contextType: 'skill:motion-design',\n  },\n  {\n    name: 'skill-ios',\n    aliases: ['ios-hig'],\n    label: 'iOS Excellence',\n    description: 'iOS HIG patterns: SF Pro, 8pt grid, haptics',\n    category: 'skills',\n    icon: Smartphone,\n    color: '#3b82f6',\n    contextType: 'skill:ios-excellence',\n  },\n  {\n    name: 'skill-a11y',\n    aliases: ['accessibility'],\n    label: 'Accessibility Review',\n    description: 'A11y QA: keyboard, screen reader, contrast',\n    category: 'skills',\n    icon: Accessibility,\n    color: '#22c55e',\n    contextType: 'skill:accessibility-review',\n  },\n\n  // Development Skills\n  {\n    name: 'skill-react',\n    aliases: ['vercel-best-practices'],\n    label: 'React Best Practices',\n    description: '45+ performance rules across 8 priority tiers',\n    category: 'skills',\n    icon: Code,\n    color: '#3b82f6',\n    contextType: 'skill:vercel-react-best-practices',\n  },\n  {\n    name: 'skill-threejs',\n    aliases: ['3d'],\n    label: 'Three.js Excellence',\n    description: '3D excellence: 7 gallery types, shaders',\n    category: 'skills',\n    icon: Move3D,\n    color: '#8b5cf6',\n    contextType: 'skill:threejs',\n  },\n  {\n    name: 'skill-browser',\n    aliases: ['automation'],\n    label: 'Browser Automation',\n    description: 'Navigation, clicks, forms, screenshots',\n    category: 'skills',\n    icon: Globe,\n    color: '#6366f1',\n    contextType: 'skill:agent-browser',\n  },\n  {\n    name: 'skill-clone',\n    aliases: ['extract'],\n    label: 'Clone React',\n    description: 'Visual component extraction from websites',\n    category: 'skills',\n    icon: Eye,\n    color: '#6366f1',\n    contextType: 'skill:clone-react',\n  },\n\n  // Security & Research\n  {\n    name: 'skill-security',\n    aliases: ['0din', 'red-team'],\n    label: 'Security Research',\n    description: 'AI safety & red teaming with JEF scoring',\n    category: 'skills',\n    icon: Shield,\n    color: '#ef4444',\n    contextType: 'skill:0din-security-research',\n    ownerOnly: true,\n  },\n  {\n    name: 'skill-science',\n    aliases: ['scientific'],\n    label: 'Scientific Skills',\n    description: 'K-Dense: 139 scientific skills',\n    category: 'skills',\n    icon: FlaskConical,\n    color: '#14b8a6',\n    contextType: 'skill:scientific-skills',\n  },\n\n  // Project Management\n  {\n    name: 'skill-pm',\n    aliases: ['project-management'],\n    label: 'Project Management',\n    description: 'GitHub workflow & Kanban methodology',\n    category: 'skills',\n    icon: Target,\n    color: '#f59e0b',\n    contextType: 'skill:project-management',\n  },\n  {\n    name: 'skill-web-design',\n    aliases: ['web-guidelines'],\n    label: 'Web Design Guidelines',\n    description: 'Web design standards and patterns',\n    category: 'skills',\n    icon: Globe,\n    color: '#ec4899',\n    contextType: 'skill:web-design-guidelines',\n  },\n  {\n    name: 'skill-remotion',\n    aliases: ['video-export'],\n    label: 'Remotion Video',\n    description: 'Video export integration',\n    category: 'skills',\n    icon: Video,\n    color: '#f97316',\n    contextType: 'skill:remotion-video-exports',\n  },\n  {\n    name: 'skill-actionbook',\n    aliases: ['web-automation'],\n    label: 'Actionbook Automation',\n    description: 'Web automation patterns',\n    category: 'skills',\n    icon: Zap,\n    color: '#a855f7',\n    contextType: 'skill:actionbook-web-automation',\n  },\n];\n\n// ============================================================================\n// Dimension Commands (ERV Arrangements)\n// ============================================================================\n\nexport const DIMENSION_COMMANDS: SlashCommand[] = [\n  {\n    name: 'dim-kanban',\n    label: 'Kanban View',\n    description: 'View data as kanban board with status columns',\n    category: 'dimensions',\n    icon: LayoutGrid,\n    color: '#3b82f6',\n    toolName: 'navigate_dimension',\n    contextType: 'dimension:kanban',\n  },\n  {\n    name: 'dim-timeline',\n    label: 'Timeline View',\n    description: 'View data chronologically on a timeline',\n    category: 'dimensions',\n    icon: Clock,\n    color: '#22c55e',\n    toolName: 'navigate_dimension',\n    contextType: 'dimension:timeline',\n  },\n  {\n    name: 'dim-graph',\n    label: 'Graph View',\n    description: 'View data as connected nodes',\n    category: 'dimensions',\n    icon: Cpu,\n    color: '#8b5cf6',\n    toolName: 'navigate_dimension',\n    contextType: 'dimension:graph',\n  },\n  {\n    name: 'dim-table',\n    label: 'Table View',\n    description: 'View data in a sortable table',\n    category: 'dimensions',\n    icon: Table,\n    color: '#6b7280',\n    toolName: 'navigate_dimension',\n    contextType: 'dimension:table',\n  },\n  {\n    name: 'dim-feed',\n    label: 'Feed View',\n    description: 'View data as a scrollable feed',\n    category: 'dimensions',\n    icon: List,\n    color: '#f59e0b',\n    toolName: 'navigate_dimension',\n    contextType: 'dimension:feed',\n  },\n  {\n    name: 'dim-calendar',\n    label: 'Calendar View',\n    description: 'View data on a calendar',\n    category: 'dimensions',\n    icon: Calendar,\n    color: '#ef4444',\n    toolName: 'navigate_dimension',\n    contextType: 'dimension:calendar',\n  },\n  {\n    name: 'dim-cards',\n    label: 'Cards View',\n    description: 'View data as visual cards',\n    category: 'dimensions',\n    icon: Boxes,\n    color: '#ec4899',\n    toolName: 'navigate_dimension',\n    contextType: 'dimension:cards',\n  },\n];\n\n// ============================================================================\n// Quick Action Commands\n// ============================================================================\n\nexport const QUICK_COMMANDS: SlashCommand[] = [\n  {\n    name: 'help',\n    aliases: ['?', 'commands'],\n    label: 'Help',\n    description: 'Show all available commands',\n    category: 'quick',\n    icon: HelpCircle,\n    color: '#6b7280',\n  },\n  {\n    name: 'clear',\n    aliases: ['reset'],\n    label: 'Clear Chat',\n    description: 'Clear the current conversation',\n    category: 'quick',\n    icon: Trash2,\n    color: '#ef4444',\n  },\n  {\n    name: 'voice',\n    aliases: ['tts-toggle'],\n    label: 'Toggle Voice',\n    description: 'Toggle voice responses on/off',\n    category: 'quick',\n    icon: Mic,\n    color: '#22c55e',\n  },\n  {\n    name: 'new',\n    aliases: ['new-chat'],\n    label: 'New Thread',\n    description: 'Start a new conversation',\n    category: 'quick',\n    icon: MessageSquare,\n    color: '#3b82f6',\n  },\n];\n\n// Import Trash2 for clear command\nimport { Trash2 } from 'lucide-react';\n\n// ============================================================================\n// Combined Registry\n// ============================================================================\n\nexport const ALL_SLASH_COMMANDS: SlashCommand[] = [\n  ...QUICK_COMMANDS,\n  ...NAVIGATION_COMMANDS,\n  ...TOOL_COMMANDS,\n  ...SKILL_COMMANDS,\n  ...DIMENSION_COMMANDS,\n];\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\n/**\n * Search commands by query string\n */\nexport function searchCommands(\n  query: string,\n  options?: {\n    categories?: CommandCategory[];\n    includeOwnerOnly?: boolean;\n  }\n): SlashCommand[] {\n  const normalizedQuery = query.toLowerCase().replace(/^\\//, '');\n\n  let commands = ALL_SLASH_COMMANDS;\n\n  // Filter by owner-only\n  if (!options?.includeOwnerOnly) {\n    commands = commands.filter((cmd) => !cmd.ownerOnly);\n  }\n\n  // Filter by categories\n  if (options?.categories?.length) {\n    commands = commands.filter((cmd) => options.categories!.includes(cmd.category));\n  }\n\n  // No query? Return all matching commands\n  if (!normalizedQuery) {\n    return commands.slice(0, 20);\n  }\n\n  // Search by name, aliases, and label\n  return commands.filter((cmd) => {\n    const matchesName = cmd.name.toLowerCase().includes(normalizedQuery);\n    const matchesAlias = cmd.aliases?.some((a) => a.toLowerCase().includes(normalizedQuery));\n    const matchesLabel = cmd.label.toLowerCase().includes(normalizedQuery);\n    const matchesDescription = cmd.description.toLowerCase().includes(normalizedQuery);\n    return matchesName || matchesAlias || matchesLabel || matchesDescription;\n  });\n}\n\n/**\n * Get a command by exact name or alias\n */\nexport function getCommand(name: string): SlashCommand | undefined {\n  const normalizedName = name.toLowerCase().replace(/^\\//, '');\n  return ALL_SLASH_COMMANDS.find(\n    (cmd) =>\n      cmd.name === normalizedName || cmd.aliases?.includes(normalizedName)\n  );\n}\n\n/**\n * Get commands grouped by category\n */\nexport function getCommandsByCategory(\n  includeOwnerOnly = false\n): Record<CommandCategory, SlashCommand[]> {\n  const commands = includeOwnerOnly\n    ? ALL_SLASH_COMMANDS\n    : ALL_SLASH_COMMANDS.filter((cmd) => !cmd.ownerOnly);\n\n  return commands.reduce(\n    (acc, cmd) => {\n      if (!acc[cmd.category]) {\n        acc[cmd.category] = [];\n      }\n      acc[cmd.category].push(cmd);\n      return acc;\n    },\n    {} as Record<CommandCategory, SlashCommand[]>\n  );\n}\n\n/**\n * Category labels for display\n */\nexport const CATEGORY_LABELS: Record<CommandCategory, string> = {\n  quick: 'Quick Actions',\n  navigation: 'Navigation',\n  tools: 'Tools',\n  skills: 'Skills',\n  dimensions: 'Dimensions',\n  context: 'Context',\n  media: 'Media',\n  code: 'Code & Execution',\n  memory: 'Memory',\n  product: 'Product Lifecycle',\n};\n\n/**\n * Category colors for display\n */\nexport const CATEGORY_COLORS: Record<CommandCategory, string> = {\n  quick: '#6b7280',\n  navigation: '#f59e0b',\n  tools: '#3b82f6',\n  skills: '#8b5cf6',\n  dimensions: '#10b981',\n  context: '#ec4899',\n  media: '#f97316',\n  code: '#6366f1',\n  memory: '#a855f7',\n  product: '#22c55e',\n};\n\n/**\n * Format a command for display in the picker\n */\nexport function formatCommandPreview(cmd: SlashCommand): string {\n  let preview = `/${cmd.name}`;\n  if (cmd.parameter) {\n    preview += cmd.parameter.required\n      ? ` <${cmd.parameter.name}>`\n      : ` [${cmd.parameter.name}]`;\n  }\n  return preview;\n}\n\n/**\n * Parse a command string into command + arguments\n */\nexport function parseCommandString(input: string): {\n  command: SlashCommand | undefined;\n  args: string;\n} {\n  const match = input.match(/^\\/(\\S+)(?:\\s+(.*))?$/);\n  if (!match) {\n    return { command: undefined, args: '' };\n  }\n\n  const [, cmdName, args = ''] = match;\n  const command = getCommand(cmdName);\n\n  return { command, args: args.trim() };\n}\n\nexport default ALL_SLASH_COMMANDS;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1066, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/design-canvas/ContextReferencePicker.tsx"],"sourcesContent":["'use client';\n\n/**\n * ContextReferencePicker - Allows users to pull in context from their data layer\n *\n * Triggered by @ in text input, shows searchable list of:\n * - Tickets (@ticket:)\n * - PRDs (@prd:)\n * - Projects (@project:)\n * - Tasks (@task:)\n * - Canvas (@canvas:)\n * - Memories (@memory:)\n * - Tracks/Lyrics (@track:)\n */\n\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useQuery } from '@/lib/openclaw/hooks';\nimport { api } from '@/lib/convex-shim';\nimport {\n  Search,\n  FileText,\n  Layers,\n  CheckSquare,\n  Music,\n  Brain,\n  LayoutGrid,\n  Target,\n  Ticket,\n  Hash,\n  Sparkles,\n  Eye,\n  Wrench,\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport type { ReferenceType, ContextReference } from '@/lib/canvas/artifacts';\nimport {\n  SKILL_COMMANDS,\n  DIMENSION_COMMANDS,\n  TOOL_COMMANDS,\n} from '@/lib/claw-ai/slash-command-registry';\n\n// ============================================================================\n// Types\n// ============================================================================\n\ninterface ReferenceCategory {\n  type: ReferenceType;\n  label: string;\n  icon: React.ReactNode;\n  color: string;\n}\n\ninterface ContextReferencePickerProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSelect: (reference: ContextReference) => void;\n  searchQuery?: string;\n  position?: { x: number; y: number };\n  filterType?: ReferenceType;\n}\n\n// ============================================================================\n// Reference Categories\n// ============================================================================\n\nconst REFERENCE_CATEGORIES: ReferenceCategory[] = [\n  { type: 'ticket', label: 'Tickets', icon: <Ticket className=\"w-4 h-4\" />, color: '#f59e0b' },\n  { type: 'prd', label: 'PRDs', icon: <FileText className=\"w-4 h-4\" />, color: '#ec4899' },\n  { type: 'project', label: 'Projects', icon: <Layers className=\"w-4 h-4\" />, color: '#8b5cf6' },\n  { type: 'task', label: 'Tasks', icon: <CheckSquare className=\"w-4 h-4\" />, color: '#3b82f6' },\n  { type: 'canvas', label: 'Canvas', icon: <LayoutGrid className=\"w-4 h-4\" />, color: '#10b981' },\n  { type: 'memory', label: 'Memories', icon: <Brain className=\"w-4 h-4\" />, color: '#6366f1' },\n  { type: 'track', label: 'Tracks', icon: <Music className=\"w-4 h-4\" />, color: '#ef4444' },\n  { type: 'skill', label: 'Skills', icon: <Sparkles className=\"w-4 h-4\" />, color: '#a855f7' },\n  { type: 'dimension', label: 'Dimensions', icon: <Eye className=\"w-4 h-4\" />, color: '#14b8a6' },\n  { type: 'tool', label: 'Tools', icon: <Wrench className=\"w-4 h-4\" />, color: '#0ea5e9' },\n];\n\n// ============================================================================\n// Component\n// ============================================================================\n\nexport function ContextReferencePicker({\n  isOpen,\n  onClose,\n  onSelect,\n  searchQuery: initialQuery = '',\n  position,\n  filterType,\n}: ContextReferencePickerProps) {\n  const [searchQuery, setSearchQuery] = useState(initialQuery);\n  const [selectedCategory, setSelectedCategory] = useState<ReferenceType | null>(filterType || null);\n  const [selectedIndex, setSelectedIndex] = useState(0);\n\n  // Query data from Convex\n  // Note: Using type assertion for designCanvas.listCanvases (types regenerate on convex dev)\n  const tickets = useQuery(api.agentic.listTickets, { limit: 50 });\n  const prds = useQuery(api.agentic.listPRDs, { limit: 20 });\n  const projects = useQuery(api.agentic.listProjects, {});\n  const tasks = useQuery(api.kanban.getTasks, {});\n  const canvases = useQuery((api as any).designCanvas?.listCanvases, { limit: 20 });\n\n  // SECURITY FIX: Pass userId to searchMemories to prevent cross-user data exposure\n  // TODO: Get actual userId from auth context - for now skip memory search\n  const memories = useQuery(api.memories.searchMemories, 'skip');\n\n  const tracks = useQuery(api.jamz.listTracks, { limit: 20 });\n\n  // Build searchable items\n  const allItems = useMemo(() => {\n    const items: ContextReference[] = [];\n\n    // Add tickets\n    if (tickets) {\n      tickets.forEach((t: any) => {\n        items.push({\n          type: 'ticket',\n          id: t._id,\n          displayName: t.ticketId || t.title || 'Untitled Ticket',\n          preview: t.iWant ? `As a ${t.asA}, I want ${t.iWant}` : t.description,\n          data: t,\n        });\n      });\n    }\n\n    // Add PRDs\n    if (prds) {\n      prds.forEach((p: any) => {\n        items.push({\n          type: 'prd',\n          id: p._id,\n          displayName: p.title || 'Untitled PRD',\n          preview: p.executiveSummary || p.problemStatement,\n          data: p,\n        });\n      });\n    }\n\n    // Add projects\n    if (projects) {\n      projects.forEach((p: any) => {\n        items.push({\n          type: 'project',\n          id: p._id,\n          displayName: p.name || 'Untitled Project',\n          preview: p.description,\n          data: p,\n        });\n      });\n    }\n\n    // Add tasks\n    if (tasks) {\n      tasks.forEach((t: any) => {\n        items.push({\n          type: 'task',\n          id: t._id,\n          displayName: t.title || 'Untitled Task',\n          preview: t.description,\n          data: t,\n        });\n      });\n    }\n\n    // Add canvases\n    if (canvases) {\n      canvases.forEach((c: any) => {\n        items.push({\n          type: 'canvas',\n          id: c._id,\n          displayName: c.name || 'Untitled Canvas',\n          preview: c.description || `${c.canvasType} canvas`,\n          data: c,\n        });\n      });\n    }\n\n    // Add memories\n    if (memories) {\n      memories.forEach((m: any) => {\n        items.push({\n          type: 'memory',\n          id: m._id,\n          displayName: m.content?.slice(0, 50) || 'Memory',\n          preview: m.content,\n          data: m,\n        });\n      });\n    }\n\n    // Add tracks\n    if (tracks) {\n      tracks.forEach((t: any) => {\n        items.push({\n          type: 'track',\n          id: t._id,\n          displayName: t.title || 'Untitled Track',\n          preview: t.lyrics?.slice(0, 100) || t.description,\n          data: t,\n        });\n      });\n    }\n\n    // Add skills from slash command registry\n    SKILL_COMMANDS.forEach((skill) => {\n      items.push({\n        type: 'skill',\n        id: skill.name,\n        displayName: skill.label,\n        preview: skill.description,\n        data: { contextType: skill.contextType, color: skill.color },\n      });\n    });\n\n    // Add dimensions from slash command registry\n    DIMENSION_COMMANDS.forEach((dim) => {\n      items.push({\n        type: 'dimension',\n        id: dim.name,\n        displayName: dim.label,\n        preview: dim.description,\n        data: { contextType: dim.contextType, color: dim.color },\n      });\n    });\n\n    // Add tools from slash command registry\n    TOOL_COMMANDS.forEach((tool) => {\n      items.push({\n        type: 'tool',\n        id: tool.name,\n        displayName: tool.label,\n        preview: tool.description,\n        data: { toolName: tool.toolName || tool.name, color: tool.color },\n      });\n    });\n\n    return items;\n  }, [tickets, prds, projects, tasks, canvases, memories, tracks]);\n\n  // Filter items by search and category\n  const filteredItems = useMemo(() => {\n    let items = allItems;\n\n    // Filter by category\n    if (selectedCategory) {\n      items = items.filter(item => item.type === selectedCategory);\n    }\n\n    // Filter by search query\n    if (searchQuery) {\n      const query = searchQuery.toLowerCase();\n      items = items.filter(item =>\n        item.displayName.toLowerCase().includes(query) ||\n        (item.preview && item.preview.toLowerCase().includes(query))\n      );\n    }\n\n    return items.slice(0, 20); // Limit results\n  }, [allItems, selectedCategory, searchQuery]);\n\n  // Reset selected index when filtered items change\n  useEffect(() => {\n    setSelectedIndex(0);\n  }, [filteredItems.length]);\n\n  // Keyboard navigation\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\n    switch (e.key) {\n      case 'ArrowDown':\n        e.preventDefault();\n        setSelectedIndex(prev => Math.min(prev + 1, filteredItems.length - 1));\n        break;\n      case 'ArrowUp':\n        e.preventDefault();\n        setSelectedIndex(prev => Math.max(prev - 1, 0));\n        break;\n      case 'Enter':\n        e.preventDefault();\n        if (filteredItems[selectedIndex]) {\n          onSelect(filteredItems[selectedIndex]);\n          onClose();\n        }\n        break;\n      case 'Escape':\n        e.preventDefault();\n        onClose();\n        break;\n      case 'Tab':\n        e.preventDefault();\n        // Cycle through categories\n        const currentIdx = selectedCategory\n          ? REFERENCE_CATEGORIES.findIndex(c => c.type === selectedCategory)\n          : -1;\n        const nextIdx = (currentIdx + 1) % (REFERENCE_CATEGORIES.length + 1);\n        setSelectedCategory(nextIdx === REFERENCE_CATEGORIES.length ? null : REFERENCE_CATEGORIES[nextIdx].type);\n        break;\n    }\n  }, [filteredItems, selectedIndex, selectedCategory, onSelect, onClose]);\n\n  // Get icon for reference type\n  const getIcon = (type: ReferenceType) => {\n    const category = REFERENCE_CATEGORIES.find(c => c.type === type);\n    return category?.icon || <Hash className=\"w-4 h-4\" />;\n  };\n\n  // Get color for reference type\n  const getColor = (type: ReferenceType) => {\n    const category = REFERENCE_CATEGORIES.find(c => c.type === type);\n    return category?.color || '#6b7280';\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: -10 }}\n      animate={{ opacity: 1, y: 0 }}\n      exit={{ opacity: 0, y: -10 }}\n      className=\"absolute z-50 w-96 max-h-[400px] bg-[#1a1a2e] border border-white/10 rounded-xl shadow-2xl overflow-hidden\"\n      style={position ? { left: position.x, top: position.y } : { left: 0, bottom: '100%', marginBottom: 8 }}\n      onKeyDown={handleKeyDown}\n    >\n      {/* Search Header */}\n      <div className=\"p-3 border-b border-white/10\">\n        <div className=\"flex items-center gap-2 px-3 py-2 bg-white/5 rounded-lg\">\n          <Search className=\"w-4 h-4 text-white/40\" />\n          <input\n            type=\"text\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            placeholder=\"Search your data...\"\n            className=\"flex-1 bg-transparent border-none outline-none text-white text-sm placeholder-white/40\"\n            autoFocus\n          />\n          {searchQuery && (\n            <button\n              onClick={() => setSearchQuery('')}\n              className=\"text-white/40 hover:text-white/60\"\n            >\n              Ã—\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Category Tabs */}\n      <div className=\"flex items-center gap-1 p-2 border-b border-white/10 overflow-x-auto\">\n        <button\n          onClick={() => setSelectedCategory(null)}\n          className={cn(\n            'px-3 py-1.5 rounded-lg text-xs font-medium transition-colors whitespace-nowrap',\n            !selectedCategory\n              ? 'bg-white/10 text-white'\n              : 'text-white/50 hover:text-white/70 hover:bg-white/5'\n          )}\n        >\n          All\n        </button>\n        {REFERENCE_CATEGORIES.map((category) => (\n          <button\n            key={category.type}\n            onClick={() => setSelectedCategory(category.type)}\n            className={cn(\n              'flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors whitespace-nowrap',\n              selectedCategory === category.type\n                ? 'bg-white/10 text-white'\n                : 'text-white/50 hover:text-white/70 hover:bg-white/5'\n            )}\n            style={selectedCategory === category.type ? { color: category.color } : {}}\n          >\n            {category.icon}\n            {category.label}\n          </button>\n        ))}\n      </div>\n\n      {/* Results List */}\n      <div className=\"max-h-[280px] overflow-y-auto\">\n        {filteredItems.length === 0 ? (\n          <div className=\"p-8 text-center\">\n            <Search className=\"w-8 h-8 mx-auto mb-2 text-white/20\" />\n            <p className=\"text-sm text-white/40\">No results found</p>\n            <p className=\"text-xs text-white/30 mt-1\">Try a different search or category</p>\n          </div>\n        ) : (\n          filteredItems.map((item, index) => (\n            <button\n              key={`${item.type}-${item.id}`}\n              onClick={() => {\n                onSelect(item);\n                onClose();\n              }}\n              className={cn(\n                'w-full flex items-start gap-3 p-3 text-left transition-colors',\n                index === selectedIndex\n                  ? 'bg-white/10'\n                  : 'hover:bg-white/5'\n              )}\n            >\n              {/* Icon */}\n              <div\n                className=\"w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0\"\n                style={{ backgroundColor: `${getColor(item.type)}20`, color: getColor(item.type) }}\n              >\n                {getIcon(item.type)}\n              </div>\n\n              {/* Content */}\n              <div className=\"flex-1 min-w-0\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-sm font-medium text-white truncate\">\n                    {item.displayName}\n                  </span>\n                  <span\n                    className=\"text-[10px] px-1.5 py-0.5 rounded-full font-medium\"\n                    style={{ backgroundColor: `${getColor(item.type)}20`, color: getColor(item.type) }}\n                  >\n                    {item.type}\n                  </span>\n                </div>\n                {item.preview && (\n                  <p className=\"text-xs text-white/50 mt-0.5 line-clamp-2\">\n                    {item.preview}\n                  </p>\n                )}\n              </div>\n            </button>\n          ))\n        )}\n      </div>\n\n      {/* Footer Hint */}\n      <div className=\"p-2 border-t border-white/10 bg-white/5\">\n        <p className=\"text-[10px] text-white/40 text-center\">\n          <kbd className=\"px-1 py-0.5 bg-white/10 rounded text-white/60\">â†‘â†“</kbd> navigate\n          {' '}<kbd className=\"px-1 py-0.5 bg-white/10 rounded text-white/60\">Tab</kbd> switch category\n          {' '}<kbd className=\"px-1 py-0.5 bg-white/10 rounded text-white/60\">Enter</kbd> select\n        </p>\n      </div>\n    </motion.div>\n  );\n}\n\nexport default ContextReferencePicker;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1797, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/ui/ContextReferenceInput.tsx"],"sourcesContent":["'use client';\n\n/**\n * ContextReferenceInput - Input wrapper with @mention context reference support\n *\n * Wrap any text input or textarea with this component to add @mention support\n * for referencing tickets, PRDs, projects, tasks, etc.\n */\n\nimport React, { useState, useRef, useCallback, forwardRef, useImperativeHandle } from 'react';\nimport { AnimatePresence } from 'framer-motion';\nimport { ContextReferencePicker } from '@/components/design-canvas/ContextReferencePicker';\nimport type { ContextReference, ReferenceType } from '@/lib/canvas/artifacts';\n\ninterface ContextReferenceInputProps {\n  value: string;\n  onChange: (value: string) => void;\n  onKeyDown?: (e: React.KeyboardEvent) => void;\n  onReferenceInserted?: (reference: ContextReference) => void;\n  placeholder?: string;\n  disabled?: boolean;\n  className?: string;\n  multiline?: boolean;\n  rows?: number;\n  autoFocus?: boolean;\n  style?: React.CSSProperties;\n  'aria-label'?: string;\n}\n\nexport interface ContextReferenceInputHandle {\n  focus: () => void;\n  blur: () => void;\n  getValue: () => string;\n}\n\nexport const ContextReferenceInput = forwardRef<ContextReferenceInputHandle, ContextReferenceInputProps>(\n  function ContextReferenceInput(\n    {\n      value,\n      onChange,\n      onKeyDown,\n      onReferenceInserted,\n      placeholder,\n      disabled,\n      className,\n      multiline = false,\n      rows = 1,\n      autoFocus,\n      style,\n      'aria-label': ariaLabel,\n    },\n    ref\n  ) {\n    const inputRef = useRef<HTMLInputElement | HTMLTextAreaElement>(null);\n    const [isPickerOpen, setIsPickerOpen] = useState(false);\n    const [pickerPosition, setPickerPosition] = useState<{ x: number; y: number } | undefined>();\n    const [searchQuery, setSearchQuery] = useState('');\n    const [filterType, setFilterType] = useState<ReferenceType | undefined>();\n    const triggerPositionRef = useRef<number>(0);\n    const cursorPositionRef = useRef<number>(0);\n\n    // Expose methods via ref\n    useImperativeHandle(ref, () => ({\n      focus: () => inputRef.current?.focus(),\n      blur: () => inputRef.current?.blur(),\n      getValue: () => value,\n    }));\n\n    // Handle input change - detect @ trigger\n    const handleChange = useCallback((e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n      const input = e.target;\n      const newValue = input.value;\n      const cursorPos = input.selectionStart || 0;\n\n      cursorPositionRef.current = cursorPos;\n      onChange(newValue);\n\n      // Check if we just typed @\n      const charBefore = newValue[cursorPos - 1];\n      const charTwoBefore = newValue[cursorPos - 2];\n\n      if (charBefore === '@' && (!charTwoBefore || /\\s/.test(charTwoBefore))) {\n        // Get position for picker\n        const rect = input.getBoundingClientRect();\n        const position = {\n          x: rect.left + 20,\n          y: rect.bottom + 4,\n        };\n\n        triggerPositionRef.current = cursorPos - 1;\n        setIsPickerOpen(true);\n        setPickerPosition(position);\n        setSearchQuery('');\n        setFilterType(undefined);\n      } else if (isPickerOpen) {\n        // Update search query with text after @\n        const textAfterTrigger = newValue.slice(triggerPositionRef.current + 1, cursorPos);\n\n        // Check for type prefix like @ticket: or @prd:\n        const colonIndex = textAfterTrigger.indexOf(':');\n        if (colonIndex > 0) {\n          const typePrefix = textAfterTrigger.slice(0, colonIndex) as ReferenceType;\n          const validTypes: ReferenceType[] = ['ticket', 'prd', 'project', 'task', 'note', 'canvas', 'memory', 'track', 'file', 'skill', 'dimension', 'tool'];\n          if (validTypes.includes(typePrefix)) {\n            setFilterType(typePrefix);\n            setSearchQuery(textAfterTrigger.slice(colonIndex + 1));\n          } else {\n            setFilterType(undefined);\n            setSearchQuery(textAfterTrigger);\n          }\n        } else {\n          setFilterType(undefined);\n          setSearchQuery(textAfterTrigger);\n        }\n\n        // Close picker if we've moved past the trigger context\n        if (cursorPos <= triggerPositionRef.current || textAfterTrigger.includes(' ')) {\n          setIsPickerOpen(false);\n        }\n      }\n    }, [onChange, isPickerOpen]);\n\n    // Handle reference selection\n    const handleSelect = useCallback((reference: ContextReference) => {\n      const triggerPos = triggerPositionRef.current;\n      const cursorPos = cursorPositionRef.current;\n\n      // Build the reference text\n      const refText = `@${reference.type}:${reference.displayName}`;\n\n      // Replace from trigger position to current cursor position\n      const before = value.slice(0, triggerPos);\n      const after = value.slice(cursorPos);\n      const newValue = `${before}${refText} ${after}`;\n\n      onChange(newValue);\n\n      // Set cursor position after the inserted reference\n      const newCursorPos = triggerPos + refText.length + 1;\n      setTimeout(() => {\n        const input = inputRef.current;\n        if (input) {\n          input.setSelectionRange(newCursorPos, newCursorPos);\n          input.focus();\n        }\n      }, 0);\n\n      // Callback\n      if (onReferenceInserted) {\n        onReferenceInserted(reference);\n      }\n\n      setIsPickerOpen(false);\n    }, [value, onChange, onReferenceInserted]);\n\n    // Handle keyboard\n    const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\n      if (isPickerOpen && e.key === 'Escape') {\n        e.preventDefault();\n        setIsPickerOpen(false);\n        return;\n      }\n\n      // Pass through to parent handler\n      if (onKeyDown) {\n        onKeyDown(e);\n      }\n    }, [isPickerOpen, onKeyDown]);\n\n    // Close picker handler\n    const handleClosePicker = useCallback(() => {\n      setIsPickerOpen(false);\n    }, []);\n\n    const commonProps = {\n      ref: inputRef as any,\n      value,\n      onChange: handleChange,\n      onKeyDown: handleKeyDown,\n      placeholder,\n      disabled,\n      className,\n      autoFocus,\n      style,\n      'aria-label': ariaLabel,\n    };\n\n    return (\n      <div className=\"relative\">\n        {multiline ? (\n          <textarea {...commonProps} rows={rows} />\n        ) : (\n          <input type=\"text\" {...commonProps} />\n        )}\n\n        <AnimatePresence>\n          {isPickerOpen && (\n            <div\n              data-context-picker\n              className=\"fixed z-[100]\"\n              style={{\n                left: pickerPosition?.x || 0,\n                top: pickerPosition?.y || 0,\n              }}\n            >\n              <ContextReferencePicker\n                isOpen={isPickerOpen}\n                onClose={handleClosePicker}\n                onSelect={handleSelect}\n                searchQuery={searchQuery}\n                filterType={filterType}\n              />\n            </div>\n          )}\n        </AnimatePresence>\n      </div>\n    );\n  }\n);\n\nexport default ContextReferenceInput;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2041, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamesspalding/OpenClaw-OS/src/components/agentic/AgenticProductStudio.tsx"],"sourcesContent":["'use client';\n\n/**\n * AgenticProductStudio - Truly agentic voice-driven PRD creation\n *\n * This replaces manual form filling with a conversational interface:\n * - User speaks/types naturally about their product idea\n * - Claw AI extracts PRD fields in real-time\n * - Live canvas panel shows visual diagrams as conversation progresses\n * - PRDs can be visually sharded to tickets on canvas\n *\n * Inspired by BMAD-METHOD and the Flowy JSON-based diagram approach.\n */\n\nimport React, { useState, useCallback, useRef, useEffect, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Mic,\n  MicOff,\n  Send,\n  Sparkles,\n  XCircle,\n  Maximize2,\n  Minimize2,\n  Target,\n  Users,\n  Lightbulb,\n  FileText,\n  Layers,\n  CheckCircle2,\n  Loader2,\n  Volume2,\n  VolumeX,\n  ChevronRight,\n  LayoutPanelLeft,\n  PanelRightClose,\n  Wand2,\n  Eye,\n  EyeOff,\n} from 'lucide-react';\nimport { useRouter } from 'next/navigation';\nimport { useVoiceChat } from '@/hooks/useVoiceChat';\nimport { cn } from '@/lib/utils';\nimport { LiquidGlass } from '@/components/ui/liquid-glass';\nimport { ContextReferenceInput } from '@/components/ui/ContextReferenceInput';\nimport type { ContextReference } from '@/lib/canvas/artifacts';\n\n// ============================================================================\n// Types\n// ============================================================================\n\ninterface PRDFields {\n  title: string;\n  problem: string;\n  targetUser: string;\n  solution: string;\n  features: string[];\n  constraints: string[];\n  successMetrics: string[];\n  mvpDefinition: string;\n  nonGoals: string[];\n  milestones: string[];\n  openQuestions: string[];\n}\n\ninterface ConversationMessage {\n  id: string;\n  role: 'user' | 'assistant' | 'system';\n  content: string;\n  timestamp: Date;\n  extractedFields?: Partial<PRDFields>;\n  isStreaming?: boolean;\n}\n\ninterface CanvasElement {\n  id: string;\n  type: 'screen' | 'flow-start' | 'flow-end' | 'flow-process' | 'flow-decision' | 'feature' | 'user' | 'arch-service' | 'arch-database' | 'note';\n  label: string;\n  description?: string;\n  position: { x: number; y: number };\n  color?: string;\n  connections?: string[]; // IDs of connected elements\n}\n\ninterface CanvasData {\n  screens: string[];\n  userJourney: string[];\n  features: string[];\n  architecture: string[];\n}\n\n// ============================================================================\n// PRD Field Extraction (AI-powered)\n// ============================================================================\n\nconst PRD_EXTRACTION_PROMPT = `You are an AI product manager helping extract PRD (Product Requirements Document) fields AND visual elements from a conversation.\n\nAs the user describes their product idea, extract:\n\nPRD FIELDS:\n- title: The product name or title\n- problem: The core problem being solved\n- targetUser: Who the product is for\n- solution: The proposed solution approach\n- features: List of features mentioned\n- constraints: Technical or business constraints\n- successMetrics: How success will be measured\n- mvpDefinition: What constitutes the minimum viable product\n- nonGoals: What is explicitly out of scope\n- milestones: Key milestones or phases\n- openQuestions: Questions that need answers\n\nVISUAL ELEMENTS (for live canvas):\n- screens: Names of screens/pages mentioned (e.g., \"Login Screen\", \"Dashboard\", \"Settings\")\n- userJourney: Steps in the user flow (e.g., \"User opens app\", \"User logs in\", \"User views dashboard\")\n- architecture: Technical components mentioned (e.g., \"API Server\", \"Database\", \"Auth Service\")\n\nAfter each response, include a JSON block with any newly extracted fields:\n\\`\\`\\`prd-extract\n{\n  \"title\": \"extracted title or null\",\n  \"problem\": \"extracted problem or null\",\n  \"screens\": [\"Screen Name 1\", \"Screen Name 2\"],\n  \"userJourney\": [\"Step 1\", \"Step 2\"],\n  \"architecture\": [\"Component 1\", \"Component 2\"],\n  ...\n}\n\\`\\`\\`\n\nBe conversational and guide the user through defining their product. Ask clarifying questions to fill gaps. Help them think through their idea systematically.`;\n\ninterface ExtractionResult {\n  prdFields: Partial<PRDFields>;\n  canvasData: Partial<CanvasData>;\n}\n\nfunction extractPRDFields(content: string): ExtractionResult | null {\n  const match = content.match(/```prd-extract\\s*([\\s\\S]*?)```/);\n  if (!match) return null;\n\n  try {\n    const json = JSON.parse(match[1]);\n    // Filter out null values and separate PRD fields from canvas data\n    const prdFields: Partial<PRDFields> = {};\n    const canvasData: Partial<CanvasData> = {};\n    const canvasKeys = ['screens', 'userJourney', 'architecture'];\n\n    Object.entries(json).forEach(([key, value]) => {\n      if (value !== null && value !== undefined && value !== '') {\n        if (canvasKeys.includes(key)) {\n          (canvasData as any)[key] = value;\n        } else {\n          (prdFields as any)[key] = value;\n        }\n      }\n    });\n\n    const hasPRD = Object.keys(prdFields).length > 0;\n    const hasCanvas = Object.keys(canvasData).length > 0;\n\n    return (hasPRD || hasCanvas) ? { prdFields, canvasData } : null;\n  } catch {\n    return null;\n  }\n}\n\nfunction cleanDisplayContent(content: string): string {\n  // Remove the PRD extraction JSON block from display\n  return content.replace(/```prd-extract[\\s\\S]*?```/g, '').trim();\n}\n\n// ============================================================================\n// Message Component\n// ============================================================================\n\nfunction ChatMessage({ message, isLatest }: { message: ConversationMessage; isLatest: boolean }) {\n  const isUser = message.role === 'user';\n  const displayContent = cleanDisplayContent(message.content);\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      className={cn(\n        'flex gap-3 mb-4',\n        isUser ? 'flex-row-reverse' : 'flex-row'\n      )}\n    >\n      {/* Avatar */}\n      <div\n        className={cn(\n          'w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0',\n          isUser\n            ? 'bg-blue-500'\n            : 'bg-gradient-to-br from-violet-500 to-purple-600'\n        )}\n      >\n        {isUser ? (\n          <span className=\"text-white text-sm font-medium\">U</span>\n        ) : (\n          <Sparkles className=\"w-4 h-4 text-white\" />\n        )}\n      </div>\n\n      {/* Message Bubble */}\n      <div\n        className={cn(\n          'max-w-[80%] rounded-2xl px-4 py-3',\n          isUser\n            ? 'bg-blue-500 text-white'\n            : 'bg-white/10 text-white/90'\n        )}\n      >\n        <p className=\"text-sm whitespace-pre-wrap\">{displayContent}</p>\n\n        {message.isStreaming && (\n          <div className=\"flex items-center gap-1 mt-2\">\n            <div className=\"w-1.5 h-1.5 rounded-full bg-current animate-pulse\" />\n            <div className=\"w-1.5 h-1.5 rounded-full bg-current animate-pulse delay-100\" />\n            <div className=\"w-1.5 h-1.5 rounded-full bg-current animate-pulse delay-200\" />\n          </div>\n        )}\n\n        {/* Show extracted fields indicator */}\n        {message.extractedFields && Object.keys(message.extractedFields).length > 0 && (\n          <div className=\"flex flex-wrap gap-1.5 mt-2 pt-2 border-t border-white/10\">\n            {Object.keys(message.extractedFields).map((field) => (\n              <span\n                key={field}\n                className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-medium bg-green-500/20 text-green-300\"\n              >\n                <CheckCircle2 className=\"w-2.5 h-2.5\" />\n                {field}\n              </span>\n            ))}\n          </div>\n        )}\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================================================\n// Live PRD Preview Panel\n// ============================================================================\n\nfunction PRDPreviewPanel({\n  fields,\n  isExpanded,\n  onToggle,\n}: {\n  fields: PRDFields;\n  isExpanded: boolean;\n  onToggle: () => void;\n}) {\n  const filledFields = useMemo(() => {\n    return Object.entries(fields).filter(([, value]) => {\n      if (Array.isArray(value)) return value.length > 0;\n      return Boolean(value);\n    });\n  }, [fields]);\n\n  const completionPercent = Math.round((filledFields.length / 11) * 100);\n\n  const fieldIcons: Record<string, React.ReactNode> = {\n    title: <FileText className=\"w-3.5 h-3.5\" />,\n    problem: <Target className=\"w-3.5 h-3.5\" />,\n    targetUser: <Users className=\"w-3.5 h-3.5\" />,\n    solution: <Lightbulb className=\"w-3.5 h-3.5\" />,\n    features: <Layers className=\"w-3.5 h-3.5\" />,\n    constraints: <Target className=\"w-3.5 h-3.5\" />,\n    successMetrics: <CheckCircle2 className=\"w-3.5 h-3.5\" />,\n    mvpDefinition: <Wand2 className=\"w-3.5 h-3.5\" />,\n    nonGoals: <XCircle className=\"w-3.5 h-3.5\" />,\n    milestones: <ChevronRight className=\"w-3.5 h-3.5\" />,\n    openQuestions: <Lightbulb className=\"w-3.5 h-3.5\" />,\n  };\n\n  return (\n    <div className=\"h-full flex flex-col bg-black/40 backdrop-blur-xl rounded-2xl border border-white/10 overflow-hidden\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between px-4 py-3 border-b border-white/10\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"w-8 h-8 rounded-lg bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center\">\n            <FileText className=\"w-4 h-4 text-white\" />\n          </div>\n          <div>\n            <h3 className=\"font-semibold text-white text-sm\">Live PRD</h3>\n            <p className=\"text-xs text-white/50\">{completionPercent}% complete</p>\n          </div>\n        </div>\n        <button\n          onClick={onToggle}\n          className=\"p-1.5 rounded-lg hover:bg-white/10 transition-colors\"\n        >\n          {isExpanded ? (\n            <Minimize2 className=\"w-4 h-4 text-white/60\" />\n          ) : (\n            <Maximize2 className=\"w-4 h-4 text-white/60\" />\n          )}\n        </button>\n      </div>\n\n      {/* Progress Bar */}\n      <div className=\"h-1 bg-white/5\">\n        <motion.div\n          className=\"h-full bg-gradient-to-r from-green-500 to-emerald-400\"\n          initial={{ width: 0 }}\n          animate={{ width: `${completionPercent}%` }}\n          transition={{ duration: 0.5 }}\n        />\n      </div>\n\n      {/* Fields */}\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\n        {Object.entries(fields).map(([key, value]) => {\n          const hasValue = Array.isArray(value) ? value.length > 0 : Boolean(value);\n          const displayValue = Array.isArray(value) ? value.join(', ') : value;\n\n          return (\n            <motion.div\n              key={key}\n              initial={{ opacity: 0.5 }}\n              animate={{ opacity: hasValue ? 1 : 0.5 }}\n              className={cn(\n                'p-3 rounded-xl transition-colors',\n                hasValue ? 'bg-white/10' : 'bg-white/5 border border-dashed border-white/10'\n              )}\n            >\n              <div className=\"flex items-center gap-2 mb-1\">\n                <span className={cn(hasValue ? 'text-green-400' : 'text-white/40')}>\n                  {fieldIcons[key]}\n                </span>\n                <span className=\"text-xs font-medium text-white/60 capitalize\">\n                  {key.replace(/([A-Z])/g, ' $1').trim()}\n                </span>\n                {hasValue && (\n                  <CheckCircle2 className=\"w-3 h-3 text-green-400 ml-auto\" />\n                )}\n              </div>\n              {hasValue ? (\n                <p className=\"text-sm text-white/90 line-clamp-2\">\n                  {displayValue}\n                </p>\n              ) : (\n                <p className=\"text-xs text-white/30 italic\">\n                  Not yet captured...\n                </p>\n              )}\n            </motion.div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n\n// ============================================================================\n// Mini Canvas Preview\n// ============================================================================\n\nfunction CanvasPreviewPanel({\n  elements,\n  isVisible,\n  onToggle,\n  onOpenFullCanvas,\n}: {\n  elements: CanvasElement[];\n  isVisible: boolean;\n  onToggle: () => void;\n  onOpenFullCanvas?: () => void;\n}) {\n  return (\n    <div className=\"h-full flex flex-col bg-black/40 backdrop-blur-xl rounded-2xl border border-white/10 overflow-hidden\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between px-4 py-3 border-b border-white/10\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"w-8 h-8 rounded-lg bg-gradient-to-br from-purple-500 to-violet-600 flex items-center justify-center\">\n            <LayoutPanelLeft className=\"w-4 h-4 text-white\" />\n          </div>\n          <div>\n            <h3 className=\"font-semibold text-white text-sm\">Live Canvas</h3>\n            <p className=\"text-xs text-white/50\">{elements.length} elements</p>\n          </div>\n        </div>\n        <button\n          onClick={onToggle}\n          className=\"p-1.5 rounded-lg hover:bg-white/10 transition-colors\"\n        >\n          {isVisible ? (\n            <Eye className=\"w-4 h-4 text-white/60\" />\n          ) : (\n            <EyeOff className=\"w-4 h-4 text-white/60\" />\n          )}\n        </button>\n      </div>\n\n      {/* Canvas Preview */}\n      <div className=\"flex-1 relative bg-[#1a1a2e] overflow-hidden\">\n        {/* Grid */}\n        <div\n          className=\"absolute inset-0 opacity-20\"\n          style={{\n            backgroundImage: `\n              linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),\n              linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px)\n            `,\n            backgroundSize: '20px 20px',\n          }}\n        />\n\n        {/* Elements */}\n        {elements.length === 0 ? (\n          <div className=\"absolute inset-0 flex items-center justify-center\">\n            <div className=\"text-center\">\n              <Wand2 className=\"w-8 h-8 mx-auto mb-2 text-white/20\" />\n              <p className=\"text-xs text-white/30\">\n                Visuals will appear here<br />as you describe your product\n              </p>\n            </div>\n          </div>\n        ) : (\n          elements.map((element) => {\n            // Node shape based on type\n            const getNodeStyle = () => {\n              switch (element.type) {\n                case 'flow-start':\n                case 'flow-end':\n                  return 'rounded-full px-4 py-2';\n                case 'flow-decision':\n                  return 'rotate-45 w-10 h-10 flex items-center justify-center';\n                case 'flow-process':\n                  return 'rounded-lg px-3 py-2';\n                case 'screen':\n                  return 'rounded-xl px-3 py-2 border-2 border-purple-400/50';\n                case 'arch-database':\n                  return 'rounded-t-lg rounded-b-[50%] px-3 py-2';\n                case 'arch-service':\n                  return 'rounded-lg px-3 py-2 border border-white/20';\n                case 'user':\n                  return 'rounded-full px-3 py-2';\n                default:\n                  return 'rounded-lg px-3 py-2';\n              }\n            };\n\n            const bgColor = element.color || '#3b82f6';\n\n            return (\n              <motion.div\n                key={element.id}\n                initial={{ opacity: 0, scale: 0.8 }}\n                animate={{ opacity: 1, scale: 1 }}\n                className=\"absolute\"\n                style={{\n                  left: element.position.x,\n                  top: element.position.y,\n                }}\n              >\n                <div\n                  className={cn(\n                    'text-[10px] font-medium shadow-lg text-white',\n                    getNodeStyle()\n                  )}\n                  style={{ backgroundColor: bgColor }}\n                >\n                  {element.type === 'flow-decision' ? (\n                    <span className=\"-rotate-45 block text-[8px]\">{element.label}</span>\n                  ) : (\n                    element.label\n                  )}\n                </div>\n              </motion.div>\n            );\n          })\n        )}\n      </div>\n\n      {/* Open Full Canvas Button */}\n      <div className=\"p-3 border-t border-white/10\">\n        <button\n          onClick={onOpenFullCanvas}\n          className=\"w-full flex items-center justify-center gap-2 py-2 rounded-lg bg-purple-500/20 text-purple-300 text-sm font-medium hover:bg-purple-500/30 transition-colors\"\n        >\n          <Maximize2 className=\"w-4 h-4\" />\n          Open Full Canvas\n        </button>\n      </div>\n    </div>\n  );\n}\n\n// ============================================================================\n// Main Component\n// ============================================================================\n\ninterface AgenticProductStudioProps {\n  isOpen: boolean;\n  onClose: () => void;\n  projectId?: string;\n  onPRDComplete?: (prd: PRDFields) => void;\n}\n\nexport function AgenticProductStudio({\n  isOpen,\n  onClose,\n  projectId,\n  onPRDComplete,\n}: AgenticProductStudioProps) {\n  const router = useRouter();\n\n  // State\n  const [messages, setMessages] = useState<ConversationMessage[]>([]);\n  const [inputValue, setInputValue] = useState('');\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [showCanvas, setShowCanvas] = useState(true);\n  const [expandPRD, setExpandPRD] = useState(false);\n  const [canvasElements, setCanvasElements] = useState<CanvasElement[]>([]);\n  const [prdFields, setPrdFields] = useState<PRDFields>({\n    title: '',\n    problem: '',\n    targetUser: '',\n    solution: '',\n    features: [],\n    constraints: [],\n    successMetrics: [],\n    mvpDefinition: '',\n    nonGoals: [],\n    milestones: [],\n    openQuestions: [],\n  });\n\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLTextAreaElement>(null);\n\n  // Open full canvas with current elements\n  const openFullCanvas = useCallback(() => {\n    // Store canvas data in sessionStorage for the canvas page to pick up\n    const canvasState = {\n      elements: canvasElements,\n      prdTitle: prdFields.title,\n      projectId,\n    };\n    sessionStorage.setItem('canvas_import_data', JSON.stringify(canvasState));\n\n    // Navigate to canvas\n    router.push('/canvas?mode=import');\n    onClose();\n  }, [canvasElements, prdFields.title, projectId, router, onClose]);\n\n  // Voice Chat Hook\n  const voiceChat = useVoiceChat({\n    continuous: false,\n    autoSpeak: true,\n    onTranscriptComplete: async (transcript) => {\n      if (transcript.trim()) {\n        setInputValue('');\n        await sendMessage(transcript);\n      }\n    },\n  });\n\n  // Scroll to bottom on new messages\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  // Initial welcome message\n  useEffect(() => {\n    if (isOpen && messages.length === 0) {\n      setMessages([{\n        id: 'welcome',\n        role: 'assistant',\n        content: `Hey! I'm here to help you define your product. Just tell me about your idea - what problem are you trying to solve, and who is it for?\n\nYou can speak naturally or type. As we talk, I'll extract the key details for your PRD in real-time. You'll see the document build itself on the right.\n\nWhat's on your mind?`,\n        timestamp: new Date(),\n      }]);\n    }\n  }, [isOpen, messages.length]);\n\n  // Send message to AI\n  const sendMessage = useCallback(async (content: string) => {\n    if (!content.trim() || isProcessing) return;\n\n    const userMessage: ConversationMessage = {\n      id: `user_${Date.now()}`,\n      role: 'user',\n      content: content.trim(),\n      timestamp: new Date(),\n    };\n\n    const assistantMessage: ConversationMessage = {\n      id: `assistant_${Date.now()}`,\n      role: 'assistant',\n      content: '',\n      timestamp: new Date(),\n      isStreaming: true,\n    };\n\n    setMessages(prev => [...prev, userMessage, assistantMessage]);\n    setIsProcessing(true);\n\n    try {\n      // Prepare messages for API\n      const apiMessages = [\n        { role: 'system', content: PRD_EXTRACTION_PROMPT },\n        ...messages.map(m => ({ role: m.role, content: m.content })),\n        { role: 'user', content: content },\n      ];\n\n      const response = await fetch('/api/chat/stream', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          messages: apiMessages,\n          model: 'default',\n          themeContext: 'Product development assistant helping create a PRD',\n        }),\n      });\n\n      if (!response.ok) throw new Error('Failed to get response');\n\n      const reader = response.body?.getReader();\n      if (!reader) throw new Error('No response body');\n\n      const decoder = new TextDecoder();\n      let accumulated = '';\n\n      while (true) {\n        const { done, value } = await reader.read();\n        if (done) break;\n\n        const chunk = decoder.decode(value, { stream: true });\n        const lines = chunk.split('\\n');\n\n        for (const line of lines) {\n          if (line.startsWith('data: ')) {\n            const data = line.slice(6);\n            if (data === '[DONE]') continue;\n\n            try {\n              const parsed = JSON.parse(data);\n              if (parsed.content) {\n                accumulated += parsed.content;\n\n                setMessages(prev =>\n                  prev.map(m =>\n                    m.id === assistantMessage.id\n                      ? { ...m, content: accumulated }\n                      : m\n                  )\n                );\n              }\n            } catch {\n              // Skip invalid JSON\n            }\n          }\n        }\n      }\n\n      // Extract PRD fields and canvas data from the response\n      const extraction = extractPRDFields(accumulated);\n\n      if (extraction) {\n        const { prdFields: extractedPRD, canvasData: extractedCanvas } = extraction;\n\n        // Update PRD fields\n        if (Object.keys(extractedPRD).length > 0) {\n          setPrdFields(prev => {\n            const updated = { ...prev };\n            Object.entries(extractedPRD).forEach(([key, value]) => {\n              if (value !== null && value !== undefined) {\n                if (Array.isArray(prev[key as keyof PRDFields])) {\n                  // For array fields, merge with existing\n                  const existing = prev[key as keyof PRDFields] as string[];\n                  const newItems = Array.isArray(value) ? value : [value];\n                  (updated as any)[key] = [...new Set([...existing, ...newItems])];\n                } else {\n                  (updated as any)[key] = value;\n                }\n              }\n            });\n            return updated;\n          });\n        }\n\n        // Generate canvas elements from extracted data\n        const newElements: CanvasElement[] = [];\n        const baseTime = Date.now();\n\n        // Add screens as flow-screen nodes\n        if (extractedCanvas.screens) {\n          extractedCanvas.screens.forEach((screen, i) => {\n            newElements.push({\n              id: `screen_${baseTime}_${i}`,\n              type: 'screen',\n              label: screen,\n              position: { x: 20 + (i % 4) * 140, y: 20 },\n              color: '#8b5cf6',\n            });\n          });\n        }\n\n        // Add user journey as flow nodes\n        if (extractedCanvas.userJourney) {\n          extractedCanvas.userJourney.forEach((step, i) => {\n            const isFirst = i === 0;\n            const isLast = i === extractedCanvas.userJourney!.length - 1;\n            newElements.push({\n              id: `journey_${baseTime}_${i}`,\n              type: isFirst ? 'flow-start' : isLast ? 'flow-end' : 'flow-process',\n              label: step,\n              position: { x: 20 + i * 160, y: 100 },\n              color: isFirst ? '#10b981' : isLast ? '#ef4444' : '#3b82f6',\n            });\n          });\n        }\n\n        // Add architecture components\n        if (extractedCanvas.architecture) {\n          extractedCanvas.architecture.forEach((comp, i) => {\n            const isDb = comp.toLowerCase().includes('database') || comp.toLowerCase().includes('db');\n            newElements.push({\n              id: `arch_${baseTime}_${i}`,\n              type: isDb ? 'arch-database' : 'arch-service',\n              label: comp,\n              position: { x: 20 + (i % 3) * 150, y: 200 + Math.floor(i / 3) * 80 },\n              color: isDb ? '#10b981' : '#3b82f6',\n            });\n          });\n        }\n\n        // Add features\n        if (extractedPRD.features) {\n          const features = Array.isArray(extractedPRD.features) ? extractedPRD.features : [extractedPRD.features];\n          features.forEach((feature, i) => {\n            newElements.push({\n              id: `feature_${baseTime}_${i}`,\n              type: 'feature',\n              label: feature as string,\n              position: { x: 20 + (i % 3) * 130, y: 320 + Math.floor(i / 3) * 50 },\n              color: '#f59e0b',\n            });\n          });\n        }\n\n        if (newElements.length > 0) {\n          setCanvasElements(prev => [...prev, ...newElements]);\n        }\n\n        // Update message with extracted fields\n        setMessages(prev =>\n          prev.map(m =>\n            m.id === assistantMessage.id\n              ? { ...m, isStreaming: false, extractedFields: extractedPRD }\n              : m\n          )\n        );\n      } else {\n        // Just mark as complete\n        setMessages(prev =>\n          prev.map(m =>\n            m.id === assistantMessage.id\n              ? { ...m, isStreaming: false }\n              : m\n          )\n        );\n      }\n\n      // Speak the response if voice is enabled\n      const cleanContent = cleanDisplayContent(accumulated);\n      if (cleanContent) {\n        voiceChat.speakResponse(cleanContent);\n      }\n\n    } catch (error) {\n      console.error('Error sending message:', error);\n      setMessages(prev =>\n        prev.map(m =>\n          m.id === assistantMessage.id\n            ? { ...m, isStreaming: false, content: 'Sorry, I encountered an error. Please try again.' }\n            : m\n        )\n      );\n    } finally {\n      setIsProcessing(false);\n    }\n  }, [messages, isProcessing, voiceChat]);\n\n  // Handle form submission\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (inputValue.trim()) {\n      const value = inputValue;\n      setInputValue('');\n      sendMessage(value);\n    }\n  };\n\n  // Handle keyboard shortcuts\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSubmit(e);\n    }\n  };\n\n  // Visual sharding - convert PRD into visual tickets on canvas\n  const shardToCanvas = useCallback(() => {\n    const newElements: CanvasElement[] = [];\n    const baseTime = Date.now();\n    let yOffset = 20;\n\n    // Create a \"PRD\" header node\n    if (prdFields.title) {\n      newElements.push({\n        id: `prd_title_${baseTime}`,\n        type: 'note',\n        label: `PRD: ${prdFields.title}`,\n        position: { x: 20, y: yOffset },\n        color: '#8b5cf6',\n      });\n      yOffset += 60;\n    }\n\n    // Create feature tickets\n    if (prdFields.features.length > 0) {\n      // Add section header\n      newElements.push({\n        id: `features_header_${baseTime}`,\n        type: 'note',\n        label: 'Features',\n        position: { x: 20, y: yOffset },\n        color: '#6366f1',\n      });\n      yOffset += 40;\n\n      prdFields.features.forEach((feature, i) => {\n        newElements.push({\n          id: `ticket_feature_${baseTime}_${i}`,\n          type: 'feature',\n          label: feature,\n          description: `Feature ticket: ${feature}`,\n          position: { x: 20 + (i % 3) * 180, y: yOffset + Math.floor(i / 3) * 60 },\n          color: '#3b82f6',\n        });\n      });\n      yOffset += Math.ceil(prdFields.features.length / 3) * 60 + 40;\n    }\n\n    // Create milestone tickets\n    if (prdFields.milestones.length > 0) {\n      newElements.push({\n        id: `milestones_header_${baseTime}`,\n        type: 'note',\n        label: 'Milestones',\n        position: { x: 20, y: yOffset },\n        color: '#6366f1',\n      });\n      yOffset += 40;\n\n      prdFields.milestones.forEach((milestone, i) => {\n        const isFirst = i === 0;\n        const isLast = i === prdFields.milestones.length - 1;\n        newElements.push({\n          id: `ticket_milestone_${baseTime}_${i}`,\n          type: isFirst ? 'flow-start' : isLast ? 'flow-end' : 'flow-process',\n          label: milestone,\n          position: { x: 20 + i * 180, y: yOffset },\n          color: isFirst ? '#10b981' : isLast ? '#ef4444' : '#f59e0b',\n        });\n      });\n      yOffset += 80;\n    }\n\n    // Create constraint notes\n    if (prdFields.constraints.length > 0) {\n      newElements.push({\n        id: `constraints_header_${baseTime}`,\n        type: 'note',\n        label: 'Constraints',\n        position: { x: 20, y: yOffset },\n        color: '#ef4444',\n      });\n      yOffset += 40;\n\n      prdFields.constraints.forEach((constraint, i) => {\n        newElements.push({\n          id: `constraint_${baseTime}_${i}`,\n          type: 'note',\n          label: constraint,\n          position: { x: 20 + (i % 2) * 220, y: yOffset + Math.floor(i / 2) * 50 },\n          color: '#ef4444',\n        });\n      });\n    }\n\n    // Replace canvas with sharded view\n    setCanvasElements(newElements);\n  }, [prdFields]);\n\n  if (!isOpen) return null;\n\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      exit={{ opacity: 0 }}\n      className=\"fixed inset-0 z-50 flex items-center justify-center p-4\"\n      style={{ backgroundColor: 'rgba(0, 0, 0, 0.9)' }}\n    >\n      <motion.div\n        initial={{ scale: 0.95, y: 20 }}\n        animate={{ scale: 1, y: 0 }}\n        exit={{ scale: 0.95, y: 20 }}\n        className=\"w-full max-w-6xl h-[90vh] flex flex-col overflow-hidden rounded-3xl bg-[#0a0a14] border border-white/10\"\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between px-6 py-4 border-b border-white/10\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center\">\n              <Sparkles className=\"w-5 h-5 text-white\" />\n            </div>\n            <div>\n              <h2 className=\"font-semibold text-white\">Agentic Product Studio</h2>\n              <p className=\"text-xs text-white/50\">Voice-driven PRD creation</p>\n            </div>\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            {/* Voice Toggle */}\n            <button\n              onClick={voiceChat.toggleVoice}\n              className={cn(\n                'flex items-center gap-2 px-3 py-1.5 rounded-lg transition-colors',\n                voiceChat.isVoiceEnabled\n                  ? 'bg-green-500/20 text-green-400'\n                  : 'bg-white/5 text-white/60 hover:bg-white/10'\n              )}\n            >\n              {voiceChat.isVoiceEnabled ? (\n                <Volume2 className=\"w-4 h-4\" />\n              ) : (\n                <VolumeX className=\"w-4 h-4\" />\n              )}\n              <span className=\"text-xs font-medium\">Voice</span>\n            </button>\n\n            {/* Canvas Toggle */}\n            <button\n              onClick={() => setShowCanvas(!showCanvas)}\n              className={cn(\n                'flex items-center gap-2 px-3 py-1.5 rounded-lg transition-colors',\n                showCanvas\n                  ? 'bg-purple-500/20 text-purple-400'\n                  : 'bg-white/5 text-white/60 hover:bg-white/10'\n              )}\n            >\n              {showCanvas ? (\n                <LayoutPanelLeft className=\"w-4 h-4\" />\n              ) : (\n                <PanelRightClose className=\"w-4 h-4\" />\n              )}\n              <span className=\"text-xs font-medium\">Canvas</span>\n            </button>\n\n            <button\n              onClick={onClose}\n              className=\"p-2 rounded-lg hover:bg-white/10 transition-colors\"\n            >\n              <XCircle className=\"w-5 h-5 text-white/60\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Main Content */}\n        <div className=\"flex-1 flex min-h-0\">\n          {/* Chat Panel */}\n          <div className={cn(\n            'flex flex-col transition-all duration-300',\n            showCanvas ? 'w-1/2' : 'w-full'\n          )}>\n            {/* Messages */}\n            <div className=\"flex-1 overflow-y-auto p-6\">\n              {messages.map((message, i) => (\n                <ChatMessage\n                  key={message.id}\n                  message={message}\n                  isLatest={i === messages.length - 1}\n                />\n              ))}\n              <div ref={messagesEndRef} />\n            </div>\n\n            {/* Input Area */}\n            <div className=\"p-4 border-t border-white/10\">\n              {/* Voice Status */}\n              {voiceChat.mode === 'listening' && (\n                <motion.div\n                  initial={{ opacity: 0, y: 10 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  className=\"flex items-center gap-3 mb-3 px-4 py-2 rounded-xl bg-red-500/10 border border-red-500/20\"\n                >\n                  <div className=\"relative\">\n                    <Mic className=\"w-5 h-5 text-red-400\" />\n                    <span className=\"absolute -top-0.5 -right-0.5 w-2 h-2 bg-red-500 rounded-full animate-pulse\" />\n                  </div>\n                  <span className=\"text-sm text-red-300\">\n                    {voiceChat.interimTranscript || 'Listening...'}\n                  </span>\n                </motion.div>\n              )}\n\n              <form onSubmit={handleSubmit} className=\"flex items-end gap-3\">\n                {/* Voice Button */}\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    if (voiceChat.mode === 'listening') {\n                      voiceChat.stopListening();\n                    } else {\n                      voiceChat.startListening();\n                    }\n                  }}\n                  disabled={!voiceChat.isSpeechSupported}\n                  className={cn(\n                    'flex-shrink-0 w-10 h-10 rounded-xl flex items-center justify-center transition-colors',\n                    voiceChat.mode === 'listening'\n                      ? 'bg-red-500 text-white'\n                      : 'bg-white/10 text-white/60 hover:bg-white/20'\n                  )}\n                >\n                  {voiceChat.mode === 'listening' ? (\n                    <MicOff className=\"w-5 h-5\" />\n                  ) : (\n                    <Mic className=\"w-5 h-5\" />\n                  )}\n                </button>\n\n                {/* Text Input with Context References */}\n                <div className=\"flex-1 relative\">\n                  <ContextReferenceInput\n                    value={inputValue}\n                    onChange={setInputValue}\n                    onKeyDown={handleKeyDown}\n                    placeholder=\"Describe your product idea... Use @ to reference tickets, PRDs, etc.\"\n                    multiline\n                    rows={1}\n                    className=\"w-full px-4 py-3 pr-12 rounded-xl bg-white/10 border border-white/10 text-white placeholder-white/40 resize-none focus:outline-none focus:ring-2 focus:ring-purple-500/50\"\n                    style={{ minHeight: '48px', maxHeight: '120px' }}\n                    onReferenceInserted={(ref: ContextReference) => {\n                      console.log('Reference inserted:', ref);\n                    }}\n                  />\n\n                  <button\n                    type=\"submit\"\n                    disabled={!inputValue.trim() || isProcessing}\n                    className=\"absolute right-2 bottom-2 w-8 h-8 rounded-lg bg-purple-500 text-white flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed hover:bg-purple-400 transition-colors\"\n                  >\n                    {isProcessing ? (\n                      <Loader2 className=\"w-4 h-4 animate-spin\" />\n                    ) : (\n                      <Send className=\"w-4 h-4\" />\n                    )}\n                  </button>\n                </div>\n              </form>\n\n              {/* Hint */}\n              <p className=\"text-xs text-white/30 mt-2 text-center\">\n                Press Enter to send, Shift+Enter for new line, use @ to reference data, or click the mic\n              </p>\n            </div>\n          </div>\n\n          {/* Right Panel - PRD + Canvas */}\n          {showCanvas && (\n            <div className=\"w-1/2 flex flex-col border-l border-white/10 p-4 gap-4\">\n              {/* PRD Preview */}\n              <div className={cn(\n                'transition-all duration-300',\n                expandPRD ? 'flex-1' : 'h-1/2'\n              )}>\n                <PRDPreviewPanel\n                  fields={prdFields}\n                  isExpanded={expandPRD}\n                  onToggle={() => setExpandPRD(!expandPRD)}\n                />\n              </div>\n\n              {/* Canvas Preview */}\n              {!expandPRD && (\n                <div className=\"h-1/2\">\n                  <CanvasPreviewPanel\n                    elements={canvasElements}\n                    isVisible={true}\n                    onToggle={() => {}}\n                    onOpenFullCanvas={openFullCanvas}\n                  />\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n\n        {/* Footer Actions */}\n        <div className=\"flex items-center justify-between px-6 py-4 border-t border-white/10\">\n          <div className=\"flex items-center gap-2 text-xs text-white/40\">\n            <Sparkles className=\"w-3.5 h-3.5\" />\n            <span>Claw AI is extracting PRD fields as you speak</span>\n          </div>\n\n          <div className=\"flex items-center gap-3\">\n            <button\n              onClick={onClose}\n              className=\"px-4 py-2 rounded-xl bg-white/5 text-white/60 hover:bg-white/10 transition-colors text-sm font-medium\"\n            >\n              Cancel\n            </button>\n\n            {/* Shard to Canvas */}\n            <button\n              onClick={shardToCanvas}\n              disabled={prdFields.features.length === 0 && prdFields.milestones.length === 0}\n              className=\"flex items-center gap-2 px-4 py-2 rounded-xl bg-orange-500/20 text-orange-300 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-orange-500/30 transition-colors\"\n            >\n              <Layers className=\"w-4 h-4\" />\n              Shard to Canvas\n            </button>\n\n            <button\n              onClick={() => onPRDComplete?.(prdFields)}\n              disabled={!prdFields.title || !prdFields.problem}\n              className=\"flex items-center gap-2 px-4 py-2 rounded-xl bg-gradient-to-r from-purple-500 to-violet-600 text-white text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:opacity-90 transition-opacity\"\n            >\n              <FileText className=\"w-4 h-4\" />\n              Save PRD\n            </button>\n          </div>\n        </div>\n      </motion.div>\n    </motion.div>\n  );\n}\n\n// ============================================================================\n// Entry Point Button\n// ============================================================================\n\ninterface AgenticProductStudioButtonProps {\n  onClick: () => void;\n  variant?: 'default' | 'compact';\n}\n\nexport function AgenticProductStudioButton({ onClick, variant = 'default' }: AgenticProductStudioButtonProps) {\n  if (variant === 'compact') {\n    return (\n      <button\n        onClick={onClick}\n        className=\"flex items-center gap-2 px-4 py-2 rounded-xl transition-all hover:scale-105\"\n        style={{\n          background: 'linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%)',\n          color: 'white',\n        }}\n      >\n        <Mic className=\"w-4 h-4\" />\n        <span className=\"font-medium\">Voice PRD</span>\n      </button>\n    );\n  }\n\n  return (\n    <button\n      onClick={onClick}\n      className=\"group relative w-full p-6 rounded-2xl transition-all hover:scale-[1.02] overflow-hidden\"\n      style={{\n        background: 'linear-gradient(135deg, #8b5cf6 0%, #6366f1 50%, #3b82f6 100%)',\n      }}\n    >\n      <div className=\"absolute inset-0 bg-gradient-to-r from-white/0 via-white/10 to-white/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000\" />\n      <div className=\"relative flex items-center gap-4\">\n        <div className=\"w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center\">\n          <Mic className=\"w-7 h-7 text-white\" />\n        </div>\n        <div className=\"text-left\">\n          <h3 className=\"text-xl font-semibold text-white\">\n            Voice PRD Studio\n          </h3>\n          <p className=\"text-white/80\">\n            Speak your product idea into existence\n          </p>\n        </div>\n        <ChevronRight className=\"w-6 h-6 text-white/80 ml-auto\" />\n      </div>\n    </button>\n  );\n}\n\nexport default AgenticProductStudio;\n"],"names":[],"mappings":"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"}}]
}