(globalThis.TURBOPACK || (globalThis.TURBOPACK = [])).push([typeof document === "object" ? document.currentScript : undefined,
"[project]/node_modules/.pnpm/@json-render+core@0.5.2_zod@4.3.6/node_modules/@json-render/core/dist/index.mjs [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "ActionBindingSchema",
    ()=>ActionBindingSchema,
    "ActionConfirmSchema",
    ()=>ActionConfirmSchema,
    "ActionOnErrorSchema",
    ()=>ActionOnErrorSchema,
    "ActionOnSuccessSchema",
    ()=>ActionOnSuccessSchema,
    "ActionSchema",
    ()=>ActionSchema,
    "DynamicBooleanSchema",
    ()=>DynamicBooleanSchema,
    "DynamicNumberSchema",
    ()=>DynamicNumberSchema,
    "DynamicStringSchema",
    ()=>DynamicStringSchema,
    "DynamicValueSchema",
    ()=>DynamicValueSchema,
    "LogicExpressionSchema",
    ()=>LogicExpressionSchema,
    "ValidationCheckSchema",
    ()=>ValidationCheckSchema,
    "ValidationConfigSchema",
    ()=>ValidationConfigSchema,
    "VisibilityConditionSchema",
    ()=>VisibilityConditionSchema,
    "action",
    ()=>action,
    "actionBinding",
    ()=>actionBinding,
    "addByPath",
    ()=>addByPath,
    "applySpecStreamPatch",
    ()=>applySpecStreamPatch,
    "autoFixSpec",
    ()=>autoFixSpec,
    "buildUserPrompt",
    ()=>buildUserPrompt,
    "builtInValidationFunctions",
    ()=>builtInValidationFunctions,
    "check",
    ()=>check,
    "compileSpecStream",
    ()=>compileSpecStream,
    "createCatalog",
    ()=>createCatalog,
    "createSpecStreamCompiler",
    ()=>createSpecStreamCompiler,
    "defineCatalog",
    ()=>defineCatalog,
    "defineSchema",
    ()=>defineSchema,
    "evaluateLogicExpression",
    ()=>evaluateLogicExpression,
    "evaluateVisibility",
    ()=>evaluateVisibility,
    "executeAction",
    ()=>executeAction,
    "findFormValue",
    ()=>findFormValue,
    "formatSpecIssues",
    ()=>formatSpecIssues,
    "generateCatalogPrompt",
    ()=>generateCatalogPrompt,
    "generateSystemPrompt",
    ()=>generateSystemPrompt,
    "getByPath",
    ()=>getByPath,
    "interpolateString",
    ()=>interpolateString,
    "parseSpecStreamLine",
    ()=>parseSpecStreamLine,
    "removeByPath",
    ()=>removeByPath,
    "resolveAction",
    ()=>resolveAction,
    "resolveDynamicValue",
    ()=>resolveDynamicValue,
    "resolveElementProps",
    ()=>resolveElementProps,
    "resolvePropValue",
    ()=>resolvePropValue,
    "runValidation",
    ()=>runValidation,
    "runValidationCheck",
    ()=>runValidationCheck,
    "setByPath",
    ()=>setByPath,
    "validateSpec",
    ()=>validateSpec,
    "visibility",
    ()=>visibility
]);
// src/types.ts
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/zod@4.3.6/node_modules/zod/v4/classic/external.js [app-client] (ecmascript) <export * as z>");
;
var DynamicValueSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].union([
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string(),
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].number(),
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].boolean(),
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].null(),
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
        path: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string()
    })
]);
var DynamicStringSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].union([
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string(),
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
        path: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string()
    })
]);
var DynamicNumberSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].union([
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].number(),
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
        path: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string()
    })
]);
var DynamicBooleanSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].union([
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].boolean(),
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
        path: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string()
    })
]);
function resolveDynamicValue(value, stateModel) {
    if (value === null || value === void 0) {
        return void 0;
    }
    if (typeof value === "object" && "path" in value) {
        return getByPath(stateModel, value.path);
    }
    return value;
}
function unescapeJsonPointer(token) {
    return token.replace(/~1/g, "/").replace(/~0/g, "~");
}
function parseJsonPointer(path) {
    const raw = path.startsWith("/") ? path.slice(1).split("/") : path.split("/");
    return raw.map(unescapeJsonPointer);
}
function getByPath(obj, path) {
    if (!path || path === "/") {
        return obj;
    }
    const segments = parseJsonPointer(path);
    let current = obj;
    for (const segment of segments){
        if (current === null || current === void 0) {
            return void 0;
        }
        if (Array.isArray(current)) {
            const index = parseInt(segment, 10);
            current = current[index];
        } else if (typeof current === "object") {
            current = current[segment];
        } else {
            return void 0;
        }
    }
    return current;
}
function isNumericIndex(str) {
    return /^\d+$/.test(str);
}
function setByPath(obj, path, value) {
    const segments = parseJsonPointer(path);
    if (segments.length === 0) return;
    let current = obj;
    for(let i = 0; i < segments.length - 1; i++){
        const segment = segments[i];
        const nextSegment = segments[i + 1];
        const nextIsNumeric = nextSegment !== void 0 && (isNumericIndex(nextSegment) || nextSegment === "-");
        if (Array.isArray(current)) {
            const index = parseInt(segment, 10);
            if (current[index] === void 0 || typeof current[index] !== "object") {
                current[index] = nextIsNumeric ? [] : {};
            }
            current = current[index];
        } else {
            if (!(segment in current) || typeof current[segment] !== "object") {
                current[segment] = nextIsNumeric ? [] : {};
            }
            current = current[segment];
        }
    }
    const lastSegment = segments[segments.length - 1];
    if (Array.isArray(current)) {
        if (lastSegment === "-") {
            current.push(value);
        } else {
            const index = parseInt(lastSegment, 10);
            current[index] = value;
        }
    } else {
        current[lastSegment] = value;
    }
}
function addByPath(obj, path, value) {
    const segments = parseJsonPointer(path);
    if (segments.length === 0) return;
    let current = obj;
    for(let i = 0; i < segments.length - 1; i++){
        const segment = segments[i];
        const nextSegment = segments[i + 1];
        const nextIsNumeric = nextSegment !== void 0 && (isNumericIndex(nextSegment) || nextSegment === "-");
        if (Array.isArray(current)) {
            const index = parseInt(segment, 10);
            if (current[index] === void 0 || typeof current[index] !== "object") {
                current[index] = nextIsNumeric ? [] : {};
            }
            current = current[index];
        } else {
            if (!(segment in current) || typeof current[segment] !== "object") {
                current[segment] = nextIsNumeric ? [] : {};
            }
            current = current[segment];
        }
    }
    const lastSegment = segments[segments.length - 1];
    if (Array.isArray(current)) {
        if (lastSegment === "-") {
            current.push(value);
        } else {
            const index = parseInt(lastSegment, 10);
            current.splice(index, 0, value);
        }
    } else {
        current[lastSegment] = value;
    }
}
function removeByPath(obj, path) {
    const segments = parseJsonPointer(path);
    if (segments.length === 0) return;
    let current = obj;
    for(let i = 0; i < segments.length - 1; i++){
        const segment = segments[i];
        if (Array.isArray(current)) {
            const index = parseInt(segment, 10);
            if (current[index] === void 0 || typeof current[index] !== "object") {
                return;
            }
            current = current[index];
        } else {
            if (!(segment in current) || typeof current[segment] !== "object") {
                return;
            }
            current = current[segment];
        }
    }
    const lastSegment = segments[segments.length - 1];
    if (Array.isArray(current)) {
        const index = parseInt(lastSegment, 10);
        if (index >= 0 && index < current.length) {
            current.splice(index, 1);
        }
    } else {
        delete current[lastSegment];
    }
}
function deepEqual(a, b) {
    if (a === b) return true;
    if (a === null || b === null) return false;
    if (typeof a !== typeof b) return false;
    if (typeof a !== "object") return false;
    if (Array.isArray(a)) {
        if (!Array.isArray(b)) return false;
        if (a.length !== b.length) return false;
        return a.every((item, i)=>deepEqual(item, b[i]));
    }
    const aObj = a;
    const bObj = b;
    const aKeys = Object.keys(aObj);
    const bKeys = Object.keys(bObj);
    if (aKeys.length !== bKeys.length) return false;
    return aKeys.every((key)=>deepEqual(aObj[key], bObj[key]));
}
function findFormValue(fieldName, params, data) {
    if (params?.[fieldName] !== void 0) {
        const val = params[fieldName];
        if (typeof val !== "string" || !val.includes(".")) {
            return val;
        }
    }
    if (params) {
        for (const key of Object.keys(params)){
            if (key.endsWith(`.${fieldName}`)) {
                const val = params[key];
                if (typeof val !== "string" || !val.includes(".")) {
                    return val;
                }
            }
        }
    }
    if (data) {
        for (const key of Object.keys(data)){
            if (key === fieldName || key.endsWith(`.${fieldName}`)) {
                return data[key];
            }
        }
        const prefixes = [
            "form",
            "newCustomer",
            "customer",
            ""
        ];
        for (const prefix of prefixes){
            const path = prefix ? `${prefix}/${fieldName}` : fieldName;
            const val = getByPath(data, path);
            if (val !== void 0) {
                return val;
            }
        }
    }
    return void 0;
}
function parseSpecStreamLine(line) {
    const trimmed = line.trim();
    if (!trimmed || !trimmed.startsWith("{")) return null;
    try {
        const patch = JSON.parse(trimmed);
        if (patch.op && patch.path !== void 0) {
            return patch;
        }
        return null;
    } catch  {
        return null;
    }
}
function applySpecStreamPatch(obj, patch) {
    switch(patch.op){
        case "add":
            addByPath(obj, patch.path, patch.value);
            break;
        case "replace":
            setByPath(obj, patch.path, patch.value);
            break;
        case "remove":
            removeByPath(obj, patch.path);
            break;
        case "move":
            {
                if (!patch.from) break;
                const moveValue = getByPath(obj, patch.from);
                removeByPath(obj, patch.from);
                addByPath(obj, patch.path, moveValue);
                break;
            }
        case "copy":
            {
                if (!patch.from) break;
                const copyValue = getByPath(obj, patch.from);
                addByPath(obj, patch.path, copyValue);
                break;
            }
        case "test":
            {
                const actual = getByPath(obj, patch.path);
                if (!deepEqual(actual, patch.value)) {
                    throw new Error(`Test operation failed: value at "${patch.path}" does not match`);
                }
                break;
            }
    }
    return obj;
}
function compileSpecStream(stream, initial = {}) {
    const lines = stream.split("\n");
    const result = {
        ...initial
    };
    for (const line of lines){
        const patch = parseSpecStreamLine(line);
        if (patch) {
            applySpecStreamPatch(result, patch);
        }
    }
    return result;
}
function createSpecStreamCompiler(initial = {}) {
    let result = {
        ...initial
    };
    let buffer = "";
    const appliedPatches = [];
    const processedLines = /* @__PURE__ */ new Set();
    return {
        push (chunk) {
            buffer += chunk;
            const newPatches = [];
            const lines = buffer.split("\n");
            buffer = lines.pop() || "";
            for (const line of lines){
                const trimmed = line.trim();
                if (!trimmed || processedLines.has(trimmed)) continue;
                processedLines.add(trimmed);
                const patch = parseSpecStreamLine(trimmed);
                if (patch) {
                    applySpecStreamPatch(result, patch);
                    appliedPatches.push(patch);
                    newPatches.push(patch);
                }
            }
            if (newPatches.length > 0) {
                result = {
                    ...result
                };
            }
            return {
                result,
                newPatches
            };
        },
        getResult () {
            if (buffer.trim()) {
                const patch = parseSpecStreamLine(buffer);
                if (patch && !processedLines.has(buffer.trim())) {
                    processedLines.add(buffer.trim());
                    applySpecStreamPatch(result, patch);
                    appliedPatches.push(patch);
                    result = {
                        ...result
                    };
                }
                buffer = "";
            }
            return result;
        },
        getPatches () {
            return [
                ...appliedPatches
            ];
        },
        reset (newInitial = {}) {
            result = {
                ...newInitial
            };
            buffer = "";
            appliedPatches.length = 0;
            processedLines.clear();
        }
    };
}
;
var DynamicNumberValueSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].union([
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].number(),
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
        path: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string()
    })
]);
var LogicExpressionSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].lazy(()=>__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].union([
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
            and: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].array(LogicExpressionSchema)
        }),
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
            or: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].array(LogicExpressionSchema)
        }),
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
            not: LogicExpressionSchema
        }),
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
            path: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string()
        }),
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
            eq: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].tuple([
                DynamicValueSchema,
                DynamicValueSchema
            ])
        }),
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
            neq: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].tuple([
                DynamicValueSchema,
                DynamicValueSchema
            ])
        }),
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
            gt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].tuple([
                DynamicNumberValueSchema,
                DynamicNumberValueSchema
            ])
        }),
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
            gte: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].tuple([
                DynamicNumberValueSchema,
                DynamicNumberValueSchema
            ])
        }),
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
            lt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].tuple([
                DynamicNumberValueSchema,
                DynamicNumberValueSchema
            ])
        }),
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
            lte: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].tuple([
                DynamicNumberValueSchema,
                DynamicNumberValueSchema
            ])
        })
    ]));
var VisibilityConditionSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].union([
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].boolean(),
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
        path: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string()
    }),
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
        auth: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].enum([
            "signedIn",
            "signedOut"
        ])
    }),
    LogicExpressionSchema
]);
function evaluateLogicExpression(expr, ctx) {
    const { stateModel } = ctx;
    if ("and" in expr) {
        return expr.and.every((subExpr)=>evaluateLogicExpression(subExpr, ctx));
    }
    if ("or" in expr) {
        return expr.or.some((subExpr)=>evaluateLogicExpression(subExpr, ctx));
    }
    if ("not" in expr) {
        return !evaluateLogicExpression(expr.not, ctx);
    }
    if ("path" in expr) {
        const value = resolveDynamicValue({
            path: expr.path
        }, stateModel);
        return Boolean(value);
    }
    if ("eq" in expr) {
        const [left, right] = expr.eq;
        const leftValue = resolveDynamicValue(left, stateModel);
        const rightValue = resolveDynamicValue(right, stateModel);
        return leftValue === rightValue;
    }
    if ("neq" in expr) {
        const [left, right] = expr.neq;
        const leftValue = resolveDynamicValue(left, stateModel);
        const rightValue = resolveDynamicValue(right, stateModel);
        return leftValue !== rightValue;
    }
    if ("gt" in expr) {
        const [left, right] = expr.gt;
        const leftValue = resolveDynamicValue(left, stateModel);
        const rightValue = resolveDynamicValue(right, stateModel);
        if (typeof leftValue === "number" && typeof rightValue === "number") {
            return leftValue > rightValue;
        }
        return false;
    }
    if ("gte" in expr) {
        const [left, right] = expr.gte;
        const leftValue = resolveDynamicValue(left, stateModel);
        const rightValue = resolveDynamicValue(right, stateModel);
        if (typeof leftValue === "number" && typeof rightValue === "number") {
            return leftValue >= rightValue;
        }
        return false;
    }
    if ("lt" in expr) {
        const [left, right] = expr.lt;
        const leftValue = resolveDynamicValue(left, stateModel);
        const rightValue = resolveDynamicValue(right, stateModel);
        if (typeof leftValue === "number" && typeof rightValue === "number") {
            return leftValue < rightValue;
        }
        return false;
    }
    if ("lte" in expr) {
        const [left, right] = expr.lte;
        const leftValue = resolveDynamicValue(left, stateModel);
        const rightValue = resolveDynamicValue(right, stateModel);
        if (typeof leftValue === "number" && typeof rightValue === "number") {
            return leftValue <= rightValue;
        }
        return false;
    }
    return false;
}
function evaluateVisibility(condition, ctx) {
    if (condition === void 0) {
        return true;
    }
    if (typeof condition === "boolean") {
        return condition;
    }
    if ("path" in condition && !("and" in condition) && !("or" in condition)) {
        const value = resolveDynamicValue({
            path: condition.path
        }, ctx.stateModel);
        return Boolean(value);
    }
    if ("auth" in condition) {
        const isSignedIn = ctx.authState?.isSignedIn ?? false;
        if (condition.auth === "signedIn") {
            return isSignedIn;
        }
        if (condition.auth === "signedOut") {
            return !isSignedIn;
        }
        return false;
    }
    return evaluateLogicExpression(condition, ctx);
}
var visibility = {
    /** Always visible */ always: true,
    /** Never visible */ never: false,
    /** Visible when path is truthy */ when: (path)=>({
            path
        }),
    /** Visible when signed in */ signedIn: {
        auth: "signedIn"
    },
    /** Visible when signed out */ signedOut: {
        auth: "signedOut"
    },
    /** AND multiple conditions */ and: (...conditions)=>({
            and: conditions
        }),
    /** OR multiple conditions */ or: (...conditions)=>({
            or: conditions
        }),
    /** NOT a condition */ not: (condition)=>({
            not: condition
        }),
    /** Equality check */ eq: (left, right)=>({
            eq: [
                left,
                right
            ]
        }),
    /** Not equal check */ neq: (left, right)=>({
            neq: [
                left,
                right
            ]
        }),
    /** Greater than */ gt: (left, right)=>({
            gt: [
                left,
                right
            ]
        }),
    /** Greater than or equal */ gte: (left, right)=>({
            gte: [
                left,
                right
            ]
        }),
    /** Less than */ lt: (left, right)=>({
            lt: [
                left,
                right
            ]
        }),
    /** Less than or equal */ lte: (left, right)=>({
            lte: [
                left,
                right
            ]
        })
};
// src/props.ts
function isPathExpression(value) {
    return typeof value === "object" && value !== null && "$path" in value && typeof value.$path === "string";
}
function isCondExpression(value) {
    return typeof value === "object" && value !== null && "$cond" in value && "$then" in value && "$else" in value;
}
function resolvePropValue(value, ctx) {
    if (value === null || value === void 0) {
        return value;
    }
    if (isPathExpression(value)) {
        return getByPath(ctx.stateModel, value.$path);
    }
    if (isCondExpression(value)) {
        const result = evaluateVisibility(value.$cond, ctx);
        return resolvePropValue(result ? value.$then : value.$else, ctx);
    }
    if (Array.isArray(value)) {
        return value.map((item)=>resolvePropValue(item, ctx));
    }
    if (typeof value === "object") {
        const resolved = {};
        for (const [key, val] of Object.entries(value)){
            resolved[key] = resolvePropValue(val, ctx);
        }
        return resolved;
    }
    return value;
}
function resolveElementProps(props, ctx) {
    const resolved = {};
    for (const [key, value] of Object.entries(props)){
        resolved[key] = resolvePropValue(value, ctx);
    }
    return resolved;
}
;
var ActionConfirmSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
    title: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string(),
    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string(),
    confirmLabel: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string().optional(),
    cancelLabel: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string().optional(),
    variant: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].enum([
        "default",
        "danger"
    ]).optional()
});
var ActionOnSuccessSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].union([
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
        navigate: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string()
    }),
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
        set: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string(), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].unknown())
    }),
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
        action: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string()
    })
]);
var ActionOnErrorSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].union([
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
        set: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string(), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].unknown())
    }),
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
        action: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string()
    })
]);
var ActionBindingSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
    action: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string(),
    params: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string(), DynamicValueSchema).optional(),
    confirm: ActionConfirmSchema.optional(),
    onSuccess: ActionOnSuccessSchema.optional(),
    onError: ActionOnErrorSchema.optional()
});
var ActionSchema = ActionBindingSchema;
function resolveAction(binding, stateModel) {
    const resolvedParams = {};
    if (binding.params) {
        for (const [key, value] of Object.entries(binding.params)){
            resolvedParams[key] = resolveDynamicValue(value, stateModel);
        }
    }
    let confirm = binding.confirm;
    if (confirm) {
        confirm = {
            ...confirm,
            message: interpolateString(confirm.message, stateModel),
            title: interpolateString(confirm.title, stateModel)
        };
    }
    return {
        action: binding.action,
        params: resolvedParams,
        confirm,
        onSuccess: binding.onSuccess,
        onError: binding.onError
    };
}
function interpolateString(template, stateModel) {
    return template.replace(/\$\{([^}]+)\}/g, (_, path)=>{
        const value = resolveDynamicValue({
            path
        }, stateModel);
        return String(value ?? "");
    });
}
async function executeAction(ctx) {
    const { action: action2, handler, setState, navigate, executeAction: executeAction2 } = ctx;
    try {
        await handler(action2.params);
        if (action2.onSuccess) {
            if ("navigate" in action2.onSuccess && navigate) {
                navigate(action2.onSuccess.navigate);
            } else if ("set" in action2.onSuccess) {
                for (const [path, value] of Object.entries(action2.onSuccess.set)){
                    setState(path, value);
                }
            } else if ("action" in action2.onSuccess && executeAction2) {
                await executeAction2(action2.onSuccess.action);
            }
        }
    } catch (error) {
        if (action2.onError) {
            if ("set" in action2.onError) {
                for (const [path, value] of Object.entries(action2.onError.set)){
                    const resolvedValue = typeof value === "string" && value === "$error.message" ? error.message : value;
                    setState(path, resolvedValue);
                }
            } else if ("action" in action2.onError && executeAction2) {
                await executeAction2(action2.onError.action);
            }
        } else {
            throw error;
        }
    }
}
var actionBinding = {
    /** Create a simple action binding */ simple: (actionName, params)=>({
            action: actionName,
            params
        }),
    /** Create an action binding with confirmation */ withConfirm: (actionName, confirm, params)=>({
            action: actionName,
            params,
            confirm
        }),
    /** Create an action binding with success handler */ withSuccess: (actionName, onSuccess, params)=>({
            action: actionName,
            params,
            onSuccess
        })
};
var action = actionBinding;
;
var ValidationCheckSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
    fn: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string(),
    args: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string(), DynamicValueSchema).optional(),
    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string()
});
var ValidationConfigSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
    checks: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].array(ValidationCheckSchema).optional(),
    validateOn: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].enum([
        "change",
        "blur",
        "submit"
    ]).optional(),
    enabled: LogicExpressionSchema.optional()
});
var builtInValidationFunctions = {
    /**
   * Check if value is not null, undefined, or empty string
   */ required: (value)=>{
        if (value === null || value === void 0) return false;
        if (typeof value === "string") return value.trim().length > 0;
        if (Array.isArray(value)) return value.length > 0;
        return true;
    },
    /**
   * Check if value is a valid email address
   */ email: (value)=>{
        if (typeof value !== "string") return false;
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
    },
    /**
   * Check minimum string length
   */ minLength: (value, args)=>{
        if (typeof value !== "string") return false;
        const min = args?.min;
        if (typeof min !== "number") return false;
        return value.length >= min;
    },
    /**
   * Check maximum string length
   */ maxLength: (value, args)=>{
        if (typeof value !== "string") return false;
        const max = args?.max;
        if (typeof max !== "number") return false;
        return value.length <= max;
    },
    /**
   * Check if string matches a regex pattern
   */ pattern: (value, args)=>{
        if (typeof value !== "string") return false;
        const pattern = args?.pattern;
        if (typeof pattern !== "string") return false;
        try {
            return new RegExp(pattern).test(value);
        } catch  {
            return false;
        }
    },
    /**
   * Check minimum numeric value
   */ min: (value, args)=>{
        if (typeof value !== "number") return false;
        const min = args?.min;
        if (typeof min !== "number") return false;
        return value >= min;
    },
    /**
   * Check maximum numeric value
   */ max: (value, args)=>{
        if (typeof value !== "number") return false;
        const max = args?.max;
        if (typeof max !== "number") return false;
        return value <= max;
    },
    /**
   * Check if value is a number
   */ numeric: (value)=>{
        if (typeof value === "number") return !isNaN(value);
        if (typeof value === "string") return !isNaN(parseFloat(value));
        return false;
    },
    /**
   * Check if value is a valid URL
   */ url: (value)=>{
        if (typeof value !== "string") return false;
        try {
            new URL(value);
            return true;
        } catch  {
            return false;
        }
    },
    /**
   * Check if value matches another field
   */ matches: (value, args)=>{
        const other = args?.other;
        return value === other;
    }
};
function runValidationCheck(check2, ctx) {
    const { value, stateModel, customFunctions } = ctx;
    const resolvedArgs = {};
    if (check2.args) {
        for (const [key, argValue] of Object.entries(check2.args)){
            resolvedArgs[key] = resolveDynamicValue(argValue, stateModel);
        }
    }
    const fn = builtInValidationFunctions[check2.fn] ?? customFunctions?.[check2.fn];
    if (!fn) {
        console.warn(`Unknown validation function: ${check2.fn}`);
        return {
            fn: check2.fn,
            valid: true,
            // Don't fail on unknown functions
            message: check2.message
        };
    }
    const valid = fn(value, resolvedArgs);
    return {
        fn: check2.fn,
        valid,
        message: check2.message
    };
}
function runValidation(config, ctx) {
    const checks = [];
    const errors = [];
    if (config.enabled) {
        const enabled = evaluateLogicExpression(config.enabled, {
            stateModel: ctx.stateModel,
            authState: ctx.authState
        });
        if (!enabled) {
            return {
                valid: true,
                errors: [],
                checks: []
            };
        }
    }
    if (config.checks) {
        for (const check2 of config.checks){
            const result = runValidationCheck(check2, ctx);
            checks.push(result);
            if (!result.valid) {
                errors.push(result.message);
            }
        }
    }
    return {
        valid: errors.length === 0,
        errors,
        checks
    };
}
var check = {
    required: (message = "This field is required")=>({
            fn: "required",
            message
        }),
    email: (message = "Invalid email address")=>({
            fn: "email",
            message
        }),
    minLength: (min, message)=>({
            fn: "minLength",
            args: {
                min
            },
            message: message ?? `Must be at least ${min} characters`
        }),
    maxLength: (max, message)=>({
            fn: "maxLength",
            args: {
                max
            },
            message: message ?? `Must be at most ${max} characters`
        }),
    pattern: (pattern, message = "Invalid format")=>({
            fn: "pattern",
            args: {
                pattern
            },
            message
        }),
    min: (min, message)=>({
            fn: "min",
            args: {
                min
            },
            message: message ?? `Must be at least ${min}`
        }),
    max: (max, message)=>({
            fn: "max",
            args: {
                max
            },
            message: message ?? `Must be at most ${max}`
        }),
    url: (message = "Invalid URL")=>({
            fn: "url",
            message
        }),
    matches: (otherPath, message = "Fields must match")=>({
            fn: "matches",
            args: {
                other: {
                    path: otherPath
                }
            },
            message
        })
};
// src/spec-validator.ts
function validateSpec(spec, options = {}) {
    const { checkOrphans = false } = options;
    const issues = [];
    if (!spec.root) {
        issues.push({
            severity: "error",
            message: "Spec has no root element defined.",
            code: "missing_root"
        });
        return {
            valid: false,
            issues
        };
    }
    if (!spec.elements[spec.root]) {
        issues.push({
            severity: "error",
            message: `Root element "${spec.root}" not found in elements map.`,
            code: "root_not_found"
        });
    }
    if (Object.keys(spec.elements).length === 0) {
        issues.push({
            severity: "error",
            message: "Spec has no elements.",
            code: "empty_spec"
        });
        return {
            valid: false,
            issues
        };
    }
    for (const [key, element] of Object.entries(spec.elements)){
        if (element.children) {
            for (const childKey of element.children){
                if (!spec.elements[childKey]) {
                    issues.push({
                        severity: "error",
                        message: `Element "${key}" references child "${childKey}" which does not exist in the elements map.`,
                        elementKey: key,
                        code: "missing_child"
                    });
                }
            }
        }
        const props = element.props;
        if (props && "visible" in props && props.visible !== void 0) {
            issues.push({
                severity: "error",
                message: `Element "${key}" has "visible" inside "props". It should be a top-level field on the element (sibling of type/props/children).`,
                elementKey: key,
                code: "visible_in_props"
            });
        }
        if (props && "on" in props && props.on !== void 0) {
            issues.push({
                severity: "error",
                message: `Element "${key}" has "on" inside "props". It should be a top-level field on the element (sibling of type/props/children).`,
                elementKey: key,
                code: "on_in_props"
            });
        }
        if (props && "repeat" in props && props.repeat !== void 0) {
            issues.push({
                severity: "error",
                message: `Element "${key}" has "repeat" inside "props". It should be a top-level field on the element (sibling of type/props/children).`,
                elementKey: key,
                code: "repeat_in_props"
            });
        }
    }
    if (checkOrphans) {
        const reachable = /* @__PURE__ */ new Set();
        const walk = (key)=>{
            if (reachable.has(key)) return;
            reachable.add(key);
            const el = spec.elements[key];
            if (el?.children) {
                for (const childKey of el.children){
                    if (spec.elements[childKey]) {
                        walk(childKey);
                    }
                }
            }
        };
        if (spec.elements[spec.root]) {
            walk(spec.root);
        }
        for (const key of Object.keys(spec.elements)){
            if (!reachable.has(key)) {
                issues.push({
                    severity: "warning",
                    message: `Element "${key}" is not reachable from root "${spec.root}".`,
                    elementKey: key,
                    code: "orphaned_element"
                });
            }
        }
    }
    const hasErrors = issues.some((i)=>i.severity === "error");
    return {
        valid: !hasErrors,
        issues
    };
}
function autoFixSpec(spec) {
    const fixes = [];
    const fixedElements = {};
    for (const [key, element] of Object.entries(spec.elements)){
        const props = element.props;
        let fixed = element;
        if (props && "visible" in props && props.visible !== void 0) {
            const { visible, ...restProps } = fixed.props;
            fixed = {
                ...fixed,
                props: restProps,
                visible
            };
            fixes.push(`Moved "visible" from props to element level on "${key}".`);
        }
        let currentProps = fixed.props;
        if (currentProps && "on" in currentProps && currentProps.on !== void 0) {
            const { on, ...restProps } = currentProps;
            fixed = {
                ...fixed,
                props: restProps,
                on
            };
            fixes.push(`Moved "on" from props to element level on "${key}".`);
        }
        currentProps = fixed.props;
        if (currentProps && "repeat" in currentProps && currentProps.repeat !== void 0) {
            const { repeat, ...restProps } = currentProps;
            fixed = {
                ...fixed,
                props: restProps,
                repeat
            };
            fixes.push(`Moved "repeat" from props to element level on "${key}".`);
        }
        fixedElements[key] = fixed;
    }
    return {
        spec: {
            root: spec.root,
            elements: fixedElements
        },
        fixes
    };
}
function formatSpecIssues(issues) {
    const errors = issues.filter((i)=>i.severity === "error");
    if (errors.length === 0) return "";
    const lines = [
        "The generated UI spec has the following errors:"
    ];
    for (const issue of errors){
        lines.push(`- ${issue.message}`);
    }
    return lines.join("\n");
}
;
function createBuilder() {
    return {
        string: ()=>({
                kind: "string"
            }),
        number: ()=>({
                kind: "number"
            }),
        boolean: ()=>({
                kind: "boolean"
            }),
        array: (item)=>({
                kind: "array",
                inner: item
            }),
        object: (shape)=>({
                kind: "object",
                inner: shape
            }),
        record: (value)=>({
                kind: "record",
                inner: value
            }),
        any: ()=>({
                kind: "any"
            }),
        zod: ()=>({
                kind: "zod"
            }),
        ref: (path)=>({
                kind: "ref",
                inner: path
            }),
        propsOf: (path)=>({
                kind: "propsOf",
                inner: path
            }),
        map: (entryShape)=>({
                kind: "map",
                inner: entryShape
            }),
        optional: ()=>({
                optional: true
            })
    };
}
function defineSchema(builder, options) {
    const s = createBuilder();
    const definition = builder(s);
    return {
        definition,
        promptTemplate: options?.promptTemplate,
        defaultRules: options?.defaultRules,
        createCatalog (catalog) {
            return createCatalogFromSchema(this, catalog);
        }
    };
}
function createCatalogFromSchema(schema, catalogData) {
    const components = catalogData.components;
    const actions = catalogData.actions;
    const componentNames = components ? Object.keys(components) : [];
    const actionNames = actions ? Object.keys(actions) : [];
    const zodSchema = buildZodSchemaFromDefinition(schema.definition, catalogData);
    return {
        schema,
        data: catalogData,
        componentNames,
        actionNames,
        prompt (options = {}) {
            return generatePrompt(this, options);
        },
        jsonSchema () {
            return zodToJsonSchema(zodSchema);
        },
        validate (spec) {
            const result = zodSchema.safeParse(spec);
            if (result.success) {
                return {
                    success: true,
                    data: result.data
                };
            }
            return {
                success: false,
                error: result.error
            };
        },
        zodSchema () {
            return zodSchema;
        },
        get _specType () {
            throw new Error("_specType is only for type inference");
        }
    };
}
function buildZodSchemaFromDefinition(definition, catalogData) {
    return buildZodType(definition.spec, catalogData);
}
function buildZodType(schemaType, catalogData) {
    switch(schemaType.kind){
        case "string":
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string();
        case "number":
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].number();
        case "boolean":
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].boolean();
        case "any":
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].any();
        case "array":
            {
                const inner = buildZodType(schemaType.inner, catalogData);
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].array(inner);
            }
        case "object":
            {
                const shape = schemaType.inner;
                const zodShape = {};
                for (const [key, value] of Object.entries(shape)){
                    let zodType = buildZodType(value, catalogData);
                    if (value.optional) {
                        zodType = zodType.optional();
                    }
                    zodShape[key] = zodType;
                }
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object(zodShape);
            }
        case "record":
            {
                const inner = buildZodType(schemaType.inner, catalogData);
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string(), inner);
            }
        case "ref":
            {
                const path = schemaType.inner;
                const keys = getKeysFromPath(path, catalogData);
                if (keys.length === 0) {
                    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string();
                }
                if (keys.length === 1) {
                    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].literal(keys[0]);
                }
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].enum(keys);
            }
        case "propsOf":
            {
                const path = schemaType.inner;
                const propsSchemas = getPropsFromPath(path, catalogData);
                if (propsSchemas.length === 0) {
                    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string(), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].unknown());
                }
                if (propsSchemas.length === 1) {
                    return propsSchemas[0];
                }
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string(), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].unknown());
            }
        default:
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].unknown();
    }
}
function getKeysFromPath(path, catalogData) {
    const parts = path.split(".");
    let current = {
        catalog: catalogData
    };
    for (const part of parts){
        if (current && typeof current === "object") {
            current = current[part];
        } else {
            return [];
        }
    }
    if (current && typeof current === "object") {
        return Object.keys(current);
    }
    return [];
}
function getPropsFromPath(path, catalogData) {
    const parts = path.split(".");
    let current = {
        catalog: catalogData
    };
    for (const part of parts){
        if (current && typeof current === "object") {
            current = current[part];
        } else {
            return [];
        }
    }
    if (current && typeof current === "object") {
        return Object.values(current).map((entry)=>entry.props).filter((props)=>props !== void 0);
    }
    return [];
}
function generatePrompt(catalog, options) {
    if (catalog.schema.promptTemplate) {
        const context = {
            catalog: catalog.data,
            componentNames: catalog.componentNames,
            actionNames: catalog.actionNames,
            options,
            formatZodType
        };
        return catalog.schema.promptTemplate(context);
    }
    const { system = "You are a UI generator that outputs JSON.", customRules = [] } = options;
    const lines = [];
    lines.push(system);
    lines.push("");
    lines.push("OUTPUT FORMAT (JSONL, RFC 6902 JSON Patch):");
    lines.push("Output JSONL (one JSON object per line) using RFC 6902 JSON Patch operations to build a UI tree.");
    lines.push("Each line is a JSON patch operation (add, remove, replace). Start with /root, then stream /elements and /state patches interleaved so the UI fills in progressively as it streams.");
    lines.push("");
    lines.push("Example output (each line is a separate JSON object):");
    lines.push("");
    const allComponents = catalog.data.components;
    const cn = catalog.componentNames;
    const comp1 = cn[0] || "Component";
    const comp2 = cn.length > 1 ? cn[1] : comp1;
    const comp1Def = allComponents?.[comp1];
    const comp2Def = allComponents?.[comp2];
    const comp1Props = comp1Def ? getExampleProps(comp1Def) : {};
    const comp2Props = comp2Def ? getExampleProps(comp2Def) : {};
    const dynamicPropName = comp2Def?.props ? findFirstStringProp(comp2Def.props) : null;
    const dynamicProps = dynamicPropName ? {
        ...comp2Props,
        [dynamicPropName]: {
            $path: "$item/title"
        }
    } : comp2Props;
    const exampleOutput = [
        JSON.stringify({
            op: "add",
            path: "/root",
            value: "main"
        }),
        JSON.stringify({
            op: "add",
            path: "/elements/main",
            value: {
                type: comp1,
                props: comp1Props,
                children: [
                    "child-1",
                    "list"
                ]
            }
        }),
        JSON.stringify({
            op: "add",
            path: "/elements/child-1",
            value: {
                type: comp2,
                props: comp2Props,
                children: []
            }
        }),
        JSON.stringify({
            op: "add",
            path: "/elements/list",
            value: {
                type: comp1,
                props: comp1Props,
                repeat: {
                    path: "/items",
                    key: "id"
                },
                children: [
                    "item"
                ]
            }
        }),
        JSON.stringify({
            op: "add",
            path: "/elements/item",
            value: {
                type: comp2,
                props: dynamicProps,
                children: []
            }
        }),
        JSON.stringify({
            op: "add",
            path: "/state/items",
            value: []
        }),
        JSON.stringify({
            op: "add",
            path: "/state/items/0",
            value: {
                id: "1",
                title: "First Item"
            }
        }),
        JSON.stringify({
            op: "add",
            path: "/state/items/1",
            value: {
                id: "2",
                title: "Second Item"
            }
        })
    ].join("\n");
    lines.push(`${exampleOutput}

Note: state patches appear right after the elements that use them, so the UI fills in as it streams. ONLY use component types from the AVAILABLE COMPONENTS list below.`);
    lines.push("");
    lines.push("INITIAL STATE:");
    lines.push("Specs include a /state field to seed the state model. Components with statePath read from and write to this state, and $path expressions read from it.");
    lines.push("CRITICAL: You MUST include state patches whenever your UI displays data via $path expressions, uses repeat to iterate over arrays, or uses statePath bindings. Without state, $path references resolve to nothing and repeat lists render zero items.");
    lines.push("Output state patches right after the elements that reference them, so the UI fills in progressively as it streams.");
    lines.push("Stream state progressively - output one patch per array item instead of one giant blob:");
    lines.push('  For arrays: {"op":"add","path":"/state/posts/0","value":{"id":"1","title":"First Post",...}} then /state/posts/1, /state/posts/2, etc.');
    lines.push('  For scalars: {"op":"add","path":"/state/newTodoText","value":""}');
    lines.push('  Initialize the array first if needed: {"op":"add","path":"/state/posts","value":[]}');
    lines.push('When content comes from the state model, use { "$path": "/some/path" } dynamic props to display it instead of hardcoding the same value in both state and props. The state model is the single source of truth.');
    lines.push("Include realistic sample data in state. For blogs: 3-4 posts with titles, excerpts, authors, dates. For product lists: 3-5 items with names, prices, descriptions. Never leave arrays empty.");
    lines.push("");
    lines.push("DYNAMIC LISTS (repeat field):");
    lines.push('Any element can have a top-level "repeat" field to render its children once per item in a state array: { "repeat": { "path": "/arrayPath", "key": "id" } }.');
    lines.push('The element itself renders once (as the container), and its children are expanded once per array item. "path" is the state array path. "key" is an optional field name on each item for stable React keys.');
    lines.push(`Example: ${JSON.stringify({
        type: comp1,
        props: comp1Props,
        repeat: {
            path: "/todos",
            key: "id"
        },
        children: [
            "todo-item"
        ]
    })}`);
    lines.push('Inside children of a repeated element, use "$item/field" for per-item paths: statePath:"$item/completed", { "$path": "$item/title" }. Use "$index" for the current array index.');
    lines.push("ALWAYS use the repeat field for lists backed by state arrays. NEVER hardcode individual elements for each array item.");
    lines.push('IMPORTANT: "repeat" is a top-level field on the element (sibling of type/props/children), NOT inside props.');
    lines.push("");
    lines.push("ARRAY STATE ACTIONS:");
    lines.push('Use action "pushState" to append items to arrays. Params: { path: "/arrayPath", value: { ...item }, clearPath: "/inputPath" }.');
    lines.push('Values inside pushState can contain { "path": "/statePath" } references to read current state (e.g. the text from an input field).');
    lines.push('Use "$id" inside a pushState value to auto-generate a unique ID.');
    lines.push('Example: on: { "press": { "action": "pushState", "params": { "path": "/todos", "value": { "id": "$id", "title": { "path": "/newTodoText" }, "completed": false }, "clearPath": "/newTodoText" } } }');
    lines.push(`Use action "removeState" to remove items from arrays by index. Params: { path: "/arrayPath", index: N }. Inside a repeated element's children, use "$index" for the current item index.`);
    lines.push("For lists where users can add/remove items (todos, carts, etc.), use pushState and removeState instead of hardcoding with setState.");
    lines.push("");
    lines.push('IMPORTANT: State paths use RFC 6901 JSON Pointer syntax (e.g. "/todos/0/title"). Do NOT use JavaScript-style dot notation (e.g. "/todos.length" is WRONG). To generate unique IDs for new items, use "$id" instead of trying to read array length.');
    lines.push("");
    const components = allComponents;
    if (components) {
        lines.push(`AVAILABLE COMPONENTS (${catalog.componentNames.length}):`);
        lines.push("");
        for (const [name, def] of Object.entries(components)){
            const propsStr = def.props ? formatZodType(def.props) : "{}";
            const hasChildren = def.slots && def.slots.length > 0;
            const childrenStr = hasChildren ? " [accepts children]" : "";
            const eventsStr = def.events && def.events.length > 0 ? ` [events: ${def.events.join(", ")}]` : "";
            const descStr = def.description ? ` - ${def.description}` : "";
            lines.push(`- ${name}: ${propsStr}${descStr}${childrenStr}${eventsStr}`);
        }
        lines.push("");
    }
    const actions = catalog.data.actions;
    if (actions && catalog.actionNames.length > 0) {
        lines.push("AVAILABLE ACTIONS:");
        lines.push("");
        for (const [name, def] of Object.entries(actions)){
            lines.push(`- ${name}${def.description ? `: ${def.description}` : ""}`);
        }
        lines.push("");
    }
    lines.push("EVENTS (the `on` field):");
    lines.push("Elements can have an optional `on` field to bind events to actions. The `on` field is a top-level field on the element (sibling of type/props/children), NOT inside props.");
    lines.push('Each key in `on` is an event name (from the component\'s supported events), and the value is an action binding: `{ "action": "<actionName>", "params": { ... } }`.');
    lines.push("");
    lines.push("Example:");
    lines.push(`  ${JSON.stringify({
        type: comp1,
        props: comp1Props,
        on: {
            press: {
                action: "setState",
                params: {
                    path: "/saved",
                    value: true
                }
            }
        },
        children: []
    })}`);
    lines.push("");
    lines.push('Action params can use dynamic path references to read from state: { "path": "/statePath" }.');
    lines.push("IMPORTANT: Do NOT put action/actionParams inside props. Always use the `on` field for event bindings.");
    lines.push("");
    lines.push("VISIBILITY CONDITIONS:");
    lines.push("Elements can have an optional `visible` field to conditionally show/hide based on data state. IMPORTANT: `visible` is a top-level field on the element object (sibling of type/props/children), NOT inside props.");
    lines.push(`Correct: ${JSON.stringify({
        type: comp1,
        props: comp1Props,
        visible: {
            eq: [
                {
                    path: "/tab"
                },
                "home"
            ]
        },
        children: [
            "..."
        ]
    })}`);
    lines.push('- `{ "eq": [{ "path": "/statePath" }, "value"] }` - visible when state at path equals value');
    lines.push('- `{ "neq": [{ "path": "/statePath" }, "value"] }` - visible when state at path does not equal value');
    lines.push('- `{ "path": "/statePath" }` - visible when path is truthy');
    lines.push('- `{ "and": [...] }`, `{ "or": [...] }`, `{ "not": {...} }` - combine conditions');
    lines.push("- `true` / `false` - always visible/hidden");
    lines.push("");
    lines.push("Use a component with on.press bound to setState to update state and drive visibility.");
    lines.push(`Example: A ${comp1} with on: { "press": { "action": "setState", "params": { "path": "/activeTab", "value": "home" } } } sets state, then a container with visible: { "eq": [{ "path": "/activeTab" }, "home"] } shows only when that tab is active.`);
    lines.push("");
    lines.push("DYNAMIC PROPS:");
    lines.push("Any prop value can be a dynamic expression that resolves based on state. Two forms are supported:");
    lines.push("");
    lines.push('1. State binding: `{ "$path": "/statePath" }` - resolves to the value at that state path.');
    lines.push('   Example: `"color": { "$path": "/theme/primary" }` reads the color from state.');
    lines.push("");
    lines.push('2. Conditional: `{ "$cond": <condition>, "$then": <value>, "$else": <value> }` - evaluates the condition (same syntax as visibility conditions) and picks the matching value.');
    lines.push('   Example: `"color": { "$cond": { "eq": [{ "path": "/activeTab" }, "home"] }, "$then": "#007AFF", "$else": "#8E8E93" }`');
    lines.push('   Example: `"name": { "$cond": { "eq": [{ "path": "/activeTab" }, "home"] }, "$then": "home", "$else": "home-outline" }`');
    lines.push("");
    lines.push("Use dynamic props instead of duplicating elements with opposing visible conditions when only prop values differ.");
    lines.push("");
    lines.push("RULES:");
    const baseRules = [
        "Output ONLY JSONL patches - one JSON object per line, no markdown, no code fences",
        'First set root: {"op":"add","path":"/root","value":"<root-key>"}',
        'Then add each element: {"op":"add","path":"/elements/<key>","value":{...}}',
        "Output /state patches right after the elements that use them, one per array item for progressive loading. REQUIRED whenever using $path, repeat, or statePath.",
        "ONLY use components listed above",
        "Each element value needs: type, props, children (array of child keys)",
        "Use unique keys for the element map entries (e.g., 'header', 'metric-1', 'chart-revenue')"
    ];
    const schemaRules = catalog.schema.defaultRules ?? [];
    const allRules = [
        ...baseRules,
        ...schemaRules,
        ...customRules
    ];
    allRules.forEach((rule, i)=>{
        lines.push(`${i + 1}. ${rule}`);
    });
    return lines.join("\n");
}
function getExampleProps(def) {
    if (def.example && Object.keys(def.example).length > 0) {
        return def.example;
    }
    if (def.props) {
        return generateExamplePropsFromZod(def.props);
    }
    return {};
}
function generateExamplePropsFromZod(schema) {
    if (!schema || !schema._def) return {};
    const def = schema._def;
    const typeName = getZodTypeName(schema);
    if (typeName !== "ZodObject" && typeName !== "object") return {};
    const shape = typeof def.shape === "function" ? def.shape() : def.shape;
    if (!shape) return {};
    const result = {};
    for (const [key, value] of Object.entries(shape)){
        const innerTypeName = getZodTypeName(value);
        if (innerTypeName === "ZodOptional" || innerTypeName === "optional" || innerTypeName === "ZodNullable" || innerTypeName === "nullable") {
            continue;
        }
        result[key] = generateExampleValue(value);
    }
    return result;
}
function generateExampleValue(schema) {
    if (!schema || !schema._def) return "...";
    const def = schema._def;
    const typeName = getZodTypeName(schema);
    switch(typeName){
        case "ZodString":
        case "string":
            return "example";
        case "ZodNumber":
        case "number":
            return 0;
        case "ZodBoolean":
        case "boolean":
            return true;
        case "ZodLiteral":
        case "literal":
            return def.value;
        case "ZodEnum":
        case "enum":
            {
                if (Array.isArray(def.values) && def.values.length > 0) return def.values[0];
                if (def.entries && typeof def.entries === "object") {
                    const values = Object.values(def.entries);
                    return values.length > 0 ? values[0] : "example";
                }
                return "example";
            }
        case "ZodOptional":
        case "optional":
        case "ZodNullable":
        case "nullable":
        case "ZodDefault":
        case "default":
            {
                const inner = def.innerType ?? def.wrapped;
                return inner ? generateExampleValue(inner) : null;
            }
        case "ZodArray":
        case "array":
            return [];
        case "ZodObject":
        case "object":
            return generateExamplePropsFromZod(schema);
        case "ZodUnion":
        case "union":
            {
                const options = def.options;
                return options && options.length > 0 ? generateExampleValue(options[0]) : "...";
            }
        default:
            return "...";
    }
}
function findFirstStringProp(schema) {
    if (!schema || !schema._def) return null;
    const def = schema._def;
    const typeName = getZodTypeName(schema);
    if (typeName !== "ZodObject" && typeName !== "object") return null;
    const shape = typeof def.shape === "function" ? def.shape() : def.shape;
    if (!shape) return null;
    for (const [key, value] of Object.entries(shape)){
        const innerTypeName = getZodTypeName(value);
        if (innerTypeName === "ZodOptional" || innerTypeName === "optional" || innerTypeName === "ZodNullable" || innerTypeName === "nullable") {
            continue;
        }
        if (innerTypeName === "ZodString" || innerTypeName === "string") {
            return key;
        }
    }
    return null;
}
function getZodTypeName(schema) {
    if (!schema || !schema._def) return "";
    const def = schema._def;
    return def.typeName ?? def.type ?? "";
}
function formatZodType(schema) {
    if (!schema || !schema._def) return "unknown";
    const def = schema._def;
    const typeName = getZodTypeName(schema);
    switch(typeName){
        case "ZodString":
        case "string":
            return "string";
        case "ZodNumber":
        case "number":
            return "number";
        case "ZodBoolean":
        case "boolean":
            return "boolean";
        case "ZodLiteral":
        case "literal":
            return JSON.stringify(def.value);
        case "ZodEnum":
        case "enum":
            {
                let values;
                if (Array.isArray(def.values)) {
                    values = def.values;
                } else if (def.entries && typeof def.entries === "object") {
                    values = Object.values(def.entries);
                } else {
                    return "enum";
                }
                return values.map((v)=>`"${v}"`).join(" | ");
            }
        case "ZodArray":
        case "array":
            {
                const inner = def.type ?? def.element;
                return inner ? `Array<${formatZodType(inner)}>` : "Array<unknown>";
            }
        case "ZodObject":
        case "object":
            {
                const shape = typeof def.shape === "function" ? def.shape() : def.shape;
                if (!shape) return "object";
                const props = Object.entries(shape).map(([key, value])=>{
                    const innerTypeName = getZodTypeName(value);
                    const isOptional = innerTypeName === "ZodOptional" || innerTypeName === "ZodNullable" || innerTypeName === "optional" || innerTypeName === "nullable";
                    return `${key}${isOptional ? "?" : ""}: ${formatZodType(value)}`;
                }).join(", ");
                return `{ ${props} }`;
            }
        case "ZodOptional":
        case "optional":
        case "ZodNullable":
        case "nullable":
            {
                const inner = def.innerType ?? def.wrapped;
                return inner ? formatZodType(inner) : "unknown";
            }
        case "ZodUnion":
        case "union":
            {
                const options = def.options;
                return options ? options.map((opt)=>formatZodType(opt)).join(" | ") : "unknown";
            }
        default:
            return "unknown";
    }
}
function zodToJsonSchema(schema) {
    const def = schema._def;
    const typeName = def.typeName ?? "";
    switch(typeName){
        case "ZodString":
            return {
                type: "string"
            };
        case "ZodNumber":
            return {
                type: "number"
            };
        case "ZodBoolean":
            return {
                type: "boolean"
            };
        case "ZodLiteral":
            return {
                const: def.value
            };
        case "ZodEnum":
            return {
                enum: def.values
            };
        case "ZodArray":
            {
                const inner = def.type;
                return {
                    type: "array",
                    items: inner ? zodToJsonSchema(inner) : {}
                };
            }
        case "ZodObject":
            {
                const shape = def.shape?.();
                if (!shape) return {
                    type: "object"
                };
                const properties = {};
                const required = [];
                for (const [key, value] of Object.entries(shape)){
                    properties[key] = zodToJsonSchema(value);
                    const innerDef = value._def;
                    if (innerDef.typeName !== "ZodOptional" && innerDef.typeName !== "ZodNullable") {
                        required.push(key);
                    }
                }
                return {
                    type: "object",
                    properties,
                    required: required.length > 0 ? required : void 0,
                    additionalProperties: false
                };
            }
        case "ZodRecord":
            {
                const valueType = def.valueType;
                return {
                    type: "object",
                    additionalProperties: valueType ? zodToJsonSchema(valueType) : true
                };
            }
        case "ZodOptional":
        case "ZodNullable":
            {
                const inner = def.innerType;
                return inner ? zodToJsonSchema(inner) : {};
            }
        case "ZodUnion":
            {
                const options = def.options;
                return options ? {
                    anyOf: options.map(zodToJsonSchema)
                } : {};
            }
        case "ZodAny":
            return {};
        default:
            return {};
    }
}
function defineCatalog(schema, catalog) {
    return schema.createCatalog(catalog);
}
// src/prompt.ts
function isNonEmptySpec(spec) {
    if (!spec || typeof spec !== "object") return false;
    const s = spec;
    return typeof s.root === "string" && typeof s.elements === "object" && s.elements !== null && Object.keys(s.elements).length > 0;
}
var PATCH_INSTRUCTIONS = `IMPORTANT: The current UI is already loaded. Output ONLY the patches needed to make the requested change:
- To add a new element: {"op":"add","path":"/elements/new-key","value":{...}}
- To modify an existing element: {"op":"replace","path":"/elements/existing-key","value":{...}}
- To remove an element: {"op":"remove","path":"/elements/old-key"}
- To update the root: {"op":"replace","path":"/root","value":"new-root-key"}
- To add children: update the parent element with new children array

DO NOT output patches for elements that don't need to change. Only output what's necessary for the requested modification.`;
function buildUserPrompt(options) {
    const { prompt, currentSpec, state, maxPromptLength } = options;
    let userText = String(prompt || "");
    if (maxPromptLength !== void 0 && maxPromptLength > 0) {
        userText = userText.slice(0, maxPromptLength);
    }
    if (isNonEmptySpec(currentSpec)) {
        const parts2 = [];
        parts2.push(`CURRENT UI STATE (already loaded, DO NOT recreate existing elements):`);
        parts2.push(JSON.stringify(currentSpec, null, 2));
        parts2.push("");
        parts2.push(`USER REQUEST: ${userText}`);
        if (state && Object.keys(state).length > 0) {
            parts2.push("");
            parts2.push(`AVAILABLE STATE:
${JSON.stringify(state, null, 2)}`);
        }
        parts2.push("");
        parts2.push(PATCH_INSTRUCTIONS);
        return parts2.join("\n");
    }
    const parts = [
        userText
    ];
    if (state && Object.keys(state).length > 0) {
        parts.push(`
AVAILABLE STATE:
${JSON.stringify(state, null, 2)}`);
    }
    parts.push(`
Remember: Output /root first, then interleave /elements and /state patches so the UI fills in progressively as it streams. Output each state patch right after the elements that use it, one per array item.`);
    return parts.join("\n");
}
;
function createCatalog(config) {
    const { name = "unnamed", components, actions = {}, functions = {}, validation = "strict" } = config;
    const componentNames = Object.keys(components);
    const actionNames = Object.keys(actions);
    const functionNames = Object.keys(functions);
    const componentSchemas = componentNames.map((componentName)=>{
        const def = components[componentName];
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
            type: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].literal(componentName),
            props: def.props,
            children: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].array(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string()).optional(),
            visible: VisibilityConditionSchema.optional()
        });
    });
    let elementSchema;
    if (componentSchemas.length === 0) {
        elementSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
            type: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string(),
            props: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string(), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].unknown()),
            children: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].array(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string()).optional(),
            visible: VisibilityConditionSchema.optional()
        });
    } else if (componentSchemas.length === 1) {
        elementSchema = componentSchemas[0];
    } else {
        elementSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].discriminatedUnion("type", [
            componentSchemas[0],
            componentSchemas[1],
            ...componentSchemas.slice(2)
        ]);
    }
    const specSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
        root: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string(),
        elements: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$4$2e$3$2e$6$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string(), elementSchema)
    });
    return {
        name,
        componentNames,
        actionNames,
        functionNames,
        validation,
        components,
        actions,
        functions,
        elementSchema,
        specSchema,
        hasComponent (type) {
            return type in components;
        },
        hasAction (name2) {
            return name2 in actions;
        },
        hasFunction (name2) {
            return name2 in functions;
        },
        validateElement (element) {
            const result = elementSchema.safeParse(element);
            if (result.success) {
                return {
                    success: true,
                    data: result.data
                };
            }
            return {
                success: false,
                error: result.error
            };
        },
        validateSpec (spec) {
            const result = specSchema.safeParse(spec);
            if (result.success) {
                return {
                    success: true,
                    data: result.data
                };
            }
            return {
                success: false,
                error: result.error
            };
        }
    };
}
function generateCatalogPrompt(catalog) {
    const lines = [
        `# ${catalog.name} Component Catalog`,
        "",
        "## Available Components",
        ""
    ];
    for (const name of catalog.componentNames){
        const def = catalog.components[name];
        lines.push(`### ${String(name)}`);
        if (def.description) {
            lines.push(def.description);
        }
        lines.push("");
    }
    if (catalog.actionNames.length > 0) {
        lines.push("## Available Actions");
        lines.push("");
        for (const name of catalog.actionNames){
            const def = catalog.actions[name];
            lines.push(`- \`${String(name)}\`${def.description ? `: ${def.description}` : ""}`);
        }
        lines.push("");
    }
    lines.push("## Visibility Conditions");
    lines.push("");
    lines.push("Components can have a `visible` property:");
    lines.push("- `true` / `false` - Always visible/hidden");
    lines.push('- `{ "path": "/state/path" }` - Visible when path is truthy');
    lines.push('- `{ "auth": "signedIn" }` - Visible when user is signed in');
    lines.push('- `{ "and": [...] }` - All conditions must be true');
    lines.push('- `{ "or": [...] }` - Any condition must be true');
    lines.push('- `{ "not": {...} }` - Negates a condition');
    lines.push('- `{ "eq": [a, b] }` - Equality check');
    lines.push("");
    lines.push("## Validation Functions");
    lines.push("");
    lines.push("Built-in: `required`, `email`, `minLength`, `maxLength`, `pattern`, `min`, `max`, `url`");
    if (catalog.functionNames.length > 0) {
        lines.push(`Custom: ${catalog.functionNames.map(String).join(", ")}`);
    }
    lines.push("");
    return lines.join("\n");
}
function formatZodType2(schema, isOptional = false) {
    const def = schema._def;
    const typeName = def.typeName ?? "";
    let result;
    switch(typeName){
        case "ZodString":
            result = "string";
            break;
        case "ZodNumber":
            result = "number";
            break;
        case "ZodBoolean":
            result = "boolean";
            break;
        case "ZodLiteral":
            result = JSON.stringify(def.value);
            break;
        case "ZodEnum":
            result = def.values.map((v)=>`"${v}"`).join("|");
            break;
        case "ZodNativeEnum":
            result = Object.values(def.values).map((v)=>`"${v}"`).join("|");
            break;
        case "ZodArray":
            result = def.type ? `Array<${formatZodType2(def.type)}>` : "Array<unknown>";
            break;
        case "ZodObject":
            {
                if (!def.shape) {
                    result = "object";
                    break;
                }
                const shape = def.shape();
                const props = Object.entries(shape).map(([key, value])=>{
                    const innerDef = value._def;
                    const innerOptional = innerDef.typeName === "ZodOptional" || innerDef.typeName === "ZodNullable";
                    return `${key}${innerOptional ? "?" : ""}: ${formatZodType2(value)}`;
                }).join(", ");
                result = `{ ${props} }`;
                break;
            }
        case "ZodOptional":
            return def.innerType ? formatZodType2(def.innerType, true) : "unknown?";
        case "ZodNullable":
            return def.innerType ? formatZodType2(def.innerType, true) : "unknown?";
        case "ZodDefault":
            return def.innerType ? formatZodType2(def.innerType, isOptional) : "unknown";
        case "ZodUnion":
            result = def.options ? def.options.map((opt)=>formatZodType2(opt)).join("|") : "unknown";
            break;
        case "ZodNull":
            result = "null";
            break;
        case "ZodUndefined":
            result = "undefined";
            break;
        case "ZodAny":
            result = "any";
            break;
        case "ZodUnknown":
            result = "unknown";
            break;
        default:
            result = "unknown";
    }
    return isOptional ? `${result}?` : result;
}
function extractPropsFromSchema(schema) {
    const def = schema._def;
    const typeName = def.typeName ?? "";
    if (typeName !== "ZodObject" || !def.shape) {
        return [];
    }
    const shape = def.shape();
    return Object.entries(shape).map(([name, value])=>{
        const innerDef = value._def;
        const optional = innerDef.typeName === "ZodOptional" || innerDef.typeName === "ZodNullable";
        return {
            name,
            type: formatZodType2(value),
            optional
        };
    });
}
function formatPropsCompact(props) {
    if (props.length === 0) return "{}";
    const entries = props.map((p)=>`${p.name}${p.optional ? "?" : ""}: ${p.type}`);
    return `{ ${entries.join(", ")} }`;
}
function generateSystemPrompt(catalog, options = {}) {
    const { system = "You are a UI generator that outputs JSONL (JSON Lines) patches.", customRules = [] } = options;
    const lines = [];
    lines.push(system);
    lines.push("");
    const componentCount = catalog.componentNames.length;
    lines.push(`AVAILABLE COMPONENTS (${componentCount}):`);
    lines.push("");
    for (const name of catalog.componentNames){
        const def = catalog.components[name];
        const props = extractPropsFromSchema(def.props);
        const propsStr = formatPropsCompact(props);
        const hasChildrenStr = def.hasChildren ? " Has children." : "";
        const descStr = def.description ? ` ${def.description}` : "";
        lines.push(`- ${String(name)}: ${propsStr}${descStr}${hasChildrenStr}`);
    }
    lines.push("");
    if (catalog.actionNames.length > 0) {
        lines.push("AVAILABLE ACTIONS:");
        lines.push("");
        for (const name of catalog.actionNames){
            const def = catalog.actions[name];
            lines.push(`- ${String(name)}${def.description ? `: ${def.description}` : ""}`);
        }
        lines.push("");
    }
    lines.push("OUTPUT FORMAT (JSONL, RFC 6902 JSON Patch):");
    lines.push('{"op":"add","path":"/root","value":"element-key"}');
    lines.push('{"op":"add","path":"/elements/key","value":{"type":"...","props":{...},"children":[...]}}');
    lines.push('{"op":"remove","path":"/elements/key"}');
    lines.push("");
    lines.push("RULES:");
    const baseRules = [
        'First line sets /root to root element key: {"op":"add","path":"/root","value":"<key>"}',
        'Add elements with /elements/{key}: {"op":"add","path":"/elements/<key>","value":{...}}',
        "Remove elements with op:remove - also update the parent's children array to exclude the removed key",
        "Children array contains string keys, not objects",
        "Parent first, then children",
        "Each element needs: type, props",
        "ONLY use props listed above - never invent new props"
    ];
    const allRules = [
        ...baseRules,
        ...customRules
    ];
    allRules.forEach((rule, i)=>{
        lines.push(`${i + 1}. ${rule}`);
    });
    lines.push("");
    if (catalog.functionNames.length > 0) {
        lines.push("CUSTOM VALIDATION FUNCTIONS:");
        lines.push(catalog.functionNames.map(String).join(", "));
        lines.push("");
    }
    lines.push("Generate JSONL:");
    return lines.join("\n");
}
;
 //# sourceMappingURL=index.mjs.map
}),
"[project]/node_modules/.pnpm/@json-render+react@0.5.2_react@19.2.3_zod@4.3.6/node_modules/@json-render/react/dist/chunk-ANYYWRK3.mjs [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "elementTreeSchema",
    ()=>elementTreeSchema,
    "schema",
    ()=>schema
]);
// src/schema.ts
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/@json-render+core@0.5.2_zod@4.3.6/node_modules/@json-render/core/dist/index.mjs [app-client] (ecmascript)");
;
var schema = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["defineSchema"])((s)=>({
        // What the AI-generated SPEC looks like
        spec: s.object({
            /** Root element key */ root: s.string(),
            /** Flat map of elements by key */ elements: s.record(s.object({
                /** Component type from catalog */ type: s.ref("catalog.components"),
                /** Component props */ props: s.propsOf("catalog.components"),
                /** Child element keys (flat reference) */ children: s.array(s.string()),
                /** Visibility condition */ visible: s.any()
            }))
        }),
        // What the CATALOG must provide
        catalog: s.object({
            /** Component definitions */ components: s.map({
                /** Zod schema for component props */ props: s.zod(),
                /** Slots for this component. Use ['default'] for children, or named slots like ['header', 'footer'] */ slots: s.array(s.string()),
                /** Description for AI generation hints */ description: s.string(),
                /** Example prop values used in prompt examples (auto-generated from Zod schema if omitted) */ example: s.any()
            }),
            /** Action definitions (optional) */ actions: s.map({
                /** Zod schema for action params */ params: s.zod(),
                /** Description for AI generation hints */ description: s.string()
            })
        })
    }), {
    defaultRules: [
        // Element integrity
        "CRITICAL INTEGRITY CHECK: Before outputting ANY element that references children, you MUST have already output (or will output) each child as its own element. If an element has children: ['a', 'b'], then elements 'a' and 'b' MUST exist. A missing child element causes that entire branch of the UI to be invisible.",
        "SELF-CHECK: After generating all elements, mentally walk the tree from root. Every key in every children array must resolve to a defined element. If you find a gap, output the missing element immediately.",
        // Field placement
        'CRITICAL: The "visible" field goes on the ELEMENT object, NOT inside "props". Correct: {"type":"<ComponentName>","props":{},"visible":{"eq":[{"path":"/tab"},"home"]},"children":[...]}.',
        'CRITICAL: The "on" field goes on the ELEMENT object, NOT inside "props". Use on.press, on.change, on.submit etc. NEVER put action/actionParams inside props.',
        // State and data
        "When the user asks for a UI that displays data (e.g. blog posts, products, users), ALWAYS include a state field with realistic sample data. The state field is a top-level field on the spec (sibling of root/elements).",
        'When building repeating content backed by a state array (e.g. posts, products, items), use the "repeat" field on a container element. Example: { "type": "<ContainerComponent>", "props": {}, "repeat": { "path": "/posts", "key": "id" }, "children": ["post-card"] }. Replace <ContainerComponent> with an appropriate component from the AVAILABLE COMPONENTS list. Inside repeated children, use "$item/field" for per-item state paths and "$index" for the current array index. Do NOT hardcode individual elements for each array item.',
        // Design quality
        "Design with visual hierarchy: use container components to group content, heading components for section titles, proper spacing, and status indicators. ONLY use components from the AVAILABLE COMPONENTS list.",
        "For data-rich UIs, use multi-column layout components if available. For forms and single-column content, use vertical layout components. ONLY use components from the AVAILABLE COMPONENTS list.",
        "Always include realistic, professional-looking sample data. For blogs include 3-4 posts with varied titles, authors, dates, categories. For products include names, prices, images. Never leave data empty."
    ]
});
var elementTreeSchema = schema;
;
 //# sourceMappingURL=chunk-ANYYWRK3.mjs.map
}),
"[project]/node_modules/.pnpm/@json-render+react@0.5.2_react@19.2.3_zod@4.3.6/node_modules/@json-render/react/dist/index.mjs [app-client] (ecmascript) <locals>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "ActionProvider",
    ()=>ActionProvider,
    "ConfirmDialog",
    ()=>ConfirmDialog,
    "JSONUIProvider",
    ()=>JSONUIProvider,
    "Renderer",
    ()=>Renderer,
    "RepeatScopeProvider",
    ()=>RepeatScopeProvider,
    "StateProvider",
    ()=>StateProvider,
    "ValidationProvider",
    ()=>ValidationProvider,
    "VisibilityProvider",
    ()=>VisibilityProvider,
    "createRenderer",
    ()=>createRenderer,
    "createRendererFromCatalog",
    ()=>createRendererFromCatalog,
    "defineRegistry",
    ()=>defineRegistry,
    "flatToTree",
    ()=>flatToTree,
    "rewriteRepeatTokens",
    ()=>rewriteRepeatTokens,
    "useAction",
    ()=>useAction,
    "useActions",
    ()=>useActions,
    "useFieldValidation",
    ()=>useFieldValidation,
    "useIsVisible",
    ()=>useIsVisible,
    "useRepeatScope",
    ()=>useRepeatScope,
    "useStateBinding",
    ()=>useStateBinding,
    "useStateStore",
    ()=>useStateStore,
    "useStateValue",
    ()=>useStateValue,
    "useUIStream",
    ()=>useUIStream,
    "useValidation",
    ()=>useValidation,
    "useVisibility",
    ()=>useVisibility
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$react$40$0$2e$5$2e$2_react$40$19$2e$2$2e$3_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$react$2f$dist$2f$chunk$2d$ANYYWRK3$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/@json-render+react@0.5.2_react@19.2.3_zod@4.3.6/node_modules/@json-render/react/dist/chunk-ANYYWRK3.mjs [app-client] (ecmascript)");
// src/contexts/state.tsx
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/next@16.1.2_@babel+core@7.29.0_@opentelemetry+api@1.9.0_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/@json-render+core@0.5.2_zod@4.3.6/node_modules/@json-render/core/dist/index.mjs [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/next@16.1.2_@babel+core@7.29.0_@opentelemetry+api@1.9.0_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/next/dist/compiled/react/jsx-runtime.js [app-client] (ecmascript)");
;
;
;
;
var StateContext = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createContext"])(null);
function StateProvider({ initialState = {}, authState, onStateChange, children }) {
    const [state, setStateInternal] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(initialState);
    const initialStateJsonRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(JSON.stringify(initialState));
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "StateProvider.useEffect": ()=>{
            const newJson = JSON.stringify(initialState);
            if (newJson !== initialStateJsonRef.current) {
                initialStateJsonRef.current = newJson;
                if (initialState && Object.keys(initialState).length > 0) {
                    setStateInternal({
                        "StateProvider.useEffect": (prev)=>({
                                ...prev,
                                ...initialState
                            })
                    }["StateProvider.useEffect"]);
                }
            }
        }
    }["StateProvider.useEffect"], [
        initialState
    ]);
    const get = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "StateProvider.useCallback[get]": (path)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["getByPath"])(state, path)
    }["StateProvider.useCallback[get]"], [
        state
    ]);
    const set = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "StateProvider.useCallback[set]": (path, value2)=>{
            setStateInternal({
                "StateProvider.useCallback[set]": (prev)=>{
                    const next = {
                        ...prev
                    };
                    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["setByPath"])(next, path, value2);
                    return next;
                }
            }["StateProvider.useCallback[set]"]);
            onStateChange?.(path, value2);
        }
    }["StateProvider.useCallback[set]"], [
        onStateChange
    ]);
    const update = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "StateProvider.useCallback[update]": (updates)=>{
            setStateInternal({
                "StateProvider.useCallback[update]": (prev)=>{
                    const next = {
                        ...prev
                    };
                    for (const [path, value2] of Object.entries(updates)){
                        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["setByPath"])(next, path, value2);
                        onStateChange?.(path, value2);
                    }
                    return next;
                }
            }["StateProvider.useCallback[update]"]);
        }
    }["StateProvider.useCallback[update]"], [
        onStateChange
    ]);
    const value = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "StateProvider.useMemo[value]": ()=>({
                state,
                authState,
                get,
                set,
                update
            })
    }["StateProvider.useMemo[value]"], [
        state,
        authState,
        get,
        set,
        update
    ]);
    return /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(StateContext.Provider, {
        value,
        children
    });
}
function useStateStore() {
    const ctx = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useContext"])(StateContext);
    if (!ctx) {
        throw new Error("useStateStore must be used within a StateProvider");
    }
    return ctx;
}
function useStateValue(path) {
    const { state } = useStateStore();
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["getByPath"])(state, path);
}
function useStateBinding(path) {
    const { state, set } = useStateStore();
    const value = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["getByPath"])(state, path);
    const setValue = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "useStateBinding.useCallback[setValue]": (newValue)=>set(path, newValue)
    }["useStateBinding.useCallback[setValue]"], [
        path,
        set
    ]);
    return [
        value,
        setValue
    ];
}
;
;
;
var VisibilityContext = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createContext"])(null);
function VisibilityProvider({ children }) {
    const { state, authState } = useStateStore();
    const ctx = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "VisibilityProvider.useMemo2[ctx]": ()=>({
                stateModel: state,
                authState
            })
    }["VisibilityProvider.useMemo2[ctx]"], [
        state,
        authState
    ]);
    const isVisible = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "VisibilityProvider.useMemo2[isVisible]": ()=>({
                "VisibilityProvider.useMemo2[isVisible]": (condition)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["evaluateVisibility"])(condition, ctx)
            })["VisibilityProvider.useMemo2[isVisible]"]
    }["VisibilityProvider.useMemo2[isVisible]"], [
        ctx
    ]);
    const value = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "VisibilityProvider.useMemo2[value]": ()=>({
                isVisible,
                ctx
            })
    }["VisibilityProvider.useMemo2[value]"], [
        isVisible,
        ctx
    ]);
    return /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(VisibilityContext.Provider, {
        value,
        children
    });
}
function useVisibility() {
    const ctx = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useContext"])(VisibilityContext);
    if (!ctx) {
        throw new Error("useVisibility must be used within a VisibilityProvider");
    }
    return ctx;
}
function useIsVisible(condition) {
    const { isVisible } = useVisibility();
    return isVisible(condition);
}
;
;
;
var idCounter = 0;
function generateUniqueId() {
    idCounter += 1;
    return `${Date.now()}-${idCounter}`;
}
function deepResolveValue(value, get) {
    if (value === null || value === void 0) return value;
    if (value === "$id") {
        return generateUniqueId();
    }
    if (typeof value === "object" && !Array.isArray(value)) {
        const obj = value;
        const keys = Object.keys(obj);
        if (keys.length === 1 && typeof obj.path === "string") {
            return get(obj.path);
        }
        if (keys.length === 1 && "$id" in obj) {
            return generateUniqueId();
        }
    }
    if (Array.isArray(value)) {
        return value.map((item)=>deepResolveValue(item, get));
    }
    if (typeof value === "object") {
        const resolved = {};
        for (const [key, val] of Object.entries(value)){
            resolved[key] = deepResolveValue(val, get);
        }
        return resolved;
    }
    return value;
}
var ActionContext = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createContext"])(null);
function ActionProvider({ handlers: initialHandlers = {}, navigate, children }) {
    const { state, get, set } = useStateStore();
    const [handlers, setHandlers] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(initialHandlers);
    const [loadingActions, setLoadingActions] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(/* @__PURE__ */ new Set());
    const [pendingConfirmation, setPendingConfirmation] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const registerHandler = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "ActionProvider.useCallback2[registerHandler]": (name, handler)=>{
            setHandlers({
                "ActionProvider.useCallback2[registerHandler]": (prev)=>({
                        ...prev,
                        [name]: handler
                    })
            }["ActionProvider.useCallback2[registerHandler]"]);
        }
    }["ActionProvider.useCallback2[registerHandler]"], []);
    const execute = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "ActionProvider.useCallback2[execute]": async (binding)=>{
            const resolved = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["resolveAction"])(binding, state);
            if (resolved.action === "setState" && resolved.params) {
                const path = resolved.params.path;
                const value2 = resolved.params.value;
                if (path) {
                    set(path, value2);
                }
                return;
            }
            if (resolved.action === "pushState" && resolved.params) {
                const path = resolved.params.path;
                const rawValue = resolved.params.value;
                if (path) {
                    const resolvedValue = deepResolveValue(rawValue, get);
                    const arr = get(path) ?? [];
                    set(path, [
                        ...arr,
                        resolvedValue
                    ]);
                    const clearPath = resolved.params.clearPath;
                    if (clearPath) {
                        set(clearPath, "");
                    }
                }
                return;
            }
            if (resolved.action === "removeState" && resolved.params) {
                const path = resolved.params.path;
                const index = resolved.params.index;
                if (path !== void 0 && index !== void 0) {
                    const arr = get(path) ?? [];
                    set(path, arr.filter({
                        "ActionProvider.useCallback2[execute]": (_, i)=>i !== index
                    }["ActionProvider.useCallback2[execute]"]));
                }
                return;
            }
            if (resolved.action === "push" && resolved.params) {
                const screen = resolved.params.screen;
                if (screen) {
                    const currentScreen = get("/currentScreen");
                    const navStack = get("/navStack") ?? [];
                    if (currentScreen) {
                        set("/navStack", [
                            ...navStack,
                            currentScreen
                        ]);
                    } else {
                        set("/navStack", [
                            ...navStack,
                            ""
                        ]);
                    }
                    set("/currentScreen", screen);
                }
                return;
            }
            if (resolved.action === "pop") {
                const navStack = get("/navStack") ?? [];
                if (navStack.length > 0) {
                    const previousScreen = navStack[navStack.length - 1];
                    set("/navStack", navStack.slice(0, -1));
                    if (previousScreen) {
                        set("/currentScreen", previousScreen);
                    } else {
                        set("/currentScreen", void 0);
                    }
                }
                return;
            }
            const handler = handlers[resolved.action];
            if (!handler) {
                console.warn(`No handler registered for action: ${resolved.action}`);
                return;
            }
            if (resolved.confirm) {
                return new Promise({
                    "ActionProvider.useCallback2[execute]": (resolve, reject)=>{
                        setPendingConfirmation({
                            action: resolved,
                            handler,
                            resolve: {
                                "ActionProvider.useCallback2[execute]": ()=>{
                                    setPendingConfirmation(null);
                                    resolve();
                                }
                            }["ActionProvider.useCallback2[execute]"],
                            reject: {
                                "ActionProvider.useCallback2[execute]": ()=>{
                                    setPendingConfirmation(null);
                                    reject(new Error("Action cancelled"));
                                }
                            }["ActionProvider.useCallback2[execute]"]
                        });
                    }
                }["ActionProvider.useCallback2[execute]"]).then({
                    "ActionProvider.useCallback2[execute]": async ()=>{
                        setLoadingActions({
                            "ActionProvider.useCallback2[execute]": (prev)=>new Set(prev).add(resolved.action)
                        }["ActionProvider.useCallback2[execute]"]);
                        try {
                            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["executeAction"])({
                                action: resolved,
                                handler,
                                setState: set,
                                navigate,
                                executeAction: {
                                    "ActionProvider.useCallback2[execute]": async (name)=>{
                                        const subBinding = {
                                            action: name
                                        };
                                        await execute(subBinding);
                                    }
                                }["ActionProvider.useCallback2[execute]"]
                            });
                        } finally{
                            setLoadingActions({
                                "ActionProvider.useCallback2[execute]": (prev)=>{
                                    const next = new Set(prev);
                                    next.delete(resolved.action);
                                    return next;
                                }
                            }["ActionProvider.useCallback2[execute]"]);
                        }
                    }
                }["ActionProvider.useCallback2[execute]"]);
            }
            setLoadingActions({
                "ActionProvider.useCallback2[execute]": (prev)=>new Set(prev).add(resolved.action)
            }["ActionProvider.useCallback2[execute]"]);
            try {
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["executeAction"])({
                    action: resolved,
                    handler,
                    setState: set,
                    navigate,
                    executeAction: {
                        "ActionProvider.useCallback2[execute]": async (name)=>{
                            const subBinding = {
                                action: name
                            };
                            await execute(subBinding);
                        }
                    }["ActionProvider.useCallback2[execute]"]
                });
            } finally{
                setLoadingActions({
                    "ActionProvider.useCallback2[execute]": (prev)=>{
                        const next = new Set(prev);
                        next.delete(resolved.action);
                        return next;
                    }
                }["ActionProvider.useCallback2[execute]"]);
            }
        }
    }["ActionProvider.useCallback2[execute]"], [
        state,
        handlers,
        get,
        set,
        navigate
    ]);
    const confirm = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "ActionProvider.useCallback2[confirm]": ()=>{
            pendingConfirmation?.resolve();
        }
    }["ActionProvider.useCallback2[confirm]"], [
        pendingConfirmation
    ]);
    const cancel = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "ActionProvider.useCallback2[cancel]": ()=>{
            pendingConfirmation?.reject();
        }
    }["ActionProvider.useCallback2[cancel]"], [
        pendingConfirmation
    ]);
    const value = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "ActionProvider.useMemo3[value]": ()=>({
                handlers,
                loadingActions,
                pendingConfirmation,
                execute,
                confirm,
                cancel,
                registerHandler
            })
    }["ActionProvider.useMemo3[value]"], [
        handlers,
        loadingActions,
        pendingConfirmation,
        execute,
        confirm,
        cancel,
        registerHandler
    ]);
    return /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(ActionContext.Provider, {
        value,
        children
    });
}
function useActions() {
    const ctx = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useContext"])(ActionContext);
    if (!ctx) {
        throw new Error("useActions must be used within an ActionProvider");
    }
    return ctx;
}
function useAction(binding) {
    const { execute, loadingActions } = useActions();
    const isLoading = loadingActions.has(binding.action);
    const executeAction2 = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "useAction.useCallback2[executeAction2]": ()=>execute(binding)
    }["useAction.useCallback2[executeAction2]"], [
        execute,
        binding
    ]);
    return {
        execute: executeAction2,
        isLoading
    };
}
function ConfirmDialog({ confirm, onConfirm, onCancel }) {
    const isDanger = confirm.variant === "danger";
    return /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])("div", {
        style: {
            position: "fixed",
            inset: 0,
            backgroundColor: "rgba(0, 0, 0, 0.5)",
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            zIndex: 50
        },
        onClick: onCancel,
        children: /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxs"])("div", {
            style: {
                backgroundColor: "white",
                borderRadius: "8px",
                padding: "24px",
                maxWidth: "400px",
                width: "100%",
                boxShadow: "0 20px 25px -5px rgba(0, 0, 0, 0.1)"
            },
            onClick: (e)=>e.stopPropagation(),
            children: [
                /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])("h3", {
                    style: {
                        margin: "0 0 8px 0",
                        fontSize: "18px",
                        fontWeight: 600
                    },
                    children: confirm.title
                }),
                /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])("p", {
                    style: {
                        margin: "0 0 24px 0",
                        color: "#6b7280"
                    },
                    children: confirm.message
                }),
                /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxs"])("div", {
                    style: {
                        display: "flex",
                        gap: "12px",
                        justifyContent: "flex-end"
                    },
                    children: [
                        /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])("button", {
                            onClick: onCancel,
                            style: {
                                padding: "8px 16px",
                                borderRadius: "6px",
                                border: "1px solid #d1d5db",
                                backgroundColor: "white",
                                cursor: "pointer"
                            },
                            children: confirm.cancelLabel ?? "Cancel"
                        }),
                        /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])("button", {
                            onClick: onConfirm,
                            style: {
                                padding: "8px 16px",
                                borderRadius: "6px",
                                border: "none",
                                backgroundColor: isDanger ? "#dc2626" : "#3b82f6",
                                color: "white",
                                cursor: "pointer"
                            },
                            children: confirm.confirmLabel ?? "Confirm"
                        })
                    ]
                })
            ]
        })
    });
}
;
;
;
var ValidationContext = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createContext"])(null);
function ValidationProvider({ customFunctions = {}, children }) {
    const { state, authState } = useStateStore();
    const [fieldStates, setFieldStates] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])({});
    const [fieldConfigs, setFieldConfigs] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])({});
    const registerField = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "ValidationProvider.useCallback3[registerField]": (path, config)=>{
            setFieldConfigs({
                "ValidationProvider.useCallback3[registerField]": (prev)=>({
                        ...prev,
                        [path]: config
                    })
            }["ValidationProvider.useCallback3[registerField]"]);
        }
    }["ValidationProvider.useCallback3[registerField]"], []);
    const validate = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "ValidationProvider.useCallback3[validate]": (path, config)=>{
            const value2 = state[path.split("/").filter(Boolean).join(".")];
            const result = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["runValidation"])(config, {
                value: value2,
                stateModel: state,
                customFunctions,
                authState
            });
            setFieldStates({
                "ValidationProvider.useCallback3[validate]": (prev)=>({
                        ...prev,
                        [path]: {
                            touched: prev[path]?.touched ?? true,
                            validated: true,
                            result
                        }
                    })
            }["ValidationProvider.useCallback3[validate]"]);
            return result;
        }
    }["ValidationProvider.useCallback3[validate]"], [
        state,
        customFunctions,
        authState
    ]);
    const touch = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "ValidationProvider.useCallback3[touch]": (path)=>{
            setFieldStates({
                "ValidationProvider.useCallback3[touch]": (prev)=>({
                        ...prev,
                        [path]: {
                            ...prev[path],
                            touched: true,
                            validated: prev[path]?.validated ?? false,
                            result: prev[path]?.result ?? null
                        }
                    })
            }["ValidationProvider.useCallback3[touch]"]);
        }
    }["ValidationProvider.useCallback3[touch]"], []);
    const clear = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "ValidationProvider.useCallback3[clear]": (path)=>{
            setFieldStates({
                "ValidationProvider.useCallback3[clear]": (prev)=>{
                    const { [path]: _, ...rest } = prev;
                    return rest;
                }
            }["ValidationProvider.useCallback3[clear]"]);
        }
    }["ValidationProvider.useCallback3[clear]"], []);
    const validateAll = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "ValidationProvider.useCallback3[validateAll]": ()=>{
            let allValid = true;
            for (const [path, config] of Object.entries(fieldConfigs)){
                const result = validate(path, config);
                if (!result.valid) {
                    allValid = false;
                }
            }
            return allValid;
        }
    }["ValidationProvider.useCallback3[validateAll]"], [
        fieldConfigs,
        validate
    ]);
    const value = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "ValidationProvider.useMemo4[value]": ()=>({
                customFunctions,
                fieldStates,
                validate,
                touch,
                clear,
                validateAll,
                registerField
            })
    }["ValidationProvider.useMemo4[value]"], [
        customFunctions,
        fieldStates,
        validate,
        touch,
        clear,
        validateAll,
        registerField
    ]);
    return /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(ValidationContext.Provider, {
        value,
        children
    });
}
function useValidation() {
    const ctx = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useContext"])(ValidationContext);
    if (!ctx) {
        throw new Error("useValidation must be used within a ValidationProvider");
    }
    return ctx;
}
function useFieldValidation(path, config) {
    const { fieldStates, validate: validateField, touch: touchField, clear: clearField, registerField } = useValidation();
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"].useEffect({
        "useFieldValidation.useEffect": ()=>{
            if (config) {
                registerField(path, config);
            }
        }
    }["useFieldValidation.useEffect"], [
        path,
        config,
        registerField
    ]);
    const state = fieldStates[path] ?? {
        touched: false,
        validated: false,
        result: null
    };
    const validate = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "useFieldValidation.useCallback3[validate]": ()=>validateField(path, config ?? {
                checks: []
            })
    }["useFieldValidation.useCallback3[validate]"], [
        path,
        config,
        validateField
    ]);
    const touch = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "useFieldValidation.useCallback3[touch]": ()=>touchField(path)
    }["useFieldValidation.useCallback3[touch]"], [
        path,
        touchField
    ]);
    const clear = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "useFieldValidation.useCallback3[clear]": ()=>clearField(path)
    }["useFieldValidation.useCallback3[clear]"], [
        path,
        clearField
    ]);
    return {
        state,
        validate,
        touch,
        clear,
        errors: state.result?.errors ?? [],
        isValid: state.result?.valid ?? true
    };
}
;
;
var RepeatScopeContext = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createContext"])(null);
function RepeatScopeProvider({ basePath, index, children }) {
    return /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(RepeatScopeContext.Provider, {
        value: {
            basePath,
            index
        },
        children
    });
}
function useRepeatScope() {
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useContext"])(RepeatScopeContext);
}
function rewriteRepeatTokens(value, basePath, index) {
    if (typeof value === "string") {
        if (value === "$index") return index;
        if (value === "$item") return basePath;
        if (value.startsWith("$item/")) return basePath + value.slice("$item".length);
        return value;
    }
    if (Array.isArray(value)) {
        let changed = false;
        const result = value.map((item)=>{
            const rewritten = rewriteRepeatTokens(item, basePath, index);
            if (rewritten !== item) changed = true;
            return rewritten;
        });
        return changed ? result : value;
    }
    if (typeof value === "object" && value !== null) {
        let changed = false;
        const result = {};
        for (const [key, val] of Object.entries(value)){
            const rewritten = rewriteRepeatTokens(val, basePath, index);
            if (rewritten !== val) changed = true;
            result[key] = rewritten;
        }
        return changed ? result : value;
    }
    return value;
}
;
;
;
var ElementErrorBoundary = class extends __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"].Component {
    constructor(props){
        super(props);
        this.state = {
            hasError: false
        };
    }
    static getDerivedStateFromError() {
        return {
            hasError: true
        };
    }
    componentDidCatch(error, info) {
        console.error(`[json-render] Rendering error in <${this.props.elementType}>:`, error, info.componentStack);
    }
    render() {
        if (this.state.hasError) {
            return null;
        }
        return this.props.children;
    }
};
function ElementRenderer({ element, spec, registry, loading, fallback }) {
    const repeatScope = useRepeatScope();
    const { ctx } = useVisibility();
    const { execute } = useActions();
    let effectiveElement = element;
    if (repeatScope) {
        const rewrittenProps = rewriteRepeatTokens(element.props, repeatScope.basePath, repeatScope.index);
        const rewrittenVisible = element.visible !== void 0 ? rewriteRepeatTokens(element.visible, repeatScope.basePath, repeatScope.index) : element.visible;
        const rewrittenOn = element.on !== void 0 ? rewriteRepeatTokens(element.on, repeatScope.basePath, repeatScope.index) : element.on;
        if (rewrittenProps !== element.props || rewrittenVisible !== element.visible || rewrittenOn !== element.on) {
            effectiveElement = {
                ...element,
                props: rewrittenProps,
                visible: rewrittenVisible,
                on: rewrittenOn
            };
        }
    }
    const isVisible = useIsVisible(effectiveElement.visible);
    const onBindings = effectiveElement.on;
    const emit = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "ElementRenderer.useCallback4[emit]": (eventName)=>{
            const binding = onBindings?.[eventName];
            if (!binding) return;
            const bindings = Array.isArray(binding) ? binding : [
                binding
            ];
            for (const b of bindings){
                execute(b);
            }
        }
    }["ElementRenderer.useCallback4[emit]"], [
        onBindings,
        execute
    ]);
    if (!isVisible) {
        return null;
    }
    const resolvedProps = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["resolveElementProps"])(effectiveElement.props, ctx);
    const resolvedElement = resolvedProps !== effectiveElement.props ? {
        ...effectiveElement,
        props: resolvedProps
    } : effectiveElement;
    const Component = registry[resolvedElement.type] ?? fallback;
    if (!Component) {
        console.warn(`No renderer for component type: ${resolvedElement.type}`);
        return null;
    }
    const children = resolvedElement.repeat ? /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(RepeatChildren, {
        element: resolvedElement,
        spec,
        registry,
        loading,
        fallback
    }) : resolvedElement.children?.map((childKey)=>{
        const childElement = spec.elements[childKey];
        if (!childElement) {
            if (!loading) {
                console.warn(`[json-render] Missing element "${childKey}" referenced as child of "${resolvedElement.type}". This element will not render.`);
            }
            return null;
        }
        return /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(ElementRenderer, {
            element: childElement,
            spec,
            registry,
            loading,
            fallback
        }, childKey);
    });
    return /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(ElementErrorBoundary, {
        elementType: resolvedElement.type,
        children: /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(Component, {
            element: resolvedElement,
            emit,
            loading,
            children
        })
    });
}
function RepeatChildren({ element, spec, registry, loading, fallback }) {
    const { state } = useStateStore();
    const repeat = element.repeat;
    const statePath = repeat.path;
    const items = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["getByPath"])(state, statePath) ?? [];
    return /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
        children: items.map((item, index)=>{
            const key = repeat.key && typeof item === "object" && item !== null ? String(item[repeat.key] ?? index) : String(index);
            return /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(RepeatScopeProvider, {
                basePath: `${statePath}/${index}`,
                index,
                children: element.children?.map((childKey)=>{
                    const childElement = spec.elements[childKey];
                    if (!childElement) {
                        if (!loading) {
                            console.warn(`[json-render] Missing element "${childKey}" referenced as child of "${element.type}" (repeat). This element will not render.`);
                        }
                        return null;
                    }
                    return /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(ElementRenderer, {
                        element: childElement,
                        spec,
                        registry,
                        loading,
                        fallback
                    }, childKey);
                })
            }, key);
        })
    });
}
function Renderer({ spec, registry, loading, fallback }) {
    if (!spec || !spec.root) {
        return null;
    }
    const rootElement = spec.elements[spec.root];
    if (!rootElement) {
        return null;
    }
    return /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(ElementRenderer, {
        element: rootElement,
        spec,
        registry,
        loading,
        fallback
    });
}
function JSONUIProvider({ registry, initialState, authState, actionHandlers, navigate, validationFunctions, onStateChange, children }) {
    return /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(StateProvider, {
        initialState,
        authState,
        onStateChange,
        children: /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(VisibilityProvider, {
            children: /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(ActionProvider, {
                handlers: actionHandlers,
                navigate,
                children: /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxs"])(ValidationProvider, {
                    customFunctions: validationFunctions,
                    children: [
                        children,
                        /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(ConfirmationDialogManager, {})
                    ]
                })
            })
        })
    });
}
function ConfirmationDialogManager() {
    const { pendingConfirmation, confirm, cancel } = useActions();
    if (!pendingConfirmation?.action.confirm) {
        return null;
    }
    return /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(ConfirmDialog, {
        confirm: pendingConfirmation.action.confirm,
        onConfirm: confirm,
        onCancel: cancel
    });
}
function createRendererFromCatalog(_catalog, registry) {
    return function CatalogRenderer(props) {
        return /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(Renderer, {
            ...props,
            registry
        });
    };
}
function defineRegistry(_catalog, options) {
    const registry = {};
    if (options.components) {
        for (const [name, componentFn] of Object.entries(options.components)){
            registry[name] = ({ element, children, emit, loading })=>{
                return componentFn({
                    props: element.props,
                    children,
                    emit,
                    loading
                });
            };
        }
    }
    const actionMap = options.actions ? Object.entries(options.actions) : [];
    const handlers = (getSetState, getState)=>{
        const result = {};
        for (const [name, actionFn] of actionMap){
            result[name] = async (params)=>{
                const setState = getSetState();
                const state = getState();
                if (setState) {
                    await actionFn(params, setState, state);
                }
            };
        }
        return result;
    };
    const executeAction2 = async (actionName, params, setState, state = {})=>{
        const entry = actionMap.find(([name])=>name === actionName);
        if (entry) {
            await entry[1](params, setState, state);
        } else {
            console.warn(`Unknown action: ${actionName}`);
        }
    };
    return {
        registry,
        handlers,
        executeAction: executeAction2
    };
}
function createRenderer(catalog, components) {
    const registry = components;
    return function CatalogRenderer({ spec, state, onAction, onStateChange, loading, authState, fallback }) {
        const actionHandlers = onAction ? {
            __default__: (params)=>{
                const actionName = params.__actionName__;
                const actionParams = params.__actionParams__;
                return onAction(actionName, actionParams);
            }
        } : void 0;
        return /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(StateProvider, {
            initialState: state,
            authState,
            onStateChange,
            children: /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(VisibilityProvider, {
                children: /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(ActionProvider, {
                    handlers: actionHandlers,
                    children: /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxs"])(ValidationProvider, {
                        children: [
                            /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(Renderer, {
                                spec,
                                registry,
                                loading,
                                fallback
                            }),
                            /* @__PURE__ */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsx"])(ConfirmationDialogManager, {})
                        ]
                    })
                })
            })
        });
    };
}
;
;
function parseLine(line) {
    try {
        const trimmed = line.trim();
        if (!trimmed || trimmed.startsWith("//")) {
            return null;
        }
        const parsed = JSON.parse(trimmed);
        if (parsed.__meta === "usage") {
            return {
                type: "usage",
                usage: {
                    promptTokens: parsed.promptTokens ?? 0,
                    completionTokens: parsed.completionTokens ?? 0,
                    totalTokens: parsed.totalTokens ?? 0
                }
            };
        }
        return {
            type: "patch",
            patch: parsed
        };
    } catch  {
        return null;
    }
}
function setSpecValue(newSpec, path, value) {
    if (path === "/root") {
        newSpec.root = value;
        return;
    }
    if (path === "/state") {
        newSpec.state = value;
        return;
    }
    if (path.startsWith("/state/")) {
        if (!newSpec.state) newSpec.state = {};
        const statePath = path.slice("/state".length);
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["setByPath"])(newSpec.state, statePath, value);
        return;
    }
    if (path.startsWith("/elements/")) {
        const pathParts = path.slice("/elements/".length).split("/");
        const elementKey = pathParts[0];
        if (!elementKey) return;
        if (pathParts.length === 1) {
            newSpec.elements[elementKey] = value;
        } else {
            const element = newSpec.elements[elementKey];
            if (element) {
                const propPath = "/" + pathParts.slice(1).join("/");
                const newElement = {
                    ...element
                };
                (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["setByPath"])(newElement, propPath, value);
                newSpec.elements[elementKey] = newElement;
            }
        }
    }
}
function removeSpecValue(newSpec, path) {
    if (path === "/state") {
        delete newSpec.state;
        return;
    }
    if (path.startsWith("/state/") && newSpec.state) {
        const statePath = path.slice("/state".length);
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["removeByPath"])(newSpec.state, statePath);
        return;
    }
    if (path.startsWith("/elements/")) {
        const pathParts = path.slice("/elements/".length).split("/");
        const elementKey = pathParts[0];
        if (!elementKey) return;
        if (pathParts.length === 1) {
            const { [elementKey]: _, ...rest } = newSpec.elements;
            newSpec.elements = rest;
        } else {
            const element = newSpec.elements[elementKey];
            if (element) {
                const propPath = "/" + pathParts.slice(1).join("/");
                const newElement = {
                    ...element
                };
                (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["removeByPath"])(newElement, propPath);
                newSpec.elements[elementKey] = newElement;
            }
        }
    }
}
function getSpecValue(spec, path) {
    if (path === "/root") return spec.root;
    if (path === "/state") return spec.state;
    if (path.startsWith("/state/") && spec.state) {
        const statePath = path.slice("/state".length);
        return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["getByPath"])(spec.state, statePath);
    }
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$json$2d$render$2b$core$40$0$2e$5$2e$2_zod$40$4$2e$3$2e$6$2f$node_modules$2f40$json$2d$render$2f$core$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["getByPath"])(spec, path);
}
function applyPatch(spec, patch) {
    const newSpec = {
        ...spec,
        elements: {
            ...spec.elements
        },
        ...spec.state ? {
            state: {
                ...spec.state
            }
        } : {}
    };
    switch(patch.op){
        case "add":
        case "replace":
            {
                setSpecValue(newSpec, patch.path, patch.value);
                break;
            }
        case "remove":
            {
                removeSpecValue(newSpec, patch.path);
                break;
            }
        case "move":
            {
                if (!patch.from) break;
                const moveValue = getSpecValue(newSpec, patch.from);
                removeSpecValue(newSpec, patch.from);
                setSpecValue(newSpec, patch.path, moveValue);
                break;
            }
        case "copy":
            {
                if (!patch.from) break;
                const copyValue = getSpecValue(newSpec, patch.from);
                setSpecValue(newSpec, patch.path, copyValue);
                break;
            }
        case "test":
            {
                break;
            }
    }
    return newSpec;
}
function useUIStream({ api, onComplete, onError }) {
    const [spec, setSpec] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [isStreaming, setIsStreaming] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [error, setError] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [usage, setUsage] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [rawLines, setRawLines] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])([]);
    const abortControllerRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const clear = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "useUIStream.useCallback5[clear]": ()=>{
            setSpec(null);
            setError(null);
        }
    }["useUIStream.useCallback5[clear]"], []);
    const send = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "useUIStream.useCallback5[send]": async (prompt, context)=>{
            abortControllerRef.current?.abort();
            abortControllerRef.current = new AbortController();
            setIsStreaming(true);
            setError(null);
            setUsage(null);
            setRawLines([]);
            const previousSpec = context?.previousSpec;
            let currentSpec = previousSpec && previousSpec.root ? {
                ...previousSpec,
                elements: {
                    ...previousSpec.elements
                }
            } : {
                root: "",
                elements: {}
            };
            setSpec(currentSpec);
            try {
                const response = await fetch(api, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        prompt,
                        context,
                        currentSpec
                    }),
                    signal: abortControllerRef.current.signal
                });
                if (!response.ok) {
                    let errorMessage = `HTTP error: ${response.status}`;
                    try {
                        const errorData = await response.json();
                        if (errorData.message) {
                            errorMessage = errorData.message;
                        } else if (errorData.error) {
                            errorMessage = errorData.error;
                        }
                    } catch  {}
                    throw new Error(errorMessage);
                }
                const reader = response.body?.getReader();
                if (!reader) {
                    throw new Error("No response body");
                }
                const decoder = new TextDecoder();
                let buffer = "";
                while(true){
                    const { done, value } = await reader.read();
                    if (done) break;
                    buffer += decoder.decode(value, {
                        stream: true
                    });
                    const lines = buffer.split("\n");
                    buffer = lines.pop() ?? "";
                    for (const line of lines){
                        const trimmed = line.trim();
                        if (!trimmed) continue;
                        const result = parseLine(trimmed);
                        if (!result) continue;
                        if (result.type === "usage") {
                            setUsage(result.usage);
                        } else {
                            setRawLines({
                                "useUIStream.useCallback5[send]": (prev)=>[
                                        ...prev,
                                        trimmed
                                    ]
                            }["useUIStream.useCallback5[send]"]);
                            currentSpec = applyPatch(currentSpec, result.patch);
                            setSpec({
                                ...currentSpec
                            });
                        }
                    }
                }
                if (buffer.trim()) {
                    const trimmed = buffer.trim();
                    const result = parseLine(trimmed);
                    if (result) {
                        if (result.type === "usage") {
                            setUsage(result.usage);
                        } else {
                            setRawLines({
                                "useUIStream.useCallback5[send]": (prev)=>[
                                        ...prev,
                                        trimmed
                                    ]
                            }["useUIStream.useCallback5[send]"]);
                            currentSpec = applyPatch(currentSpec, result.patch);
                            setSpec({
                                ...currentSpec
                            });
                        }
                    }
                }
                onComplete?.(currentSpec);
            } catch (err) {
                if (err.name === "AbortError") {
                    return;
                }
                const error2 = err instanceof Error ? err : new Error(String(err));
                setError(error2);
                onError?.(error2);
            } finally{
                setIsStreaming(false);
            }
        }
    }["useUIStream.useCallback5[send]"], [
        api,
        onComplete,
        onError
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$2_$40$babel$2b$core$40$7$2e$29$2e$0_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$3_react$40$19$2e$2$2e$3_$5f$react$40$19$2e$2$2e$3$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "useUIStream.useEffect2": ()=>{
            return ({
                "useUIStream.useEffect2": ()=>{
                    abortControllerRef.current?.abort();
                }
            })["useUIStream.useEffect2"];
        }
    }["useUIStream.useEffect2"], []);
    return {
        spec,
        isStreaming,
        error,
        usage,
        rawLines,
        send,
        clear
    };
}
function flatToTree(elements) {
    const elementMap = {};
    let root = "";
    for (const element of elements){
        elementMap[element.key] = {
            type: element.type,
            props: element.props,
            children: [],
            visible: element.visible
        };
    }
    for (const element of elements){
        if (element.parentKey) {
            const parent = elementMap[element.parentKey];
            if (parent) {
                if (!parent.children) {
                    parent.children = [];
                }
                parent.children.push(element.key);
            }
        } else {
            root = element.key;
        }
    }
    return {
        root,
        elements: elementMap
    };
}
;
 //# sourceMappingURL=index.mjs.map
}),
]);

//# sourceMappingURL=node_modules__pnpm_19978aee._.js.map