{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/app/api/tts/elevenlabs/route.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\n\nexport const runtime = 'edge';\n\ninterface ElevenLabsRequestBody {\n  text: string;\n  voiceId?: string; // User's cloned voice ID\n  modelId?: string;\n  stability?: number; // 0-1\n  similarityBoost?: number; // 0-1\n  style?: number; // 0-1\n  useSpeakerBoost?: boolean;\n}\n\n// Default to a natural conversational voice if no custom voice ID provided\nconst DEFAULT_VOICE_ID = 'pNInz6obpgDQGcFmaJgB'; // Adam - natural male voice\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body: ElevenLabsRequestBody = await request.json();\n    const {\n      text,\n      voiceId = process.env.ELEVENLABS_JAMES_VOICE_ID || process.env.ELEVENLABS_VOICE_ID || DEFAULT_VOICE_ID,\n      modelId = 'eleven_multilingual_v2', // Best quality multilingual\n      stability = 0.5,\n      similarityBoost = 0.75,\n      style = 0.0,\n      useSpeakerBoost = true\n    } = body;\n\n    if (!text || typeof text !== 'string') {\n      return new Response(JSON.stringify({ error: 'Text is required' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    // Eleven Labs has a limit of ~5000 characters per request\n    if (text.length > 5000) {\n      return new Response(JSON.stringify({ error: 'Text too long (max 5000 characters)' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    const apiKey = process.env.ELEVENLABS_API_KEY;\n    if (!apiKey) {\n      // Fallback to OpenAI TTS if Eleven Labs not configured\n      console.log('Eleven Labs API key not configured, falling back to OpenAI');\n      return new Response(JSON.stringify({\n        error: 'Eleven Labs API key not configured',\n        fallback: 'openai'\n      }), {\n        status: 503,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    // Call Eleven Labs TTS API\n    const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'xi-api-key': apiKey,\n      },\n      body: JSON.stringify({\n        text,\n        model_id: modelId,\n        voice_settings: {\n          stability,\n          similarity_boost: similarityBoost,\n          style,\n          use_speaker_boost: useSpeakerBoost,\n        },\n      }),\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      console.error('Eleven Labs TTS API error:', errorText);\n      return new Response(JSON.stringify({\n        error: 'Failed to generate speech',\n        fallback: 'openai'\n      }), {\n        status: 500,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    // Stream the audio response\n    const audioStream = response.body;\n    if (!audioStream) {\n      return new Response(JSON.stringify({ error: 'No audio stream received' }), {\n        status: 500,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    // Return the audio stream with appropriate headers\n    return new Response(audioStream, {\n      headers: {\n        'Content-Type': 'audio/mpeg',\n        'Cache-Control': 'no-cache',\n        'Transfer-Encoding': 'chunked',\n      },\n    });\n  } catch (error) {\n    console.error('Eleven Labs TTS API error:', error);\n    return new Response(JSON.stringify({\n      error: 'Internal server error',\n      fallback: 'openai'\n    }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n}\n"],"names":[],"mappings":";;;;;;AAEO,MAAM,UAAU;AAYvB,2EAA2E;AAC3E,MAAM,mBAAmB,wBAAwB,4BAA4B;AAEtE,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAA8B,MAAM,QAAQ,IAAI;QACtD,MAAM,EACJ,IAAI,EACJ,UAAU,QAAQ,GAAG,CAAC,yBAAyB,IAAI,QAAQ,GAAG,CAAC,mBAAmB,IAAI,gBAAgB,EACtG,UAAU,wBAAwB,EAClC,YAAY,GAAG,EACf,kBAAkB,IAAI,EACtB,QAAQ,GAAG,EACX,kBAAkB,IAAI,EACvB,GAAG;QAEJ,IAAI,CAAC,QAAQ,OAAO,SAAS,UAAU;YACrC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAAmB,IAAI;gBACjE,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QACF;QAEA,0DAA0D;QAC1D,IAAI,KAAK,MAAM,GAAG,MAAM;YACtB,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAAsC,IAAI;gBACpF,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QACF;QAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,kBAAkB;QAC7C,IAAI,CAAC,QAAQ;YACX,uDAAuD;YACvD,QAAQ,GAAG,CAAC;YACZ,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBACjC,OAAO;gBACP,UAAU;YACZ,IAAI;gBACF,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QACF;QAEA,2BAA2B;QAC3B,MAAM,WAAW,MAAM,MAAM,CAAC,4CAA4C,EAAE,SAAS,EAAE;YACrF,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,cAAc;YAChB;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB;gBACA,UAAU;gBACV,gBAAgB;oBACd;oBACA,kBAAkB;oBAClB;oBACA,mBAAmB;gBACrB;YACF;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,QAAQ,KAAK,CAAC,8BAA8B;YAC5C,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBACjC,OAAO;gBACP,UAAU;YACZ,IAAI;gBACF,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QACF;QAEA,4BAA4B;QAC5B,MAAM,cAAc,SAAS,IAAI;QACjC,IAAI,CAAC,aAAa;YAChB,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAA2B,IAAI;gBACzE,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QACF;QAEA,mDAAmD;QACnD,OAAO,IAAI,SAAS,aAAa;YAC/B,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB;gBACjB,qBAAqB;YACvB;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YACjC,OAAO;YACP,UAAU;QACZ,IAAI;YACF,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IACF;AACF"}}]
}