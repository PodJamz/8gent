{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/lib/openclaw/client-impl.ts"],"sourcesContent":["import { nanoid } from 'nanoid';\nimport WebSocket from 'isomorphic-ws';\nimport { Buffer } from 'buffer';\n\n// Protocol constants based on OpenClaw source\nconst PROTOCOL_VERSION = 3;\n\nexport interface OpenClawClientConfig {\n    url: string;\n    authToken?: string;\n    device?: {\n        id: string;\n        publicKey: string;\n        privateKey: string;\n    };\n}\n\ntype MessageHandler = (message: any) => void;\n\nexport class OpenClawClientImpl {\n    private ws: WebSocket | null = null;\n    private url: string;\n    private authToken?: string;\n    private pendingRequests = new Map<string, { resolve: (val: any) => void; reject: (err: any) => void }>();\n    private eventListeners = new Map<string, Set<MessageHandler>>();\n    private isConnected = false;\n    private connectPromise: Promise<void> | null = null;\n\n    constructor(config: OpenClawClientConfig) {\n        this.url = config.url;\n        this.authToken = config.authToken;\n    }\n\n    async connect(): Promise<void> {\n        if (this.isConnected) return;\n        if (this.connectPromise) return this.connectPromise;\n\n        this.connectPromise = new Promise((resolve, reject) => {\n            try {\n                // Set origin to satisfy gateway check for Control UI\n                const options = {\n                    headers: {\n                        Origin: 'http://localhost:18789'\n                    }\n                };\n                this.ws = new WebSocket(this.url, options);\n\n                this.ws.onopen = () => {\n                    console.log('[OpenClawClient] WebSocket connected');\n                };\n\n                this.ws.onmessage = (event) => {\n                    try {\n                        let data: any;\n                        const rawData = event.data;\n\n                        // console.log('[OpenClawClient] Raw message type:', typeof rawData);\n\n                        if (typeof rawData === 'string') {\n                            data = JSON.parse(rawData);\n                        } else if (Buffer.isBuffer(rawData)) {\n                            // console.log('[OpenClawClient] Buffer received, length:', rawData.length);\n                            data = JSON.parse(rawData.toString());\n                        } else if (rawData instanceof ArrayBuffer) {\n                            // console.log('[OpenClawClient] ArrayBuffer received, byteLength:', rawData.byteLength);\n                            const decoder = new TextDecoder();\n                            data = JSON.parse(decoder.decode(rawData));\n                        } else if (Array.isArray(rawData)) {\n                            // Buffer[]\n                            // console.log('[OpenClawClient] Buffer array received');\n                            data = JSON.parse(Buffer.concat(rawData).toString());\n                        } else {\n                            // unknown\n                            console.warn('[OpenClawClient] Unknown message type:', typeof rawData);\n                            return;\n                        }\n\n                        // console.log('[OpenClawClient] Parsed message:', data?.type, data?.event || data?.method);\n                        this.handleMessage(data, resolve, reject);\n                    } catch (err) {\n                        console.error('[OpenClawClient] Failed to parse message:', err);\n                    }\n                };\n\n                this.ws.onerror = (error) => {\n                    console.error('[OpenClawClient] WebSocket error:', error);\n                    if (!this.isConnected) reject(error);\n                };\n\n                this.ws.onclose = () => {\n                    console.log('[OpenClawClient] WebSocket closed');\n                    this.isConnected = false;\n                    this.connectPromise = null;\n                };\n            } catch (err) {\n                reject(err);\n            }\n        });\n\n        return this.connectPromise;\n    }\n\n    private handleMessage(message: any, connectResolve: () => void, connectReject: (err: any) => void) {\n        // console.log('[OpenClawClient] Received:', message);\n\n        if (message.type === 'event' && message.event === 'connect.challenge') {\n            this.handleChallenge(message.payload, connectResolve, connectReject);\n            return;\n        }\n\n        if (message.type === 'res') {\n            const pending = this.pendingRequests.get(message.id);\n            if (pending) {\n                if (message.ok) {\n                    pending.resolve(message.body || message.payload); // Adapting to potential response format\n                } else {\n                    pending.reject(new Error(message.error?.message || 'Unknown error'));\n                }\n                this.pendingRequests.delete(message.id);\n            }\n            return;\n        }\n\n        if (message.type === 'event') {\n            const listeners = this.eventListeners.get(message.event);\n            if (listeners) {\n                listeners.forEach(handler => handler(message.payload));\n            }\n        }\n    }\n\n    private handleChallenge(payload: { nonce: string }, resolve: () => void, reject: (err: any) => void) {\n        const connectReq = {\n            type: 'req',\n            id: nanoid(),\n            method: 'connect',\n            params: {\n                minProtocol: PROTOCOL_VERSION,\n                maxProtocol: PROTOCOL_VERSION,\n                role: 'operator',\n                client: {\n                    id: 'webchat', // Bypass Control UI secure context check\n                    displayName: 'OpenClaw OS',\n                    version: '0.1.0',\n                    platform: 'web',\n                    mode: 'ui',\n                    deviceFamily: 'browser'\n                },\n                auth: { token: this.authToken }\n            }\n        };\n\n        if (this.ws) {\n            this.send(connectReq);\n            // We assume connection is successful if we don't get an immediate error? \n            // Or should we wait for a response? The protocol usually sends a generic 'res' for the connect req.\n\n            // Register a temporary handler for the connect response\n            this.pendingRequests.set(connectReq.id, {\n                resolve: () => {\n                    this.isConnected = true;\n                    resolve();\n                },\n                reject: (err) => {\n                    this.isConnected = false;\n                    reject(err);\n                }\n            });\n        }\n    }\n\n    private send(message: any) {\n        if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n            this.ws.send(JSON.stringify(message));\n        } else {\n            console.warn('[OpenClawClient] Cannot send, socket not open');\n        }\n    }\n\n    public async request(method: string, params: any = {}): Promise<any> {\n        await this.connect();\n        const id = nanoid();\n        return new Promise((resolve, reject) => {\n            this.pendingRequests.set(id, { resolve, reject });\n            this.send({\n                type: 'req',\n                id,\n                method,\n                params\n            });\n            // specific logic for timeout could be added here\n        });\n    }\n\n    public subscribe(event: string, handler: MessageHandler) {\n        if (!this.eventListeners.has(event)) {\n            this.eventListeners.set(event, new Set());\n        }\n        this.eventListeners.get(event)!.add(handler);\n        return () => {\n            this.eventListeners.get(event)?.delete(handler);\n        };\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,8CAA8C;AAC9C,MAAM,mBAAmB;AAclB,MAAM;IACD,KAAuB,KAAK;IAC5B,IAAY;IACZ,UAAmB;IACnB,kBAAkB,IAAI,MAA2E;IACjG,iBAAiB,IAAI,MAAmC;IACxD,cAAc,MAAM;IACpB,iBAAuC,KAAK;IAEpD,YAAY,MAA4B,CAAE;QACtC,IAAI,CAAC,GAAG,GAAG,OAAO,GAAG;QACrB,IAAI,CAAC,SAAS,GAAG,OAAO,SAAS;IACrC;IAEA,MAAM,UAAyB;QAC3B,IAAI,IAAI,CAAC,WAAW,EAAE;QACtB,IAAI,IAAI,CAAC,cAAc,EAAE,OAAO,IAAI,CAAC,cAAc;QAEnD,IAAI,CAAC,cAAc,GAAG,IAAI,QAAQ,CAAC,SAAS;YACxC,IAAI;gBACA,qDAAqD;gBACrD,MAAM,UAAU;oBACZ,SAAS;wBACL,QAAQ;oBACZ;gBACJ;gBACA,IAAI,CAAC,EAAE,GAAG,IAAI,gPAAS,CAAC,IAAI,CAAC,GAAG,EAAE;gBAElC,IAAI,CAAC,EAAE,CAAC,MAAM,GAAG;oBACb,QAAQ,GAAG,CAAC;gBAChB;gBAEA,IAAI,CAAC,EAAE,CAAC,SAAS,GAAG,CAAC;oBACjB,IAAI;wBACA,IAAI;wBACJ,MAAM,UAAU,MAAM,IAAI;wBAE1B,qEAAqE;wBAErE,IAAI,OAAO,YAAY,UAAU;4BAC7B,OAAO,KAAK,KAAK,CAAC;wBACtB,OAAO,IAAI,+HAAM,CAAC,QAAQ,CAAC,UAAU;4BACjC,4EAA4E;4BAC5E,OAAO,KAAK,KAAK,CAAC,QAAQ,QAAQ;wBACtC,OAAO,IAAI,mBAAmB,aAAa;4BACvC,yFAAyF;4BACzF,MAAM,UAAU,IAAI;4BACpB,OAAO,KAAK,KAAK,CAAC,QAAQ,MAAM,CAAC;wBACrC,OAAO,IAAI,MAAM,OAAO,CAAC,UAAU;4BAC/B,WAAW;4BACX,yDAAyD;4BACzD,OAAO,KAAK,KAAK,CAAC,+HAAM,CAAC,MAAM,CAAC,SAAS,QAAQ;wBACrD,OAAO;4BACH,UAAU;4BACV,QAAQ,IAAI,CAAC,0CAA0C,OAAO;4BAC9D;wBACJ;wBAEA,4FAA4F;wBAC5F,IAAI,CAAC,aAAa,CAAC,MAAM,SAAS;oBACtC,EAAE,OAAO,KAAK;wBACV,QAAQ,KAAK,CAAC,6CAA6C;oBAC/D;gBACJ;gBAEA,IAAI,CAAC,EAAE,CAAC,OAAO,GAAG,CAAC;oBACf,QAAQ,KAAK,CAAC,qCAAqC;oBACnD,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,OAAO;gBAClC;gBAEA,IAAI,CAAC,EAAE,CAAC,OAAO,GAAG;oBACd,QAAQ,GAAG,CAAC;oBACZ,IAAI,CAAC,WAAW,GAAG;oBACnB,IAAI,CAAC,cAAc,GAAG;gBAC1B;YACJ,EAAE,OAAO,KAAK;gBACV,OAAO;YACX;QACJ;QAEA,OAAO,IAAI,CAAC,cAAc;IAC9B;IAEQ,cAAc,OAAY,EAAE,cAA0B,EAAE,aAAiC,EAAE;QAC/F,sDAAsD;QAEtD,IAAI,QAAQ,IAAI,KAAK,WAAW,QAAQ,KAAK,KAAK,qBAAqB;YACnE,IAAI,CAAC,eAAe,CAAC,QAAQ,OAAO,EAAE,gBAAgB;YACtD;QACJ;QAEA,IAAI,QAAQ,IAAI,KAAK,OAAO;YACxB,MAAM,UAAU,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,QAAQ,EAAE;YACnD,IAAI,SAAS;gBACT,IAAI,QAAQ,EAAE,EAAE;oBACZ,QAAQ,OAAO,CAAC,QAAQ,IAAI,IAAI,QAAQ,OAAO,GAAG,wCAAwC;gBAC9F,OAAO;oBACH,QAAQ,MAAM,CAAC,IAAI,MAAM,QAAQ,KAAK,EAAE,WAAW;gBACvD;gBACA,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,QAAQ,EAAE;YAC1C;YACA;QACJ;QAEA,IAAI,QAAQ,IAAI,KAAK,SAAS;YAC1B,MAAM,YAAY,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,QAAQ,KAAK;YACvD,IAAI,WAAW;gBACX,UAAU,OAAO,CAAC,CAAA,UAAW,QAAQ,QAAQ,OAAO;YACxD;QACJ;IACJ;IAEQ,gBAAgB,OAA0B,EAAE,OAAmB,EAAE,MAA0B,EAAE;QACjG,MAAM,aAAa;YACf,MAAM;YACN,IAAI,IAAA,iOAAM;YACV,QAAQ;YACR,QAAQ;gBACJ,aAAa;gBACb,aAAa;gBACb,MAAM;gBACN,QAAQ;oBACJ,IAAI;oBACJ,aAAa;oBACb,SAAS;oBACT,UAAU;oBACV,MAAM;oBACN,cAAc;gBAClB;gBACA,MAAM;oBAAE,OAAO,IAAI,CAAC,SAAS;gBAAC;YAClC;QACJ;QAEA,IAAI,IAAI,CAAC,EAAE,EAAE;YACT,IAAI,CAAC,IAAI,CAAC;YACV,0EAA0E;YAC1E,oGAAoG;YAEpG,wDAAwD;YACxD,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,WAAW,EAAE,EAAE;gBACpC,SAAS;oBACL,IAAI,CAAC,WAAW,GAAG;oBACnB;gBACJ;gBACA,QAAQ,CAAC;oBACL,IAAI,CAAC,WAAW,GAAG;oBACnB,OAAO;gBACX;YACJ;QACJ;IACJ;IAEQ,KAAK,OAAY,EAAE;QACvB,IAAI,IAAI,CAAC,EAAE,IAAI,IAAI,CAAC,EAAE,CAAC,UAAU,KAAK,gPAAS,CAAC,IAAI,EAAE;YAClD,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,SAAS,CAAC;QAChC,OAAO;YACH,QAAQ,IAAI,CAAC;QACjB;IACJ;IAEA,MAAa,QAAQ,MAAc,EAAE,SAAc,CAAC,CAAC,EAAgB;QACjE,MAAM,IAAI,CAAC,OAAO;QAClB,MAAM,KAAK,IAAA,iOAAM;QACjB,OAAO,IAAI,QAAQ,CAAC,SAAS;YACzB,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,IAAI;gBAAE;gBAAS;YAAO;YAC/C,IAAI,CAAC,IAAI,CAAC;gBACN,MAAM;gBACN;gBACA;gBACA;YACJ;QACA,iDAAiD;QACrD;IACJ;IAEO,UAAU,KAAa,EAAE,OAAuB,EAAE;QACrD,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,QAAQ;YACjC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,OAAO,IAAI;QACvC;QACA,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,OAAQ,GAAG,CAAC;QACpC,OAAO;YACH,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,QAAQ,OAAO;QAC3C;IACJ;AACJ"}},
    {"offset": {"line": 201, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/lib/openclaw/client.ts"],"sourcesContent":["import { OpenClawClientImpl } from './client-impl';\n\n// Default to local gateway if not configured\nconst GATEWAY_URL = process.env.NEXT_PUBLIC_OPENCLAW_GATEWAY_URL || 'ws://localhost:3000';\nconst GATEWAY_TOKEN = process.env.NEXT_PUBLIC_OPENCLAW_GATEWAY_TOKEN || 'openclaw-admin-token'; // Default for dev\n\nclass OpenClawClient {\n  private static instance: OpenClawClientImpl;\n\n  public static getInstance(): OpenClawClientImpl {\n    if (!OpenClawClient.instance) {\n      OpenClawClient.instance = new OpenClawClientImpl({\n        url: GATEWAY_URL,\n        authToken: GATEWAY_TOKEN\n      });\n    }\n    return OpenClawClient.instance;\n  }\n}\n\nexport const openClaw = OpenClawClient.getInstance();\n\nexport const useOpenClaw = () => {\n  return openClaw;\n};\n\n// Shims for Convex compatibility\nexport class ConvexHttpClient {\n  constructor(private url: string) { }\n  // Add methods as needed\n  async query(name: string, args: any) { console.warn(\"ConvexHttpClient.query shim called\", name, args); return null; }\n  async mutation(name: string, args: any) { console.warn(\"ConvexHttpClient.mutation shim called\", name, args); return null; }\n  async action(name: string, args: any) { console.warn(\"ConvexHttpClient.action shim called\", name, args); return null; }\n}\n\nexport function makeFunctionReference(name: string) {\n  return name;\n}\n\nexport class ConvexReactClient {\n  constructor(private url: string) { }\n}\n\nexport const ConvexProvider = ({ client, children }: any) => children;\nexport const ConvexProviderWithClerk = ({ client, children }: any) => children;\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;;AAEA,6CAA6C;AAC7C,MAAM,cAAc,4DAAgD;AACpE,MAAM,gBAAgB,4DAAkD,wBAAwB,kBAAkB;AAElH,MAAM;IACJ,OAAe,SAA6B;IAE5C,OAAc,cAAkC;QAC9C,IAAI,CAAC,eAAe,QAAQ,EAAE;YAC5B,eAAe,QAAQ,GAAG,IAAI,wKAAkB,CAAC;gBAC/C,KAAK;gBACL,WAAW;YACb;QACF;QACA,OAAO,eAAe,QAAQ;IAChC;AACF;AAEO,MAAM,WAAW,eAAe,WAAW;AAE3C,MAAM,cAAc;IACzB,OAAO;AACT;AAGO,MAAM;;IACX,YAAY,AAAQ,GAAW,CAAE;aAAb,MAAA;IAAe;IACnC,wBAAwB;IACxB,MAAM,MAAM,IAAY,EAAE,IAAS,EAAE;QAAE,QAAQ,IAAI,CAAC,sCAAsC,MAAM;QAAO,OAAO;IAAM;IACpH,MAAM,SAAS,IAAY,EAAE,IAAS,EAAE;QAAE,QAAQ,IAAI,CAAC,yCAAyC,MAAM;QAAO,OAAO;IAAM;IAC1H,MAAM,OAAO,IAAY,EAAE,IAAS,EAAE;QAAE,QAAQ,IAAI,CAAC,uCAAuC,MAAM;QAAO,OAAO;IAAM;AACxH;AAEO,SAAS,sBAAsB,IAAY;IAChD,OAAO;AACT;AAEO,MAAM;;IACX,YAAY,AAAQ,GAAW,CAAE;aAAb,MAAA;IAAe;AACrC;AAEO,MAAM,iBAAiB,CAAC,EAAE,MAAM,EAAE,QAAQ,EAAO,GAAK;AACtD,MAAM,0BAA0B,CAAC,EAAE,MAAM,EAAE,QAAQ,EAAO,GAAK"}},
    {"offset": {"line": 272, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/lib/security.ts"],"sourcesContent":["/**\n * Security Monitoring Library\n *\n * Client-side utilities for security event logging and device fingerprinting.\n */\n\nimport { ConvexHttpClient } from \"@/lib/openclaw/client\";\nimport { makeFunctionReference } from \"@/lib/openclaw/client\";\n\n// Lazy-initialized Convex client for server-side logging\nlet _convexSecurityClient: ConvexHttpClient | null = null;\nfunction getSecurityConvexClient(): ConvexHttpClient | null {\n  if (_convexSecurityClient === null && process.env.NEXT_PUBLIC_CONVEX_URL) {\n    _convexSecurityClient = new ConvexHttpClient(process.env.NEXT_PUBLIC_CONVEX_URL);\n  }\n  return _convexSecurityClient;\n}\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport type SecurityEventType =\n  | \"admin_login_success\"\n  | \"admin_login_failed\"\n  | \"admin_logout\"\n  | \"passcode_unlock_success\"\n  | \"passcode_unlock_failed\"\n  | \"ipod_auth_success\"\n  | \"ipod_auth_failed\"\n  | \"clerk_signin\"\n  | \"clerk_signout\"\n  | \"api_request\"\n  | \"api_error\"\n  | \"rate_limit_hit\"\n  | \"brute_force_attempt\"\n  | \"suspicious_ip\"\n  | \"session_hijack_attempt\"\n  | \"invalid_token\"\n  | \"geo_anomaly\"\n  | \"system_alert\"\n  | \"config_change\";\n\nexport type SecuritySeverity = \"info\" | \"warning\" | \"critical\" | \"alert\";\n\nexport type ActorType =\n  | \"anonymous\"\n  | \"admin\"\n  | \"user\"\n  | \"collaborator\"\n  | \"system\";\n\nexport interface SecurityEventPayload {\n  eventType: SecurityEventType;\n  severity: SecuritySeverity;\n  actorType: ActorType;\n  actorId?: string;\n  actorEmail?: string;\n  message: string;\n  metadata?: Record<string, unknown>;\n  targetResource?: string;\n  targetId?: string;\n}\n\nexport interface GeoData {\n  country?: string;\n  region?: string;\n  city?: string;\n  latitude?: number;\n  longitude?: number;\n}\n\nexport interface DeviceInfo {\n  fingerprint?: string;\n  deviceType?: string;\n  browser?: string;\n  os?: string;\n}\n\n// =============================================================================\n// Device Detection\n// =============================================================================\n\n/**\n * Parse user agent to extract device info\n */\nexport function parseUserAgent(ua: string): DeviceInfo {\n  const info: DeviceInfo = {};\n\n  // Detect device type\n  if (/bot|crawler|spider|crawling/i.test(ua)) {\n    info.deviceType = \"bot\";\n  } else if (/mobile|android|iphone|ipad|ipod|blackberry|windows phone/i.test(ua)) {\n    if (/ipad|tablet|playbook|silk/i.test(ua)) {\n      info.deviceType = \"tablet\";\n    } else {\n      info.deviceType = \"mobile\";\n    }\n  } else {\n    info.deviceType = \"desktop\";\n  }\n\n  // Detect browser\n  if (/firefox/i.test(ua)) {\n    info.browser = \"Firefox\";\n  } else if (/edg/i.test(ua)) {\n    info.browser = \"Edge\";\n  } else if (/chrome|chromium|crios/i.test(ua)) {\n    info.browser = \"Chrome\";\n  } else if (/safari/i.test(ua)) {\n    info.browser = \"Safari\";\n  } else if (/opera|opr/i.test(ua)) {\n    info.browser = \"Opera\";\n  } else if (/msie|trident/i.test(ua)) {\n    info.browser = \"IE\";\n  } else {\n    info.browser = \"Unknown\";\n  }\n\n  // Detect OS\n  if (/windows/i.test(ua)) {\n    info.os = \"Windows\";\n  } else if (/macintosh|mac os x/i.test(ua)) {\n    info.os = \"macOS\";\n  } else if (/linux/i.test(ua)) {\n    info.os = \"Linux\";\n  } else if (/android/i.test(ua)) {\n    info.os = \"Android\";\n  } else if (/iphone|ipad|ipod/i.test(ua)) {\n    info.os = \"iOS\";\n  } else {\n    info.os = \"Unknown\";\n  }\n\n  return info;\n}\n\n/**\n * Generate a simple device fingerprint (server-side)\n */\nexport function generateFingerprint(\n  ip: string,\n  ua: string,\n  acceptLanguage?: string\n): string {\n  // Create a simple hash from available data\n  const data = `${ip}|${ua}|${acceptLanguage || \"\"}`;\n  let hash = 0;\n  for (let i = 0; i < data.length; i++) {\n    const char = data.charCodeAt(i);\n    hash = (hash << 5) - hash + char;\n    hash = hash & hash; // Convert to 32-bit integer\n  }\n  return Math.abs(hash).toString(16).padStart(8, \"0\");\n}\n\n// =============================================================================\n// Server-Side Logging (for API routes)\n// =============================================================================\n\n/**\n * Log a security event from a server-side context (API route)\n */\nexport async function logSecurityEvent(\n  payload: SecurityEventPayload,\n  request: Request,\n  geoData?: GeoData\n): Promise<void> {\n  try {\n    const client = getSecurityConvexClient();\n    if (!client) {\n      console.warn(\"[Security] Convex client not available, logging to console only\");\n      console.log(\"[Security Event]\", payload.eventType, payload.message);\n      return;\n    }\n\n    const ip = getClientIp(request);\n    const userAgent = request.headers.get(\"user-agent\") || \"unknown\";\n    const deviceInfo = parseUserAgent(userAgent);\n    const fingerprint = generateFingerprint(ip, userAgent);\n\n    // Use makeFunctionReference to avoid type generation dependency\n    const logSecurityEventMutation = makeFunctionReference<\n      \"mutation\",\n      {\n        eventType: SecurityEventType;\n        severity: SecuritySeverity;\n        actorType: ActorType;\n        actorId?: string;\n        actorEmail?: string;\n        message: string;\n        metadata?: Record<string, unknown>;\n        targetResource?: string;\n        targetId?: string;\n        ipAddress: string;\n        userAgent: string;\n        fingerprint: string;\n        deviceType?: string;\n        browser?: string;\n        os?: string;\n        country?: string;\n        region?: string;\n        city?: string;\n      },\n      void\n    >(\"security:logSecurityEvent\");\n\n    await client.mutation(logSecurityEventMutation, {\n      eventType: payload.eventType,\n      severity: payload.severity,\n      actorType: payload.actorType,\n      actorId: payload.actorId,\n      actorEmail: payload.actorEmail,\n      message: payload.message,\n      metadata: payload.metadata,\n      targetResource: payload.targetResource,\n      targetId: payload.targetId,\n      ipAddress: ip,\n      userAgent,\n      fingerprint,\n      deviceType: deviceInfo.deviceType,\n      browser: deviceInfo.browser,\n      os: deviceInfo.os,\n      country: geoData?.country,\n      region: geoData?.region,\n      city: geoData?.city,\n    });\n\n    console.log(\"[Security] Event logged:\", payload.eventType, payload.severity);\n  } catch (error) {\n    // Log to console as fallback, never fail silently\n    console.error(\"[Security] Failed to log event to Convex:\", error);\n    console.log(\"[Security Event Fallback]\", payload.eventType, payload.message);\n  }\n}\n\n/**\n * Extract client IP from request headers\n * Handles Vercel, Cloudflare, and standard proxies\n */\nexport function getClientIp(request: Request): string {\n  // Try various headers in order of preference\n  const headers = request.headers;\n\n  // Vercel\n  const vercelIp = headers.get(\"x-vercel-forwarded-for\");\n  if (vercelIp) {\n    return vercelIp.split(\",\")[0].trim();\n  }\n\n  // Cloudflare\n  const cfIp = headers.get(\"cf-connecting-ip\");\n  if (cfIp) {\n    return cfIp;\n  }\n\n  // Standard proxy header\n  const forwardedFor = headers.get(\"x-forwarded-for\");\n  if (forwardedFor) {\n    return forwardedFor.split(\",\")[0].trim();\n  }\n\n  // Real IP header\n  const realIp = headers.get(\"x-real-ip\");\n  if (realIp) {\n    return realIp;\n  }\n\n  // Fallback\n  return \"unknown\";\n}\n\n// =============================================================================\n// Rate Limiting Helper\n// =============================================================================\n\n// In-memory rate limit tracker (use Redis in production)\nconst rateLimitMap = new Map<string, { count: number; resetAt: number }>();\n\nexport interface RateLimitConfig {\n  windowMs: number; // Time window in milliseconds\n  maxRequests: number; // Max requests per window\n}\n\nexport interface RateLimitResult {\n  allowed: boolean;\n  remaining: number;\n  resetAt: number;\n}\n\n/**\n * Check and update rate limit for a key (IP, user ID, etc.)\n */\nexport function checkRateLimit(\n  key: string,\n  config: RateLimitConfig\n): RateLimitResult {\n  const now = Date.now();\n  const existing = rateLimitMap.get(key);\n\n  if (!existing || existing.resetAt < now) {\n    // New window\n    const resetAt = now + config.windowMs;\n    rateLimitMap.set(key, { count: 1, resetAt });\n    return {\n      allowed: true,\n      remaining: config.maxRequests - 1,\n      resetAt,\n    };\n  }\n\n  if (existing.count >= config.maxRequests) {\n    return {\n      allowed: false,\n      remaining: 0,\n      resetAt: existing.resetAt,\n    };\n  }\n\n  existing.count++;\n  return {\n    allowed: true,\n    remaining: config.maxRequests - existing.count,\n    resetAt: existing.resetAt,\n  };\n}\n\n// Clean up old rate limit entries periodically\nif (typeof setInterval !== \"undefined\") {\n  setInterval(() => {\n    const now = Date.now();\n    for (const [key, value] of rateLimitMap.entries()) {\n      if (value.resetAt < now) {\n        rateLimitMap.delete(key);\n      }\n    }\n  }, 60000); // Clean up every minute\n}\n\n// =============================================================================\n// Brute Force Detection\n// =============================================================================\n\n// Track failed attempts per IP\nconst failedAttempts = new Map<\n  string,\n  { count: number; firstAttempt: number }\n>();\n\nexport interface BruteForceConfig {\n  maxAttempts: number; // Max failed attempts before flagging\n  windowMs: number; // Time window to count attempts\n}\n\n/**\n * Record a failed attempt and check for brute force\n */\nexport function recordFailedAttempt(\n  ip: string,\n  config: BruteForceConfig = { maxAttempts: 5, windowMs: 15 * 60 * 1000 }\n): boolean {\n  const now = Date.now();\n  const existing = failedAttempts.get(ip);\n\n  if (!existing || now - existing.firstAttempt > config.windowMs) {\n    // New window\n    failedAttempts.set(ip, { count: 1, firstAttempt: now });\n    return false;\n  }\n\n  existing.count++;\n  return existing.count >= config.maxAttempts;\n}\n\n/**\n * Clear failed attempts for an IP (call on successful login)\n */\nexport function clearFailedAttempts(ip: string): void {\n  failedAttempts.delete(ip);\n}\n\n// =============================================================================\n// Geo Lookup (using ip-api.com - free for non-commercial)\n// =============================================================================\n\nconst geoCache = new Map<string, { data: GeoData; cachedAt: number }>();\nconst GEO_CACHE_TTL = 24 * 60 * 60 * 1000; // 24 hours\n\n/**\n * Look up geolocation for an IP address\n */\nexport async function lookupGeo(ip: string): Promise<GeoData | null> {\n  // Skip local/private IPs\n  if (\n    ip === \"unknown\" ||\n    ip === \"127.0.0.1\" ||\n    ip.startsWith(\"192.168.\") ||\n    ip.startsWith(\"10.\") ||\n    ip.startsWith(\"172.\")\n  ) {\n    return null;\n  }\n\n  // Check cache\n  const cached = geoCache.get(ip);\n  if (cached && Date.now() - cached.cachedAt < GEO_CACHE_TTL) {\n    return cached.data;\n  }\n\n  try {\n    const response = await fetch(\n      `http://ip-api.com/json/${ip}?fields=country,regionName,city,lat,lon`,\n      { signal: AbortSignal.timeout(2000) }\n    );\n\n    if (!response.ok) {\n      return null;\n    }\n\n    const data = await response.json();\n\n    if (data.status === \"fail\") {\n      return null;\n    }\n\n    const geoData: GeoData = {\n      country: data.country,\n      region: data.regionName,\n      city: data.city,\n      latitude: data.lat,\n      longitude: data.lon,\n    };\n\n    // Cache the result\n    geoCache.set(ip, { data: geoData, cachedAt: Date.now() });\n\n    return geoData;\n  } catch {\n    return null;\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 547, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/app/api/tts/route.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\nimport { checkRateLimit, getClientIp } from '@/lib/security';\n\nexport const runtime = 'edge';\n\n// Rate limit: 10 TTS requests per minute per IP\nconst RATE_LIMIT_CONFIG = { windowMs: 60 * 1000, maxRequests: 10 };\n\n// OpenAI TTS voices\nexport type TTSVoice = 'alloy' | 'echo' | 'fable' | 'onyx' | 'nova' | 'shimmer';\n\n// OpenAI TTS models\nexport type TTSModel = 'tts-1' | 'tts-1-hd';\n\ninterface TTSRequestBody {\n  text: string;\n  voice?: TTSVoice;\n  model?: TTSModel;\n  speed?: number; // 0.25 to 4.0\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    // SECURITY: Rate limiting to prevent API abuse\n    const clientIp = getClientIp(request);\n    const rateLimit = checkRateLimit(`tts:${clientIp}`, RATE_LIMIT_CONFIG);\n\n    if (!rateLimit.allowed) {\n      return new Response(\n        JSON.stringify({\n          error: 'Rate limit exceeded. Please wait before making more requests.',\n          retryAfter: Math.ceil((rateLimit.resetAt - Date.now()) / 1000)\n        }),\n        {\n          status: 429,\n          headers: {\n            'Content-Type': 'application/json',\n            'Retry-After': String(Math.ceil((rateLimit.resetAt - Date.now()) / 1000))\n          }\n        }\n      );\n    }\n\n    const body: TTSRequestBody = await request.json();\n    const {\n      text,\n      voice = 'nova', // Nova is warm and conversational - perfect for Claw AI\n      model = 'tts-1-hd', // HD for better quality\n      speed = 1.0\n    } = body;\n\n    if (!text || typeof text !== 'string') {\n      return new Response(JSON.stringify({ error: 'Text is required' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    // Limit text length to prevent abuse (OpenAI limit is 4096 chars)\n    if (text.length > 4096) {\n      return new Response(JSON.stringify({ error: 'Text too long (max 4096 characters)' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    const apiKey = process.env.OPENAI_API_KEY;\n    if (!apiKey) {\n      return new Response(JSON.stringify({ error: 'OpenAI API key not configured' }), {\n        status: 500,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    // Call OpenAI TTS API\n    const response = await fetch('https://api.openai.com/v1/audio/speech', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${apiKey}`,\n      },\n      body: JSON.stringify({\n        model,\n        input: text,\n        voice,\n        speed,\n        response_format: 'mp3', // mp3 is widely supported and streams well\n      }),\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      console.error('OpenAI TTS API error:', errorText);\n      return new Response(JSON.stringify({ error: 'Failed to generate speech' }), {\n        status: 500,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    // Stream the audio response\n    const audioStream = response.body;\n    if (!audioStream) {\n      return new Response(JSON.stringify({ error: 'No audio stream received' }), {\n        status: 500,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    // Return the audio stream with appropriate headers\n    return new Response(audioStream, {\n      headers: {\n        'Content-Type': 'audio/mpeg',\n        'Cache-Control': 'no-cache',\n        'Transfer-Encoding': 'chunked',\n      },\n    });\n  } catch (error) {\n    console.error('TTS API error:', error);\n    return new Response(JSON.stringify({ error: 'Internal server error' }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n}\n"],"names":[],"mappings":";;;;;;AACA;;AAEO,MAAM,UAAU;AAEvB,gDAAgD;AAChD,MAAM,oBAAoB;IAAE,UAAU,KAAK;IAAM,aAAa;AAAG;AAe1D,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,+CAA+C;QAC/C,MAAM,WAAW,IAAA,+IAAW,EAAC;QAC7B,MAAM,YAAY,IAAA,kJAAc,EAAC,CAAC,IAAI,EAAE,UAAU,EAAE;QAEpD,IAAI,CAAC,UAAU,OAAO,EAAE;YACtB,OAAO,IAAI,SACT,KAAK,SAAS,CAAC;gBACb,OAAO;gBACP,YAAY,KAAK,IAAI,CAAC,CAAC,UAAU,OAAO,GAAG,KAAK,GAAG,EAAE,IAAI;YAC3D,IACA;gBACE,QAAQ;gBACR,SAAS;oBACP,gBAAgB;oBAChB,eAAe,OAAO,KAAK,IAAI,CAAC,CAAC,UAAU,OAAO,GAAG,KAAK,GAAG,EAAE,IAAI;gBACrE;YACF;QAEJ;QAEA,MAAM,OAAuB,MAAM,QAAQ,IAAI;QAC/C,MAAM,EACJ,IAAI,EACJ,QAAQ,MAAM,EACd,QAAQ,UAAU,EAClB,QAAQ,GAAG,EACZ,GAAG;QAEJ,IAAI,CAAC,QAAQ,OAAO,SAAS,UAAU;YACrC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAAmB,IAAI;gBACjE,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QACF;QAEA,kEAAkE;QAClE,IAAI,KAAK,MAAM,GAAG,MAAM;YACtB,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAAsC,IAAI;gBACpF,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QACF;QAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;QACzC,IAAI,CAAC,QAAQ;YACX,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAAgC,IAAI;gBAC9E,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QACF;QAEA,sBAAsB;QACtB,MAAM,WAAW,MAAM,MAAM,0CAA0C;YACrE,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB,CAAC,OAAO,EAAE,QAAQ;YACrC;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB;gBACA,OAAO;gBACP;gBACA;gBACA,iBAAiB;YACnB;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,QAAQ,KAAK,CAAC,yBAAyB;YACvC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAA4B,IAAI;gBAC1E,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QACF;QAEA,4BAA4B;QAC5B,MAAM,cAAc,SAAS,IAAI;QACjC,IAAI,CAAC,aAAa;YAChB,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAA2B,IAAI;gBACzE,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QACF;QAEA,mDAAmD;QACnD,OAAO,IAAI,SAAS,aAAa;YAC/B,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB;gBACjB,qBAAqB;YACvB;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kBAAkB;QAChC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,OAAO;QAAwB,IAAI;YACtE,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IACF;AACF"}}]
}