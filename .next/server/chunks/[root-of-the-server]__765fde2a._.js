module.exports=[918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},666680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},524836,(e,t,r)=>{t.exports=e.x("https",()=>require("https"))},921517,(e,t,r)=>{t.exports=e.x("http",()=>require("http"))},504446,(e,t,r)=>{t.exports=e.x("net",()=>require("net"))},755004,(e,t,r)=>{t.exports=e.x("tls",()=>require("tls"))},792509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},500874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},427699,(e,t,r)=>{t.exports=e.x("events",()=>require("events"))},688947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},406461,(e,t,r)=>{t.exports=e.x("zlib",()=>require("zlib"))},857764,(e,t,r)=>{t.exports=e.x("node:url",()=>require("node:url"))},572067,e=>{"use strict";e.i(39334);let t=async()=>({id:"mock-user-id",firstName:"James",lastName:"Spalding",emailAddresses:[{emailAddress:"james@example.com"}]});e.s(["auth",0,()=>({userId:"mock-user-id",sessionId:"mock-session-id",getToken:async()=>"mock-token",redirectToSignIn:()=>({})}),"clerkClient",0,{users:{getUser:async()=>t()}}])},951615,(e,t,r)=>{t.exports=e.x("node:buffer",()=>require("node:buffer"))},478500,(e,t,r)=>{t.exports=e.x("node:async_hooks",()=>require("node:async_hooks"))},812057,(e,t,r)=>{t.exports=e.x("node:util",()=>require("node:util"))},63723,(e,t,r)=>{function o(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}t.exports=o,o.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},o.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},o.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r)if(!this._cachedTimeouts)return!1;else this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);var o=this;return this._timer=setTimeout(function(){o._attempts++,o._operationTimeoutCb&&(o._timeout=setTimeout(function(){o._operationTimeoutCb(o._attempts)},o._operationTimeout),o._options.unref&&o._timeout.unref()),o._fn(o._attempts)},r),this._options.unref&&this._timer.unref(),!0},o.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},o.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},o.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},o.prototype.start=o.prototype.try,o.prototype.errors=function(){return this._errors},o.prototype.attempts=function(){return this._attempts},o.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,o=0;o<this._errors.length;o++){var i=this._errors[o],n=i.message,s=(e[n]||0)+1;e[n]=s,s>=r&&(t=i,r=s)}return t}},210978,(e,t,r)=>{var o=e.r(63723);r.operation=function(e){return new o(r.timeouts(e),{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},r.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var o=[],i=0;i<t.retries;i++)o.push(this.createTimeout(i,t));return e&&e.forever&&!o.length&&o.push(this.createTimeout(i,t)),o.sort(function(e,t){return e-t}),o},r.createTimeout=function(e,t){var r=Math.round((t.randomize?Math.random()+1:1)*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(r,t.maxTimeout)},r.wrap=function(e,t,o){if(t instanceof Array&&(o=t,t=null),!o)for(var i in o=[],e)"function"==typeof e[i]&&o.push(i);for(var n=0;n<o.length;n++){var s=o[n],a=e[s];e[s]=(function(o){var i=r.operation(t),n=Array.prototype.slice.call(arguments,1),s=n.pop();n.push(function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),s.apply(this,arguments))}),i.attempt(function(){o.apply(e,n)})}).bind(e,a),e[s].options=t}}},61347,(e,t,r)=>{t.exports=e.r(210978)},289492,(e,t,r)=>{var o=e.r(61347);t.exports=function(e,t){return new Promise(function(r,i){var n,s=t||{};function a(e){i(e||Error("Aborted"))}function u(e,t){e.bail?a(e):n.retry(e)?s.onRetry&&s.onRetry(e,t):i(n.mainError())}"randomize"in s||(s.randomize=!0),(n=o.operation(s)).attempt(function(t){var o;try{o=e(a,t)}catch(e){u(e,t);return}Promise.resolve(o).then(r).catch(function(e){u(e,t)})})})}},57328,(e,t,r)=>{t.exports=e.x("node:assert",()=>require("node:assert"))},347299,(e,t,r)=>{t.exports=e.x("node:http",()=>require("node:http"))},81111,(e,t,r)=>{t.exports=e.x("node:stream",()=>require("node:stream"))},761095,(e,t,r)=>{t.exports=e.x("node:net",()=>require("node:net"))},483324,(e,t,r)=>{t.exports=e.x("node:querystring",()=>require("node:querystring"))},687769,(e,t,r)=>{t.exports=e.x("node:events",()=>require("node:events"))},727028,(e,t,r)=>{t.exports=e.x("node:zlib",()=>require("node:zlib"))},874096,(e,t,r)=>{t.exports=e.x("node:perf_hooks",()=>require("node:perf_hooks"))},107417,(e,t,r)=>{t.exports=e.x("node:util/types",()=>require("node:util/types"))},925127,(e,t,r)=>{t.exports=e.x("node:worker_threads",()=>require("node:worker_threads"))},677652,(e,t,r)=>{t.exports=e.x("node:diagnostics_channel",()=>require("node:diagnostics_channel"))},685560,(e,t,r)=>{t.exports=e.x("node:tls",()=>require("node:tls"))},246479,(e,t,r)=>{t.exports=e.x("node:http2",()=>require("node:http2"))},241293,(e,t,r)=>{t.exports=e.x("node:console",()=>require("node:console"))},495879,(e,t,r)=>{t.exports=e.x("node:dns",()=>require("node:dns"))},65269,e=>{"use strict";var t=e.i(457375),r=e.i(174015),o=e.i(116384),i=e.i(63831),n=e.i(868001),s=e.i(842780),a=e.i(763077),u=e.i(502964),p=e.i(993216),l=e.i(783900),d=e.i(295731),c=e.i(726839),m=e.i(775778),h=e.i(40992),x=e.i(432128),f=e.i(193695);e.i(44807);var v=e.i(989978),_=e.i(194639),y=e.i(39334),g=e.i(572067),R=e.i(848920);async function T(){try{let{userId:e}=await (0,g.auth)();if(!e)return!1;let t=process.env.NEXT_PUBLIC_CONVEX_URL;if(!t)return!1;let r=new R.ConvexHttpClient(t),o=(0,R.makeFunctionReference)("userManagement:getManagedUserByClerkId"),i=await r.query(o,{clerkId:e});return i?.role==="owner"}catch{return!1}}let w=["image/jpeg","image/png","image/webp","image/gif","image/svg+xml"],q=["audio/mpeg","audio/wav","audio/ogg","audio/mp4","audio/aac","audio/x-m4a","audio/webm"],b=["video/mp4","video/webm","video/ogg","video/quicktime"];async function E(e){if(!await T())return y.NextResponse.json({error:"Unauthorized"},{status:401});try{var t;let r=(await e.formData()).get("file");if(!r)return y.NextResponse.json({error:"No file provided"},{status:400});let o=(t=r.type,w.includes(t)?"image":q.includes(t)?"audio":b.includes(t)?"video":null);if(!o)return y.NextResponse.json({error:`Unsupported file type: ${r.type}`},{status:400});let i=`canvas/${o}`,n=r.name.replace(/[^a-zA-Z0-9.-]/g,"_"),s=`${i}/${Date.now()}-${n}`,a=await (0,_.put)(s,r,{access:"public",addRandomSuffix:!1});return y.NextResponse.json({url:a.url,filename:r.name,size:r.size,mimeType:r.type,mediaType:o})}catch(e){return console.error("Canvas upload error:",e),y.NextResponse.json({error:"Failed to upload file"},{status:500})}}e.s(["POST",()=>E],621445);var C=e.i(621445);let k=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/canvas/upload/route",pathname:"/api/canvas/upload",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/canvas/upload/route.ts",nextConfigOutput:"",userland:C}),{workAsyncStorage:A,workUnitAsyncStorage:N,serverHooks:O}=k;function S(){return(0,o.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:N})}async function P(e,t,o){k.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let _="/api/canvas/upload/route";_=_.replace(/\/index$/,"")||"/";let y=await k.prepare(e,t,{srcPage:_,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve()),null;let{buildId:g,params:R,nextConfig:T,parsedUrl:w,isDraftMode:q,prerenderManifest:b,routerServerContext:E,isOnDemandRevalidate:C,revalidateOnlyGenerated:A,resolvedPathname:N,clientReferenceManifest:O,serverActionsManifest:S}=y,P=(0,a.normalizeAppPath)(_),j=!!(b.dynamicRoutes[P]||b.routes[N]),U=async()=>((null==E?void 0:E.render404)?await E.render404(e,t,w,!1):t.end("This page could not be found"),null);if(j&&!q){let e=!!b.routes[N],t=b.dynamicRoutes[P];if(t&&!1===t.fallback&&!e){if(T.experimental.adapterPath)return await U();throw new f.NoFallbackError}}let I=null;!j||k.isDev||q||(I="/index"===(I=N)?"/":I);let M=!0===k.isDev||!j,H=j&&!M;S&&O&&(0,s.setManifestsSingleton)({page:_,clientReferenceManifest:O,serverActionsManifest:S});let D=e.method||"GET",$=(0,n.getTracer)(),z=$.getActiveScopeSpan(),F={params:R,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:o.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,o,i)=>k.onRequestError(e,t,o,i,E)},sharedContext:{buildId:g}},K=new u.NodeNextRequest(e),B=new u.NodeNextResponse(t),L=p.NextRequestAdapter.fromNodeNextRequest(K,(0,p.signalFromNodeResponse)(t));try{let s=async e=>k.handle(L,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=$.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=r.get("next.route");if(o){let t=`${D} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${D} ${_}`)}),a=!!(0,i.getRequestMeta)(e,"minimalMode"),u=async i=>{var n,u;let p=async({previousCacheEntry:r})=>{try{if(!a&&C&&A&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await s(i);e.fetchMetrics=F.renderOpts.fetchMetrics;let u=F.renderOpts.pendingWaitUntil;u&&o.waitUntil&&(o.waitUntil(u),u=void 0);let p=F.renderOpts.collectedTags;if(!j)return await (0,c.sendResponse)(K,B,n,F.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(n.headers);p&&(t[x.NEXT_CACHE_TAGS_HEADER]=p),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=x.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,o=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=x.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:o}}}}catch(t){throw(null==r?void 0:r.isStale)&&await k.onRequestError(e,t,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:C})},!1,E),t}},l=await k.handleResponse({req:e,nextConfig:T,cacheKey:I,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:A,responseGenerator:p,waitUntil:o.waitUntil,isMinimalMode:a});if(!j)return null;if((null==l||null==(n=l.value)?void 0:n.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(u=l.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});a||t.setHeader("x-nextjs-cache",C?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),q&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,m.fromNodeOutgoingHttpHeaders)(l.value.headers);return a&&j||f.delete(x.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,h.getCacheControlHeader)(l.cacheControl)),await (0,c.sendResponse)(K,B,new Response(l.value.body,{headers:f,status:l.value.status||200})),null};z?await u(z):await $.withPropagatedContext(e.headers,()=>$.trace(l.BaseServerSpan.handleRequest,{spanName:`${D} ${_}`,kind:n.SpanKind.SERVER,attributes:{"http.method":D,"http.target":e.url}},u))}catch(t){if(t instanceof f.NoFallbackError||await k.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:C})},!1,E),j)throw t;return await (0,c.sendResponse)(K,B,new Response(null,{status:500})),null}}e.s(["handler",()=>P,"patchFetch",()=>S,"routeModule",()=>k,"serverHooks",()=>O,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>N],65269)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__765fde2a._.js.map