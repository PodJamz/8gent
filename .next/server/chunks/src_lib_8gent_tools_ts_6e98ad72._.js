module.exports=[379970,245870,e=>{"use strict";let t=["home","story","design","resume","projects","blog","music","humans","themes","photos","search","video","canvas"],r=[{name:"search_system",description:"Search through the system including projects, skills, work experience, and educational architecture. Use this when users ask about system capabilities, background, or modules.",parameters:{type:"object",properties:{query:{type:"string",description:"The search query. Can be a technology name (React, AI), skill, company name, project name, or general topic."},category:{type:"string",description:"Optional filter by category",enum:["projects","skills","work","education","all"]}},required:["query"]}},{name:"navigate_to",description:"Navigate the user to a specific page in the workspace. Use this when users want to see specific content like the design showcase, system modules, projects, blog, or music.",parameters:{type:"object",properties:{destination:{type:"string",description:"The page to navigate to",enum:[...t]},theme:{type:"string",description:'Optional theme name to apply when navigating (e.g., "claude", "cyberpunk", "nature")'}},required:["destination"]}},{name:"schedule_call",description:"Open the calendar to schedule a call with the system owner. Use this when users express interest in connecting or collaborating.",parameters:{type:"object",properties:{topic:{type:"string",description:"The topic or reason for the call to prefill in the calendar"}},required:[]}},{name:"get_available_times",description:"Get available meeting times for a specific date. Use this when users ask about availability or want to know when they can schedule a meeting.",parameters:{type:"object",properties:{date:{type:"string",description:"The date to check availability for in YYYY-MM-DD format. If not provided, defaults to today."},duration:{type:"number",description:"The meeting duration in minutes. Defaults to 30 minutes if not specified."}},required:[]}},{name:"get_upcoming_bookings",description:"Get the upcoming scheduled meetings. Use this when users ask about the schedule or upcoming appointments.",parameters:{type:"object",properties:{limit:{type:"number",description:"Maximum number of bookings to return. Defaults to 5."}},required:[]}},{name:"book_meeting",description:"Book a meeting directly. Use this when a user wants to schedule a specific time slot and has provided their name and email.",parameters:{type:"object",properties:{guestName:{type:"string",description:"The name of the person booking the meeting."},guestEmail:{type:"string",description:"The email address of the person booking the meeting."},startTime:{type:"number",description:"The Unix timestamp for the meeting start time."},topic:{type:"string",description:"The topic or reason for the meeting."},duration:{type:"number",description:"Meeting duration in minutes. Defaults to 30."}},required:["guestName","guestEmail","startTime"]}},{name:"reschedule_meeting",description:"Reschedule an existing meeting to a new time. Use this when a user wants to change the time of an already scheduled meeting.",parameters:{type:"object",properties:{bookingId:{type:"string",description:"The ID of the booking to reschedule."},newStartTime:{type:"number",description:"The new Unix timestamp for the meeting start time."}},required:["bookingId","newStartTime"]}},{name:"cancel_meeting",description:"Cancel a scheduled meeting. Use this when a user wants to cancel an existing booking.",parameters:{type:"object",properties:{bookingId:{type:"string",description:"The ID of the booking to cancel."},reason:{type:"string",description:"Optional reason for cancellation."}},required:["bookingId"]}},{name:"list_themes",description:"List all available design themes in the workspace. Use this when users ask about themes, design options, or want to explore the design showcase.",parameters:{type:"object",properties:{category:{type:"string",description:"Optional filter by theme style",enum:["all","dark","light","colorful","minimal"]}},required:[]}},{name:"open_search_app",description:"Open the Search app with a specific query. Use this when users want to explore search results in detail, or when search results would be better viewed in the full Search app rather than inline in chat. This closes the 8gent chat and opens the Search app with the query pre-filled.",parameters:{type:"object",properties:{query:{type:"string",description:"The search query to pre-fill in the Search app"}},required:["query"]}},{name:"show_weather",description:"Display a weather widget in the chat. Use this when users ask about weather or want to see current conditions.",parameters:{type:"object",properties:{location:{type:"string",description:"The location for weather (defaults to San Francisco)"}},required:[]}},{name:"show_kanban_tasks",description:"Display kanban tasks/tickets in the chat. Use this when users ask about projects, tasks, or want to see the roadmap.",parameters:{type:"object",properties:{filter:{type:"string",description:"Filter tasks by status",enum:["all","todo","in-progress","done","backlog"]},tag:{type:"string",description:'Optional tag to filter by (e.g., "P8", "claw-ai")'},limit:{type:"number",description:"Maximum number of tasks to show (default 5)"}},required:[]}},{name:"show_photos",description:"Display photos from the gallery in the chat. Use this when users ask to see photos, images, or the gallery.",parameters:{type:"object",properties:{count:{type:"number",description:"Number of photos to show (default 6)"}},required:[]}},{name:"render_ui",description:"Render custom UI components in the chat using a JSON UI tree. Use this to display rich, interactive UI when the built-in tools are not sufficient. You can create cards, lists, charts, stats, timelines, and many other components. The UI tree uses a flat structure with a root element and nested children.",parameters:{type:"object",properties:{ui_tree:{type:"object",description:'A UI tree object with "root" (string key) and "elements" (object mapping keys to element definitions). Each element has: type (component name), props (component props), children (optional array of child keys), and key (unique identifier).'},title:{type:"string",description:"Optional title to show above the rendered UI"}},required:["ui_tree"]}},{name:"create_project",description:"Create a new product project. Use this when users want to start a new product initiative, app idea, or feature set. This creates a project container that can hold PRDs, epics, and tickets.",parameters:{type:"object",properties:{name:{type:"string",description:'The name of the project (e.g., "Weather App", "User Authentication")'},description:{type:"string",description:"A brief description of what this project aims to accomplish"},color:{type:"string",description:'Optional hex color for the project (e.g., "#8b5cf6"). Defaults to purple.'}},required:["name"]}},{name:"create_prd",description:"Create a Product Requirements Document (PRD) for a project. Use this when users want to define requirements, write specs, or document what they want to build. The PRD follows BMAD methodology with executive summary, problem statement, and functional requirements.",parameters:{type:"object",properties:{projectId:{type:"string",description:"The ID of the project to create the PRD for"},title:{type:"string",description:'The title of the PRD (e.g., "User Authentication PRD")'},executiveSummary:{type:"string",description:"A brief executive summary of what this PRD covers"},problemStatement:{type:"string",description:"The problem this product/feature solves"}},required:["projectId","title"]}},{name:"create_ticket",description:"Create a new ticket/story on the Kanban board. Use this when users want to add a task, bug, or story to track work. Tickets can optionally use the user story format (As a... I want... So that...).",parameters:{type:"object",properties:{projectId:{type:"string",description:"The ID of the project to add the ticket to"},title:{type:"string",description:"The title of the ticket"},description:{type:"string",description:"Detailed description of the ticket"},type:{type:"string",description:"The type of ticket",enum:["story","bug","task","spike","chore"]},priority:{type:"string",description:"Priority level (P0=critical, P1=high, P2=medium, P3=low)",enum:["P0","P1","P2","P3"]},asA:{type:"string",description:'User story format: "As a [user type]"'},iWant:{type:"string",description:'User story format: "I want [capability]"'},soThat:{type:"string",description:'User story format: "So that [benefit]"'},labels:{type:"array",items:{type:"string"},description:"Labels/tags for the ticket"}},required:["projectId","title"]}},{name:"update_ticket",description:"Update an existing ticket on the Kanban board. Use this to change status, priority, description, or any other ticket field. Can move tickets between columns.",parameters:{type:"object",properties:{ticketId:{type:"string",description:'The human-readable ticket ID (e.g., "PROJ-001")'},status:{type:"string",description:"New status for the ticket",enum:["backlog","todo","in_progress","review","done","cancelled"]},priority:{type:"string",description:"New priority level",enum:["P0","P1","P2","P3"]},title:{type:"string",description:"New title for the ticket"},description:{type:"string",description:"New description for the ticket"},assigneeId:{type:"string",description:'User ID to assign the ticket to, or "claw-ai" for AI execution'}},required:["ticketId"]}},{name:"shard_prd",description:"Shard a PRD into epics and tickets. This converts the functional requirements in a PRD into actionable Kanban tickets grouped by epics. Use this when a PRD is complete and ready for implementation planning.",parameters:{type:"object",properties:{prdId:{type:"string",description:"The ID of the PRD to shard"},projectId:{type:"string",description:"The ID of the project the PRD belongs to"}},required:["prdId","projectId"]}},{name:"get_project_kanban",description:"Get the Kanban board for a specific project. Shows all tickets organized by status columns (backlog, todo, in_progress, review, done).",parameters:{type:"object",properties:{projectId:{type:"string",description:"The ID of the project to get the Kanban board for"}},required:["projectId"]}},{name:"list_projects",description:"List all product projects. Use this when users want to see their projects, switch between projects, or find a specific project.",parameters:{type:"object",properties:{status:{type:"string",description:"Optional filter by project status",enum:["discovery","design","planning","building","launched","archived"]}},required:[]}},{name:"remember",description:"Search through memories to recall past interactions, decisions, preferences, and milestones. Use this when you need historical context to provide a better response. Only works for the owner.",parameters:{type:"object",properties:{query:{type:"string",description:'The search query to find relevant memories (e.g., "design decisions for 8gent", "preferences about UI", "milestones this month")'},memoryType:{type:"string",description:"Optional filter by memory type",enum:["all","interaction","decision","preference","feedback","milestone"]},limit:{type:"number",description:"Maximum number of memories to return (default 10)"}},required:["query"]}},{name:"recall_preference",description:"Recall specific preferences, patterns, or learned facts about the owner. Use this when you need to remember preferences (coding style, design choices, communication style) or patterns (work habits, typical workflows). Only works for the owner.",parameters:{type:"object",properties:{category:{type:"string",description:"The category of preference to recall",enum:["preference","skill","pattern","fact"]},key:{type:"string",description:'Optional specific key to look up (e.g., "coding_style", "preferred_theme")'}},required:["category"]}},{name:"memorize",description:"Store an important memory explicitly. Use this when something significant is mentioned that should be remembered: important decisions, preferences, milestones, or anything explicitly requested to be remembered. Only works for the owner.",parameters:{type:"object",properties:{content:{type:"string",description:"The content to memorize (what happened, what was decided, what preference was expressed)"},memoryType:{type:"string",description:"The type of memory to store",enum:["interaction","decision","preference","feedback","milestone"]},importance:{type:"number",description:"Importance score from 0 to 1 (default 0.7). Higher = more likely to be recalled."},projectId:{type:"string",description:"Optional project ID to associate this memory with"}},required:["content","memoryType"]}},{name:"learn",description:"Learn a new fact, preference, skill, or pattern about the owner. Use this to update your understanding based on what you are told or what you observe. This creates or updates semantic memory. Only works for the owner.",parameters:{type:"object",properties:{category:{type:"string",description:"The category of knowledge being learned",enum:["preference","skill","pattern","fact"]},key:{type:"string",description:'A unique key for this piece of knowledge (e.g., "preferred_font", "coding_language_primary")'},value:{type:"string",description:'The value/content of this knowledge (e.g., "Inter", "TypeScript")'},confidence:{type:"number",description:"Confidence level from 0 to 1 (default 0.7). Higher = more certain this is accurate."}},required:["category","key","value"]}},{name:"forget",description:"Remove a specific memory. Use this when explicitly asked to forget something, or when a memory is no longer accurate/relevant. Be careful - this permanently deletes the memory. Only works for the owner.",parameters:{type:"object",properties:{memoryId:{type:"string",description:"The ID of the memory to delete"},memoryKind:{type:"string",description:"Whether this is an episodic memory (event/interaction) or semantic memory (fact/preference)",enum:["episodic","semantic"]}},required:["memoryId","memoryKind"]}},{name:"set_active_context",description:"Set the active working context. Use this when starting work on a specific project, ticket, or when the user @mentions an entity. This updates the context layer so all subsequent operations know what you are working on.",parameters:{type:"object",properties:{projectId:{type:"string",description:"The ID of the active project"},projectSlug:{type:"string",description:'The slug of the active project (e.g., "8gent")'},prdId:{type:"string",description:"The ID of the active PRD"},ticketId:{type:"string",description:"The ID of the active ticket"},canvasId:{type:"string",description:"The ID of the active design canvas"},sandboxId:{type:"string",description:"The ID of the active sandbox"},repositoryUrl:{type:"string",description:"The URL of the active repository"}},required:[]}},{name:"get_active_context",description:"Get the current active working context including resolved entity details. Use this to understand what project, ticket, or PRD the user is currently working on before performing operations.",parameters:{type:"object",properties:{},required:[]}},{name:"load_context_from_reference",description:"Load full context chain from an @mention reference. When user mentions @ticket:ARC-042, this loads the ticket plus its parent project, PRD, epic, and related tickets. Use this to build rich context from a single reference.",parameters:{type:"object",properties:{referenceType:{type:"string",description:"The type of reference being loaded",enum:["ticket","project","prd","epic","canvas","memory"]},referenceId:{type:"string",description:"The ID of the referenced entity (e.g., the ticket ID for @ticket:ARC-042)"}},required:["referenceType","referenceId"]}},{name:"clone_repository",description:"Clone a GitHub repository to the sandbox environment. Use this when starting work on a codebase or when the user asks to work on a specific repo. This creates a sandbox with the repo ready for reading, writing, and executing code.",parameters:{type:"object",properties:{url:{type:"string",description:'The GitHub repository URL (e.g., "https://github.com/owner/repo")'},branch:{type:"string",description:"Optional branch to checkout (defaults to main/master)"}},required:["url"]}},{name:"list_directory",description:"List files and directories in a path within the sandbox. Use this to explore the codebase structure, find files, or understand the project layout.",parameters:{type:"object",properties:{path:{type:"string",description:'The path to list (relative to repo root). Use "." or "/" for root.'},recursive:{type:"boolean",description:"If true, list files recursively (default: false)"},maxDepth:{type:"number",description:"Maximum depth for recursive listing (default: 3)"}},required:["path"]}},{name:"search_codebase",description:"Search for text patterns in the codebase using grep/ripgrep. Use this to find function definitions, imports, usages, or any text pattern in the code.",parameters:{type:"object",properties:{pattern:{type:"string",description:"The search pattern (supports regex)"},path:{type:"string",description:"Optional path to search within (defaults to entire repo)"},filePattern:{type:"string",description:'Optional file pattern filter (e.g., "*.ts", "*.tsx")'},caseSensitive:{type:"boolean",description:"Whether search is case-sensitive (default: false)"},maxResults:{type:"number",description:"Maximum number of results to return (default: 50)"}},required:["pattern"]}},{name:"read_file",description:"Read the contents of a file from the sandbox. Use this to examine code, configuration files, or any text file. For large files, you can read specific line ranges.",parameters:{type:"object",properties:{path:{type:"string",description:"The path to the file (relative to repo root)"},startLine:{type:"number",description:"Optional starting line number (1-indexed)"},endLine:{type:"number",description:"Optional ending line number (1-indexed)"}},required:["path"]}},{name:"write_file",description:"Write content to a file in the sandbox. Use this to create new files or replace entire file contents. For surgical edits to existing files, prefer the edit_file tool.",parameters:{type:"object",properties:{path:{type:"string",description:"The path to write to (relative to repo root)"},content:{type:"string",description:"The content to write to the file"},createDirectories:{type:"boolean",description:"Create parent directories if they do not exist (default: true)"}},required:["path","content"]}},{name:"edit_file",description:"Make surgical edits to a file using search and replace. Use this for targeted changes to specific sections of a file. More precise than write_file for modifications.",parameters:{type:"object",properties:{path:{type:"string",description:"The path to the file (relative to repo root)"},oldText:{type:"string",description:"The exact text to find and replace"},newText:{type:"string",description:"The text to replace it with"},replaceAll:{type:"boolean",description:"Replace all occurrences (default: false, replaces first only)"}},required:["path","oldText","newText"]}},{name:"delete_file",description:"Delete a file or directory from the sandbox. Use with caution. For directories, must explicitly set recursive=true.",parameters:{type:"object",properties:{path:{type:"string",description:"The path to delete (relative to repo root)"},recursive:{type:"boolean",description:"Required for directories - delete recursively"}},required:["path"]}},{name:"run_command",description:"Execute a shell command in the sandbox. Use this to run build commands, install dependencies, run tests, or any shell operation. Commands run in the repo root by default.",parameters:{type:"object",properties:{command:{type:"string",description:'The command to execute (e.g., "npm install", "pnpm build")'},cwd:{type:"string",description:"Optional working directory (relative to repo root)"},timeout:{type:"number",description:"Timeout in milliseconds (default: 60000)"}},required:["command"]}},{name:"start_dev_server",description:"Start a development server in the sandbox. Use this to preview the application. Returns a preview URL that can be accessed in the browser.",parameters:{type:"object",properties:{command:{type:"string",description:'The command to start the server (e.g., "npm run dev", "pnpm dev")'},port:{type:"number",description:"The port the server will run on (default: 3000)"}},required:[]}},{name:"get_preview_url",description:"Get the preview URL for the running sandbox. Use this after starting a dev server to get the URL where the app can be previewed.",parameters:{type:"object",properties:{},required:[]}},{name:"git_status",description:"Get the current git status showing modified, added, and deleted files. Use this to see what changes have been made before committing.",parameters:{type:"object",properties:{},required:[]}},{name:"git_diff",description:"Show the diff of changes in the working tree. Use this to review specific changes before committing.",parameters:{type:"object",properties:{path:{type:"string",description:"Optional path to diff a specific file"},staged:{type:"boolean",description:"Show diff of staged changes only (default: false shows unstaged)"}},required:[]}},{name:"git_commit",description:"Commit staged changes with a message. Use this after making changes that should be saved as a commit. Stage files first using git_add.",parameters:{type:"object",properties:{message:{type:"string",description:"The commit message describing the changes"},stageAll:{type:"boolean",description:"Stage all modified files before committing (default: false)"}},required:["message"]}},{name:"git_push",description:"Push commits to the remote repository. Use this after committing to sync changes with GitHub. May require authentication for private repos.",parameters:{type:"object",properties:{branch:{type:"string",description:"The branch to push (defaults to current branch)"},setUpstream:{type:"boolean",description:"Set upstream tracking for the branch (default: true for new branches)"}},required:[]}},{name:"create_branch",description:"Create and checkout a new git branch. Use this to start work on a feature or fix. Can auto-generate branch names from the active ticket context.",parameters:{type:"object",properties:{name:{type:"string",description:'The branch name. If not provided, generates from active ticket (e.g., "feature/arc-042-fix-bug")'},fromBranch:{type:"string",description:"The branch to create from (defaults to current branch)"}},required:[]}},{name:"create_coding_task",description:"Create a new coding task to track work. Links to projects/tickets and maintains conversation history. Use this when starting a significant coding session.",parameters:{type:"object",properties:{title:{type:"string",description:"Title describing the coding task"},description:{type:"string",description:"Detailed description of what needs to be done"},projectId:{type:"string",description:"Optional project ID to link this task to"},ticketId:{type:"string",description:"Optional ticket ID this task implements"},repositoryUrl:{type:"string",description:"The repository URL for this task"}},required:["title","description"]}},{name:"update_coding_task",description:"Update the status or details of a coding task. Use this to mark tasks as completed, failed, or update progress.",parameters:{type:"object",properties:{taskId:{type:"string",description:"The ID of the coding task to update"},status:{type:"string",description:"New status for the task",enum:["pending","running","waiting_input","completed","failed","cancelled"]},filesModified:{type:"array",items:{type:"string"},description:"List of files that were modified"},commitSha:{type:"string",description:"The commit SHA if changes were committed"}},required:["taskId"]}},{name:"list_coding_tasks",description:"List coding tasks for the current user. Use this to see recent or active coding sessions.",parameters:{type:"object",properties:{status:{type:"string",description:"Optional filter by status",enum:["pending","running","waiting_input","completed","failed","cancelled"]},limit:{type:"number",description:"Maximum number of tasks to return (default: 10)"}},required:[]}},{name:"create_cron_job",description:'Create a scheduled job that runs automatically. Use this when the user wants to set up recurring reminders, automated AI messages, email notifications, or webhook triggers. Examples: "Remind me every day at 9am to check emails", "Send me a summary every Monday morning", "Run a health check webhook every hour".',parameters:{type:"object",properties:{name:{type:"string",description:'A short, descriptive name for the job (e.g., "Daily standup reminder", "Weekly summary")'},description:{type:"string",description:"Optional longer description of what this job does"},scheduleType:{type:"string",description:"How often the job should run",enum:["once","interval","daily","weekly"]},scheduleTime:{type:"string",description:'When to run. For "once": ISO date string. For "daily"/"weekly": time in HH:MM format (24h). For "interval": number of minutes.'},daysOfWeek:{type:"array",items:{type:"number"},description:"For weekly jobs: which days to run (0=Sunday, 1=Monday, etc.)"},actionType:{type:"string",description:"What the job should do when triggered",enum:["ai_message","email","webhook"]},prompt:{type:"string",description:"For ai_message: the prompt to send to 8gent when the job runs"},emailSubject:{type:"string",description:"For email: the subject line"},emailBody:{type:"string",description:"For email: the message body"},recipientEmail:{type:"string",description:"For email: who to send to (defaults to user email)"},webhookUrl:{type:"string",description:"For webhook: the URL to call"},deliveryChannel:{type:"string",description:"Where to deliver AI responses (for ai_message jobs)",enum:["web","email","whatsapp","telegram"]},timezone:{type:"string",description:'Timezone for scheduling (e.g., "America/Los_Angeles", "Europe/London"). Defaults to UTC.'}},required:["name","scheduleType","actionType"]}},{name:"list_cron_jobs",description:"List all scheduled jobs for the user. Use this when the user asks about their scheduled tasks, reminders, or automations.",parameters:{type:"object",properties:{includeInactive:{type:"boolean",description:"Whether to include paused/inactive jobs. Defaults to false."}},required:[]}},{name:"toggle_cron_job",description:"Pause or resume a scheduled job. Use this when the user wants to temporarily disable a job without deleting it.",parameters:{type:"object",properties:{jobId:{type:"string",description:"The ID of the job to toggle"}},required:["jobId"]}},{name:"delete_cron_job",description:"Permanently delete a scheduled job. Use this when the user wants to remove a job they no longer need.",parameters:{type:"object",properties:{jobId:{type:"string",description:"The ID of the job to delete"}},required:["jobId"]}},{name:"compact_conversation",description:"Compress older messages in the conversation into a summary to save context space. Use this when the user asks to summarize or compact the conversation, or when the conversation is getting very long. This preserves key context while reducing token usage.",parameters:{type:"object",properties:{sessionId:{type:"string",description:"The chat session ID to compact"},keepRecentCount:{type:"number",description:"Number of recent messages to keep uncompacted (default: 10)"},instructions:{type:"string",description:"Optional focus instructions for what to emphasize in the summary"}},required:["sessionId"]}},{name:"get_compaction_summary",description:"Retrieve the existing compaction summary for a conversation session. Use this to recall context from earlier in a long conversation.",parameters:{type:"object",properties:{sessionId:{type:"string",description:"The chat session ID to get compaction for"}},required:["sessionId"]}},{name:"list_channel_integrations",description:"List all connected messaging platform integrations. Use this to see which channels (WhatsApp, Telegram, iMessage, Slack, Discord) are connected and their status.",parameters:{type:"object",properties:{includeDisabled:{type:"boolean",description:"Include disabled integrations (default: false)"}},required:[]}},{name:"get_channel_conversations",description:"Get recent conversations from connected messaging platforms. Returns a unified inbox view with contact info, last message, and unread counts.",parameters:{type:"object",properties:{platform:{type:"string",enum:["whatsapp","telegram","imessage","slack","discord"],description:"Filter by specific platform (optional)"},limit:{type:"number",description:"Maximum conversations to return (default: 20)"}},required:[]}},{name:"send_channel_message",description:"Send a message via a connected messaging platform. Use this to reply to conversations or send proactive messages through WhatsApp, Telegram, etc. OWNER ONLY: Only the owner can send outbound messages.",parameters:{type:"object",properties:{integrationId:{type:"string",description:"The channel integration ID to send through"},recipientId:{type:"string",description:"The recipient identifier (phone number, chat ID, etc.)"},content:{type:"string",description:"Message content to send"},messageType:{type:"string",enum:["text","voice"],description:"Message type (default: text)"}},required:["integrationId","recipientId","content"]},ownerOnly:!0},{name:"search_channel_messages",description:"Search messages across all connected messaging platforms. Useful for finding past conversations, tracking topics, or locating specific information.",parameters:{type:"object",properties:{query:{type:"string",description:"Search query"},platform:{type:"string",enum:["whatsapp","telegram","imessage","slack","discord"],description:"Filter by specific platform (optional)"},limit:{type:"number",description:"Maximum results to return (default: 20)"}},required:["query"]}},{name:"create_dimension",description:'Create a custom dimension view for entities. Use this when users want to visualize their data in a new way, like "show me my tasks as a constellation" or "create a timeline of my projects". Dimensions define how entities are arranged, styled, and connected.',parameters:{type:"object",properties:{name:{type:"string",description:'Name for the dimension (e.g., "Task Constellation", "Project Timeline")'},metaphor:{type:"string",description:"Visual metaphor for the dimension. Affects styling and arrangement.",enum:["river","board","constellation","solar","timeline","mosaic","ledger","vinyl","dungeon","tree"]},arrangement:{type:"string",description:"How entities are arranged spatially",enum:["list","grid","graph","tree","flow","orbit","stack"]},entityTypes:{type:"array",items:{type:"string"},description:'Types of entities to include (e.g., ["Ticket", "Project"]). Leave empty for all.'},description:{type:"string",description:"Optional description of what this dimension shows"}},required:["name","metaphor","arrangement"]}},{name:"navigate_to_dimension",description:'Navigate to a dimension view. Use this when users want to see a specific dimension like "show me the kanban", "open the graph view", or "go to my feed". Can navigate to preset dimensions or custom ones created by the user.',parameters:{type:"object",properties:{dimensionId:{type:"string",description:"ID of the dimension to navigate to. Presets: feed, kanban, graph, graph-3d, calendar, grid, table, ipod, quest-log, skill-tree. Or a custom dimension ID."}},required:["dimensionId"]}},{name:"list_dimensions",description:'List all available dimensions including presets and custom user dimensions. Use this when users ask "what views do I have?" or "show me available dimensions".',parameters:{type:"object",properties:{includePresets:{type:"boolean",description:"Whether to include preset dimensions (default: true)"}},required:[]}},{name:"search_entities",description:'Search across all entities in the ERV system. Use this when users ask about their data like "find all high priority tickets", "show me projects tagged with AI", or "what tracks do I have from last month".',parameters:{type:"object",properties:{query:{type:"string",description:"Search query to find entities"},entityTypes:{type:"array",items:{type:"string"},description:'Filter by entity types (e.g., ["Ticket", "Project", "Track"]). Leave empty for all.'},limit:{type:"number",description:"Maximum results to return (default: 20)"}},required:["query"]}},{name:"create_video_composition",description:'Create a new video composition for creating videos, presentations, or lyric videos. Use this when users want to create video content like "make a lyric video for this song", "create a presentation video", or "add text overlays to this video".',parameters:{type:"object",properties:{name:{type:"string",description:"Name for the video composition"},type:{type:"string",description:"Type of video to create",enum:["lyric-video","presentation","text-overlay","social-story","music-visualizer","slideshow","custom"]},preset:{type:"string",description:"Video format preset",enum:["instagram-story","instagram-post","instagram-reel","tiktok","youtube","youtube-short","twitter","1080p","720p","4k","square","portrait"]},durationSeconds:{type:"number",description:"Duration of the video in seconds (default: 30)"},backgroundColor:{type:"string",description:"Background color (hex or CSS color)"},backgroundGradient:{type:"string",description:"Background gradient (CSS gradient string)"}},required:["name","type"]}},{name:"add_text_overlay",description:"Add a text overlay to a video composition. Use this to add titles, captions, watermarks, or any text content to videos. Supports animations and positioning.",parameters:{type:"object",properties:{compositionId:{type:"string",description:"ID of the video composition to add text to"},text:{type:"string",description:"The text content to display"},position:{type:"string",description:"Position on screen",enum:["top-left","top-center","top-right","center-left","center","center-right","bottom-left","bottom-center","bottom-right"]},startTime:{type:"number",description:"When the text appears (in seconds)"},duration:{type:"number",description:"How long the text stays on screen (in seconds)"},fontSize:{type:"number",description:"Font size in pixels (default: 32)"},color:{type:"string",description:"Text color (default: white)"},animation:{type:"string",description:"Entry animation for the text",enum:["none","fade","slide-up","slide-down","slide-left","slide-right","scale","typewriter","blur","glitch"]}},required:["compositionId","text"]}},{name:"add_lyrics_to_video",description:"Add synchronized lyrics to a video composition. Creates karaoke-style lyric videos with word highlighting, bouncing text, or typewriter effects. Provide lyrics with timestamps.",parameters:{type:"object",properties:{compositionId:{type:"string",description:"ID of the video composition"},audioSrc:{type:"string",description:"URL or path to the audio file"},lyrics:{type:"array",items:{type:"object",properties:{text:{type:"string"},startTime:{type:"number"},endTime:{type:"number"}}},description:"Array of lyric lines with timing: [{text, startTime, endTime}]"},style:{type:"string",description:"Lyric display style",enum:["karaoke","subtitle","bounce","typewriter"]},fontFamily:{type:"string",description:"Font family for lyrics (default: Inter)"},color:{type:"string",description:"Text color for lyrics"},highlightColor:{type:"string",description:"Highlight color for active words (karaoke style)"},position:{type:"string",description:"Vertical position of lyrics",enum:["top","center","bottom"]}},required:["compositionId","audioSrc","lyrics"]}},{name:"add_media_to_video",description:"Add an image or video layer to a composition. Use for backgrounds, overlays, or picture-in-picture effects.",parameters:{type:"object",properties:{compositionId:{type:"string",description:"ID of the video composition"},mediaSrc:{type:"string",description:"URL or path to the media file (image or video)"},mediaType:{type:"string",description:"Type of media",enum:["image","video"]},startTime:{type:"number",description:"When the media appears (in seconds)"},duration:{type:"number",description:"How long the media stays on screen (in seconds)"},position:{type:"object",description:"Position {x, y} in pixels"},scale:{type:"number",description:"Scale factor (1 = original size)"},opacity:{type:"number",description:"Opacity 0-1"},objectFit:{type:"string",description:"How the media fits its container",enum:["contain","cover","fill"]}},required:["compositionId","mediaSrc","mediaType"]}},{name:"preview_video",description:"Generate a preview of a video composition. Opens the video player with the current composition state for review before rendering.",parameters:{type:"object",properties:{compositionId:{type:"string",description:"ID of the video composition to preview"},openInCanvas:{type:"boolean",description:"Whether to open the preview in the infinite canvas (default: false)"}},required:["compositionId"]}},{name:"render_video",description:'Render a video composition to a downloadable MP4/WebM/GIF file. Use mode="sandbox" to render locally using ffmpeg.wasm (free, no cloud needed) or mode="server" for server-side rendering. Sandbox mode is recommended for videos under 60 seconds.',parameters:{type:"object",properties:{compositionId:{type:"string",description:"ID of the video composition to render"},format:{type:"string",description:"Output format",enum:["mp4","webm","gif"]},quality:{type:"string",description:"Quality preset (draft=fast/lower quality, high=best quality)",enum:["draft","standard","high"]},mode:{type:"string",description:"Render mode: sandbox (local, free) or server (cloud, costs $)",enum:["sandbox","server"]}},required:["compositionId"]}},{name:"sync_lyrics_to_audio",description:"Automatically sync lyrics text to an audio file using AI transcription. Takes raw lyrics and audio, returns timed lyric data ready for add_lyrics_to_video. Uses Whisper API for word-level timestamp detection.",parameters:{type:"object",properties:{audioSrc:{type:"string",description:"URL or path to the audio file"},lyrics:{type:"string",description:"Raw lyrics text (one line per lyric line, no timestamps needed)"},language:{type:"string",description:'Language code (e.g., "en", "es", "fr"). Auto-detected if not specified.'}},required:["audioSrc","lyrics"]}},{name:"get_render_status",description:"Check the status of a video render job. Returns progress percentage, output URL when complete, or error message if failed.",parameters:{type:"object",properties:{jobId:{type:"string",description:"The render job ID returned from render_video"}},required:["jobId"]}},{name:"add_particle_effect",description:"Add particle effects to a video composition. Creates confetti, snow, dust, sparks, or custom particles. Great for celebrations, atmosphere, and visual interest.",parameters:{type:"object",properties:{compositionId:{type:"string",description:"ID of the video composition"},effect:{type:"string",description:"Type of particle effect",enum:["confetti","snow","dust","sparks","bubbles","leaves","stars","custom"]},particleCount:{type:"number",description:"Number of particles (default: 100, max: 500)"},color:{type:"string",description:'Particle color (hex, CSS color, or "multi" for random colors)'},direction:{type:"string",description:"Direction of particle movement",enum:["up","down","left","right","random","explode"]},speed:{type:"number",description:"Speed multiplier (default: 1)"},gravity:{type:"number",description:"Gravity effect (0 = no gravity, 1 = normal)"},startTime:{type:"number",description:"When particles start (in seconds)"},duration:{type:"number",description:"How long particles last (in seconds)"}},required:["compositionId","effect"]}},{name:"add_waveform_visualizer",description:"Add an audio waveform visualization to a video composition. Creates bars, lines, circles, or mirror effects that respond to audio frequencies. Perfect for music videos.",parameters:{type:"object",properties:{compositionId:{type:"string",description:"ID of the video composition"},audioSrc:{type:"string",description:"URL or path to the audio file"},style:{type:"string",description:"Visualization style",enum:["bars","line","circle","mirror","spectrum","pulse"]},color:{type:"string",description:"Waveform color (supports gradients with color1,color2 format)"},position:{type:"string",description:"Position of the waveform",enum:["top","center","bottom","full"]},barWidth:{type:"number",description:"Width of bars in pixels (for bars style)"},smoothing:{type:"number",description:"Smoothing factor 0-1 (higher = smoother)"},sensitivity:{type:"number",description:"Audio sensitivity multiplier (default: 1)"}},required:["compositionId","audioSrc","style"]}},{name:"add_gradient_background",description:"Add an animated or static gradient background to a video composition. Supports linear, radial, and conic gradients with optional animation.",parameters:{type:"object",properties:{compositionId:{type:"string",description:"ID of the video composition"},colors:{type:"array",items:{type:"string"},description:"Array of colors for the gradient (2-5 colors)"},type:{type:"string",description:"Type of gradient",enum:["linear","radial","conic"]},angle:{type:"number",description:"Angle in degrees (for linear gradient)"},animate:{type:"boolean",description:"Whether to animate the gradient rotation"},animationSpeed:{type:"number",description:"Degrees per second for animation (default: 30)"}},required:["compositionId","colors"]}},{name:"create_slideshow",description:"Create an automatic slideshow from multiple images. Applies Ken Burns effect, transitions, and optional background music. Perfect for photo montages.",parameters:{type:"object",properties:{name:{type:"string",description:"Name for the slideshow"},images:{type:"array",items:{type:"string"},description:"Array of image URLs or paths"},durationPerSlide:{type:"number",description:"Seconds per image (default: 3)"},transition:{type:"string",description:"Transition between slides",enum:["fade","slide","zoom","blur","wipe","none"]},transitionDuration:{type:"number",description:"Duration of transitions in seconds (default: 0.5)"},kenBurns:{type:"boolean",description:"Apply Ken Burns zoom/pan effect (default: true)"},backgroundMusic:{type:"string",description:"URL or path to background music (optional)"},preset:{type:"string",description:"Video format preset",enum:["instagram-story","instagram-post","tiktok","youtube","youtube-short","1080p","square"]}},required:["name","images"]}},{name:"add_cinematic_effect",description:"Apply cinematic effects to a video composition. Includes letterbox, color grading, film grain, vignette, and more for a professional film look.",parameters:{type:"object",properties:{compositionId:{type:"string",description:"ID of the video composition"},effect:{type:"string",description:"Cinematic effect to apply",enum:["letterbox","film_grain","vignette","color_grade","bloom","chromatic_aberration","lens_flare"]},intensity:{type:"number",description:"Effect intensity 0-1 (default: 0.5)"},colorGrade:{type:"string",description:"Color grading preset (for color_grade effect)",enum:["cinematic","vintage","cold","warm","noir","cyberpunk","pastel"]},letterboxRatio:{type:"string",description:"Aspect ratio for letterbox",enum:["2.35:1","2.39:1","1.85:1","4:3"]}},required:["compositionId","effect"]}},{name:"add_kinetic_typography",description:"Create kinetic typography animation - text that moves, scales, and transforms dynamically. Perfect for music videos, title sequences, and promotional content.",parameters:{type:"object",properties:{compositionId:{type:"string",description:"ID of the video composition"},text:{type:"string",description:"Text to animate (can include multiple lines)"},style:{type:"string",description:"Animation style",enum:["impact","wave","cascade","explosion","bounce","zoom","rotate","glitch"]},fontFamily:{type:"string",description:"Font family (default: Inter)"},fontSize:{type:"number",description:"Font size in pixels"},color:{type:"string",description:"Text color"},startTime:{type:"number",description:"When animation starts (in seconds)"},duration:{type:"number",description:"Animation duration (in seconds)"},syncToAudio:{type:"boolean",description:"Sync animation to audio beats (requires audio layer)"}},required:["compositionId","text","style"]}},{name:"export_for_platform",description:"Export a video composition optimized for a specific social media platform. Automatically adjusts resolution, bitrate, and format for optimal quality.",parameters:{type:"object",properties:{compositionId:{type:"string",description:"ID of the video composition to export"},platform:{type:"string",description:"Target platform",enum:["instagram_story","instagram_reel","instagram_post","tiktok","youtube","youtube_short","twitter","linkedin","facebook"]},includeCaption:{type:"boolean",description:"Include burned-in captions if available"},includeSafeZone:{type:"boolean",description:"Add safe zone guides for platform UI elements"}},required:["compositionId","platform"]}},{name:"list_video_compositions",description:"List all video compositions. Returns composition IDs, names, types, and preview info.",parameters:{type:"object",properties:{filter:{type:"string",description:"Filter by type (optional)",enum:["lyric-video","presentation","text-overlay","social-story","music-visualizer","slideshow","all"]},limit:{type:"number",description:"Maximum number of results (default: 20)"}},required:[]}},{name:"apply_image_effect",description:"Apply visual effects to an image. Includes halftone, duotone, blur, glitch, vintage, cyberpunk, noir, and more. Use for creating unique branded looks, artistic transformations, or consistent visual identity.",parameters:{type:"object",properties:{imageSrc:{type:"string",description:"Image URL, base64 data, or file path"},effect:{type:"string",description:"Effect type to apply",enum:["halftone","duotone","posterize","pixelate","ascii","line-art","grayscale","sepia","invert","hue-shift","saturate","color-replace","gaussian-blur","motion-blur","radial-blur","zoom-blur","tilt-shift","swirl","bulge","pinch","wave","ripple","fisheye","noise","film-grain","scanlines","vignette","oil-paint","watercolor","sketch","comic","glitch","vintage","cyberpunk","noir","pop-art","blueprint"]},params:{type:"object",description:'Effect-specific parameters (e.g., { frequency: 45, angle: 45, shape: "line" } for halftone)'},outputFormat:{type:"string",description:"Output image format",enum:["png","jpg","webp"]},quality:{type:"number",description:"Output quality 0-100 (default: 90)"}},required:["imageSrc","effect"]}},{name:"generate_app_icon",description:"Generate a unique app icon with specified style and effects. Creates multiple sizes suitable for iOS, Android, and web. Perfect for creating consistent branded icons.",parameters:{type:"object",properties:{name:{type:"string",description:"App name (used for naming output files)"},style:{type:"string",description:"Icon visual style",enum:["flat","gradient","glassmorphism","neumorphic","illustrated","3d","halftone","minimal"]},primaryColor:{type:"string",description:"Primary brand color (hex)"},secondaryColor:{type:"string",description:"Secondary color for gradients (hex, optional)"},backgroundColor:{type:"string",description:"Background color (hex, optional)"},symbol:{type:"string",description:"Icon symbol - can be an emoji, letter, or Lucide icon name"},shape:{type:"string",description:"Icon shape",enum:["square","rounded","circle","squircle"]},effects:{type:"array",items:{type:"object"},description:"Additional effects (shadow, glow, border, etc.)"},sizes:{type:"array",items:{type:"number"},description:"Output sizes in pixels (default: [64, 128, 256, 512, 1024])"}},required:["name","style","primaryColor"]}},{name:"remove_background",description:"Remove the background from an image using AI. Supports portraits, products, and general images. Returns transparent PNG.",parameters:{type:"object",properties:{imageSrc:{type:"string",description:"Image URL, base64 data, or file path"},model:{type:"string",description:"AI model optimized for specific content types",enum:["auto","portrait","product","general"]},tolerance:{type:"number",description:"Edge sensitivity 0-100 (default: 50)"},edgeSoftness:{type:"number",description:"Feather amount in pixels 0-20 (default: 2)"},refineEdges:{type:"boolean",description:"Use AI edge refinement for better hair/fur detection"}},required:["imageSrc"]}},{name:"create_branded_image",description:"Transform an image to match 8gent branded visual identity. Applies consistent effects for a cohesive look across all OS assets.",parameters:{type:"object",properties:{imageSrc:{type:"string",description:"Source image URL or path"},preset:{type:"string",description:"Brand preset to apply",enum:["signature","light","dark","vibrant","minimal","retro","futuristic"]},customEffects:{type:"array",items:{type:"object"},description:"Override or add effects to the preset"},outputFormat:{type:"string",description:"Output format",enum:["png","jpg","webp"]}},required:["imageSrc","preset"]}},{name:"batch_process_images",description:"Apply consistent effects to multiple images at once. Perfect for creating cohesive galleries, icon sets, or branded asset collections.",parameters:{type:"object",properties:{images:{type:"array",items:{type:"string"},description:"Array of image URLs or paths"},effects:{type:"array",items:{type:"object"},description:"Effects to apply to all images"},preset:{type:"string",description:"Named preset to apply (alternative to effects array)",enum:["vintage","cyberpunk","noir","pop-art","blueprint","signature"]},outputPrefix:{type:"string",description:"Filename prefix for outputs"},outputFormat:{type:"string",description:"Output format for all images",enum:["png","jpg","webp"]}},required:["images"]}},{name:"create_color_palette",description:"Extract or generate a color palette from an image or create one from scratch. Useful for theming, branding, and ensuring visual consistency.",parameters:{type:"object",properties:{source:{type:"string",description:'Image URL to extract colors from, or "generate" for AI generation'},count:{type:"number",description:"Number of colors in palette (default: 5)"},mode:{type:"string",description:"Palette generation mode",enum:["extract","analogous","complementary","triadic","split-complementary","monochromatic"]},baseColor:{type:"string",description:"Base color for generated palettes (hex)"},includeShades:{type:"boolean",description:"Include light/dark shades of each color"}},required:["source"]}},{name:"resize_and_crop",description:"Resize, crop, and optimize images for specific use cases. Supports smart cropping that preserves important content.",parameters:{type:"object",properties:{imageSrc:{type:"string",description:"Source image URL or path"},width:{type:"number",description:"Target width in pixels"},height:{type:"number",description:"Target height in pixels"},fit:{type:"string",description:"How to fit image to dimensions",enum:["contain","cover","fill","inside","outside"]},position:{type:"string",description:"Focal point for cropping",enum:["center","top","right","bottom","left","top-left","top-right","bottom-left","bottom-right","smart"]},format:{type:"string",description:"Output format",enum:["png","jpg","webp"]},quality:{type:"number",description:"Quality 0-100 (for jpg/webp)"}},required:["imageSrc","width","height"]}},{name:"composite_images",description:"Layer multiple images together with blend modes and positioning. Create collages, overlays, and composite designs.",parameters:{type:"object",properties:{baseImage:{type:"string",description:"Background/base image URL or path"},layers:{type:"array",items:{type:"object"},description:"Array of layers: [{src, x, y, width, height, opacity, blendMode}]"},outputWidth:{type:"number",description:"Final output width (optional)"},outputHeight:{type:"number",description:"Final output height (optional)"},format:{type:"string",description:"Output format",enum:["png","jpg","webp"]}},required:["baseImage","layers"]}},{name:"generate_pattern",description:"Generate seamless patterns and textures. Useful for backgrounds, UI elements, and decorative graphics.",parameters:{type:"object",properties:{type:{type:"string",description:"Pattern type",enum:["dots","lines","grid","waves","noise","geometric","organic","halftone","checkerboard","stripes"]},width:{type:"number",description:"Pattern tile width (default: 256)"},height:{type:"number",description:"Pattern tile height (default: 256)"},colors:{type:"array",items:{type:"string"},description:"Colors to use in pattern (hex values)"},density:{type:"number",description:"Pattern density 0-100 (default: 50)"},rotation:{type:"number",description:"Pattern rotation in degrees"},seamless:{type:"boolean",description:"Ensure pattern tiles seamlessly (default: true)"}},required:["type"]}},{name:"create_talking_video",description:'Create a talking head video with AI-generated script, cloned voice, and lip sync. The full workflow: 1) Generate a script about the topic, 2) Generate voice audio using ElevenLabs cloned voice, 3) Create background scene using Kling AI Pro, 4) Lip sync with Veed Fast. Use when user says "make a video of me talking about X" or "create a talking video".',parameters:{type:"object",properties:{topic:{type:"string",description:"What the video should be about. This will be used to generate the script."},sourcePhotoUrl:{type:"string",description:"URL of the photo to animate (headshot of the person)"},sceneStyle:{type:"string",description:"Background scene style for the video",enum:["podcast_studio","office","outdoor","news_desk","living_room","conference"]},customScenePrompt:{type:"string",description:"Custom scene description (overrides sceneStyle if provided)"},duration:{type:"number",description:"Target video duration in seconds (default: 90)"},tone:{type:"string",description:"Tone of the script and delivery",enum:["professional","casual","educational","entertaining"]}},required:["topic","sourcePhotoUrl"]}},{name:"generate_video_script",description:"Generate just the script for a talking video without creating the full video. Use this when user wants to review or edit the script before generating voice and video.",parameters:{type:"object",properties:{topic:{type:"string",description:"What the script should be about"},duration:{type:"number",description:"Target duration in seconds (default: 90). Script will be ~150 words per minute."},tone:{type:"string",description:"Tone of the script",enum:["professional","casual","educational","entertaining"]},style:{type:"string",description:"Script style/format",enum:["monologue","interview","tutorial","story"]}},required:["topic"]}},{name:"generate_voice_audio",description:"Generate voice audio from text using ElevenLabs cloned voice. Creates natural-sounding speech that matches James's voice. Use when user wants to create audio narration or voice-over.",parameters:{type:"object",properties:{text:{type:"string",description:"The text to convert to speech"},voiceId:{type:"string",description:"ElevenLabs voice ID (uses James's cloned voice by default)"},stability:{type:"number",description:"Voice stability 0-1 (higher = more consistent, lower = more expressive)"},similarityBoost:{type:"number",description:"Voice similarity 0-1 (higher = closer to original voice)"}},required:["text"]}},{name:"navigate_to_video_studio",description:'Open the video studio page (/video) for creating talking videos. Use when user wants to "go to video studio", "open video creator", or "make a talking video" without specifying details.',parameters:{type:"object",properties:{prefillTopic:{type:"string",description:"Optional topic to pre-fill in the video studio"}},required:[]}},{name:"generate_video",description:'Generate a video from a text prompt using LTX-2 AI model. Creates high-quality videos from text descriptions. Use when user says "generate a video of X", "create a video showing X", or "make me a video clip of X". Supports multiple aspect ratios and durations.',parameters:{type:"object",properties:{prompt:{type:"string",description:"Detailed description of the video to generate. Be specific about motion, scene, lighting, etc."},negative_prompt:{type:"string",description:"What to avoid in the video (default: blurry, low quality, distorted, watermark)"},preset:{type:"string",description:"Video preset for aspect ratio and duration",enum:["landscape_short","landscape_long","portrait_short","portrait_long","square","cinematic"]},duration_seconds:{type:"number",description:"Approximate duration in seconds (4-6 seconds typical)"},seed:{type:"number",description:"Random seed for reproducibility"}},required:["prompt"]}},{name:"animate_image",description:'Animate a still image into a video using LTX-2 image-to-video. Takes a starting image and creates motion based on the prompt. Use when user says "animate this image", "make this photo move", or "bring this picture to life".',parameters:{type:"object",properties:{image_url:{type:"string",description:"URL of the image to animate"},prompt:{type:"string",description:'Description of how the image should animate (e.g., "the person starts walking", "camera slowly zooms in")'},negative_prompt:{type:"string",description:"What to avoid in the animation"},duration_seconds:{type:"number",description:"Approximate duration in seconds (4-6 seconds typical)"},seed:{type:"number",description:"Random seed for reproducibility"}},required:["image_url","prompt"]}},{name:"list_video_presets",description:"List available video generation presets with their aspect ratios and durations. Use this to show the user what video formats are available.",parameters:{type:"object",properties:{},required:[]}},{name:"spawn_task",description:'Spawn a background task that runs independently and announces the result when done. Use this when you need to do work that takes time (research, code analysis, file operations) without blocking the conversation. The task runs server-side and survives browser close. Examples: "Analyze this codebase", "Research competitors", "Generate a report". IMPORTANT: This is how 8gent does real work autonomously.',parameters:{type:"object",properties:{task:{type:"string",description:"Description of what the task should accomplish. Be specific and detailed."},label:{type:"string",description:'Short label for the task (shown in UI, e.g., "Code Analysis", "Research")'},timeoutSeconds:{type:"number",description:"Maximum time for the task to run in seconds (default: 300, max: 600)"},announceResult:{type:"boolean",description:"Whether to announce the result back in chat when done (default: true)"},priority:{type:"string",description:"Task priority for queue ordering",enum:["low","normal","high"]},context:{type:"object",description:"Optional context to pass to the task (projectId, ticketId, sandboxId, etc.)"}},required:["task"]}},{name:"list_background_tasks",description:"List active and recent background tasks. Use this to check on spawned tasks, see their progress, or review completed work.",parameters:{type:"object",properties:{status:{type:"string",description:"Filter by task status",enum:["queued","running","succeeded","failed","cancelled","all"]},limit:{type:"number",description:"Maximum number of tasks to return (default: 10)"}},required:[]}},{name:"cancel_background_task",description:"Cancel a running or queued background task. Use this when the user wants to stop a task that is taking too long or is no longer needed.",parameters:{type:"object",properties:{jobId:{type:"string",description:"The job ID of the task to cancel"}},required:["jobId"]}},{name:"get_task_result",description:"Get the result of a completed background task. Use this to retrieve the output of a task that has finished running.",parameters:{type:"object",properties:{jobId:{type:"string",description:"The job ID of the task to get results for"}},required:["jobId"]}},{name:"iterate_on_code",description:"Start an autonomous code iteration session. 8gent will analyze code, make changes, run tests, and iterate until the goal is achieved or max iterations reached. Perfect for refactoring, bug fixes, or implementing features with clear test criteria. Requires an active sandbox with cloned repository.",parameters:{type:"object",properties:{goal:{type:"string",description:'What the iteration should achieve (e.g., "Fix all TypeScript errors", "Add unit tests for auth module")'},sandboxId:{type:"string",description:"The sandbox ID with the cloned repository"},maxIterations:{type:"number",description:"Maximum number of analyze-modify-test cycles (default: 5, max: 10)"},stopOnSuccess:{type:"boolean",description:"Whether to stop when tests pass (default: true)"},commitChanges:{type:"boolean",description:"Whether to commit successful changes (default: false)"},testCommand:{type:"string",description:'Command to run for testing (e.g., "npm test", "pnpm typecheck")'}},required:["goal","sandboxId"]}},{name:"delegate_to_specialist",description:"Delegate a task to a specialist agent with deep expertise in a specific area. Specialists run as background tasks and announce findings when complete. Use for security audits, code reviews, performance analysis, etc.",parameters:{type:"object",properties:{specialist:{type:"string",description:"The type of specialist to delegate to",enum:["code-reviewer","security-auditor","performance-analyst","documentation-writer","test-generator","refactoring-expert"]},task:{type:"string",description:"What the specialist should analyze or accomplish"},context:{type:"object",description:"Optional context (sandboxId, filePaths, repository info, etc.)"},announceResult:{type:"boolean",description:"Whether to announce findings in chat (default: true)"}},required:["specialist","task"]}},{name:"get_ai_provider_status",description:'Check the current AI provider configuration and connection status. Shows whether local (Ollama) or cloud (OpenAI) inference is being used, available models, and latency information. Use when user asks "what model are you using", "are you running locally", "check AI status", or wants to know about the current AI setup.',parameters:{type:"object",properties:{includeLatency:{type:"boolean",description:"Whether to include latency measurements (may add delay)"}},required:[]},ownerOnly:!0},{name:"navigate_to_ai_settings",description:'Open the AI provider settings page (/settings/ai) where the user can switch between local and cloud inference, configure Ollama, and view connection status. Use when user says "AI settings", "configure local model", "switch to local", "switch to cloud".',parameters:{type:"object",properties:{},required:[]},ownerOnly:!0},{name:"get_kanban_task",description:'Get details of a specific Kanban task by its ID. Use this when a user references a task like "exp-001" or "p1-3" to understand what the task is about before taking action.',parameters:{type:"object",properties:{taskId:{type:"string",description:'The task ID (e.g., "exp-001", "p1-1", "backlog-2")'}},required:["taskId"]}},{name:"search_kanban_tasks",description:"Search Kanban tasks by keyword. Use this to find tasks related to a topic, or to see what tasks exist in the board.",parameters:{type:"object",properties:{query:{type:"string",description:"Search term to find in task titles, descriptions, or tags"},status:{type:"string",description:"Optional: filter by status",enum:["backlog","todo","in-progress","review","done"]}},required:["query"]}},{name:"create_canvas",description:"Create a new design canvas for visual exploration, moodboards, mind maps, or flowcharts. Use this when users want to create visual diagrams, plan architecture, or compose layouts. The canvas supports multiple node types including shapes, sticky notes, images, and text.",parameters:{type:"object",properties:{name:{type:"string",description:'Name for the canvas (e.g., "8gent Architecture", "Project Moodboard")'},canvasType:{type:"string",description:"Type of canvas layout",enum:["freeform","wireframe","moodboard","storyboard","mindmap","flowchart"]},description:{type:"string",description:"Optional description of what this canvas is for"},backgroundColor:{type:"string",description:'Background color (hex, e.g., "#1a1a2e" for dark, "#ffffff" for white)'},gridEnabled:{type:"boolean",description:"Whether to show grid lines (default: true)"}},required:["name","canvasType"]}},{name:"list_canvases",description:"List all design canvases. Use this to find existing canvases or see what visual workspaces have been created.",parameters:{type:"object",properties:{status:{type:"string",description:"Filter by canvas status",enum:["active","archived","template"]},limit:{type:"number",description:"Maximum number of canvases to return (default: 20)"}},required:[]}},{name:"get_canvas",description:"Get details of a specific canvas including its nodes and edges. Use this to view what elements are on a canvas before adding more.",parameters:{type:"object",properties:{canvasId:{type:"string",description:"The ID of the canvas to retrieve"}},required:["canvasId"]}},{name:"add_canvas_node",description:"Add a node (element) to a canvas. Nodes can be shapes, sticky notes, text, images, code blocks, or other visual elements. Position is specified in x,y coordinates. Use this to build visual representations, diagrams, or compositions.",parameters:{type:"object",properties:{canvasId:{type:"string",description:"The ID of the canvas to add the node to"},nodeType:{type:"string",description:"Type of node to create",enum:["text","image","shape","sticky","frame","code","embed","audio","video","link"]},x:{type:"number",description:"X position on canvas (0 is left edge)"},y:{type:"number",description:"Y position on canvas (0 is top edge)"},width:{type:"number",description:"Width of the node in pixels (default: varies by type)"},height:{type:"number",description:"Height of the node in pixels (default: varies by type)"},content:{type:"string",description:"Content for the node. For text/sticky: the text content. For image: URL. For shape: shape type (rectangle, circle, diamond, hexagon, star, arrow, cloud). For code: the code snippet."},style:{type:"string",description:'JSON string of style properties: { "backgroundColor": "#hex", "borderColor": "#hex", "textColor": "#hex", "fontSize": 14, "fontWeight": "bold" }'}},required:["canvasId","nodeType","x","y","content"]}},{name:"add_canvas_edge",description:"Add an edge (connection/arrow) between two nodes on a canvas. Use this to show relationships, data flow, or connections between elements. Edges can be straight lines, curved lines, step connectors, or arrows.",parameters:{type:"object",properties:{canvasId:{type:"string",description:"The ID of the canvas"},sourceNodeId:{type:"string",description:"ID of the source node (where the edge starts)"},targetNodeId:{type:"string",description:"ID of the target node (where the edge ends)"},edgeType:{type:"string",description:"Type of edge/connection",enum:["straight","curved","step","arrow"]},label:{type:"string",description:"Optional label to display on the edge"},style:{type:"string",description:'JSON string of style properties: { "strokeColor": "#hex", "strokeWidth": 2, "dashed": false }'}},required:["canvasId","sourceNodeId","targetNodeId","edgeType"]}},{name:"update_canvas_node",description:"Update an existing node on a canvas. Use this to change position, size, content, or styling of an element.",parameters:{type:"object",properties:{canvasId:{type:"string",description:"The ID of the canvas"},nodeId:{type:"string",description:"The ID of the node to update"},x:{type:"number",description:"New X position"},y:{type:"number",description:"New Y position"},width:{type:"number",description:"New width"},height:{type:"number",description:"New height"},content:{type:"string",description:"New content"},style:{type:"string",description:"New style JSON"}},required:["canvasId","nodeId"]}},{name:"get_health_summary",description:"Get a summary of health data for a specific date or today. Returns steps, heart rate, sleep, activity scores, and other health metrics synced from Apple Health. Use this when the user asks about their health, fitness, sleep, or activity data.",ownerOnly:!0,parameters:{type:"object",properties:{date:{type:"string",description:"The date to get health summary for in YYYY-MM-DD format. Defaults to today if not provided."}},required:[]}},{name:"get_health_trends",description:"Get health trends and weekly averages over time. Shows how steps, sleep, heart rate, and activity scores have changed over recent weeks. Use this when the user asks about their health trends, progress, or how their metrics have changed over time.",ownerOnly:!0,parameters:{type:"object",properties:{weeks:{type:"number",description:"Number of weeks to analyze. Defaults to 4 weeks."}},required:[]}},{name:"get_health_metric",description:"Get detailed data for a specific health metric over a date range. Returns raw samples for metrics like steps, heart rate, sleep, workouts, etc. Use this when the user wants to see detailed data for a specific metric.",ownerOnly:!0,parameters:{type:"object",properties:{metric:{type:"string",description:"The health metric to query",enum:["steps","distance","activeEnergy","heartRate","restingHeartRate","heartRateVariability","sleepAnalysis","weight","bodyFat","bloodOxygen","mindfulMinutes","workout","exerciseMinutes","standHours"]},startDate:{type:"string",description:"Start date in YYYY-MM-DD format. Defaults to 7 days ago."},endDate:{type:"string",description:"End date in YYYY-MM-DD format. Defaults to today."}},required:["metric"]}},{name:"compare_health_periods",description:"Compare health metrics between two time periods. Useful for seeing improvement or changes between this week vs last week, this month vs last month, etc.",ownerOnly:!0,parameters:{type:"object",properties:{period1Start:{type:"string",description:"Start date of first period (YYYY-MM-DD)"},period1End:{type:"string",description:"End date of first period (YYYY-MM-DD)"},period2Start:{type:"string",description:"Start date of second period (YYYY-MM-DD)"},period2End:{type:"string",description:"End date of second period (YYYY-MM-DD)"},metrics:{type:"array",description:"Which metrics to compare",items:{type:"string"}}},required:["period1Start","period1End","period2Start","period2End"]}},{name:"generate_health_api_key",description:"Generate a new API key for syncing Apple Health data from an iOS Shortcut. The key is shown only once and must be saved immediately. Use this when the user wants to set up health data syncing from their iPhone.",ownerOnly:!0,parameters:{type:"object",properties:{name:{type:"string",description:'A friendly name for this API key (e.g., "iPhone 15 Pro", "iPad")'},expiresInDays:{type:"number",description:"Number of days until the key expires. Leave empty for no expiration."}},required:["name"]}},{name:"list_health_api_keys",description:"List all API keys for Apple Health syncing. Shows key names, last used dates, and whether they are active or expired. Use this when the user wants to manage their health sync API keys.",ownerOnly:!0,parameters:{type:"object",properties:{},required:[]}},{name:"revoke_health_api_key",description:"Revoke an API key to stop it from being used for health data syncing. Use this when the user wants to disable a specific API key.",ownerOnly:!0,parameters:{type:"object",properties:{keyId:{type:"string",description:"The ID of the API key to revoke"}},required:["keyId"]}},{name:"get_health_sync_status",description:"Get the status of recent health data syncs. Shows when data was last synced, how many samples were received, and any errors. Use this when the user asks about their health sync status or if syncing is working.",ownerOnly:!0,parameters:{type:"object",properties:{limit:{type:"number",description:"Number of recent syncs to show. Defaults to 5."}},required:[]}},{name:"analyze_and_create_entity",description:'Analyze content (URL, text, or data) and automatically classify it into the appropriate ERV entity type. AI determines the best entity type, extracts relevant attributes, suggests tags, and creates the entity. Use this when the user pastes content, shares a URL, or describes something that should be stored. Examples: "save this article", "remember this person I met", "add this project idea".',parameters:{type:"object",properties:{content:{type:"string",description:"The content to analyze. Can be: raw text, a URL, JSON data, or a description of something to remember."},contentType:{type:"string",description:"Hint about the content type to help classification",enum:["url","text","json","description","auto"]},suggestedType:{type:"string",description:'Optional: Suggest an entity type if the user indicates preference (e.g., "save as a person")',enum:["Person","Project","Track","Draft","Sketch","Ticket","Epic","Event","Memory","Value","Collection","Skill","Reminder"]},additionalContext:{type:"string",description:'Optional: Additional context from the user about what this content is (e.g., "this is my coworker from the AI team")'}},required:["content"]},ownerOnly:!0},{name:"suggest_entity_relationships",description:'Analyze an entity and suggest relationships to other existing entities in the ERV system. Uses semantic similarity and content analysis to find connections the user might not have made explicitly. Returns suggested relationships with confidence scores and reasoning. Use when: user creates a new entity, asks "what is this related to?", or when building knowledge graphs.',parameters:{type:"object",properties:{entityId:{type:"string",description:"The entity ID to find relationships for"},relationshipTypes:{type:"array",items:{type:"string"},description:"Optional: Filter to specific relationship types (collaboratedOn, createdBy, mentions, relatedTo, etc.)"},maxSuggestions:{type:"number",description:"Maximum number of relationship suggestions to return (default: 10)"},minConfidence:{type:"number",description:"Minimum confidence threshold 0-1 for suggestions (default: 0.5)"},autoCreate:{type:"boolean",description:"If true, automatically create relationships above the confidence threshold (default: false)"}},required:["entityId"]},ownerOnly:!0},{name:"bulk_classify_entities",description:"Import and classify multiple items at once into ERV entities. Takes an array of content items and automatically determines entity types, extracts attributes, and creates entities in bulk. Useful for importing contacts, bookmarks, notes, or any list of items. Also suggests relationships between the imported entities and existing data.",parameters:{type:"object",properties:{items:{type:"array",description:'Array of items to classify. Each item should have at minimum a "content" field.',items:{type:"object",properties:{content:{type:"string"},hint:{type:"string"}}}},sourceFormat:{type:"string",description:"Format hint for the data source",enum:["csv","json","text_list","urls","contacts","bookmarks","notes","auto"]},defaultType:{type:"string",description:"Default entity type if classification is uncertain",enum:["Person","Project","Track","Draft","Sketch","Ticket","Epic","Event","Memory","Value","Collection","Skill","Reminder"]},commonTags:{type:"array",items:{type:"string"},description:'Tags to apply to all imported entities (e.g., ["import-2026-02", "contacts"])'},dryRun:{type:"boolean",description:"If true, return classification results without creating entities (default: false)"}},required:["items"]},ownerOnly:!0},{name:"cowrite_music",description:"ALWAYS use this tool FIRST when the user wants to create music. This tool helps craft the perfect music generation request through a conversational back-and-forth. It guides users to develop their musical vision step by step: 1) Genre/style direction, 2) Mood and energy, 3) Instrumentation, 4) Lyrics (if vocal), 5) Structure, 6) Reference track (optional), 7) Technical specs (BPM, key, duration). Returns a draft payload that can be refined before final generation. Use this instead of jumping straight to generate_music - it produces much better results.",parameters:{type:"object",properties:{step:{type:"string",enum:["start","refine_style","add_lyrics","set_structure","add_reference","finalize","generate"],description:"Which step of the cowriting process: start = begin new session, gather initial idea; refine_style = enhance style description with genre, instruments, mood; add_lyrics = help write or structure lyrics; set_structure = define song structure with tags; add_reference = incorporate reference audio for style matching; finalize = review and confirm all parameters; generate = user confirmed, proceed to generation"},userInput:{type:"string",description:"The user's input or response for this step of the cowriting process."},currentDraft:{type:"string",description:"JSON string of the current draft payload being built up. Pass this between steps to maintain state. Parse with JSON.parse(). Expected shape: { prompt?: string, lyrics?: string, duration?: number, bpm?: number, key?: string, timeSignature?: string, title?: string, referenceAudioUrl?: string, referenceStrength?: number }"}},required:["step","userInput"]},ownerOnly:!0},{name:"generate_music",description:"Generate original music using AI (ACE-Step). Creates audio from a style description and optional lyrics. Can generate 10 seconds to 10 minutes of music with control over BPM, key, and time signature. Supports 50+ languages for lyrics. Use structure tags like [Verse], [Chorus], [Bridge] for song structure. Supports reference audio for style transfer - provide a URL to match the vibe of an existing track. NOTE: For best results, use cowrite_music first to help the user craft their request.",parameters:{type:"object",properties:{prompt:{type:"string",description:'Musical style description. Be specific about genre, instruments, mood, and production style. Example: "upbeat indie folk with acoustic guitar, soft female vocals, warm production"'},lyrics:{type:"string",description:'Optional lyrics with structure tags. Use [Verse], [Chorus], [Bridge], [Intro], [Outro] for structure. Example: "[Verse]\\nWalking down the street\\n[Chorus]\\nThis is where I want to be"'},duration:{type:"number",description:"Duration in seconds (10-600). Default is 30 seconds. Use 180-300 for full songs."},bpm:{type:"number",description:"Beats per minute (60-200). Leave empty for auto-detection from prompt."},key:{type:"string",description:'Musical key like "C major", "A minor", "F# major". Leave empty for auto-detection.'},timeSignature:{type:"string",description:'Time signature like "4/4", "3/4", "6/8". Default is "4/4".'},referenceAudioUrl:{type:"string",description:"URL to a reference audio file for style transfer. The generated music will match the vibe, energy, and production style of this reference. Supports MP3, WAV, FLAC."},referenceStrength:{type:"number",description:"How strongly to match the reference audio style (0.0-1.0). Default is 0.5. Higher values = closer to reference style, lower = more creative freedom."},title:{type:"string",description:"Title for the generated track."},saveToJamz:{type:"boolean",description:"If true, automatically add the generated track to Jamz Studio."},projectId:{type:"string",description:"Jamz project ID to add the track to (if saveToJamz is true)."}},required:["prompt"]},ownerOnly:!0},{name:"analyze_audio",description:"Analyze audio to extract musical properties like BPM, key, time signature, and generate AI descriptions. Can also extract lyrics with timestamps from vocal tracks. Useful for understanding existing music before creating variations or matching styles.",parameters:{type:"object",properties:{audioUrl:{type:"string",description:"URL of the audio file to analyze."},extract:{type:"array",description:"What to extract from the audio.",items:{type:"string"}}},required:["audioUrl"]},ownerOnly:!0},{name:"separate_stems",description:"Separate audio into individual stems (vocals, drums, bass, other, piano, guitar). Useful for remixing, isolating vocals for analysis, or creating karaoke versions. Returns URLs to each separated stem audio file.",parameters:{type:"object",properties:{audioUrl:{type:"string",description:"URL of the audio file to separate."},stems:{type:"array",description:'Which stems to extract. Default is ["vocals", "drums", "bass", "other"].',items:{type:"string"}}},required:["audioUrl"]},ownerOnly:!0}];function i(e){return e.map(e=>({type:"function",function:{name:e.name,description:e.description,parameters:e.parameters}}))}function s(e){return e.map(e=>({name:e.function.name,arguments:JSON.parse(e.function.arguments)}))}e.s(["CLAW_AI_TOOLS",0,r,"NAVIGATION_DESTINATIONS",0,t,"parseToolCalls",()=>s,"toOpenAITools",()=>i],379970);var n=e.i(429311),o=e.i(850607),a=e.i(488782);e.i(771366);var c=e.i(192650),d=e.i(245290),p=e.i(550729);let l={userId:null,accessLevel:"visitor"};function u(e,t="owner"){if(!e.userId)throw Error("User ID required for this operation");if("owner"===t&&"owner"!==e.accessLevel)throw Error("Owner access required for this operation");return e.userId}let m=["/workspace","/home/user","/tmp/sandbox"],g=[/\.env($|\.)/i,/credentials/i,/secrets?\.?(json|yaml|yml|toml)?$/i,/\.key$/i,/\.pem$/i,/id_rsa/i,/id_ed25519/i,/\.ssh\//i,/convex\//,/node_modules\//,/\.git\//];function y(e){if("string"!=typeof e||!e)return{valid:!1,normalizedPath:"",error:"Path must be a non-empty string"};if(e.includes(".."))return{valid:!1,normalizedPath:"",error:"Path traversal (..) is not allowed"};if(!e.startsWith("/"))return{valid:!1,normalizedPath:"",error:"Path must be absolute (start with /)"};let t=e.replace(/\/+/g,"/").replace(/\/$/,"");if(!m.some(e=>t===e||t.startsWith(e+"/")))return{valid:!1,normalizedPath:t,error:`Path must be under one of: ${m.join(", ")}`};for(let e of g)if(e.test(t))return{valid:!1,normalizedPath:t,error:"Access to this file type is blocked for security reasons"};return{valid:!0,normalizedPath:t}}function h(e){return{success:!1,error:`[PATH SECURITY] ${e}`}}let f=[/password.*(?:expired|reset|verify|confirm|update)/i,/(?:verify|confirm|update).*(?:account|identity|credentials)/i,/(?:click|tap|visit).*(?:link|here).*(?:login|sign.?in|verify)/i,/urgent.*(?:action|response).*required/i,/(?:wire|transfer|send).*(?:money|funds|payment|bitcoin|crypto)/i,/(?:won|winner|lottery|prize|inheritance).*(?:claim|collect)/i,/(?:bank|paypal|venmo).*(?:suspended|locked|verify)/i,/(?:i am|this is).*(?:ceo|cfo|president|boss|manager).*(?:need|want|request)/i,/(?:gift.?card|itunes|amazon).*(?:purchase|buy|send)/i,/(?:computer|device|account).*(?:infected|hacked|compromised)/i,/(?:call|contact).*(?:immediately|urgently|asap)/i],b=[/bit\.ly/i,/tinyurl/i,/goo\.gl/i,/t\.co(?!m)/i,/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/,/(?:login|signin|verify|secure|account).*\.(tk|ml|ga|cf|gq)/i],v=[/rm\s+-rf\s+\/(?![\w])/i,/:\s*\(\s*\)\s*\{/i,/>\s*\/dev\/sd[a-z]/i,/dd\s+if=.*of=\/dev/i,/mkfs\./i,/shutdown|reboot|halt|poweroff/i,/chmod\s+777\s+\//i,/curl.*\|\s*(?:bash|sh)/i,/wget.*\|\s*(?:bash|sh)/i,/base64\s+-d.*\|\s*(?:bash|sh)/i,/eval\s*\(.*(?:curl|wget)/i],w=[/npm\s+publish/i,/git\s+push.*--force/i,/docker\s+(?:rm|rmi)\s+-f/i,/kubectl\s+delete/i,/aws\s+.*delete/i],k=new Set(["registry.npmjs.org","npm.pkg.github.com","pypi.org","files.pythonhosted.org","crates.io","static.crates.io","rubygems.org","github.com","api.github.com","raw.githubusercontent.com","gist.githubusercontent.com","gitlab.com","bitbucket.org","docs.github.com","docs.npmjs.com","docs.python.org","devdocs.io","developer.mozilla.org","cdn.jsdelivr.net","unpkg.com","cdnjs.cloudflare.com","nodejs.org","deno.land","vercel.com","api.vercel.com","registry.terraform.io"]),_=new Set(["localhost","127.0.0.1","0.0.0.0","169.254.169.254","metadata.google.internal"]),I=new Set(["delete_file","git_push","send_channel_message","delete_cron_job","cancel_meeting"]);async function C(e,t,r){if(I.has(e)){let r=function(e,t){switch(e){case"delete_file":return["File will be permanently deleted","This cannot be undone","Any references to this file may break"];case"git_push":if(t.force)return["Remote history will be overwritten","Other collaborators may lose work","This cannot be easily undone"];return["Changes will be pushed to remote","Others will see these commits"];case"send_channel_message":return["Message will be sent externally","Recipient will be notified","Message cannot be unsent"];case"delete_cron_job":return["Scheduled automation will be stopped","Job configuration will be lost"];case"cancel_meeting":return["All participants will be notified","Calendar events will be removed"];default:return["This action may have permanent effects"]}}(e,t);return{required:!0,reason:function(e,t){switch(e){case"delete_file":return`Delete file: ${t.path||"unknown path"}`;case"git_push":let r=t.branch||"current branch",i=t.force?" (FORCE PUSH)":"";return`Push to remote${i}: ${r}`;case"send_channel_message":return`Send message via ${t.channel||"channel"}`;case"delete_cron_job":return`Delete scheduled job: ${t.jobId||"unknown"}`;case"cancel_meeting":return`Cancel meeting: ${t.meetingId||"unknown"}`;default:return`Execute ${e}`}}(e,t),actionType:"destructive",toolName:e,toolArgs:t,consequences:r,approvalId:T(e,t)}}return"send_channel_message"===e&&await q(t,r)?{required:!0,reason:"This is your first message to this contact. Please confirm.",actionType:"first_use",toolName:e,toolArgs:t,consequences:["Message will be sent externally","Contact will see you initiated conversation"],approvalId:T(e,t)}:null}function T(e,t){let r=Date.now(),i=JSON.stringify(t).slice(0,50);return`approval_${e}_${r}_${Buffer.from(i).toString("base64").slice(0,10)}`}function x(e){return e.toLowerCase().replace(/^(mr|mrs|ms|dr|prof|sir|madam)\.?\s+/i,"").replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim()}function j(e){return e.toLowerCase().trim()}function S(e){return e.replace(/\D/g,"")}async function U(e,t){let r=e.recipientId,i=e.recipientName,s=e.recipientEmail;if(!r&&!i&&!s)return[];let n=process.env.NEXT_PUBLIC_CONVEX_URL;if(!n)return[];let o=[],c=new a.ConvexHttpClient(n);try{if(r){let e=S(r),t=await c.query(a.api.whatsappContacts.getContactByPhone,{phoneNumber:e});t&&o.push({contactId:t._id,matchType:"exact_phone",confidence:1,existingContact:t})}if(s&&0===o.length){let e=j(s);for(let t of(await c.query(a.api.whatsappContacts.listContacts,{})))if(t.email&&j(t.email)===e){o.push({contactId:t._id,matchType:"exact_email",confidence:1,existingContact:t});break}}if(i&&0===o.length){for(let e of(await c.query(a.api.whatsappContacts.listContacts,{})))if(e.displayName){let t=function(e,t){let r=x(e),i=x(t);if(r===i)return 1;let s=Math.max(r.length,i.length);return 0===s?0:1-function(e,t){let r=e.length,i=t.length,s=Array(r+1).fill(null).map(()=>Array(i+1).fill(0));for(let e=0;e<=r;e++)s[e][0]=e;for(let e=0;e<=i;e++)s[0][e]=e;for(let n=1;n<=r;n++)for(let r=1;r<=i;r++)e[n-1]===t[r-1]?s[n][r]=s[n-1][r-1]:s[n][r]=Math.min(s[n-1][r]+1,s[n][r-1]+1,s[n-1][r-1]+1);return s[r][i]}(r,i)/s}(i,e.displayName);t>=.85&&o.push({contactId:e._id,matchType:"fuzzy_name",confidence:t,existingContact:e})}o.sort((e,t)=>t.confidence-e.confidence)}return o}catch(e){return console.error("[ContactDedup] Error finding matching contacts:",e),[]}}async function q(e,t){let r=e.integrationId,i=e.recipientId;if(!r||!i)return!0;let s=process.env.NEXT_PUBLIC_CONVEX_URL;if(!s)return!0;try{let n=new a.ConvexHttpClient(s),o=await U(e,t);if(0===o.length)return!0;let c=t.userId;if(!c)return!0;o[0];let d=S(i);return!(await n.query(a.api.channels.getUserMessages,{userId:c,limit:100})).some(e=>e.integrationId===r&&S(e.recipientId||"")===d)}catch(e){return console.error("[ContactDedup] Error checking if new contact:",e),!0}}let D={compact_conversation:{baseTokens:1e4,baseTimeMs:5e3,confirmationThreshold:{tokens:5e4}},run_command:{baseTimeMs:3e4,confirmationThreshold:{time:6e4}},start_dev_server:{baseTimeMs:6e4,creditsPerCall:10,confirmationThreshold:{time:12e4}},clone_repository:{baseTimeMs:3e4,apiCalls:1,confirmationThreshold:{time:6e4}},write_file:{tokensPerKb:100,baseTimeMs:1e3},read_file:{tokensPerKb:50,baseTimeMs:500},send_channel_message:{apiCalls:1,baseTimeMs:2e3}};async function A(e,r=l,i={}){let{name:s,arguments:a}=e;if(!i.skipApprovalCheck){let e=await C(s,a,r);if(e&&e.approvalId!==i.approvalId)return{success:!1,requiresApproval:!0,approval:e,data:{message:`This action requires your approval: ${e.reason}`,approvalId:e.approvalId,consequences:e.consequences}}}let c=i.skipCostEstimate?null:function(e,t){let r,i=D[e];if(!i)return null;let s=[],n=i.baseTokens||0,o=i.baseTimeMs||0,a=i.apiCalls||0,c=i.creditsPerCall||0;if(i.tokensPerKb&&t.content){let e=Math.ceil(String(t.content).length/1024*i.tokensPerKb);n+=e,s.push({resource:"Content processing",amount:e,unit:"tokens"})}if("run_command"===e&&t.command){let e=String(t.command);/npm|pnpm|yarn/.test(e)&&/install|add|update/.test(e)&&(o*=3,r="Package installation can take several minutes"),/build|compile|test/.test(e)&&(o*=2)}let d=i.confirmationThreshold||{},p=!!(d.tokens&&n>d.tokens||d.time&&o>d.time||d.cost&&c>(d.cost||0));return(n>0&&s.push({resource:"AI tokens",amount:n,unit:"tokens",cost:Math.ceil(.003*n)}),o>0&&s.push({resource:"Estimated time",amount:Math.ceil(o/1e3),unit:"seconds"}),a>0&&s.push({resource:"External API calls",amount:a,unit:"calls"}),c>0&&s.push({resource:"Platform credits",amount:c,unit:"credits"}),0===s.length)?null:{estimatedTokens:n>0?n:void 0,estimatedTimeMs:o>0?o:void 0,estimatedApiCalls:a>0?a:void 0,estimatedCredits:c>0?c:void 0,breakdown:s,warning:r,requiresConfirmation:p}}(s,a),d=e=>c?{...e,costEstimate:c}:e;try{switch(s){case"search_system":return d(function(e){let t=e.query,r=e.category||"all";if(!t)return{success:!1,error:"Search query is required"};let i=(0,n.searchSystem)(t,{category:r,limit:8}),s=(0,n.formatSearchResults)(i);return{success:!0,data:{query:t,category:r,resultCount:i.length,results:i.map(e=>({type:e.type,title:e.title,description:e.description.slice(0,200),url:e.url,metadata:e.metadata})),formatted:s},action:{type:"show_results",payload:{results:i,query:t}}}}(a));case"navigate_to":var u,m,g,y,h,f,b=a;let e=b.destination,i=b.theme;if(!t.includes(e))return{success:!1,error:`Invalid destination: ${e}. Valid destinations: ${t.join(", ")}`};if(i&&!o.themes.some(e=>e.name===i))return{success:!1,error:`Invalid theme: ${i}`};let c={home:"/",story:"/story",design:"/design",resume:"/resume",projects:"/projects",blog:"/blog",music:"/music",humans:"/humans",themes:"/design",photos:"/photos",video:"/video",canvas:"/canvas",search:"/search"}[e]||`/${e}`;return i&&(c+=`${c.includes("?")?"&":"?"}theme=${i}`),{success:!0,data:{destination:e,url:c,theme:i,message:`Navigating to ${e}${i?` with the ${i} theme`:""}`},action:{type:"navigate",payload:{url:c,destination:e,theme:i}}};case"schedule_call":let l,_;return l=a.topic,_=process.env.NEXT_PUBLIC_CALENDLY_URL||"https://calendly.com/james-spalding",l&&(_+=`?a1=${encodeURIComponent(l)}`),{success:!0,data:{url:_,topic:l,message:l?`Opening calendar to schedule a call about: ${l}`:"Opening calendar to schedule a call"},action:{type:"open_calendar",payload:{url:_,topic:l}}};case"list_themes":let I,C,T;return I=a.category,T=(C=(0,n.getAllThemes)(I)).map(e=>e.title).join(", "),{success:!0,data:{count:C.length,themes:C.map(e=>({name:e.metadata?.themeName,label:e.title,url:e.url})),formatted:`Available themes (${C.length}): ${T}`}};case"open_search_app":let x;return(x=a.query)?{success:!0,data:{query:x,message:`Opening Search app with query: "${x}"`},action:{type:"open_search",payload:{url:`/search?q=${encodeURIComponent(x)}`,query:x}}}:{success:!1,error:"Search query is required"};case"show_weather":let j,S,U;return j=a.location||"San Francisco",U=(S=["sunny","cloudy","rainy","windy"])[Math.floor(Math.random()*S.length)],{success:!0,data:{location:j,temperature:Math.floor(55+25*Math.random()),condition:U,humidity:Math.floor(40+40*Math.random()),windSpeed:Math.floor(5+15*Math.random())}};case"show_kanban_tasks":let q,D,A,ek,eB;return q=(u=a).filter||"all",D=u.tag,A=u.limit||5,ek=[{id:"p8-1",title:"[P8] 8gent Search - Tool Definitions",description:"Create tools.ts with search_system, navigate_to, schedule_call, list_themes.",status:"done",priority:"high",tags:["P8","claw-ai","tools"]},{id:"p8-2",title:"[P8] 8gent Search - Convex Integration",description:"Integrate search with Convex backend for persistent indexing.",status:"in-progress",priority:"high",tags:["P8","claw-ai","search","convex"]},{id:"p0-1",title:"[P0] Command Palette - Core Component",description:"Create CommandPalette.tsx with Liquid Glass styling.",status:"todo",priority:"urgent",tags:["P0","command-palette","macro"]},{id:"p1-1",title:"[P1] Projects Landing - Folder Cards",description:"Create ProjectsLanding.tsx with folder cards.",status:"todo",priority:"high",tags:["P1","projects","landing"]},{id:"done-1",title:"Next.js 14 App Router Setup",description:"Initial project setup with Next.js 14, TypeScript, and Tailwind CSS",status:"done",priority:"high",tags:["foundation","setup"]}],"all"!==q&&(ek=ek.filter(e=>e.status===q)),D&&(ek=ek.filter(e=>e.tags.some(e=>e.toLowerCase().includes(D.toLowerCase())))),eB=ek.slice(0,A),{success:!0,data:{filter:q,tag:D,count:eB.length,tasks:eB}};case"show_photos":let eQ,eZ,e0;return eQ=a.count||6,e0=(eZ=[{id:"1",src:"/photos/aurora.jpeg",alt:"Aurora Borealis",caption:"Northern Lights over Ireland"},{id:"2",src:"/photos/Sunriseoverhowth.jpeg",alt:"Sunrise over Howth",caption:"Sunrise over Howth, Dublin"},{id:"3",src:"/photos/Donabatebeach.jpeg",alt:"Donabate Beach",caption:"Donabate Beach, North Dublin"},{id:"4",src:"/photos/SunsetPortrane.jpeg",alt:"Sunset at Portrane",caption:"Sunset at Portrane"},{id:"5",src:"/photos/Glenofthedowns.jpeg",alt:"Glen of the Downs",caption:"Glen of the Downs, Wicklow"},{id:"6",src:"/photos/Robin.jpeg",alt:"Robin",caption:"Robin in the garden"},{id:"7",src:"/photos/Nightsky.jpeg",alt:"Night Sky",caption:"Night sky photography"},{id:"8",src:"/photos/Mistysunrise.jpeg",alt:"Misty Sunrise",caption:"Misty morning sunrise"},{id:"9",src:"/photos/Corballis.jpeg",alt:"Corballis",caption:"Corballis, North Dublin"},{id:"10",src:"/photos/sunsetachill.jpeg",alt:"Sunset Achill",caption:"Sunset at Achill Island"},{id:"11",src:"/photos/SunsetSalvador.jpeg",alt:"Sunset Salvador",caption:"Sunset in Salvador, Brazil"},{id:"12",src:"/photos/Portranedemense.jpeg",alt:"Portrane Demesne",caption:"Portrane Demesne woods"}]).slice(0,Math.min(eQ,eZ.length)),{success:!0,data:{count:e0.length,photos:e0,message:`Showing ${e0.length} photos from the user's gallery. These are mostly from Ireland where the system was developed.`}};case"render_ui":let e1,tn;return e1=(m=a).ui_tree,tn=m.title,e1?e1.root&&e1.elements?{success:!0,data:{title:tn,ui_tree:e1},action:{type:"render_ui",payload:{title:tn,ui_tree:e1}}}:{success:!1,error:'Invalid UI tree structure. Must have "root" and "elements" properties.'}:{success:!1,error:"UI tree is required"};case"create_project":var v=a;let to=v.name,ta=v.description,tc=v.color;if(!to)return{success:!1,error:"Project name is required"};let td=to.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"");return{success:!0,data:{name:to,description:ta,color:tc||"#8b5cf6",slug:td,message:`Creating project "${to}"...`},action:{type:"project_created",payload:{name:to,description:ta,color:tc||"#8b5cf6",slug:td,convexMutation:"agentic:createProductProject"}}};case"create_prd":let tp,tl,tu,tm;return tp=(g=a).projectId,tl=g.title,tu=g.executiveSummary,tm=g.problemStatement,tp?tl?{success:!0,data:{projectId:tp,title:tl,executiveSummary:tu,problemStatement:tm,message:`Creating PRD "${tl}"...`},action:{type:"prd_created",payload:{projectId:tp,title:tl,executiveSummary:tu,problemStatement:tm,generatedBy:"ai",convexMutation:"agentic:createPRD"}}}:{success:!1,error:"PRD title is required"}:{success:!1,error:"Project ID is required to create a PRD"};case"create_ticket":let tg,ty,th,tf,tb,tv,tw,tk,t_;return tg=(y=a).projectId,ty=y.title,th=y.description,tf=y.type||"story",tb=y.priority||"P2",tv=y.asA,tw=y.iWant,tk=y.soThat,t_=y.labels,tg?ty?{success:!0,data:{projectId:tg,title:ty,description:th,type:tf,priority:tb,asA:tv,iWant:tw,soThat:tk,labels:t_,message:`Creating ticket "${ty}"...`},action:{type:"ticket_created",payload:{projectId:tg,title:ty,description:th,type:tf,priority:tb,asA:tv,iWant:tw,soThat:tk,labels:t_,createdBy:"ai",convexMutation:"agentic:createTicket"}}}:{success:!1,error:"Ticket title is required"}:{success:!1,error:"Project ID is required to create a ticket"};case"update_ticket":return function(e){let t=e.ticketId,r=e.status,i=e.priority,s=e.title,n=e.description,o=e.assigneeId;if(!t)return{success:!1,error:"Ticket ID is required"};let a={};return(r&&(a.status=r),i&&(a.priority=i),s&&(a.title=s),n&&(a.description=n),o&&(a.assigneeId=o),0===Object.keys(a).length)?{success:!1,error:"At least one field to update is required"}:{success:!0,data:{ticketId:t,updates:a,message:`Updating ticket ${t}...`},action:{type:"ticket_updated",payload:{ticketId:t,...a,convexMutation:"agentic:updateTicket"}}}}(a);case"shard_prd":let tI,tC;return tI=(h=a).prdId,tC=h.projectId,tI?tC?{success:!0,data:{prdId:tI,projectId:tC,message:"Sharding PRD into epics and tickets..."},action:{type:"prd_sharded",payload:{prdId:tI,projectId:tC,convexMutation:"agentic:shardPRDToTickets"}}}:{success:!1,error:"Project ID is required"}:{success:!1,error:"PRD ID is required"};case"get_project_kanban":let tT;return(tT=a.projectId)?{success:!0,data:{projectId:tT,message:"Loading Kanban board..."},action:{type:"show_kanban",payload:{projectId:tT,convexQuery:"agentic:getKanbanBoard"}}}:{success:!1,error:"Project ID is required"};case"list_projects":let tx;return tx=a.status,{success:!0,data:{status:tx,message:tx?`Loading ${tx} projects...`:"Loading all projects..."},action:{type:"render_component",payload:{componentType:"projects",status:tx,convexQuery:"agentic:getProductProjects"}}};case"get_available_times":return await $(a);case"get_upcoming_bookings":return await R(a);case"book_meeting":return await E(a);case"reschedule_meeting":return await L(a);case"cancel_meeting":return await P(a);case"remember":return await M(a,r);case"recall_preference":return await O(a,r);case"memorize":return await N(a,r);case"learn":return await F(a,r);case"forget":return await z(a,r);case"set_active_context":return await B(a);case"get_active_context":return await H(a);case"load_context_from_reference":return await X(a);case"clone_repository":return await V(a);case"list_directory":return await G(a);case"search_codebase":return await W(a);case"read_file":return await J(a);case"write_file":return await Y(a);case"edit_file":return await K(a);case"delete_file":return await Q(a);case"run_command":return await Z(a);case"start_dev_server":return await ee(a);case"get_preview_url":return await et(a);case"git_status":return await er(a);case"git_diff":return await ei(a);case"git_commit":return await es(a);case"git_push":return await en(a);case"create_branch":return await eo(a);case"create_coding_task":return await ea(a);case"update_coding_task":return await ec(a);case"list_coding_tasks":return await ed(a);case"create_cron_job":return await ep(a,r);case"list_cron_jobs":return await el(a,r);case"toggle_cron_job":return await eu(a);case"delete_cron_job":return await em(a);case"compact_conversation":return await eg(a,r);case"get_compaction_summary":return await ey(a);case"list_channel_integrations":return await eh(a,r);case"get_channel_conversations":return await ef(a,r);case"send_channel_message":return await eb(a,r);case"search_channel_messages":return await ev(a,r);case"create_dimension":return await e_(a);case"navigate_to_dimension":var w=a;let tj=w.dimensionId;if(!tj)return{success:!1,error:"Dimension ID is required"};let tS=ew.find(e=>e.id===tj),tU=tS?.name||tj;return{success:!0,data:{dimensionId:tj,name:tU,isPreset:!!tS,message:`Navigating to ${tU} dimension...`},action:{type:"dimension_navigated",payload:{dimensionId:tj,name:tU,navigateTo:`/d/${tj}`}}};case"list_dimensions":return await eI(a);case"search_entities":return await eC(a);case"analyze_and_create_entity":return await e2(a,r);case"suggest_entity_relationships":return await e5(a,r);case"bulk_classify_entities":return await e3(a,r);case"create_video_composition":return function(e){let t=e.name,r=e.type,i=e.preset||"1080p",s=e.durationSeconds||30,n=e.backgroundColor,o=e.backgroundGradient;if(!t)return{success:!1,error:"Composition name is required"};let a=ex[i]||ex["1080p"],c=`video-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,d=Date.now(),p={id:c,name:t,type:r,preset:i,width:a.width,height:a.height,fps:a.fps,durationInFrames:s*a.fps,layers:[],backgroundColor:n||"#000000",backgroundGradient:o,createdAt:d,updatedAt:d};return eT.set(c,p),{success:!0,data:{compositionId:c,name:t,type:r,preset:i,dimensions:`${a.width}x${a.height}`,fps:a.fps,durationSeconds:s,durationInFrames:p.durationInFrames,message:`Created ${r} composition "${t}" (${a.width}x${a.height} @ ${a.fps}fps, ${s}s)`},action:{type:"video_composition_created",payload:{compositionId:c,composition:{name:t,type:r,width:a.width,height:a.height,durationSeconds:s}}}}}(a);case"add_text_overlay":return function(e){let t=e.compositionId,r=e.text,i=e.position||"center",s=e.startTime||0,n=e.duration,o=e.fontSize||32,a=e.color||"#ffffff",c=e.animation||"fade";if(!t)return{success:!1,error:"Composition ID is required"};if(!r)return{success:!1,error:"Text content is required"};let d=eT.get(t);if(!d)return{success:!1,error:`Composition not found: ${t}`};let p=`text-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,l=Math.floor(s*d.fps),u=n?Math.floor(n*d.fps):d.durationInFrames-l,m={id:p,type:"text",text:r,position:i,startFrame:l,durationInFrames:u,fontSize:o,color:a,animationIn:c,animationOut:"fade",zIndex:d.layers.length+1};return d.layers.push(m),d.updatedAt=Date.now(),{success:!0,data:{layerId:p,compositionId:t,text:r.slice(0,50)+(r.length>50?"...":""),position:i,startTime:s,duration:n||(d.durationInFrames-l)/d.fps,animation:c,message:`Added text overlay "${r.slice(0,30)}${r.length>30?"...":""}" at ${i}`},action:{type:"video_layer_added",payload:{compositionId:t,layerId:p,layerType:"text",preview:r.slice(0,50)}}}}(a);case"add_lyrics_to_video":return function(e){let t=e.compositionId,r=e.audioSrc,i=e.lyrics,s=e.style||"karaoke",n=e.fontFamily||"Inter, sans-serif",o=e.color||"#ffffff",a=e.highlightColor||"#ffcc00",c=e.position||"center";if(!t)return{success:!1,error:"Composition ID is required"};if(!r)return{success:!1,error:"Audio source is required"};if(!i||0===i.length)return{success:!1,error:"Lyrics array is required with timing information"};let d=eT.get(t);if(!d)return{success:!1,error:`Composition not found: ${t}`};d.audio={src:r,volume:1};let p=`lyrics-${Date.now()}`,l=Math.max(...i.map(e=>e.endTime)),u=Math.ceil(l*d.fps);u>d.durationInFrames&&(d.durationInFrames=u);let m={id:p,type:"lyrics",lyrics:i,audioSrc:r,style:s,fontFamily:n,fontSize:48,color:o,highlightColor:a,position:c,startFrame:0,durationInFrames:d.durationInFrames,zIndex:d.layers.length+1};return d.layers.push(m),d.updatedAt=Date.now(),{success:!0,data:{layerId:p,compositionId:t,lyricCount:i.length,style:s,audioSrc:r,totalDuration:l,message:`Added ${i.length} lyric lines with ${s} style. Total duration: ${l.toFixed(1)}s`},action:{type:"video_lyrics_added",payload:{compositionId:t,layerId:p,lyricCount:i.length,style:s,previewLyrics:i.slice(0,3).map(e=>e.text)}}}}(a);case"add_media_to_video":return function(e){let t=e.compositionId,r=e.mediaSrc,i=e.mediaType,s=e.startTime||0,n=e.duration,o=e.position||{x:0,y:0},a=e.scale||1,c=e.opacity??1,d=e.objectFit||"cover";if(!t)return{success:!1,error:"Composition ID is required"};if(!r)return{success:!1,error:"Media source is required"};let p=eT.get(t);if(!p)return{success:!1,error:`Composition not found: ${t}`};let l=`${i}-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,u=Math.floor(s*p.fps),m=n?Math.floor(n*p.fps):p.durationInFrames-u,g={id:l,type:i,src:r,position:o,startFrame:u,durationInFrames:m,scale:{x:a,y:a},opacity:c,objectFit:d,zIndex:p.layers.length+1};return p.layers.push(g),p.updatedAt=Date.now(),{success:!0,data:{layerId:l,compositionId:t,mediaType:i,mediaSrc:r,startTime:s,duration:m/p.fps,message:`Added ${i} layer from ${r.split("/").pop()||r}`},action:{type:"video_layer_added",payload:{compositionId:t,layerId:l,layerType:i,mediaSrc:r}}}}(a);case"preview_video":var k=a;let tq=k.compositionId,tD=k.openInCanvas||!1;if(!tq)return{success:!1,error:"Composition ID is required"};let tA=eT.get(tq);return tA?{success:!0,data:{compositionId:tq,composition:{name:tA.name,type:tA.type,width:tA.width,height:tA.height,fps:tA.fps,durationInFrames:tA.durationInFrames,durationSeconds:tA.durationInFrames/tA.fps,layerCount:tA.layers.length,layers:tA.layers.map(e=>({id:e.id,type:e.type})),hasAudio:!!tA.audio},openInCanvas:tD,message:`Preview ready for "${tA.name}" - ${tA.layers.length} layers, ${(tA.durationInFrames/tA.fps).toFixed(1)}s`},action:{type:"video_preview_ready",payload:{compositionId:tq,composition:tA,openInCanvas:tD}}}:{success:!1,error:`Composition not found: ${tq}`};case"render_video":return await ej(a);case"sync_lyrics_to_audio":return await eS(a);case"get_render_status":return await eU(a);case"create_talking_video":return await eq(a);case"generate_video_script":return await eD(a);case"generate_voice_audio":return await eA(a);case"navigate_to_video_studio":let t$,tR;return t$=a.prefillTopic,tR="/video",t$&&(tR+=`?topic=${encodeURIComponent(t$)}`),{success:!0,data:{url:tR,prefillTopic:t$,message:"Opening the video studio..."},action:{type:"navigate",payload:{url:tR,destination:"video",prefillTopic:t$}}};case"generate_video":return await e$(a);case"animate_image":return await eR(a);case"list_video_presets":return{success:!0,data:{presets:Object.entries(p.LTX_PRESETS).map(([e,t])=>({id:e,name:t.name,description:t.description,width:t.width,height:t.height,frames:t.num_frames,approximateDuration:`~${Math.round(t.num_frames/24)} seconds`})),message:"Available video generation presets:"}};case"get_ai_provider_status":return f=a,{success:!0,data:{message:"Checking AI provider status...",note:"The current provider information is included in each chat response. Check the response metadata for provider, providerModel, and fallbackUsed fields.",settingsUrl:"/settings/ai"},action:{type:"check_provider_status",payload:{includeLatency:f.includeLatency??!1,healthEndpoint:"/api/health/providers",settingsUrl:"/settings/ai"}}};case"navigate_to_ai_settings":return{success:!0,data:{url:"/settings/ai",message:"Opening AI provider settings..."},action:{type:"navigate",payload:{url:"/settings/ai",destination:"settings"}}};case"get_kanban_task":return await eE(a);case"search_kanban_tasks":return await eL(a);case"create_canvas":return await eP(a,r);case"list_canvases":return await eM(a,r);case"get_canvas":return await eO(a);case"add_canvas_node":return await eN(a,r);case"add_canvas_edge":return await eF(a);case"update_canvas_node":return await ez(a);case"get_health_summary":return await eH(a,r);case"get_health_trends":return await eX(a,r);case"get_health_metric":return await eV(a,r);case"compare_health_periods":return await eG(a,r);case"generate_health_api_key":return await eW(a,r);case"list_health_api_keys":return await eJ(r);case"revoke_health_api_key":return await eY(a,r);case"get_health_sync_status":return await eK(a,r);case"spawn_task":return await e4(a);case"list_background_tasks":return await e6(a);case"cancel_background_task":return await e8(a);case"get_task_result":return await e9(a);case"iterate_on_code":return await e7(a);case"delegate_to_specialist":return await te(a);case"cowrite_music":return await tt(a,r);case"generate_music":return await tr(a,r);case"analyze_audio":return await ti(a,r);case"separate_stems":return await ts(a,r);default:return d({success:!1,error:`Unknown tool: ${s}`})}}catch(e){return d({success:!1,error:e instanceof Error?e.message:"Tool execution failed"})}}async function $(e){let t=e.date,r=e.duration||30;try{let e=process.env.NEXT_PUBLIC_CONVEX_URL;if(!e)return{success:!1,error:"Convex URL not configured"};let i=new a.ConvexHttpClient(e),s=await i.query(a.api.scheduling.getEventTypes,{}),n=s?.find(e=>e.isActive&&e.duration===r)||s?.[0];if(!n)return{success:!1,error:"No active event types found"};let o=t||new Date().toISOString().split("T")[0],c=Intl.DateTimeFormat().resolvedOptions().timeZone,d=await i.query(a.api.scheduling.getAvailableSlots,{eventTypeId:n._id,date:o,timezone:c}),p=d?.map(e=>e.time?e.time:e.timestamp?new Date(e.timestamp).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"").filter(Boolean)||[];return{success:!0,data:{date:o,duration:r,slots:d||[],formatted:p.length>0?`Available times on ${o}: ${p.join(", ")}`:`No available times on ${o}`}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get available times"}}}async function R(e){let t=e.limit||5;try{let e=process.env.NEXT_PUBLIC_CONVEX_URL;if(!e)return{success:!1,error:"Convex URL not configured"};return new a.ConvexHttpClient(e),{success:!0,data:{message:"To view upcoming bookings, please check the calendar dashboard at /calendar",limit:t}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get upcoming bookings"}}}async function E(e){let t=e.guestName,r=e.guestEmail,i=e.startTime,s=e.topic,n=e.duration||30;if(!t||!r||!i)return{success:!1,error:"guestName, guestEmail, and startTime are required"};try{let e=process.env.NEXT_PUBLIC_CONVEX_URL;if(!e)return{success:!1,error:"Convex URL not configured"};let o=new a.ConvexHttpClient(e),c=await o.query(a.api.scheduling.getEventTypes,{}),d=c?.find(e=>e.isActive&&e.duration===n)||c?.[0];if(!d)return{success:!1,error:"No active event type found for the specified duration. Please ensure you are authenticated and have created event types."};let p=Intl.DateTimeFormat().resolvedOptions().timeZone,l=await o.mutation(a.api.scheduling.createBooking,{eventTypeId:d._id,guestName:t,guestEmail:r,guestTimezone:p,startTime:i,notes:s});return{success:!0,data:{bookingId:l,guestName:t,guestEmail:r,startTime:new Date(i).toISOString(),duration:n,message:`Meeting booked successfully for ${t} on ${new Date(i).toLocaleString()}`}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to book meeting"}}}async function L(e){let t=e.bookingId,r=e.newStartTime;if(!t||!r)return{success:!1,error:"bookingId and newStartTime are required"};try{let e=process.env.NEXT_PUBLIC_CONVEX_URL;if(!e)return{success:!1,error:"Convex URL not configured"};let i=new a.ConvexHttpClient(e),s=await i.mutation(a.api.scheduling.rescheduleBooking,{id:t,newStartTime:r});return{success:!0,data:{oldBookingId:t,newBookingId:s,newStartTime:new Date(r).toISOString(),message:`Meeting rescheduled to ${new Date(r).toLocaleString()}`}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to reschedule meeting"}}}async function P(e){let t=e.bookingId,r=e.reason;if(!t)return{success:!1,error:"bookingId is required"};try{let e=process.env.NEXT_PUBLIC_CONVEX_URL;if(!e)return{success:!1,error:"Convex URL not configured"};let i=new a.ConvexHttpClient(e);return await i.mutation(a.api.scheduling.updateBookingStatus,{id:t,status:"cancelled",cancelReason:r,cancelledBy:"host"}),{success:!0,data:{bookingId:t,message:`Meeting cancelled${r?`: ${r}`:""}`}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to cancel meeting"}}}async function M(e,t){let r=e.query,i=e.memoryType||"all",s=e.limit||10;if(!r)return{success:!1,error:"Query is required to search memories"};try{let e=u(t),n=(0,c.getMemoryManager)(),o=await n.loadRelevantMemories(e,r,{limit:s,includeEpisodic:!0,includeSemantic:!0}),a=o.episodic;"all"!==i&&(a=a.filter(e=>e.memoryType===i));let d=a.length+o.semantic.length,p=a.map(e=>({id:e._id,type:e.memoryType,content:e.content,importance:e.importance,timestamp:e.timestamp})),l=o.semantic.map(e=>({id:e._id,category:e.category,key:e.key,value:e.value,confidence:e.confidence}));return{success:!0,data:{query:r,memoriesFound:d,episodic:p,semantic:l,contextSummary:o.contextSummary,message:d>0?`Found ${d} relevant memories`:"No memories found matching your query"},action:{type:"memory_recalled",payload:{query:r,count:d,episodic:p,semantic:l}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to search memories"}}}async function O(e,t){let r=e.category,i=e.key;if(!r)return{success:!1,error:"Category is required to recall preferences"};try{let e=u(t),s=(0,c.getMemoryManager)(),n=await s.loadSemanticMemories(e,[r]),o=n;i&&(o=n.filter(e=>e.key.includes(i))),o.sort((e,t)=>t.confidence-e.confidence);let a=o.map(e=>({id:e._id,category:e.category,key:e.key,value:e.value,confidence:e.confidence,lastUpdated:e.updatedAt}));return{success:!0,data:{category:r,key:i,count:a.length,preferences:a,message:a.length>0?`Found ${a.length} ${r}(s)`:`No ${r}s found${i?` matching "${i}"`:""}`},action:{type:"memory_recalled",payload:{category:r,key:i,preferences:a}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to recall preferences"}}}async function N(e,t){let r=e.content,i=e.memoryType,s=e.importance||.7,n=e.projectId;if(!r)return{success:!1,error:"Content is required to store a memory"};if(!i)return{success:!1,error:"Memory type is required"};let o=Math.max(0,Math.min(1,s));try{let e=u(t),s=(0,c.getMemoryManager)(),a=await s.storeEpisodicMemory(e,r,i,o,n,{toolsUsed:["memorize"],outcome:"Explicitly stored by user request"});return{success:!0,data:{memoryId:a,content:r,memoryType:i,importance:o,message:`Memory stored successfully as a ${i} with importance ${o}`},action:{type:"memory_stored",payload:{memoryId:a,content:r,memoryType:i,importance:o}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to store memory"}}}async function F(e,t){let r=e.category,i=e.key,s=e.value,n=e.confidence||.7;if(!r||!i||!s)return{success:!1,error:"Category, key, and value are required to learn something new"};let o=Math.max(0,Math.min(1,n));try{let e=u(t),n=(0,c.getMemoryManager)(),a=await n.upsertSemanticMemory(e,r,i,s,o,"learn_tool");return{success:!0,data:{memoryId:a,category:r,key:i,value:s,confidence:o,message:`Learned: ${r} "${i}" = "${s}" (confidence: ${o})`},action:{type:"memory_learned",payload:{memoryId:a,category:r,key:i,value:s,confidence:o}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to learn"}}}async function z(e,t){let r=e.memoryId,i=e.memoryKind;if(!r)return{success:!1,error:"Memory ID is required to forget a memory"};if(!i||!["episodic","semantic"].includes(i))return{success:!1,error:'Memory kind must be either "episodic" or "semantic"'};try{let e=u(t),s=(0,c.getMemoryManager)();return"episodic"===i?await s.deleteEpisodicMemory(r,e):await s.deleteSemanticMemory(r,e),{success:!0,data:{memoryId:r,memoryKind:i,message:"Memory deleted successfully"},action:{type:"memory_deleted",payload:{memoryId:r,memoryKind:i}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to delete memory"}}}async function B(e){let t=e.projectId,r=e.projectSlug,i=e.prdId,s=e.ticketId,n=e.canvasId,o=e.sandboxId,a=e.repositoryUrl;return{success:!0,data:{projectId:t,projectSlug:r,prdId:i,ticketId:s,canvasId:n,sandboxId:o,repositoryUrl:a,message:"Setting active context..."},action:{type:"context_updated",payload:{projectId:t,projectSlug:r,prdId:i,ticketId:s,canvasId:n,sandboxId:o,repositoryUrl:a,convexMutation:"workingContext:updateActiveContext"}}}}async function H(e){return{success:!0,data:{message:"Loading active context..."},action:{type:"context_loaded",payload:{convexQuery:"workingContext:getActiveContext"}}}}async function X(e){let t=e.referenceType,r=e.referenceId;if(!t||!r)return{success:!1,error:"Reference type and ID are required"};let i={ticket:"workingContext:loadContextFromTicket",project:"workingContext:loadContextFromProject",prd:"workingContext:loadContextFromPRD",epic:"workingContext:loadContextFromEpic",canvas:"workingContext:loadContextFromCanvas",memory:"workingContext:loadContextFromMemory"}[t];return i?{success:!0,data:{referenceType:t,referenceId:r,message:`Loading context for @${t}:${r}...`},action:{type:"context_loaded",payload:{referenceType:t,referenceId:r,convexQuery:i}}}:{success:!1,error:`Unknown reference type: ${t}`}}async function V(e){let t=e.url,r=e.branch;if(!t)return{success:!1,error:"Repository URL is required"};if(r&&(!/^[a-zA-Z0-9._\/-]+$/.test(r)||r.includes("..")||!(r.length>0)||!(r.length<=255)))return{success:!1,error:"Invalid branch name. Branch names can only contain letters, numbers, dots, slashes, underscores, and hyphens."};if(!/^https:\/\/github\.com\/[\w-]+\/[\w.-]+$/.test(t.replace(/\.git$/,"")))return{success:!1,error:"Invalid GitHub repository URL. Expected format: https://github.com/owner/repo"};let i=t.replace(/\.git$/,"").match(/github\.com\/([\w-]+)\/([\w.-]+)/),s=i?.[1],n=i?.[2];return{success:!0,data:{url:t,branch:r,owner:s,repo:n,message:`Cloning ${s}/${n}${r?` (branch: ${r})`:""}...`},action:{type:"repo_cloned",payload:{url:t,branch:r,owner:s,repo:n,sandboxOperation:"clone"}}}}async function G(e){let t=e.path,r=e.recursive||!1,i=e.maxDepth||3;return t?{success:!0,data:{path:t,recursive:r,maxDepth:i,message:`Listing ${r?"recursively ":""}${t}...`},action:{type:"directory_listed",payload:{path:t,recursive:r,maxDepth:i,sandboxOperation:"listDir"}}}:{success:!1,error:"Path is required"}}async function W(e){let t=e.pattern,r=e.path||".",i=e.filePattern,s=e.caseSensitive||!1,n=e.maxResults||50;return t?{success:!0,data:{pattern:t,path:r,filePattern:i,caseSensitive:s,maxResults:n,message:`Searching for "${t}"${i?` in ${i} files`:""}...`},action:{type:"files_searched",payload:{pattern:t,path:r,filePattern:i,caseSensitive:s,maxResults:n,sandboxOperation:"grep"}}}:{success:!1,error:"Search pattern is required"}}async function J(e){let t=e.path,r=e.startLine,i=e.endLine;if(!t)return{success:!1,error:"File path is required"};let s=y(t);return s.valid?{success:!0,data:{path:s.normalizedPath,startLine:r,endLine:i,message:`Reading ${s.normalizedPath}${r?` (lines ${r}-${i||"end"})`:""}...`},action:{type:"file_read",payload:{path:s.normalizedPath,startLine:r,endLine:i,sandboxOperation:"readFile"}}}:h(s.error||"Invalid path")}async function Y(e){let t=e.path,r=e.content,i=e.createDirectories??!0;if(!t)return{success:!1,error:"File path is required"};if(null==r)return{success:!1,error:"Content is required"};let s=y(t);return s.valid?{success:!0,data:{path:s.normalizedPath,contentLength:r.length,createDirectories:i,message:`Writing to ${s.normalizedPath} (${r.length} characters)...`},action:{type:"file_written",payload:{path:s.normalizedPath,content:r,createDirectories:i,sandboxOperation:"writeFile"}}}:h(s.error||"Invalid path")}async function K(e){let t=e.path,r=e.oldText,i=e.newText,s=e.replaceAll||!1;if(!t)return{success:!1,error:"File path is required"};if(!r)return{success:!1,error:"Old text to replace is required"};if(null==i)return{success:!1,error:"New text is required"};let n=y(t);return n.valid?{success:!0,data:{path:n.normalizedPath,replaceAll:s,message:`Editing ${n.normalizedPath}${s?" (all occurrences)":""}...`},action:{type:"file_written",payload:{path:n.normalizedPath,oldText:r,newText:i,replaceAll:s,sandboxOperation:"editFile"}}}:h(n.error||"Invalid path")}async function Q(e){let t=e.path,r=e.recursive||!1;if(!t)return{success:!1,error:"Path is required"};let i=y(t);return i.valid?{success:!0,data:{path:i.normalizedPath,recursive:r,message:`Deleting ${i.normalizedPath}${r?" (recursive)":""}...`},action:{type:"file_written",payload:{path:i.normalizedPath,recursive:r,sandboxOperation:"delete"}}}:h(i.error||"Invalid path")}async function Z(e){var t,r;let i=e.command,s=e.cwd,n=Math.min(e.timeout||6e4,3e5);if(!i)return{success:!1,error:"Command is required"};let o=function(e){let t;if(!e||"string"!=typeof e)return{valid:!1,error:"Command is required",requiresSandbox:!0};if(0===e.trim().length)return{valid:!1,error:"Command cannot be empty",requiresSandbox:!0};if(e.length>1e4)return{valid:!1,error:"Command too long (max 10000 characters)",requiresSandbox:!0};for(let t of v)if(t.test(e))return{valid:!1,error:"Command contains dangerous patterns that could harm the system",requiresSandbox:!0};for(let r of w)if(r.test(e)){t="This command performs a sensitive operation. Proceed with caution.";break}return{valid:!0,warning:t,requiresSandbox:!0}}(i);if(!o.valid)return t=o.error||"Invalid command",{success:!1,error:`[COMMAND SECURITY] ${t}`};let a=function(e){for(let t of[/https?:\/\/[^\s"']+/g,/git@([^:]+):/g,/(?:curl|wget|fetch)\s+[^\s]+/g]){let r=e.match(t);if(r)for(let e of r){let t=function(e){let t=function(e){try{let t=e.startsWith("http")?e:`https://${e}`;return new URL(t).hostname.toLowerCase()}catch{let t=e.match(/^(?:https?:\/\/)?([^\/:\s]+)/);return t?t[1].toLowerCase():null}}(e);if(!t)return{valid:!1,error:"Invalid URL format"};if(_.has(t))return{valid:!1,domain:t,error:`Access to ${t} is blocked for security reasons`};if(/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(t))return{valid:!1,domain:t,error:"Direct IP address access is not allowed. Use domain names."};if(k.has(t))return{valid:!0,domain:t};for(let e of k)if(t.endsWith(`.${e}`))return{valid:!0,domain:t,warning:`Subdomain of whitelisted domain: ${e}`};return{valid:!1,domain:t,error:`Domain not in network whitelist: ${t}. Allowed: npm, github, pypi, and standard dev tools.`}}(e.replace(/^(curl|wget|fetch)\s+/,"").replace(/git@/,"https://"));if(!t.valid)return t}}return{valid:!0}}(i);if(!a.valid)return r=a.error||"Network access denied",{success:!1,error:`[NETWORK SECURITY] ${r}`};if(s){let e=y(s);if(!e.valid)return h(`Working directory: ${e.error}`)}return{success:!0,data:{command:i,cwd:s,timeout:n,message:`Running: ${i}${s?` (in ${s})`:""}...`,warning:o.warning,requiresSandbox:!0},action:{type:"command_executed",payload:{command:i,cwd:s,timeout:n,sandboxOperation:"exec"}}}}async function ee(e){let t=e.command||"npm run dev",r=e.port||3e3;return{success:!0,data:{command:t,port:r,message:`Starting dev server on port ${r}...`},action:{type:"server_started",payload:{command:t,port:r,sandboxOperation:"startServer"}}}}async function et(e){return{success:!0,data:{message:"Getting preview URL..."},action:{type:"preview_ready",payload:{sandboxOperation:"getPreviewUrl"}}}}async function er(e){return{success:!0,data:{message:"Getting git status..."},action:{type:"git_status",payload:{sandboxOperation:"gitStatus"}}}}async function ei(e){let t=e.path,r=e.staged||!1;return{success:!0,data:{path:t,staged:r,message:`Getting ${r?"staged ":""}diff${t?` for ${t}`:""}...`},action:{type:"git_diff",payload:{path:t,staged:r,sandboxOperation:"gitDiff"}}}}async function es(e){let t=e.message,r=e.stageAll||!1;return t?{success:!0,data:{message:t,stageAll:r,commitMessage:t},action:{type:"git_committed",payload:{message:t,stageAll:r,sandboxOperation:"gitCommit"}}}:{success:!1,error:"Commit message is required"}}async function en(e){let t=e.branch,r=e.setUpstream??!0;return{success:!0,data:{branch:t,setUpstream:r,message:`Pushing${t?` to ${t}`:""}...`},action:{type:"git_pushed",payload:{branch:t,setUpstream:r,sandboxOperation:"gitPush"}}}}async function eo(e){let t=e.name,r=e.fromBranch;return{success:!0,data:{...t?{name:t,autoGenerated:!1}:{autoGenerated:!0,message:"Branch name will be generated from active ticket context"},fromBranch:r,message:t?`Creating branch ${t}${r?` from ${r}`:""}...`:"Creating branch from ticket context..."},action:{type:"branch_created",payload:{name:t,fromBranch:r,autoGenerate:!t,sandboxOperation:"gitBranch"}}}}async function ea(e){let t=e.title,r=e.description,i=e.projectId,s=e.ticketId,n=e.repositoryUrl;return t&&r?{success:!0,data:{title:t,description:r,projectId:i,ticketId:s,repositoryUrl:n,message:`Creating coding task: ${t}...`},action:{type:"coding_task_created",payload:{title:t,description:r,projectId:i,ticketId:s,repositoryUrl:n,agent:"claude-code",convexMutation:"workingContext:createCodingTask"}}}:{success:!1,error:"Title and description are required"}}async function ec(e){let t=e.taskId,r=e.status,i=e.filesModified,s=e.commitSha;if(!t)return{success:!1,error:"Task ID is required"};let n={};return r&&(n.status=r),i&&(n.filesModified=i),s&&(n.commitSha=s),{success:!0,data:{taskId:t,updates:n,message:`Updating coding task ${t}...`},action:{type:"coding_task_updated",payload:{taskId:t,...n,convexMutation:"workingContext:updateCodingTaskStatus"}}}}async function ed(e){let t=e.status,r=e.limit||10;return{success:!0,data:{status:t,limit:r,message:t?`Loading ${t} coding tasks...`:"Loading coding tasks..."},action:{type:"render_component",payload:{componentType:"codingTasks",status:t,limit:r,convexQuery:"workingContext:listCodingTasks"}}}}async function ep(e,t){let r=e.name,i=e.description,s=e.scheduleType,n=e.scheduleTime,o=e.daysOfWeek,c=e.actionType,d=e.prompt,p=e.emailSubject,l=e.emailBody,m=e.recipientEmail,g=e.webhookUrl,y=e.deliveryChannel,h=e.timezone||"America/Los_Angeles";if(!r)return{success:!1,error:"Job name is required"};if(!s||!["once","interval","daily","weekly","cron"].includes(s))return{success:!1,error:"Valid schedule type is required: once, interval, daily, weekly, or cron"};if(!c||!["ai_message","notification","email","webhook","memory_snapshot"].includes(c))return{success:!1,error:"Valid action type is required: ai_message, notification, email, webhook, or memory_snapshot"};let f=process.env.NEXT_PUBLIC_CONVEX_URL;if(!f)return{success:!1,error:"Convex URL not configured"};try{let e=u(t),b=new a.ConvexHttpClient(f),v={...function e(t,r,i){switch(t){case"once":{if(!r)return{runAt:Date.now()+36e5};let e=Date.parse(r);if(!isNaN(e))return{runAt:e};let t=r.match(/in\s+(\d+)\s+(minute|hour|day)s?/i);if(t){let e=parseInt(t[1]),r=t[2].toLowerCase();return{runAt:Date.now()+e*({minute:6e4,hour:36e5,day:864e5})[r]}}let i=r.match(/tomorrow\s+at\s+(\d{1,2})(?::(\d{2}))?\s*(am|pm)?/i);if(i){let e=parseInt(i[1]),t=i[2]?parseInt(i[2]):0,r=i[3]?.toLowerCase();"pm"===r&&e<12&&(e+=12),"am"===r&&12===e&&(e=0);let s=new Date;return s.setDate(s.getDate()+1),s.setHours(e,t,0,0),{runAt:s.getTime()}}return{runAt:Date.now()+36e5}}case"interval":{if(!r)return{intervalMinutes:60};let e=r.match(/(\d+)\s*(minute|hour)?s?/i);if(e){let t=parseInt(e[1]);return{intervalMinutes:"hour"===(e[2]?.toLowerCase()||"minute")?60*t:t}}return{intervalMinutes:60}}case"daily":{if(!r)return{hour:9,minute:0};let e=r.match(/(\d{1,2})(?::(\d{2}))?\s*(am|pm)?/i);if(e){let t=parseInt(e[1]),r=e[2]?parseInt(e[2]):0,i=e[3]?.toLowerCase();return"pm"===i&&t<12&&(t+=12),"am"===i&&12===t&&(t=0),{hour:t,minute:r}}return{hour:9,minute:0}}case"weekly":{let t=e("daily",r);return{hour:t.hour,minute:t.minute,daysOfWeek:i||[1]}}case"cron":return{cronExpression:r||"0 9 * * *"};default:return{hour:9,minute:0}}}(s,n,o),timezone:h},w={};d&&(w.prompt=d),p&&(w.subject=p),l&&(w.body=l),m&&(w.recipientEmail=m),g&&(w.webhookUrl=g);let k=await b.mutation(a.api.userCronJobs.createJob,{userId:e,name:r,description:i,scheduleType:s,scheduleConfig:v,actionType:c,actionPayload:w,deliverTo:y?{channel:y}:void 0});return{success:!0,data:{jobId:k.jobId,name:r,scheduleType:s,actionType:c,message:`Created scheduled job "${r}" (${k.jobId})`},action:{type:"cron_job_created",payload:{jobId:k.jobId,name:r,scheduleType:s,actionType:c}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to create cron job"}}}async function el(e,t){let r=e.includeInactive,i=process.env.NEXT_PUBLIC_CONVEX_URL;if(!i)return{success:!1,error:"Convex URL not configured"};try{let e=u(t),s=new a.ConvexHttpClient(i),n=await s.query(a.api.userCronJobs.getUserJobs,{userId:e,includeInactive:r??!1}),o=n.map(e=>({jobId:e.jobId,name:e.name,description:e.description,scheduleType:e.scheduleType,actionType:e.actionType,isActive:e.isActive,nextRunAt:e.nextRunAt?new Date(e.nextRunAt).toISOString():null,lastRunAt:e.lastRunAt?new Date(e.lastRunAt).toISOString():null,lastRunStatus:e.lastRunStatus,runCount:e.runCount,successCount:e.successCount,errorCount:e.errorCount}));return{success:!0,data:{jobs:o,count:n.length,message:n.length>0?`Found ${n.length} scheduled job${1===n.length?"":"s"}`:"No scheduled jobs found"},action:{type:"cron_jobs_listed",payload:{count:n.length,jobs:o}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to list cron jobs"}}}async function eu(e){let t=e.jobId;if(!t)return{success:!1,error:"Job ID is required"};let r=process.env.NEXT_PUBLIC_CONVEX_URL;if(!r)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(r),i=await e.mutation(a.api.userCronJobs.toggleJob,{jobId:t});return{success:!0,data:{jobId:t,isActive:i.isActive,message:`Job ${t} is now ${i.isActive?"active":"paused"}`},action:{type:"cron_job_updated",payload:{jobId:t,isActive:i.isActive}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to toggle cron job"}}}async function em(e){let t=e.jobId;if(!t)return{success:!1,error:"Job ID is required"};let r=process.env.NEXT_PUBLIC_CONVEX_URL;if(!r)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(r);return await e.mutation(a.api.userCronJobs.deleteJob,{jobId:t}),{success:!0,data:{jobId:t,message:`Deleted scheduled job ${t}`},action:{type:"cron_job_deleted",payload:{jobId:t}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to delete cron job"}}}async function eg(e,t){let r=e.sessionId,i=e.keepRecentCount||10,s=e.instructions;if(!r)return{success:!1,error:"Session ID is required"};try{let e,n=u(t),o=process.env.NEXT_PUBLIC_APP_URL||"http://localhost:3000",a=await fetch(`${o}/api/chat/compact`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:r,keepRecentCount:i,instructions:s,messages:[]})});if(!a.ok){let e=await a.json();return{success:!1,error:e.error||"Compaction request failed"}}let d=await a.json(),p=[];try{let t=(0,c.getMemoryManager)();if(d.summary&&(e=await t.storeEpisodicMemory(n,d.summary,"milestone",.6,void 0,{toolsUsed:["compact_conversation"],outcome:`Auto-extracted from conversation compaction (${d.originalMessageCount} messages, topics: ${d.topics?.join(", ")||"none"})`})),d.decisions&&Array.isArray(d.decisions))for(let e of d.decisions){let r="string"==typeof e?e:JSON.stringify(e),i=await t.upsertSemanticMemory(n,"preference",`decision_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,r,.8,`compaction_${d.compactionId}`);i&&p.push(i)}if(d.keyPoints&&Array.isArray(d.keyPoints))for(let e of d.keyPoints){let r="string"==typeof e?e:JSON.stringify(e),i=await t.upsertSemanticMemory(n,"fact",`keypoint_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,r,.7,`compaction_${d.compactionId}`);i&&p.push(i)}}catch(e){console.error("Memory extraction from compaction failed:",e)}return{success:!0,data:{compactionId:d.compactionId,summary:d.summary,keyPoints:d.keyPoints,decisions:d.decisions,openQuestions:d.openQuestions,topics:d.topics,originalMessageCount:d.originalMessageCount,tokensSaved:d.tokensSaved,message:`Compacted ${d.originalMessageCount} messages, saved ~${d.tokensSaved} tokens`,memoryExtracted:!0,episodicMemoryId:e,semanticMemoryCount:p.length},action:{type:"conversation_compacted",payload:{compactionId:d.compactionId,summary:d.summary,keyPoints:d.keyPoints,tokensSaved:d.tokensSaved,episodicMemoryId:e,semanticMemoryIds:p}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to compact conversation"}}}async function ey(e){let t=e.sessionId;if(!t)return{success:!1,error:"Session ID is required"};let r=process.env.NEXT_PUBLIC_CONVEX_URL;if(!r)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(r),i=await e.query(a.api.compaction.getLatestCompaction,{sessionId:t});if(!i)return{success:!0,data:{found:!1,message:"No compaction found for this session"}};return{success:!0,data:{found:!0,compactionId:i.compactionId,summary:i.summary,keyPoints:i.keyPoints,decisions:i.decisions,openQuestions:i.openQuestions,topics:i.topics,originalMessageCount:i.originalMessageCount,createdAt:new Date(i.createdAt).toISOString(),message:`Found compaction from ${new Date(i.createdAt).toLocaleDateString()}`},action:{type:"compaction_retrieved",payload:{compactionId:i.compactionId,summary:i.summary,keyPoints:i.keyPoints}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get compaction summary"}}}async function eh(e,t){let r=e.includeDisabled||!1,i=process.env.NEXT_PUBLIC_CONVEX_URL;if(!i)return{success:!1,error:"Convex URL not configured"};try{let e=u(t),s=new a.ConvexHttpClient(i),n=await s.query(a.api.channels.getUserIntegrations,{userId:e}),o=r?n:n.filter(e=>e.settings?.enabled);return{success:!0,data:{integrations:o.map(e=>({id:e._id,platform:e.platform,enabled:e.settings?.enabled??!1,status:e.connectionStatus,identifier:e.platformUserId})),count:o.length,message:`Found ${o.length} channel integration${1!==o.length?"s":""}`}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to list channel integrations"}}}async function ef(e,t){let r=e.platform,i=e.limit||20,s=process.env.NEXT_PUBLIC_CONVEX_URL;if(!s)return{success:!1,error:"Convex URL not configured"};try{let e=u(t),n=new a.ConvexHttpClient(s),o=await n.query(a.api.channels.getConversations,{userId:e}),c=o.filter(e=>!r||e.platform===r).slice(0,i);return{success:!0,data:{conversations:c.map(e=>({recipientId:e.platformUserId,recipientName:e.platformUsername||e.platformUserId,platform:e.platform,lastMessage:e.lastMessage?.content||"",lastMessageAt:e.lastMessage?new Date(e.lastMessage._creationTime).toISOString():"",unreadCount:e.unreadCount??0,integrationId:e.integrationId})),count:o.length,message:`Found ${o.length} conversation${1!==o.length?"s":""}${r?` on ${r}`:""}`}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get channel conversations"}}}async function eb(e,t){let r=e.integrationId,i=e.recipientId,s=e.content,n=e.messageType||"text";if(!r||!s)return{success:!1,error:"Integration ID and content are required"};let o=function(e){if(!e||"string"!=typeof e)return{valid:!1,error:"Message content is required"};if(0===e.trim().length)return{valid:!1,error:"Message cannot be empty"};if(e.length>1e4)return{valid:!1,error:"Message too long (max 10000 characters)"};for(let t of f)if(t.test(e))return{valid:!1,error:"Message contains content that appears to be phishing or social engineering. Please rephrase."};let t=[];for(let r of b)if(r.test(e)){t.push("Message contains a URL shortener or suspicious domain. Recipient may be cautious.");break}return{valid:!0,warnings:t.length>0?t:void 0}}(s);if(!o.valid){var c;return c=o.error||"Invalid message content",{success:!1,error:`[MESSAGE SECURITY] ${c}`}}let p=process.env.NEXT_PUBLIC_CONVEX_URL;if(!p)return{success:!1,error:"Convex URL not configured"};try{let e=u(t),c=new a.ConvexHttpClient(p),l=await c.query(a.api.channels.getIntegration,{integrationId:r});if(!l)return{success:!1,error:"Integration not found"};if(!l.settings.enabled)return{success:!1,error:"Integration is disabled"};let m=i||l.platformUserId,g=await (0,d.sendMessage)({integrationId:r,platform:l.platform,recipientId:m,content:s,messageType:n},l.credentials);if(!g.success)return{success:!1,error:g.error||"Failed to send message"};let{messageId:y}=await c.mutation(a.api.channels.logOutboundMessage,{integrationId:r,userId:e,platform:l.platform,platformMessageId:g.platformMessageId,content:s,messageType:n,toolsUsed:["send_channel_message"]}),h=o.warnings;return{success:!0,data:{messageId:y,platformMessageId:g.platformMessageId,sent:!0,platform:l.platform,recipientId:m,content:s.slice(0,100)+(s.length>100?"...":""),message:`Message sent successfully via ${l.platform}`,warnings:h},action:{type:"message_sent",payload:{messageId:y,integrationId:r,recipientId:m,platform:l.platform}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to send channel message"}}}async function ev(e,t){let r=e.query,i=e.platform,s=e.limit||20;if(!r)return{success:!1,error:"Search query is required"};let n=process.env.NEXT_PUBLIC_CONVEX_URL;if(!n)return{success:!1,error:"Convex URL not configured"};try{let e=u(t),o=new a.ConvexHttpClient(n),c=await o.query(a.api.channels.searchMessages,{userId:e,query:r,limit:s}),d=i?c.filter(e=>e.platform===i):c;return{success:!0,data:{messages:d.map(e=>({id:e._id,platform:e.platform,direction:e.direction,content:e.content,timestamp:new Date(e._creationTime).toISOString(),contact:e.integrationId})),count:c.length,query:r,message:`Found ${c.length} message${1!==c.length?"s":""} matching "${r}"`}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to search channel messages"}}}let ew=[{id:"feed",name:"Feed",icon:"",description:"Chronological stream of all entities"},{id:"kanban",name:"Kanban",icon:"",description:"Ticket and task management board"},{id:"graph",name:"Graph",icon:"",description:"Entity relationship visualization"},{id:"graph-3d",name:"Graph 3D",icon:"",description:"Immersive 3D relationship space"},{id:"calendar",name:"Calendar",icon:"",description:"Time-based event visualization"},{id:"grid",name:"Grid",icon:"",description:"Gallery-style entity browser"},{id:"table",name:"Table",icon:"",description:"Spreadsheet-like data view"},{id:"ipod",name:"iPod",icon:"",description:"Music-centric navigation"},{id:"quest-log",name:"Quest Log",icon:"",description:"Gamified task progression"},{id:"skill-tree",name:"Skill Tree",icon:"",description:"Interconnected skill progression"}],ek={river:{container:"frame",arrangement:"list",entityShape:"square",connectionStyle:"none",gradient:"from-blue-500 to-cyan-500"},board:{container:"panel",arrangement:"grid",entityShape:"square",connectionStyle:"none",gradient:"from-violet-500 to-purple-500"},constellation:{container:"frame",arrangement:"graph",entityShape:"circle",connectionStyle:"curve",gradient:"from-emerald-500 to-green-500"},solar:{container:"frame",arrangement:"orbit",entityShape:"circle",connectionStyle:"glow",gradient:"from-pink-500 to-rose-500"},timeline:{container:"panel",arrangement:"list",entityShape:"square",connectionStyle:"line",gradient:"from-amber-500 to-orange-500"},mosaic:{container:"frame",arrangement:"grid",entityShape:"square",connectionStyle:"none",gradient:"from-cyan-500 to-teal-500"},ledger:{container:"panel",arrangement:"list",entityShape:"square",connectionStyle:"none",gradient:"from-slate-500 to-zinc-500"},vinyl:{container:"card",arrangement:"flow",entityShape:"square",connectionStyle:"none",gradient:"from-indigo-500 to-blue-500"},dungeon:{container:"panel",arrangement:"tree",entityShape:"hexagon",connectionStyle:"arrow",gradient:"from-red-500 to-orange-500"},tree:{container:"frame",arrangement:"tree",entityShape:"circle",connectionStyle:"curve",gradient:"from-emerald-500 to-teal-500"}};async function e_(e){let t=e.name,r=e.metaphor,i=e.arrangement,s=e.entityTypes,n=e.description;if(!t||!r||!i)return{success:!1,error:"Name, metaphor, and arrangement are required"};let o=process.env.NEXT_PUBLIC_CONVEX_URL;if(!o)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(o),c=ek[r]||ek.mosaic,d={container:c.container,arrangement:i,entityShape:c.entityShape,connectionStyle:c.connectionStyle,decorations:[{type:"shadow"}],interactions:[{type:"click",action:"navigate"},{type:"longpress",action:"reveal"}],transition:"morph",filter:s?.length?{entityTypes:s}:void 0},p=await e.mutation(a.api.erv.createDimension,{name:t,description:n||`Custom ${r} dimension`,metaphor:r,config:JSON.stringify(d),icon:ek[r]?"":"",gradient:c.gradient,allowedEntityTypes:s});return{success:!0,data:{dimensionId:p.dimensionId,name:t,metaphor:r,arrangement:i,entityTypes:s||"all",message:`Created dimension "${t}" with ${r} metaphor`},action:{type:"dimension_created",payload:{dimensionId:p.dimensionId,name:t,metaphor:r,navigateTo:`/d/${p.dimensionId}`}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to create dimension"}}}async function eI(e){let t=!1!==e.includePresets,r=process.env.NEXT_PUBLIC_CONVEX_URL;if(!r)return{success:!0,data:{presets:ew,custom:[],message:`${ew.length} preset dimensions available`},action:{type:"dimensions_listed",payload:{presets:ew,custom:[]}}};try{let e=new a.ConvexHttpClient(r),i=(await e.query(a.api.erv.listDimensions,{includePresets:t})).filter(e=>!e.isPreset).map(e=>({id:e.dimensionId,name:e.name,icon:e.icon||"",description:e.description,metaphor:e.metaphor}));return{success:!0,data:{presets:t?ew:[],custom:i,totalCount:(t?ew.length:0)+i.length,message:`Found ${i.length} custom dimension${1!==i.length?"s":""} and ${ew.length} presets`},action:{type:"dimensions_listed",payload:{presets:t?ew:[],custom:i}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to list dimensions"}}}async function eC(e){let t=e.query,r=e.entityTypes,i=e.limit||20;if(!t)return{success:!1,error:"Search query is required"};let s=process.env.NEXT_PUBLIC_CONVEX_URL;if(!s)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(s),n=(await e.query(a.api.erv.searchEntities,{query:t,entityTypes:r,limit:i})).map(e=>{let t={};try{t=JSON.parse(e.data)}catch{}return{entityId:e.entityId,type:e.entityType,name:e.name,tags:e.tags,importance:e.importance,..."Ticket"===e.entityType&&{ticketId:t.ticketId,status:t.status,priority:t.priority},..."Project"===e.entityType&&{status:t.status},..."Track"===e.entityType&&{artist:t.artist,album:t.album}}});return{success:!0,data:{results:n,count:n.length,query:t,entityTypes:r||"all",message:`Found ${n.length} entit${1!==n.length?"ies":"y"} matching "${t}"`},action:{type:"entities_searched",payload:{query:t,count:n.length,results:n.slice(0,5)}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to search entities"}}}let eT=new Map,ex={"instagram-story":{width:1080,height:1920,fps:30},"instagram-post":{width:1080,height:1080,fps:30},"instagram-reel":{width:1080,height:1920,fps:30},tiktok:{width:1080,height:1920,fps:30},youtube:{width:1920,height:1080,fps:30},"youtube-short":{width:1080,height:1920,fps:30},twitter:{width:1280,height:720,fps:30},"1080p":{width:1920,height:1080,fps:30},"720p":{width:1280,height:720,fps:30},"4k":{width:3840,height:2160,fps:30},square:{width:1080,height:1080,fps:30},portrait:{width:1080,height:1350,fps:30}};async function ej(e){let t=e.compositionId,r=e.format||"mp4",i=e.quality||"standard",s=e.mode||"sandbox";if(!t)return{success:!1,error:"Composition ID is required"};let n=eT.get(t);if(!n)return{success:!1,error:`Composition not found: ${t}`};let o=n.durationInFrames/n.fps;if("sandbox"===s)return o>60?{success:!1,error:`Composition is ${Math.round(o)}s long. Sandbox mode supports up to 60s. Use mode="server" for longer videos.`}:{success:!0,data:{renderMode:"sandbox",compositionId:t,compositionName:n.name,format:r,quality:i,durationSeconds:o,composition:{...n,layers:n.layers.map(e=>({id:e.id,type:e.type}))},instructions:["1. Capture frames from the composition using Remotion player","2. Pass frames to renderInSandbox() from sandbox-renderer","3. ffmpeg.wasm will encode the video locally","4. Download the result - no cloud costs!"],message:`Ready to render "${n.name}" locally (${r}, ${i}). Sandbox mode uses ffmpeg.wasm - completely free, no cloud needed.`,note:'Rendering happens in your browser/sandbox. For videos over 60s, use mode="server".'},action:{type:"video_render_started",payload:{renderMode:"sandbox",compositionId:t,compositionName:n.name,format:r,quality:i,status:"ready_to_render",localRender:!0}}};try{let e=await fetch("/api/video/render",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({compositionId:t,compositionName:n.name,compositionData:{width:n.width,height:n.height,fps:n.fps,durationInFrames:n.durationInFrames,props:{compositionType:"lyric-video"===n.type?"lyric":"text-overlay"===n.type?"text-overlay":"base",compositionProps:n}},format:r,quality:i})}),s=await e.json();if(!s.success)return{success:!1,error:s.error||"Failed to start render"};let a=2*Math.ceil(o);return{success:!0,data:{renderMode:"server",jobId:s.job.id,compositionId:t,status:s.job.status,format:r,quality:i,estimatedDuration:a,message:`Server render started for "${n.name}" (${r}, ${i}). Job ID: ${s.job.id}. Use get_render_status to check progress.`},action:{type:"video_render_started",payload:{renderMode:"server",jobId:s.job.id,compositionId:t,compositionName:n.name,format:r,quality:i,status:s.job.status}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to start render"}}}async function eS(e){let t=e.audioSrc,r=e.lyrics,i=e.language;if(!t)return{success:!1,error:"Audio source is required"};if(!r)return{success:!1,error:"Lyrics text is required"};try{let e,s=r.split("\n").map(e=>e.trim()).filter(e=>e.length>0);if(0===s.length)return{success:!1,error:"No valid lyric lines found"};let n=new FormData;if(!t.startsWith("http"))return{success:!1,error:"Audio must be provided as a URL. Upload the audio file first."};{let r=await fetch(t);e=await r.blob()}n.append("file",e,"audio.mp3"),n.append("model","whisper-1"),n.append("response_format","verbose_json"),n.append("timestamp_granularities[]","word"),i&&n.append("language",i);let o=await fetch("/api/whisper",{method:"POST",body:n});if(!o.ok){let e=4*s.length,t=s.map((t,r)=>({text:t,startTime:r*(e/s.length),endTime:(r+1)*(e/s.length)}));return{success:!0,data:{lyrics:t,lyricCount:t.length,method:"estimated",message:`Estimated timing for ${t.length} lines (Whisper unavailable). Consider providing manual timestamps for better sync.`},action:{type:"lyrics_synced",payload:{lyricCount:t.length,method:"estimated",previewLyrics:t.slice(0,3)}}}}let a=(await o.json()).words||[],c=function(e,t){if(0===t.length){let t=4*e.length;return e.map((r,i)=>({text:r,startTime:i*(t/e.length),endTime:(i+1)*(t/e.length)}))}let r=[],i=0;for(let s of e){let e=s.toLowerCase().split(/\s+/).filter(Boolean),n=t[i];if(!n){let e=r.length>0?r[r.length-1].endTime:0;r.push({text:s,startTime:e,endTime:e+3});continue}let o=n.start,a=0,c=n.end;for(;i<t.length&&a<e.length;)c=t[i].end,i++,a++;r.push({text:s,startTime:o,endTime:c})}return r}(s,a);return{success:!0,data:{lyrics:c,lyricCount:c.length,method:"whisper",totalDuration:c.length>0?c[c.length-1].endTime:0,message:`Synced ${c.length} lyric lines using Whisper AI. Ready for add_lyrics_to_video.`},action:{type:"lyrics_synced",payload:{lyricCount:c.length,method:"whisper",previewLyrics:c.slice(0,3)}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to sync lyrics"}}}async function eU(e){let t=e.jobId;if(!t)return{success:!1,error:"Job ID is required"};try{let e=await fetch(`/api/video/render?jobId=${encodeURIComponent(t)}`),r=await e.json();if(!r.success)return{success:!1,error:r.error||"Failed to get render status"};let i=r.job;return{success:!0,data:{jobId:i.id,status:i.status,progress:i.progress,outputUrl:i.outputUrl,error:i.error,durationMs:i.durationMs,message:"completed"===i.status?`Render complete! Download: ${i.outputUrl}`:"failed"===i.status?`Render failed: ${i.error}`:`Rendering: ${i.progress}% complete`},action:{type:"completed"===i.status?"video_render_complete":"video_render_status",payload:{jobId:i.id,status:i.status,progress:i.progress,outputUrl:i.outputUrl}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get render status"}}}async function eq(e){let t=e.topic,r=e.sourcePhotoUrl,i=e.sceneStyle||"podcast_studio",s=e.customScenePrompt,n=e.duration||90,o=e.tone||"professional";if(!t)return{success:!1,error:"Topic is required"};if(!r)return{success:!1,error:"Source photo URL is required"};try{let e=await fetch("/api/talking-video",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"run_workflow",topic:t,sourcePhotoUrl:r,sceneStyle:i,customScenePrompt:s,duration:n,tone:o})}),a=await e.json();if(a.error)return{success:!1,error:a.error,action:{type:"talking_video_error",payload:{error:a.error}}};return{success:!0,data:{projectId:a.projectId,status:a.status,script:a.script,audioUrl:a.audioUrl,backgroundVideoUrl:a.backgroundVideoUrl,finalVideoUrl:a.finalVideoUrl,message:a.finalVideoUrl?`Talking video created successfully! Watch it here: ${a.finalVideoUrl}`:"Video creation started..."},action:{type:"talking_video_complete",payload:{projectId:a.projectId,finalVideoUrl:a.finalVideoUrl,script:a.script}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to create talking video"}}}async function eD(e){let t=e.topic,r=e.duration||90,i=e.tone||"professional",s=e.style||"monologue";if(!t)return{success:!1,error:"Topic is required"};try{let e=await fetch("/api/talking-video",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"generate_script",topic:t,duration:r,tone:i,style:s})}),n=await e.json();if(n.error)return{success:!1,error:n.error};return{success:!0,data:{script:n.script,estimatedDuration:n.estimatedDuration,wordCount:n.wordCount,message:`Generated a ${n.estimatedDuration}-second script (${n.wordCount} words)`},action:{type:"talking_video_script_generated",payload:{script:n.script,estimatedDuration:n.estimatedDuration,wordCount:n.wordCount}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to generate script"}}}async function eA(e){let t=e.text,r=e.voiceId,i=e.stability,s=e.similarityBoost;return t?{success:!0,data:{text:t,voiceId:r,stability:i,similarityBoost:s,message:"Voice generation queued. The audio will be generated using your cloned voice."},action:{type:"talking_video_voice_generated",payload:{text:t,voiceId:r,stability:i,similarityBoost:s,apiCall:"elevenlabs/text-to-speech"}}}:{success:!1,error:"Text is required"}}async function e$(e){let t=e.prompt,r=e.negative_prompt,i=e.preset,s=e.duration_seconds,n=e.seed;if(!t)return{success:!1,error:"Prompt is required for video generation"};if(!(0,p.isLTXConfigured)())return{success:!1,error:"Video generation is not configured. FAL_KEY environment variable is missing."};try{let e;if(i&&p.LTX_PRESETS[i])e=await (0,p.generateVideoWithPreset)(t,i,{negative_prompt:r,seed:n});else{let i=s?(0,p.getFrameCountForDuration)(s):97;e=await (0,p.generateVideoFromText)({prompt:t,negative_prompt:r,num_frames:i,seed:n})}return{success:!0,data:{videoUrl:e.video.url,fileName:e.video.file_name,fileSize:e.video.file_size,seed:e.seed,message:`Video generated successfully! Here's your video: ${e.video.url}`},action:{type:"video_generated",payload:{videoUrl:e.video.url,fileName:e.video.file_name,prompt:t}}}}catch(e){return{success:!1,error:`Failed to generate video: ${e instanceof Error?e.message:"Unknown error"}`}}}async function eR(e){let t=e.image_url,r=e.prompt,i=e.negative_prompt,s=e.duration_seconds,n=e.seed;if(!t)return{success:!1,error:"Image URL is required for animation"};if(!r)return{success:!1,error:"Prompt describing the motion is required"};if(!(0,p.isLTXConfigured)())return{success:!1,error:"Video generation is not configured. FAL_KEY environment variable is missing."};try{let e=s?(0,p.getFrameCountForDuration)(s):97,o=await (0,p.generateVideoFromImage)({image_url:t,prompt:r,negative_prompt:i,num_frames:e,seed:n});return{success:!0,data:{videoUrl:o.video.url,fileName:o.video.file_name,fileSize:o.video.file_size,seed:o.seed,message:`Image animated successfully! Here's your video: ${o.video.url}`},action:{type:"image_animated",payload:{videoUrl:o.video.url,fileName:o.video.file_name,originalImage:t,prompt:r}}}}catch(e){return{success:!1,error:`Failed to animate image: ${e instanceof Error?e.message:"Unknown error"}`}}}async function eE(e){let t=e.taskId;if(!t)return{success:!1,error:"Task ID is required"};let r=process.env.NEXT_PUBLIC_CONVEX_URL;if(!r)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(r),i=await e.query(a.api.kanban.getTaskById,{taskId:t});if(!i)return{success:!1,error:`Task not found: ${t}`};return{success:!0,data:{task:{id:i.id,title:i.title,description:i.description,priority:i.priority,status:i.status,tags:i.tags,createdAt:i.createdAt,updatedAt:i.updatedAt},message:`Found task "${i.title}" (${i.status})`}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get task"}}}async function eL(e){let t=e.query,r=e.status;if(!t)return{success:!1,error:"Search query is required"};let i=process.env.NEXT_PUBLIC_CONVEX_URL;if(!i)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(i),s=await e.query(a.api.kanban.searchTasks,{query:t,status:r});return{success:!0,data:{tasks:s.map(e=>({id:e.id,title:e.title,status:e.status,priority:e.priority,tags:e.tags})),count:s.length,message:`Found ${s.length} task${1!==s.length?"s":""} matching "${t}"`}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to search tasks"}}}async function eP(e,t){let r=e.name,i=e.canvasType||"freeform",s=e.description,n=e.backgroundColor||"#1a1a2e",o=!1!==e.gridEnabled;if(!r)return{success:!1,error:"Canvas name is required"};let c=process.env.NEXT_PUBLIC_CONVEX_URL;if(!c)return{success:!1,error:"Convex URL not configured"};try{let e=u(t),d=new a.ConvexHttpClient(c),p=await d.mutation(a.api.designCanvas.createCanvas,{name:r,description:s,ownerId:e,canvasType:i,backgroundColor:n,gridEnabled:o,gridSize:20});return{success:!0,data:{canvasId:p,name:r,canvasType:i,backgroundColor:n,message:`Created canvas "${r}" (${i})`},action:{type:"canvas_created",payload:{canvasId:p,name:r,canvasType:i,url:`/canvas/${p}`}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to create canvas"}}}async function eM(e,t){let r=e.status,i=e.limit||20,s=process.env.NEXT_PUBLIC_CONVEX_URL;if(!s)return{success:!1,error:"Convex URL not configured"};try{let e=u(t),n=new a.ConvexHttpClient(s),o=await n.query(a.api.designCanvas.getUserCanvases,{ownerId:e,status:r}),c=o.slice(0,i);return{success:!0,data:{canvases:c.map(e=>({id:e._id,name:e.name,type:e.canvasType,status:e.status,createdAt:new Date(e.createdAt).toISOString(),updatedAt:new Date(e.updatedAt).toISOString()})),count:c.length,totalCount:o.length,message:`Found ${o.length} canvas${1!==o.length?"es":""}`},action:{type:"canvases_listed",payload:{count:c.length}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to list canvases"}}}async function eO(e){let t=e.canvasId;if(!t)return{success:!1,error:"Canvas ID is required"};let r=process.env.NEXT_PUBLIC_CONVEX_URL;if(!r)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(r),i=await e.query(a.api.designCanvas.getCanvas,{canvasId:t});if(!i)return{success:!1,error:`Canvas not found: ${t}`};let s=await e.query(a.api.designCanvas.getCanvasNodes,{canvasId:t}),n=await e.query(a.api.designCanvas.getCanvasEdges,{canvasId:t});return{success:!0,data:{canvas:{id:i._id,name:i.name,type:i.canvasType,status:i.status,backgroundColor:i.backgroundColor},nodes:s.map(e=>({nodeId:e.nodeId,type:e.nodeType,x:e.x,y:e.y,width:e.width,height:e.height,content:e.content})),edges:n.map(e=>({edgeId:e.edgeId,type:e.edgeType,source:e.sourceNodeId,target:e.targetNodeId,label:e.label})),nodeCount:s.length,edgeCount:n.length,message:`Canvas "${i.name}" has ${s.length} nodes and ${n.length} edges`},action:{type:"canvas_retrieved",payload:{canvasId:i._id,name:i.name,nodeCount:s.length,edgeCount:n.length}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get canvas"}}}async function eN(e,t){let r=e.canvasId,i=e.nodeType,s=e.x||0,n=e.y||0,o=e.content,c=e.width||function(e){switch(e){case"text":case"sticky":return 200;case"shape":return 100;case"image":return 300;case"code":case"frame":return 400;default:return 150}}(i),d=e.height||function(e){switch(e){case"text":return 50;case"sticky":case"image":return 200;case"shape":default:return 100;case"code":case"frame":return 300}}(i),p=e.style;if(!r||!i||void 0===o)return{success:!1,error:"Canvas ID, node type, and content are required"};let l=process.env.NEXT_PUBLIC_CONVEX_URL;if(!l)return{success:!1,error:"Convex URL not configured"};try{let e=u(t),m=new a.ConvexHttpClient(l),g=`node_${Date.now()}_${Math.random().toString(36).slice(2,8)}`;return await m.mutation(a.api.designCanvas.addNode,{canvasId:r,nodeId:g,nodeType:i,x:s,y:n,width:c,height:d,content:o,style:p,createdBy:e}),{success:!0,data:{nodeId:g,nodeType:i,x:s,y:n,width:c,height:d,content:o.length>50?o.slice(0,50)+"...":o,message:`Added ${i} node at (${s}, ${n})`},action:{type:"canvas_node_added",payload:{canvasId:r,nodeId:g,nodeType:i,x:s,y:n}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to add canvas node"}}}async function eF(e){let t=e.canvasId,r=e.sourceNodeId,i=e.targetNodeId,s=e.edgeType||"arrow",n=e.label,o=e.style;if(!t||!r||!i)return{success:!1,error:"Canvas ID, source node ID, and target node ID are required"};let c=process.env.NEXT_PUBLIC_CONVEX_URL;if(!c)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(c),d=`edge_${Date.now()}_${Math.random().toString(36).slice(2,8)}`;return await e.mutation(a.api.designCanvas.addEdge,{canvasId:t,edgeId:d,sourceNodeId:r,targetNodeId:i,edgeType:s,label:n,style:o}),{success:!0,data:{edgeId:d,edgeType:s,source:r,target:i,label:n,message:`Connected ${r}  ${i}${n?` (${n})`:""}`},action:{type:"canvas_edge_added",payload:{canvasId:t,edgeId:d,source:r,target:i}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to add canvas edge"}}}async function ez(e){let t=e.canvasId,r=e.nodeId,i=e.x,s=e.y,n=e.width,o=e.height,c=e.content,d=e.style;if(!t||!r)return{success:!1,error:"Canvas ID and node ID are required"};let p=process.env.NEXT_PUBLIC_CONVEX_URL;if(!p)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(p);await e.mutation(a.api.designCanvas.updateNode,{canvasId:t,nodeId:r,x:i,y:s,width:n,height:o,content:c,style:d});let l=[];return(void 0!==i||void 0!==s)&&l.push(`position (${i??"?"}, ${s??"?"})`),(void 0!==n||void 0!==o)&&l.push(`size (${n??"?"}x${o??"?"})`),void 0!==c&&l.push("content"),void 0!==d&&l.push("style"),{success:!0,data:{nodeId:r,updated:l,message:`Updated node ${r}: ${l.join(", ")}`},action:{type:"canvas_node_updated",payload:{canvasId:t,nodeId:r,updates:l}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to update canvas node"}}}let eB=a.api.health||{};async function eH(e,t){if(!u(t))return{success:!1,error:"Authentication required to access health data"};let r=e.date||new Date().toISOString().split("T")[0],i=process.env.NEXT_PUBLIC_CONVEX_URL;if(!i)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(i),t=await e.query(eB.getDailySummary,{date:r});if(!t)return{success:!0,data:{date:r,message:`No health data found for ${r}. Make sure you've synced your Apple Health data using the iOS Shortcut.`,hasData:!1}};let s={date:r,hasData:!0,activity:{steps:t.steps,distance:t.distance?`${(t.distance/1e3).toFixed(2)} km`:void 0,activeEnergy:t.activeEnergy?`${Math.round(t.activeEnergy)} kcal`:void 0,exerciseMinutes:t.exerciseMinutes,standHours:t.standHours,flightsClimbed:t.flightsClimbed},heart:{averageHeartRate:t.avgHeartRate?`${Math.round(t.avgHeartRate)} bpm`:void 0,restingHeartRate:t.restingHeartRate?`${Math.round(t.restingHeartRate)} bpm`:void 0,heartRateVariability:t.heartRateVariability?`${Math.round(t.heartRateVariability)} ms`:void 0,minHeartRate:t.minHeartRate?`${Math.round(t.minHeartRate)} bpm`:void 0,maxHeartRate:t.maxHeartRate?`${Math.round(t.maxHeartRate)} bpm`:void 0},sleep:{sleepHours:t.sleepHours?`${t.sleepHours.toFixed(1)} hours`:void 0,timeInBed:t.timeInBed?`${t.timeInBed.toFixed(1)} hours`:void 0},body:{weight:t.weight?`${t.weight.toFixed(1)} kg`:void 0,bodyFat:t.bodyFat?`${t.bodyFat.toFixed(1)}%`:void 0},vitals:{bloodOxygen:t.bloodOxygen?`${t.bloodOxygen.toFixed(1)}%`:void 0,respiratoryRate:t.respiratoryRate?`${t.respiratoryRate.toFixed(1)} breaths/min`:void 0},mindfulness:{mindfulMinutes:t.mindfulMinutes},workouts:{count:t.workoutCount,totalMinutes:t.workoutMinutes?Math.round(t.workoutMinutes):void 0,totalCalories:t.workoutCalories?Math.round(t.workoutCalories):void 0},scores:{activity:t.activityScore,sleep:t.sleepScore,readiness:t.readinessScore}};return{success:!0,data:s}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get health summary"}}}async function eX(e,t){if(!u(t))return{success:!1,error:"Authentication required to access health data"};let r=e.weeks||4,i=process.env.NEXT_PUBLIC_CONVEX_URL;if(!i)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(i),t=await e.query(eB.getHealthTrends,{weeks:r});if(!t||0===t.length)return{success:!0,data:{weeks:r,message:"No health trend data available. Sync more data from Apple Health to see trends.",hasData:!1}};return{success:!0,data:{weeks:r,hasData:!0,weeklyTrends:t.map(e=>({week:e.week,avgSteps:e.avgSteps?Math.round(e.avgSteps):null,avgSleepHours:e.avgSleep?e.avgSleep.toFixed(1):null,avgHeartRate:e.avgHeartRate?Math.round(e.avgHeartRate):null,avgActivityScore:e.avgActivityScore?Math.round(e.avgActivityScore):null}))}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get health trends"}}}async function eV(e,t){if(!u(t))return{success:!1,error:"Authentication required to access health data"};let r=e.metric;if(!r)return{success:!1,error:"Metric type is required"};let i=e.endDate||new Date().toISOString().split("T")[0],s=e.startDate||new Date(Date.now()-6048e5).toISOString().split("T")[0],n=new Date(`${s}T00:00:00Z`).getTime(),o=new Date(`${i}T23:59:59.999Z`).getTime(),c=process.env.NEXT_PUBLIC_CONVEX_URL;if(!c)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(c),t=await e.query(eB.getSamples,{sampleType:r,startDate:n,endDate:o,limit:100});if(!t||0===t.length)return{success:!0,data:{metric:r,startDate:s,endDate:i,message:`No ${r} data found for the specified date range.`,hasData:!1}};let d={};for(let e of t){let t=new Date(e.startDate).toISOString().split("T")[0];d[t]||(d[t]=[]),d[t].push(e.value)}let p=Object.entries(d).map(([e,t])=>({date:e,value:"steps"===r||"activeEnergy"===r||"distance"===r?t.reduce((e,t)=>e+t,0):t.reduce((e,t)=>e+t,0)/t.length,sampleCount:t.length})).sort((e,t)=>e.date.localeCompare(t.date));return{success:!0,data:{metric:r,startDate:s,endDate:i,hasData:!0,totalSamples:t.length,dailyData:p,unit:t[0]?.unit||"unknown"}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get health metric data"}}}async function eG(e,t){if(!u(t))return{success:!1,error:"Authentication required to access health data"};let r=e.period1Start,i=e.period1End,s=e.period2Start,n=e.period2End,o=e.metrics||["steps","sleepHours","avgHeartRate","activityScore"];if(!r||!i||!s||!n)return{success:!1,error:"All period start and end dates are required"};let c=process.env.NEXT_PUBLIC_CONVEX_URL;if(!c)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(c),t=await e.query(eB.getDailySummaries,{startDate:r,endDate:i}),d=await e.query(eB.getDailySummaries,{startDate:s,endDate:n}),p=(e,t)=>{let r=e.map(e=>e[t]).filter(e=>null!=e);return r.length>0?r.reduce((e,t)=>e+t,0)/r.length:null},l={};for(let e of o){let r=p(t,e),i=p(d,e),s=null;if(null!=r&&null!=i&&0!==r){let e=(i-r)/r*100;s=`${e>=0?"+":""}${e.toFixed(1)}%`}l[e]={period1:null!=r?Math.round(10*r)/10:null,period2:null!=i?Math.round(10*i)/10:null,change:s}}return{success:!0,data:{period1:{start:r,end:i,daysWithData:t.length},period2:{start:s,end:n,daysWithData:d.length},comparison:l}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to compare health periods"}}}async function eW(e,t){if(!u(t))return{success:!1,error:"Authentication required to generate API key"};let r=e.name;if(!r)return{success:!1,error:"API key name is required"};let i=e.expiresInDays,s=process.env.NEXT_PUBLIC_CONVEX_URL;if(!s)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(s),t=await e.mutation(eB.generateApiKey,{name:r,expiresInDays:i});return{success:!0,data:{apiKey:t.apiKey,name:t.name,expiresAt:t.expiresAt?new Date(t.expiresAt).toISOString():"Never",message:t.message,webhookUrl:"https://openclaw.io/api/webhooks/health",instructions:["1. Copy the API key above (it will not be shown again)","2. Create a new iOS Shortcut",'3. Add "Find Health Samples" actions for the data you want to sync','4. Add "Get Contents of URL" action with:',"   - URL: https://openclaw.io/api/webhooks/health","   - Method: POST","   - Headers: Authorization: Bearer YOUR_API_KEY","   - Body: JSON with your health data","5. Set up automation to run the shortcut daily"]}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to generate API key"}}}async function eJ(e){if(!u(e))return{success:!1,error:"Authentication required to list API keys"};let t=process.env.NEXT_PUBLIC_CONVEX_URL;if(!t)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(t),r=await e.query(eB.listApiKeys,{});if(!r||0===r.length)return{success:!0,data:{message:"No API keys found. Generate one to start syncing health data.",keys:[]}};return{success:!0,data:{keys:r.map(e=>({id:e.id,name:e.name,isActive:e.isActive,isExpired:e.isExpired,lastUsedAt:e.lastUsedAt?new Date(e.lastUsedAt).toISOString():"Never",usageCount:e.usageCount,createdAt:new Date(e.createdAt).toISOString(),expiresAt:e.expiresAt?new Date(e.expiresAt).toISOString():"Never"}))}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to list API keys"}}}async function eY(e,t){if(!u(t))return{success:!1,error:"Authentication required to revoke API key"};let r=e.keyId;if(!r)return{success:!1,error:"API key ID is required"};let i=process.env.NEXT_PUBLIC_CONVEX_URL;if(!i)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(i);return await e.mutation(eB.revokeApiKey,{keyId:r}),{success:!0,data:{message:"API key has been revoked. It can no longer be used for syncing.",keyId:r}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to revoke API key"}}}async function eK(e,t){if(!u(t))return{success:!1,error:"Authentication required to check sync status"};let r=e.limit||5,i=process.env.NEXT_PUBLIC_CONVEX_URL;if(!i)return{success:!1,error:"Convex URL not configured"};try{var s;let e,t,n,o,c=new a.ConvexHttpClient(i),d=await c.query(eB.getSyncLogs,{limit:r});if(!d||0===d.length)return{success:!0,data:{message:"No sync history found. Health data has not been synced yet.",syncs:[]}};return{success:!0,data:{recentSyncs:d.map(e=>({syncId:e.syncId,status:e.status,samplesReceived:e.samplesReceived,samplesStored:e.samplesStored,sampleTypes:e.sampleTypes,errors:e.errors,syncedAt:new Date(e.syncedAt).toISOString()})),lastSync:d[0]?{status:d[0].status,samplesStored:d[0].samplesStored,syncedAt:new Date(d[0].syncedAt).toISOString(),timeSince:(s=d[0].syncedAt,e=Date.now()-s,t=Math.floor(e/6e4),n=Math.floor(e/36e5),(o=Math.floor(e/864e5))>0?`${o} day${o>1?"s":""} ago`:n>0?`${n} hour${n>1?"s":""} ago`:t>0?`${t} minute${t>1?"s":""} ago`:"Just now")}:null}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get sync status"}}}let eQ={Person:{keywords:["person","contact","colleague","friend","team","member","employee","met","introduced"],requiredFields:[],optionalFields:["email","company","title","phone","linkedin","twitter","location","notes","relationship"],defaultTags:["contact"]},Project:{keywords:["project","app","website","repo","build","create","develop","startup","product","initiative"],requiredFields:["status","color"],optionalFields:["githubRepo","description","stack","url","startDate","endDate"],defaultTags:["project"]},Track:{keywords:["song","track","music","audio","beat","album","artist","spotify","soundcloud"],requiredFields:["artist","audioUrl","isPrivate"],optionalFields:["album","duration","genre","bpm","key","lyrics"],defaultTags:["music"]},Event:{keywords:["event","meeting","conference","deadline","appointment","call","reminder","date","schedule"],requiredFields:["startTime","endTime","timezone","isAllDay"],optionalFields:["location","description","attendees","recurring"],defaultTags:["calendar"]},Memory:{keywords:["remember","memory","note","thought","idea","insight","learned","decision","milestone"],requiredFields:["memoryType","content","importance","timestamp"],optionalFields:["context","projectId","emotions"],defaultTags:["memory"]},Ticket:{keywords:["ticket","task","bug","feature","story","issue","todo","fix","implement"],requiredFields:["ticketId","type","priority","status"],optionalFields:["description","asA","iWant","soThat","acceptanceCriteria","labels","epicId"],defaultTags:["task"]},Draft:{keywords:["draft","writing","blog","article","post","essay","document","content"],requiredFields:[],optionalFields:["content","wordCount","status","publishedAt","category"],defaultTags:["writing"]},Collection:{keywords:["collection","list","group","folder","category","set","bundle"],requiredFields:[],optionalFields:["description","entityIds","icon","color"],defaultTags:["collection"]},Skill:{keywords:["skill","ability","expertise","technology","tool","language","framework"],requiredFields:[],optionalFields:["level","yearsExperience","category","endorsements"],defaultTags:["skill"]},Value:{keywords:["value","principle","belief","philosophy","core","important"],requiredFields:[],optionalFields:["description","priority","examples"],defaultTags:["values"]}};function eZ(e,t,r){if(t&&t in eQ)return{entityType:t,confidence:.95,reasoning:`User suggested type: ${t}`};let i=e.toLowerCase();if("url"===r||i.match(/^https?:\/\//)){if(i.includes("github.com"))return{entityType:"Project",confidence:.9,reasoning:"GitHub URL detected"};if(i.includes("spotify.com")||i.includes("soundcloud.com"))return{entityType:"Track",confidence:.9,reasoning:"Music platform URL detected"};if(i.includes("linkedin.com"))return{entityType:"Person",confidence:.85,reasoning:"LinkedIn profile URL detected"}}let s=[];for(let[e,t]of Object.entries(eQ)){let r=t.keywords.filter(e=>i.includes(e)),n=r.length/t.keywords.length;s.push({type:e,score:n,matches:r})}s.sort((e,t)=>t.score-e.score);let n=s[0];return n.score>0?{entityType:n.type,confidence:Math.min(.5+.5*n.score,.9),reasoning:`Matched keywords: ${n.matches.join(", ")}`}:{entityType:"Memory",confidence:.4,reasoning:"No strong type signals detected, defaulting to Memory"}}function e0(e,t){let r=e.split("\n").filter(e=>e.trim());if(r[0]&&r[0].length<100)return r[0].trim();let i=e.match(/https?:\/\/(?:www\.)?([^\/]+)(?:\/([^\/\s]+))?/);return i?i[2]?i[2].replace(/[-_]/g," "):i[1]:e.slice(0,60).trim()+(e.length>60?"...":"")}function e1(e,t,r){let i={},s=(e+" "+(r||"")).toLowerCase();switch(t){case"Person":{let t=e.match(/[\w.-]+@[\w.-]+\.\w+/);for(let r of(t&&(i.email=t[0]),[/at\s+([A-Z][A-Za-z0-9\s]+)/g,/works?\s+(?:at|for)\s+([A-Z][A-Za-z0-9\s]+)/gi])){let t=r.exec(e);if(t){i.company=t[1].trim();break}}i.notes=e;break}case"Project":{i.status="discovery",i.color="#8b5cf6";let t=e.match(/https?:\/\/github\.com\/[\w-]+\/[\w-]+/);t&&(i.githubRepo=t[0]),i.description=e;break}case"Track":{for(let t of(i.isPrivate=!1,[/by\s+([^,\n]+)/i,/[-]\s*([^,\n]+)/])){let r=t.exec(e);if(r){i.artist=r[1].trim();break}}i.artist||(i.artist="Unknown Artist");let t=e.match(/https?:\/\/[^\s]+\.(mp3|wav|m4a|ogg)/i);t?i.audioUrl=t[0]:i.audioUrl="";break}case"Event":{i.timezone="America/Los_Angeles",i.isAllDay=!1;let t=Date.now();i.startTime=t,i.endTime=t+36e5,i.description=e;break}case"Memory":i.memoryType=s.includes("decision")?"decision":s.includes("preference")?"preference":s.includes("milestone")?"milestone":"interaction",i.content=e,i.importance=.7,i.timestamp=Date.now(),r&&(i.context=r);break;case"Ticket":i.ticketId=`IMPORT-${Date.now().toString(36).toUpperCase()}`,i.type=s.includes("bug")?"bug":s.includes("feature")?"story":"task",i.priority="P2",i.status="backlog",i.description=e;break;case"Draft":i.content=e,i.wordCount=e.split(/\s+/).length,i.status="draft";break;case"Collection":i.description=e,i.entityIds=[];break;case"Skill":i.level="intermediate",i.description=e;break;case"Value":i.description=e,i.priority=1}return i}async function e2(e,t){let r=e.content,i=e.contentType||"auto",s=e.suggestedType,n=e.additionalContext;if(!r)return{success:!1,error:"Content is required for entity classification"};let o=process.env.NEXT_PUBLIC_CONVEX_URL;if(!o)return{success:!1,error:"Convex URL not configured"};try{let e=eZ(r,s,i),t=e0(r,e.entityType),c=e1(r,e.entityType,n),d=[...eQ[e.entityType].defaultTags];d.push(`import-${new Date().toISOString().slice(0,7)}`);let p=new a.ConvexHttpClient(o),l=await p.mutation(a.api.erv.createEntity,{entityType:e.entityType,name:t,data:JSON.stringify(c),tags:d,source:"ai_classification",importance:e.confidence});return{success:!0,data:{entityId:l.entityId,entityType:e.entityType,name:t,confidence:e.confidence,reasoning:e.reasoning,extractedData:c,tags:d},action:{type:"entity_classified",payload:{entityId:l.entityId,entityType:e.entityType,name:t,confidence:e.confidence}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to classify and create entity"}}}async function e5(e,t){let r=e.entityId,i=e.relationshipTypes,s=e.maxSuggestions||10,n=e.minConfidence||.5,o=e.autoCreate||!1;if(!r)return{success:!1,error:"Entity ID is required"};let c=process.env.NEXT_PUBLIC_CONVEX_URL;if(!c)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(c),t=await e.query(a.api.erv.getEntity,{entityId:r});if(!t)return{success:!1,error:`Entity not found: ${r}`};let d={};try{d=JSON.parse(t.data)}catch{}let p=[t.name,...t.tags,...Object.values(d).filter(e=>"string"==typeof e)].join(" "),l=await e.query(a.api.erv.searchEntities,{query:p,limit:50}),u=[];for(let e of l){if(e.entityId===r)continue;try{JSON.parse(e.data)}catch{}let s=t.tags.filter(t=>e.tags.includes(t)),o=s.length>0?.3+.1*s.length:0,a=t.name.toLowerCase().includes(e.name.toLowerCase())||e.name.toLowerCase().includes(t.name.toLowerCase())?.3:0,c="relatedTo",d="General relationship based on content similarity";if("Person"===t.entityType&&"Project"===e.entityType?(c="collaboratedOn",d="Person may have collaborated on this project"):"Ticket"===t.entityType&&"Project"===e.entityType?(c="belongsTo",d="Ticket likely belongs to this project"):"Ticket"===t.entityType&&"Ticket"===e.entityType?(c="relatedTo",d="Related tickets with similar content"):"Memory"===t.entityType&&"Project"===e.entityType&&(c="mentions",d="Memory may reference this project"),i&&!i.includes(c))continue;let p=Math.min(o+a+.2,1);p>=n&&u.push({targetEntityId:e.entityId,targetName:e.name,targetType:e.entityType,relationshipType:c,confidence:p,reasoning:d+(s.length>0?`. Shared tags: ${s.join(", ")}`:"")})}u.sort((e,t)=>t.confidence-e.confidence);let m=u.slice(0,s),g=[];if(o)for(let t of m)try{await e.mutation(a.api.erv.createRelationship,{sourceEntityId:r,targetEntityId:t.targetEntityId,relationshipType:t.relationshipType,source:"ai_suggestion"}),g.push(`${t.relationshipType}  ${t.targetName}`)}catch{}return{success:!0,data:{entityId:r,entityName:t.name,entityType:t.entityType,suggestions:m,totalCandidatesAnalyzed:l.length,createdRelationships:o?g:void 0},action:{type:"relationships_suggested",payload:{entityId:r,suggestionCount:m.length,autoCreated:g.length}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to suggest relationships"}}}async function e3(e,t){let r=e.items,i=e.sourceFormat||"auto",s=e.defaultType,n=e.commonTags||[],o=e.dryRun||!1;if(!r||!Array.isArray(r)||0===r.length)return{success:!1,error:"Items array is required and must not be empty"};let c=process.env.NEXT_PUBLIC_CONVEX_URL;if(!c)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(c),t=[],d={};for(let c=0;c<r.length;c++){let p=r[c],l=p.content;if(!l||"string"!=typeof l){t.push({index:c,content:String(l||""),entityType:"Memory",name:"",confidence:0,reasoning:"Invalid content",error:"Content must be a non-empty string"});continue}let u=eZ(l,s,i),m=e0(l,u.entityType),g=e1(l,u.entityType,p.hint),y=[...eQ[u.entityType].defaultTags,...n];if(d[u.entityType]=(d[u.entityType]||0)+1,o)t.push({index:c,content:l.slice(0,100),entityType:u.entityType,name:m,confidence:u.confidence,reasoning:u.reasoning});else try{let r=await e.mutation(a.api.erv.createEntity,{entityType:u.entityType,name:m,data:JSON.stringify(g),tags:y,source:"bulk_import",importance:u.confidence});t.push({index:c,content:l.slice(0,100),entityType:u.entityType,name:m,confidence:u.confidence,reasoning:u.reasoning,entityId:r.entityId})}catch(e){t.push({index:c,content:l.slice(0,100),entityType:u.entityType,name:m,confidence:u.confidence,reasoning:u.reasoning,error:e instanceof Error?e.message:"Failed to create entity"})}}let p=t.filter(e=>!e.error&&e.entityId).length,l=t.filter(e=>e.error).length;return{success:!0,data:{totalItems:r.length,dryRun:o,successCount:p,errorCount:l,typeCounts:d,results:t},action:{type:"bulk_classification_complete",payload:{totalItems:r.length,successCount:p,errorCount:l,dryRun:o}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to bulk classify entities"}}}async function e4(e){let t=e.task,r=e.label,i=Math.min(e.timeoutSeconds||300,600),s=!1!==e.announceResult,n=e.priority||"normal",o=e.context;if(!t)return{success:!1,error:"Task description is required"};let c=process.env.NEXT_PUBLIC_CONVEX_URL;if(!c)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(c),d=await e.mutation(a.api.jobs.queueAgentTask,{task:t,label:r,timeoutSeconds:i,announceResult:s,priority:n,context:o}),p={jobId:d.jobId,jobType:"agent_task",status:d.status,task:t,label:r||t.slice(0,50),priority:n,progress:0,announceResult:s,context:o};try{let i=await e.mutation(a.api.erv.createEntity,{entityType:"AgentTask",name:r||t.slice(0,50),data:JSON.stringify(p),tags:["background-task",n,"agent_task"],importance:"high"===n?.8:"normal"===n?.5:.3,source:"ai"});o?.projectId&&await e.mutation(a.api.erv.createRelationship,{sourceEntityId:i.entityId,targetEntityId:o.projectId,relationshipType:"spawnedFor",bidirectional:!1,source:"ai"}).catch(()=>{}),o?.ticketId&&await e.mutation(a.api.erv.createRelationship,{sourceEntityId:i.entityId,targetEntityId:o.ticketId,relationshipType:"spawnedFor",bidirectional:!1,source:"ai"}).catch(()=>{}),o?.sandboxId&&await e.mutation(a.api.erv.createRelationship,{sourceEntityId:i.entityId,targetEntityId:o.sandboxId,relationshipType:"executedIn",bidirectional:!1,source:"ai"}).catch(()=>{})}catch{console.warn("Failed to create ERV entity for agent task")}return{success:!0,data:{jobId:d.jobId,status:d.status,task:t,label:r||t.slice(0,50),timeoutSeconds:i,message:`Task spawned! Job ID: ${d.jobId}. I'll work on this in the background and announce the result when done.`},action:{type:"task_spawned",payload:{jobId:d.jobId,task:t,label:r,priority:n,announceResult:s}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to spawn task"}}}async function e6(e){let t=e.status,r=e.limit||10,i=process.env.NEXT_PUBLIC_CONVEX_URL;if(!i)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(i),s=(await e.query(a.api.jobs.getAgentJobs,{status:t,limit:r})).map(e=>({jobId:e.jobId,type:e.jobType,status:e.status,progress:e.progress||0,progressMessage:e.progressMessage,label:e.input?.label||e.input?.task?.slice(0,50)||e.input?.goal?.slice(0,50)||e.input?.specialist,createdAt:new Date(e.createdAt).toISOString(),completedAt:e.completedAt?new Date(e.completedAt).toISOString():void 0}));return{success:!0,data:{tasks:s,count:s.length,message:s.length>0?`Found ${s.length} background task(s)`:"No background tasks found"},action:{type:"tasks_listed",payload:{tasks:s}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to list tasks"}}}async function e8(e){let t=e.jobId;if(!t)return{success:!1,error:"Job ID is required"};let r=process.env.NEXT_PUBLIC_CONVEX_URL;if(!r)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(r);return await e.mutation(a.api.jobs.cancelJob,{jobId:t}),{success:!0,data:{jobId:t,message:`Task ${t} has been cancelled`},action:{type:"task_cancelled",payload:{jobId:t}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to cancel task"}}}async function e9(e){let t=e.jobId;if(!t)return{success:!1,error:"Job ID is required"};let r=process.env.NEXT_PUBLIC_CONVEX_URL;if(!r)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(r),i=await e.query(a.api.jobs.getJob,{jobId:t});if(!i)return{success:!1,error:`Task ${t} not found`};return{success:!0,data:{jobId:i.jobId,status:i.status,progress:i.progress,progressMessage:i.progressMessage,input:i.input,output:i.output,createdAt:new Date(i.createdAt).toISOString(),completedAt:i.completedAt?new Date(i.completedAt).toISOString():void 0,message:"succeeded"===i.status?"Task completed successfully":"failed"===i.status?`Task failed: ${i.lastError||"Unknown error"}`:`Task is ${i.status}`},action:{type:"succeeded"===i.status?"task_completed":"failed"===i.status?"task_failed":"task_progress",payload:{jobId:i.jobId,status:i.status,output:i.output}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get task result"}}}async function e7(e){let t=e.goal,r=e.sandboxId,i=Math.min(e.maxIterations||5,10),s=!1!==e.stopOnSuccess,n=e.commitChanges||!1,o=e.testCommand;if(!t)return{success:!1,error:"Goal is required"};if(!r)return{success:!1,error:"Sandbox ID is required - clone a repo first"};let c=process.env.NEXT_PUBLIC_CONVEX_URL;if(!c)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(c),d=await e.mutation(a.api.jobs.queueCodeIteration,{goal:t,sandboxId:r,maxIterations:i,stopOnSuccess:s,commitChanges:n,testCommand:o}),p={jobId:d.jobId,jobType:"code_iteration",status:d.status,task:t,label:`Code: ${t.slice(0,40)}`,priority:"normal",progress:0,sandboxId:r,testCommand:o,maxIterations:i,announceResult:!0};try{let i=await e.mutation(a.api.erv.createEntity,{entityType:"AgentTask",name:`Code: ${t.slice(0,40)}`,data:JSON.stringify(p),tags:["code-iteration","autonomous",r?"sandbox":"local"],importance:.7,source:"ai"});r&&await e.mutation(a.api.erv.createRelationship,{sourceEntityId:i.entityId,targetEntityId:r,relationshipType:"executedIn",bidirectional:!1,source:"ai"}).catch(()=>{})}catch{console.warn("Failed to create ERV entity for code iteration")}return{success:!0,data:{jobId:d.jobId,status:d.status,goal:t,sandboxId:r,maxIterations:i,testCommand:o,message:`Code iteration started! Job ID: ${d.jobId}. I'll analyze the code, make changes, and iterate up to ${i} times until ${o?`"${o}" passes`:"the goal is achieved"}.`},action:{type:"iteration_started",payload:{jobId:d.jobId,goal:t,sandboxId:r,maxIterations:i,testCommand:o}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to start code iteration"}}}async function te(e){let t=e.specialist,r=e.task,i=e.context,s=!1!==e.announceResult,n=["code-reviewer","security-auditor","performance-analyst","documentation-writer","test-generator","refactoring-expert"];if(!t||!n.includes(t))return{success:!1,error:`Invalid specialist. Choose from: ${n.join(", ")}`};if(!r)return{success:!1,error:"Task description is required"};let o=process.env.NEXT_PUBLIC_CONVEX_URL;if(!o)return{success:!1,error:"Convex URL not configured"};try{let e=new a.ConvexHttpClient(o),n=await e.mutation(a.api.jobs.queueSpecialistDelegation,{specialist:t,task:r,context:i,announceResult:s}),c={jobId:n.jobId,jobType:"specialist_delegation",status:n.status,task:r,label:`${t}: ${r.slice(0,30)}`,priority:"normal",progress:0,specialist:t,announceResult:s,context:i};try{let s=await e.mutation(a.api.erv.createEntity,{entityType:"AgentTask",name:`${t}: ${r.slice(0,30)}`,data:JSON.stringify(c),tags:["specialist",t,"delegation"],importance:"security-auditor"===t?.9:.6,source:"ai"});await e.mutation(a.api.erv.createRelationship,{sourceEntityId:s.entityId,targetEntityId:t,relationshipType:"delegatedTo",bidirectional:!1,label:t,source:"ai"}).catch(()=>{}),i?.projectId&&await e.mutation(a.api.erv.createRelationship,{sourceEntityId:s.entityId,targetEntityId:i.projectId,relationshipType:"spawnedFor",bidirectional:!1,source:"ai"}).catch(()=>{}),i?.sandboxId&&await e.mutation(a.api.erv.createRelationship,{sourceEntityId:s.entityId,targetEntityId:i.sandboxId,relationshipType:"executedIn",bidirectional:!1,source:"ai"}).catch(()=>{})}catch{console.warn("Failed to create ERV entity for specialist delegation")}return{success:!0,data:{jobId:n.jobId,status:n.status,specialist:t,task:r,message:`Delegated to ${t}! Job ID: ${n.jobId}. The specialist is ${({"code-reviewer":"reviewing the code for quality, patterns, and potential issues","security-auditor":"analyzing for security vulnerabilities and best practices","performance-analyst":"identifying performance bottlenecks and optimizations","documentation-writer":"generating comprehensive documentation","test-generator":"creating test cases and improving test coverage","refactoring-expert":"suggesting and implementing code refactoring"})[t]}. I'll announce the findings when complete.`},action:{type:"specialist_delegated",payload:{jobId:n.jobId,specialist:t,task:r,announceResult:s}}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to delegate to specialist"}}}async function tt(e,t){var r,i,s,n;if("owner"!==t.accessLevel)return{success:!1,error:"Music creation is only available to the owner."};let o={};if(e.currentDraft)try{o="string"==typeof e.currentDraft?JSON.parse(e.currentDraft):e.currentDraft}catch{o={}}let a=e.userInput||"";switch(e.step){case"start":return{success:!0,data:{step:"start",draft:o,guidance:{message:"Let's create some music together! Tell me about your vision.",questions:["What genre or style are you thinking? (e.g., lofi hip-hop, cinematic orchestral, indie folk)","What mood or feeling should it evoke? (e.g., chill, energetic, melancholic, triumphant)","Is this for something specific? (podcast intro, background music, a full song with lyrics)"],suggestions:["chill lofi beats for studying","epic cinematic trailer music","upbeat indie pop with catchy hooks","ambient electronic soundscape","acoustic folk ballad"]},nextSteps:["refine_style","add_lyrics"]}};case"refine_style":let c,d=[...new Set([...(r=a).match(/\b(lofi|lo-fi|hip-hop|hiphop|pop|rock|jazz|blues|electronic|edm|house|techno|ambient|classical|orchestral|cinematic|folk|country|r&b|rnb|soul|funk|reggae|metal|punk|indie|alternative|acoustic|synth|trap|drill|dubstep|dnb|drum and bass)\b/gi)||[],...r.match(/\b(chill|relaxing|energetic|upbeat|melancholic|sad|happy|dark|bright|dreamy|ethereal|aggressive|peaceful|nostalgic|epic|dramatic|romantic|playful|mysterious|intense|mellow)\b/gi)||[],...r.match(/\b(piano|guitar|synth|drums|bass|strings|violin|cello|flute|saxophone|trumpet|organ|vocals|choir|beats|808|percussion)\b/gi)||[]].map(e=>e.toLowerCase()))],p=function(e,t){if(e.length>50)return e;let r=[],i=t.filter(e=>["lofi","pop","rock","jazz","electronic","ambient","classical","folk","hip-hop"].some(t=>e.includes(t)));i.length>0&&r.push(i.join(" "));let s=t.filter(e=>["chill","energetic","melancholic","dreamy","epic","peaceful"].some(t=>e.includes(t)));s.length>0&&r.push(`${s.join(", ")} mood`);let n=t.filter(e=>["piano","guitar","synth","drums","strings","vocals"].some(t=>e.includes(t)));return n.length>0&&r.push(`featuring ${n.join(", ")}`),r.length>0?r.join(", "):e}(a,d);return{success:!0,data:{step:"refine_style",draft:{...o,prompt:p},guidance:{message:"Great! I've crafted a style description. Here's what I have:",currentPrompt:p,questions:["Should we add or change any instruments?","Any specific production style? (lo-fi, polished, raw, vintage)","What tempo/energy level? (slow and dreamy, mid-tempo groove, fast and energetic)"],suggestions:(c=[],((i=d).includes("lofi")||i.includes("chill"))&&(c.push("Add vinyl crackle and warm tape saturation"),c.push("Include jazzy chord progressions")),(i.includes("electronic")||i.includes("synth"))&&(c.push("Add arpeggiated synth leads"),c.push("Include sidechained bass and punchy kicks")),(i.includes("acoustic")||i.includes("folk"))&&(c.push("Add fingerpicked guitar patterns"),c.push("Include soft harmonies and warm vocals")),(i.includes("cinematic")||i.includes("epic"))&&(c.push("Add sweeping string arrangements"),c.push("Include building percussion and brass")),0===c.length&&(c.push("Add more detail about the production style"),c.push("Specify the main instruments you'd like"),c.push("Describe the energy/vibe in more detail")),c)},nextSteps:["add_lyrics","set_structure","add_reference","finalize"]}};case"add_lyrics":let l=function(e,t){if(e.includes("[Verse]")||e.includes("[Chorus]"))return e;let r=e.split("\n").filter(e=>e.trim());if(r.length>=4){let e=[];for(let t=0;t<r.length;t++)0===t?e.push("[Verse 1]"):4===t&&r.length>6?e.push("\n[Chorus]"):8===t&&r.length>10&&e.push("\n[Verse 2]"),e.push(r[t]);return e.join("\n")}return t||null}(a,o.lyrics);return{success:!0,data:{step:"add_lyrics",draft:{...o,lyrics:l||o.lyrics},guidance:{message:l?"I've structured your lyrics with song sections:":"Let's write some lyrics! I can help with structure.",currentLyrics:l||o.lyrics,tips:["Use [Verse], [Chorus], [Bridge], [Intro], [Outro] tags for structure","Keep verses 4-8 lines, choruses memorable and repeatable","Consider syllable count for natural flow","Leave blank for instrumental tracks"],example:`[Intro]
(Instrumental)

[Verse 1]
Walking through the morning light
Everything feels just right

[Chorus]
This is where I want to be
Finally feeling free`},nextSteps:["set_structure","add_reference","finalize"]}};case"set_structure":let u,m,g,y=(u=(o.prompt||a).toLowerCase()).includes("ballad")||u.includes("slow")||u.includes("ambient")?70:u.includes("lofi")||u.includes("chill")||u.includes("jazz")?85:u.includes("pop")||u.includes("indie")||u.includes("folk")?110:u.includes("rock")||u.includes("funk")?120:u.includes("house")||u.includes("electronic")?125:u.includes("dnb")||u.includes("drum and bass")?170:u.includes("trap")||u.includes("hip-hop")||u.includes("hiphop")?140:100,h=(m=(o.prompt||a).toLowerCase()).includes("sad")||m.includes("melancholic")||m.includes("dark")?"A minor":m.includes("happy")||m.includes("bright")||m.includes("upbeat")?"C major":m.includes("dreamy")||m.includes("ethereal")?"E major":m.includes("epic")||m.includes("dramatic")?"D minor":m.includes("peaceful")||m.includes("calm")?"G major":"C major",f=(s=a,n=o.lyrics,(g=s.toLowerCase()).includes("intro")||g.includes("jingle")||g.includes("short")?15:g.includes("loop")||g.includes("clip")?30:g.includes("full song")||g.includes("complete")||n&&n.length>200?180:n&&n.length>50?90:30);return{success:!0,data:{step:"set_structure",draft:{...o,bpm:o.bpm||y,key:o.key||h,duration:o.duration||f,timeSignature:o.timeSignature||"4/4"},guidance:{message:"Let's dial in the technical specs:",suggestions:{bpm:{suggested:y,range:"60-200",description:"Tempo/speed of the track"},key:{suggested:h,common:["C major","G major","A minor","E minor","F major"]},duration:{suggested:f,range:"10-600 seconds",note:"30s = short clip, 180s = full song"},timeSignature:{suggested:"4/4",options:["4/4 (standard)","3/4 (waltz)","6/8 (compound)"]}}},nextSteps:["add_reference","finalize"]}};case"add_reference":let b,v=((b=a.match(/https?:\/\/[^\s]+/))?b[0]:null)||o.referenceAudioUrl;return{success:!0,data:{step:"add_reference",draft:{...o,referenceAudioUrl:v,referenceStrength:o.referenceStrength||.5},guidance:{message:v?"Reference audio set! The AI will match this track's vibe.":"Want to use a reference track? The AI can match the style of an existing song.",currentReference:v,tips:["Provide a URL to an MP3, WAV, or audio file","The AI will capture the vibe, energy, and production style","Reference strength (0-1): higher = closer match, lower = more creative freedom","Skip this step if you want fully original style"],strengthGuide:{"0.2-0.3":"Subtle influence, mostly original","0.4-0.6":"Balanced (recommended)","0.7-0.9":"Strong style match"}},nextSteps:["finalize"]}};case"finalize":let w;return{success:!0,data:{step:"finalize",draft:o,readyToGenerate:!!(o.prompt&&o.prompt.length>0),guidance:{message:"Here's your complete music request. Ready to generate?",summary:{style:o.prompt||"Not set",lyrics:o.lyrics?`${o.lyrics.split("\n").length} lines`:"Instrumental",duration:o.duration?`${o.duration} seconds`:"30 seconds (default)",bpm:o.bpm||"Auto-detect",key:o.key||"Auto-detect",timeSignature:o.timeSignature||"4/4",reference:o.referenceAudioUrl?"Yes":"No"},estimatedTime:(w=Math.ceil(3*(o.duration||30)/60))<=1?"About 1-2 minutes":`About ${w}-${w+1} minutes`},nextSteps:["generate"]}};case"generate":if(!o.prompt)return{success:!1,error:"No style prompt set. Use refine_style step first."};return{success:!0,data:{step:"generate",action:"TRIGGER_GENERATION",payload:{prompt:o.prompt,lyrics:o.lyrics,duration:o.duration||30,bpm:o.bpm,key:o.key,timeSignature:o.timeSignature||"4/4",referenceAudioUrl:o.referenceAudioUrl,referenceStrength:o.referenceStrength,title:o.title},message:"Starting music generation! This may take a few minutes on CPU."}};default:return{success:!1,error:`Unknown cowrite step: ${e.step}`}}}async function tr(e,t){if("owner"!==t.accessLevel)return{success:!1,error:"Music generation is only available to the owner."};if(!e.prompt)return{success:!1,error:"Prompt is required for music generation."};let r=e.duration||30;if(r<10||r>600)return{success:!1,error:"Duration must be between 10 and 600 seconds."};try{console.log("[MusicGen] Starting generation:",{prompt:e.prompt.slice(0,100),duration:r,bpm:e.bpm,key:e.key,hasReference:!!e.referenceAudioUrl});let t=await fetch(`${tn()}/api/music/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"generate",prompt:e.prompt,lyrics:e.lyrics,duration:r,bpm:e.bpm,key:e.key,timeSignature:e.timeSignature,referenceAudio:e.referenceAudioUrl,referenceStrength:e.referenceStrength??.5,title:e.title,saveToJamz:e.saveToJamz,projectId:e.projectId})});if(!t.ok){let e=await t.json();return{success:!1,error:e.error||"Music generation failed."}}let i=await t.json();if(e.saveToJamz&&i.audioUrl)try{let t=process.env.NEXT_PUBLIC_CONVEX_URL;if(!t)throw Error("Convex URL not configured");let r=new a.ConvexHttpClient(t),s=e.title||`AI: ${e.prompt.slice(0,30)}`,n=e.projectId;n||(n=await r.mutation(a.api.jamz.createProject,{name:"AI Generated Music",bpm:i.metadata.bpm,timeSignatureBeats:parseInt(i.metadata.timeSignature.split("/")[0])||4,timeSignatureUnit:parseInt(i.metadata.timeSignature.split("/")[1])||4}));let o=await r.mutation(a.api.jamz.createTrack,{projectId:n,name:s,type:"audio",color:"#8B5CF6"});await r.mutation(a.api.jamz.createClip,{trackId:o,name:s,startBeat:0,lengthBeats:Math.round(i.duration*i.metadata.bpm/60),audioUrl:i.audioUrl}),console.log("[MusicGen] Saved to Jamz Studio:",o)}catch(e){console.error("[MusicGen] Failed to save to Jamz:",e)}return{success:!0,data:{id:i.id,audioUrl:i.audioUrl,duration:i.duration,metadata:i.metadata,title:i.title||e.title,provider:i.provider,message:`Generated ${i.duration}s of music at ${i.metadata.bpm} BPM in ${i.metadata.key}.`},action:{type:"music_generated",payload:{id:i.id,audioUrl:i.audioUrl,duration:i.duration,metadata:i.metadata,title:i.title||e.title}}}}catch(e){return console.error("[MusicGen] Error:",e),{success:!1,error:e instanceof Error?e.message:"Music generation failed."}}}async function ti(e,t){if("owner"!==t.accessLevel)return{success:!1,error:"Audio analysis is only available to the owner."};if(!e.audioUrl)return{success:!1,error:"audioUrl is required for analysis."};try{console.log("[MusicGen] Analyzing audio:",e.audioUrl);let t=await fetch(`${tn()}/api/music/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"analyze",audioUrl:e.audioUrl,extract:e.extract||["bpm","key","time_signature","caption"]})});if(!t.ok){let e=await t.json();return{success:!1,error:e.error||"Audio analysis failed."}}let r=await t.json();return{success:!0,data:{...r,message:`Analysis complete: ${r.bpm?`${r.bpm} BPM`:""}${r.key?`, ${r.key}`:""}${r.caption?`. ${r.caption}`:""}`},action:{type:"audio_analyzed",payload:r}}}catch(e){return console.error("[MusicGen] Analysis error:",e),{success:!1,error:e instanceof Error?e.message:"Audio analysis failed."}}}async function ts(e,t){if("owner"!==t.accessLevel)return{success:!1,error:"Stem separation is only available to the owner."};if(!e.audioUrl)return{success:!1,error:"audioUrl is required for stem separation."};try{console.log("[MusicGen] Separating stems:",e.audioUrl);let t=await fetch(`${tn()}/api/music/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"separate",audioUrl:e.audioUrl,stems:e.stems||["vocals","drums","bass","other"]})});if(!t.ok){let e=await t.json();return{success:!1,error:e.error||"Stem separation failed."}}let r=await t.json(),i=Object.keys(r.stems).length;return{success:!0,data:{stems:r.stems,provider:r.provider,message:`Separated ${i} stems: ${Object.keys(r.stems).join(", ")}`},action:{type:"stems_separated",payload:r}}}catch(e){return console.error("[MusicGen] Separation error:",e),{success:!1,error:e instanceof Error?e.message:"Stem separation failed."}}}function tn(){return process.env.NEXT_PUBLIC_APP_URL||process.env.VERCEL_URL?`https://${process.env.VERCEL_URL}`:"http://localhost:3000"}e.s(["executeTool",()=>A],245870)}];

//# sourceMappingURL=src_lib_8gent_tools_ts_6e98ad72._.js.map