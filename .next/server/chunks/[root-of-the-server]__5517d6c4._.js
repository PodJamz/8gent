module.exports=[918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},666680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},524836,(e,t,r)=>{t.exports=e.x("https",()=>require("https"))},921517,(e,t,r)=>{t.exports=e.x("http",()=>require("http"))},504446,(e,t,r)=>{t.exports=e.x("net",()=>require("net"))},755004,(e,t,r)=>{t.exports=e.x("tls",()=>require("tls"))},792509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},500874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},427699,(e,t,r)=>{t.exports=e.x("events",()=>require("events"))},688947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},406461,(e,t,r)=>{t.exports=e.x("zlib",()=>require("zlib"))},857764,(e,t,r)=>{t.exports=e.x("node:url",()=>require("node:url"))},572067,e=>{"use strict";e.i(39334);let t=async()=>({id:"mock-user-id",firstName:"James",lastName:"Spalding",emailAddresses:[{emailAddress:"james@example.com"}]});e.s(["auth",0,()=>({userId:"mock-user-id",sessionId:"mock-session-id",getToken:async()=>"mock-token",redirectToSignIn:()=>({})}),"clerkClient",0,{users:{getUser:async()=>t()}}])},951615,(e,t,r)=>{t.exports=e.x("node:buffer",()=>require("node:buffer"))},478500,(e,t,r)=>{t.exports=e.x("node:async_hooks",()=>require("node:async_hooks"))},812057,(e,t,r)=>{t.exports=e.x("node:util",()=>require("node:util"))},63723,(e,t,r)=>{function o(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}t.exports=o,o.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},o.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},o.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r)if(!this._cachedTimeouts)return!1;else this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);var o=this;return this._timer=setTimeout(function(){o._attempts++,o._operationTimeoutCb&&(o._timeout=setTimeout(function(){o._operationTimeoutCb(o._attempts)},o._operationTimeout),o._options.unref&&o._timeout.unref()),o._fn(o._attempts)},r),this._options.unref&&this._timer.unref(),!0},o.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},o.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},o.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},o.prototype.start=o.prototype.try,o.prototype.errors=function(){return this._errors},o.prototype.attempts=function(){return this._attempts},o.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,o=0;o<this._errors.length;o++){var n=this._errors[o],i=n.message,s=(e[i]||0)+1;e[i]=s,s>=r&&(t=n,r=s)}return t}},210978,(e,t,r)=>{var o=e.r(63723);r.operation=function(e){return new o(r.timeouts(e),{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},r.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var o=[],n=0;n<t.retries;n++)o.push(this.createTimeout(n,t));return e&&e.forever&&!o.length&&o.push(this.createTimeout(n,t)),o.sort(function(e,t){return e-t}),o},r.createTimeout=function(e,t){var r=Math.round((t.randomize?Math.random()+1:1)*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(r,t.maxTimeout)},r.wrap=function(e,t,o){if(t instanceof Array&&(o=t,t=null),!o)for(var n in o=[],e)"function"==typeof e[n]&&o.push(n);for(var i=0;i<o.length;i++){var s=o[i],a=e[s];e[s]=(function(o){var n=r.operation(t),i=Array.prototype.slice.call(arguments,1),s=i.pop();i.push(function(e){n.retry(e)||(e&&(arguments[0]=n.mainError()),s.apply(this,arguments))}),n.attempt(function(){o.apply(e,i)})}).bind(e,a),e[s].options=t}}},61347,(e,t,r)=>{t.exports=e.r(210978)},289492,(e,t,r)=>{var o=e.r(61347);t.exports=function(e,t){return new Promise(function(r,n){var i,s=t||{};function a(e){n(e||Error("Aborted"))}function u(e,t){e.bail?a(e):i.retry(e)?s.onRetry&&s.onRetry(e,t):n(i.mainError())}"randomize"in s||(s.randomize=!0),(i=o.operation(s)).attempt(function(t){var o;try{o=e(a,t)}catch(e){u(e,t);return}Promise.resolve(o).then(r).catch(function(e){u(e,t)})})})}},57328,(e,t,r)=>{t.exports=e.x("node:assert",()=>require("node:assert"))},347299,(e,t,r)=>{t.exports=e.x("node:http",()=>require("node:http"))},81111,(e,t,r)=>{t.exports=e.x("node:stream",()=>require("node:stream"))},761095,(e,t,r)=>{t.exports=e.x("node:net",()=>require("node:net"))},483324,(e,t,r)=>{t.exports=e.x("node:querystring",()=>require("node:querystring"))},687769,(e,t,r)=>{t.exports=e.x("node:events",()=>require("node:events"))},727028,(e,t,r)=>{t.exports=e.x("node:zlib",()=>require("node:zlib"))},874096,(e,t,r)=>{t.exports=e.x("node:perf_hooks",()=>require("node:perf_hooks"))},107417,(e,t,r)=>{t.exports=e.x("node:util/types",()=>require("node:util/types"))},925127,(e,t,r)=>{t.exports=e.x("node:worker_threads",()=>require("node:worker_threads"))},677652,(e,t,r)=>{t.exports=e.x("node:diagnostics_channel",()=>require("node:diagnostics_channel"))},685560,(e,t,r)=>{t.exports=e.x("node:tls",()=>require("node:tls"))},246479,(e,t,r)=>{t.exports=e.x("node:http2",()=>require("node:http2"))},241293,(e,t,r)=>{t.exports=e.x("node:console",()=>require("node:console"))},495879,(e,t,r)=>{t.exports=e.x("node:dns",()=>require("node:dns"))},546539,e=>{"use strict";var t=e.i(254799);function r(e){let t=process.env[e];if(!t)throw Error(`${e} is not set`);return t}function o(e){return("string"==typeof e?Buffer.from(e,"utf8"):Buffer.from(e)).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function n(e,r){let o=Buffer.from(e),n=Buffer.from(r);return o.length===n.length&&t.default.timingSafeEqual(o,n)}function i(e,r){let n=t.default.createHmac("sha256",r);return n.update(e),o(n.digest())}function s(e){let t=r("VAULT_SIGNING_SECRET"),n=o(JSON.stringify(e)),s=i(n,t);return`${n}.${s}`}function a(e){if(!e)return null;let t=r("VAULT_SIGNING_SECRET"),o=e.split(".");if(2!==o.length)return null;let[s,a]=o;if(!n(a,i(s,t)))return null;try{let e,t,r=(e=4-(s.length%4||4),t=s.replace(/-/g,"+").replace(/_/g,"/")+"=".repeat(e),Buffer.from(t,"base64")).toString("utf8"),o=JSON.parse(r);if("vault"!==o.sub||"number"!=typeof o.exp||Date.now()>o.exp)return null;return o}catch{return null}}function u(){return"vault_session"}e.s(["getVaultCookieName",()=>u,"safeEqual",()=>n,"signSession",()=>s,"verifySession",()=>a])},569852,e=>{"use strict";var t=e.i(457375),r=e.i(174015),o=e.i(116384),n=e.i(63831),i=e.i(868001),s=e.i(842780),a=e.i(763077),u=e.i(502964),l=e.i(993216),p=e.i(783900),d=e.i(295731),c=e.i(726839),m=e.i(775778),h=e.i(40992),f=e.i(432128),x=e.i(193695);e.i(44807);var g=e.i(989978),_=e.i(194639),y=e.i(683107),v=e.i(39334),R=e.i(546539),T=e.i(572067),w=e.i(848920);async function E(){try{let{userId:e}=await (0,T.auth)();if(!e)return!1;let t=process.env.NEXT_PUBLIC_CONVEX_URL;if(!t)return!1;let r=new w.ConvexHttpClient(t),o=(0,w.makeFunctionReference)("userManagement:getManagedUserByClerkId"),n=await r.query(o,{clerkId:e});return n?.role==="owner"}catch{return!1}}async function b(e){let t=await (0,y.cookies)(),r=t.get((0,R.getVaultCookieName)())?.value,o=(0,R.verifySession)(r),n=await E();if(!o&&!n)return v.NextResponse.json({error:"Unauthorized"},{status:401});try{let t=await e.formData(),r=t.get("file"),o=t.get("type");if(!r)return v.NextResponse.json({error:"No file provided"},{status:400});if("audio"===o&&!["audio/mpeg","audio/wav","audio/ogg","audio/mp4","audio/aac","audio/x-m4a"].includes(r.type))return v.NextResponse.json({error:"Invalid audio format. Allowed: MP3, WAV, OGG, M4A, AAC"},{status:400});if("image"===o&&!["image/jpeg","image/png","image/webp","image/gif"].includes(r.type))return v.NextResponse.json({error:"Invalid image format. Allowed: JPG, PNG, WebP, GIF"},{status:400});let n=`${"audio"===o?"music/audio":"music/artwork"}/${Date.now()}-${r.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`,i=await (0,_.put)(n,r,{access:"public",addRandomSuffix:!1});return v.NextResponse.json({url:i.url,filename:r.name,size:r.size,type:r.type})}catch(e){return console.error("Upload error:",e),v.NextResponse.json({error:"Failed to upload file"},{status:500})}}e.s(["POST",()=>b],719502);var q=e.i(719502);let C=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/tracks/upload/route",pathname:"/api/tracks/upload",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/tracks/upload/route.ts",nextConfigOutput:"",userland:q}),{workAsyncStorage:k,workUnitAsyncStorage:N,serverHooks:A}=C;function S(){return(0,o.patchFetch)({workAsyncStorage:k,workUnitAsyncStorage:N})}async function O(e,t,o){C.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let _="/api/tracks/upload/route";_=_.replace(/\/index$/,"")||"/";let y=await C.prepare(e,t,{srcPage:_,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve()),null;let{buildId:v,params:R,nextConfig:T,parsedUrl:w,isDraftMode:E,prerenderManifest:b,routerServerContext:q,isOnDemandRevalidate:k,revalidateOnlyGenerated:N,resolvedPathname:A,clientReferenceManifest:S,serverActionsManifest:O}=y,P=(0,a.normalizeAppPath)(_),I=!!(b.dynamicRoutes[P]||b.routes[A]),U=async()=>((null==q?void 0:q.render404)?await q.render404(e,t,w,!1):t.end("This page could not be found"),null);if(I&&!E){let e=!!b.routes[A],t=b.dynamicRoutes[P];if(t&&!1===t.fallback&&!e){if(T.experimental.adapterPath)return await U();throw new x.NoFallbackError}}let j=null;!I||C.isDev||E||(j="/index"===(j=A)?"/":j);let M=!0===C.isDev||!I,H=I&&!M;O&&S&&(0,s.setManifestsSingleton)({page:_,clientReferenceManifest:S,serverActionsManifest:O});let D=e.method||"GET",$=(0,i.getTracer)(),z=$.getActiveScopeSpan(),B={params:R,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:o.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,o,n)=>C.onRequestError(e,t,o,n,q)},sharedContext:{buildId:v}},G=new u.NodeNextRequest(e),F=new u.NodeNextResponse(t),L=l.NextRequestAdapter.fromNodeNextRequest(G,(0,l.signalFromNodeResponse)(t));try{let s=async e=>C.handle(L,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=$.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=r.get("next.route");if(o){let t=`${D} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${D} ${_}`)}),a=!!(0,n.getRequestMeta)(e,"minimalMode"),u=async n=>{var i,u;let l=async({previousCacheEntry:r})=>{try{if(!a&&k&&N&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await s(n);e.fetchMetrics=B.renderOpts.fetchMetrics;let u=B.renderOpts.pendingWaitUntil;u&&o.waitUntil&&(o.waitUntil(u),u=void 0);let l=B.renderOpts.collectedTags;if(!I)return await (0,c.sendResponse)(G,F,i,B.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(i.headers);l&&(t[f.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,o=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:o}}}}catch(t){throw(null==r?void 0:r.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:k})},!1,q),t}},p=await C.handleResponse({req:e,nextConfig:T,cacheKey:j,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:k,revalidateOnlyGenerated:N,responseGenerator:l,waitUntil:o.waitUntil,isMinimalMode:a});if(!I)return null;if((null==p||null==(i=p.value)?void 0:i.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(u=p.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});a||t.setHeader("x-nextjs-cache",k?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),E&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let x=(0,m.fromNodeOutgoingHttpHeaders)(p.value.headers);return a&&I||x.delete(f.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||x.get("Cache-Control")||x.set("Cache-Control",(0,h.getCacheControlHeader)(p.cacheControl)),await (0,c.sendResponse)(G,F,new Response(p.value.body,{headers:x,status:p.value.status||200})),null};z?await u(z):await $.withPropagatedContext(e.headers,()=>$.trace(p.BaseServerSpan.handleRequest,{spanName:`${D} ${_}`,kind:i.SpanKind.SERVER,attributes:{"http.method":D,"http.target":e.url}},u))}catch(t){if(t instanceof x.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:k})},!1,q),I)throw t;return await (0,c.sendResponse)(G,F,new Response(null,{status:500})),null}}e.s(["handler",()=>O,"patchFetch",()=>S,"routeModule",()=>C,"serverHooks",()=>A,"workAsyncStorage",()=>k,"workUnitAsyncStorage",()=>N],569852)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__5517d6c4._.js.map