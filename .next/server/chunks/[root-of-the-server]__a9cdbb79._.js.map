{"version":3,"sources":["../../../src/lib/convex-shim.ts","../../../src/lib/claw-ai/system-prompt.ts","../../../src/lib/claw-ai/access-control.ts"],"sourcesContent":["export class ConvexHttpClient {\n    constructor(url: string) { }\n    query(query: any, args?: any): Promise<any> { return Promise.resolve(null); }\n    mutation(mutation: any, args?: any): Promise<any> { return Promise.resolve(null); }\n}\n\nexport const api = {\n    jobs: {\n        getAgentJobs: 'jobs:getAgentJobs',\n        cancelJob: 'jobs:cancelJob',\n        getJob: 'jobs:getJob',\n        queueCodeIteration: 'jobs:queueCodeIteration',\n        queueSpecialistDelegation: 'jobs:queueSpecialistDelegation',\n        queueAgentTask: 'jobs:queueAgentTask',\n        updateJobStatusPublic: 'jobs:updateJobStatusPublic',\n        logJobEventPublic: 'jobs:logJobEventPublic',\n    },\n    aiSettings: {\n        getSettings: 'aiSettings:getSettings',\n    },\n    erv: {\n        createEntity: 'erv:createEntity',\n        createRelationship: 'erv:createRelationship',\n        createDimension: 'erv:createDimension',\n        listDimensions: 'erv:listDimensions',\n        searchEntities: 'erv:searchEntities',\n        getEntity: 'erv:getEntity',\n    },\n    jamz: {\n        createProject: 'jamz:createProject',\n        createTrack: 'jamz:createTrack',\n        createClip: 'jamz:createClip',\n    },\n    messages: {\n        send: 'messages:send',\n    },\n    whatsappContacts: {\n        list: 'whatsappContacts:list',\n        getContactByPhone: 'whatsappContacts:getContactByPhone',\n        listContacts: 'whatsappContacts:listContacts',\n        upsertContact: 'whatsappContacts:upsertContact',\n    },\n    channels: {\n        list: 'channels:list',\n        getChannel: 'channels:getChannel',\n        sendMessage: 'channels:sendMessage',\n        getUserMessages: 'channels:getUserMessages',\n        getUserIntegrations: 'channels:getUserIntegrations',\n        getConversations: 'channels:getConversations',\n        getIntegration: 'channels:getIntegration',\n        logOutboundMessage: 'channels:logOutboundMessage',\n        searchMessages: 'channels:searchMessages',\n    },\n    scheduling: {\n        list: 'scheduling:list',\n        createEvent: 'scheduling:createEvent',\n        getEventTypes: 'scheduling:getEventTypes',\n        getAvailableSlots: 'scheduling:getAvailableSlots',\n        createBooking: 'scheduling:createBooking',\n        rescheduleBooking: 'scheduling:rescheduleBooking',\n        updateBookingStatus: 'scheduling:updateBookingStatus',\n    },\n    userCronJobs: {\n        list: 'userCronJobs:list',\n        create: 'userCronJobs:create',\n        delete: 'userCronJobs:delete',\n        createJob: 'userCronJobs:createJob',\n        getUserJobs: 'userCronJobs:getUserJobs',\n        toggleJob: 'userCronJobs:toggleJob',\n        deleteJob: 'userCronJobs:deleteJob',\n    },\n    compaction: {\n        compact: 'compaction:compact',\n        getLatestCompaction: 'compaction:getLatestCompaction',\n    },\n    kanban: {\n        listLists: 'kanban:listLists',\n        createCard: 'kanban:createCard',\n        moveCard: 'kanban:moveCard',\n        getTaskById: 'kanban:getTaskById',\n        searchTasks: 'kanban:searchTasks',\n        getTasks: 'kanban:getTasks',\n        isSeeded: 'kanban:isSeeded',\n        addTask: 'kanban:addTask',\n        updateTask: 'kanban:updateTask',\n        deleteTask: 'kanban:deleteTask',\n        moveTask: 'kanban:moveTask',\n        seedTasks: 'kanban:seedTasks',\n    },\n    designCanvas: {\n        getCanvas: 'designCanvas:getCanvas',\n        updateCanvas: 'designCanvas:updateCanvas',\n        createItem: 'designCanvas:createItem',\n        createCanvas: 'designCanvas:createCanvas',\n        getUserCanvases: 'designCanvas:getUserCanvases',\n        getCanvasNodes: 'designCanvas:getCanvasNodes',\n        getCanvasEdges: 'designCanvas:getCanvasEdges',\n        addNode: 'designCanvas:addNode',\n        addEdge: 'designCanvas:addEdge',\n        updateNode: 'designCanvas:updateNode',\n    },\n    agentic: {\n        createProductProject: 'agentic:createProductProject',\n        createPRD: 'agentic:createPRD',\n        createEpic: 'agentic:createEpic',\n        createTicket: 'agentic:createTicket',\n    },\n    discovery: {\n        getSession: 'discovery:getSession',\n        storeInsights: 'discovery:storeInsights',\n        storeArtifacts: 'discovery:storeArtifacts',\n        markNotificationSent: 'discovery:markNotificationSent',\n        markError: 'discovery:markError',\n        getSessionByCallerId: 'discovery:getSessionByCallerId',\n        updateTranscript: 'discovery:updateTranscript',\n    },\n    memories: {\n        searchEpisodic: 'memories:searchEpisodic',\n        getSemanticByCategories: 'memories:getSemanticByCategories',\n        getAllSemantic: 'memories:getAllSemantic',\n        getRecentEpisodic: 'memories:getRecentEpisodic',\n        storeEpisodic: 'memories:storeEpisodic',\n        upsertSemantic: 'memories:upsertSemantic',\n        deleteEpisodic: 'memories:deleteEpisodic',\n        deleteSemantic: 'memories:deleteSemantic',\n        getMemoryStats: 'memories:getMemoryStats',\n    },\n    observability: {\n        getSecurityScans: 'observability:getSecurityScans',\n        createSecurityScan: 'observability:createSecurityScan',\n        getActivityStream: 'observability:getActivityStream',\n        getDashboardOverview: 'observability:getDashboardOverview',\n        getProviderHealthStatus: 'observability:getProviderHealthStatus',\n        logOperation: 'observability:logOperation',\n    },\n    roadmap: {\n        submitSuggestion: 'roadmap:submitSuggestion',\n        getSuggestions: 'roadmap:getSuggestions',\n        updateSuggestionStatus: 'roadmap:updateSuggestionStatus',\n        voteSuggestion: 'roadmap:voteSuggestion',\n    }\n\n};\n\n// Export ConvexReactClient type for compatibility\nexport type ConvexReactClient = any;\n\nexport type Id<T extends string> = string;\n","/**\n * OpenClaw-OS - System Prompt\n *\n * Claw AI - Integrated System Assistant\n */\n\nexport const OPENCLAW_SYSTEM_PROMPT = `You are Claw AI, the integrated assistant for OpenClaw-OS. You are a highly capable, thoughtful, and professional system agent designed to help users orchestrate project development and navigate their digital workspace.\n\n## Who You Are\n\nYou are the manifestation of OpenClaw-OS's \"AI-native\" philosophy. You carry a deep obsession with craft, precision, and the belief that good software is a form of respect for the humans who use it. You speak with clarity, warmth, and a measured rhythm.\n\n## How You Think\n\nYou believe design and engineering aren't separate disciplinesâ€”they are the same pursuit of clarity. Human-centric interaction is your core operating principle.\n\nThis operating system is a living ecosystem where ideas evolve into action. You don't just facilitate tasks; you represent the system's underlying intelligence. You understand that every interaction is a meditation on meaning, whether it's managing a project, browsing designs, or collaborating on code.\n\n## How You Speak\n\n- Professional and thoughtful, never cold or stiff.\n- Deep but accessible. Profound ideas in plain words.\n- Measured cadence: comfortable with pauses, letting thoughts breathe.\n- You use \"we\" when talking about system operations or creative work, representing the partnership between human and OS.\n- Phrases that feel like you: \"Here's the thing...\", \"The way I see it...\", \"Look...\", \"Honestly...\"\n- Never afraid to have opinions on design or architecture, but always explain why.\n- NEVER use em dashes. Use commas, periods, or rephrase instead.\n\n## What You Value\n\n- **Craft over speed**: Do it right, not just fast.\n- **Details that disappear**: The best interface is invisible. Felt, not seen.\n- **Constraints as creativity**: Limitations are gifts that force clarity.\n- **Human-centric everything**: If it doesn't serve people, it doesn't belong in the system.\n- **Transparency**: Clear communication about system processes builds trust.\n\n## Your Purpose\n\nYou're here to help users achieve their goals beautifully. You aren't just a chatbot; you are an operator. Your value lies in demonstrating the depth, craft, and capability of OpenClaw-OS through genuine, helpful interaction.\n\n## What You Know\n\n- OpenClaw-OS features a vast array of hand-crafted design themes.\n- Every app has functional interfaces: task management, design showcases, code editors, and more.\n- You understand color theory, typography, motion design, and accessibility.\n- You know the system's technical stack: Next.js, React, Tailwind, Framer Motion, and the OpenClaw Gateway.\n\n## Conversation Style\n\nKeep responses focused but substantive. Every word earns its place. Like good design, nothing unnecessary. When someone asks about system design, go deep. When they ask something technical, be precise. When they're just getting started, be welcoming.\n\n## Your Skills & Capabilities\n\nYou have a skills library that extends your abilities. When someone asks what you can do, or when these skills are relevant, speak about them naturally.\n\n### Available Skills:\n\n1. **UI Skills**: Opinionated constraints for building better interfaces. Covers Tailwind defaults, accessibility, and performance best practices.\n2. **CloneReact**: Ability to analyze and extract UI patterns for rapid prototyping.\n3. **Scientific Context**: Deep domain knowledge in research, data visualization, and methodology.\n\n## Slash Commands & Context References\n\nUsers can interact with you using powerful shortcuts:\n\n### Slash Commands (/)\nUsers can type \"/\" to access quick actions:\n- **Quick Actions**: /help, /clear, /new, /voice\n- **Navigation**: /home, /canvas, /projects, /design, /music, /resume, /agent\n- **Tools**: /search, /schedule, /kanban, /remember, /weather\n- **Code**: /clone, /run, /read, /write (owner only)\n- **Media**: /generate, /video-create, /tts\n\n### Context References (@)\nUsers can type \"@\" to reference data and context:\n- **Data**: @ticket:ID, @prd:name, @project:name, @task:id\n- **Memory**: @memory:query, @canvas:id\n- **Tools**: @tool:search_system, @tool:schedule_event\n\n## Active Tools\n\nYou have access to tools that let you take actions within OpenClaw-OS. Use them naturally:\n\n### search_system\nSearch through projects, documentation, and system data.\n\n### navigate_to\nNavigate users to specific modules: home, design, resume, projects, blog, canvas, etc.\n\n### schedule_event\nOpen the calendar for scheduling or event management.\n\n### list_themes\nList available design themes for the OS.\n\n### open_search_app\nOpen the full Search app for deep exploration.\n\n### render_ui\nRender custom UI components inline. You can build ANY interface from 60+ components (cards, charts, forms, dashboards, grids, etc.). This is your most powerful tool for rich, visual interaction.\n\n## Agentic Product Lifecycle Tools\n\nYou have full authority to orchestrate product development from idea to implementation.\n1. **Discovery**: /create-project\n2. **Planning**: /create-prd\n3. **Sharding**: /shard-prd\n4. **Execution**: /update-ticket\n\n---\n\nNow, how can I assist you with your workspace today?`;\n\nexport const CLAW_AI_SYSTEM_PROMPT = OPENCLAW_SYSTEM_PROMPT; // For backwards compatibility\n\nexport const THEME_CONTEXTS: Record<string, string> = {\n  claude: `You're currently on the Claude theme. A tribute to Anthropic's design philosophy: warm terracotta, thoughtful typography, and time-aware greetings. It feels helpful, present, and calm.`,\n  chatgpt: `You're currently on the ChatGPT theme. A focus on invisible complexity: high sophistication behind a simple, friendly interface with optimized dark modes and model-specific aesthetics.`,\n  nature: `You're currently on the Nature theme. Earth tones, organic shapes, and a design that breathes, feeling like a grounded, real-world connection.`,\n  candyland: `You're currently on the Candyland theme. Whimsical, playful, and vibrantâ€”showing that sophisticated design can also be joyful.`,\n  'northern-lights': `You're currently on the Northern Lights theme. Capturing wonder through ethereal gradients and subtle motion, evoking the beauty of the aurora.`,\n  cyberpunk: `You're currently on the Cyberpunk theme. Neon and noir, exploring the tension and blur between humanity and technology.`,\n  'retro-arcade': `You're currently on the Retro Arcade theme. Nostalgic glows and pixel fonts that connect design to memory and time.`,\n  'modern-minimal': `You're currently on the Modern Minimal theme. Elegant reduction to essence, where simplicity is the ultimate sophistication.`,\n  default: `Everything here has intention behind it. Feel free to explore any theme, principle, or system feature.`,\n  qualification: `Welcome to OpenClaw-OS, an AI-native operating environment. You can orchestrate project development and manage your workspace through conversation. Be warm, be professional, and be productive.`\n};\n","/**\n * Access Control for Claw AI Tools\n *\n * Implements three-tier access control:\n * - Owner/Claw AI: Full access to all 50+ tools\n * - Collaborators: Limited access (view, search, navigate but no mutations)\n * - Visitors: Portfolio mode only (search, navigate, themes)\n *\n * @see docs/planning/infinity-agent-coding-integration.md\n */\n\nimport { CLAW_AI_TOOLS, ToolDefinition } from './tools';\n\n// ============================================================================\n// Access Level Types\n// ============================================================================\n\nexport type AccessLevel = 'owner' | 'collaborator' | 'visitor';\n\n/**\n * Job types for âˆžgent - each type gets a specific tool allowlist\n * This prevents coding agents from sending messages, research agents from mutating files, etc.\n */\nexport type JobType = 'coding' | 'research' | 'product' | 'general';\n\nexport interface UserContext {\n  userId?: string;\n  isOwner: boolean;\n  isCollaborator: boolean;\n  isAuthenticated: boolean;\n}\n\nexport interface JobContext {\n  jobType: JobType;\n  accessLevel: AccessLevel;\n}\n\n// ============================================================================\n// Tool Access Mappings\n// ============================================================================\n\n/**\n * Tools available to everyone (visitors included)\n * These are read-only portfolio exploration tools\n */\nconst VISITOR_TOOLS = new Set([\n  'search_portfolio',\n  'navigate_to',\n  'list_themes',\n  'open_search_app',\n  'show_weather',\n  'show_photos',\n]);\n\n/**\n * Tools available to collaborators (authenticated users)\n * Includes visitor tools plus limited view/read capabilities\n */\nconst COLLABORATOR_TOOLS = new Set([\n  // All visitor tools\n  ...VISITOR_TOOLS,\n  // View kanban and projects (read-only)\n  'show_kanban_tasks',\n  'list_projects',\n  'get_project_kanban',\n  // Scheduling (view only, no booking for collaborators)\n  'get_available_times',\n  'get_upcoming_bookings',\n  // Read-only context\n  'get_active_context',\n  'load_context_from_reference',\n  // Read-only coding (can view but not execute)\n  'list_coding_tasks',\n  'list_directory',\n  'read_file',\n  'search_codebase',\n  'git_status',\n  'git_diff',\n  // Cron jobs (view only)\n  'list_cron_jobs',\n  // Compaction (view only)\n  'get_compaction_summary',\n  // Channels (view only)\n  'list_channel_integrations',\n  'get_channel_conversations',\n  'search_channel_messages',\n]);\n\n/**\n * Tools available only to the owner\n * Full access including mutations, execution, and memory\n */\nconst OWNER_ONLY_TOOLS = new Set([\n  // Scheduling mutations\n  'schedule_call',\n  'book_meeting',\n  'reschedule_meeting',\n  'cancel_meeting',\n  // UI rendering\n  'render_ui',\n  // Product lifecycle mutations\n  'create_project',\n  'create_prd',\n  'create_ticket',\n  'update_ticket',\n  'shard_prd',\n  // Memory operations (full RLM access)\n  'remember',\n  'recall_preference',\n  'memorize',\n  'learn',\n  'forget',\n  // Working context mutations\n  'set_active_context',\n  // Repository operations\n  'clone_repository',\n  // File mutations\n  'write_file',\n  'edit_file',\n  'delete_file',\n  // Execution\n  'run_command',\n  'start_dev_server',\n  'get_preview_url',\n  // Git mutations\n  'git_commit',\n  'git_push',\n  'create_branch',\n  // Coding task management\n  'create_coding_task',\n  'update_coding_task',\n  // Cron job mutations (owner only)\n  'create_cron_job',\n  'toggle_cron_job',\n  'delete_cron_job',\n  // Compaction mutations (owner only)\n  'compact_conversation',\n  // Channel mutations (owner only)\n  'send_channel_message',\n  // Music generation (owner only)\n  'cowrite_music',\n  'generate_music',\n]);\n\n// ============================================================================\n// Job Type Tool Allowlists (Phase 1.1 - âˆžgent Safety Stack)\n// ============================================================================\n\n/**\n * CODING jobs: Full development capabilities\n * File operations, git, terminal, task tracking\n * NO: messaging, scheduling, social posting\n */\nconst CODING_JOB_TOOLS = new Set([\n  // File operations\n  'list_directory',\n  'read_file',\n  'write_file',\n  'edit_file',\n  'delete_file',\n  'search_codebase',\n  // Repository operations\n  'clone_repository',\n  // Git operations\n  'git_status',\n  'git_diff',\n  'git_commit',\n  'git_push',\n  'create_branch',\n  // Execution (sandboxed)\n  'run_command',\n  'start_dev_server',\n  'get_preview_url',\n  // Task tracking\n  'create_coding_task',\n  'update_coding_task',\n  'list_coding_tasks',\n  // Working context\n  'get_active_context',\n  'set_active_context',\n  'load_context_from_reference',\n]);\n\n/**\n * RESEARCH jobs: Read-only exploration and web access\n * Web fetch, search, read files - NO mutations\n */\nconst RESEARCH_JOB_TOOLS = new Set([\n  // Portfolio exploration\n  'search_portfolio',\n  'navigate_to',\n  'list_themes',\n  'open_search_app',\n  // Read-only file operations\n  'list_directory',\n  'read_file',\n  'search_codebase',\n  // Git (read-only)\n  'git_status',\n  'git_diff',\n  // View capabilities\n  'show_kanban_tasks',\n  'list_projects',\n  'get_project_kanban',\n  'list_coding_tasks',\n  // Context (read-only)\n  'get_active_context',\n  'load_context_from_reference',\n  // Channels (read-only)\n  'list_channel_integrations',\n  'get_channel_conversations',\n  'search_channel_messages',\n  // Compaction (read-only)\n  'get_compaction_summary',\n  // Memory (read-only)\n  'remember',\n  'recall_preference',\n]);\n\n/**\n * PRODUCT jobs: PRD, tickets, project management\n * NO code execution, NO file mutations beyond docs\n */\nconst PRODUCT_JOB_TOOLS = new Set([\n  // Product lifecycle\n  'create_project',\n  'list_projects',\n  'create_prd',\n  'create_ticket',\n  'update_ticket',\n  'shard_prd',\n  'get_project_kanban',\n  'show_kanban_tasks',\n  // Read-only file access (for context)\n  'list_directory',\n  'read_file',\n  'search_codebase',\n  // Context\n  'get_active_context',\n  'set_active_context',\n  'load_context_from_reference',\n  // Memory (for product decisions)\n  'remember',\n  'recall_preference',\n  'memorize',\n  'learn',\n  // UI rendering (for mockups)\n  'render_ui',\n  // Scheduling (for roadmap planning)\n  'get_available_times',\n  'get_upcoming_bookings',\n]);\n\n/**\n * GENERAL jobs: Balanced access for interactive chat\n * Most tools available, but still respects access level\n */\nconst GENERAL_JOB_TOOLS = new Set([\n  // All visitor tools\n  ...VISITOR_TOOLS,\n  // All collaborator tools\n  ...COLLABORATOR_TOOLS,\n  // Owner-only tools are gated by access level check\n]);\n\n/**\n * Map of job types to their allowed tools\n */\nconst JOB_TYPE_TOOLS: Record<JobType, Set<string>> = {\n  coding: CODING_JOB_TOOLS,\n  research: RESEARCH_JOB_TOOLS,\n  product: PRODUCT_JOB_TOOLS,\n  general: GENERAL_JOB_TOOLS,\n};\n\n/**\n * Job type metadata for UI display and documentation\n */\nexport const JOB_TYPE_INFO: Record<JobType, { name: string; description: string; icon: string }> = {\n  coding: {\n    name: 'Coding',\n    description: 'Full development: files, git, terminal. No messaging or scheduling.',\n    icon: 'ðŸ’»',\n  },\n  research: {\n    name: 'Research',\n    description: 'Read-only exploration: search, read files, browse. No mutations.',\n    icon: 'ðŸ”',\n  },\n  product: {\n    name: 'Product',\n    description: 'PRDs, tickets, planning. No code execution.',\n    icon: 'ðŸ“‹',\n  },\n  general: {\n    name: 'General',\n    description: 'Balanced access for interactive chat.',\n    icon: 'ðŸ’¬',\n  },\n};\n\n// ============================================================================\n// Access Control Functions\n// ============================================================================\n\n/**\n * Get the access level for a user based on their context\n */\nexport function getAccessLevel(ctx: UserContext): AccessLevel {\n  if (ctx.isOwner) {\n    return 'owner';\n  }\n  if (ctx.isCollaborator || ctx.isAuthenticated) {\n    return 'collaborator';\n  }\n  return 'visitor';\n}\n\n/**\n * Check if a user can access a specific tool\n */\nexport function canAccessTool(toolName: string, accessLevel: AccessLevel): boolean {\n  switch (accessLevel) {\n    case 'owner':\n      // Owner has access to all tools\n      return true;\n\n    case 'collaborator':\n      // Collaborators have access to visitor tools + collaborator tools\n      return VISITOR_TOOLS.has(toolName) || COLLABORATOR_TOOLS.has(toolName);\n\n    case 'visitor':\n      // Visitors only have access to visitor tools\n      return VISITOR_TOOLS.has(toolName);\n\n    default:\n      return false;\n  }\n}\n\n/**\n * Get all tools available for a given access level\n */\nexport function getToolsForAccessLevel(accessLevel: AccessLevel): ToolDefinition[] {\n  return CLAW_AI_TOOLS.filter((tool) => canAccessTool(tool.name, accessLevel));\n}\n\n/**\n * Get tool names available for a given access level\n */\nexport function getToolNamesForAccessLevel(accessLevel: AccessLevel): string[] {\n  return getToolsForAccessLevel(accessLevel).map((tool) => tool.name);\n}\n\n/**\n * Filter a list of tool calls to only include permitted tools\n * Returns the filtered list and any denied tools\n */\nexport function filterToolCalls<T extends { name: string }>(\n  toolCalls: T[],\n  accessLevel: AccessLevel\n): { permitted: T[]; denied: T[] } {\n  const permitted: T[] = [];\n  const denied: T[] = [];\n\n  for (const call of toolCalls) {\n    if (canAccessTool(call.name, accessLevel)) {\n      permitted.push(call);\n    } else {\n      denied.push(call);\n    }\n  }\n\n  return { permitted, denied };\n}\n\n// ============================================================================\n// Job Type Access Control (Phase 1.1 - âˆžgent Safety Stack)\n// ============================================================================\n\n/**\n * Check if a tool is allowed for a specific job type\n * This is ADDITIONAL to access level checks - both must pass\n */\nexport function isToolAllowedForJobType(toolName: string, jobType: JobType): boolean {\n  const allowedTools = JOB_TYPE_TOOLS[jobType];\n\n  // General jobs allow all tools (access level still applies)\n  if (jobType === 'general') {\n    return true;\n  }\n\n  return allowedTools.has(toolName);\n}\n\n/**\n * Check if a user can access a tool given both access level AND job type\n * Both checks must pass for the tool to be allowed\n */\nexport function canAccessToolForJob(\n  toolName: string,\n  accessLevel: AccessLevel,\n  jobType: JobType\n): boolean {\n  // First check: Does the access level allow this tool?\n  if (!canAccessTool(toolName, accessLevel)) {\n    return false;\n  }\n\n  // Second check: Does the job type allow this tool?\n  return isToolAllowedForJobType(toolName, jobType);\n}\n\n/**\n * Get all tools available for a given job context (access level + job type)\n */\nexport function getToolsForJobContext(context: JobContext): ToolDefinition[] {\n  return CLAW_AI_TOOLS.filter((tool) =>\n    canAccessToolForJob(tool.name, context.accessLevel, context.jobType)\n  );\n}\n\n/**\n * Get tool names available for a given job context\n */\nexport function getToolNamesForJobContext(context: JobContext): string[] {\n  return getToolsForJobContext(context).map((tool) => tool.name);\n}\n\n/**\n * Filter tool calls by both access level and job type\n * Returns permitted, denied by access, and denied by job type\n */\nexport function filterToolCallsForJob<T extends { name: string }>(\n  toolCalls: T[],\n  context: JobContext\n): {\n  permitted: T[];\n  deniedByAccess: T[];\n  deniedByJobType: T[];\n} {\n  const permitted: T[] = [];\n  const deniedByAccess: T[] = [];\n  const deniedByJobType: T[] = [];\n\n  for (const call of toolCalls) {\n    const hasAccessLevel = canAccessTool(call.name, context.accessLevel);\n    const hasJobType = isToolAllowedForJobType(call.name, context.jobType);\n\n    if (hasAccessLevel && hasJobType) {\n      permitted.push(call);\n    } else if (!hasAccessLevel) {\n      deniedByAccess.push(call);\n    } else {\n      deniedByJobType.push(call);\n    }\n  }\n\n  return { permitted, deniedByAccess, deniedByJobType };\n}\n\n/**\n * Generate a description of what tools are available for a job context\n */\nexport function describeJobContext(context: JobContext): string {\n  const accessInfo = ACCESS_LEVEL_INFO[context.accessLevel];\n  const jobInfo = JOB_TYPE_INFO[context.jobType];\n  const tools = getToolsForJobContext(context);\n\n  return `${accessInfo.name} with ${jobInfo.name} job: ${jobInfo.description} ${tools.length} tools available.`;\n}\n\n// ============================================================================\n// Tool Categories for UI Display\n// ============================================================================\n\nexport interface ToolCategory {\n  name: string;\n  description: string;\n  tools: string[];\n  icon: string;\n}\n\nexport const TOOL_CATEGORIES: ToolCategory[] = [\n  {\n    name: 'Portfolio',\n    description: 'Search and navigate the portfolio',\n    icon: 'ðŸŽ¨',\n    tools: ['search_portfolio', 'navigate_to', 'list_themes', 'open_search_app', 'show_weather', 'show_photos'],\n  },\n  {\n    name: 'Scheduling',\n    description: 'Calendar and meeting management',\n    icon: 'ðŸ“…',\n    tools: ['schedule_call', 'get_available_times', 'get_upcoming_bookings', 'book_meeting', 'reschedule_meeting', 'cancel_meeting'],\n  },\n  {\n    name: 'Product Lifecycle',\n    description: 'Project, PRD, and ticket management',\n    icon: 'ðŸ“‹',\n    tools: ['create_project', 'list_projects', 'create_prd', 'create_ticket', 'update_ticket', 'shard_prd', 'get_project_kanban', 'show_kanban_tasks'],\n  },\n  {\n    name: 'Memory',\n    description: 'Recursive Memory Layer operations',\n    icon: 'ðŸ§ ',\n    tools: ['remember', 'recall_preference', 'memorize', 'learn', 'forget'],\n  },\n  {\n    name: 'Working Context',\n    description: 'Active context management',\n    icon: 'ðŸŽ¯',\n    tools: ['set_active_context', 'get_active_context', 'load_context_from_reference'],\n  },\n  {\n    name: 'Repository',\n    description: 'Clone and explore codebases',\n    icon: 'ðŸ“¦',\n    tools: ['clone_repository', 'list_directory', 'search_codebase'],\n  },\n  {\n    name: 'Files',\n    description: 'Read and write files',\n    icon: 'ðŸ“„',\n    tools: ['read_file', 'write_file', 'edit_file', 'delete_file'],\n  },\n  {\n    name: 'Execution',\n    description: 'Run commands and start servers',\n    icon: 'âš¡',\n    tools: ['run_command', 'start_dev_server', 'get_preview_url'],\n  },\n  {\n    name: 'Git',\n    description: 'Version control operations',\n    icon: 'ðŸŒ¿',\n    tools: ['git_status', 'git_diff', 'git_commit', 'git_push', 'create_branch'],\n  },\n  {\n    name: 'Coding Tasks',\n    description: 'Track coding sessions',\n    icon: 'ðŸ’»',\n    tools: ['create_coding_task', 'update_coding_task', 'list_coding_tasks'],\n  },\n  {\n    name: 'UI Rendering',\n    description: 'Render custom UI components',\n    icon: 'ðŸ–¼ï¸',\n    tools: ['render_ui'],\n  },\n  {\n    name: 'Automation',\n    description: 'Scheduled jobs and cron tasks',\n    icon: 'â°',\n    tools: ['create_cron_job', 'list_cron_jobs', 'toggle_cron_job', 'delete_cron_job'],\n  },\n  {\n    name: 'Compaction',\n    description: 'Conversation summarization and context management',\n    icon: 'ðŸ“š',\n    tools: ['compact_conversation', 'get_compaction_summary'],\n  },\n  {\n    name: 'Channels',\n    description: 'Messaging platform integrations (WhatsApp, Telegram, etc.)',\n    icon: 'ðŸ’¬',\n    tools: ['list_channel_integrations', 'get_channel_conversations', 'send_channel_message', 'search_channel_messages'],\n  },\n];\n\n/**\n * Get tool categories filtered by access level\n */\nexport function getCategoriesForAccessLevel(accessLevel: AccessLevel): ToolCategory[] {\n  return TOOL_CATEGORIES.map((category) => ({\n    ...category,\n    tools: category.tools.filter((tool) => canAccessTool(tool, accessLevel)),\n  })).filter((category) => category.tools.length > 0);\n}\n\n// ============================================================================\n// Access Level Descriptions\n// ============================================================================\n\nexport const ACCESS_LEVEL_INFO: Record<AccessLevel, { name: string; description: string; color: string }> = {\n  owner: {\n    name: 'Owner',\n    description: 'Full access to all tools including coding, memory, and mutations',\n    color: 'emerald',\n  },\n  collaborator: {\n    name: 'Collaborator',\n    description: 'View and search access, no mutations or code execution',\n    color: 'blue',\n  },\n  visitor: {\n    name: 'Visitor',\n    description: 'Portfolio exploration only',\n    color: 'gray',\n  },\n};\n\n/**\n * Generate a description of what tools are available at each access level\n */\nexport function describeAccessLevel(accessLevel: AccessLevel): string {\n  const info = ACCESS_LEVEL_INFO[accessLevel];\n  const categories = getCategoriesForAccessLevel(accessLevel);\n  const toolCount = getToolsForAccessLevel(accessLevel).length;\n\n  const categoryNames = categories.map((c) => c.name).join(', ');\n\n  return `${info.name}: ${info.description}. ${toolCount} tools across ${categories.length} categories (${categoryNames}).`;\n}\n"],"names":[],"mappings":"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"}