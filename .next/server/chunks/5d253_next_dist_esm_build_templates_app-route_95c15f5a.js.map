{"version":3,"sources":["../../../src/app/api/webhooks/discovery/route.ts","../../../src/lib/claw-ai/discovery-orchestrator.ts","../../../src/lib/claw-ai/transcript-processor.ts","../../../node_modules/.pnpm/next%4016.1.2_%40babel%2Bcore%407.29.0_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.3_react%4019.2.3__react%4019.2.3/node_modules/next/dist/esm/build/templates/app-route.js","../../../src/lib/claw-ai/artifact-generator.ts"],"sourcesContent":["/**\n * Discovery Call Webhook Handler\n *\n * Called by deepclaw when a discovery call ends.\n * Triggers the processing pipeline: transcript â†’ insights â†’ artifacts â†’ notification.\n *\n * @see GitHub Issue #751\n * @see src/lib/claw-ai/discovery-orchestrator.ts\n */\n\nimport { NextResponse } from 'next/server';\nimport { handleCallEndWebhook } from '@/lib/claw-ai/discovery-orchestrator';\nimport type { TranscriptEntry } from '@/lib/claw-ai/discovery-types';\n\nconst WEBHOOK_SECRET = process.env.DISCOVERY_WEBHOOK_SECRET;\n\ninterface DiscoveryWebhookPayload {\n  callerId: string;\n  transcript: TranscriptEntry[];\n  duration: number; // seconds\n  clientName?: string;\n  clientEmail?: string;\n  callSid?: string; // Twilio call SID\n}\n\nexport async function POST(request: Request) {\n  try {\n    // Verify webhook secret\n    const authHeader = request.headers.get('Authorization');\n    if (WEBHOOK_SECRET) {\n      if (!authHeader || authHeader !== `Bearer ${WEBHOOK_SECRET}`) {\n        console.error('[DiscoveryWebhook] Invalid or missing authorization');\n        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n      }\n    }\n\n    const payload: DiscoveryWebhookPayload = await request.json();\n\n    // Validate required fields\n    if (!payload.callerId) {\n      return NextResponse.json(\n        { error: 'Missing required field: callerId' },\n        { status: 400 }\n      );\n    }\n\n    if (!payload.transcript || !Array.isArray(payload.transcript)) {\n      return NextResponse.json(\n        { error: 'Missing or invalid field: transcript' },\n        { status: 400 }\n      );\n    }\n\n    if (typeof payload.duration !== 'number') {\n      return NextResponse.json(\n        { error: 'Missing or invalid field: duration' },\n        { status: 400 }\n      );\n    }\n\n    console.log('[DiscoveryWebhook] Received call end webhook');\n    console.log(`  Caller: ${payload.callerId}`);\n    console.log(`  Duration: ${payload.duration}s`);\n    console.log(`  Transcript entries: ${payload.transcript.length}`);\n\n    // Check minimum transcript length\n    if (payload.transcript.length < 4) {\n      console.log('[DiscoveryWebhook] Transcript too short, skipping processing');\n      return NextResponse.json({\n        success: false,\n        reason: 'Transcript too short for meaningful analysis',\n      });\n    }\n\n    // Get required environment variables\n    const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n    const ownerId = process.env.OWNER_USER_ID || 'system';\n    const baseUrl = process.env.NEXT_PUBLIC_APP_URL || 'https://openclaw.io';\n    const resendApiKey = process.env.RESEND_API_KEY;\n\n    if (!convexUrl) {\n      throw new Error('NEXT_PUBLIC_CONVEX_URL not configured');\n    }\n\n    // Process the call\n    const result = await handleCallEndWebhook(\n      payload.callerId,\n      payload.transcript,\n      payload.duration,\n      {\n        convexUrl,\n        ownerId,\n        baseUrl,\n        resendApiKey,\n      }\n    );\n\n    if (result.success) {\n      console.log('[DiscoveryWebhook] Processing complete');\n      console.log(`  Quality score: ${result.qualityScore}/100`);\n      console.log(`  Artifacts: ${result.artifacts?.ticketIds.length || 0} tickets created`);\n\n      return NextResponse.json({\n        success: true,\n        sessionId: result.sessionId,\n        qualityScore: result.qualityScore,\n        artifacts: {\n          projectId: result.artifacts?.projectId,\n          prdId: result.artifacts?.prdId,\n          epicCount: result.artifacts?.epicIds.length,\n          ticketCount: result.artifacts?.ticketIds.length,\n        },\n      });\n    } else {\n      console.error('[DiscoveryWebhook] Processing failed:', result.error);\n\n      return NextResponse.json({\n        success: false,\n        sessionId: result.sessionId,\n        error: result.error,\n      });\n    }\n  } catch (error) {\n    console.error('[DiscoveryWebhook] Error:', error);\n\n    return NextResponse.json(\n      { error: error instanceof Error ? error.message : 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * Health check endpoint\n */\nexport async function GET() {\n  return NextResponse.json({\n    status: 'ok',\n    service: 'discovery-webhook',\n    version: '1.0.0',\n  });\n}\n","/**\n * Discovery Call Orchestrator\n *\n * Coordinates the end-to-end discovery call pipeline:\n * 1. Call ends â†’ Transcript received\n * 2. Transcript processed â†’ Insights extracted\n * 3. Insights â†’ BMAD artifacts generated\n * 4. Notification sent to client\n *\n * @see GitHub Issue #751\n * @see docs/planning/discovery-call-agent-architecture.md\n */\n\n// import { ConvexHttpClient } from 'convex/browser';\n// import { api } from '@/lib/convex-shim';\n// import type { Id } from '../../../convex/_generated/dataModel';\nimport { ConvexHttpClient, api, Id } from '../convex-shim';\nimport type {\n  DiscoveryInsights,\n  TranscriptEntry,\n  GeneratedArtifacts,\n  DiscoveryNotificationContext,\n} from './discovery-types';\nimport { processTranscript, calculateDiscoveryQuality, generateInsightsSummary } from './transcript-processor';\nimport { generateArtifacts, generateArtifactsSummary } from './artifact-generator';\n\n/**\n * Configuration for the discovery orchestrator\n */\nexport interface DiscoveryOrchestratorConfig {\n  convexUrl: string;\n  ownerId: string;\n  baseUrl: string; // Base URL for PRD links (e.g., https://openclaw.io)\n  resendApiKey?: string; // For email notifications\n}\n\n/**\n * Result of processing a completed discovery call\n */\nexport interface DiscoveryProcessingResult {\n  success: boolean;\n  sessionId: Id<'discoveryCallSessions'>;\n  insights?: DiscoveryInsights;\n  artifacts?: GeneratedArtifacts;\n  qualityScore?: number;\n  error?: string;\n}\n\n/**\n * Process a completed discovery call\n *\n * This is the main entry point called when a call ends.\n * It orchestrates the full pipeline from transcript to notification.\n *\n * @param sessionId - The discovery call session ID\n * @param config - Orchestrator configuration\n * @returns Processing result with generated artifacts\n */\nexport async function processCompletedCall(\n  sessionId: Id<'discoveryCallSessions'>,\n  config: DiscoveryOrchestratorConfig\n): Promise<DiscoveryProcessingResult> {\n  const client = new ConvexHttpClient(config.convexUrl);\n\n  try {\n    // 1. Fetch the session\n    const session = await client.query(api.discovery.getSession, { sessionId });\n    if (!session) {\n      throw new Error(`Session ${sessionId} not found`);\n    }\n\n    console.log(`[DiscoveryOrchestrator] Processing session ${sessionId}`);\n    console.log(`[DiscoveryOrchestrator] Transcript length: ${session.transcript.length} entries`);\n    console.log(`[DiscoveryOrchestrator] Duration: ${session.duration || 0} seconds`);\n\n    // 2. Process transcript to extract insights\n    console.log('[DiscoveryOrchestrator] Starting transcript processing...');\n    const insights = await processTranscript(\n      session.transcript as TranscriptEntry[],\n      session.duration || 0\n    );\n\n    // 3. Calculate quality score\n    const quality = calculateDiscoveryQuality(insights);\n    console.log(`[DiscoveryOrchestrator] Quality score: ${quality.score}/100`);\n\n    if (quality.recommendations.length > 0) {\n      console.log('[DiscoveryOrchestrator] Recommendations:', quality.recommendations);\n    }\n\n    // 4. Store insights in session\n    await client.mutation(api.discovery.storeInsights, {\n      sessionId,\n      insights: JSON.stringify(insights),\n    });\n\n    // 5. Generate BMAD artifacts\n    console.log('[DiscoveryOrchestrator] Generating BMAD artifacts...');\n    const artifacts = await generateArtifacts(insights, {\n      convexUrl: config.convexUrl,\n      ownerId: config.ownerId,\n    });\n\n    console.log(`[DiscoveryOrchestrator] Created:`);\n    console.log(`  - 1 ProductProject`);\n    console.log(`  - 1 PRD`);\n    console.log(`  - ${artifacts.epicIds.length} Epics`);\n    console.log(`  - ${artifacts.ticketIds.length} Tickets`);\n\n    // 6. Store artifact references in session\n    await client.mutation(api.discovery.storeArtifacts, {\n      sessionId,\n      artifacts: {\n        projectId: artifacts.projectId,\n        prdId: artifacts.prdId,\n        epicIds: artifacts.epicIds,\n        ticketIds: artifacts.ticketIds,\n      },\n    });\n\n    // 7. Send notification if client email is available\n    if (session.clientEmail && config.resendApiKey) {\n      console.log('[DiscoveryOrchestrator] Sending notification email...');\n      await sendNotificationEmail(\n        session,\n        insights,\n        artifacts,\n        config\n      );\n\n      await client.mutation(api.discovery.markNotificationSent, { sessionId });\n    } else {\n      console.log('[DiscoveryOrchestrator] Skipping email (no client email or Resend key)');\n    }\n\n    // 8. Log summary\n    const summary = generateArtifactsSummary(insights, artifacts);\n    console.log('[DiscoveryOrchestrator] Processing complete!');\n    console.log(summary);\n\n    return {\n      success: true,\n      sessionId,\n      insights,\n      artifacts,\n      qualityScore: quality.score,\n    };\n  } catch (error) {\n    const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n    console.error('[DiscoveryOrchestrator] Processing failed:', errorMessage);\n\n    // Mark session as error\n    await client.mutation(api.discovery.markError, {\n      sessionId,\n      error: errorMessage,\n    });\n\n    return {\n      success: false,\n      sessionId,\n      error: errorMessage,\n    };\n  }\n}\n\n/**\n * Send notification email to the client\n */\nasync function sendNotificationEmail(\n  session: {\n    clientName?: string;\n    clientEmail?: string;\n    duration?: number;\n  },\n  insights: DiscoveryInsights,\n  artifacts: GeneratedArtifacts,\n  config: DiscoveryOrchestratorConfig\n): Promise<void> {\n  if (!session.clientEmail) {\n    throw new Error('No client email available');\n  }\n\n  if (!config.resendApiKey) {\n    throw new Error('Resend API key not configured');\n  }\n\n  const context: DiscoveryNotificationContext = {\n    clientName: session.clientName || 'there',\n    clientEmail: session.clientEmail,\n    projectName: insights.projectName || 'Your Project',\n    problemSummary: insights.problemStatement.slice(0, 200) + '...',\n    usersSummary: insights.targetUsers.map((u) => u.persona).join(', '),\n    featuresSummary: insights.requestedFeatures\n      .filter((f) => f.priority === 'must')\n      .map((f) => f.name)\n      .join(', '),\n    prdLink: `${config.baseUrl}/projects/${artifacts.projectId}/prd/${artifacts.prdId}`,\n    callDuration: formatDuration(session.duration || 0),\n  };\n\n  const emailHtml = generateEmailHtml(context);\n\n  // Send via Resend\n  const response = await fetch('https://api.resend.com/emails', {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${config.resendApiKey}`,\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      from: 'James <james@openclaw.io>',\n      to: session.clientEmail,\n      subject: `Your Project Brief is Ready - ${context.projectName}`,\n      html: emailHtml,\n    }),\n  });\n\n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`Failed to send email: ${errorText}`);\n  }\n\n  console.log(`[DiscoveryOrchestrator] Email sent to ${session.clientEmail}`);\n}\n\n/**\n * Generate HTML email content\n */\nfunction generateEmailHtml(context: DiscoveryNotificationContext): string {\n  return `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Your Project Brief is Ready</title>\n</head>\n<body style=\"margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background-color: #f4f4f5;\">\n  <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" style=\"background-color: #f4f4f5;\">\n    <tr>\n      <td align=\"center\" style=\"padding: 40px 20px;\">\n        <table role=\"presentation\" width=\"600\" cellspacing=\"0\" cellpadding=\"0\" style=\"background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\">\n          <!-- Header -->\n          <tr>\n            <td style=\"background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); padding: 32px 40px;\">\n              <h1 style=\"margin: 0; color: #ffffff; font-size: 24px; font-weight: 600;\">\n                Hey ${context.clientName}! ðŸ‘‹\n              </h1>\n              <p style=\"margin: 8px 0 0 0; color: rgba(255, 255, 255, 0.9); font-size: 16px;\">\n                Your project brief from our call is ready.\n              </p>\n            </td>\n          </tr>\n\n          <!-- Body -->\n          <tr>\n            <td style=\"padding: 40px;\">\n              <p style=\"margin: 0 0 24px 0; color: #374151; font-size: 16px; line-height: 1.6;\">\n                Thanks for taking the time to chat with me. I've put together a comprehensive brief based on our ${context.callDuration} conversation.\n              </p>\n\n              <!-- Summary Card -->\n              <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" style=\"background-color: #f9fafb; border-radius: 8px; margin-bottom: 24px;\">\n                <tr>\n                  <td style=\"padding: 24px;\">\n                    <h2 style=\"margin: 0 0 16px 0; color: #111827; font-size: 18px; font-weight: 600;\">\n                      ${context.projectName}\n                    </h2>\n\n                    <p style=\"margin: 0 0 16px 0; color: #4b5563; font-size: 14px; line-height: 1.5;\">\n                      <strong>The Problem:</strong> ${context.problemSummary}\n                    </p>\n\n                    <p style=\"margin: 0 0 16px 0; color: #4b5563; font-size: 14px; line-height: 1.5;\">\n                      <strong>Target Users:</strong> ${context.usersSummary}\n                    </p>\n\n                    <p style=\"margin: 0; color: #4b5563; font-size: 14px; line-height: 1.5;\">\n                      <strong>Key Features:</strong> ${context.featuresSummary}\n                    </p>\n                  </td>\n                </tr>\n              </table>\n\n              <!-- CTA Button -->\n              <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\">\n                <tr>\n                  <td align=\"center\" style=\"padding: 16px 0;\">\n                    <a href=\"${context.prdLink}\" style=\"display: inline-block; background-color: #3b82f6; color: #ffffff; text-decoration: none; font-size: 16px; font-weight: 600; padding: 14px 32px; border-radius: 8px;\">\n                      View Full Brief â†’\n                    </a>\n                  </td>\n                </tr>\n              </table>\n\n              <p style=\"margin: 24px 0 0 0; color: #6b7280; font-size: 14px; line-height: 1.6;\">\n                The brief includes detailed user personas, prioritized features, and acceptance criteria. If anything looks off or you want to dig deeper into any area, just reply to this email.\n              </p>\n\n              <p style=\"margin: 24px 0 0 0; color: #374151; font-size: 16px; line-height: 1.6;\">\n                Talk soon,<br>\n                <strong>James</strong>\n              </p>\n            </td>\n          </tr>\n\n          <!-- Footer -->\n          <tr>\n            <td style=\"background-color: #f9fafb; padding: 24px 40px; border-top: 1px solid #e5e7eb;\">\n              <p style=\"margin: 0; color: #9ca3af; font-size: 12px; text-align: center;\">\n                This brief was generated from our discovery call using AI-assisted analysis.\n                <br>\n                OpenClaw-OS â€¢ Creative Technologist â€¢ San Francisco\n              </p>\n            </td>\n          </tr>\n        </table>\n      </td>\n    </tr>\n  </table>\n</body>\n</html>\n`;\n}\n\n/**\n * Format duration in human-readable format\n */\nfunction formatDuration(seconds: number): string {\n  const minutes = Math.floor(seconds / 60);\n  if (minutes < 1) return 'brief';\n  if (minutes === 1) return '1 minute';\n  return `${minutes} minute`;\n}\n\n/**\n * Webhook handler for when a discovery call ends\n * This would be called by deepclaw when the Twilio call disconnects\n */\nexport async function handleCallEndWebhook(\n  callerId: string,\n  transcript: TranscriptEntry[],\n  duration: number,\n  config: DiscoveryOrchestratorConfig\n): Promise<DiscoveryProcessingResult> {\n  const client = new ConvexHttpClient(config.convexUrl);\n\n  // Find the active session for this caller\n  const session = await client.query(api.discovery.getSessionByCallerId, { callerId });\n  if (!session) {\n    throw new Error(`No active session found for caller ${callerId}`);\n  }\n\n  // Update the session with the full transcript and duration\n  await client.mutation(api.discovery.updateTranscript, {\n    sessionId: session._id,\n    transcript,\n    duration,\n  });\n\n  // Process the completed call\n  return processCompletedCall(session._id, config);\n}\n\nexport default processCompletedCall;\n","/**\n * Discovery Call Transcript Processor\n *\n * Analyzes discovery call transcripts using Claude to extract\n * structured insights for PRD/Epic/Story generation.\n *\n * @see GitHub Issue #749\n * @see docs/planning/discovery-call-agent-architecture.md\n */\n\nimport Anthropic from '@anthropic-ai/sdk';\nimport type { DiscoveryInsights, TranscriptEntry } from './discovery-types';\n\nconst anthropic = new Anthropic();\n\n/**\n * System prompt for transcript analysis\n * Instructs Claude to extract structured insights from discovery call transcripts\n */\nconst TRANSCRIPT_ANALYSIS_PROMPT = `You are an expert product analyst reviewing a discovery call transcript between James (a creative technologist) and a potential client.\n\nYour task is to extract structured insights from this conversation that will be used to generate:\n1. A Product Requirements Document (PRD)\n2. Epics for the project backlog\n3. User stories with acceptance criteria\n\n## Extraction Guidelines\n\n### Problem Understanding\n- Identify the core problem being discussed\n- Rate its severity based on how the client describes impact\n- Look for root causes mentioned, not just symptoms\n- Note any \"aha moments\" where the real problem emerged\n\n### User Analysis\n- Identify distinct user personas mentioned\n- Capture their specific needs and pain points\n- Note how they currently solve the problem\n- Look for Jobs to be Done patterns (what are they trying to accomplish?)\n\n### Feature Discovery\n- List all features/capabilities mentioned\n- Classify priority using MoSCoW (Must/Should/Could/Won't)\n- Extract user stories in \"As a [user] I want [capability] so that [benefit]\" format\n- Note any acceptance criteria mentioned\n\n### Constraints\n- Timeline pressures\n- Budget indicators\n- Technical requirements or preferences\n- Integration needs\n- Compliance/regulatory requirements\n\n### Stakeholders\n- Who else cares about this project?\n- Who makes the budget decision?\n- Who will be affected by the solution?\n\n### Client Quotes\n- Capture verbatim quotes that reveal key insights\n- These add authenticity to the PRD\n- Tag each quote with what it reveals (problem, user, solution, constraint)\n\n### Confidence Assessment\n- Rate your confidence (0-1) based on how complete the discovery was\n- Note what follow-up questions would help clarify unknowns\n- Suggest areas that need more exploration\n\n## Output Format\n\nReturn a JSON object matching the DiscoveryInsights interface exactly. Be thorough but realistic - if something wasn't discussed, don't invent it. Mark fields as undefined if not covered.`;\n\n/**\n * Process a discovery call transcript and extract structured insights\n *\n * @param transcript - Array of transcript entries from the call\n * @param callDuration - Duration of the call in seconds\n * @returns Structured insights for PRD generation\n */\nexport async function processTranscript(\n  transcript: TranscriptEntry[],\n  callDuration: number\n): Promise<DiscoveryInsights> {\n  // Format transcript for analysis\n  const formattedTranscript = transcript\n    .map((entry) => {\n      const speaker = entry.role === 'assistant' ? 'James' : 'Client';\n      return `[${speaker}]: ${entry.content}`;\n    })\n    .join('\\n\\n');\n\n  const response = await anthropic.messages.create({\n    model: 'claude-sonnet-4-20250514',\n    max_tokens: 8192,\n    system: TRANSCRIPT_ANALYSIS_PROMPT,\n    messages: [\n      {\n        role: 'user',\n        content: `Please analyze this discovery call transcript and extract structured insights.\n\n## Call Information\n- Duration: ${Math.floor(callDuration / 60)} minutes ${callDuration % 60} seconds\n- Total exchanges: ${transcript.length}\n\n## Transcript\n\n${formattedTranscript}\n\n## Instructions\n\nExtract insights following the guidelines. Return ONLY valid JSON matching this TypeScript interface:\n\n\\`\\`\\`typescript\ninterface DiscoveryInsights {\n  problemStatement: string;\n  problemSeverity: 'critical' | 'significant' | 'moderate' | 'nice-to-have';\n  rootCause?: string;\n\n  targetUsers: Array<{\n    persona: string;\n    description: string;\n    needs: string[];\n    painPoints: string[];\n    currentSolution?: string;\n  }>;\n\n  desiredOutcomes: Array<{\n    outcome: string;\n    metric?: string;\n    priority: 'must' | 'should' | 'could';\n  }>;\n\n  requestedFeatures: Array<{\n    name: string;\n    description: string;\n    priority: 'must' | 'should' | 'could' | 'wont';\n    userStory?: string;\n    acceptanceCriteria?: string[];\n  }>;\n\n  constraints: {\n    timeline?: string;\n    budget?: string;\n    techStack?: string[];\n    integrations?: string[];\n    compliance?: string[];\n    teamSize?: string;\n    existingSystems?: string[];\n  };\n\n  stakeholders: Array<{\n    role: string;\n    interest: string;\n    influence: 'high' | 'medium' | 'low';\n  }>;\n\n  risksAndUnknowns: Array<{\n    item: string;\n    severity: 'high' | 'medium' | 'low';\n    mitigation?: string;\n  }>;\n\n  clientQuotes: Array<{\n    quote: string;\n    context: string;\n    relevance: 'problem' | 'user' | 'solution' | 'constraint';\n  }>;\n\n  projectName?: string;\n  callDuration: number;\n  confidenceScore: number;\n  suggestedFollowUps: string[];\n}\n\\`\\`\\`\n\nReturn ONLY the JSON object, no markdown code blocks or explanation.`,\n      },\n    ],\n  });\n\n  // Extract JSON from response\n  const content = response.content[0];\n  if (content.type !== 'text') {\n    throw new Error('Unexpected response type from Claude');\n  }\n\n  let jsonText = content.text.trim();\n\n  // Handle potential markdown code block wrapping\n  if (jsonText.startsWith('```json')) {\n    jsonText = jsonText.slice(7);\n  } else if (jsonText.startsWith('```')) {\n    jsonText = jsonText.slice(3);\n  }\n  if (jsonText.endsWith('```')) {\n    jsonText = jsonText.slice(0, -3);\n  }\n  jsonText = jsonText.trim();\n\n  try {\n    const insights = JSON.parse(jsonText) as DiscoveryInsights;\n\n    // Ensure callDuration is set correctly\n    insights.callDuration = callDuration;\n\n    // Validate required fields\n    validateInsights(insights);\n\n    return insights;\n  } catch (error) {\n    console.error('[TranscriptProcessor] Failed to parse insights JSON:', error);\n    console.error('[TranscriptProcessor] Raw response:', content.text);\n    throw new Error(`Failed to parse transcript insights: ${error instanceof Error ? error.message : 'Unknown error'}`);\n  }\n}\n\n/**\n * Validate that extracted insights have required fields\n */\nfunction validateInsights(insights: DiscoveryInsights): void {\n  if (!insights.problemStatement) {\n    throw new Error('Missing required field: problemStatement');\n  }\n\n  if (!insights.problemSeverity) {\n    throw new Error('Missing required field: problemSeverity');\n  }\n\n  if (!Array.isArray(insights.targetUsers) || insights.targetUsers.length === 0) {\n    throw new Error('Missing or empty required field: targetUsers');\n  }\n\n  if (!Array.isArray(insights.desiredOutcomes)) {\n    insights.desiredOutcomes = [];\n  }\n\n  if (!Array.isArray(insights.requestedFeatures)) {\n    insights.requestedFeatures = [];\n  }\n\n  if (!insights.constraints) {\n    insights.constraints = {};\n  }\n\n  if (!Array.isArray(insights.stakeholders)) {\n    insights.stakeholders = [];\n  }\n\n  if (!Array.isArray(insights.risksAndUnknowns)) {\n    insights.risksAndUnknowns = [];\n  }\n\n  if (!Array.isArray(insights.clientQuotes)) {\n    insights.clientQuotes = [];\n  }\n\n  if (typeof insights.confidenceScore !== 'number') {\n    insights.confidenceScore = 0.5;\n  }\n\n  if (!Array.isArray(insights.suggestedFollowUps)) {\n    insights.suggestedFollowUps = [];\n  }\n}\n\n/**\n * Calculate a quality score for the discovery call\n * Based on topics covered and depth of conversation\n */\nexport function calculateDiscoveryQuality(insights: DiscoveryInsights): {\n  score: number;\n  breakdown: Record<string, number>;\n  recommendations: string[];\n} {\n  const breakdown: Record<string, number> = {};\n  const recommendations: string[] = [];\n\n  // Problem clarity (0-20 points)\n  breakdown.problem = insights.problemStatement.length > 50 ? 20 : 10;\n  if (insights.rootCause) breakdown.problem += 5;\n  if (breakdown.problem < 20) {\n    recommendations.push('Dig deeper into the root cause of the problem');\n  }\n\n  // User understanding (0-20 points)\n  breakdown.users = Math.min(insights.targetUsers.length * 10, 20);\n  if (breakdown.users < 20) {\n    recommendations.push('Identify more distinct user personas');\n  }\n\n  // Feature clarity (0-20 points)\n  const mustHaves = insights.requestedFeatures.filter((f) => f.priority === 'must').length;\n  breakdown.features = Math.min(mustHaves * 5, 20);\n  if (breakdown.features < 15) {\n    recommendations.push('Clarify must-have features for MVP');\n  }\n\n  // Constraints captured (0-15 points)\n  const constraintCount = Object.values(insights.constraints).filter(Boolean).length;\n  breakdown.constraints = Math.min(constraintCount * 3, 15);\n  if (!insights.constraints.timeline) {\n    recommendations.push('Establish timeline expectations');\n  }\n\n  // Stakeholder mapping (0-10 points)\n  breakdown.stakeholders = Math.min(insights.stakeholders.length * 3, 10);\n  if (breakdown.stakeholders < 6) {\n    recommendations.push('Identify decision makers and influencers');\n  }\n\n  // Client quotes captured (0-10 points)\n  breakdown.quotes = Math.min(insights.clientQuotes.length * 2, 10);\n  if (breakdown.quotes < 6) {\n    recommendations.push('Capture more verbatim client quotes for the PRD');\n  }\n\n  // Risks identified (0-5 points)\n  breakdown.risks = Math.min(insights.risksAndUnknowns.length * 2, 5);\n\n  const score = Object.values(breakdown).reduce((sum, val) => sum + val, 0);\n\n  return {\n    score,\n    breakdown,\n    recommendations: score < 70 ? recommendations : [],\n  };\n}\n\n/**\n * Generate a summary suitable for quick review\n */\nexport function generateInsightsSummary(insights: DiscoveryInsights): string {\n  const mustHaveFeatures = insights.requestedFeatures\n    .filter((f) => f.priority === 'must')\n    .map((f) => f.name)\n    .join(', ');\n\n  const topUsers = insights.targetUsers\n    .slice(0, 3)\n    .map((u) => u.persona)\n    .join(', ');\n\n  return `## Discovery Call Summary\n\n**Project:** ${insights.projectName || 'Unnamed Project'}\n**Duration:** ${Math.floor(insights.callDuration / 60)} minutes\n**Confidence:** ${Math.round(insights.confidenceScore * 100)}%\n\n### Problem\n${insights.problemStatement}\n**Severity:** ${insights.problemSeverity}\n\n### Target Users\n${topUsers}\n\n### Must-Have Features\n${mustHaveFeatures || 'None explicitly identified'}\n\n### Key Constraints\n${insights.constraints.timeline ? `- Timeline: ${insights.constraints.timeline}` : ''}\n${insights.constraints.budget ? `- Budget: ${insights.constraints.budget}` : ''}\n${insights.constraints.techStack?.length ? `- Tech: ${insights.constraints.techStack.join(', ')}` : ''}\n\n### Follow-up Needed\n${insights.suggestedFollowUps.slice(0, 3).map((f) => `- ${f}`).join('\\n')}\n`;\n}\n\nexport default processTranscript;\n","import { AppRouteRouteModule } from \"next/dist/esm/server/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/esm/server/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/esm/server/lib/patch-fetch\";\nimport { addRequestMeta, getRequestMeta } from \"next/dist/esm/server/request-meta\";\nimport { getTracer, SpanKind } from \"next/dist/esm/server/lib/trace/tracer\";\nimport { setManifestsSingleton } from \"next/dist/esm/server/app-render/manifests-singleton\";\nimport { normalizeAppPath } from \"next/dist/esm/shared/lib/router/utils/app-paths\";\nimport { NodeNextRequest, NodeNextResponse } from \"next/dist/esm/server/base-http/node\";\nimport { NextRequestAdapter, signalFromNodeResponse } from \"next/dist/esm/server/web/spec-extension/adapters/next-request\";\nimport { BaseServerSpan } from \"next/dist/esm/server/lib/trace/constants\";\nimport { getRevalidateReason } from \"next/dist/esm/server/instrumentation/utils\";\nimport { sendResponse } from \"next/dist/esm/server/send-response\";\nimport { fromNodeOutgoingHttpHeaders, toNodeOutgoingHttpHeaders } from \"next/dist/esm/server/web/utils\";\nimport { getCacheControlHeader } from \"next/dist/esm/server/lib/cache-control\";\nimport { INFINITE_CACHE, NEXT_CACHE_TAGS_HEADER } from \"next/dist/esm/lib/constants\";\nimport { NoFallbackError } from \"next/dist/esm/shared/lib/no-fallback-error.external\";\nimport { CachedRouteKind } from \"next/dist/esm/server/response-cache\";\nimport * as userland from \"INNER_APP_ROUTE\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/webhooks/discovery/route\",\n        pathname: \"/api/webhooks/discovery\",\n        filename: \"route\",\n        bundlePath: \"\"\n    },\n    distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n    relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n    resolvedPagePath: \"[project]/src/app/api/webhooks/discovery/route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return _patchFetch({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\nexport { routeModule, workAsyncStorage, workUnitAsyncStorage, serverHooks, patchFetch,  };\nexport async function handler(req, res, ctx) {\n    if (routeModule.isDev) {\n        addRequestMeta(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint());\n    }\n    let srcPage = \"/api/webhooks/discovery/route\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (process.env.TURBOPACK) {\n        srcPage = srcPage.replace(/\\/index$/, '') || '/';\n    } else if (srcPage === '/index') {\n        // we always normalize /index specifically\n        srcPage = '/';\n    }\n    const multiZoneDraftMode = process.env.__NEXT_MULTI_ZONE_DRAFT_MODE;\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage,\n        multiZoneDraftMode\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return null;\n    }\n    const { buildId, params, nextConfig, parsedUrl, isDraftMode, prerenderManifest, routerServerContext, isOnDemandRevalidate, revalidateOnlyGenerated, resolvedPathname, clientReferenceManifest, serverActionsManifest } = prepareResult;\n    const normalizedSrcPage = normalizeAppPath(srcPage);\n    let isIsr = Boolean(prerenderManifest.dynamicRoutes[normalizedSrcPage] || prerenderManifest.routes[resolvedPathname]);\n    const render404 = async ()=>{\n        // TODO: should route-module itself handle rendering the 404\n        if (routerServerContext == null ? void 0 : routerServerContext.render404) {\n            await routerServerContext.render404(req, res, parsedUrl, false);\n        } else {\n            res.end('This page could not be found');\n        }\n        return null;\n    };\n    if (isIsr && !isDraftMode) {\n        const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname]);\n        const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage];\n        if (prerenderInfo) {\n            if (prerenderInfo.fallback === false && !isPrerendered) {\n                if (nextConfig.experimental.adapterPath) {\n                    return await render404();\n                }\n                throw new NoFallbackError();\n            }\n        }\n    }\n    let cacheKey = null;\n    if (isIsr && !routeModule.isDev && !isDraftMode) {\n        cacheKey = resolvedPathname;\n        // ensure /index and / is normalized to one key\n        cacheKey = cacheKey === '/index' ? '/' : cacheKey;\n    }\n    const supportsDynamicResponse = // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true || // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr;\n    // This is a revalidation request if the request is for a static\n    // page and it is not being resumed from a postponed render and\n    // it is not a dynamic RSC request then it is a revalidation\n    // request.\n    const isStaticGeneration = isIsr && !supportsDynamicResponse;\n    // Before rendering (which initializes component tree modules), we have to\n    // set the reference manifests to our global store so Server Action's\n    // encryption util can access to them at the top level of the page module.\n    if (serverActionsManifest && clientReferenceManifest) {\n        setManifestsSingleton({\n            page: srcPage,\n            clientReferenceManifest,\n            serverActionsManifest\n        });\n    }\n    const method = req.method || 'GET';\n    const tracer = getTracer();\n    const activeSpan = tracer.getActiveScopeSpan();\n    const context = {\n        params,\n        prerenderManifest,\n        renderOpts: {\n            experimental: {\n                authInterrupts: Boolean(nextConfig.experimental.authInterrupts)\n            },\n            cacheComponents: Boolean(nextConfig.cacheComponents),\n            supportsDynamicResponse,\n            incrementalCache: getRequestMeta(req, 'incrementalCache'),\n            cacheLifeProfiles: nextConfig.cacheLife,\n            waitUntil: ctx.waitUntil,\n            onClose: (cb)=>{\n                res.on('close', cb);\n            },\n            onAfterTaskError: undefined,\n            onInstrumentationRequestError: (error, _request, errorContext, silenceLog)=>routeModule.onRequestError(req, error, errorContext, silenceLog, routerServerContext)\n        },\n        sharedContext: {\n            buildId\n        }\n    };\n    const nodeNextReq = new NodeNextRequest(req);\n    const nodeNextRes = new NodeNextResponse(res);\n    const nextReq = NextRequestAdapter.fromNodeNextRequest(nodeNextReq, signalFromNodeResponse(res));\n    try {\n        const invokeRouteModule = async (span)=>{\n            return routeModule.handle(nextReq, context).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${srcPage}`);\n                }\n            });\n        };\n        const isMinimalMode = Boolean(process.env.MINIMAL_MODE || getRequestMeta(req, 'minimalMode'));\n        const handleResponse = async (currentSpan)=>{\n            var _cacheEntry_value;\n            const responseGenerator = async ({ previousCacheEntry })=>{\n                try {\n                    if (!isMinimalMode && isOnDemandRevalidate && revalidateOnlyGenerated && !previousCacheEntry) {\n                        res.statusCode = 404;\n                        // on-demand revalidate always sets this header\n                        res.setHeader('x-nextjs-cache', 'REVALIDATED');\n                        res.end('This page could not be found');\n                        return null;\n                    }\n                    const response = await invokeRouteModule(currentSpan);\n                    req.fetchMetrics = context.renderOpts.fetchMetrics;\n                    let pendingWaitUntil = context.renderOpts.pendingWaitUntil;\n                    // Attempt using provided waitUntil if available\n                    // if it's not we fallback to sendResponse's handling\n                    if (pendingWaitUntil) {\n                        if (ctx.waitUntil) {\n                            ctx.waitUntil(pendingWaitUntil);\n                            pendingWaitUntil = undefined;\n                        }\n                    }\n                    const cacheTags = context.renderOpts.collectedTags;\n                    // If the request is for a static response, we can cache it so long\n                    // as it's not edge.\n                    if (isIsr) {\n                        const blob = await response.blob();\n                        // Copy the headers from the response.\n                        const headers = toNodeOutgoingHttpHeaders(response.headers);\n                        if (cacheTags) {\n                            headers[NEXT_CACHE_TAGS_HEADER] = cacheTags;\n                        }\n                        if (!headers['content-type'] && blob.type) {\n                            headers['content-type'] = blob.type;\n                        }\n                        const revalidate = typeof context.renderOpts.collectedRevalidate === 'undefined' || context.renderOpts.collectedRevalidate >= INFINITE_CACHE ? false : context.renderOpts.collectedRevalidate;\n                        const expire = typeof context.renderOpts.collectedExpire === 'undefined' || context.renderOpts.collectedExpire >= INFINITE_CACHE ? undefined : context.renderOpts.collectedExpire;\n                        // Create the cache entry for the response.\n                        const cacheEntry = {\n                            value: {\n                                kind: CachedRouteKind.APP_ROUTE,\n                                status: response.status,\n                                body: Buffer.from(await blob.arrayBuffer()),\n                                headers\n                            },\n                            cacheControl: {\n                                revalidate,\n                                expire\n                            }\n                        };\n                        return cacheEntry;\n                    } else {\n                        // send response without caching if not ISR\n                        await sendResponse(nodeNextReq, nodeNextRes, response, context.renderOpts.pendingWaitUntil);\n                        return null;\n                    }\n                } catch (err) {\n                    // if this is a background revalidate we need to report\n                    // the request error here as it won't be bubbled\n                    if (previousCacheEntry == null ? void 0 : previousCacheEntry.isStale) {\n                        const silenceLog = false;\n                        await routeModule.onRequestError(req, err, {\n                            routerKind: 'App Router',\n                            routePath: srcPage,\n                            routeType: 'route',\n                            revalidateReason: getRevalidateReason({\n                                isStaticGeneration,\n                                isOnDemandRevalidate\n                            })\n                        }, silenceLog, routerServerContext);\n                    }\n                    throw err;\n                }\n            };\n            const cacheEntry = await routeModule.handleResponse({\n                req,\n                nextConfig,\n                cacheKey,\n                routeKind: RouteKind.APP_ROUTE,\n                isFallback: false,\n                prerenderManifest,\n                isRoutePPREnabled: false,\n                isOnDemandRevalidate,\n                revalidateOnlyGenerated,\n                responseGenerator,\n                waitUntil: ctx.waitUntil,\n                isMinimalMode\n            });\n            // we don't create a cacheEntry for ISR\n            if (!isIsr) {\n                return null;\n            }\n            if ((cacheEntry == null ? void 0 : (_cacheEntry_value = cacheEntry.value) == null ? void 0 : _cacheEntry_value.kind) !== CachedRouteKind.APP_ROUTE) {\n                var _cacheEntry_value1;\n                throw Object.defineProperty(new Error(`Invariant: app-route received invalid cache entry ${cacheEntry == null ? void 0 : (_cacheEntry_value1 = cacheEntry.value) == null ? void 0 : _cacheEntry_value1.kind}`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E701\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n            if (!isMinimalMode) {\n                res.setHeader('x-nextjs-cache', isOnDemandRevalidate ? 'REVALIDATED' : cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT');\n            }\n            // Draft mode should never be cached\n            if (isDraftMode) {\n                res.setHeader('Cache-Control', 'private, no-cache, no-store, max-age=0, must-revalidate');\n            }\n            const headers = fromNodeOutgoingHttpHeaders(cacheEntry.value.headers);\n            if (!(isMinimalMode && isIsr)) {\n                headers.delete(NEXT_CACHE_TAGS_HEADER);\n            }\n            // If cache control is already set on the response we don't\n            // override it to allow users to customize it via next.config\n            if (cacheEntry.cacheControl && !res.getHeader('Cache-Control') && !headers.get('Cache-Control')) {\n                headers.set('Cache-Control', getCacheControlHeader(cacheEntry.cacheControl));\n            }\n            await sendResponse(nodeNextReq, nodeNextRes, // @ts-expect-error - Argument of type 'Buffer<ArrayBufferLike>' is not assignable to parameter of type 'BodyInit | null | undefined'.\n            new Response(cacheEntry.value.body, {\n                headers,\n                status: cacheEntry.value.status || 200\n            }));\n            return null;\n        };\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await handleResponse(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${srcPage}`,\n                    kind: SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, handleResponse));\n        }\n    } catch (err) {\n        if (!(err instanceof NoFallbackError)) {\n            const silenceLog = false;\n            await routeModule.onRequestError(req, err, {\n                routerKind: 'App Router',\n                routePath: normalizedSrcPage,\n                routeType: 'route',\n                revalidateReason: getRevalidateReason({\n                    isStaticGeneration,\n                    isOnDemandRevalidate\n                })\n            }, silenceLog, routerServerContext);\n        }\n        // rethrow so that we can handle serving error page\n        // If this is during static generation, throw the error again.\n        if (isIsr) throw err;\n        // Otherwise, send a 500 response.\n        await sendResponse(nodeNextReq, nodeNextRes, new Response(null, {\n            status: 500\n        }));\n        return null;\n    }\n}\n\n//# sourceMappingURL=app-route.js.map\n","/**\n * Discovery Call Artifact Generator\n *\n * Transforms structured DiscoveryInsights into BMAD artifacts:\n * - ProductProject (container for the initiative)\n * - PRD (Product Requirements Document)\n * - Epics (grouped feature sets)\n * - Tickets (user stories with acceptance criteria)\n *\n * @see GitHub Issue #750\n * @see docs/planning/discovery-call-agent-architecture.md\n */\n\n// import { ConvexHttpClient } from 'convex/browser';\n// import { api } from '@/lib/convex-shim';\n// import type { Id } from '../../../convex/_generated/dataModel';\nimport { ConvexHttpClient, api, Id } from '../convex-shim';\nimport type { DiscoveryInsights, GeneratedArtifacts } from './discovery-types';\n\n/**\n * Configuration for artifact generation\n */\nexport interface ArtifactGenerationConfig {\n  convexUrl: string;\n  ownerId: string; // Required for project creation\n}\n\n/**\n * Generate all BMAD artifacts from discovery insights\n *\n * @param insights - Structured insights from transcript processing\n * @param config - Generation configuration with Convex URL and owner ID\n * @returns IDs of all generated artifacts\n */\nexport async function generateArtifacts(\n  insights: DiscoveryInsights,\n  config: ArtifactGenerationConfig\n): Promise<GeneratedArtifacts> {\n  const client = new ConvexHttpClient(config.convexUrl);\n\n  // 1. Create the ProductProject\n  const projectId = await createProject(client, insights, config.ownerId);\n\n  // 2. Create the PRD\n  const prdId = await createPRD(client, projectId, insights);\n\n  // 3. Create Epics (grouped by feature priority/category)\n  const epicIds = await createEpics(client, projectId, prdId, insights);\n\n  // 4. Create Tickets (user stories) for each epic\n  const ticketIds = await createTickets(client, projectId, epicIds, insights);\n\n  return {\n    projectId,\n    prdId,\n    epicIds,\n    ticketIds,\n  };\n}\n\n/**\n * Create a ProductProject from discovery insights\n */\nasync function createProject(\n  client: ConvexHttpClient,\n  insights: DiscoveryInsights,\n  ownerId: string\n): Promise<Id<'productProjects'>> {\n  const projectName = insights.projectName || 'Untitled Discovery Project';\n\n  const result = await client.mutation(api.agentic.createProductProject, {\n    name: projectName,\n    description: insights.problemStatement,\n    ownerId,\n  });\n\n  return result.projectId;\n}\n\n/**\n * Create a PRD from discovery insights\n */\nasync function createPRD(\n  client: ConvexHttpClient,\n  projectId: Id<'productProjects'>,\n  insights: DiscoveryInsights\n): Promise<Id<'prds'>> {\n  // Build structured PRD content from insights\n  const executiveSummary = buildExecutiveSummary(insights);\n  const problemStatement = buildProblemStatement(insights);\n\n  const result = await client.mutation(api.agentic.createPRD, {\n    projectId,\n    title: `${insights.projectName || 'Project'} - Product Requirements`,\n    executiveSummary,\n    problemStatement,\n    generatedBy: 'ai',\n    aiModel: 'claude-sonnet-4-20250514',\n  });\n\n  return result.prdId;\n}\n\n/**\n * Create Epics organized by feature category\n */\nasync function createEpics(\n  client: ConvexHttpClient,\n  projectId: Id<'productProjects'>,\n  prdId: Id<'prds'>,\n  insights: DiscoveryInsights\n): Promise<Id<'epics'>[]> {\n  // Group features into logical epics\n  const epicGroups = groupFeaturesIntoEpics(insights);\n  const epicIds: Id<'epics'>[] = [];\n\n  for (const group of epicGroups) {\n    const result = await client.mutation(api.agentic.createEpic, {\n      projectId,\n      prdId,\n      title: group.title,\n      description: group.description,\n      goal: group.goal,\n      linkedFRs: group.linkedFRs,\n    });\n\n    epicIds.push(result.epicId);\n  }\n\n  return epicIds;\n}\n\n/**\n * Create Tickets (user stories) from features\n */\nasync function createTickets(\n  client: ConvexHttpClient,\n  projectId: Id<'productProjects'>,\n  epicIds: Id<'epics'>[],\n  insights: DiscoveryInsights\n): Promise<Id<'tickets'>[]> {\n  const ticketIds: Id<'tickets'>[] = [];\n  const featureGroups = groupFeaturesIntoEpics(insights);\n\n  for (let i = 0; i < featureGroups.length && i < epicIds.length; i++) {\n    const group = featureGroups[i];\n    const epicId = epicIds[i];\n\n    for (const feature of group.features) {\n      // Find the primary user persona for this feature\n      const primaryUser = insights.targetUsers[0]?.persona || 'user';\n\n      // Build user story format\n      const userStory = feature.userStory || `be able to ${feature.name.toLowerCase()}`;\n      const benefit = findBenefitForFeature(feature, insights);\n\n      // Build acceptance criteria in Given/When/Then format\n      const acceptanceCriteria = buildAcceptanceCriteria(feature, insights);\n\n      const result = await client.mutation(api.agentic.createTicket, {\n        projectId,\n        epicId,\n        title: feature.name,\n        description: feature.description,\n        asA: primaryUser,\n        iWant: userStory,\n        soThat: benefit,\n        acceptanceCriteria,\n        type: 'story',\n        priority: mapPriorityToP(feature.priority),\n        status: 'backlog',\n        labels: [feature.priority, 'discovery-generated'],\n        storyPoints: estimateStoryPoints(feature),\n        createdBy: 'ai',\n      });\n\n      ticketIds.push(result._id);\n    }\n  }\n\n  return ticketIds;\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nfunction buildExecutiveSummary(insights: DiscoveryInsights): string {\n  const userCount = insights.targetUsers.length;\n  const featureCount = insights.requestedFeatures.filter((f) => f.priority === 'must').length;\n\n  let summary = `This project addresses ${insights.problemSeverity} pain points for ${userCount} user persona${userCount > 1 ? 's' : ''}.\n\n**Core Problem:** ${insights.problemStatement}\n\n**Key Outcomes:**\n${insights.desiredOutcomes.slice(0, 3).map((o) => `- ${o.outcome}`).join('\\n')}\n\n**MVP Scope:** ${featureCount} must-have features identified during discovery.\n\n**Confidence:** ${Math.round(insights.confidenceScore * 100)}% based on discovery call coverage.`;\n\n  // Add target users section\n  summary += '\\n\\n---\\n\\n## Target Users\\n\\n';\n  summary += insights.targetUsers\n    .map((user) => {\n      let section = `### ${user.persona}\\n\\n${user.description}\\n\\n`;\n      section += `**Needs:**\\n${user.needs.map((n) => `- ${n}`).join('\\n')}\\n\\n`;\n      section += `**Pain Points:**\\n${user.painPoints.map((p) => `- ${p}`).join('\\n')}`;\n      if (user.currentSolution) {\n        section += `\\n\\n**Current Solution:** ${user.currentSolution}`;\n      }\n      return section;\n    })\n    .join('\\n\\n---\\n\\n');\n\n  // Add MVP scope\n  const mustHaves = insights.requestedFeatures.filter((f) => f.priority === 'must');\n  const shouldHaves = insights.requestedFeatures.filter((f) => f.priority === 'should');\n\n  summary += '\\n\\n---\\n\\n## MVP Scope\\n\\n### Must-Have Features\\n\\n';\n  summary += mustHaves.map((f) => `- **${f.name}**: ${f.description}`).join('\\n');\n\n  if (shouldHaves.length > 0) {\n    summary += '\\n\\n### Should-Have Features (Post-MVP)\\n\\n';\n    summary += shouldHaves.map((f) => `- **${f.name}**: ${f.description}`).join('\\n');\n  }\n\n  // Add constraints\n  const c = insights.constraints;\n  const constraintLines: string[] = [];\n  if (c.timeline) constraintLines.push(`**Timeline:** ${c.timeline}`);\n  if (c.budget) constraintLines.push(`**Budget:** ${c.budget}`);\n  if (c.teamSize) constraintLines.push(`**Team:** ${c.teamSize}`);\n  if (c.techStack?.length) constraintLines.push(`**Technology:** ${c.techStack.join(', ')}`);\n  if (c.integrations?.length) constraintLines.push(`**Integrations:** ${c.integrations.join(', ')}`);\n  if (c.compliance?.length) constraintLines.push(`**Compliance:** ${c.compliance.join(', ')}`);\n\n  if (constraintLines.length > 0) {\n    summary += '\\n\\n---\\n\\n## Constraints\\n\\n';\n    summary += constraintLines.join('\\n\\n');\n  }\n\n  // Add risks\n  if (insights.risksAndUnknowns.length > 0) {\n    summary += '\\n\\n---\\n\\n## Risks & Unknowns\\n\\n';\n    summary += insights.risksAndUnknowns\n      .map((r) => {\n        let text = `- **${r.item}** (${r.severity} severity)`;\n        if (r.mitigation) text += `\\n  - Mitigation: ${r.mitigation}`;\n        return text;\n      })\n      .join('\\n');\n  }\n\n  // Add client quotes\n  if (insights.clientQuotes.length > 0) {\n    summary += '\\n\\n---\\n\\n## Client Quotes\\n\\n';\n    summary += insights.clientQuotes\n      .map((q) => `> \"${q.quote}\"\\n> â€” ${q.context}`)\n      .join('\\n\\n');\n  }\n\n  // Add follow-ups\n  if (insights.suggestedFollowUps.length > 0) {\n    summary += '\\n\\n---\\n\\n## Suggested Follow-ups\\n\\n';\n    summary += insights.suggestedFollowUps.map((f) => `- ${f}`).join('\\n');\n  }\n\n  return summary;\n}\n\nfunction buildProblemStatement(insights: DiscoveryInsights): string {\n  let statement = insights.problemStatement;\n\n  if (insights.rootCause) {\n    statement += `\\n\\n**Root Cause:** ${insights.rootCause}`;\n  }\n\n  // Add supporting client quotes\n  const problemQuotes = insights.clientQuotes.filter((q) => q.relevance === 'problem');\n  if (problemQuotes.length > 0) {\n    statement += '\\n\\n**In the client\\'s words:**\\n';\n    statement += problemQuotes.slice(0, 2).map((q) => `> \"${q.quote}\"\\n> â€” ${q.context}`).join('\\n\\n');\n  }\n\n  return statement;\n}\n\ninterface EpicGroup {\n  title: string;\n  description: string;\n  goal: string;\n  linkedFRs: string[];\n  features: DiscoveryInsights['requestedFeatures'];\n}\n\nfunction groupFeaturesIntoEpics(insights: DiscoveryInsights): EpicGroup[] {\n  const mustHaves = insights.requestedFeatures.filter((f) => f.priority === 'must');\n  const shouldHaves = insights.requestedFeatures.filter((f) => f.priority === 'should');\n  const couldHaves = insights.requestedFeatures.filter((f) => f.priority === 'could');\n\n  const epics: EpicGroup[] = [];\n\n  // Epic 1: Core MVP\n  if (mustHaves.length > 0) {\n    epics.push({\n      title: 'Core MVP Features',\n      description: `Essential features required for initial launch. These address the primary problem: ${insights.problemStatement.slice(0, 100)}...`,\n      goal: 'Deliver minimum viable product that solves the core problem',\n      linkedFRs: mustHaves.map((f) => `FR-${f.name.replace(/\\s+/g, '-').toUpperCase()}`),\n      features: mustHaves,\n    });\n  }\n\n  // Epic 2: Enhanced Experience\n  if (shouldHaves.length > 0) {\n    epics.push({\n      title: 'Enhanced Experience',\n      description: 'Features that significantly improve user experience and should be included if timeline permits.',\n      goal: 'Elevate the product beyond MVP to provide a polished experience',\n      linkedFRs: shouldHaves.map((f) => `FR-${f.name.replace(/\\s+/g, '-').toUpperCase()}`),\n      features: shouldHaves,\n    });\n  }\n\n  // Epic 3: Nice-to-Have\n  if (couldHaves.length > 0) {\n    epics.push({\n      title: 'Nice-to-Have Enhancements',\n      description: 'Features that would add value but are not critical for launch.',\n      goal: 'Add polish and delight to the core experience',\n      linkedFRs: couldHaves.map((f) => `FR-${f.name.replace(/\\s+/g, '-').toUpperCase()}`),\n      features: couldHaves,\n    });\n  }\n\n  return epics;\n}\n\nfunction findBenefitForFeature(\n  feature: DiscoveryInsights['requestedFeatures'][0],\n  insights: DiscoveryInsights\n): string {\n  // Try to find a matching desired outcome\n  const matchingOutcome = insights.desiredOutcomes.find(\n    (o) => o.outcome.toLowerCase().includes(feature.name.toLowerCase())\n  );\n\n  if (matchingOutcome) {\n    return matchingOutcome.outcome;\n  }\n\n  // Default benefit based on problem statement\n  return `address the challenge of ${insights.problemStatement.slice(0, 50).toLowerCase()}...`;\n}\n\nfunction buildAcceptanceCriteria(\n  feature: DiscoveryInsights['requestedFeatures'][0],\n  insights: DiscoveryInsights\n): Array<{ given: string; when: string; then: string }> {\n  // If feature has pre-defined acceptance criteria, convert them\n  if (feature.acceptanceCriteria && feature.acceptanceCriteria.length > 0) {\n    return feature.acceptanceCriteria.map((ac) => ({\n      given: `the ${insights.targetUsers[0]?.persona || 'user'} is using the system`,\n      when: `they interact with ${feature.name}`,\n      then: ac,\n    }));\n  }\n\n  // Generate basic acceptance criteria\n  return [\n    {\n      given: `a ${insights.targetUsers[0]?.persona || 'user'} is logged in`,\n      when: `they access the ${feature.name} feature`,\n      then: `they can ${feature.description.toLowerCase()}`,\n    },\n  ];\n}\n\nfunction mapPriorityToP(priority: 'must' | 'should' | 'could' | 'wont'): 'P0' | 'P1' | 'P2' | 'P3' {\n  switch (priority) {\n    case 'must':\n      return 'P0';\n    case 'should':\n      return 'P1';\n    case 'could':\n      return 'P2';\n    default:\n      return 'P3';\n  }\n}\n\nfunction estimateStoryPoints(feature: DiscoveryInsights['requestedFeatures'][0]): number {\n  // Basic estimation based on description length and priority\n  const descLength = feature.description.length;\n  const acCount = feature.acceptanceCriteria?.length || 0;\n\n  if (feature.priority === 'must') {\n    // Must-haves tend to be more complex\n    return descLength > 100 || acCount > 3 ? 8 : 5;\n  } else if (feature.priority === 'should') {\n    return descLength > 100 || acCount > 3 ? 5 : 3;\n  } else {\n    return descLength > 100 ? 3 : 2;\n  }\n}\n\n/**\n * Generate a summary suitable for quick review\n */\nexport function generateArtifactsSummary(\n  insights: DiscoveryInsights,\n  artifacts: GeneratedArtifacts\n): string {\n  const mustHaveFeatures = insights.requestedFeatures\n    .filter((f) => f.priority === 'must')\n    .map((f) => f.name)\n    .join(', ');\n\n  const topUsers = insights.targetUsers\n    .slice(0, 3)\n    .map((u) => u.persona)\n    .join(', ');\n\n  return `## Generated Artifacts Summary\n\n**Project:** ${insights.projectName || 'Unnamed Project'}\n**Call Duration:** ${Math.floor(insights.callDuration / 60)} minutes\n**Confidence:** ${Math.round(insights.confidenceScore * 100)}%\n\n### Created\n- 1 ProductProject\n- 1 PRD\n- ${artifacts.epicIds.length} Epics\n- ${artifacts.ticketIds.length} Tickets\n\n### Problem\n${insights.problemStatement}\n**Severity:** ${insights.problemSeverity}\n\n### Target Users\n${topUsers}\n\n### Must-Have Features\n${mustHaveFeatures || 'None explicitly identified'}\n\n### Next Steps\n${insights.suggestedFollowUps.slice(0, 3).map((f) => `- ${f}`).join('\\n')}\n`;\n}\n\nexport default generateArtifacts;\n"],"names":[],"mappings":"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","ignoreList":[3]}