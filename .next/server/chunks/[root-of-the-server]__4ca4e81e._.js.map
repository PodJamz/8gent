{"version":3,"sources":["../../../src/lib/convex-shim.ts","../../../src/lib/security.ts","../../../src/lib/openclaw/auth-server.ts","../../../src/lib/passcodeAuth.ts","../../../src/lib/ollama/client.ts","../../../src/lib/8gent/access-control.ts"],"sourcesContent":["export class ConvexHttpClient {\n    constructor(url: string) { }\n    query(query: any, args?: any): Promise<any> { return Promise.resolve(null); }\n    mutation(mutation: any, args?: any): Promise<any> { return Promise.resolve(null); }\n}\n\nexport const api = {\n    jobs: {\n        getAgentJobs: 'jobs:getAgentJobs',\n        cancelJob: 'jobs:cancelJob',\n        getJob: 'jobs:getJob',\n        queueCodeIteration: 'jobs:queueCodeIteration',\n        queueSpecialistDelegation: 'jobs:queueSpecialistDelegation',\n        queueAgentTask: 'jobs:queueAgentTask',\n        updateJobStatusPublic: 'jobs:updateJobStatusPublic',\n        logJobEventPublic: 'jobs:logJobEventPublic',\n    },\n    aiSettings: {\n        getSettings: 'aiSettings:getSettings',\n    },\n    erv: {\n        createEntity: 'erv:createEntity',\n        createRelationship: 'erv:createRelationship',\n        createDimension: 'erv:createDimension',\n        listDimensions: 'erv:listDimensions',\n        searchEntities: 'erv:searchEntities',\n        getEntity: 'erv:getEntity',\n    },\n    jamz: {\n        createProject: 'jamz:createProject',\n        createTrack: 'jamz:createTrack',\n        createClip: 'jamz:createClip',\n    },\n    messages: {\n        send: 'messages:send',\n    },\n    whatsappContacts: {\n        list: 'whatsappContacts:list',\n        getContactByPhone: 'whatsappContacts:getContactByPhone',\n        listContacts: 'whatsappContacts:listContacts',\n        upsertContact: 'whatsappContacts:upsertContact',\n    },\n    channels: {\n        list: 'channels:list',\n        getChannel: 'channels:getChannel',\n        sendMessage: 'channels:sendMessage',\n        getUserMessages: 'channels:getUserMessages',\n        getUserIntegrations: 'channels:getUserIntegrations',\n        getConversations: 'channels:getConversations',\n        getIntegration: 'channels:getIntegration',\n        logOutboundMessage: 'channels:logOutboundMessage',\n        searchMessages: 'channels:searchMessages',\n    },\n    scheduling: {\n        list: 'scheduling:list',\n        createEvent: 'scheduling:createEvent',\n        getEventTypes: 'scheduling:getEventTypes',\n        getAvailableSlots: 'scheduling:getAvailableSlots',\n        createBooking: 'scheduling:createBooking',\n        rescheduleBooking: 'scheduling:rescheduleBooking',\n        updateBookingStatus: 'scheduling:updateBookingStatus',\n    },\n    userCronJobs: {\n        list: 'userCronJobs:list',\n        create: 'userCronJobs:create',\n        delete: 'userCronJobs:delete',\n        createJob: 'userCronJobs:createJob',\n        getUserJobs: 'userCronJobs:getUserJobs',\n        toggleJob: 'userCronJobs:toggleJob',\n        deleteJob: 'userCronJobs:deleteJob',\n    },\n    compaction: {\n        compact: 'compaction:compact',\n        getLatestCompaction: 'compaction:getLatestCompaction',\n    },\n    kanban: {\n        listLists: 'kanban:listLists',\n        createCard: 'kanban:createCard',\n        moveCard: 'kanban:moveCard',\n        getTaskById: 'kanban:getTaskById',\n        searchTasks: 'kanban:searchTasks',\n        getTasks: 'kanban:getTasks',\n        isSeeded: 'kanban:isSeeded',\n        addTask: 'kanban:addTask',\n        updateTask: 'kanban:updateTask',\n        deleteTask: 'kanban:deleteTask',\n        moveTask: 'kanban:moveTask',\n        seedTasks: 'kanban:seedTasks',\n    },\n    designCanvas: {\n        getCanvas: 'designCanvas:getCanvas',\n        updateCanvas: 'designCanvas:updateCanvas',\n        createItem: 'designCanvas:createItem',\n        createCanvas: 'designCanvas:createCanvas',\n        getUserCanvases: 'designCanvas:getUserCanvases',\n        getCanvasNodes: 'designCanvas:getCanvasNodes',\n        getCanvasEdges: 'designCanvas:getCanvasEdges',\n        addNode: 'designCanvas:addNode',\n        addEdge: 'designCanvas:addEdge',\n        updateNode: 'designCanvas:updateNode',\n    },\n    agentic: {\n        createProductProject: 'agentic:createProductProject',\n        createPRD: 'agentic:createPRD',\n        createEpic: 'agentic:createEpic',\n        createTicket: 'agentic:createTicket',\n    },\n    discovery: {\n        getSession: 'discovery:getSession',\n        storeInsights: 'discovery:storeInsights',\n        storeArtifacts: 'discovery:storeArtifacts',\n        markNotificationSent: 'discovery:markNotificationSent',\n        markError: 'discovery:markError',\n        getSessionByCallerId: 'discovery:getSessionByCallerId',\n        updateTranscript: 'discovery:updateTranscript',\n    },\n    memories: {\n        searchEpisodic: 'memories:searchEpisodic',\n        getSemanticByCategories: 'memories:getSemanticByCategories',\n        getAllSemantic: 'memories:getAllSemantic',\n        getRecentEpisodic: 'memories:getRecentEpisodic',\n        storeEpisodic: 'memories:storeEpisodic',\n        upsertSemantic: 'memories:upsertSemantic',\n        deleteEpisodic: 'memories:deleteEpisodic',\n        deleteSemantic: 'memories:deleteSemantic',\n        getMemoryStats: 'memories:getMemoryStats',\n    },\n    observability: {\n        getSecurityScans: 'observability:getSecurityScans',\n        createSecurityScan: 'observability:createSecurityScan',\n        getActivityStream: 'observability:getActivityStream',\n        getDashboardOverview: 'observability:getDashboardOverview',\n        getProviderHealthStatus: 'observability:getProviderHealthStatus',\n        logOperation: 'observability:logOperation',\n    },\n    roadmap: {\n        submitSuggestion: 'roadmap:submitSuggestion',\n        getSuggestions: 'roadmap:getSuggestions',\n        updateSuggestionStatus: 'roadmap:updateSuggestionStatus',\n        voteSuggestion: 'roadmap:voteSuggestion',\n    }\n\n};\n\n// Export ConvexReactClient type for compatibility\nexport type ConvexReactClient = any;\n\nexport type Id<T extends string> = string;\n","/**\n * Security Monitoring Library\n *\n * Client-side utilities for security event logging and device fingerprinting.\n */\n\nimport { ConvexHttpClient } from \"@/lib/openclaw/client\";\nimport { makeFunctionReference } from \"@/lib/openclaw/client\";\n\n// Lazy-initialized Convex client for server-side logging\nlet _convexSecurityClient: ConvexHttpClient | null = null;\nfunction getSecurityConvexClient(): ConvexHttpClient | null {\n  if (_convexSecurityClient === null && process.env.NEXT_PUBLIC_CONVEX_URL) {\n    _convexSecurityClient = new ConvexHttpClient(process.env.NEXT_PUBLIC_CONVEX_URL);\n  }\n  return _convexSecurityClient;\n}\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport type SecurityEventType =\n  | \"admin_login_success\"\n  | \"admin_login_failed\"\n  | \"admin_logout\"\n  | \"passcode_unlock_success\"\n  | \"passcode_unlock_failed\"\n  | \"ipod_auth_success\"\n  | \"ipod_auth_failed\"\n  | \"clerk_signin\"\n  | \"clerk_signout\"\n  | \"api_request\"\n  | \"api_error\"\n  | \"rate_limit_hit\"\n  | \"brute_force_attempt\"\n  | \"suspicious_ip\"\n  | \"session_hijack_attempt\"\n  | \"invalid_token\"\n  | \"geo_anomaly\"\n  | \"system_alert\"\n  | \"config_change\";\n\nexport type SecuritySeverity = \"info\" | \"warning\" | \"critical\" | \"alert\";\n\nexport type ActorType =\n  | \"anonymous\"\n  | \"admin\"\n  | \"user\"\n  | \"collaborator\"\n  | \"system\";\n\nexport interface SecurityEventPayload {\n  eventType: SecurityEventType;\n  severity: SecuritySeverity;\n  actorType: ActorType;\n  actorId?: string;\n  actorEmail?: string;\n  message: string;\n  metadata?: Record<string, unknown>;\n  targetResource?: string;\n  targetId?: string;\n}\n\nexport interface GeoData {\n  country?: string;\n  region?: string;\n  city?: string;\n  latitude?: number;\n  longitude?: number;\n}\n\nexport interface DeviceInfo {\n  fingerprint?: string;\n  deviceType?: string;\n  browser?: string;\n  os?: string;\n}\n\n// =============================================================================\n// Device Detection\n// =============================================================================\n\n/**\n * Parse user agent to extract device info\n */\nexport function parseUserAgent(ua: string): DeviceInfo {\n  const info: DeviceInfo = {};\n\n  // Detect device type\n  if (/bot|crawler|spider|crawling/i.test(ua)) {\n    info.deviceType = \"bot\";\n  } else if (/mobile|android|iphone|ipad|ipod|blackberry|windows phone/i.test(ua)) {\n    if (/ipad|tablet|playbook|silk/i.test(ua)) {\n      info.deviceType = \"tablet\";\n    } else {\n      info.deviceType = \"mobile\";\n    }\n  } else {\n    info.deviceType = \"desktop\";\n  }\n\n  // Detect browser\n  if (/firefox/i.test(ua)) {\n    info.browser = \"Firefox\";\n  } else if (/edg/i.test(ua)) {\n    info.browser = \"Edge\";\n  } else if (/chrome|chromium|crios/i.test(ua)) {\n    info.browser = \"Chrome\";\n  } else if (/safari/i.test(ua)) {\n    info.browser = \"Safari\";\n  } else if (/opera|opr/i.test(ua)) {\n    info.browser = \"Opera\";\n  } else if (/msie|trident/i.test(ua)) {\n    info.browser = \"IE\";\n  } else {\n    info.browser = \"Unknown\";\n  }\n\n  // Detect OS\n  if (/windows/i.test(ua)) {\n    info.os = \"Windows\";\n  } else if (/macintosh|mac os x/i.test(ua)) {\n    info.os = \"macOS\";\n  } else if (/linux/i.test(ua)) {\n    info.os = \"Linux\";\n  } else if (/android/i.test(ua)) {\n    info.os = \"Android\";\n  } else if (/iphone|ipad|ipod/i.test(ua)) {\n    info.os = \"iOS\";\n  } else {\n    info.os = \"Unknown\";\n  }\n\n  return info;\n}\n\n/**\n * Generate a simple device fingerprint (server-side)\n */\nexport function generateFingerprint(\n  ip: string,\n  ua: string,\n  acceptLanguage?: string\n): string {\n  // Create a simple hash from available data\n  const data = `${ip}|${ua}|${acceptLanguage || \"\"}`;\n  let hash = 0;\n  for (let i = 0; i < data.length; i++) {\n    const char = data.charCodeAt(i);\n    hash = (hash << 5) - hash + char;\n    hash = hash & hash; // Convert to 32-bit integer\n  }\n  return Math.abs(hash).toString(16).padStart(8, \"0\");\n}\n\n// =============================================================================\n// Server-Side Logging (for API routes)\n// =============================================================================\n\n/**\n * Log a security event from a server-side context (API route)\n */\nexport async function logSecurityEvent(\n  payload: SecurityEventPayload,\n  request: Request,\n  geoData?: GeoData\n): Promise<void> {\n  try {\n    const client = getSecurityConvexClient();\n    if (!client) {\n      console.warn(\"[Security] Convex client not available, logging to console only\");\n      console.log(\"[Security Event]\", payload.eventType, payload.message);\n      return;\n    }\n\n    const ip = getClientIp(request);\n    const userAgent = request.headers.get(\"user-agent\") || \"unknown\";\n    const deviceInfo = parseUserAgent(userAgent);\n    const fingerprint = generateFingerprint(ip, userAgent);\n\n    // Use makeFunctionReference to avoid type generation dependency\n    const logSecurityEventMutation = makeFunctionReference<\n      \"mutation\",\n      {\n        eventType: SecurityEventType;\n        severity: SecuritySeverity;\n        actorType: ActorType;\n        actorId?: string;\n        actorEmail?: string;\n        message: string;\n        metadata?: Record<string, unknown>;\n        targetResource?: string;\n        targetId?: string;\n        ipAddress: string;\n        userAgent: string;\n        fingerprint: string;\n        deviceType?: string;\n        browser?: string;\n        os?: string;\n        country?: string;\n        region?: string;\n        city?: string;\n      },\n      void\n    >(\"security:logSecurityEvent\");\n\n    await client.mutation(logSecurityEventMutation, {\n      eventType: payload.eventType,\n      severity: payload.severity,\n      actorType: payload.actorType,\n      actorId: payload.actorId,\n      actorEmail: payload.actorEmail,\n      message: payload.message,\n      metadata: payload.metadata,\n      targetResource: payload.targetResource,\n      targetId: payload.targetId,\n      ipAddress: ip,\n      userAgent,\n      fingerprint,\n      deviceType: deviceInfo.deviceType,\n      browser: deviceInfo.browser,\n      os: deviceInfo.os,\n      country: geoData?.country,\n      region: geoData?.region,\n      city: geoData?.city,\n    });\n\n    console.log(\"[Security] Event logged:\", payload.eventType, payload.severity);\n  } catch (error) {\n    // Log to console as fallback, never fail silently\n    console.error(\"[Security] Failed to log event to Convex:\", error);\n    console.log(\"[Security Event Fallback]\", payload.eventType, payload.message);\n  }\n}\n\n/**\n * Extract client IP from request headers\n * Handles Vercel, Cloudflare, and standard proxies\n */\nexport function getClientIp(request: Request): string {\n  // Try various headers in order of preference\n  const headers = request.headers;\n\n  // Vercel\n  const vercelIp = headers.get(\"x-vercel-forwarded-for\");\n  if (vercelIp) {\n    return vercelIp.split(\",\")[0].trim();\n  }\n\n  // Cloudflare\n  const cfIp = headers.get(\"cf-connecting-ip\");\n  if (cfIp) {\n    return cfIp;\n  }\n\n  // Standard proxy header\n  const forwardedFor = headers.get(\"x-forwarded-for\");\n  if (forwardedFor) {\n    return forwardedFor.split(\",\")[0].trim();\n  }\n\n  // Real IP header\n  const realIp = headers.get(\"x-real-ip\");\n  if (realIp) {\n    return realIp;\n  }\n\n  // Fallback\n  return \"unknown\";\n}\n\n// =============================================================================\n// Rate Limiting Helper\n// =============================================================================\n\n// In-memory rate limit tracker (use Redis in production)\nconst rateLimitMap = new Map<string, { count: number; resetAt: number }>();\n\nexport interface RateLimitConfig {\n  windowMs: number; // Time window in milliseconds\n  maxRequests: number; // Max requests per window\n}\n\nexport interface RateLimitResult {\n  allowed: boolean;\n  remaining: number;\n  resetAt: number;\n}\n\n/**\n * Check and update rate limit for a key (IP, user ID, etc.)\n */\nexport function checkRateLimit(\n  key: string,\n  config: RateLimitConfig\n): RateLimitResult {\n  const now = Date.now();\n  const existing = rateLimitMap.get(key);\n\n  if (!existing || existing.resetAt < now) {\n    // New window\n    const resetAt = now + config.windowMs;\n    rateLimitMap.set(key, { count: 1, resetAt });\n    return {\n      allowed: true,\n      remaining: config.maxRequests - 1,\n      resetAt,\n    };\n  }\n\n  if (existing.count >= config.maxRequests) {\n    return {\n      allowed: false,\n      remaining: 0,\n      resetAt: existing.resetAt,\n    };\n  }\n\n  existing.count++;\n  return {\n    allowed: true,\n    remaining: config.maxRequests - existing.count,\n    resetAt: existing.resetAt,\n  };\n}\n\n// Clean up old rate limit entries periodically\nif (typeof setInterval !== \"undefined\") {\n  setInterval(() => {\n    const now = Date.now();\n    for (const [key, value] of rateLimitMap.entries()) {\n      if (value.resetAt < now) {\n        rateLimitMap.delete(key);\n      }\n    }\n  }, 60000); // Clean up every minute\n}\n\n// =============================================================================\n// Brute Force Detection\n// =============================================================================\n\n// Track failed attempts per IP\nconst failedAttempts = new Map<\n  string,\n  { count: number; firstAttempt: number }\n>();\n\nexport interface BruteForceConfig {\n  maxAttempts: number; // Max failed attempts before flagging\n  windowMs: number; // Time window to count attempts\n}\n\n/**\n * Record a failed attempt and check for brute force\n */\nexport function recordFailedAttempt(\n  ip: string,\n  config: BruteForceConfig = { maxAttempts: 5, windowMs: 15 * 60 * 1000 }\n): boolean {\n  const now = Date.now();\n  const existing = failedAttempts.get(ip);\n\n  if (!existing || now - existing.firstAttempt > config.windowMs) {\n    // New window\n    failedAttempts.set(ip, { count: 1, firstAttempt: now });\n    return false;\n  }\n\n  existing.count++;\n  return existing.count >= config.maxAttempts;\n}\n\n/**\n * Clear failed attempts for an IP (call on successful login)\n */\nexport function clearFailedAttempts(ip: string): void {\n  failedAttempts.delete(ip);\n}\n\n// =============================================================================\n// Geo Lookup (using ip-api.com - free for non-commercial)\n// =============================================================================\n\nconst geoCache = new Map<string, { data: GeoData; cachedAt: number }>();\nconst GEO_CACHE_TTL = 24 * 60 * 60 * 1000; // 24 hours\n\n/**\n * Look up geolocation for an IP address\n */\nexport async function lookupGeo(ip: string): Promise<GeoData | null> {\n  // Skip local/private IPs\n  if (\n    ip === \"unknown\" ||\n    ip === \"127.0.0.1\" ||\n    ip.startsWith(\"192.168.\") ||\n    ip.startsWith(\"10.\") ||\n    ip.startsWith(\"172.\")\n  ) {\n    return null;\n  }\n\n  // Check cache\n  const cached = geoCache.get(ip);\n  if (cached && Date.now() - cached.cachedAt < GEO_CACHE_TTL) {\n    return cached.data;\n  }\n\n  try {\n    const response = await fetch(\n      `http://ip-api.com/json/${ip}?fields=country,regionName,city,lat,lon`,\n      { signal: AbortSignal.timeout(2000) }\n    );\n\n    if (!response.ok) {\n      return null;\n    }\n\n    const data = await response.json();\n\n    if (data.status === \"fail\") {\n      return null;\n    }\n\n    const geoData: GeoData = {\n      country: data.country,\n      region: data.regionName,\n      city: data.city,\n      latitude: data.lat,\n      longitude: data.lon,\n    };\n\n    // Cache the result\n    geoCache.set(ip, { data: geoData, cachedAt: Date.now() });\n\n    return geoData;\n  } catch {\n    return null;\n  }\n}\n","\nimport { NextResponse } from \"next/server\";\n\nexport const auth = () => {\n    return {\n        userId: \"mock-user-id\",\n        sessionId: \"mock-session-id\",\n        getToken: async () => \"mock-token\",\n        redirectToSignIn: () => ({})\n    };\n};\n\nexport const currentUser = async () => {\n    return {\n        id: \"mock-user-id\",\n        firstName: \"OpenClaw\",\n        lastName: \"AI\",\n        emailAddresses: [{ emailAddress: \"james@example.com\" }]\n    };\n};\n\nexport const clerkClient = {\n    users: {\n        getUser: async () => currentUser()\n    }\n};\n\nexport const clerkMiddleware = () => {\n    return (req: any) => {\n        return NextResponse.next();\n    };\n};\n","/**\n * Passcode Authentication System\n *\n * Handles 6-digit passcode verification for protected areas and iPod collaborators.\n * Uses HMAC-SHA256 for secure hashing and timing-safe comparison.\n */\n\nimport crypto from 'crypto';\n\n// SECURITY: Require PASSCODE_SECRET to be set - no default fallback\nfunction getPasscodeSecret(): string {\n  const secret = process.env.PASSCODE_SECRET;\n  if (!secret) {\n    throw new Error('PASSCODE_SECRET environment variable is required');\n  }\n  if (secret.length < 32) {\n    throw new Error('PASSCODE_SECRET must be at least 32 characters long');\n  }\n  return secret;\n}\n\n// Lazy-initialize to allow env vars to be set before first use\nlet cachedSecret: string | null = null;\nfunction getSecret(): string {\n  if (!cachedSecret) {\n    cachedSecret = getPasscodeSecret();\n  }\n  return cachedSecret;\n}\n\n// Cookie names for session tokens\nexport const ADMIN_COOKIE = 'jamos_admin';\nexport const AREA_COOKIE_PREFIX = 'jamos_area_';\nexport const IPOD_COOKIE = 'jamos_ipod';\n\n// Session duration (24 hours for admin, 7 days for areas/iPod)\nconst ADMIN_SESSION_DURATION = 24 * 60 * 60 * 1000;\nconst AREA_SESSION_DURATION = 7 * 24 * 60 * 60 * 1000;\n\n/**\n * Hash a 6-digit passcode\n */\nexport function hashPasscode(passcode: string): string {\n  return crypto\n    .createHmac('sha256', getSecret())\n    .update(passcode)\n    .digest('hex');\n}\n\n/**\n * Verify a passcode against a hash (timing-safe)\n */\nexport function verifyPasscode(passcode: string, hash: string): boolean {\n  const inputHash = hashPasscode(passcode);\n  const inputBuffer = Buffer.from(inputHash);\n  const hashBuffer = Buffer.from(hash);\n\n  if (inputBuffer.length !== hashBuffer.length) {\n    return false;\n  }\n\n  return crypto.timingSafeEqual(inputBuffer, hashBuffer);\n}\n\n/**\n * Session token payload\n */\ninterface SessionPayload {\n  type: 'admin' | 'area' | 'ipod';\n  subject: string; // admin username, area slug, or collaborator slug\n  exp: number;\n}\n\n/**\n * Sign a session token\n */\nexport function signSession(payload: SessionPayload): string {\n  const payloadB64 = Buffer.from(JSON.stringify(payload)).toString('base64url');\n  const signature = crypto\n    .createHmac('sha256', getSecret())\n    .update(payloadB64)\n    .digest('base64url');\n  return `${payloadB64}.${signature}`;\n}\n\n/**\n * Verify and decode a session token\n */\nexport function verifySession(token: string | undefined): SessionPayload | null {\n  if (!token) return null;\n\n  const parts = token.split('.');\n  if (parts.length !== 2) return null;\n\n  const [payloadB64, signature] = parts;\n\n  // Verify signature\n  const expectedSig = crypto\n    .createHmac('sha256', getSecret())\n    .update(payloadB64)\n    .digest('base64url');\n\n  const sigBuffer = Buffer.from(signature);\n  const expectedBuffer = Buffer.from(expectedSig);\n\n  if (sigBuffer.length !== expectedBuffer.length) return null;\n  if (!crypto.timingSafeEqual(sigBuffer, expectedBuffer)) return null;\n\n  // Decode payload\n  try {\n    const payload = JSON.parse(Buffer.from(payloadB64, 'base64url').toString()) as SessionPayload;\n\n    // Check expiry\n    if (Date.now() > payload.exp) return null;\n\n    return payload;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Create an admin session token\n */\nexport function createAdminSession(username: string): string {\n  return signSession({\n    type: 'admin',\n    subject: username,\n    exp: Date.now() + ADMIN_SESSION_DURATION,\n  });\n}\n\n/**\n * Create an area session token\n */\nexport function createAreaSession(areaSlug: string): string {\n  return signSession({\n    type: 'area',\n    subject: areaSlug,\n    exp: Date.now() + AREA_SESSION_DURATION,\n  });\n}\n\n/**\n * Create an iPod collaborator session token\n */\nexport function createiPodSession(collaboratorSlug: string): string {\n  return signSession({\n    type: 'ipod',\n    subject: collaboratorSlug,\n    exp: Date.now() + AREA_SESSION_DURATION,\n  });\n}\n\n/**\n * Get cookie name for a protected area\n */\nexport function getAreaCookieName(areaSlug: string): string {\n  return `${AREA_COOKIE_PREFIX}${areaSlug}`;\n}\n\n/**\n * Validate a 6-digit passcode format\n */\nexport function isValidPasscodeFormat(passcode: string): boolean {\n  return /^\\d{6}$/.test(passcode);\n}\n","/**\n * Ollama Client - Phase 3 Local LLM Integration\n *\n * Client library for interacting with local Ollama server.\n * Supports chat, generate, model listing, and health checks.\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface OllamaConfig {\n  baseUrl: string;\n  timeout?: number; // ms\n  defaultModel?: string;\n}\n\nexport interface OllamaModel {\n  name: string;\n  modified_at: string;\n  size: number;\n  digest: string;\n  details?: {\n    format: string;\n    family: string;\n    parameter_size: string;\n    quantization_level: string;\n  };\n}\n\nexport interface OllamaMessage {\n  role: 'system' | 'user' | 'assistant';\n  content: string;\n}\n\nexport interface OllamaChatRequest {\n  model: string;\n  messages: OllamaMessage[];\n  stream?: boolean;\n  options?: {\n    temperature?: number;\n    top_p?: number;\n    top_k?: number;\n    num_predict?: number;\n    stop?: string[];\n  };\n}\n\nexport interface OllamaChatResponse {\n  model: string;\n  created_at: string;\n  message: OllamaMessage;\n  done: boolean;\n  total_duration?: number;\n  load_duration?: number;\n  prompt_eval_count?: number;\n  eval_count?: number;\n  eval_duration?: number;\n}\n\nexport interface OllamaGenerateRequest {\n  model: string;\n  prompt: string;\n  stream?: boolean;\n  system?: string;\n  options?: {\n    temperature?: number;\n    top_p?: number;\n    top_k?: number;\n    num_predict?: number;\n    stop?: string[];\n  };\n}\n\nexport interface OllamaGenerateResponse {\n  model: string;\n  created_at: string;\n  response: string;\n  done: boolean;\n  context?: number[];\n  total_duration?: number;\n  load_duration?: number;\n  prompt_eval_count?: number;\n  eval_count?: number;\n  eval_duration?: number;\n}\n\nexport interface OllamaHealthStatus {\n  connected: boolean;\n  version?: string;\n  models: OllamaModel[];\n  error?: string;\n  latencyMs?: number;\n}\n\n// ============================================================================\n// Client Class\n// ============================================================================\n\nexport class OllamaClient {\n  private baseUrl: string;\n  private timeout: number;\n  private defaultModel: string;\n\n  constructor(config: OllamaConfig) {\n    this.baseUrl = config.baseUrl.replace(/\\/$/, ''); // Remove trailing slash\n    this.timeout = config.timeout ?? 30000;\n    this.defaultModel = config.defaultModel ?? 'gpt-oss:20b';\n  }\n\n  /**\n   * Check if Ollama server is reachable and get available models\n   */\n  async health(): Promise<OllamaHealthStatus> {\n    const start = Date.now();\n\n    try {\n      // Try to list models (this also verifies server is running)\n      const response = await this.fetchWithTimeout(`${this.baseUrl}/api/tags`, {\n        method: 'GET',\n      });\n\n      if (!response.ok) {\n        return {\n          connected: false,\n          models: [],\n          error: `Server returned ${response.status}`,\n          latencyMs: Date.now() - start,\n        };\n      }\n\n      const data = await response.json();\n      const models: OllamaModel[] = data.models || [];\n\n      // Also try to get version\n      let version: string | undefined;\n      try {\n        const versionResponse = await this.fetchWithTimeout(`${this.baseUrl}/api/version`, {\n          method: 'GET',\n        });\n        if (versionResponse.ok) {\n          const versionData = await versionResponse.json();\n          version = versionData.version;\n        }\n      } catch (error) {\n        // Version endpoint might not exist in older versions - log at debug level\n        console.debug('[Ollama] Version endpoint not available:', error);\n      }\n\n      return {\n        connected: true,\n        version,\n        models,\n        latencyMs: Date.now() - start,\n      };\n    } catch (error) {\n      return {\n        connected: false,\n        models: [],\n        error: error instanceof Error ? error.message : 'Connection failed',\n        latencyMs: Date.now() - start,\n      };\n    }\n  }\n\n  /**\n   * List available models\n   */\n  async listModels(): Promise<OllamaModel[]> {\n    const response = await this.fetchWithTimeout(`${this.baseUrl}/api/tags`, {\n      method: 'GET',\n    });\n\n    if (!response.ok) {\n      throw new Error(`Failed to list models: ${response.status}`);\n    }\n\n    const data = await response.json();\n    return data.models || [];\n  }\n\n  /**\n   * Chat with a model (non-streaming)\n   */\n  async chat(request: OllamaChatRequest): Promise<OllamaChatResponse> {\n    const response = await this.fetchWithTimeout(`${this.baseUrl}/api/chat`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        ...request,\n        model: request.model || this.defaultModel,\n        stream: false,\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Chat failed: ${response.status} - ${error}`);\n    }\n\n    return response.json();\n  }\n\n  /**\n   * Chat with a model (streaming)\n   * Returns an async generator that yields partial responses\n   */\n  async *chatStream(request: OllamaChatRequest): AsyncGenerator<OllamaChatResponse> {\n    const response = await this.fetchWithTimeout(`${this.baseUrl}/api/chat`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        ...request,\n        model: request.model || this.defaultModel,\n        stream: true,\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Chat stream failed: ${response.status} - ${error}`);\n    }\n\n    const reader = response.body?.getReader();\n    if (!reader) {\n      throw new Error('No response body');\n    }\n\n    const decoder = new TextDecoder();\n    let buffer = '';\n\n    try {\n      while (true) {\n        const { done, value } = await reader.read();\n\n        if (done) break;\n\n        buffer += decoder.decode(value, { stream: true });\n        const lines = buffer.split('\\n');\n        buffer = lines.pop() || '';\n\n        for (const line of lines) {\n          if (line.trim()) {\n            try {\n              const data = JSON.parse(line) as OllamaChatResponse;\n              yield data;\n            } catch (error) {\n              // Log malformed JSON for debugging but continue processing\n              console.error('[Ollama] Malformed JSON in chat stream:', line.substring(0, 100), error);\n            }\n          }\n        }\n      }\n\n      // Process remaining buffer\n      if (buffer.trim()) {\n        try {\n          const data = JSON.parse(buffer) as OllamaChatResponse;\n          yield data;\n        } catch (error) {\n          // Log malformed JSON for debugging\n          console.error('[Ollama] Malformed JSON in chat buffer:', buffer.substring(0, 100), error);\n        }\n      }\n    } finally {\n      reader.releaseLock();\n    }\n  }\n\n  /**\n   * Generate text (non-streaming)\n   */\n  async generate(request: OllamaGenerateRequest): Promise<OllamaGenerateResponse> {\n    const response = await this.fetchWithTimeout(`${this.baseUrl}/api/generate`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        ...request,\n        model: request.model || this.defaultModel,\n        stream: false,\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Generate failed: ${response.status} - ${error}`);\n    }\n\n    return response.json();\n  }\n\n  /**\n   * Generate text (streaming)\n   */\n  async *generateStream(request: OllamaGenerateRequest): AsyncGenerator<OllamaGenerateResponse> {\n    const response = await this.fetchWithTimeout(`${this.baseUrl}/api/generate`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        ...request,\n        model: request.model || this.defaultModel,\n        stream: true,\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Generate stream failed: ${response.status} - ${error}`);\n    }\n\n    const reader = response.body?.getReader();\n    if (!reader) {\n      throw new Error('No response body');\n    }\n\n    const decoder = new TextDecoder();\n    let buffer = '';\n\n    try {\n      while (true) {\n        const { done, value } = await reader.read();\n\n        if (done) break;\n\n        buffer += decoder.decode(value, { stream: true });\n        const lines = buffer.split('\\n');\n        buffer = lines.pop() || '';\n\n        for (const line of lines) {\n          if (line.trim()) {\n            try {\n              const data = JSON.parse(line) as OllamaGenerateResponse;\n              yield data;\n            } catch (error) {\n              // Log malformed JSON for debugging but continue processing\n              console.error('[Ollama] Malformed JSON in generate stream:', line.substring(0, 100), error);\n            }\n          }\n        }\n      }\n\n      // Process remaining buffer\n      if (buffer.trim()) {\n        try {\n          const data = JSON.parse(buffer) as OllamaGenerateResponse;\n          yield data;\n        } catch (error) {\n          // Log malformed JSON for debugging\n          console.error('[Ollama] Malformed JSON in generate buffer:', buffer.substring(0, 100), error);\n        }\n      }\n    } finally {\n      reader.releaseLock();\n    }\n  }\n\n  /**\n   * Pull a model from Ollama registry\n   */\n  async pullModel(modelName: string): Promise<void> {\n    const response = await fetch(`${this.baseUrl}/api/pull`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ name: modelName }),\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Failed to pull model: ${response.status} - ${error}`);\n    }\n\n    // Wait for the model to be pulled (this can take a while)\n    const reader = response.body?.getReader();\n    if (reader) {\n      const decoder = new TextDecoder();\n      while (true) {\n        const { done } = await reader.read();\n        if (done) break;\n      }\n      reader.releaseLock();\n    }\n  }\n\n  /**\n   * Fetch with timeout\n   */\n  private async fetchWithTimeout(url: string, options: RequestInit): Promise<Response> {\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), this.timeout);\n\n    try {\n      const response = await fetch(url, {\n        ...options,\n        signal: controller.signal,\n      });\n      return response;\n    } catch (error) {\n      if (error instanceof Error && error.name === 'AbortError') {\n        throw new Error(`Request timed out after ${this.timeout}ms`);\n      }\n      throw error;\n    } finally {\n      clearTimeout(timeoutId);\n    }\n  }\n}\n\n// ============================================================================\n// Singleton Instance\n// ============================================================================\n\nlet defaultClient: OllamaClient | null = null;\n\n/**\n * Get the default Ollama client\n * Uses OLLAMA_BASE_URL env var or defaults to localhost:11434\n */\nexport function getOllamaClient(config?: Partial<OllamaConfig>): OllamaClient {\n  if (!defaultClient || config) {\n    defaultClient = new OllamaClient({\n      baseUrl: config?.baseUrl ?? process.env.OLLAMA_BASE_URL ?? 'http://localhost:11434',\n      timeout: config?.timeout ?? 30000,\n      defaultModel: config?.defaultModel ?? process.env.OLLAMA_DEFAULT_MODEL ?? 'gpt-oss:20b',\n    });\n  }\n  return defaultClient;\n}\n\n/**\n * Quick health check for Ollama\n */\nexport async function checkOllamaHealth(baseUrl?: string): Promise<OllamaHealthStatus> {\n  const client = new OllamaClient({\n    baseUrl: baseUrl ?? process.env.OLLAMA_BASE_URL ?? 'http://localhost:11434',\n    timeout: 5000, // Quick health check\n  });\n  return client.health();\n}\n","/**\n * Access Control for 8gent Tools\n *\n * Implements three-tier access control:\n * - Owner/8gent: Full access to all 50+ tools\n * - Collaborators: Limited access (view, search, navigate but no mutations)\n * - Visitors: Portfolio mode only (search, navigate, themes)\n *\n * @see docs/planning/infinity-agent-coding-integration.md\n */\n\nimport { CLAW_AI_TOOLS, ToolDefinition } from './tools';\n\n// ============================================================================\n// Access Level Types\n// ============================================================================\n\nexport type AccessLevel = 'owner' | 'collaborator' | 'visitor';\n\n/**\n * Job types for OpenClaw - each type gets a specific tool allowlist\n * This prevents coding agents from sending messages, research agents from mutating files, etc.\n */\nexport type JobType = 'coding' | 'research' | 'product' | 'general';\n\nexport interface UserContext {\n  userId?: string;\n  isOwner: boolean;\n  isCollaborator: boolean;\n  isAuthenticated: boolean;\n}\n\nexport interface JobContext {\n  jobType: JobType;\n  accessLevel: AccessLevel;\n}\n\n// ============================================================================\n// Tool Access Mappings\n// ============================================================================\n\n/**\n * Tools available to everyone (visitors included)\n * These are read-only portfolio exploration tools\n */\nconst VISITOR_TOOLS = new Set([\n  'search_portfolio',\n  'navigate_to',\n  'list_themes',\n  'open_search_app',\n  'show_weather',\n  'show_photos',\n]);\n\n/**\n * Tools available to collaborators (authenticated users)\n * Includes visitor tools plus limited view/read capabilities\n */\nconst COLLABORATOR_TOOLS = new Set([\n  // All visitor tools\n  ...VISITOR_TOOLS,\n  // View kanban and projects (read-only)\n  'show_kanban_tasks',\n  'list_projects',\n  'get_project_kanban',\n  // Scheduling (view only, no booking for collaborators)\n  'get_available_times',\n  'get_upcoming_bookings',\n  // Read-only context\n  'get_active_context',\n  'load_context_from_reference',\n  // Read-only coding (can view but not execute)\n  'list_coding_tasks',\n  'list_directory',\n  'read_file',\n  'search_codebase',\n  'git_status',\n  'git_diff',\n  // Cron jobs (view only)\n  'list_cron_jobs',\n  // Compaction (view only)\n  'get_compaction_summary',\n  // Channels (view only)\n  'list_channel_integrations',\n  'get_channel_conversations',\n  'search_channel_messages',\n]);\n\n/**\n * Tools available only to the owner\n * Full access including mutations, execution, and memory\n */\nconst OWNER_ONLY_TOOLS = new Set([\n  // Scheduling mutations\n  'schedule_call',\n  'book_meeting',\n  'reschedule_meeting',\n  'cancel_meeting',\n  // UI rendering\n  'render_ui',\n  // Product lifecycle mutations\n  'create_project',\n  'create_prd',\n  'create_ticket',\n  'update_ticket',\n  'shard_prd',\n  // Memory operations (full RLM access)\n  'remember',\n  'recall_preference',\n  'memorize',\n  'learn',\n  'forget',\n  // Working context mutations\n  'set_active_context',\n  // Repository operations\n  'clone_repository',\n  // File mutations\n  'write_file',\n  'edit_file',\n  'delete_file',\n  // Execution\n  'run_command',\n  'start_dev_server',\n  'get_preview_url',\n  // Git mutations\n  'git_commit',\n  'git_push',\n  'create_branch',\n  // Coding task management\n  'create_coding_task',\n  'update_coding_task',\n  // Cron job mutations (owner only)\n  'create_cron_job',\n  'toggle_cron_job',\n  'delete_cron_job',\n  // Compaction mutations (owner only)\n  'compact_conversation',\n  // Channel mutations (owner only)\n  'send_channel_message',\n  // Music generation (owner only)\n  'cowrite_music',\n  'generate_music',\n]);\n\n// ============================================================================\n// Job Type Tool Allowlists (Phase 1.1 - OpenClaw Safety Stack)\n// ============================================================================\n\n/**\n * CODING jobs: Full development capabilities\n * File operations, git, terminal, task tracking\n * NO: messaging, scheduling, social posting\n */\nconst CODING_JOB_TOOLS = new Set([\n  // File operations\n  'list_directory',\n  'read_file',\n  'write_file',\n  'edit_file',\n  'delete_file',\n  'search_codebase',\n  // Repository operations\n  'clone_repository',\n  // Git operations\n  'git_status',\n  'git_diff',\n  'git_commit',\n  'git_push',\n  'create_branch',\n  // Execution (sandboxed)\n  'run_command',\n  'start_dev_server',\n  'get_preview_url',\n  // Task tracking\n  'create_coding_task',\n  'update_coding_task',\n  'list_coding_tasks',\n  // Working context\n  'get_active_context',\n  'set_active_context',\n  'load_context_from_reference',\n]);\n\n/**\n * RESEARCH jobs: Read-only exploration and web access\n * Web fetch, search, read files - NO mutations\n */\nconst RESEARCH_JOB_TOOLS = new Set([\n  // Portfolio exploration\n  'search_portfolio',\n  'navigate_to',\n  'list_themes',\n  'open_search_app',\n  // Read-only file operations\n  'list_directory',\n  'read_file',\n  'search_codebase',\n  // Git (read-only)\n  'git_status',\n  'git_diff',\n  // View capabilities\n  'show_kanban_tasks',\n  'list_projects',\n  'get_project_kanban',\n  'list_coding_tasks',\n  // Context (read-only)\n  'get_active_context',\n  'load_context_from_reference',\n  // Channels (read-only)\n  'list_channel_integrations',\n  'get_channel_conversations',\n  'search_channel_messages',\n  // Compaction (read-only)\n  'get_compaction_summary',\n  // Memory (read-only)\n  'remember',\n  'recall_preference',\n]);\n\n/**\n * PRODUCT jobs: PRD, tickets, project management\n * NO code execution, NO file mutations beyond docs\n */\nconst PRODUCT_JOB_TOOLS = new Set([\n  // Product lifecycle\n  'create_project',\n  'list_projects',\n  'create_prd',\n  'create_ticket',\n  'update_ticket',\n  'shard_prd',\n  'get_project_kanban',\n  'show_kanban_tasks',\n  // Read-only file access (for context)\n  'list_directory',\n  'read_file',\n  'search_codebase',\n  // Context\n  'get_active_context',\n  'set_active_context',\n  'load_context_from_reference',\n  // Memory (for product decisions)\n  'remember',\n  'recall_preference',\n  'memorize',\n  'learn',\n  // UI rendering (for mockups)\n  'render_ui',\n  // Scheduling (for roadmap planning)\n  'get_available_times',\n  'get_upcoming_bookings',\n]);\n\n/**\n * GENERAL jobs: Balanced access for interactive chat\n * Most tools available, but still respects access level\n */\nconst GENERAL_JOB_TOOLS = new Set([\n  // All visitor tools\n  ...VISITOR_TOOLS,\n  // All collaborator tools\n  ...COLLABORATOR_TOOLS,\n  // Owner-only tools are gated by access level check\n]);\n\n/**\n * Map of job types to their allowed tools\n */\nconst JOB_TYPE_TOOLS: Record<JobType, Set<string>> = {\n  coding: CODING_JOB_TOOLS,\n  research: RESEARCH_JOB_TOOLS,\n  product: PRODUCT_JOB_TOOLS,\n  general: GENERAL_JOB_TOOLS,\n};\n\n/**\n * Job type metadata for UI display and documentation\n */\nexport const JOB_TYPE_INFO: Record<JobType, { name: string; description: string; icon: string }> = {\n  coding: {\n    name: 'Coding',\n    description: 'Full development: files, git, terminal. No messaging or scheduling.',\n    icon: 'ðŸ’»',\n  },\n  research: {\n    name: 'Research',\n    description: 'Read-only exploration: search, read files, browse. No mutations.',\n    icon: 'ðŸ”',\n  },\n  product: {\n    name: 'Product',\n    description: 'PRDs, tickets, planning. No code execution.',\n    icon: 'ðŸ“‹',\n  },\n  general: {\n    name: 'General',\n    description: 'Balanced access for interactive chat.',\n    icon: 'ðŸ’¬',\n  },\n};\n\n// ============================================================================\n// Access Control Functions\n// ============================================================================\n\n/**\n * Get the access level for a user based on their context\n */\nexport function getAccessLevel(ctx: UserContext): AccessLevel {\n  if (ctx.isOwner) {\n    return 'owner';\n  }\n  if (ctx.isCollaborator || ctx.isAuthenticated) {\n    return 'collaborator';\n  }\n  return 'visitor';\n}\n\n/**\n * Check if a user can access a specific tool\n */\nexport function canAccessTool(toolName: string, accessLevel: AccessLevel): boolean {\n  switch (accessLevel) {\n    case 'owner':\n      // Owner has access to all tools\n      return true;\n\n    case 'collaborator':\n      // Collaborators have access to visitor tools + collaborator tools\n      return VISITOR_TOOLS.has(toolName) || COLLABORATOR_TOOLS.has(toolName);\n\n    case 'visitor':\n      // Visitors only have access to visitor tools\n      return VISITOR_TOOLS.has(toolName);\n\n    default:\n      return false;\n  }\n}\n\n/**\n * Get all tools available for a given access level\n */\nexport function getToolsForAccessLevel(accessLevel: AccessLevel): ToolDefinition[] {\n  return CLAW_AI_TOOLS.filter((tool) => canAccessTool(tool.name, accessLevel));\n}\n\n/**\n * Get tool names available for a given access level\n */\nexport function getToolNamesForAccessLevel(accessLevel: AccessLevel): string[] {\n  return getToolsForAccessLevel(accessLevel).map((tool) => tool.name);\n}\n\n/**\n * Filter a list of tool calls to only include permitted tools\n * Returns the filtered list and any denied tools\n */\nexport function filterToolCalls<T extends { name: string }>(\n  toolCalls: T[],\n  accessLevel: AccessLevel\n): { permitted: T[]; denied: T[] } {\n  const permitted: T[] = [];\n  const denied: T[] = [];\n\n  for (const call of toolCalls) {\n    if (canAccessTool(call.name, accessLevel)) {\n      permitted.push(call);\n    } else {\n      denied.push(call);\n    }\n  }\n\n  return { permitted, denied };\n}\n\n// ============================================================================\n// Job Type Access Control (Phase 1.1 - OpenClaw Safety Stack)\n// ============================================================================\n\n/**\n * Check if a tool is allowed for a specific job type\n * This is ADDITIONAL to access level checks - both must pass\n */\nexport function isToolAllowedForJobType(toolName: string, jobType: JobType): boolean {\n  const allowedTools = JOB_TYPE_TOOLS[jobType];\n\n  // General jobs allow all tools (access level still applies)\n  if (jobType === 'general') {\n    return true;\n  }\n\n  return allowedTools.has(toolName);\n}\n\n/**\n * Check if a user can access a tool given both access level AND job type\n * Both checks must pass for the tool to be allowed\n */\nexport function canAccessToolForJob(\n  toolName: string,\n  accessLevel: AccessLevel,\n  jobType: JobType\n): boolean {\n  // First check: Does the access level allow this tool?\n  if (!canAccessTool(toolName, accessLevel)) {\n    return false;\n  }\n\n  // Second check: Does the job type allow this tool?\n  return isToolAllowedForJobType(toolName, jobType);\n}\n\n/**\n * Get all tools available for a given job context (access level + job type)\n */\nexport function getToolsForJobContext(context: JobContext): ToolDefinition[] {\n  return CLAW_AI_TOOLS.filter((tool) =>\n    canAccessToolForJob(tool.name, context.accessLevel, context.jobType)\n  );\n}\n\n/**\n * Get tool names available for a given job context\n */\nexport function getToolNamesForJobContext(context: JobContext): string[] {\n  return getToolsForJobContext(context).map((tool) => tool.name);\n}\n\n/**\n * Filter tool calls by both access level and job type\n * Returns permitted, denied by access, and denied by job type\n */\nexport function filterToolCallsForJob<T extends { name: string }>(\n  toolCalls: T[],\n  context: JobContext\n): {\n  permitted: T[];\n  deniedByAccess: T[];\n  deniedByJobType: T[];\n} {\n  const permitted: T[] = [];\n  const deniedByAccess: T[] = [];\n  const deniedByJobType: T[] = [];\n\n  for (const call of toolCalls) {\n    const hasAccessLevel = canAccessTool(call.name, context.accessLevel);\n    const hasJobType = isToolAllowedForJobType(call.name, context.jobType);\n\n    if (hasAccessLevel && hasJobType) {\n      permitted.push(call);\n    } else if (!hasAccessLevel) {\n      deniedByAccess.push(call);\n    } else {\n      deniedByJobType.push(call);\n    }\n  }\n\n  return { permitted, deniedByAccess, deniedByJobType };\n}\n\n/**\n * Generate a description of what tools are available for a job context\n */\nexport function describeJobContext(context: JobContext): string {\n  const accessInfo = ACCESS_LEVEL_INFO[context.accessLevel];\n  const jobInfo = JOB_TYPE_INFO[context.jobType];\n  const tools = getToolsForJobContext(context);\n\n  return `${accessInfo.name} with ${jobInfo.name} job: ${jobInfo.description} ${tools.length} tools available.`;\n}\n\n// ============================================================================\n// Tool Categories for UI Display\n// ============================================================================\n\nexport interface ToolCategory {\n  name: string;\n  description: string;\n  tools: string[];\n  icon: string;\n}\n\nexport const TOOL_CATEGORIES: ToolCategory[] = [\n  {\n    name: 'Portfolio',\n    description: 'Search and navigate the portfolio',\n    icon: 'ðŸŽ¨',\n    tools: ['search_portfolio', 'navigate_to', 'list_themes', 'open_search_app', 'show_weather', 'show_photos'],\n  },\n  {\n    name: 'Scheduling',\n    description: 'Calendar and meeting management',\n    icon: 'ðŸ“…',\n    tools: ['schedule_call', 'get_available_times', 'get_upcoming_bookings', 'book_meeting', 'reschedule_meeting', 'cancel_meeting'],\n  },\n  {\n    name: 'Product Lifecycle',\n    description: 'Project, PRD, and ticket management',\n    icon: 'ðŸ“‹',\n    tools: ['create_project', 'list_projects', 'create_prd', 'create_ticket', 'update_ticket', 'shard_prd', 'get_project_kanban', 'show_kanban_tasks'],\n  },\n  {\n    name: 'Memory',\n    description: 'Recursive Memory Layer operations',\n    icon: 'ðŸ§ ',\n    tools: ['remember', 'recall_preference', 'memorize', 'learn', 'forget'],\n  },\n  {\n    name: 'Working Context',\n    description: 'Active context management',\n    icon: 'ðŸŽ¯',\n    tools: ['set_active_context', 'get_active_context', 'load_context_from_reference'],\n  },\n  {\n    name: 'Repository',\n    description: 'Clone and explore codebases',\n    icon: 'ðŸ“¦',\n    tools: ['clone_repository', 'list_directory', 'search_codebase'],\n  },\n  {\n    name: 'Files',\n    description: 'Read and write files',\n    icon: 'ðŸ“„',\n    tools: ['read_file', 'write_file', 'edit_file', 'delete_file'],\n  },\n  {\n    name: 'Execution',\n    description: 'Run commands and start servers',\n    icon: 'âš¡',\n    tools: ['run_command', 'start_dev_server', 'get_preview_url'],\n  },\n  {\n    name: 'Git',\n    description: 'Version control operations',\n    icon: 'ðŸŒ¿',\n    tools: ['git_status', 'git_diff', 'git_commit', 'git_push', 'create_branch'],\n  },\n  {\n    name: 'Coding Tasks',\n    description: 'Track coding sessions',\n    icon: 'ðŸ’»',\n    tools: ['create_coding_task', 'update_coding_task', 'list_coding_tasks'],\n  },\n  {\n    name: 'UI Rendering',\n    description: 'Render custom UI components',\n    icon: 'ðŸ–¼ï¸',\n    tools: ['render_ui'],\n  },\n  {\n    name: 'Automation',\n    description: 'Scheduled jobs and cron tasks',\n    icon: 'â°',\n    tools: ['create_cron_job', 'list_cron_jobs', 'toggle_cron_job', 'delete_cron_job'],\n  },\n  {\n    name: 'Compaction',\n    description: 'Conversation summarization and context management',\n    icon: 'ðŸ“š',\n    tools: ['compact_conversation', 'get_compaction_summary'],\n  },\n  {\n    name: 'Channels',\n    description: 'Messaging platform integrations (WhatsApp, Telegram, etc.)',\n    icon: 'ðŸ’¬',\n    tools: ['list_channel_integrations', 'get_channel_conversations', 'send_channel_message', 'search_channel_messages'],\n  },\n];\n\n/**\n * Get tool categories filtered by access level\n */\nexport function getCategoriesForAccessLevel(accessLevel: AccessLevel): ToolCategory[] {\n  return TOOL_CATEGORIES.map((category) => ({\n    ...category,\n    tools: category.tools.filter((tool) => canAccessTool(tool, accessLevel)),\n  })).filter((category) => category.tools.length > 0);\n}\n\n// ============================================================================\n// Access Level Descriptions\n// ============================================================================\n\nexport const ACCESS_LEVEL_INFO: Record<AccessLevel, { name: string; description: string; color: string }> = {\n  owner: {\n    name: 'Owner',\n    description: 'Full access to all tools including coding, memory, and mutations',\n    color: 'emerald',\n  },\n  collaborator: {\n    name: 'Collaborator',\n    description: 'View and search access, no mutations or code execution',\n    color: 'blue',\n  },\n  visitor: {\n    name: 'Visitor',\n    description: 'Portfolio exploration only',\n    color: 'gray',\n  },\n};\n\n/**\n * Generate a description of what tools are available at each access level\n */\nexport function describeAccessLevel(accessLevel: AccessLevel): string {\n  const info = ACCESS_LEVEL_INFO[accessLevel];\n  const categories = getCategoriesForAccessLevel(accessLevel);\n  const toolCount = getToolsForAccessLevel(accessLevel).length;\n\n  const categoryNames = categories.map((c) => c.name).join(', ');\n\n  return `${info.name}: ${info.description}. ${toolCount} tools across ${categories.length} categories (${categoryNames}).`;\n}\n"],"names":[],"mappings":"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"}