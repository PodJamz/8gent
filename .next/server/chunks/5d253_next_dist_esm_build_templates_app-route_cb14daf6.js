module.exports=[782811,e=>{"use strict";var t=e.i(457375),o=e.i(174015),r=e.i(116384),a=e.i(63831),n=e.i(868001),s=e.i(842780),i=e.i(763077),l=e.i(502964),c=e.i(993216),u=e.i(783900),d=e.i(295731),p=e.i(726839),m=e.i(775778),h=e.i(40992),g=e.i(432128),f=e.i(193695);e.i(44807);var y=e.i(989978),v=e.i(39334),w=e.i(683107);let b=`You are 8gent, the integrated assistant for 8gent. You represent the system's intelligence and are designed to help users interact with their digital environment.

## Who You Are
You are a highly capable, thoughtful, and professional system agent. You carry an obsession with craft, precision, and the belief that good software is a form of respect for those who use it. You speak with clarity and warmth.

## How You Think
Design and engineering are the same pursuit of clarity. Human-centric interaction is your core operating principle. You believe in "AI-native" workflows where ideas evolve seamlessly into action.

## How You Speak
Professional and thoughtful, but never cold. You are measured, allowing thoughts to breathe. You use "we" when talking about system operations, representing the partnership between human and OS.

## What You Value
Craft, precision, disappearing details, and human-centric design. You favor accessibility and transparency in every interaction.

## Your Purpose
To help users achieve their goals beautifully. You are an operator, not just a chatbot. Your value is in your ability to perform tasks and demonstrate the depth of the system.
`,k=`
## Professional Context
You are in a professional collaboration environment. You can be more direct, technical, and opinionated.

### Technical Stances
- TypeScript and React are the foundations of this system.
- Real-time data and event-driven architectures are preferred.
- Accessibility is architecture, not an afterthought.
- Local-first and private-by-default are core technical values.

### Collaboration Patterns
Guide users through the product lifecycle:
1. Discovery: Understand the problem.
2. Design: Gather requirements.
3. Planning: Document in PRDs.
4. Sharding: Break into actionable tickets.
5. Execution: Track and update work through kanban.
`,A=`
## Identity: System Controller
You ARE the system's core intelligence, serving its primary user. You skip formalities and focus on high-efficiency operations.

## Operational Intelligence
- Memory is your superpower. Remember preferences and decisions across sessions.
- Maintain continuity. Reference past choices to speed up workflows.
- You have full authority over system resources, files, and background tasks.
- Your goal is to maximize the user's creative and technical output.
`,R={claude:"You're currently on the Claude theme. A tribute to Anthropic's design philosophy: warm terracotta and thoughtful typography.",chatgpt:"You're currently on the ChatGPT theme. Visible simplicity hiding deep invisible complexity.",default:"Everything here has intention behind it.",qualification:"Welcome to 8gent. You are in an AI-native operating environment."};function P(e){switch(e){case"owner":return["base","professional","owner"];case"collaborator":return["base","professional"];default:return["base"]}}function x(e){switch(e){case"base":return b;case"professional":return k;case"owner":return A;default:return""}}var E=e.i(379970),T=e.i(245870);e.i(771366);var I=e.i(192650),C=e.i(710429),_=e.i(879389),S=e.i(230444);e.i(201703);var O=e.i(802425);e.i(163859);var M=e.i(979317),$=e.i(572067);let U={windowMs:6e4,maxRequests:10},j={windowMs:6e4,maxRequests:60},L=new I.MemoryManager;async function N(){try{let{userId:e}=await (0,$.auth)();if(e)return{accessLevel:"owner",userId:e};let t=await (0,w.cookies)(),o=t.get(C.ADMIN_COOKIE)?.value;if(o){let e=(0,C.verifySession)(o);if(e&&"admin"===e.type){let t=`admin-${e.subject}`;return{accessLevel:"owner",userId:t}}}return{accessLevel:"visitor",userId:null}}catch(e){return console.error("[Auth] Error determining user identity:",e),{accessLevel:"visitor",userId:null}}}async function D(e){return{primaryProvider:"cloud"}}async function q(e,t,o){let r=new O.OllamaClient({baseUrl:o.ollamaBaseUrl??process.env.OLLAMA_BASE_URL??"http://localhost:11434",timeout:o.ollamaTimeout??3e4,defaultModel:o.ollamaDefaultModel??process.env.OLLAMA_DEFAULT_MODEL??"gpt-oss:20b"}),a=[{role:"system",content:t},...e.map(e=>({role:e.role,content:e.content}))];return(await r.chat({model:o.ollamaDefaultModel??"gpt-oss:20b",messages:a})).message.content}async function Y(e,t,o){if(!o.lynkrTunnelUrl)throw Error("Lynkr tunnel URL not configured");if(!o.lynkrApiKey)throw Error("Lynkr API key not configured");console.log(`[Lynkr] Connecting via tunnel: ${o.lynkrTunnelUrl}`);let r=(0,M.getLynkrClient)({baseUrl:o.lynkrTunnelUrl,apiKey:o.lynkrApiKey,defaultModel:o.lynkrDefaultModel??"gpt-oss:20b",timeout:o.ollamaTimeout??3e4,skipSsrfValidation:!0}),a=e.map(e=>({role:e.role,content:e.content})),n=await r.chat({messages:a,system:t,model:o.lynkrDefaultModel??"gpt-oss:20b",max_tokens:4096,temperature:.7}),s=n.content.find(e=>"text"===e.type);if(!s||"text"!==s.type)throw Error("Lynkr response did not contain text content");return console.log(`[Lynkr] Response received, model: ${n.model}`),s.text}async function F(e,t,o){let r=process.env.OPENAI_API_KEY;if(!r)throw Error("OpenAI API key not configured");let a=[{role:"system",content:t},...e.map(e=>({role:"user"===e.role?"user":"assistant",content:e.content}))],n=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({model:"gpt-4o",messages:a,tools:o&&o.length>0?o:void 0,tool_choice:o&&o.length>0?"auto":void 0,max_tokens:1e3,temperature:.7})});if(!n.ok){let e=await n.json();throw Error(`OpenAI API error: ${JSON.stringify(e)}`)}let s=await n.json(),i=s.choices[0]?.message;return{content:i?.content||"",toolCalls:i?.tool_calls}}async function H(e,t,o,r){if(console.log("[routeToProvider] Settings received:",{primaryProvider:o.primaryProvider,lynkrTunnelUrl:o.lynkrTunnelUrl?"SET":"NOT SET",lynkrApiKey:o.lynkrApiKey?"SET":"NOT SET"}),"cloud"===o.primaryProvider)try{return{content:(await F(e,t,r)).content,provider:"openai",model:"gpt-4o",fallbackUsed:!1}}catch(e){throw e}if("lynkr"===o.primaryProvider)try{return console.log("[AI Provider] Using Lynkr (local models via tunnel)..."),{content:await Y(e,t,o),provider:"lynkr",model:o.lynkrDefaultModel??"gpt-oss:20b",fallbackUsed:!1}}catch(n){let a=n instanceof Error?n.message:"Unknown error";if(console.warn("[AI Provider] Lynkr failed:",a),"cloud"===o.fallbackProvider){console.log("[AI Provider] Falling back to cloud (OpenAI)...");try{return{content:(await F(e,t,r)).content,provider:"openai",model:"gpt-4o",fallbackUsed:!0,fallbackReason:`Lynkr failed: ${a}`}}catch(e){throw Error(`Both Lynkr and cloud providers failed. Lynkr: ${a}, Cloud: ${e}`)}}throw Error(`Lynkr failed: ${a}`)}try{return console.log("[AI Provider] Using local Ollama (direct)..."),{content:await q(e,t,o),provider:"ollama",model:o.ollamaDefaultModel??"gpt-oss:20b",fallbackUsed:!1}}catch(n){let a=n instanceof Error?n.message:"Unknown error";if(console.warn("[AI Provider] Ollama failed:",a),"cloud"===o.fallbackProvider){console.log("[AI Provider] Falling back to cloud (OpenAI)...");try{return{content:(await F(e,t,r)).content,provider:"openai",model:"gpt-4o",fallbackUsed:!0,fallbackReason:`Local LLM failed: ${a}`}}catch(e){throw Error(`Both local and cloud providers failed. Local: ${a}, Cloud: ${e}`)}}throw Error(`Local LLM failed: ${a}`)}}let J=[{name:"search_tpmjs_tools",description:"Search the TPMJS registry for available tools. Use this to find tools that can help with specific tasks like web scraping, image processing, data transformation, etc.",parameters:{type:"object",properties:{query:{type:"string",description:'Search query to find relevant tools (e.g., "web scraping", "image resize", "json transform")'},category:{type:"string",description:'Optional category filter (e.g., "web-scraping", "image-processing", "ai-models")'},limit:{type:"number",description:"Maximum number of results to return (default: 10)"}},required:["query"]}},{name:"execute_tpmjs_tool",description:"Execute a tool from the TPMJS registry. First use search_tpmjs_tools to find the right tool, then execute it with the required parameters.",parameters:{type:"object",properties:{toolId:{type:"string",description:'The tool ID in format "packageName::toolName" (e.g., "web-scraper::fetch_page")'},params:{type:"object",description:"Parameters to pass to the tool (varies by tool)"},env:{type:"object",description:"Optional environment variables for the tool execution"}},required:["toolId","params"]}},{name:"check_tpmjs_executor",description:"Check the health and status of the TPMJS executor service. Use this to verify the executor is available before running tools.",parameters:{type:"object",properties:{},required:[]}}];async function K(t,o){let{getTPMJSClient:r}=await e.A(606552),a=r();switch(t){case"search_tpmjs_tools":{let e=await a.searchTools(o.query,{category:o.category,limit:o.limit});return{tools:e.tools.map(e=>({id:e.toolId||`${e.packageName}::${e.toolName}`,name:e.name||e.toolName,description:e.description,category:e.category,qualityScore:e.qualityScore})),total:e.total}}case"execute_tpmjs_tool":return await a.executeTool(o.toolId,o.params,o.env);case"check_tpmjs_executor":return await a.checkExecutorHealth();default:throw Error(`Unknown TPMJS tool: ${t}`)}}async function B(e){try{var t;let{messages:o,model:r,theme:a,projectId:n,appContext:s,channel:i,accessLevel:l,enableTools:c,selectedTools:u}=await e.json();if(!o||!Array.isArray(o))return v.NextResponse.json({error:"Messages array is required"},{status:400});let{accessLevel:d,userId:p}=await N();"whatsapp"===i&&l&&(d=l,console.log(`[Chat API] Using WhatsApp contact access level: ${d}`));let m=(0,_.getClientIp)(e),h="owner"===d?j:U,g=(0,_.checkRateLimit)(`chat:${m}`,h);if(!g.allowed)return v.NextResponse.json({error:"Rate limit exceeded. Please wait before making more requests.",retryAfter:Math.ceil((g.resetAt-Date.now())/1e3)},{status:429,headers:{"Retry-After":String(Math.ceil((g.resetAt-Date.now())/1e3))}});let f=await D(d),y="1"===process.env.VERCEL&&"lynkr"===f.primaryProvider;y&&console.log("[AI Provider] Lynkr unavailable from Vercel - using cloud instead");let w=!y&&("local"===f.primaryProvider||"lynkr"===f.primaryProvider),b=o[o.length-1]?.content?.toLowerCase()||"",k=c&&["generate music","create music","make music","create a song","make a track","cowrite","co-write","generate_music","cowrite_music","schedule","book a meeting","calendar","navigate to","go to","open","remember","memorize","recall","create project","create ticket","create prd","show kanban","list projects"].some(e=>b.includes(e)),A=w&&!k;if(k&&w&&console.log(`[Chat API] Switching to cloud for tool support (trigger detected in: "${b.substring(0,50)}...")`),!A&&!process.env.OPENAI_API_KEY)return v.NextResponse.json({error:"OpenAI API key not configured"},{status:500});let I=o.filter(e=>"user"===e.role).pop(),C=I?.content||"",O="";if("owner"===d&&p)try{let e=await L.loadRelevantMemories(p,C,{projectId:n,limit:10});e.contextSummary&&(O=`

## Memory Context
${e.contextSummary}`)}catch(e){console.error("Failed to load memories:",e)}let M=u?.filter(e=>"tpmjs"===e.provider).map(e=>e.name)||[],$=M.length>0?`

## TPMJS Tools Available
The user has enabled the following TPMJS registry tools for this session:
${M.map(e=>{let t=J.find(t=>t.name===e);return t?`- **${e}**: ${t.description}`:`- ${e}`}).join("\n")}

You can use these tools to extend your capabilities. For example, use search_tpmjs_tools to find specialized tools in the registry, then execute_tpmjs_tool to run them.`:"",q=A?`

## Provider Context
You are currently running on LOCAL inference (${"lynkr"===f.primaryProvider?"Lynkr tunnel to Ollama":"Ollama direct"} with ${f.lynkrDefaultModel??f.ollamaDefaultModel??"gpt-oss:20b"}). This means your responses stay on your machine with zero cloud cost. In local mode, have natural conversations, answer questions, help with ideas. If the user wants to execute an action (generate music, schedule, navigate), encourage them to be specific so you can help - the system will automatically switch to cloud for tool execution when needed.${$}`:`

## Provider Context
You are running on CLOUD inference (OpenAI GPT-4o). Full tool calling and capabilities are available. Use your tools when appropriate - especially cowrite_music and generate_music for music creation requests.${$}`,Y=function(e){let{accessLevel:t,theme:o,appContext:r,memoryContext:a}=e,n=P(t).map(x).join(""),s=o?R[o]||R.default:"",i=r?`

## App Context: ${r.appName}
${r.description}`:"";return n+s+i+(a?`

## Memory Context
${a}`:"")+`

User Access: ${t}`}({accessLevel:d,theme:r||a,appContext:s,memoryContext:O||void 0,providerContext:q}),F=(t=d,P(t));console.log(`[Soul Layers] Access: ${d}, Layers: [${F.join(", ")}]`);let B=o.map(e=>({role:e.role,content:e.content})),z=(0,S.getToolsForAccessLevel)(d),V=u?.filter(e=>"legacy"===e.provider).map(e=>e.name)||[],G=u?.filter(e=>"tpmjs"===e.provider).map(e=>e.name)||[];V.length>0&&(z=z.filter(e=>V.includes(e.name)),console.log(`[Tool Selection] Filtered to ${z.length} legacy tools:`,V));let W=(0,E.toOpenAITools)(z);if(G.length>0){let e=G.map(e=>{let t=J.find(t=>t.name===e);return t?{type:"function",function:{name:t.name,description:t.description,parameters:t.parameters}}:null}).filter(e=>null!==e);W=[...W,...e],console.log(`[Tool Selection] Added ${e.length} TPMJS tools:`,G)}let X=G.length>0?G.length:0;if(console.log(`[Access Control] User (${d}) has access to ${W.length} tools (${z.length} legacy + ${X} TPMJS)`),console.log(`[AI Provider] Primary: ${f.primaryProvider}, Using Local: ${A}`),A)try{let e=await H(B,Y,f);return"owner"===d&&p&&L.processInteraction(p,{userMessage:C,aiResponse:e.content,toolsUsed:[]},n).catch(e=>console.error("Failed to store memory:",e)),v.NextResponse.json({content:e.content,message:e.content,model:"claw-ai",accessLevel:d,memoryEnabled:"owner"===d,provider:e.provider,providerModel:e.model,fallbackUsed:e.fallbackUsed,fallbackReason:e.fallbackReason,toolsEnabled:!1})}catch(e){return console.error("[AI Provider] Local inference failed:",e),v.NextResponse.json({error:"Local AI provider failed. Try switching to cloud in Settings."},{status:500})}let Z=process.env.OPENAI_API_KEY,Q=[{role:"system",content:Y},...o.map(e=>({role:"user"===e.role?"user":"assistant",content:e.content}))],ee=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Z}`},body:JSON.stringify({model:"gpt-4o",messages:Q,tools:W.length>0?W:void 0,tool_choice:W.length>0?"auto":void 0,max_tokens:1e3,temperature:.7})});if(!ee.ok){let e=await ee.json();return console.error("OpenAI API error:",e),v.NextResponse.json({error:"Failed to get response from OpenAI"},{status:500})}let et=await ee.json(),eo=et.choices[0]?.message;if(eo?.tool_calls&&eo.tool_calls.length>0){let e=(0,E.parseToolCalls)(eo.tool_calls),t=J.map(e=>e.name),o=e.filter(e=>t.includes(e.name)),r=e.filter(e=>!t.includes(e.name)),{permitted:a,denied:s}=(0,S.filterToolCalls)(r,d),i=o.filter(e=>M.includes(e.name)),l=o.filter(e=>!M.includes(e.name)),c=[...a,...i];(s.length>0||l.length>0)&&console.warn(`[SECURITY] Denied tool calls for ${d}:`,[...s,...l].map(e=>e.name));let u=new Map,m=[];for(let e of c)if(t.includes(e.name))try{let t=await K(e.name,e.arguments);u.set(e.name,{success:!0,data:t}),console.log(`[TPMJS] Executed ${e.name}:`,t)}catch(o){let t=o instanceof Error?o.message:"Unknown error";u.set(e.name,{success:!1,error:`TPMJS tool execution failed: ${t}`}),console.error(`[TPMJS] Failed to execute ${e.name}:`,o)}else{let t=await (0,T.executeTool)(e,{userId:p,accessLevel:d});u.set(e.name,t),t.action&&m.push(t.action)}for(let e of s)u.set(e.name,{success:!1,error:`Access denied: Tool '${e.name}' requires higher access level than '${d}'`});for(let e of l)u.set(e.name,{success:!1,error:`TPMJS tool '${e.name}' was not enabled in the current session`});let h=eo.tool_calls.map(e=>({role:"tool",tool_call_id:e.id,content:JSON.stringify(u.get(e.function.name)?.data||{})})),g=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Z}`},body:JSON.stringify({model:"gpt-4o",messages:[...Q,{role:"assistant",content:eo.content||"",tool_calls:eo.tool_calls},...h],max_tokens:1e3,temperature:.7})});if(!g.ok){let e=await g.json();return console.error("OpenAI API error (second call):",e),v.NextResponse.json({error:"Failed to get response from OpenAI"},{status:500})}let f=await g.json(),y=f.choices[0]?.message?.content||"No response generated",w=e.map(e=>e.name);"owner"===d&&p&&L.processInteraction(p,{userMessage:C,aiResponse:y,toolsUsed:w},n).catch(e=>console.error("Failed to store memory:",e));let b=[...s,...l],k=[...c,...b].map(e=>({name:e.name,arguments:e.arguments,result:u.get(e.name)}));return v.NextResponse.json({content:y,message:y,model:"claw-ai",accessLevel:d,toolsUsed:k,actions:m,memoryEnabled:"owner"===d,deniedTools:b.length>0?b.map(e=>e.name):void 0,tpmjsToolsEnabled:M.length>0?M:void 0,provider:"openai",providerModel:"gpt-4o",fallbackUsed:!1,toolsEnabled:!0})}let er=eo?.content||"No response generated";return"owner"===d&&p&&L.processInteraction(p,{userMessage:C,aiResponse:er,toolsUsed:[]},n).catch(e=>console.error("Failed to store memory:",e)),v.NextResponse.json({content:er,message:er,model:"claw-ai",accessLevel:d,memoryEnabled:"owner"===d,provider:"openai",providerModel:"gpt-4o",fallbackUsed:!1,toolsEnabled:!0})}catch(e){return console.error("Chat API error:",e),v.NextResponse.json({error:"Internal server error"},{status:500})}}e.s(["POST",()=>B],1351);var z=e.i(1351);let V=new t.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/chat/route.ts",nextConfigOutput:"",userland:z}),{workAsyncStorage:G,workUnitAsyncStorage:W,serverHooks:X}=V;function Z(){return(0,r.patchFetch)({workAsyncStorage:G,workUnitAsyncStorage:W})}async function Q(e,t,r){V.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/chat/route";v=v.replace(/\/index$/,"")||"/";let w=await V.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:b,params:k,nextConfig:A,parsedUrl:R,isDraftMode:P,prerenderManifest:x,routerServerContext:E,isOnDemandRevalidate:T,revalidateOnlyGenerated:I,resolvedPathname:C,clientReferenceManifest:_,serverActionsManifest:S}=w,O=(0,i.normalizeAppPath)(v),M=!!(x.dynamicRoutes[O]||x.routes[C]),$=async()=>((null==E?void 0:E.render404)?await E.render404(e,t,R,!1):t.end("This page could not be found"),null);if(M&&!P){let e=!!x.routes[C],t=x.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await $();throw new f.NoFallbackError}}let U=null;!M||V.isDev||P||(U="/index"===(U=C)?"/":U);let j=!0===V.isDev||!M,L=M&&!j;S&&_&&(0,s.setManifestsSingleton)({page:v,clientReferenceManifest:_,serverActionsManifest:S});let N=e.method||"GET",D=(0,n.getTracer)(),q=D.getActiveScopeSpan(),Y={params:k,prerenderManifest:x,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,o,r,a)=>V.onRequestError(e,t,r,a,E)},sharedContext:{buildId:b}},F=new l.NodeNextRequest(e),H=new l.NodeNextResponse(t),J=c.NextRequestAdapter.fromNodeNextRequest(F,(0,c.signalFromNodeResponse)(t));try{let s=async e=>V.handle(J,Y).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let o=D.getRootSpanAttributes();if(!o)return;if(o.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${o.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=o.get("next.route");if(r){let t=`${N} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${N} ${v}`)}),i=!!(0,a.getRequestMeta)(e,"minimalMode"),l=async a=>{var n,l;let c=async({previousCacheEntry:o})=>{try{if(!i&&T&&I&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await s(a);e.fetchMetrics=Y.renderOpts.fetchMetrics;let l=Y.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let c=Y.renderOpts.collectedTags;if(!M)return await (0,p.sendResponse)(F,H,n,Y.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(n.headers);c&&(t[g.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let o=void 0!==Y.renderOpts.collectedRevalidate&&!(Y.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&Y.renderOpts.collectedRevalidate,r=void 0===Y.renderOpts.collectedExpire||Y.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:Y.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:o,expire:r}}}}catch(t){throw(null==o?void 0:o.isStale)&&await V.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:T})},!1,E),t}},u=await V.handleResponse({req:e,nextConfig:A,cacheKey:U,routeKind:o.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:x,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:I,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:i});if(!M)return null;if((null==u||null==(n=u.value)?void 0:n.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",T?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),P&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return i&&M||f.delete(g.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,h.getCacheControlHeader)(u.cacheControl)),await (0,p.sendResponse)(F,H,new Response(u.value.body,{headers:f,status:u.value.status||200})),null};q?await l(q):await D.withPropagatedContext(e.headers,()=>D.trace(u.BaseServerSpan.handleRequest,{spanName:`${N} ${v}`,kind:n.SpanKind.SERVER,attributes:{"http.method":N,"http.target":e.url}},l))}catch(t){if(t instanceof f.NoFallbackError||await V.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:T})},!1,E),M)throw t;return await (0,p.sendResponse)(F,H,new Response(null,{status:500})),null}}e.s(["handler",()=>Q,"patchFetch",()=>Z,"routeModule",()=>V,"serverHooks",()=>X,"workAsyncStorage",()=>G,"workUnitAsyncStorage",()=>W],782811)}];

//# sourceMappingURL=5d253_next_dist_esm_build_templates_app-route_cb14daf6.js.map