module.exports=[918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},163859,979317,e=>{"use strict";let t=[/^127\./,/^10\./,/^172\.(1[6-9]|2[0-9]|3[0-1])\./,/^192\.168\./,/^169\.254\./,/^0\./,/^100\.(6[4-9]|[7-9][0-9]|1[0-2][0-7])\./,/^::1$/,/^fc00:/i,/^fe80:/i,/^localhost$/i,/^.*\.local$/i,/metadata\.google\.internal/i,/169\.254\.169\.254/],r=["https:","http:"];function a(){return"true"===process.env.LYNKR_SKIP_SECURITY}function o(e){a()&&console.log("[Lynkr Audit]",JSON.stringify(e))}class n{config;constructor(e){const o=a(),n=e.skipApiKeyValidation??o,s=e.skipSsrfValidation??o;n||function(e,t){if(!t){if(!e||e.length<32){let e=Error("Lynkr API key must be at least 32 characters. Generate with: openssl rand -base64 48");throw e.code="INVALID_API_KEY",e}if(["lynkr-local","dummy","test","local","dev"].includes(e.toLowerCase())){let e=Error("Lynkr API key cannot be a default/test value. Generate a secure key.");throw e.code="INVALID_API_KEY",e}}}(e.apiKey,!1),s||function(e,a){if(!a)try{let a=new URL(e);if(!r.includes(a.protocol)){let e=Error(`URL scheme ${a.protocol} not allowed. Use http: or https:`);throw e.code="INVALID_URL",e}let o=a.hostname;for(let e of t)if(e.test(o)){let e=Error(`SSRF protection: ${o} is not allowed. Internal IPs are blocked.`);throw e.code="SSRF_BLOCKED",e}}catch(r){if(r.code)throw r;let t=Error(`Invalid URL: ${e}`);throw t.code="INVALID_URL",t}}(e.baseUrl,!1),this.config={baseUrl:e.baseUrl.replace(/\/$/,""),apiKey:e.apiKey??"",timeout:e.timeout??12e4,defaultModel:e.defaultModel??"gpt-oss:20b",skipApiKeyValidation:n,skipSsrfValidation:s}}async checkHealth(){let e=Date.now();try{let t=new AbortController,r=setTimeout(()=>t.abort(),5e3),a=await fetch(`${this.config.baseUrl}/health`,{method:"GET",signal:t.signal});if(clearTimeout(r),!a.ok)return{connected:!1,latencyMs:Date.now()-e,error:`HTTP ${a.status}: ${a.statusText}`};let o=await a.json();return{connected:!0,latencyMs:Date.now()-e,provider:o.provider,model:o.model,version:o.version,features:{memory:o.memory?.enabled??!1,tools:o.tools?.enabled??!0,streaming:o.streaming?.enabled??!0,embeddings:o.embeddings?.enabled??!1}}}catch(t){return{connected:!1,latencyMs:Date.now()-e,error:t instanceof Error?t.message:"Connection failed"}}}async getMetrics(){try{let e=await fetch(`${this.config.baseUrl}/metrics`,{method:"GET",signal:AbortSignal.timeout(5e3)});if(!e.ok)return null;return await e.json()}catch{return null}}async chat(e){let t=Date.now(),r=e.model??this.config.defaultModel,a={model:r,messages:e.messages,max_tokens:e.max_tokens??4096,temperature:e.temperature??.7,tools:e.tools,system:e.system,stream:!1},n=new AbortController,s=setTimeout(()=>n.abort(),this.config.timeout);try{let e=await fetch(`${this.config.baseUrl}/v1/messages`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.config.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify(a),signal:n.signal});if(clearTimeout(s),!e.ok){let a=await e.text(),n=Error(`Lynkr request failed: ${e.status} - ${a}`);throw o({timestamp:Date.now(),action:"chat",model:r,baseUrl:this.config.baseUrl,latencyMs:Date.now()-t,success:!1,error:n.message}),n}let i=await e.json();return o({timestamp:Date.now(),action:"chat",model:r,baseUrl:this.config.baseUrl,latencyMs:Date.now()-t,success:!0,inputTokens:i.usage?.input_tokens,outputTokens:i.usage?.output_tokens}),i}catch(e){throw clearTimeout(s),e instanceof Error&&e.message.includes("Lynkr request failed")||o({timestamp:Date.now(),action:"chat",model:r,baseUrl:this.config.baseUrl,latencyMs:Date.now()-t,success:!1,error:e instanceof Error?e.message:"Unknown error"}),e}}async *chatStream(e){let t={model:e.model??this.config.defaultModel,messages:e.messages,max_tokens:e.max_tokens??4096,temperature:e.temperature??.7,tools:e.tools,system:e.system,stream:!0},r=new AbortController,a=setTimeout(()=>r.abort(),this.config.timeout);try{let e=await fetch(`${this.config.baseUrl}/v1/messages`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.config.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify(t),signal:r.signal});if(clearTimeout(a),!e.ok){let t=await e.text();throw Error(`Lynkr stream failed: ${e.status} - ${t}`)}if(!e.body)throw Error("No response body for streaming");let o=e.body.getReader(),n=new TextDecoder,s="";for(;;){let{done:e,value:t}=await o.read();if(e)break;let r=(s+=n.decode(t,{stream:!0})).split("\n");for(let e of(s=r.pop()??"",r))if(e.startsWith("data: ")){let t=e.slice(6).trim();if("[DONE]"===t)return;try{let e=JSON.parse(t);yield e}catch{}}}}catch(e){throw clearTimeout(a),e}}static extractText(e){return e.content.filter(e=>"text"===e.type).map(e=>e.text).join("")}static extractToolCalls(e){return e.content.filter(e=>"tool_use"===e.type)}static hasToolCalls(e){return"tool_use"===e.stop_reason||e.content.some(e=>"tool_use"===e.type)}}function s(e){let t={baseUrl:process.env.LYNKR_BASE_URL,apiKey:process.env.LYNKR_API_KEY,timeout:process.env.LYNKR_TIMEOUT,defaultModel:process.env.LYNKR_DEFAULT_MODEL,skipSecurity:"true"===process.env.LYNKR_SKIP_SECURITY},r=e?.skipApiKeyValidation??e?.skipSsrfValidation??t.skipSecurity;return new n({baseUrl:e?.baseUrl??t.baseUrl??"http://localhost:8081",apiKey:e?.apiKey??t.apiKey,timeout:e?.timeout??parseInt(t.timeout??"120000",10),defaultModel:e?.defaultModel??t.defaultModel??"gpt-oss:20b",skipApiKeyValidation:r,skipSsrfValidation:r})}async function i(e){return s({baseUrl:e,skipApiKeyValidation:!0,skipSsrfValidation:!0}).checkHealth()}e.s(["checkLynkrHealth",()=>i,"getLynkrClient",()=>s],979317),e.s([],163859)},201703,802425,e=>{"use strict";class t{baseUrl;timeout;defaultModel;constructor(e){this.baseUrl=e.baseUrl.replace(/\/$/,""),this.timeout=e.timeout??3e4,this.defaultModel=e.defaultModel??"gpt-oss:20b"}async health(){let e=Date.now();try{let t,r=await this.fetchWithTimeout(`${this.baseUrl}/api/tags`,{method:"GET"});if(!r.ok)return{connected:!1,models:[],error:`Server returned ${r.status}`,latencyMs:Date.now()-e};let a=(await r.json()).models||[];try{let e=await this.fetchWithTimeout(`${this.baseUrl}/api/version`,{method:"GET"});e.ok&&(t=(await e.json()).version)}catch(e){console.debug("[Ollama] Version endpoint not available:",e)}return{connected:!0,version:t,models:a,latencyMs:Date.now()-e}}catch(t){return{connected:!1,models:[],error:t instanceof Error?t.message:"Connection failed",latencyMs:Date.now()-e}}}async listModels(){let e=await this.fetchWithTimeout(`${this.baseUrl}/api/tags`,{method:"GET"});if(!e.ok)throw Error(`Failed to list models: ${e.status}`);return(await e.json()).models||[]}async chat(e){let t=await this.fetchWithTimeout(`${this.baseUrl}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,model:e.model||this.defaultModel,stream:!1})});if(!t.ok){let e=await t.text();throw Error(`Chat failed: ${t.status} - ${e}`)}return t.json()}async *chatStream(e){let t=await this.fetchWithTimeout(`${this.baseUrl}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,model:e.model||this.defaultModel,stream:!0})});if(!t.ok){let e=await t.text();throw Error(`Chat stream failed: ${t.status} - ${e}`)}let r=t.body?.getReader();if(!r)throw Error("No response body");let a=new TextDecoder,o="";try{for(;;){let{done:e,value:t}=await r.read();if(e)break;let n=(o+=a.decode(t,{stream:!0})).split("\n");for(let e of(o=n.pop()||"",n))if(e.trim())try{let t=JSON.parse(e);yield t}catch(t){console.error("[Ollama] Malformed JSON in chat stream:",e.substring(0,100),t)}}if(o.trim())try{let e=JSON.parse(o);yield e}catch(e){console.error("[Ollama] Malformed JSON in chat buffer:",o.substring(0,100),e)}}finally{r.releaseLock()}}async generate(e){let t=await this.fetchWithTimeout(`${this.baseUrl}/api/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,model:e.model||this.defaultModel,stream:!1})});if(!t.ok){let e=await t.text();throw Error(`Generate failed: ${t.status} - ${e}`)}return t.json()}async *generateStream(e){let t=await this.fetchWithTimeout(`${this.baseUrl}/api/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,model:e.model||this.defaultModel,stream:!0})});if(!t.ok){let e=await t.text();throw Error(`Generate stream failed: ${t.status} - ${e}`)}let r=t.body?.getReader();if(!r)throw Error("No response body");let a=new TextDecoder,o="";try{for(;;){let{done:e,value:t}=await r.read();if(e)break;let n=(o+=a.decode(t,{stream:!0})).split("\n");for(let e of(o=n.pop()||"",n))if(e.trim())try{let t=JSON.parse(e);yield t}catch(t){console.error("[Ollama] Malformed JSON in generate stream:",e.substring(0,100),t)}}if(o.trim())try{let e=JSON.parse(o);yield e}catch(e){console.error("[Ollama] Malformed JSON in generate buffer:",o.substring(0,100),e)}}finally{r.releaseLock()}}async pullModel(e){let t=await fetch(`${this.baseUrl}/api/pull`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e})});if(!t.ok){let e=await t.text();throw Error(`Failed to pull model: ${t.status} - ${e}`)}let r=t.body?.getReader();if(r){for(new TextDecoder;;){let{done:e}=await r.read();if(e)break}r.releaseLock()}}async fetchWithTimeout(e,t){let r=new AbortController,a=setTimeout(()=>r.abort(),this.timeout);try{return await fetch(e,{...t,signal:r.signal})}catch(e){if(e instanceof Error&&"AbortError"===e.name)throw Error(`Request timed out after ${this.timeout}ms`);throw e}finally{clearTimeout(a)}}}async function r(e){return new t({baseUrl:e??process.env.OLLAMA_BASE_URL??"http://localhost:11434",timeout:5e3}).health()}e.s(["OllamaClient",()=>t,"checkOllamaHealth",()=>r],802425),e.s([],201703)},892622,e=>{"use strict";var t=e.i(457375),r=e.i(174015),a=e.i(116384),o=e.i(63831),n=e.i(868001),s=e.i(842780),i=e.i(763077),l=e.i(502964),c=e.i(993216),d=e.i(783900),u=e.i(295731),p=e.i(726839),h=e.i(775778),m=e.i(40992),f=e.i(432128),y=e.i(193695);e.i(44807);var g=e.i(989978),w=e.i(39334);e.i(201703);var b=e.i(802425);e.i(163859);var k=e.i(979317);async function v(e){return(0,b.checkOllamaHealth)(e)}async function E(){let e="true"===process.env.WHISPER_LOCAL_ENABLED;return e?{connected:e,enabled:e,latencyMs:0}:{connected:!1,enabled:!1,error:"Local Whisper not enabled"}}async function R(){let e=process.env.OPENAI_API_KEY;if(!e)return{connected:!1,error:"OPENAI_API_KEY not configured"};let t=Date.now();try{let r=await fetch("https://api.openai.com/v1/models",{method:"GET",headers:{Authorization:`Bearer ${e}`},signal:AbortSignal.timeout(5e3)});if(!r.ok)return{connected:!1,error:`API returned ${r.status}`,latencyMs:Date.now()-t};let a=await r.json(),o=a.data?.filter(e=>e.id.startsWith("gpt-"))?.map(e=>e.id)?.slice(0,10)||[];return{connected:!0,latencyMs:Date.now()-t,models:o}}catch(e){return{connected:!1,error:e instanceof Error?e.message:"Connection failed",latencyMs:Date.now()-t}}}async function x(){let e=process.env.ANTHROPIC_API_KEY;if(!e)return{connected:!1,error:"ANTHROPIC_API_KEY not configured"};let t=Date.now();try{let r=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"x-api-key":e,"anthropic-version":"2023-06-01","Content-Type":"application/json"},body:JSON.stringify({model:"claude-3-haiku-20240307",max_tokens:1,messages:[{role:"user",content:"hi"}]}),signal:AbortSignal.timeout(5e3)});if(r.ok||429===r.status)return{connected:!0,latencyMs:Date.now()-t,models:["claude-3-opus","claude-3-sonnet","claude-3-haiku"]};return{connected:!1,error:`API returned ${r.status}`,latencyMs:Date.now()-t}}catch(e){return{connected:!1,error:e instanceof Error?e.message:"Connection failed",latencyMs:Date.now()-t}}}async function T(e,t){let r=t?[t,e]:[e];for(let a of r){let r=await (0,k.checkLynkrHealth)(a);if(r.connected)return{baseUrl:e,tunnelUrl:t,connected:!0,latencyMs:r.latencyMs,provider:r.provider,version:r.version,features:r.features}}let a=await (0,k.checkLynkrHealth)(r[r.length-1]);return{baseUrl:e,tunnelUrl:t,connected:!1,latencyMs:a.latencyMs,error:a.error??"Lynkr not reachable"}}async function S(e){let{searchParams:t}=new URL(e.url),r=t.get("ollamaUrl")??process.env.OLLAMA_BASE_URL??"http://localhost:11434",a=t.get("lynkrUrl")??process.env.LYNKR_BASE_URL??"http://localhost:8081",o=t.get("lynkrTunnelUrl")??process.env.LYNKR_TUNNEL_URL,n="false"!==t.get("checkCloud"),s="false"!==t.get("checkLynkr"),[i,l,c,d,u]=await Promise.all([v(r),s?T(a,o):Promise.resolve({baseUrl:a,connected:!1,error:"Skipped"}),E(),n?R():Promise.resolve({connected:!1,error:"Skipped"}),n?x():Promise.resolve({connected:!1,error:"Skipped"})]),p=i.connected,h=l.connected,m=d.connected||u.connected,f="cloud";h?f="lynkr":p&&(!m||(i.latencyMs??0)<1e3)&&(f="local");let y={timestamp:Date.now(),providers:{ollama:{baseUrl:r,connected:i.connected,latencyMs:i.latencyMs,error:i.error,models:i.models.map(e=>e.name),version:i.version},lynkr:l,whisper:c,openai:d,anthropic:u},summary:{localAvailable:p,lynkrAvailable:h,cloudAvailable:m,recommendedProvider:f}};return w.NextResponse.json(y)}e.s(["GET",()=>S],501106);var A=e.i(501106);let U=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/health/providers/route",pathname:"/api/health/providers",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/health/providers/route.ts",nextConfigOutput:"",userland:A}),{workAsyncStorage:_,workUnitAsyncStorage:O,serverHooks:C}=U;function N(){return(0,a.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:O})}async function M(e,t,a){U.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/health/providers/route";w=w.replace(/\/index$/,"")||"/";let b=await U.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!b)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:k,params:v,nextConfig:E,parsedUrl:R,isDraftMode:x,prerenderManifest:T,routerServerContext:S,isOnDemandRevalidate:A,revalidateOnlyGenerated:_,resolvedPathname:O,clientReferenceManifest:C,serverActionsManifest:N}=b,M=(0,i.normalizeAppPath)(w),L=!!(T.dynamicRoutes[M]||T.routes[O]),P=async()=>((null==S?void 0:S.render404)?await S.render404(e,t,R,!1):t.end("This page could not be found"),null);if(L&&!x){let e=!!T.routes[O],t=T.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await P();throw new y.NoFallbackError}}let $=null;!L||U.isDev||x||($="/index"===($=O)?"/":$);let D=!0===U.isDev||!L,I=L&&!D;N&&C&&(0,s.setManifestsSingleton)({page:w,clientReferenceManifest:C,serverActionsManifest:N});let K=e.method||"GET",j=(0,n.getTracer)(),H=j.getActiveScopeSpan(),q={params:v,prerenderManifest:T,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,o)=>U.onRequestError(e,t,a,o,S)},sharedContext:{buildId:k}},J=new l.NodeNextRequest(e),Y=new l.NodeNextResponse(t),V=c.NextRequestAdapter.fromNodeNextRequest(J,(0,c.signalFromNodeResponse)(t));try{let s=async e=>U.handle(V,q).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=j.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${K} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${K} ${w}`)}),i=!!(0,o.getRequestMeta)(e,"minimalMode"),l=async o=>{var n,l;let c=async({previousCacheEntry:r})=>{try{if(!i&&A&&_&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await s(o);e.fetchMetrics=q.renderOpts.fetchMetrics;let l=q.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let c=q.renderOpts.collectedTags;if(!L)return await (0,p.sendResponse)(J,Y,n,q.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(n.headers);c&&(t[f.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==q.renderOpts.collectedRevalidate&&!(q.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&q.renderOpts.collectedRevalidate,a=void 0===q.renderOpts.collectedExpire||q.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:q.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await U.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:I,isOnDemandRevalidate:A})},!1,S),t}},d=await U.handleResponse({req:e,nextConfig:E,cacheKey:$,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:T,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:_,responseGenerator:c,waitUntil:a.waitUntil,isMinimalMode:i});if(!L)return null;if((null==d||null==(n=d.value)?void 0:n.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",A?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,h.fromNodeOutgoingHttpHeaders)(d.value.headers);return i&&L||y.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,m.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)(J,Y,new Response(d.value.body,{headers:y,status:d.value.status||200})),null};H?await l(H):await j.withPropagatedContext(e.headers,()=>j.trace(d.BaseServerSpan.handleRequest,{spanName:`${K} ${w}`,kind:n.SpanKind.SERVER,attributes:{"http.method":K,"http.target":e.url}},l))}catch(t){if(t instanceof y.NoFallbackError||await U.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:I,isOnDemandRevalidate:A})},!1,S),L)throw t;return await (0,p.sendResponse)(J,Y,new Response(null,{status:500})),null}}e.s(["handler",()=>M,"patchFetch",()=>N,"routeModule",()=>U,"serverHooks",()=>C,"workAsyncStorage",()=>_,"workUnitAsyncStorage",()=>O],892622)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__31a0a70d._.js.map