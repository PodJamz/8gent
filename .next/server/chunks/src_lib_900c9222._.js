module.exports=[550729,e=>{"use strict";let t="https://queue.fal.run",s={landscape_short:{name:"Landscape Short",width:768,height:512,num_frames:97,description:"16:9 landscape, 4 seconds"},landscape_long:{name:"Landscape Long",width:768,height:512,num_frames:145,description:"16:9 landscape, 6 seconds"},portrait_short:{name:"Portrait Short",width:512,height:768,num_frames:97,description:"9:16 portrait (stories/reels), 4 seconds"},portrait_long:{name:"Portrait Long",width:512,height:768,num_frames:145,description:"9:16 portrait (stories/reels), 6 seconds"},square:{name:"Square",width:512,height:512,num_frames:97,description:"1:1 square, 4 seconds"},cinematic:{name:"Cinematic",width:832,height:448,num_frames:121,description:"2.39:1 cinematic widescreen, 5 seconds"}};async function r(e,s,r){let o=process.env.FAL_KEY;if(!o)throw Error("FAL_KEY not configured");let n=r?.maxAttempts??180,a=r?.pollInterval??5e3,i=await fetch(`${t}/${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Key ${o}`},body:JSON.stringify(s)});if(!i.ok){let e=await i.text();throw Error(`LTX-2 submit error: ${e}`)}let c=await i.json(),l=`${t}/${e}/requests/${c.request_id}/status`,m=`${t}/${e}/requests/${c.request_id}`,p=0;for(;p<n;){await new Promise(e=>setTimeout(e,a));let e=await fetch(l,{headers:{Authorization:`Key ${o}`}});if(!e.ok){p++;continue}let t=await e.json();if(r?.onProgress?.(t.status,t.logs),"COMPLETED"===t.status){let e=await fetch(m,{headers:{Authorization:`Key ${o}`}});if(!e.ok)throw Error("Failed to fetch LTX-2 result");return e.json()}if("FAILED"===t.status)throw Error(`LTX-2 job failed: ${t.error||"Unknown error"}`);p++}throw Error("LTX-2 job timed out")}async function o(e,t){if(e.num_frames&&(e.num_frames-1)%8!=0){let t=8*Math.floor((e.num_frames-1)/8)+1;console.warn(`LTX-2: Correcting num_frames from ${e.num_frames} to ${t} (must be 8n+1)`),e.num_frames=t}return e.width&&e.width%32!=0&&(e.width=32*Math.floor(e.width/32)),e.height&&e.height%32!=0&&(e.height=32*Math.floor(e.height/32)),r("fal-ai/ltx-video",{prompt:e.prompt,negative_prompt:e.negative_prompt||"blurry, low quality, distorted, watermark",num_frames:e.num_frames||97,width:e.width||768,height:e.height||512,seed:e.seed,num_inference_steps:e.num_inference_steps||30,guidance_scale:e.guidance_scale||7.5},{onProgress:e=>t?.onProgress?.(e)})}async function n(e,t){if(e.num_frames&&(e.num_frames-1)%8!=0){let t=8*Math.floor((e.num_frames-1)/8)+1;e.num_frames=t}return r("fal-ai/ltx-video/image-to-video",{prompt:e.prompt,image_url:e.image_url,negative_prompt:e.negative_prompt||"blurry, low quality, distorted, watermark",num_frames:e.num_frames||97,seed:e.seed,num_inference_steps:e.num_inference_steps||30,guidance_scale:e.guidance_scale||7.5},{onProgress:e=>t?.onProgress?.(e)})}async function a(e,t,r){let a=s[t];if(!a)throw Error(`Unknown preset: ${t}`);return r?.image_url?n({prompt:e,image_url:r.image_url,negative_prompt:r.negative_prompt,num_frames:a.num_frames,seed:r.seed},{onProgress:r?.onProgress}):o({prompt:e,negative_prompt:r?.negative_prompt,width:a.width,height:a.height,num_frames:a.num_frames,seed:r?.seed},{onProgress:r?.onProgress})}function i(){return!!process.env.FAL_KEY}function c(e){return 8*Math.floor((Math.round(24*e)-1)/8)+1}e.s(["LTX_PRESETS",0,s,"generateVideoFromImage",()=>n,"generateVideoFromText",()=>o,"generateVideoWithPreset",()=>a,"getFrameCountForDuration",()=>c,"isLTXConfigured",()=>i])},163859,979317,e=>{"use strict";let t=[/^127\./,/^10\./,/^172\.(1[6-9]|2[0-9]|3[0-1])\./,/^192\.168\./,/^169\.254\./,/^0\./,/^100\.(6[4-9]|[7-9][0-9]|1[0-2][0-7])\./,/^::1$/,/^fc00:/i,/^fe80:/i,/^localhost$/i,/^.*\.local$/i,/metadata\.google\.internal/i,/169\.254\.169\.254/],s=["https:","http:"];function r(){return"true"===process.env.LYNKR_SKIP_SECURITY}function o(e){r()&&console.log("[Lynkr Audit]",JSON.stringify(e))}class n{config;constructor(e){const o=r(),n=e.skipApiKeyValidation??o,a=e.skipSsrfValidation??o;n||function(e,t){if(!t){if(!e||e.length<32){let e=Error("Lynkr API key must be at least 32 characters. Generate with: openssl rand -base64 48");throw e.code="INVALID_API_KEY",e}if(["lynkr-local","dummy","test","local","dev"].includes(e.toLowerCase())){let e=Error("Lynkr API key cannot be a default/test value. Generate a secure key.");throw e.code="INVALID_API_KEY",e}}}(e.apiKey,!1),a||function(e,r){if(!r)try{let r=new URL(e);if(!s.includes(r.protocol)){let e=Error(`URL scheme ${r.protocol} not allowed. Use http: or https:`);throw e.code="INVALID_URL",e}let o=r.hostname;for(let e of t)if(e.test(o)){let e=Error(`SSRF protection: ${o} is not allowed. Internal IPs are blocked.`);throw e.code="SSRF_BLOCKED",e}}catch(s){if(s.code)throw s;let t=Error(`Invalid URL: ${e}`);throw t.code="INVALID_URL",t}}(e.baseUrl,!1),this.config={baseUrl:e.baseUrl.replace(/\/$/,""),apiKey:e.apiKey??"",timeout:e.timeout??12e4,defaultModel:e.defaultModel??"gpt-oss:20b",skipApiKeyValidation:n,skipSsrfValidation:a}}async checkHealth(){let e=Date.now();try{let t=new AbortController,s=setTimeout(()=>t.abort(),5e3),r=await fetch(`${this.config.baseUrl}/health`,{method:"GET",signal:t.signal});if(clearTimeout(s),!r.ok)return{connected:!1,latencyMs:Date.now()-e,error:`HTTP ${r.status}: ${r.statusText}`};let o=await r.json();return{connected:!0,latencyMs:Date.now()-e,provider:o.provider,model:o.model,version:o.version,features:{memory:o.memory?.enabled??!1,tools:o.tools?.enabled??!0,streaming:o.streaming?.enabled??!0,embeddings:o.embeddings?.enabled??!1}}}catch(t){return{connected:!1,latencyMs:Date.now()-e,error:t instanceof Error?t.message:"Connection failed"}}}async getMetrics(){try{let e=await fetch(`${this.config.baseUrl}/metrics`,{method:"GET",signal:AbortSignal.timeout(5e3)});if(!e.ok)return null;return await e.json()}catch{return null}}async chat(e){let t=Date.now(),s=e.model??this.config.defaultModel,r={model:s,messages:e.messages,max_tokens:e.max_tokens??4096,temperature:e.temperature??.7,tools:e.tools,system:e.system,stream:!1},n=new AbortController,a=setTimeout(()=>n.abort(),this.config.timeout);try{let e=await fetch(`${this.config.baseUrl}/v1/messages`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.config.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify(r),signal:n.signal});if(clearTimeout(a),!e.ok){let r=await e.text(),n=Error(`Lynkr request failed: ${e.status} - ${r}`);throw o({timestamp:Date.now(),action:"chat",model:s,baseUrl:this.config.baseUrl,latencyMs:Date.now()-t,success:!1,error:n.message}),n}let i=await e.json();return o({timestamp:Date.now(),action:"chat",model:s,baseUrl:this.config.baseUrl,latencyMs:Date.now()-t,success:!0,inputTokens:i.usage?.input_tokens,outputTokens:i.usage?.output_tokens}),i}catch(e){throw clearTimeout(a),e instanceof Error&&e.message.includes("Lynkr request failed")||o({timestamp:Date.now(),action:"chat",model:s,baseUrl:this.config.baseUrl,latencyMs:Date.now()-t,success:!1,error:e instanceof Error?e.message:"Unknown error"}),e}}async *chatStream(e){let t={model:e.model??this.config.defaultModel,messages:e.messages,max_tokens:e.max_tokens??4096,temperature:e.temperature??.7,tools:e.tools,system:e.system,stream:!0},s=new AbortController,r=setTimeout(()=>s.abort(),this.config.timeout);try{let e=await fetch(`${this.config.baseUrl}/v1/messages`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.config.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify(t),signal:s.signal});if(clearTimeout(r),!e.ok){let t=await e.text();throw Error(`Lynkr stream failed: ${e.status} - ${t}`)}if(!e.body)throw Error("No response body for streaming");let o=e.body.getReader(),n=new TextDecoder,a="";for(;;){let{done:e,value:t}=await o.read();if(e)break;let s=(a+=n.decode(t,{stream:!0})).split("\n");for(let e of(a=s.pop()??"",s))if(e.startsWith("data: ")){let t=e.slice(6).trim();if("[DONE]"===t)return;try{let e=JSON.parse(t);yield e}catch{}}}}catch(e){throw clearTimeout(r),e}}static extractText(e){return e.content.filter(e=>"text"===e.type).map(e=>e.text).join("")}static extractToolCalls(e){return e.content.filter(e=>"tool_use"===e.type)}static hasToolCalls(e){return"tool_use"===e.stop_reason||e.content.some(e=>"tool_use"===e.type)}}function a(e){let t={baseUrl:process.env.LYNKR_BASE_URL,apiKey:process.env.LYNKR_API_KEY,timeout:process.env.LYNKR_TIMEOUT,defaultModel:process.env.LYNKR_DEFAULT_MODEL,skipSecurity:"true"===process.env.LYNKR_SKIP_SECURITY},s=e?.skipApiKeyValidation??e?.skipSsrfValidation??t.skipSecurity;return new n({baseUrl:e?.baseUrl??t.baseUrl??"http://localhost:8081",apiKey:e?.apiKey??t.apiKey,timeout:e?.timeout??parseInt(t.timeout??"120000",10),defaultModel:e?.defaultModel??t.defaultModel??"gpt-oss:20b",skipApiKeyValidation:s,skipSsrfValidation:s})}async function i(e){return a({baseUrl:e,skipApiKeyValidation:!0,skipSsrfValidation:!0}).checkHealth()}e.s(["checkLynkrHealth",()=>i,"getLynkrClient",()=>a],979317),e.s([],163859)},245290,e=>{"use strict";async function t(e,t){let s=t.baileysWebhookUrl||process.env.BAILEYS_WEBHOOK_URL;if(!s)return{success:!1,error:"Baileys webhook URL not configured",timestamp:Date.now()};try{let t=e.recipientId.includes("@")?e.recipientId:`${e.recipientId}@s.whatsapp.net`,r=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"sendMessage",remoteJid:t,text:e.content,...e.mediaUrl&&{mediaUrl:e.mediaUrl},...e.replyToMessageId&&{quotedMessageId:e.replyToMessageId}})});if(!r.ok){let e=await r.text();return{success:!1,error:e,timestamp:Date.now()}}let o=await r.json();return{success:!0,platformMessageId:o.messageId,timestamp:Date.now()}}catch(e){return{success:!1,error:e instanceof Error?e.message:"WhatsApp send failed",timestamp:Date.now()}}}async function s(e,t){let s=t.botToken||process.env.TELEGRAM_BOT_TOKEN;if(!s)return{success:!1,error:"Telegram bot token not configured",timestamp:Date.now()};try{let t=e.recipientId,r=await fetch(`https://api.telegram.org/bot${s}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:t,text:e.content,parse_mode:"Markdown",...e.replyToMessageId&&{reply_to_message_id:parseInt(e.replyToMessageId)}})});if(!r.ok){let e=await r.text();return{success:!1,error:e,timestamp:Date.now()}}let o=await r.json();return{success:!0,platformMessageId:String(o.result?.message_id),timestamp:Date.now()}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Telegram send failed",timestamp:Date.now()}}}async function r(e,t){let s=t.botToken||t.accessToken||process.env.SLACK_BOT_TOKEN;if(!s)return{success:!1,error:"Slack bot token not configured",timestamp:Date.now()};try{let t=await fetch("https://slack.com/api/chat.postMessage",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({channel:e.recipientId,text:e.content,mrkdwn:!0,...e.replyToMessageId&&{thread_ts:e.replyToMessageId}})}),r=await t.json();if(!r.ok)return{success:!1,error:r.error,timestamp:Date.now()};return{success:!0,platformMessageId:r.ts,timestamp:Date.now()}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Slack send failed",timestamp:Date.now()}}}async function o(e,t){let s=t.botToken||process.env.DISCORD_BOT_TOKEN;if(!s)return{success:!1,error:"Discord bot token not configured",timestamp:Date.now()};try{let t={content:e.content};e.replyToMessageId&&(t.message_reference={message_id:e.replyToMessageId});let r=await fetch(`https://discord.com/api/v10/channels/${e.recipientId}/messages`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bot ${s}`},body:JSON.stringify(t)});if(!r.ok){let e=await r.text();return{success:!1,error:e,timestamp:Date.now()}}let o=await r.json();return{success:!0,platformMessageId:o.id,timestamp:Date.now()}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Discord send failed",timestamp:Date.now()}}}async function n(e,t){let s=t.serverUrl||process.env.BLUEBUBBLES_SERVER_URL,r=t.serverPassword||process.env.BLUEBUBBLES_PASSWORD;if(!s||!r)return{success:!1,error:"BlueBubbles server not configured",timestamp:Date.now()};try{let t=await fetch(`${s}/api/v1/message/text`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({chatGuid:e.recipientId,message:e.content,method:"private-api"})});if(!t.ok){let e=await t.text();return{success:!1,error:e,timestamp:Date.now()}}let o=await t.json();return{success:!0,platformMessageId:o.data?.guid,timestamp:Date.now()}}catch(e){return{success:!1,error:e instanceof Error?e.message:"iMessage send failed",timestamp:Date.now()}}}async function a(t,s){let r=process.env.RESEND_API_KEY;if(!r)return{success:!1,error:"Resend API key not configured",timestamp:Date.now()};let o=s.fromEmail||process.env.CLAW_AI_EMAIL||"ai@openclaw.io";try{let{Resend:n}=await e.A(545283),a=new n(r),i=t.emailSubject||"Message from 8gent",c=`<div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333;">
      ${t.content.split("\n").map(e=>`<p style="margin: 0 0 1em 0;">${e}</p>`).join("")}
      <hr style="border: none; border-top: 1px solid #eee; margin: 2em 0;" />
      <p style="color: #666; font-size: 0.9em;">
        This message was sent by 8gent, 8gent's digital assistant.<br/>
        <a href="https://openclaw.io" style="color: #007AFF;">openclaw.io</a>
      </p>
    </div>`,{data:l,error:m}=await a.emails.send({from:`8gent <${o}>`,to:[t.recipientId],subject:i,text:t.content,html:c,replyTo:s.replyTo,headers:t.emailThreadId?{"In-Reply-To":t.emailThreadId}:void 0});if(m)return{success:!1,error:m.message,timestamp:Date.now()};return{success:!0,platformMessageId:l?.id,timestamp:Date.now()}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Email send failed",timestamp:Date.now()}}}async function i(e,i){let c=i||{};switch(e.platform){case"whatsapp":return t(e,c);case"telegram":return s(e,c);case"slack":return r(e,c);case"discord":return o(e,c);case"imessage":return n(e,c);case"email":return a(e,c);default:return{success:!1,error:`Unsupported platform: ${e.platform}`,timestamp:Date.now()}}}e.s(["sendMessage",()=>i])},771366,192650,886230,e=>{"use strict";var t=e.i(488782);class s{convex=null;constructor(e){const s=e||process.env.NEXT_PUBLIC_CONVEX_URL;s&&(this.convex=new t.ConvexHttpClient(s))}getClient(){if(!this.convex){let e=process.env.NEXT_PUBLIC_CONVEX_URL;if(!e)throw Error("NEXT_PUBLIC_CONVEX_URL not configured");this.convex=new t.ConvexHttpClient(e)}return this.convex}getApiRef(e){if(t.api){let s=e.split("."),r=t.api;for(let e of s)r&&(r=r[e]);if(r)return r}return e}async loadRelevantMemories(e,t,s={}){let{limit:r=10,includeEpisodic:o=!0,includeSemantic:n=!0,projectId:a}=s,[i,c]=await Promise.all([o?this.searchEpisodicMemories(e,t,a,r):[],n?this.loadSemanticMemories(e,this.extractCategories(t)):[]]),l=this.buildContextSummary(i,c);return{episodic:i,semantic:c,contextSummary:l}}async searchEpisodicMemories(e,t,s,r=10){return await this.getClient().query(this.getApiRef("memories.searchEpisodic"),{userId:e,query:t,projectId:s,limit:r})}async loadSemanticMemories(e,t){return await this.getClient().query(this.getApiRef("memories.getSemanticByCategories"),{userId:e,categories:t})}async getAllSemanticMemories(e){return await this.getClient().query(this.getApiRef("memories.getAllSemantic"),{userId:e})}async getRecentMemories(e,t,s=10){return await this.getClient().query(this.getApiRef("memories.getRecentEpisodic"),{userId:e,projectId:t,limit:s})}async storeEpisodicMemory(e,t,s,r,o,n){return await this.getClient().mutation(this.getApiRef("memories.storeEpisodic"),{userId:e,projectId:o,content:t,memoryType:s,importance:r,metadata:n})}async upsertSemanticMemory(e,t,s,r,o,n){return await this.getClient().mutation(this.getApiRef("memories.upsertSemantic"),{userId:e,category:t,key:s,value:r,confidence:o,source:n})}async processInteraction(e,t,s){let r=this.calculateImportance(t);if(r>.3){let o=this.classifyInteraction(t),n=this.summarizeInteraction(t);await this.storeEpisodicMemory(e,n,o,r,s,{toolsUsed:t.toolsUsed})}for(let s of this.extractPatterns(t))await this.upsertSemanticMemory(e,s.category,s.key,s.value,s.confidence,"interaction_learning")}extractCategories(e){let t=[],s=e.toLowerCase();return/prefer|like|style|theme|mode|favorite/.test(s)&&t.push("preference"),/skill|know|experience|proficient|expert|can you/.test(s)&&t.push("skill"),/pattern|usually|always|tend to|typically/.test(s)&&t.push("pattern"),/fact|is|are|does|what|who|where/.test(s)&&t.push("fact"),t.length>0?t:["preference","skill","pattern"]}buildContextSummary(e,t){let s=[];if(t.length>0){let e=t.sort((e,t)=>t.confidence-e.confidence).slice(0,5).map(e=>`- ${e.category}: ${e.value}`).join("\n");s.push(`User Context:
${e}`)}if(e.length>0){let t=e.sort((e,t)=>t.importance-e.importance).slice(0,3).map(e=>`- [${e.memoryType}] ${e.content}`).join("\n");s.push(`Recent History:
${t}`)}return s.join("\n\n")}calculateImportance(e){let t=.3;return/thanks|perfect|great|exactly|awesome|excellent/i.test(e.userMessage)&&(t+=.2),e.toolsUsed.length>2&&(t+=.15),/decide|choose|prefer|want|let's|go with/i.test(e.userMessage)&&(t+=.2),e.toolsUsed.some(e=>/create|update|delete/.test(e))&&(t+=.15),Math.min(t,1)}classifyInteraction(e){let t=e.userMessage.toLowerCase();return/thanks|great|perfect|awesome|excellent|love it/.test(t)?"feedback":/prefer|like|want|rather|always use|my favorite/.test(t)?"preference":/decide|choose|let's go with|use this|pick/.test(t)?"decision":e.toolsUsed.some(e=>/create_project|create_prd|shard_prd|launch/.test(e))?"milestone":"interaction"}summarizeInteraction(e){let t=e.userMessage.length>100?e.userMessage.slice(0,100)+"...":e.userMessage;return e.toolsUsed.length>0?`User: "${t}" â†’ Tools: ${e.toolsUsed.join(", ")}`:`User: "${t}"`}extractPatterns(e){let t=[],s=e.userMessage.toLowerCase();return/i prefer|i like|i want|my favorite|i always use/.test(s)&&t.push({category:"preference",key:`pref_${Date.now()}`,value:e.userMessage.slice(0,200),confidence:.7}),/i know|i can|experience with|proficient in|expert at/.test(s)&&t.push({category:"skill",key:`skill_${Date.now()}`,value:e.userMessage.slice(0,200),confidence:.6}),/i usually|i always|i tend to|typically i/.test(s)&&t.push({category:"pattern",key:`pattern_${Date.now()}`,value:e.userMessage.slice(0,200),confidence:.5}),t}async deleteEpisodicMemory(e,t){await this.getClient().mutation(this.getApiRef("memories.deleteEpisodic"),{memoryId:e,userId:t})}async deleteSemanticMemory(e,t){await this.getClient().mutation(this.getApiRef("memories.deleteSemantic"),{memoryId:e,userId:t})}async getStats(e){return await this.getClient().query(this.getApiRef("memories.getMemoryStats"),{userId:e})}}let r=null;function o(){return r||(r=new s),r}e.s(["MemoryManager",()=>s,"getMemoryManager",()=>o],192650);let n=`You are a memory extraction AI for a personal knowledge system. Your job is to analyze text and extract two types of memories:

## EPISODIC MEMORIES (Events/Interactions)
These are specific events, decisions, conversations, or milestones. Each should have:
- content: A clear, standalone summary of what happened (50-200 chars)
- memoryType: One of "interaction", "decision", "preference", "feedback", "milestone"
- importance: 0.0-1.0 (higher = more significant)

Memory type guidelines:
- "interaction": General conversations or exchanges
- "decision": Choices made, directions taken, options selected
- "preference": Expressed likes, dislikes, preferences for how things should be
- "feedback": Reactions to work, opinions given, reviews
- "milestone": Achievements, completions, launches, significant events

## SEMANTIC MEMORIES (Facts/Knowledge)
These are learned facts, preferences, patterns, and skills. Each should have:
- category: One of "preference", "skill", "pattern", "fact"
- key: A unique snake_case identifier (e.g., "preferred_coding_language", "communication_style")
- value: The actual knowledge/fact (clear, specific)
- confidence: 0.0-1.0 (how certain is this information)

Category guidelines:
- "preference": Likes, dislikes, preferred ways of doing things
- "skill": Abilities, expertise, proficiency levels
- "pattern": Behavioral patterns, habits, tendencies
- "fact": Objective facts about the person (location, job, etc.)

## RULES
1. Extract MEANINGFUL memories only - skip trivial/obvious content
2. Be specific and actionable in your extractions
3. Deduplicate - don't extract the same fact multiple times
4. For semantic memories, use consistent key naming (snake_case, descriptive)
5. Higher importance/confidence for explicitly stated things vs inferred
6. Include context when it adds value

Respond with valid JSON only, no markdown formatting.`;async function a(e,t){let s=process.env.OPENAI_API_KEY;if(!s)throw Error("OPENAI_API_KEY not configured");let r=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({model:"gpt-4o",max_tokens:4096,response_format:{type:"json_object"},messages:[{role:"system",content:e},{role:"user",content:t}]})});if(!r.ok){let e=await r.text();throw Error(`OpenAI API error: ${r.status} - ${e}`)}let o=await r.json();return o.choices?.[0]?.message?.content||""}async function i(e,t,s={}){let{maxEpisodic:r=50,maxSemantic:o=30}=s,c=e.length>5e4?e.slice(0,5e4)+"\n\n[Content truncated...]":e,l=`Analyze the following content from file "${t}" and extract memories.

<content>
${c}
</content>

Extract up to ${r} episodic memories and ${o} semantic memories.

Respond with this exact JSON structure:
{
  "episodicMemories": [
    {
      "content": "string",
      "memoryType": "interaction|decision|preference|feedback|milestone",
      "importance": 0.0-1.0,
      "context": "optional string"
    }
  ],
  "semanticMemories": [
    {
      "category": "preference|skill|pattern|fact",
      "key": "snake_case_key",
      "value": "string",
      "confidence": 0.0-1.0,
      "source": "optional string"
    }
  ],
  "summary": "Brief summary of what was extracted",
  "processingNotes": ["Any notes about the extraction process"]
}`;try{var m,p;let e,s,r=await a(n,l);if(!r)throw Error("No response from AI");return m=JSON.parse(r),p=t,e=["interaction","decision","preference","feedback","milestone"],s=["preference","skill","pattern","fact"],{episodicMemories:(m.episodicMemories||[]).filter(e=>e&&"string"==typeof e.content&&e.content.length>10).map(t=>({content:t.content.slice(0,500),memoryType:e.includes(t.memoryType)?t.memoryType:"interaction",importance:Math.max(0,Math.min(1,Number(t.importance)||.5)),context:t.context?String(t.context).slice(0,200):void 0})),semanticMemories:(m.semanticMemories||[]).filter(e=>e&&"string"==typeof e.key&&e.key.length>0&&"string"==typeof e.value&&e.value.length>0).map(e=>({category:s.includes(e.category)?e.category:"fact",key:e.key.toLowerCase().replace(/[^a-z0-9_]/g,"_").slice(0,50),value:e.value.slice(0,500),confidence:Math.max(0,Math.min(1,Number(e.confidence)||.5)),source:e.source?String(e.source).slice(0,100):`Extracted from ${p}`})),summary:m.summary||`Processed ${p}`,processingNotes:Array.isArray(m.processingNotes)?m.processingNotes.map(e=>String(e)):[]}}catch(e){return console.error("AI ingestion error:",e),{episodicMemories:[],semanticMemories:[],summary:`Failed to process ${t}`,processingNotes:[`Error: ${e instanceof Error?e.message:"Unknown error"}`]}}}async function c(e,t,s=3e4){if(e.length<=s)return i(e,t);let r=[],o="";for(let t of e.split(/\n\n+/))o.length+t.length>s?(o&&r.push(o),o=t):o+=(o?"\n\n":"")+t;o&&r.push(o);let n=[];for(let e=0;e<r.length;e++){let s=`${t} (part ${e+1}/${r.length})`,o=await i(r[e],s);n.push(o)}return function(e,t){let s=[],r=[],o=[];for(let t of e)s.push(...t.episodicMemories),r.push(...t.semanticMemories),o.push(...t.processingNotes);let n=new Map;for(let e of r){let t=n.get(e.key);(!t||e.confidence>t.confidence)&&n.set(e.key,e)}return{episodicMemories:s,semanticMemories:Array.from(n.values()),summary:`Processed ${t} in ${e.length} chunks`,processingNotes:o}}(n,t)}e.s(["processLargeContent",()=>c],886230),e.s([],771366)}];

//# sourceMappingURL=src_lib_900c9222._.js.map