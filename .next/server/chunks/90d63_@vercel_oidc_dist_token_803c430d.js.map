{"version":3,"sources":["../../../node_modules/.pnpm/%40vercel%2Boidc%403.2.0/node_modules/%40vercel/oidc/dist/token.js"],"sourcesContent":["\"use strict\";\nvar __defProp = Object.defineProperty;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __getOwnPropNames = Object.getOwnPropertyNames;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __export = (target, all) => {\n  for (var name in all)\n    __defProp(target, name, { get: all[name], enumerable: true });\n};\nvar __copyProps = (to, from, except, desc) => {\n  if (from && typeof from === \"object\" || typeof from === \"function\") {\n    for (let key of __getOwnPropNames(from))\n      if (!__hasOwnProp.call(to, key) && key !== except)\n        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\n  }\n  return to;\n};\nvar __toCommonJS = (mod) => __copyProps(__defProp({}, \"__esModule\", { value: true }), mod);\nvar token_exports = {};\n__export(token_exports, {\n  refreshToken: () => refreshToken\n});\nmodule.exports = __toCommonJS(token_exports);\nvar import_token_error = require(\"./token-error\");\nvar import_token_util = require(\"./token-util\");\nasync function refreshToken(options) {\n  let projectId = options?.project;\n  let teamId = options?.team;\n  if (!projectId && !teamId) {\n    const projectInfo = (0, import_token_util.findProjectInfo)();\n    projectId = projectInfo.projectId;\n    teamId = projectInfo.teamId;\n  } else if (!projectId || !teamId) {\n    const projectInfo = (0, import_token_util.findProjectInfo)();\n    projectId = projectId ?? projectInfo.projectId;\n    teamId = teamId ?? projectInfo.teamId;\n  }\n  if (!projectId) {\n    throw new import_token_error.VercelOidcTokenError(\n      \"Failed to refresh OIDC token: No project specified. Try re-linking your project with `vc link`\"\n    );\n  }\n  let maybeToken = (0, import_token_util.loadToken)(projectId);\n  if (!maybeToken || (0, import_token_util.isExpired)((0, import_token_util.getTokenPayload)(maybeToken.token), options?.expirationBufferMs)) {\n    const authToken = await (0, import_token_util.getVercelToken)({\n      expirationBufferMs: options?.expirationBufferMs\n    });\n    maybeToken = await (0, import_token_util.getVercelOidcToken)(authToken, projectId, teamId);\n    if (!maybeToken) {\n      throw new import_token_error.VercelOidcTokenError(\"Failed to refresh OIDC token\");\n    }\n    (0, import_token_util.saveToken)(maybeToken, projectId);\n  }\n  process.env.VERCEL_OIDC_TOKEN = maybeToken.token;\n  return;\n}\n// Annotate the CommonJS export names for ESM import in node:\n0 && (module.exports = {\n  refreshToken\n});\n"],"names":[],"mappings":"8CACA,IAAI,EAAY,OAAO,cAAc,CACjC,EAAmB,OAAO,wBAAwB,CAClD,EAAoB,OAAO,mBAAmB,CAC9C,EAAe,OAAO,SAAS,CAAC,cAAc,CAc9C,EAAgB,CAAC,EAbG,EAcA,CACtB,aAAc,IAAM,CACtB,EAfE,IAAK,IAAI,KAAQ,EACf,EAYK,EAZa,EAAM,CAAE,GAAhB,CAAqB,CAAG,CAAC,EAAK,CAAE,YAAY,CAAK,GAe/D,EAAO,OAAO,CALc,CARV,CAaD,AAbE,EAAI,IAAc,KACnC,GAAI,GAAwB,UAAhB,OAAO,GAAqC,YAAhB,AAA4B,OAArB,EAC7C,IAAK,IAAI,KAAO,EAAkB,GAC5B,AAAC,EAAa,CAAlB,GAAsB,CAAC,EAAI,SAHJ,IAGY,GACjC,EAAU,EAAI,CAD2B,CACtB,CAAE,IAAK,IAAM,CAAI,CAAC,EAAI,CAAE,WAAY,CAAC,CAAC,EAAO,EAAiB,EAAM,EAAA,CAAI,EAAK,EAAK,UAAU,AAAC,GAEtH,OAAO,CACT,GACwC,EAAU,CAAC,EAAG,aAAc,CAAE,OAAO,CAAK,GAKpD,CALwD,EAMtF,IAAI,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,OACJ,eAAe,EAAa,CAAO,EACjC,IAAI,EAAY,GAAS,QACrB,EAAS,GAAS,KACtB,GAAI,AAAC,GAAc,GAIZ,GAAI,CAAC,GAJM,AAIO,CAAC,EAAQ,CAChC,IAAM,EAAc,AAAC,GAAG,EAAkB,eAAA,AAAe,IACzD,EAAY,GAAa,EAAY,SAAS,CAC9C,EAAS,GAAU,EAAY,MAAM,CACvC,KAR2B,CACzB,IAAM,EAAc,CAAC,EAAG,EAAkB,eAAe,AAAf,IAC1C,EAAY,EAAY,SAAS,CACjC,EAAS,EAAY,MAAM,AAC7B,CAKA,GAAI,CAAC,EACH,MAAM,GADQ,CACJ,EAAmB,oBAAoB,CAC/C,kGAGJ,IAAI,EAAa,CAAC,EAAG,EAAkB,SAAA,AAAS,EAAE,GAClD,GAAI,CAAC,GAAc,CAAC,EAAG,EAAkB,SAAA,AAAS,EAAE,CAAC,EAAG,EAAkB,eAAA,AAAe,EAAE,EAAW,KAAK,EAAG,GAAS,oBAAqB,CAC1I,IAAM,EAAY,MAAM,CAAC,EAAG,EAAkB,cAAA,AAAc,EAAE,CAC5D,mBAAoB,GAAS,kBAC/B,GAEA,GAAI,CAAC,CADL,EAAa,MAAM,CAAC,EAAG,AACN,EADwB,kBAAA,AAAkB,EAAE,EAAW,EAAW,EAAA,EAEjF,MAAM,IAAI,EAAmB,oBAAoB,CAAC,gCAEpD,CAAC,EAAG,EAAkB,SAAA,AAAS,EAAE,EAAY,EAC/C,CACA,QAAQ,GAAG,CAAC,iBAAiB,CAAG,EAAW,KAAK,AAElD","ignoreList":[0]}