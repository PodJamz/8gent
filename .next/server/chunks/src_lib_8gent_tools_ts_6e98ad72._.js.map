{"version":3,"sources":["../../../src/lib/8gent/tools.ts","../../../src/lib/8gent/tool-executor.ts"],"sourcesContent":["/**\n * 8gent Tools - Tool definitions for search and actions\n *\n * These tools enable 8gent to:\n * - Search portfolio projects, skills, and experience\n * - Navigate users to specific pages\n * - Schedule calls\n */\n\nexport interface ToolParameter {\n  type: 'string' | 'number' | 'boolean' | 'array' | 'object';\n  description: string;\n  enum?: string[];\n  required?: boolean;\n  items?: { type: string; properties?: Record<string, { type: string }> }; // For array types\n}\n\nexport interface ToolDefinition {\n  name: string;\n  description: string;\n  parameters: {\n    type: 'object';\n    properties: Record<string, ToolParameter>;\n    required: string[];\n  };\n  ownerOnly?: boolean; // If true, only available to owner access level\n}\n\nexport interface ToolCall {\n  name: string;\n  arguments: Record<string, unknown>;\n}\n\nexport interface ToolResult {\n  success: boolean;\n  data?: unknown;\n  error?: string;\n  action?: ToolAction;\n  // Approval system (Phase 1.2 - OpenClaw Safety Stack)\n  requiresApproval?: boolean;\n  approval?: {\n    required: boolean;\n    reason: string;\n    actionType: 'destructive' | 'first_use' | 'expensive' | 'external';\n    toolName: string;\n    toolArgs: Record<string, unknown>;\n    consequences: string[];\n    approvalId: string;\n  };\n  // Cost estimation (Phase 1.3 - OpenClaw Safety Stack)\n  costEstimate?: {\n    estimatedTokens?: number;\n    estimatedTimeMs?: number;\n    estimatedApiCalls?: number;\n    estimatedCredits?: number;\n    breakdown?: Array<{\n      resource: string;\n      amount: number;\n      unit: string;\n      cost?: number;\n    }>;\n    warning?: string;\n    requiresConfirmation: boolean;\n  };\n}\n\n// Actions that the frontend should handle\nexport interface ToolAction {\n  type:\n  | 'navigate'\n  | 'open_calendar'\n  | 'show_results'\n  | 'show_available_times'\n  | 'show_bookings'\n  | 'booking_confirmed'\n  | 'render_ui'\n  | 'render_component'\n  | 'open_search'\n  | 'project_created'\n  | 'prd_created'\n  | 'ticket_created'\n  | 'ticket_updated'\n  | 'prd_sharded'\n  | 'show_kanban'\n  | 'memory_recalled'\n  | 'memory_stored'\n  | 'memory_learned'\n  | 'memory_deleted'\n  // Coding Agent Actions\n  | 'repo_cloned'\n  | 'file_read'\n  | 'file_written'\n  | 'directory_listed'\n  | 'files_searched'\n  | 'command_executed'\n  | 'server_started'\n  | 'preview_ready'\n  | 'git_status'\n  | 'git_diff'\n  | 'git_committed'\n  | 'git_pushed'\n  | 'branch_created'\n  | 'coding_task_created'\n  | 'coding_task_updated'\n  | 'context_updated'\n  | 'context_loaded'\n  // Cron Job Actions\n  | 'cron_job_created'\n  | 'cron_job_updated'\n  | 'cron_job_deleted'\n  | 'cron_jobs_listed'\n  // Compaction Actions\n  | 'conversation_compacted'\n  | 'compaction_retrieved'\n  // Channel Message Actions\n  | 'message_sent'\n  // ERV Dimension Actions\n  | 'dimension_created'\n  | 'dimension_navigated'\n  | 'dimensions_listed'\n  | 'entities_searched'\n  // Video/Remotion Actions\n  | 'video_composition_created'\n  | 'video_layer_added'\n  | 'video_lyrics_added'\n  | 'video_render_started'\n  | 'video_render_status'\n  | 'video_render_complete'\n  | 'video_preview_ready'\n  | 'lyrics_synced'\n  // Talking Video Actions\n  | 'talking_video_script_generated'\n  | 'talking_video_voice_generated'\n  | 'talking_video_background_generated'\n  | 'talking_video_complete'\n  | 'talking_video_error'\n  // LTX-2 Video Generation Actions\n  | 'video_generated'\n  | 'image_animated'\n  | 'video_presets_listed'\n  // Autonomous Execution Actions\n  | 'task_spawned'\n  | 'task_progress'\n  | 'task_completed'\n  | 'task_failed'\n  | 'task_cancelled'\n  | 'tasks_listed'\n  | 'iteration_started'\n  | 'iteration_progress'\n  | 'iteration_completed'\n  | 'specialist_delegated'\n  // AI Provider Actions\n  | 'check_provider_status'\n  // Design Canvas Actions\n  | 'canvas_created'\n  | 'canvases_listed'\n  | 'canvas_retrieved'\n  | 'canvas_node_added'\n  | 'canvas_edge_added'\n  | 'canvas_node_updated'\n  // ERV Ontology Actions\n  | 'entity_classified'\n  | 'relationships_suggested'\n  | 'bulk_classification_complete'\n  // Music Generation Actions\n  | 'music_generated'\n  | 'audio_analyzed'\n  | 'stems_separated'\n  | 'music_generation_started'\n  | 'music_generation_progress'\n  | 'music_generation_failed';\n  payload: Record<string, unknown>;\n}\n\n// Available navigation destinations\nexport const NAVIGATION_DESTINATIONS = [\n  'home',\n  'story',\n  'design',\n  'resume',\n  'projects',\n  'blog',\n  'music',\n  'humans',\n  'themes',\n  'photos',\n  'search',\n  'video',\n  'canvas',\n] as const;\n\nexport type NavigationDestination = (typeof NAVIGATION_DESTINATIONS)[number];\n\n// Tool definitions for OpenAI function calling\nexport const CLAW_AI_TOOLS: ToolDefinition[] = [\n  {\n    name: 'search_system',\n    description:\n      'Search through the system including projects, skills, work experience, and educational architecture. Use this when users ask about system capabilities, background, or modules.',\n    parameters: {\n      type: 'object',\n      properties: {\n        query: {\n          type: 'string',\n          description:\n            'The search query. Can be a technology name (React, AI), skill, company name, project name, or general topic.',\n        },\n        category: {\n          type: 'string',\n          description: 'Optional filter by category',\n          enum: ['projects', 'skills', 'work', 'education', 'all'],\n        },\n      },\n      required: ['query'],\n    },\n  },\n  {\n    name: 'navigate_to',\n    description:\n      'Navigate the user to a specific page in the workspace. Use this when users want to see specific content like the design showcase, system modules, projects, blog, or music.',\n    parameters: {\n      type: 'object',\n      properties: {\n        destination: {\n          type: 'string',\n          description: 'The page to navigate to',\n          enum: [...NAVIGATION_DESTINATIONS],\n        },\n        theme: {\n          type: 'string',\n          description:\n            'Optional theme name to apply when navigating (e.g., \"claude\", \"cyberpunk\", \"nature\")',\n        },\n      },\n      required: ['destination'],\n    },\n  },\n  {\n    name: 'schedule_call',\n    description:\n      'Open the calendar to schedule a call with the system owner. Use this when users express interest in connecting or collaborating.',\n    parameters: {\n      type: 'object',\n      properties: {\n        topic: {\n          type: 'string',\n          description:\n            'The topic or reason for the call to prefill in the calendar',\n        },\n      },\n      required: [],\n    },\n  },\n  {\n    name: 'get_available_times',\n    description:\n      'Get available meeting times for a specific date. Use this when users ask about availability or want to know when they can schedule a meeting.',\n    parameters: {\n      type: 'object',\n      properties: {\n        date: {\n          type: 'string',\n          description:\n            'The date to check availability for in YYYY-MM-DD format. If not provided, defaults to today.',\n        },\n        duration: {\n          type: 'number',\n          description:\n            'The meeting duration in minutes. Defaults to 30 minutes if not specified.',\n        },\n      },\n      required: [],\n    },\n  },\n  {\n    name: 'get_upcoming_bookings',\n    description:\n      'Get the upcoming scheduled meetings. Use this when users ask about the schedule or upcoming appointments.',\n    parameters: {\n      type: 'object',\n      properties: {\n        limit: {\n          type: 'number',\n          description: 'Maximum number of bookings to return. Defaults to 5.',\n        },\n      },\n      required: [],\n    },\n  },\n  {\n    name: 'book_meeting',\n    description:\n      'Book a meeting directly. Use this when a user wants to schedule a specific time slot and has provided their name and email.',\n    parameters: {\n      type: 'object',\n      properties: {\n        guestName: {\n          type: 'string',\n          description: 'The name of the person booking the meeting.',\n        },\n        guestEmail: {\n          type: 'string',\n          description: 'The email address of the person booking the meeting.',\n        },\n        startTime: {\n          type: 'number',\n          description: 'The Unix timestamp for the meeting start time.',\n        },\n        topic: {\n          type: 'string',\n          description: 'The topic or reason for the meeting.',\n        },\n        duration: {\n          type: 'number',\n          description: 'Meeting duration in minutes. Defaults to 30.',\n        },\n      },\n      required: ['guestName', 'guestEmail', 'startTime'],\n    },\n  },\n  {\n    name: 'reschedule_meeting',\n    description:\n      'Reschedule an existing meeting to a new time. Use this when a user wants to change the time of an already scheduled meeting.',\n    parameters: {\n      type: 'object',\n      properties: {\n        bookingId: {\n          type: 'string',\n          description: 'The ID of the booking to reschedule.',\n        },\n        newStartTime: {\n          type: 'number',\n          description: 'The new Unix timestamp for the meeting start time.',\n        },\n      },\n      required: ['bookingId', 'newStartTime'],\n    },\n  },\n  {\n    name: 'cancel_meeting',\n    description:\n      'Cancel a scheduled meeting. Use this when a user wants to cancel an existing booking.',\n    parameters: {\n      type: 'object',\n      properties: {\n        bookingId: {\n          type: 'string',\n          description: 'The ID of the booking to cancel.',\n        },\n        reason: {\n          type: 'string',\n          description: 'Optional reason for cancellation.',\n        },\n      },\n      required: ['bookingId'],\n    },\n  },\n  {\n    name: 'list_themes',\n    description:\n      'List all available design themes in the workspace. Use this when users ask about themes, design options, or want to explore the design showcase.',\n    parameters: {\n      type: 'object',\n      properties: {\n        category: {\n          type: 'string',\n          description: 'Optional filter by theme style',\n          enum: ['all', 'dark', 'light', 'colorful', 'minimal'],\n        },\n      },\n      required: [],\n    },\n  },\n  {\n    name: 'open_search_app',\n    description:\n      'Open the Search app with a specific query. Use this when users want to explore search results in detail, or when search results would be better viewed in the full Search app rather than inline in chat. This closes the 8gent chat and opens the Search app with the query pre-filled.',\n    parameters: {\n      type: 'object',\n      properties: {\n        query: {\n          type: 'string',\n          description: 'The search query to pre-fill in the Search app',\n        },\n      },\n      required: ['query'],\n    },\n  },\n  {\n    name: 'show_weather',\n    description:\n      'Display a weather widget in the chat. Use this when users ask about weather or want to see current conditions.',\n    parameters: {\n      type: 'object',\n      properties: {\n        location: {\n          type: 'string',\n          description: 'The location for weather (defaults to San Francisco)',\n        },\n      },\n      required: [],\n    },\n  },\n  {\n    name: 'show_kanban_tasks',\n    description:\n      'Display kanban tasks/tickets in the chat. Use this when users ask about projects, tasks, or want to see the roadmap.',\n    parameters: {\n      type: 'object',\n      properties: {\n        filter: {\n          type: 'string',\n          description: 'Filter tasks by status',\n          enum: ['all', 'todo', 'in-progress', 'done', 'backlog'],\n        },\n        tag: {\n          type: 'string',\n          description: 'Optional tag to filter by (e.g., \"P8\", \"claw-ai\")',\n        },\n        limit: {\n          type: 'number',\n          description: 'Maximum number of tasks to show (default 5)',\n        },\n      },\n      required: [],\n    },\n  },\n  {\n    name: 'show_photos',\n    description:\n      'Display photos from the gallery in the chat. Use this when users ask to see photos, images, or the gallery.',\n    parameters: {\n      type: 'object',\n      properties: {\n        count: {\n          type: 'number',\n          description: 'Number of photos to show (default 6)',\n        },\n      },\n      required: [],\n    },\n  },\n  {\n    name: 'render_ui',\n    description:\n      'Render custom UI components in the chat using a JSON UI tree. Use this to display rich, interactive UI when the built-in tools are not sufficient. You can create cards, lists, charts, stats, timelines, and many other components. The UI tree uses a flat structure with a root element and nested children.',\n    parameters: {\n      type: 'object',\n      properties: {\n        ui_tree: {\n          type: 'object',\n          description:\n            'A UI tree object with \"root\" (string key) and \"elements\" (object mapping keys to element definitions). Each element has: type (component name), props (component props), children (optional array of child keys), and key (unique identifier).',\n        },\n        title: {\n          type: 'string',\n          description: 'Optional title to show above the rendered UI',\n        },\n      },\n      required: ['ui_tree'],\n    },\n  },\n  // ==========================================================================\n  // Agentic Product Lifecycle Tools (ARC-002, ARC-003, ARC-006, ARC-007, ARC-009)\n  // Inspired by BMAD-METHOD and CCPM\n  // ==========================================================================\n  {\n    name: 'create_project',\n    description:\n      'Create a new product project. Use this when users want to start a new product initiative, app idea, or feature set. This creates a project container that can hold PRDs, epics, and tickets.',\n    parameters: {\n      type: 'object',\n      properties: {\n        name: {\n          type: 'string',\n          description: 'The name of the project (e.g., \"Weather App\", \"User Authentication\")',\n        },\n        description: {\n          type: 'string',\n          description: 'A brief description of what this project aims to accomplish',\n        },\n        color: {\n          type: 'string',\n          description: 'Optional hex color for the project (e.g., \"#8b5cf6\"). Defaults to purple.',\n        },\n      },\n      required: ['name'],\n    },\n  },\n  {\n    name: 'create_prd',\n    description:\n      'Create a Product Requirements Document (PRD) for a project. Use this when users want to define requirements, write specs, or document what they want to build. The PRD follows BMAD methodology with executive summary, problem statement, and functional requirements.',\n    parameters: {\n      type: 'object',\n      properties: {\n        projectId: {\n          type: 'string',\n          description: 'The ID of the project to create the PRD for',\n        },\n        title: {\n          type: 'string',\n          description: 'The title of the PRD (e.g., \"User Authentication PRD\")',\n        },\n        executiveSummary: {\n          type: 'string',\n          description: 'A brief executive summary of what this PRD covers',\n        },\n        problemStatement: {\n          type: 'string',\n          description: 'The problem this product/feature solves',\n        },\n      },\n      required: ['projectId', 'title'],\n    },\n  },\n  {\n    name: 'create_ticket',\n    description:\n      'Create a new ticket/story on the Kanban board. Use this when users want to add a task, bug, or story to track work. Tickets can optionally use the user story format (As a... I want... So that...).',\n    parameters: {\n      type: 'object',\n      properties: {\n        projectId: {\n          type: 'string',\n          description: 'The ID of the project to add the ticket to',\n        },\n        title: {\n          type: 'string',\n          description: 'The title of the ticket',\n        },\n        description: {\n          type: 'string',\n          description: 'Detailed description of the ticket',\n        },\n        type: {\n          type: 'string',\n          description: 'The type of ticket',\n          enum: ['story', 'bug', 'task', 'spike', 'chore'],\n        },\n        priority: {\n          type: 'string',\n          description: 'Priority level (P0=critical, P1=high, P2=medium, P3=low)',\n          enum: ['P0', 'P1', 'P2', 'P3'],\n        },\n        asA: {\n          type: 'string',\n          description: 'User story format: \"As a [user type]\"',\n        },\n        iWant: {\n          type: 'string',\n          description: 'User story format: \"I want [capability]\"',\n        },\n        soThat: {\n          type: 'string',\n          description: 'User story format: \"So that [benefit]\"',\n        },\n        labels: {\n          type: 'array',\n          items: { type: 'string' },\n          description: 'Labels/tags for the ticket',\n        },\n      },\n      required: ['projectId', 'title'],\n    },\n  },\n  {\n    name: 'update_ticket',\n    description:\n      'Update an existing ticket on the Kanban board. Use this to change status, priority, description, or any other ticket field. Can move tickets between columns.',\n    parameters: {\n      type: 'object',\n      properties: {\n        ticketId: {\n          type: 'string',\n          description: 'The human-readable ticket ID (e.g., \"PROJ-001\")',\n        },\n        status: {\n          type: 'string',\n          description: 'New status for the ticket',\n          enum: ['backlog', 'todo', 'in_progress', 'review', 'done', 'cancelled'],\n        },\n        priority: {\n          type: 'string',\n          description: 'New priority level',\n          enum: ['P0', 'P1', 'P2', 'P3'],\n        },\n        title: {\n          type: 'string',\n          description: 'New title for the ticket',\n        },\n        description: {\n          type: 'string',\n          description: 'New description for the ticket',\n        },\n        assigneeId: {\n          type: 'string',\n          description: 'User ID to assign the ticket to, or \"claw-ai\" for AI execution',\n        },\n      },\n      required: ['ticketId'],\n    },\n  },\n  {\n    name: 'shard_prd',\n    description:\n      'Shard a PRD into epics and tickets. This converts the functional requirements in a PRD into actionable Kanban tickets grouped by epics. Use this when a PRD is complete and ready for implementation planning.',\n    parameters: {\n      type: 'object',\n      properties: {\n        prdId: {\n          type: 'string',\n          description: 'The ID of the PRD to shard',\n        },\n        projectId: {\n          type: 'string',\n          description: 'The ID of the project the PRD belongs to',\n        },\n      },\n      required: ['prdId', 'projectId'],\n    },\n  },\n  {\n    name: 'get_project_kanban',\n    description:\n      'Get the Kanban board for a specific project. Shows all tickets organized by status columns (backlog, todo, in_progress, review, done).',\n    parameters: {\n      type: 'object',\n      properties: {\n        projectId: {\n          type: 'string',\n          description: 'The ID of the project to get the Kanban board for',\n        },\n      },\n      required: ['projectId'],\n    },\n  },\n  {\n    name: 'list_projects',\n    description:\n      'List all product projects. Use this when users want to see their projects, switch between projects, or find a specific project.',\n    parameters: {\n      type: 'object',\n      properties: {\n        status: {\n          type: 'string',\n          description: 'Optional filter by project status',\n          enum: ['discovery', 'design', 'planning', 'building', 'launched', 'archived'],\n        },\n      },\n      required: [],\n    },\n  },\n  // ==========================================================================\n  // Memory Tools (RLM - Recursive Memory Layer)\n  // These tools enable 8gent to actively manage memories for the owner\n  // Only available when speaking with James (owner identity)\n  // ==========================================================================\n  {\n    name: 'remember',\n    description:\n      'Search through memories to recall past interactions, decisions, preferences, and milestones. Use this when you need historical context to provide a better response. Only works for the owner.',\n    parameters: {\n      type: 'object',\n      properties: {\n        query: {\n          type: 'string',\n          description: 'The search query to find relevant memories (e.g., \"design decisions for 8gent\", \"preferences about UI\", \"milestones this month\")',\n        },\n        memoryType: {\n          type: 'string',\n          description: 'Optional filter by memory type',\n          enum: ['all', 'interaction', 'decision', 'preference', 'feedback', 'milestone'],\n        },\n        limit: {\n          type: 'number',\n          description: 'Maximum number of memories to return (default 10)',\n        },\n      },\n      required: ['query'],\n    },\n  },\n  {\n    name: 'recall_preference',\n    description:\n      'Recall specific preferences, patterns, or learned facts about the owner. Use this when you need to remember preferences (coding style, design choices, communication style) or patterns (work habits, typical workflows). Only works for the owner.',\n    parameters: {\n      type: 'object',\n      properties: {\n        category: {\n          type: 'string',\n          description: 'The category of preference to recall',\n          enum: ['preference', 'skill', 'pattern', 'fact'],\n        },\n        key: {\n          type: 'string',\n          description: 'Optional specific key to look up (e.g., \"coding_style\", \"preferred_theme\")',\n        },\n      },\n      required: ['category'],\n    },\n  },\n  {\n    name: 'memorize',\n    description:\n      'Store an important memory explicitly. Use this when something significant is mentioned that should be remembered: important decisions, preferences, milestones, or anything explicitly requested to be remembered. Only works for the owner.',\n    parameters: {\n      type: 'object',\n      properties: {\n        content: {\n          type: 'string',\n          description: 'The content to memorize (what happened, what was decided, what preference was expressed)',\n        },\n        memoryType: {\n          type: 'string',\n          description: 'The type of memory to store',\n          enum: ['interaction', 'decision', 'preference', 'feedback', 'milestone'],\n        },\n        importance: {\n          type: 'number',\n          description: 'Importance score from 0 to 1 (default 0.7). Higher = more likely to be recalled.',\n        },\n        projectId: {\n          type: 'string',\n          description: 'Optional project ID to associate this memory with',\n        },\n      },\n      required: ['content', 'memoryType'],\n    },\n  },\n  {\n    name: 'learn',\n    description:\n      'Learn a new fact, preference, skill, or pattern about the owner. Use this to update your understanding based on what you are told or what you observe. This creates or updates semantic memory. Only works for the owner.',\n    parameters: {\n      type: 'object',\n      properties: {\n        category: {\n          type: 'string',\n          description: 'The category of knowledge being learned',\n          enum: ['preference', 'skill', 'pattern', 'fact'],\n        },\n        key: {\n          type: 'string',\n          description: 'A unique key for this piece of knowledge (e.g., \"preferred_font\", \"coding_language_primary\")',\n        },\n        value: {\n          type: 'string',\n          description: 'The value/content of this knowledge (e.g., \"Inter\", \"TypeScript\")',\n        },\n        confidence: {\n          type: 'number',\n          description: 'Confidence level from 0 to 1 (default 0.7). Higher = more certain this is accurate.',\n        },\n      },\n      required: ['category', 'key', 'value'],\n    },\n  },\n  {\n    name: 'forget',\n    description:\n      'Remove a specific memory. Use this when explicitly asked to forget something, or when a memory is no longer accurate/relevant. Be careful - this permanently deletes the memory. Only works for the owner.',\n    parameters: {\n      type: 'object',\n      properties: {\n        memoryId: {\n          type: 'string',\n          description: 'The ID of the memory to delete',\n        },\n        memoryKind: {\n          type: 'string',\n          description: 'Whether this is an episodic memory (event/interaction) or semantic memory (fact/preference)',\n          enum: ['episodic', 'semantic'],\n        },\n      },\n      required: ['memoryId', 'memoryKind'],\n    },\n  },\n  // ==========================================================================\n  // OpenClaw Coding Tools - Full coding agent capabilities\n  // These tools enable 8gent to clone repos, read/write files, execute\n  // commands, and manage git operations. Only available for owner access level.\n  // @see docs/planning/infinity-agent-coding-integration.md\n  // ==========================================================================\n\n  // --------------------------------------------------------------------------\n  // Working Context Tools - \"Everything is Everything\"\n  // --------------------------------------------------------------------------\n  {\n    name: 'set_active_context',\n    description:\n      'Set the active working context. Use this when starting work on a specific project, ticket, or when the user @mentions an entity. This updates the context layer so all subsequent operations know what you are working on.',\n    parameters: {\n      type: 'object',\n      properties: {\n        projectId: {\n          type: 'string',\n          description: 'The ID of the active project',\n        },\n        projectSlug: {\n          type: 'string',\n          description: 'The slug of the active project (e.g., \"8gent\")',\n        },\n        prdId: {\n          type: 'string',\n          description: 'The ID of the active PRD',\n        },\n        ticketId: {\n          type: 'string',\n          description: 'The ID of the active ticket',\n        },\n        canvasId: {\n          type: 'string',\n          description: 'The ID of the active design canvas',\n        },\n        sandboxId: {\n          type: 'string',\n          description: 'The ID of the active sandbox',\n        },\n        repositoryUrl: {\n          type: 'string',\n          description: 'The URL of the active repository',\n        },\n      },\n      required: [],\n    },\n  },\n  {\n    name: 'get_active_context',\n    description:\n      'Get the current active working context including resolved entity details. Use this to understand what project, ticket, or PRD the user is currently working on before performing operations.',\n    parameters: {\n      type: 'object',\n      properties: {},\n      required: [],\n    },\n  },\n  {\n    name: 'load_context_from_reference',\n    description:\n      'Load full context chain from an @mention reference. When user mentions @ticket:ARC-042, this loads the ticket plus its parent project, PRD, epic, and related tickets. Use this to build rich context from a single reference.',\n    parameters: {\n      type: 'object',\n      properties: {\n        referenceType: {\n          type: 'string',\n          description: 'The type of reference being loaded',\n          enum: ['ticket', 'project', 'prd', 'epic', 'canvas', 'memory'],\n        },\n        referenceId: {\n          type: 'string',\n          description: 'The ID of the referenced entity (e.g., the ticket ID for @ticket:ARC-042)',\n        },\n      },\n      required: ['referenceType', 'referenceId'],\n    },\n  },\n\n  // --------------------------------------------------------------------------\n  // Repository Operations\n  // --------------------------------------------------------------------------\n  {\n    name: 'clone_repository',\n    description:\n      'Clone a GitHub repository to the sandbox environment. Use this when starting work on a codebase or when the user asks to work on a specific repo. This creates a sandbox with the repo ready for reading, writing, and executing code.',\n    parameters: {\n      type: 'object',\n      properties: {\n        url: {\n          type: 'string',\n          description: 'The GitHub repository URL (e.g., \"https://github.com/owner/repo\")',\n        },\n        branch: {\n          type: 'string',\n          description: 'Optional branch to checkout (defaults to main/master)',\n        },\n      },\n      required: ['url'],\n    },\n  },\n  {\n    name: 'list_directory',\n    description:\n      'List files and directories in a path within the sandbox. Use this to explore the codebase structure, find files, or understand the project layout.',\n    parameters: {\n      type: 'object',\n      properties: {\n        path: {\n          type: 'string',\n          description: 'The path to list (relative to repo root). Use \".\" or \"/\" for root.',\n        },\n        recursive: {\n          type: 'boolean',\n          description: 'If true, list files recursively (default: false)',\n        },\n        maxDepth: {\n          type: 'number',\n          description: 'Maximum depth for recursive listing (default: 3)',\n        },\n      },\n      required: ['path'],\n    },\n  },\n  {\n    name: 'search_codebase',\n    description:\n      'Search for text patterns in the codebase using grep/ripgrep. Use this to find function definitions, imports, usages, or any text pattern in the code.',\n    parameters: {\n      type: 'object',\n      properties: {\n        pattern: {\n          type: 'string',\n          description: 'The search pattern (supports regex)',\n        },\n        path: {\n          type: 'string',\n          description: 'Optional path to search within (defaults to entire repo)',\n        },\n        filePattern: {\n          type: 'string',\n          description: 'Optional file pattern filter (e.g., \"*.ts\", \"*.tsx\")',\n        },\n        caseSensitive: {\n          type: 'boolean',\n          description: 'Whether search is case-sensitive (default: false)',\n        },\n        maxResults: {\n          type: 'number',\n          description: 'Maximum number of results to return (default: 50)',\n        },\n      },\n      required: ['pattern'],\n    },\n  },\n\n  // --------------------------------------------------------------------------\n  // File Operations\n  // --------------------------------------------------------------------------\n  {\n    name: 'read_file',\n    description:\n      'Read the contents of a file from the sandbox. Use this to examine code, configuration files, or any text file. For large files, you can read specific line ranges.',\n    parameters: {\n      type: 'object',\n      properties: {\n        path: {\n          type: 'string',\n          description: 'The path to the file (relative to repo root)',\n        },\n        startLine: {\n          type: 'number',\n          description: 'Optional starting line number (1-indexed)',\n        },\n        endLine: {\n          type: 'number',\n          description: 'Optional ending line number (1-indexed)',\n        },\n      },\n      required: ['path'],\n    },\n  },\n  {\n    name: 'write_file',\n    description:\n      'Write content to a file in the sandbox. Use this to create new files or replace entire file contents. For surgical edits to existing files, prefer the edit_file tool.',\n    parameters: {\n      type: 'object',\n      properties: {\n        path: {\n          type: 'string',\n          description: 'The path to write to (relative to repo root)',\n        },\n        content: {\n          type: 'string',\n          description: 'The content to write to the file',\n        },\n        createDirectories: {\n          type: 'boolean',\n          description: 'Create parent directories if they do not exist (default: true)',\n        },\n      },\n      required: ['path', 'content'],\n    },\n  },\n  {\n    name: 'edit_file',\n    description:\n      'Make surgical edits to a file using search and replace. Use this for targeted changes to specific sections of a file. More precise than write_file for modifications.',\n    parameters: {\n      type: 'object',\n      properties: {\n        path: {\n          type: 'string',\n          description: 'The path to the file (relative to repo root)',\n        },\n        oldText: {\n          type: 'string',\n          description: 'The exact text to find and replace',\n        },\n        newText: {\n          type: 'string',\n          description: 'The text to replace it with',\n        },\n        replaceAll: {\n          type: 'boolean',\n          description: 'Replace all occurrences (default: false, replaces first only)',\n        },\n      },\n      required: ['path', 'oldText', 'newText'],\n    },\n  },\n  {\n    name: 'delete_file',\n    description:\n      'Delete a file or directory from the sandbox. Use with caution. For directories, must explicitly set recursive=true.',\n    parameters: {\n      type: 'object',\n      properties: {\n        path: {\n          type: 'string',\n          description: 'The path to delete (relative to repo root)',\n        },\n        recursive: {\n          type: 'boolean',\n          description: 'Required for directories - delete recursively',\n        },\n      },\n      required: ['path'],\n    },\n  },\n\n  // --------------------------------------------------------------------------\n  // Execution\n  // --------------------------------------------------------------------------\n  {\n    name: 'run_command',\n    description:\n      'Execute a shell command in the sandbox. Use this to run build commands, install dependencies, run tests, or any shell operation. Commands run in the repo root by default.',\n    parameters: {\n      type: 'object',\n      properties: {\n        command: {\n          type: 'string',\n          description: 'The command to execute (e.g., \"npm install\", \"pnpm build\")',\n        },\n        cwd: {\n          type: 'string',\n          description: 'Optional working directory (relative to repo root)',\n        },\n        timeout: {\n          type: 'number',\n          description: 'Timeout in milliseconds (default: 60000)',\n        },\n      },\n      required: ['command'],\n    },\n  },\n  {\n    name: 'start_dev_server',\n    description:\n      'Start a development server in the sandbox. Use this to preview the application. Returns a preview URL that can be accessed in the browser.',\n    parameters: {\n      type: 'object',\n      properties: {\n        command: {\n          type: 'string',\n          description: 'The command to start the server (e.g., \"npm run dev\", \"pnpm dev\")',\n        },\n        port: {\n          type: 'number',\n          description: 'The port the server will run on (default: 3000)',\n        },\n      },\n      required: [],\n    },\n  },\n  {\n    name: 'get_preview_url',\n    description:\n      'Get the preview URL for the running sandbox. Use this after starting a dev server to get the URL where the app can be previewed.',\n    parameters: {\n      type: 'object',\n      properties: {},\n      required: [],\n    },\n  },\n\n  // --------------------------------------------------------------------------\n  // Git Operations\n  // --------------------------------------------------------------------------\n  {\n    name: 'git_status',\n    description:\n      'Get the current git status showing modified, added, and deleted files. Use this to see what changes have been made before committing.',\n    parameters: {\n      type: 'object',\n      properties: {},\n      required: [],\n    },\n  },\n  {\n    name: 'git_diff',\n    description:\n      'Show the diff of changes in the working tree. Use this to review specific changes before committing.',\n    parameters: {\n      type: 'object',\n      properties: {\n        path: {\n          type: 'string',\n          description: 'Optional path to diff a specific file',\n        },\n        staged: {\n          type: 'boolean',\n          description: 'Show diff of staged changes only (default: false shows unstaged)',\n        },\n      },\n      required: [],\n    },\n  },\n  {\n    name: 'git_commit',\n    description:\n      'Commit staged changes with a message. Use this after making changes that should be saved as a commit. Stage files first using git_add.',\n    parameters: {\n      type: 'object',\n      properties: {\n        message: {\n          type: 'string',\n          description: 'The commit message describing the changes',\n        },\n        stageAll: {\n          type: 'boolean',\n          description: 'Stage all modified files before committing (default: false)',\n        },\n      },\n      required: ['message'],\n    },\n  },\n  {\n    name: 'git_push',\n    description:\n      'Push commits to the remote repository. Use this after committing to sync changes with GitHub. May require authentication for private repos.',\n    parameters: {\n      type: 'object',\n      properties: {\n        branch: {\n          type: 'string',\n          description: 'The branch to push (defaults to current branch)',\n        },\n        setUpstream: {\n          type: 'boolean',\n          description: 'Set upstream tracking for the branch (default: true for new branches)',\n        },\n      },\n      required: [],\n    },\n  },\n  {\n    name: 'create_branch',\n    description:\n      'Create and checkout a new git branch. Use this to start work on a feature or fix. Can auto-generate branch names from the active ticket context.',\n    parameters: {\n      type: 'object',\n      properties: {\n        name: {\n          type: 'string',\n          description: 'The branch name. If not provided, generates from active ticket (e.g., \"feature/arc-042-fix-bug\")',\n        },\n        fromBranch: {\n          type: 'string',\n          description: 'The branch to create from (defaults to current branch)',\n        },\n      },\n      required: [],\n    },\n  },\n\n  // --------------------------------------------------------------------------\n  // Coding Task Management\n  // --------------------------------------------------------------------------\n  {\n    name: 'create_coding_task',\n    description:\n      'Create a new coding task to track work. Links to projects/tickets and maintains conversation history. Use this when starting a significant coding session.',\n    parameters: {\n      type: 'object',\n      properties: {\n        title: {\n          type: 'string',\n          description: 'Title describing the coding task',\n        },\n        description: {\n          type: 'string',\n          description: 'Detailed description of what needs to be done',\n        },\n        projectId: {\n          type: 'string',\n          description: 'Optional project ID to link this task to',\n        },\n        ticketId: {\n          type: 'string',\n          description: 'Optional ticket ID this task implements',\n        },\n        repositoryUrl: {\n          type: 'string',\n          description: 'The repository URL for this task',\n        },\n      },\n      required: ['title', 'description'],\n    },\n  },\n  {\n    name: 'update_coding_task',\n    description:\n      'Update the status or details of a coding task. Use this to mark tasks as completed, failed, or update progress.',\n    parameters: {\n      type: 'object',\n      properties: {\n        taskId: {\n          type: 'string',\n          description: 'The ID of the coding task to update',\n        },\n        status: {\n          type: 'string',\n          description: 'New status for the task',\n          enum: ['pending', 'running', 'waiting_input', 'completed', 'failed', 'cancelled'],\n        },\n        filesModified: {\n          type: 'array',\n          items: { type: 'string' },\n          description: 'List of files that were modified',\n        },\n        commitSha: {\n          type: 'string',\n          description: 'The commit SHA if changes were committed',\n        },\n      },\n      required: ['taskId'],\n    },\n  },\n  {\n    name: 'list_coding_tasks',\n    description:\n      'List coding tasks for the current user. Use this to see recent or active coding sessions.',\n    parameters: {\n      type: 'object',\n      properties: {\n        status: {\n          type: 'string',\n          description: 'Optional filter by status',\n          enum: ['pending', 'running', 'waiting_input', 'completed', 'failed', 'cancelled'],\n        },\n        limit: {\n          type: 'number',\n          description: 'Maximum number of tasks to return (default: 10)',\n        },\n      },\n      required: [],\n    },\n  },\n\n  // =========================================================================\n  // Cron Jobs / Scheduled Automation\n  // User-defined scheduled jobs similar to Clawdbot's cron system\n  // =========================================================================\n  {\n    name: 'create_cron_job',\n    description:\n      'Create a scheduled job that runs automatically. Use this when the user wants to set up recurring reminders, automated AI messages, email notifications, or webhook triggers. Examples: \"Remind me every day at 9am to check emails\", \"Send me a summary every Monday morning\", \"Run a health check webhook every hour\".',\n    parameters: {\n      type: 'object',\n      properties: {\n        name: {\n          type: 'string',\n          description: 'A short, descriptive name for the job (e.g., \"Daily standup reminder\", \"Weekly summary\")',\n        },\n        description: {\n          type: 'string',\n          description: 'Optional longer description of what this job does',\n        },\n        scheduleType: {\n          type: 'string',\n          description: 'How often the job should run',\n          enum: ['once', 'interval', 'daily', 'weekly'],\n        },\n        scheduleTime: {\n          type: 'string',\n          description: 'When to run. For \"once\": ISO date string. For \"daily\"/\"weekly\": time in HH:MM format (24h). For \"interval\": number of minutes.',\n        },\n        daysOfWeek: {\n          type: 'array',\n          items: { type: 'number' },\n          description: 'For weekly jobs: which days to run (0=Sunday, 1=Monday, etc.)',\n        },\n        actionType: {\n          type: 'string',\n          description: 'What the job should do when triggered',\n          enum: ['ai_message', 'email', 'webhook'],\n        },\n        prompt: {\n          type: 'string',\n          description: 'For ai_message: the prompt to send to 8gent when the job runs',\n        },\n        emailSubject: {\n          type: 'string',\n          description: 'For email: the subject line',\n        },\n        emailBody: {\n          type: 'string',\n          description: 'For email: the message body',\n        },\n        recipientEmail: {\n          type: 'string',\n          description: 'For email: who to send to (defaults to user email)',\n        },\n        webhookUrl: {\n          type: 'string',\n          description: 'For webhook: the URL to call',\n        },\n        deliveryChannel: {\n          type: 'string',\n          description: 'Where to deliver AI responses (for ai_message jobs)',\n          enum: ['web', 'email', 'whatsapp', 'telegram'],\n        },\n        timezone: {\n          type: 'string',\n          description: 'Timezone for scheduling (e.g., \"America/Los_Angeles\", \"Europe/London\"). Defaults to UTC.',\n        },\n      },\n      required: ['name', 'scheduleType', 'actionType'],\n    },\n  },\n  {\n    name: 'list_cron_jobs',\n    description:\n      'List all scheduled jobs for the user. Use this when the user asks about their scheduled tasks, reminders, or automations.',\n    parameters: {\n      type: 'object',\n      properties: {\n        includeInactive: {\n          type: 'boolean',\n          description: 'Whether to include paused/inactive jobs. Defaults to false.',\n        },\n      },\n      required: [],\n    },\n  },\n  {\n    name: 'toggle_cron_job',\n    description:\n      'Pause or resume a scheduled job. Use this when the user wants to temporarily disable a job without deleting it.',\n    parameters: {\n      type: 'object',\n      properties: {\n        jobId: {\n          type: 'string',\n          description: 'The ID of the job to toggle',\n        },\n      },\n      required: ['jobId'],\n    },\n  },\n  {\n    name: 'delete_cron_job',\n    description:\n      'Permanently delete a scheduled job. Use this when the user wants to remove a job they no longer need.',\n    parameters: {\n      type: 'object',\n      properties: {\n        jobId: {\n          type: 'string',\n          description: 'The ID of the job to delete',\n        },\n      },\n      required: ['jobId'],\n    },\n  },\n\n  // ==========================================================================\n  // Conversation Compaction Tools\n  // ==========================================================================\n  {\n    name: 'compact_conversation',\n    description:\n      'Compress older messages in the conversation into a summary to save context space. ' +\n      'Use this when the user asks to summarize or compact the conversation, or when the ' +\n      'conversation is getting very long. This preserves key context while reducing token usage.',\n    parameters: {\n      type: 'object',\n      properties: {\n        sessionId: {\n          type: 'string',\n          description: 'The chat session ID to compact',\n        },\n        keepRecentCount: {\n          type: 'number',\n          description: 'Number of recent messages to keep uncompacted (default: 10)',\n        },\n        instructions: {\n          type: 'string',\n          description: 'Optional focus instructions for what to emphasize in the summary',\n        },\n      },\n      required: ['sessionId'],\n    },\n  },\n  {\n    name: 'get_compaction_summary',\n    description:\n      'Retrieve the existing compaction summary for a conversation session. ' +\n      'Use this to recall context from earlier in a long conversation.',\n    parameters: {\n      type: 'object',\n      properties: {\n        sessionId: {\n          type: 'string',\n          description: 'The chat session ID to get compaction for',\n        },\n      },\n      required: ['sessionId'],\n    },\n  },\n\n  // ==========================================================================\n  // Channel Integration Tools - WhatsApp, Telegram, iMessage, Slack, Discord\n  // ==========================================================================\n  {\n    name: 'list_channel_integrations',\n    description:\n      'List all connected messaging platform integrations. Use this to see which ' +\n      'channels (WhatsApp, Telegram, iMessage, Slack, Discord) are connected and their status.',\n    parameters: {\n      type: 'object',\n      properties: {\n        includeDisabled: {\n          type: 'boolean',\n          description: 'Include disabled integrations (default: false)',\n        },\n      },\n      required: [],\n    },\n  },\n  {\n    name: 'get_channel_conversations',\n    description:\n      'Get recent conversations from connected messaging platforms. Returns a unified ' +\n      'inbox view with contact info, last message, and unread counts.',\n    parameters: {\n      type: 'object',\n      properties: {\n        platform: {\n          type: 'string',\n          enum: ['whatsapp', 'telegram', 'imessage', 'slack', 'discord'],\n          description: 'Filter by specific platform (optional)',\n        },\n        limit: {\n          type: 'number',\n          description: 'Maximum conversations to return (default: 20)',\n        },\n      },\n      required: [],\n    },\n  },\n  {\n    name: 'send_channel_message',\n    description:\n      'Send a message via a connected messaging platform. Use this to reply to ' +\n      'conversations or send proactive messages through WhatsApp, Telegram, etc. ' +\n      'OWNER ONLY: Only the owner can send outbound messages.',\n    parameters: {\n      type: 'object',\n      properties: {\n        integrationId: {\n          type: 'string',\n          description: 'The channel integration ID to send through',\n        },\n        recipientId: {\n          type: 'string',\n          description: 'The recipient identifier (phone number, chat ID, etc.)',\n        },\n        content: {\n          type: 'string',\n          description: 'Message content to send',\n        },\n        messageType: {\n          type: 'string',\n          enum: ['text', 'voice'],\n          description: 'Message type (default: text)',\n        },\n      },\n      required: ['integrationId', 'recipientId', 'content'],\n    },\n    ownerOnly: true,\n  },\n  {\n    name: 'search_channel_messages',\n    description:\n      'Search messages across all connected messaging platforms. Useful for finding ' +\n      'past conversations, tracking topics, or locating specific information.',\n    parameters: {\n      type: 'object',\n      properties: {\n        query: {\n          type: 'string',\n          description: 'Search query',\n        },\n        platform: {\n          type: 'string',\n          enum: ['whatsapp', 'telegram', 'imessage', 'slack', 'discord'],\n          description: 'Filter by specific platform (optional)',\n        },\n        limit: {\n          type: 'number',\n          description: 'Maximum results to return (default: 20)',\n        },\n      },\n      required: ['query'],\n    },\n  },\n\n  // =============================================================================\n  // ERV Dimension Tools\n  // =============================================================================\n\n  {\n    name: 'create_dimension',\n    description:\n      'Create a custom dimension view for entities. Use this when users want to ' +\n      'visualize their data in a new way, like \"show me my tasks as a constellation\" ' +\n      'or \"create a timeline of my projects\". Dimensions define how entities are ' +\n      'arranged, styled, and connected.',\n    parameters: {\n      type: 'object',\n      properties: {\n        name: {\n          type: 'string',\n          description: 'Name for the dimension (e.g., \"Task Constellation\", \"Project Timeline\")',\n        },\n        metaphor: {\n          type: 'string',\n          description:\n            'Visual metaphor for the dimension. Affects styling and arrangement.',\n          enum: [\n            'river',\n            'board',\n            'constellation',\n            'solar',\n            'timeline',\n            'mosaic',\n            'ledger',\n            'vinyl',\n            'dungeon',\n            'tree',\n          ],\n        },\n        arrangement: {\n          type: 'string',\n          description: 'How entities are arranged spatially',\n          enum: ['list', 'grid', 'graph', 'tree', 'flow', 'orbit', 'stack'],\n        },\n        entityTypes: {\n          type: 'array',\n          items: { type: 'string' },\n          description:\n            'Types of entities to include (e.g., [\"Ticket\", \"Project\"]). Leave empty for all.',\n        },\n        description: {\n          type: 'string',\n          description: 'Optional description of what this dimension shows',\n        },\n      },\n      required: ['name', 'metaphor', 'arrangement'],\n    },\n  },\n  {\n    name: 'navigate_to_dimension',\n    description:\n      'Navigate to a dimension view. Use this when users want to see a specific ' +\n      'dimension like \"show me the kanban\", \"open the graph view\", or \"go to my feed\". ' +\n      'Can navigate to preset dimensions or custom ones created by the user.',\n    parameters: {\n      type: 'object',\n      properties: {\n        dimensionId: {\n          type: 'string',\n          description:\n            'ID of the dimension to navigate to. Presets: feed, kanban, graph, graph-3d, ' +\n            'calendar, grid, table, ipod, quest-log, skill-tree. Or a custom dimension ID.',\n        },\n      },\n      required: ['dimensionId'],\n    },\n  },\n  {\n    name: 'list_dimensions',\n    description:\n      'List all available dimensions including presets and custom user dimensions. ' +\n      'Use this when users ask \"what views do I have?\" or \"show me available dimensions\".',\n    parameters: {\n      type: 'object',\n      properties: {\n        includePresets: {\n          type: 'boolean',\n          description: 'Whether to include preset dimensions (default: true)',\n        },\n      },\n      required: [],\n    },\n  },\n  {\n    name: 'search_entities',\n    description:\n      'Search across all entities in the ERV system. Use this when users ask about ' +\n      'their data like \"find all high priority tickets\", \"show me projects tagged with AI\", ' +\n      'or \"what tracks do I have from last month\".',\n    parameters: {\n      type: 'object',\n      properties: {\n        query: {\n          type: 'string',\n          description: 'Search query to find entities',\n        },\n        entityTypes: {\n          type: 'array',\n          items: { type: 'string' },\n          description:\n            'Filter by entity types (e.g., [\"Ticket\", \"Project\", \"Track\"]). Leave empty for all.',\n        },\n        limit: {\n          type: 'number',\n          description: 'Maximum results to return (default: 20)',\n        },\n      },\n      required: ['query'],\n    },\n  },\n\n  // =============================================================================\n  // Video/Remotion Tools\n  // =============================================================================\n\n  {\n    name: 'create_video_composition',\n    description:\n      'Create a new video composition for creating videos, presentations, or lyric videos. ' +\n      'Use this when users want to create video content like \"make a lyric video for this song\", ' +\n      '\"create a presentation video\", or \"add text overlays to this video\".',\n    parameters: {\n      type: 'object',\n      properties: {\n        name: {\n          type: 'string',\n          description: 'Name for the video composition',\n        },\n        type: {\n          type: 'string',\n          description: 'Type of video to create',\n          enum: ['lyric-video', 'presentation', 'text-overlay', 'social-story', 'music-visualizer', 'slideshow', 'custom'],\n        },\n        preset: {\n          type: 'string',\n          description: 'Video format preset',\n          enum: ['instagram-story', 'instagram-post', 'instagram-reel', 'tiktok', 'youtube', 'youtube-short', 'twitter', '1080p', '720p', '4k', 'square', 'portrait'],\n        },\n        durationSeconds: {\n          type: 'number',\n          description: 'Duration of the video in seconds (default: 30)',\n        },\n        backgroundColor: {\n          type: 'string',\n          description: 'Background color (hex or CSS color)',\n        },\n        backgroundGradient: {\n          type: 'string',\n          description: 'Background gradient (CSS gradient string)',\n        },\n      },\n      required: ['name', 'type'],\n    },\n  },\n  {\n    name: 'add_text_overlay',\n    description:\n      'Add a text overlay to a video composition. Use this to add titles, captions, ' +\n      'watermarks, or any text content to videos. Supports animations and positioning.',\n    parameters: {\n      type: 'object',\n      properties: {\n        compositionId: {\n          type: 'string',\n          description: 'ID of the video composition to add text to',\n        },\n        text: {\n          type: 'string',\n          description: 'The text content to display',\n        },\n        position: {\n          type: 'string',\n          description: 'Position on screen',\n          enum: ['top-left', 'top-center', 'top-right', 'center-left', 'center', 'center-right', 'bottom-left', 'bottom-center', 'bottom-right'],\n        },\n        startTime: {\n          type: 'number',\n          description: 'When the text appears (in seconds)',\n        },\n        duration: {\n          type: 'number',\n          description: 'How long the text stays on screen (in seconds)',\n        },\n        fontSize: {\n          type: 'number',\n          description: 'Font size in pixels (default: 32)',\n        },\n        color: {\n          type: 'string',\n          description: 'Text color (default: white)',\n        },\n        animation: {\n          type: 'string',\n          description: 'Entry animation for the text',\n          enum: ['none', 'fade', 'slide-up', 'slide-down', 'slide-left', 'slide-right', 'scale', 'typewriter', 'blur', 'glitch'],\n        },\n      },\n      required: ['compositionId', 'text'],\n    },\n  },\n  {\n    name: 'add_lyrics_to_video',\n    description:\n      'Add synchronized lyrics to a video composition. Creates karaoke-style lyric videos ' +\n      'with word highlighting, bouncing text, or typewriter effects. Provide lyrics with timestamps.',\n    parameters: {\n      type: 'object',\n      properties: {\n        compositionId: {\n          type: 'string',\n          description: 'ID of the video composition',\n        },\n        audioSrc: {\n          type: 'string',\n          description: 'URL or path to the audio file',\n        },\n        lyrics: {\n          type: 'array',\n          items: {\n            type: 'object',\n            properties: {\n              text: { type: 'string' },\n              startTime: { type: 'number' },\n              endTime: { type: 'number' },\n            },\n          },\n          description: 'Array of lyric lines with timing: [{text, startTime, endTime}]',\n        },\n        style: {\n          type: 'string',\n          description: 'Lyric display style',\n          enum: ['karaoke', 'subtitle', 'bounce', 'typewriter'],\n        },\n        fontFamily: {\n          type: 'string',\n          description: 'Font family for lyrics (default: Inter)',\n        },\n        color: {\n          type: 'string',\n          description: 'Text color for lyrics',\n        },\n        highlightColor: {\n          type: 'string',\n          description: 'Highlight color for active words (karaoke style)',\n        },\n        position: {\n          type: 'string',\n          description: 'Vertical position of lyrics',\n          enum: ['top', 'center', 'bottom'],\n        },\n      },\n      required: ['compositionId', 'audioSrc', 'lyrics'],\n    },\n  },\n  {\n    name: 'add_media_to_video',\n    description:\n      'Add an image or video layer to a composition. Use for backgrounds, overlays, ' +\n      'or picture-in-picture effects.',\n    parameters: {\n      type: 'object',\n      properties: {\n        compositionId: {\n          type: 'string',\n          description: 'ID of the video composition',\n        },\n        mediaSrc: {\n          type: 'string',\n          description: 'URL or path to the media file (image or video)',\n        },\n        mediaType: {\n          type: 'string',\n          description: 'Type of media',\n          enum: ['image', 'video'],\n        },\n        startTime: {\n          type: 'number',\n          description: 'When the media appears (in seconds)',\n        },\n        duration: {\n          type: 'number',\n          description: 'How long the media stays on screen (in seconds)',\n        },\n        position: {\n          type: 'object',\n          description: 'Position {x, y} in pixels',\n        },\n        scale: {\n          type: 'number',\n          description: 'Scale factor (1 = original size)',\n        },\n        opacity: {\n          type: 'number',\n          description: 'Opacity 0-1',\n        },\n        objectFit: {\n          type: 'string',\n          description: 'How the media fits its container',\n          enum: ['contain', 'cover', 'fill'],\n        },\n      },\n      required: ['compositionId', 'mediaSrc', 'mediaType'],\n    },\n  },\n  {\n    name: 'preview_video',\n    description:\n      'Generate a preview of a video composition. Opens the video player with the current ' +\n      'composition state for review before rendering.',\n    parameters: {\n      type: 'object',\n      properties: {\n        compositionId: {\n          type: 'string',\n          description: 'ID of the video composition to preview',\n        },\n        openInCanvas: {\n          type: 'boolean',\n          description: 'Whether to open the preview in the infinite canvas (default: false)',\n        },\n      },\n      required: ['compositionId'],\n    },\n  },\n  {\n    name: 'render_video',\n    description:\n      'Render a video composition to a downloadable MP4/WebM/GIF file. Use mode=\"sandbox\" to ' +\n      'render locally using ffmpeg.wasm (free, no cloud needed) or mode=\"server\" for server-side ' +\n      'rendering. Sandbox mode is recommended for videos under 60 seconds.',\n    parameters: {\n      type: 'object',\n      properties: {\n        compositionId: {\n          type: 'string',\n          description: 'ID of the video composition to render',\n        },\n        format: {\n          type: 'string',\n          description: 'Output format',\n          enum: ['mp4', 'webm', 'gif'],\n        },\n        quality: {\n          type: 'string',\n          description: 'Quality preset (draft=fast/lower quality, high=best quality)',\n          enum: ['draft', 'standard', 'high'],\n        },\n        mode: {\n          type: 'string',\n          description: 'Render mode: sandbox (local, free) or server (cloud, costs $)',\n          enum: ['sandbox', 'server'],\n        },\n      },\n      required: ['compositionId'],\n    },\n  },\n  {\n    name: 'sync_lyrics_to_audio',\n    description:\n      'Automatically sync lyrics text to an audio file using AI transcription. Takes raw lyrics ' +\n      'and audio, returns timed lyric data ready for add_lyrics_to_video. Uses Whisper API for ' +\n      'word-level timestamp detection.',\n    parameters: {\n      type: 'object',\n      properties: {\n        audioSrc: {\n          type: 'string',\n          description: 'URL or path to the audio file',\n        },\n        lyrics: {\n          type: 'string',\n          description: 'Raw lyrics text (one line per lyric line, no timestamps needed)',\n        },\n        language: {\n          type: 'string',\n          description: 'Language code (e.g., \"en\", \"es\", \"fr\"). Auto-detected if not specified.',\n        },\n      },\n      required: ['audioSrc', 'lyrics'],\n    },\n  },\n  {\n    name: 'get_render_status',\n    description:\n      'Check the status of a video render job. Returns progress percentage, output URL when ' +\n      'complete, or error message if failed.',\n    parameters: {\n      type: 'object',\n      properties: {\n        jobId: {\n          type: 'string',\n          description: 'The render job ID returned from render_video',\n        },\n      },\n      required: ['jobId'],\n    },\n  },\n  {\n    name: 'add_particle_effect',\n    description:\n      'Add particle effects to a video composition. Creates confetti, snow, dust, sparks, ' +\n      'or custom particles. Great for celebrations, atmosphere, and visual interest.',\n    parameters: {\n      type: 'object',\n      properties: {\n        compositionId: {\n          type: 'string',\n          description: 'ID of the video composition',\n        },\n        effect: {\n          type: 'string',\n          description: 'Type of particle effect',\n          enum: ['confetti', 'snow', 'dust', 'sparks', 'bubbles', 'leaves', 'stars', 'custom'],\n        },\n        particleCount: {\n          type: 'number',\n          description: 'Number of particles (default: 100, max: 500)',\n        },\n        color: {\n          type: 'string',\n          description: 'Particle color (hex, CSS color, or \"multi\" for random colors)',\n        },\n        direction: {\n          type: 'string',\n          description: 'Direction of particle movement',\n          enum: ['up', 'down', 'left', 'right', 'random', 'explode'],\n        },\n        speed: {\n          type: 'number',\n          description: 'Speed multiplier (default: 1)',\n        },\n        gravity: {\n          type: 'number',\n          description: 'Gravity effect (0 = no gravity, 1 = normal)',\n        },\n        startTime: {\n          type: 'number',\n          description: 'When particles start (in seconds)',\n        },\n        duration: {\n          type: 'number',\n          description: 'How long particles last (in seconds)',\n        },\n      },\n      required: ['compositionId', 'effect'],\n    },\n  },\n  {\n    name: 'add_waveform_visualizer',\n    description:\n      'Add an audio waveform visualization to a video composition. Creates bars, lines, ' +\n      'circles, or mirror effects that respond to audio frequencies. Perfect for music videos.',\n    parameters: {\n      type: 'object',\n      properties: {\n        compositionId: {\n          type: 'string',\n          description: 'ID of the video composition',\n        },\n        audioSrc: {\n          type: 'string',\n          description: 'URL or path to the audio file',\n        },\n        style: {\n          type: 'string',\n          description: 'Visualization style',\n          enum: ['bars', 'line', 'circle', 'mirror', 'spectrum', 'pulse'],\n        },\n        color: {\n          type: 'string',\n          description: 'Waveform color (supports gradients with color1,color2 format)',\n        },\n        position: {\n          type: 'string',\n          description: 'Position of the waveform',\n          enum: ['top', 'center', 'bottom', 'full'],\n        },\n        barWidth: {\n          type: 'number',\n          description: 'Width of bars in pixels (for bars style)',\n        },\n        smoothing: {\n          type: 'number',\n          description: 'Smoothing factor 0-1 (higher = smoother)',\n        },\n        sensitivity: {\n          type: 'number',\n          description: 'Audio sensitivity multiplier (default: 1)',\n        },\n      },\n      required: ['compositionId', 'audioSrc', 'style'],\n    },\n  },\n  {\n    name: 'add_gradient_background',\n    description:\n      'Add an animated or static gradient background to a video composition. ' +\n      'Supports linear, radial, and conic gradients with optional animation.',\n    parameters: {\n      type: 'object',\n      properties: {\n        compositionId: {\n          type: 'string',\n          description: 'ID of the video composition',\n        },\n        colors: {\n          type: 'array',\n          items: { type: 'string' },\n          description: 'Array of colors for the gradient (2-5 colors)',\n        },\n        type: {\n          type: 'string',\n          description: 'Type of gradient',\n          enum: ['linear', 'radial', 'conic'],\n        },\n        angle: {\n          type: 'number',\n          description: 'Angle in degrees (for linear gradient)',\n        },\n        animate: {\n          type: 'boolean',\n          description: 'Whether to animate the gradient rotation',\n        },\n        animationSpeed: {\n          type: 'number',\n          description: 'Degrees per second for animation (default: 30)',\n        },\n      },\n      required: ['compositionId', 'colors'],\n    },\n  },\n  {\n    name: 'create_slideshow',\n    description:\n      'Create an automatic slideshow from multiple images. Applies Ken Burns effect, ' +\n      'transitions, and optional background music. Perfect for photo montages.',\n    parameters: {\n      type: 'object',\n      properties: {\n        name: {\n          type: 'string',\n          description: 'Name for the slideshow',\n        },\n        images: {\n          type: 'array',\n          items: { type: 'string' },\n          description: 'Array of image URLs or paths',\n        },\n        durationPerSlide: {\n          type: 'number',\n          description: 'Seconds per image (default: 3)',\n        },\n        transition: {\n          type: 'string',\n          description: 'Transition between slides',\n          enum: ['fade', 'slide', 'zoom', 'blur', 'wipe', 'none'],\n        },\n        transitionDuration: {\n          type: 'number',\n          description: 'Duration of transitions in seconds (default: 0.5)',\n        },\n        kenBurns: {\n          type: 'boolean',\n          description: 'Apply Ken Burns zoom/pan effect (default: true)',\n        },\n        backgroundMusic: {\n          type: 'string',\n          description: 'URL or path to background music (optional)',\n        },\n        preset: {\n          type: 'string',\n          description: 'Video format preset',\n          enum: ['instagram-story', 'instagram-post', 'tiktok', 'youtube', 'youtube-short', '1080p', 'square'],\n        },\n      },\n      required: ['name', 'images'],\n    },\n  },\n  {\n    name: 'add_cinematic_effect',\n    description:\n      'Apply cinematic effects to a video composition. Includes letterbox, color grading, ' +\n      'film grain, vignette, and more for a professional film look.',\n    parameters: {\n      type: 'object',\n      properties: {\n        compositionId: {\n          type: 'string',\n          description: 'ID of the video composition',\n        },\n        effect: {\n          type: 'string',\n          description: 'Cinematic effect to apply',\n          enum: ['letterbox', 'film_grain', 'vignette', 'color_grade', 'bloom', 'chromatic_aberration', 'lens_flare'],\n        },\n        intensity: {\n          type: 'number',\n          description: 'Effect intensity 0-1 (default: 0.5)',\n        },\n        colorGrade: {\n          type: 'string',\n          description: 'Color grading preset (for color_grade effect)',\n          enum: ['cinematic', 'vintage', 'cold', 'warm', 'noir', 'cyberpunk', 'pastel'],\n        },\n        letterboxRatio: {\n          type: 'string',\n          description: 'Aspect ratio for letterbox',\n          enum: ['2.35:1', '2.39:1', '1.85:1', '4:3'],\n        },\n      },\n      required: ['compositionId', 'effect'],\n    },\n  },\n  {\n    name: 'add_kinetic_typography',\n    description:\n      'Create kinetic typography animation - text that moves, scales, and transforms dynamically. ' +\n      'Perfect for music videos, title sequences, and promotional content.',\n    parameters: {\n      type: 'object',\n      properties: {\n        compositionId: {\n          type: 'string',\n          description: 'ID of the video composition',\n        },\n        text: {\n          type: 'string',\n          description: 'Text to animate (can include multiple lines)',\n        },\n        style: {\n          type: 'string',\n          description: 'Animation style',\n          enum: ['impact', 'wave', 'cascade', 'explosion', 'bounce', 'zoom', 'rotate', 'glitch'],\n        },\n        fontFamily: {\n          type: 'string',\n          description: 'Font family (default: Inter)',\n        },\n        fontSize: {\n          type: 'number',\n          description: 'Font size in pixels',\n        },\n        color: {\n          type: 'string',\n          description: 'Text color',\n        },\n        startTime: {\n          type: 'number',\n          description: 'When animation starts (in seconds)',\n        },\n        duration: {\n          type: 'number',\n          description: 'Animation duration (in seconds)',\n        },\n        syncToAudio: {\n          type: 'boolean',\n          description: 'Sync animation to audio beats (requires audio layer)',\n        },\n      },\n      required: ['compositionId', 'text', 'style'],\n    },\n  },\n  {\n    name: 'export_for_platform',\n    description:\n      'Export a video composition optimized for a specific social media platform. ' +\n      'Automatically adjusts resolution, bitrate, and format for optimal quality.',\n    parameters: {\n      type: 'object',\n      properties: {\n        compositionId: {\n          type: 'string',\n          description: 'ID of the video composition to export',\n        },\n        platform: {\n          type: 'string',\n          description: 'Target platform',\n          enum: ['instagram_story', 'instagram_reel', 'instagram_post', 'tiktok', 'youtube', 'youtube_short', 'twitter', 'linkedin', 'facebook'],\n        },\n        includeCaption: {\n          type: 'boolean',\n          description: 'Include burned-in captions if available',\n        },\n        includeSafeZone: {\n          type: 'boolean',\n          description: 'Add safe zone guides for platform UI elements',\n        },\n      },\n      required: ['compositionId', 'platform'],\n    },\n  },\n  {\n    name: 'list_video_compositions',\n    description:\n      'List all video compositions. Returns composition IDs, names, types, and preview info.',\n    parameters: {\n      type: 'object',\n      properties: {\n        filter: {\n          type: 'string',\n          description: 'Filter by type (optional)',\n          enum: ['lyric-video', 'presentation', 'text-overlay', 'social-story', 'music-visualizer', 'slideshow', 'all'],\n        },\n        limit: {\n          type: 'number',\n          description: 'Maximum number of results (default: 20)',\n        },\n      },\n      required: [],\n    },\n  },\n\n  // =============================================================================\n  // Image Processing & Effects Tools\n  // =============================================================================\n\n  {\n    name: 'apply_image_effect',\n    description:\n      'Apply visual effects to an image. Includes halftone, duotone, blur, glitch, vintage, ' +\n      'cyberpunk, noir, and more. Use for creating unique branded looks, artistic transformations, ' +\n      'or consistent visual identity.',\n    parameters: {\n      type: 'object',\n      properties: {\n        imageSrc: {\n          type: 'string',\n          description: 'Image URL, base64 data, or file path',\n        },\n        effect: {\n          type: 'string',\n          description: 'Effect type to apply',\n          enum: [\n            'halftone', 'duotone', 'posterize', 'pixelate', 'ascii', 'line-art',\n            'grayscale', 'sepia', 'invert', 'hue-shift', 'saturate', 'color-replace',\n            'gaussian-blur', 'motion-blur', 'radial-blur', 'zoom-blur', 'tilt-shift',\n            'swirl', 'bulge', 'pinch', 'wave', 'ripple', 'fisheye',\n            'noise', 'film-grain', 'scanlines', 'vignette',\n            'oil-paint', 'watercolor', 'sketch', 'comic', 'glitch',\n            'vintage', 'cyberpunk', 'noir', 'pop-art', 'blueprint'\n          ],\n        },\n        params: {\n          type: 'object',\n          description: 'Effect-specific parameters (e.g., { frequency: 45, angle: 45, shape: \"line\" } for halftone)',\n        },\n        outputFormat: {\n          type: 'string',\n          description: 'Output image format',\n          enum: ['png', 'jpg', 'webp'],\n        },\n        quality: {\n          type: 'number',\n          description: 'Output quality 0-100 (default: 90)',\n        },\n      },\n      required: ['imageSrc', 'effect'],\n    },\n  },\n  {\n    name: 'generate_app_icon',\n    description:\n      'Generate a unique app icon with specified style and effects. Creates multiple sizes ' +\n      'suitable for iOS, Android, and web. Perfect for creating consistent branded icons.',\n    parameters: {\n      type: 'object',\n      properties: {\n        name: {\n          type: 'string',\n          description: 'App name (used for naming output files)',\n        },\n        style: {\n          type: 'string',\n          description: 'Icon visual style',\n          enum: ['flat', 'gradient', 'glassmorphism', 'neumorphic', 'illustrated', '3d', 'halftone', 'minimal'],\n        },\n        primaryColor: {\n          type: 'string',\n          description: 'Primary brand color (hex)',\n        },\n        secondaryColor: {\n          type: 'string',\n          description: 'Secondary color for gradients (hex, optional)',\n        },\n        backgroundColor: {\n          type: 'string',\n          description: 'Background color (hex, optional)',\n        },\n        symbol: {\n          type: 'string',\n          description: 'Icon symbol - can be an emoji, letter, or Lucide icon name',\n        },\n        shape: {\n          type: 'string',\n          description: 'Icon shape',\n          enum: ['square', 'rounded', 'circle', 'squircle'],\n        },\n        effects: {\n          type: 'array',\n          items: { type: 'object' },\n          description: 'Additional effects (shadow, glow, border, etc.)',\n        },\n        sizes: {\n          type: 'array',\n          items: { type: 'number' },\n          description: 'Output sizes in pixels (default: [64, 128, 256, 512, 1024])',\n        },\n      },\n      required: ['name', 'style', 'primaryColor'],\n    },\n  },\n  {\n    name: 'remove_background',\n    description:\n      'Remove the background from an image using AI. Supports portraits, products, and general ' +\n      'images. Returns transparent PNG.',\n    parameters: {\n      type: 'object',\n      properties: {\n        imageSrc: {\n          type: 'string',\n          description: 'Image URL, base64 data, or file path',\n        },\n        model: {\n          type: 'string',\n          description: 'AI model optimized for specific content types',\n          enum: ['auto', 'portrait', 'product', 'general'],\n        },\n        tolerance: {\n          type: 'number',\n          description: 'Edge sensitivity 0-100 (default: 50)',\n        },\n        edgeSoftness: {\n          type: 'number',\n          description: 'Feather amount in pixels 0-20 (default: 2)',\n        },\n        refineEdges: {\n          type: 'boolean',\n          description: 'Use AI edge refinement for better hair/fur detection',\n        },\n      },\n      required: ['imageSrc'],\n    },\n  },\n  {\n    name: 'create_branded_image',\n    description:\n      'Transform an image to match 8gent branded visual identity. Applies consistent effects ' +\n      'for a cohesive look across all OS assets.',\n    parameters: {\n      type: 'object',\n      properties: {\n        imageSrc: {\n          type: 'string',\n          description: 'Source image URL or path',\n        },\n        preset: {\n          type: 'string',\n          description: 'Brand preset to apply',\n          enum: ['signature', 'light', 'dark', 'vibrant', 'minimal', 'retro', 'futuristic'],\n        },\n        customEffects: {\n          type: 'array',\n          items: { type: 'object' },\n          description: 'Override or add effects to the preset',\n        },\n        outputFormat: {\n          type: 'string',\n          description: 'Output format',\n          enum: ['png', 'jpg', 'webp'],\n        },\n      },\n      required: ['imageSrc', 'preset'],\n    },\n  },\n  {\n    name: 'batch_process_images',\n    description:\n      'Apply consistent effects to multiple images at once. Perfect for creating cohesive ' +\n      'galleries, icon sets, or branded asset collections.',\n    parameters: {\n      type: 'object',\n      properties: {\n        images: {\n          type: 'array',\n          items: { type: 'string' },\n          description: 'Array of image URLs or paths',\n        },\n        effects: {\n          type: 'array',\n          items: { type: 'object' },\n          description: 'Effects to apply to all images',\n        },\n        preset: {\n          type: 'string',\n          description: 'Named preset to apply (alternative to effects array)',\n          enum: ['vintage', 'cyberpunk', 'noir', 'pop-art', 'blueprint', 'signature'],\n        },\n        outputPrefix: {\n          type: 'string',\n          description: 'Filename prefix for outputs',\n        },\n        outputFormat: {\n          type: 'string',\n          description: 'Output format for all images',\n          enum: ['png', 'jpg', 'webp'],\n        },\n      },\n      required: ['images'],\n    },\n  },\n  {\n    name: 'create_color_palette',\n    description:\n      'Extract or generate a color palette from an image or create one from scratch. ' +\n      'Useful for theming, branding, and ensuring visual consistency.',\n    parameters: {\n      type: 'object',\n      properties: {\n        source: {\n          type: 'string',\n          description: 'Image URL to extract colors from, or \"generate\" for AI generation',\n        },\n        count: {\n          type: 'number',\n          description: 'Number of colors in palette (default: 5)',\n        },\n        mode: {\n          type: 'string',\n          description: 'Palette generation mode',\n          enum: ['extract', 'analogous', 'complementary', 'triadic', 'split-complementary', 'monochromatic'],\n        },\n        baseColor: {\n          type: 'string',\n          description: 'Base color for generated palettes (hex)',\n        },\n        includeShades: {\n          type: 'boolean',\n          description: 'Include light/dark shades of each color',\n        },\n      },\n      required: ['source'],\n    },\n  },\n  {\n    name: 'resize_and_crop',\n    description:\n      'Resize, crop, and optimize images for specific use cases. Supports smart cropping ' +\n      'that preserves important content.',\n    parameters: {\n      type: 'object',\n      properties: {\n        imageSrc: {\n          type: 'string',\n          description: 'Source image URL or path',\n        },\n        width: {\n          type: 'number',\n          description: 'Target width in pixels',\n        },\n        height: {\n          type: 'number',\n          description: 'Target height in pixels',\n        },\n        fit: {\n          type: 'string',\n          description: 'How to fit image to dimensions',\n          enum: ['contain', 'cover', 'fill', 'inside', 'outside'],\n        },\n        position: {\n          type: 'string',\n          description: 'Focal point for cropping',\n          enum: ['center', 'top', 'right', 'bottom', 'left', 'top-left', 'top-right', 'bottom-left', 'bottom-right', 'smart'],\n        },\n        format: {\n          type: 'string',\n          description: 'Output format',\n          enum: ['png', 'jpg', 'webp'],\n        },\n        quality: {\n          type: 'number',\n          description: 'Quality 0-100 (for jpg/webp)',\n        },\n      },\n      required: ['imageSrc', 'width', 'height'],\n    },\n  },\n  {\n    name: 'composite_images',\n    description:\n      'Layer multiple images together with blend modes and positioning. Create collages, ' +\n      'overlays, and composite designs.',\n    parameters: {\n      type: 'object',\n      properties: {\n        baseImage: {\n          type: 'string',\n          description: 'Background/base image URL or path',\n        },\n        layers: {\n          type: 'array',\n          items: { type: 'object' },\n          description: 'Array of layers: [{src, x, y, width, height, opacity, blendMode}]',\n        },\n        outputWidth: {\n          type: 'number',\n          description: 'Final output width (optional)',\n        },\n        outputHeight: {\n          type: 'number',\n          description: 'Final output height (optional)',\n        },\n        format: {\n          type: 'string',\n          description: 'Output format',\n          enum: ['png', 'jpg', 'webp'],\n        },\n      },\n      required: ['baseImage', 'layers'],\n    },\n  },\n  {\n    name: 'generate_pattern',\n    description:\n      'Generate seamless patterns and textures. Useful for backgrounds, UI elements, ' +\n      'and decorative graphics.',\n    parameters: {\n      type: 'object',\n      properties: {\n        type: {\n          type: 'string',\n          description: 'Pattern type',\n          enum: ['dots', 'lines', 'grid', 'waves', 'noise', 'geometric', 'organic', 'halftone', 'checkerboard', 'stripes'],\n        },\n        width: {\n          type: 'number',\n          description: 'Pattern tile width (default: 256)',\n        },\n        height: {\n          type: 'number',\n          description: 'Pattern tile height (default: 256)',\n        },\n        colors: {\n          type: 'array',\n          items: { type: 'string' },\n          description: 'Colors to use in pattern (hex values)',\n        },\n        density: {\n          type: 'number',\n          description: 'Pattern density 0-100 (default: 50)',\n        },\n        rotation: {\n          type: 'number',\n          description: 'Pattern rotation in degrees',\n        },\n        seamless: {\n          type: 'boolean',\n          description: 'Ensure pattern tiles seamlessly (default: true)',\n        },\n      },\n      required: ['type'],\n    },\n  },\n\n  // =============================================================================\n  // Talking Video Tools (AI Avatar Videos)\n  // =============================================================================\n\n  {\n    name: 'create_talking_video',\n    description:\n      'Create a talking head video with AI-generated script, cloned voice, and lip sync. ' +\n      'The full workflow: 1) Generate a script about the topic, 2) Generate voice audio using ' +\n      'ElevenLabs cloned voice, 3) Create background scene using Kling AI Pro, 4) Lip sync ' +\n      'with Veed Fast. Use when user says \"make a video of me talking about X\" or \"create a ' +\n      'talking video\".',\n    parameters: {\n      type: 'object',\n      properties: {\n        topic: {\n          type: 'string',\n          description: 'What the video should be about. This will be used to generate the script.',\n        },\n        sourcePhotoUrl: {\n          type: 'string',\n          description: 'URL of the photo to animate (headshot of the person)',\n        },\n        sceneStyle: {\n          type: 'string',\n          description: 'Background scene style for the video',\n          enum: ['podcast_studio', 'office', 'outdoor', 'news_desk', 'living_room', 'conference'],\n        },\n        customScenePrompt: {\n          type: 'string',\n          description: 'Custom scene description (overrides sceneStyle if provided)',\n        },\n        duration: {\n          type: 'number',\n          description: 'Target video duration in seconds (default: 90)',\n        },\n        tone: {\n          type: 'string',\n          description: 'Tone of the script and delivery',\n          enum: ['professional', 'casual', 'educational', 'entertaining'],\n        },\n      },\n      required: ['topic', 'sourcePhotoUrl'],\n    },\n  },\n  {\n    name: 'generate_video_script',\n    description:\n      'Generate just the script for a talking video without creating the full video. ' +\n      'Use this when user wants to review or edit the script before generating voice and video.',\n    parameters: {\n      type: 'object',\n      properties: {\n        topic: {\n          type: 'string',\n          description: 'What the script should be about',\n        },\n        duration: {\n          type: 'number',\n          description: 'Target duration in seconds (default: 90). Script will be ~150 words per minute.',\n        },\n        tone: {\n          type: 'string',\n          description: 'Tone of the script',\n          enum: ['professional', 'casual', 'educational', 'entertaining'],\n        },\n        style: {\n          type: 'string',\n          description: 'Script style/format',\n          enum: ['monologue', 'interview', 'tutorial', 'story'],\n        },\n      },\n      required: ['topic'],\n    },\n  },\n  {\n    name: 'generate_voice_audio',\n    description:\n      'Generate voice audio from text using ElevenLabs cloned voice. Creates natural-sounding ' +\n      'speech that matches James\\'s voice. Use when user wants to create audio narration or voice-over.',\n    parameters: {\n      type: 'object',\n      properties: {\n        text: {\n          type: 'string',\n          description: 'The text to convert to speech',\n        },\n        voiceId: {\n          type: 'string',\n          description: 'ElevenLabs voice ID (uses James\\'s cloned voice by default)',\n        },\n        stability: {\n          type: 'number',\n          description: 'Voice stability 0-1 (higher = more consistent, lower = more expressive)',\n        },\n        similarityBoost: {\n          type: 'number',\n          description: 'Voice similarity 0-1 (higher = closer to original voice)',\n        },\n      },\n      required: ['text'],\n    },\n  },\n  {\n    name: 'navigate_to_video_studio',\n    description:\n      'Open the video studio page (/video) for creating talking videos. Use when user wants ' +\n      'to \"go to video studio\", \"open video creator\", or \"make a talking video\" without specifying details.',\n    parameters: {\n      type: 'object',\n      properties: {\n        prefillTopic: {\n          type: 'string',\n          description: 'Optional topic to pre-fill in the video studio',\n        },\n      },\n      required: [],\n    },\n  },\n\n  // =============================================================================\n  // LTX-2 Video Generation Tools (Lightricks via Fal AI)\n  // AI-powered video generation: text-to-video, image-to-video\n  // =============================================================================\n\n  {\n    name: 'generate_video',\n    description:\n      'Generate a video from a text prompt using LTX-2 AI model. Creates high-quality videos ' +\n      'from text descriptions. Use when user says \"generate a video of X\", \"create a video showing X\", ' +\n      'or \"make me a video clip of X\". Supports multiple aspect ratios and durations.',\n    parameters: {\n      type: 'object',\n      properties: {\n        prompt: {\n          type: 'string',\n          description: 'Detailed description of the video to generate. Be specific about motion, scene, lighting, etc.',\n        },\n        negative_prompt: {\n          type: 'string',\n          description: 'What to avoid in the video (default: blurry, low quality, distorted, watermark)',\n        },\n        preset: {\n          type: 'string',\n          description: 'Video preset for aspect ratio and duration',\n          enum: ['landscape_short', 'landscape_long', 'portrait_short', 'portrait_long', 'square', 'cinematic'],\n        },\n        duration_seconds: {\n          type: 'number',\n          description: 'Approximate duration in seconds (4-6 seconds typical)',\n        },\n        seed: {\n          type: 'number',\n          description: 'Random seed for reproducibility',\n        },\n      },\n      required: ['prompt'],\n    },\n  },\n  {\n    name: 'animate_image',\n    description:\n      'Animate a still image into a video using LTX-2 image-to-video. Takes a starting image and ' +\n      'creates motion based on the prompt. Use when user says \"animate this image\", \"make this photo move\", ' +\n      'or \"bring this picture to life\".',\n    parameters: {\n      type: 'object',\n      properties: {\n        image_url: {\n          type: 'string',\n          description: 'URL of the image to animate',\n        },\n        prompt: {\n          type: 'string',\n          description: 'Description of how the image should animate (e.g., \"the person starts walking\", \"camera slowly zooms in\")',\n        },\n        negative_prompt: {\n          type: 'string',\n          description: 'What to avoid in the animation',\n        },\n        duration_seconds: {\n          type: 'number',\n          description: 'Approximate duration in seconds (4-6 seconds typical)',\n        },\n        seed: {\n          type: 'number',\n          description: 'Random seed for reproducibility',\n        },\n      },\n      required: ['image_url', 'prompt'],\n    },\n  },\n  {\n    name: 'list_video_presets',\n    description:\n      'List available video generation presets with their aspect ratios and durations. ' +\n      'Use this to show the user what video formats are available.',\n    parameters: {\n      type: 'object',\n      properties: {},\n      required: [],\n    },\n  },\n\n  // =============================================================================\n  // Autonomous Execution Tools (OpenClaw-inspired)\n  // These tools enable 8gent to spawn background tasks, work autonomously,\n  // and announce results - making it feel like a real assistant that does work.\n  // =============================================================================\n\n  {\n    name: 'spawn_task',\n    description:\n      'Spawn a background task that runs independently and announces the result when done. ' +\n      'Use this when you need to do work that takes time (research, code analysis, file operations) ' +\n      'without blocking the conversation. The task runs server-side and survives browser close. ' +\n      'Examples: \"Analyze this codebase\", \"Research competitors\", \"Generate a report\". ' +\n      'IMPORTANT: This is how 8gent does real work autonomously.',\n    parameters: {\n      type: 'object',\n      properties: {\n        task: {\n          type: 'string',\n          description: 'Description of what the task should accomplish. Be specific and detailed.',\n        },\n        label: {\n          type: 'string',\n          description: 'Short label for the task (shown in UI, e.g., \"Code Analysis\", \"Research\")',\n        },\n        timeoutSeconds: {\n          type: 'number',\n          description: 'Maximum time for the task to run in seconds (default: 300, max: 600)',\n        },\n        announceResult: {\n          type: 'boolean',\n          description: 'Whether to announce the result back in chat when done (default: true)',\n        },\n        priority: {\n          type: 'string',\n          description: 'Task priority for queue ordering',\n          enum: ['low', 'normal', 'high'],\n        },\n        context: {\n          type: 'object',\n          description: 'Optional context to pass to the task (projectId, ticketId, sandboxId, etc.)',\n        },\n      },\n      required: ['task'],\n    },\n  },\n  {\n    name: 'list_background_tasks',\n    description:\n      'List active and recent background tasks. Use this to check on spawned tasks, ' +\n      'see their progress, or review completed work.',\n    parameters: {\n      type: 'object',\n      properties: {\n        status: {\n          type: 'string',\n          description: 'Filter by task status',\n          enum: ['queued', 'running', 'succeeded', 'failed', 'cancelled', 'all'],\n        },\n        limit: {\n          type: 'number',\n          description: 'Maximum number of tasks to return (default: 10)',\n        },\n      },\n      required: [],\n    },\n  },\n  {\n    name: 'cancel_background_task',\n    description:\n      'Cancel a running or queued background task. Use this when the user wants to ' +\n      'stop a task that is taking too long or is no longer needed.',\n    parameters: {\n      type: 'object',\n      properties: {\n        jobId: {\n          type: 'string',\n          description: 'The job ID of the task to cancel',\n        },\n      },\n      required: ['jobId'],\n    },\n  },\n  {\n    name: 'get_task_result',\n    description:\n      'Get the result of a completed background task. Use this to retrieve the output ' +\n      'of a task that has finished running.',\n    parameters: {\n      type: 'object',\n      properties: {\n        jobId: {\n          type: 'string',\n          description: 'The job ID of the task to get results for',\n        },\n      },\n      required: ['jobId'],\n    },\n  },\n  {\n    name: 'iterate_on_code',\n    description:\n      'Start an autonomous code iteration session. 8gent will analyze code, make changes, ' +\n      'run tests, and iterate until the goal is achieved or max iterations reached. ' +\n      'Perfect for refactoring, bug fixes, or implementing features with clear test criteria. ' +\n      'Requires an active sandbox with cloned repository.',\n    parameters: {\n      type: 'object',\n      properties: {\n        goal: {\n          type: 'string',\n          description: 'What the iteration should achieve (e.g., \"Fix all TypeScript errors\", \"Add unit tests for auth module\")',\n        },\n        sandboxId: {\n          type: 'string',\n          description: 'The sandbox ID with the cloned repository',\n        },\n        maxIterations: {\n          type: 'number',\n          description: 'Maximum number of analyze-modify-test cycles (default: 5, max: 10)',\n        },\n        stopOnSuccess: {\n          type: 'boolean',\n          description: 'Whether to stop when tests pass (default: true)',\n        },\n        commitChanges: {\n          type: 'boolean',\n          description: 'Whether to commit successful changes (default: false)',\n        },\n        testCommand: {\n          type: 'string',\n          description: 'Command to run for testing (e.g., \"npm test\", \"pnpm typecheck\")',\n        },\n      },\n      required: ['goal', 'sandboxId'],\n    },\n  },\n  {\n    name: 'delegate_to_specialist',\n    description:\n      'Delegate a task to a specialist agent with deep expertise in a specific area. ' +\n      'Specialists run as background tasks and announce findings when complete. ' +\n      'Use for security audits, code reviews, performance analysis, etc.',\n    parameters: {\n      type: 'object',\n      properties: {\n        specialist: {\n          type: 'string',\n          description: 'The type of specialist to delegate to',\n          enum: [\n            'code-reviewer',\n            'security-auditor',\n            'performance-analyst',\n            'documentation-writer',\n            'test-generator',\n            'refactoring-expert',\n          ],\n        },\n        task: {\n          type: 'string',\n          description: 'What the specialist should analyze or accomplish',\n        },\n        context: {\n          type: 'object',\n          description: 'Optional context (sandboxId, filePaths, repository info, etc.)',\n        },\n        announceResult: {\n          type: 'boolean',\n          description: 'Whether to announce findings in chat (default: true)',\n        },\n      },\n      required: ['specialist', 'task'],\n    },\n  },\n\n  // =============================================================================\n  // AI Provider Tools (Local LLM / Cloud Settings)\n  // =============================================================================\n\n  {\n    name: 'get_ai_provider_status',\n    description:\n      'Check the current AI provider configuration and connection status. Shows whether ' +\n      'local (Ollama) or cloud (OpenAI) inference is being used, available models, and ' +\n      'latency information. Use when user asks \"what model are you using\", \"are you running locally\", ' +\n      '\"check AI status\", or wants to know about the current AI setup.',\n    parameters: {\n      type: 'object',\n      properties: {\n        includeLatency: {\n          type: 'boolean',\n          description: 'Whether to include latency measurements (may add delay)',\n        },\n      },\n      required: [],\n    },\n    ownerOnly: true,\n  },\n  {\n    name: 'navigate_to_ai_settings',\n    description:\n      'Open the AI provider settings page (/settings/ai) where the user can switch between ' +\n      'local and cloud inference, configure Ollama, and view connection status. Use when user ' +\n      'says \"AI settings\", \"configure local model\", \"switch to local\", \"switch to cloud\".',\n    parameters: {\n      type: 'object',\n      properties: {},\n      required: [],\n    },\n    ownerOnly: true,\n  },\n\n  // =============================================================================\n  // Kanban Task Reading Tools - Read and understand tasks\n  // =============================================================================\n\n  {\n    name: 'get_kanban_task',\n    description:\n      'Get details of a specific Kanban task by its ID. Use this when a user references a task ' +\n      'like \"exp-001\" or \"p1-3\" to understand what the task is about before taking action.',\n    parameters: {\n      type: 'object',\n      properties: {\n        taskId: {\n          type: 'string',\n          description: 'The task ID (e.g., \"exp-001\", \"p1-1\", \"backlog-2\")',\n        },\n      },\n      required: ['taskId'],\n    },\n  },\n  {\n    name: 'search_kanban_tasks',\n    description:\n      'Search Kanban tasks by keyword. Use this to find tasks related to a topic, ' +\n      'or to see what tasks exist in the board.',\n    parameters: {\n      type: 'object',\n      properties: {\n        query: {\n          type: 'string',\n          description: 'Search term to find in task titles, descriptions, or tags',\n        },\n        status: {\n          type: 'string',\n          description: 'Optional: filter by status',\n          enum: ['backlog', 'todo', 'in-progress', 'review', 'done'],\n        },\n      },\n      required: ['query'],\n    },\n  },\n\n  // =============================================================================\n  // Design Canvas Tools - Infinite canvas for visual composition\n  // =============================================================================\n\n  {\n    name: 'create_canvas',\n    description:\n      'Create a new design canvas for visual exploration, moodboards, mind maps, or flowcharts. ' +\n      'Use this when users want to create visual diagrams, plan architecture, or compose layouts. ' +\n      'The canvas supports multiple node types including shapes, sticky notes, images, and text.',\n    parameters: {\n      type: 'object',\n      properties: {\n        name: {\n          type: 'string',\n          description: 'Name for the canvas (e.g., \"8gent Architecture\", \"Project Moodboard\")',\n        },\n        canvasType: {\n          type: 'string',\n          description: 'Type of canvas layout',\n          enum: ['freeform', 'wireframe', 'moodboard', 'storyboard', 'mindmap', 'flowchart'],\n        },\n        description: {\n          type: 'string',\n          description: 'Optional description of what this canvas is for',\n        },\n        backgroundColor: {\n          type: 'string',\n          description: 'Background color (hex, e.g., \"#1a1a2e\" for dark, \"#ffffff\" for white)',\n        },\n        gridEnabled: {\n          type: 'boolean',\n          description: 'Whether to show grid lines (default: true)',\n        },\n      },\n      required: ['name', 'canvasType'],\n    },\n  },\n  {\n    name: 'list_canvases',\n    description:\n      'List all design canvases. Use this to find existing canvases or see what visual ' +\n      'workspaces have been created.',\n    parameters: {\n      type: 'object',\n      properties: {\n        status: {\n          type: 'string',\n          description: 'Filter by canvas status',\n          enum: ['active', 'archived', 'template'],\n        },\n        limit: {\n          type: 'number',\n          description: 'Maximum number of canvases to return (default: 20)',\n        },\n      },\n      required: [],\n    },\n  },\n  {\n    name: 'get_canvas',\n    description:\n      'Get details of a specific canvas including its nodes and edges. Use this to view ' +\n      'what elements are on a canvas before adding more.',\n    parameters: {\n      type: 'object',\n      properties: {\n        canvasId: {\n          type: 'string',\n          description: 'The ID of the canvas to retrieve',\n        },\n      },\n      required: ['canvasId'],\n    },\n  },\n  {\n    name: 'add_canvas_node',\n    description:\n      'Add a node (element) to a canvas. Nodes can be shapes, sticky notes, text, images, ' +\n      'code blocks, or other visual elements. Position is specified in x,y coordinates. ' +\n      'Use this to build visual representations, diagrams, or compositions.',\n    parameters: {\n      type: 'object',\n      properties: {\n        canvasId: {\n          type: 'string',\n          description: 'The ID of the canvas to add the node to',\n        },\n        nodeType: {\n          type: 'string',\n          description: 'Type of node to create',\n          enum: ['text', 'image', 'shape', 'sticky', 'frame', 'code', 'embed', 'audio', 'video', 'link'],\n        },\n        x: {\n          type: 'number',\n          description: 'X position on canvas (0 is left edge)',\n        },\n        y: {\n          type: 'number',\n          description: 'Y position on canvas (0 is top edge)',\n        },\n        width: {\n          type: 'number',\n          description: 'Width of the node in pixels (default: varies by type)',\n        },\n        height: {\n          type: 'number',\n          description: 'Height of the node in pixels (default: varies by type)',\n        },\n        content: {\n          type: 'string',\n          description: 'Content for the node. For text/sticky: the text content. For image: URL. For shape: shape type (rectangle, circle, diamond, hexagon, star, arrow, cloud). For code: the code snippet.',\n        },\n        style: {\n          type: 'string',\n          description: 'JSON string of style properties: { \"backgroundColor\": \"#hex\", \"borderColor\": \"#hex\", \"textColor\": \"#hex\", \"fontSize\": 14, \"fontWeight\": \"bold\" }',\n        },\n      },\n      required: ['canvasId', 'nodeType', 'x', 'y', 'content'],\n    },\n  },\n  {\n    name: 'add_canvas_edge',\n    description:\n      'Add an edge (connection/arrow) between two nodes on a canvas. Use this to show ' +\n      'relationships, data flow, or connections between elements. Edges can be straight ' +\n      'lines, curved lines, step connectors, or arrows.',\n    parameters: {\n      type: 'object',\n      properties: {\n        canvasId: {\n          type: 'string',\n          description: 'The ID of the canvas',\n        },\n        sourceNodeId: {\n          type: 'string',\n          description: 'ID of the source node (where the edge starts)',\n        },\n        targetNodeId: {\n          type: 'string',\n          description: 'ID of the target node (where the edge ends)',\n        },\n        edgeType: {\n          type: 'string',\n          description: 'Type of edge/connection',\n          enum: ['straight', 'curved', 'step', 'arrow'],\n        },\n        label: {\n          type: 'string',\n          description: 'Optional label to display on the edge',\n        },\n        style: {\n          type: 'string',\n          description: 'JSON string of style properties: { \"strokeColor\": \"#hex\", \"strokeWidth\": 2, \"dashed\": false }',\n        },\n      },\n      required: ['canvasId', 'sourceNodeId', 'targetNodeId', 'edgeType'],\n    },\n  },\n  {\n    name: 'update_canvas_node',\n    description:\n      'Update an existing node on a canvas. Use this to change position, size, content, ' +\n      'or styling of an element.',\n    parameters: {\n      type: 'object',\n      properties: {\n        canvasId: {\n          type: 'string',\n          description: 'The ID of the canvas',\n        },\n        nodeId: {\n          type: 'string',\n          description: 'The ID of the node to update',\n        },\n        x: {\n          type: 'number',\n          description: 'New X position',\n        },\n        y: {\n          type: 'number',\n          description: 'New Y position',\n        },\n        width: {\n          type: 'number',\n          description: 'New width',\n        },\n        height: {\n          type: 'number',\n          description: 'New height',\n        },\n        content: {\n          type: 'string',\n          description: 'New content',\n        },\n        style: {\n          type: 'string',\n          description: 'New style JSON',\n        },\n      },\n      required: ['canvasId', 'nodeId'],\n    },\n  },\n\n  // =============================================================================\n  // Apple Health Data Tools\n  // =============================================================================\n\n  {\n    name: 'get_health_summary',\n    description:\n      'Get a summary of health data for a specific date or today. Returns steps, heart rate, ' +\n      'sleep, activity scores, and other health metrics synced from Apple Health. ' +\n      'Use this when the user asks about their health, fitness, sleep, or activity data.',\n    ownerOnly: true,\n    parameters: {\n      type: 'object',\n      properties: {\n        date: {\n          type: 'string',\n          description:\n            'The date to get health summary for in YYYY-MM-DD format. Defaults to today if not provided.',\n        },\n      },\n      required: [],\n    },\n  },\n  {\n    name: 'get_health_trends',\n    description:\n      'Get health trends and weekly averages over time. Shows how steps, sleep, heart rate, ' +\n      'and activity scores have changed over recent weeks. Use this when the user asks about ' +\n      'their health trends, progress, or how their metrics have changed over time.',\n    ownerOnly: true,\n    parameters: {\n      type: 'object',\n      properties: {\n        weeks: {\n          type: 'number',\n          description: 'Number of weeks to analyze. Defaults to 4 weeks.',\n        },\n      },\n      required: [],\n    },\n  },\n  {\n    name: 'get_health_metric',\n    description:\n      'Get detailed data for a specific health metric over a date range. Returns raw samples ' +\n      'for metrics like steps, heart rate, sleep, workouts, etc. Use this when the user wants ' +\n      'to see detailed data for a specific metric.',\n    ownerOnly: true,\n    parameters: {\n      type: 'object',\n      properties: {\n        metric: {\n          type: 'string',\n          description: 'The health metric to query',\n          enum: [\n            'steps',\n            'distance',\n            'activeEnergy',\n            'heartRate',\n            'restingHeartRate',\n            'heartRateVariability',\n            'sleepAnalysis',\n            'weight',\n            'bodyFat',\n            'bloodOxygen',\n            'mindfulMinutes',\n            'workout',\n            'exerciseMinutes',\n            'standHours',\n          ],\n        },\n        startDate: {\n          type: 'string',\n          description: 'Start date in YYYY-MM-DD format. Defaults to 7 days ago.',\n        },\n        endDate: {\n          type: 'string',\n          description: 'End date in YYYY-MM-DD format. Defaults to today.',\n        },\n      },\n      required: ['metric'],\n    },\n  },\n  {\n    name: 'compare_health_periods',\n    description:\n      'Compare health metrics between two time periods. Useful for seeing improvement or ' +\n      'changes between this week vs last week, this month vs last month, etc.',\n    ownerOnly: true,\n    parameters: {\n      type: 'object',\n      properties: {\n        period1Start: {\n          type: 'string',\n          description: 'Start date of first period (YYYY-MM-DD)',\n        },\n        period1End: {\n          type: 'string',\n          description: 'End date of first period (YYYY-MM-DD)',\n        },\n        period2Start: {\n          type: 'string',\n          description: 'Start date of second period (YYYY-MM-DD)',\n        },\n        period2End: {\n          type: 'string',\n          description: 'End date of second period (YYYY-MM-DD)',\n        },\n        metrics: {\n          type: 'array',\n          description: 'Which metrics to compare',\n          items: {\n            type: 'string',\n          },\n        },\n      },\n      required: ['period1Start', 'period1End', 'period2Start', 'period2End'],\n    },\n  },\n  {\n    name: 'generate_health_api_key',\n    description:\n      'Generate a new API key for syncing Apple Health data from an iOS Shortcut. ' +\n      'The key is shown only once and must be saved immediately. Use this when the user ' +\n      'wants to set up health data syncing from their iPhone.',\n    ownerOnly: true,\n    parameters: {\n      type: 'object',\n      properties: {\n        name: {\n          type: 'string',\n          description: 'A friendly name for this API key (e.g., \"iPhone 15 Pro\", \"iPad\")',\n        },\n        expiresInDays: {\n          type: 'number',\n          description: 'Number of days until the key expires. Leave empty for no expiration.',\n        },\n      },\n      required: ['name'],\n    },\n  },\n  {\n    name: 'list_health_api_keys',\n    description:\n      'List all API keys for Apple Health syncing. Shows key names, last used dates, ' +\n      'and whether they are active or expired. Use this when the user wants to manage ' +\n      'their health sync API keys.',\n    ownerOnly: true,\n    parameters: {\n      type: 'object',\n      properties: {},\n      required: [],\n    },\n  },\n  {\n    name: 'revoke_health_api_key',\n    description:\n      'Revoke an API key to stop it from being used for health data syncing. ' +\n      'Use this when the user wants to disable a specific API key.',\n    ownerOnly: true,\n    parameters: {\n      type: 'object',\n      properties: {\n        keyId: {\n          type: 'string',\n          description: 'The ID of the API key to revoke',\n        },\n      },\n      required: ['keyId'],\n    },\n  },\n  {\n    name: 'get_health_sync_status',\n    description:\n      'Get the status of recent health data syncs. Shows when data was last synced, ' +\n      'how many samples were received, and any errors. Use this when the user asks ' +\n      'about their health sync status or if syncing is working.',\n    ownerOnly: true,\n    parameters: {\n      type: 'object',\n      properties: {\n        limit: {\n          type: 'number',\n          description: 'Number of recent syncs to show. Defaults to 5.',\n        },\n      },\n      required: [],\n    },\n  },\n\n  // =============================================================================\n  // ERV Ontology Tools - AI-Assisted Entity Classification & Relationship Suggestion\n  // Inspired by data governance patterns for automatic ontology population\n  // =============================================================================\n\n  {\n    name: 'analyze_and_create_entity',\n    description:\n      'Analyze content (URL, text, or data) and automatically classify it into the appropriate ERV entity type. ' +\n      'AI determines the best entity type, extracts relevant attributes, suggests tags, and creates the entity. ' +\n      'Use this when the user pastes content, shares a URL, or describes something that should be stored. ' +\n      'Examples: \"save this article\", \"remember this person I met\", \"add this project idea\".',\n    parameters: {\n      type: 'object',\n      properties: {\n        content: {\n          type: 'string',\n          description: 'The content to analyze. Can be: raw text, a URL, JSON data, or a description of something to remember.',\n        },\n        contentType: {\n          type: 'string',\n          description: 'Hint about the content type to help classification',\n          enum: ['url', 'text', 'json', 'description', 'auto'],\n        },\n        suggestedType: {\n          type: 'string',\n          description: 'Optional: Suggest an entity type if the user indicates preference (e.g., \"save as a person\")',\n          enum: ['Person', 'Project', 'Track', 'Draft', 'Sketch', 'Ticket', 'Epic', 'Event', 'Memory', 'Value', 'Collection', 'Skill', 'Reminder'],\n        },\n        additionalContext: {\n          type: 'string',\n          description: 'Optional: Additional context from the user about what this content is (e.g., \"this is my coworker from the AI team\")',\n        },\n      },\n      required: ['content'],\n    },\n    ownerOnly: true,\n  },\n  {\n    name: 'suggest_entity_relationships',\n    description:\n      'Analyze an entity and suggest relationships to other existing entities in the ERV system. ' +\n      'Uses semantic similarity and content analysis to find connections the user might not have made explicitly. ' +\n      'Returns suggested relationships with confidence scores and reasoning. ' +\n      'Use when: user creates a new entity, asks \"what is this related to?\", or when building knowledge graphs.',\n    parameters: {\n      type: 'object',\n      properties: {\n        entityId: {\n          type: 'string',\n          description: 'The entity ID to find relationships for',\n        },\n        relationshipTypes: {\n          type: 'array',\n          items: { type: 'string' },\n          description: 'Optional: Filter to specific relationship types (collaboratedOn, createdBy, mentions, relatedTo, etc.)',\n        },\n        maxSuggestions: {\n          type: 'number',\n          description: 'Maximum number of relationship suggestions to return (default: 10)',\n        },\n        minConfidence: {\n          type: 'number',\n          description: 'Minimum confidence threshold 0-1 for suggestions (default: 0.5)',\n        },\n        autoCreate: {\n          type: 'boolean',\n          description: 'If true, automatically create relationships above the confidence threshold (default: false)',\n        },\n      },\n      required: ['entityId'],\n    },\n    ownerOnly: true,\n  },\n  {\n    name: 'bulk_classify_entities',\n    description:\n      'Import and classify multiple items at once into ERV entities. Takes an array of content items ' +\n      'and automatically determines entity types, extracts attributes, and creates entities in bulk. ' +\n      'Useful for importing contacts, bookmarks, notes, or any list of items. ' +\n      'Also suggests relationships between the imported entities and existing data.',\n    parameters: {\n      type: 'object',\n      properties: {\n        items: {\n          type: 'array',\n          description: 'Array of items to classify. Each item should have at minimum a \"content\" field.',\n          items: {\n            type: 'object',\n            properties: {\n              content: { type: 'string' },\n              hint: { type: 'string' },\n            },\n          },\n        },\n        sourceFormat: {\n          type: 'string',\n          description: 'Format hint for the data source',\n          enum: ['csv', 'json', 'text_list', 'urls', 'contacts', 'bookmarks', 'notes', 'auto'],\n        },\n        defaultType: {\n          type: 'string',\n          description: 'Default entity type if classification is uncertain',\n          enum: ['Person', 'Project', 'Track', 'Draft', 'Sketch', 'Ticket', 'Epic', 'Event', 'Memory', 'Value', 'Collection', 'Skill', 'Reminder'],\n        },\n        commonTags: {\n          type: 'array',\n          items: { type: 'string' },\n          description: 'Tags to apply to all imported entities (e.g., [\"import-2026-02\", \"contacts\"])',\n        },\n        dryRun: {\n          type: 'boolean',\n          description: 'If true, return classification results without creating entities (default: false)',\n        },\n      },\n      required: ['items'],\n    },\n    ownerOnly: true,\n  },\n\n  // ============================================================================\n  // Music Generation Tools (ACE-Step via Lynkr)\n  // ============================================================================\n\n  {\n    name: 'cowrite_music',\n    description:\n      'ALWAYS use this tool FIRST when the user wants to create music. This tool helps craft the perfect music generation request ' +\n      'through a conversational back-and-forth. It guides users to develop their musical vision step by step: ' +\n      '1) Genre/style direction, 2) Mood and energy, 3) Instrumentation, 4) Lyrics (if vocal), 5) Structure, ' +\n      '6) Reference track (optional), 7) Technical specs (BPM, key, duration). ' +\n      'Returns a draft payload that can be refined before final generation. ' +\n      'Use this instead of jumping straight to generate_music - it produces much better results.',\n    parameters: {\n      type: 'object',\n      properties: {\n        step: {\n          type: 'string',\n          enum: ['start', 'refine_style', 'add_lyrics', 'set_structure', 'add_reference', 'finalize', 'generate'],\n          description:\n            'Which step of the cowriting process: ' +\n            'start = begin new session, gather initial idea; ' +\n            'refine_style = enhance style description with genre, instruments, mood; ' +\n            'add_lyrics = help write or structure lyrics; ' +\n            'set_structure = define song structure with tags; ' +\n            'add_reference = incorporate reference audio for style matching; ' +\n            'finalize = review and confirm all parameters; ' +\n            'generate = user confirmed, proceed to generation',\n        },\n        userInput: {\n          type: 'string',\n          description: 'The user\\'s input or response for this step of the cowriting process.',\n        },\n        currentDraft: {\n          type: 'string',\n          description:\n            'JSON string of the current draft payload being built up. Pass this between steps to maintain state. ' +\n            'Parse with JSON.parse(). Expected shape: { prompt?: string, lyrics?: string, duration?: number, ' +\n            'bpm?: number, key?: string, timeSignature?: string, title?: string, referenceAudioUrl?: string, ' +\n            'referenceStrength?: number }',\n        },\n      },\n      required: ['step', 'userInput'],\n    },\n    ownerOnly: true,\n  },\n  {\n    name: 'generate_music',\n    description:\n      'Generate original music using AI (ACE-Step). Creates audio from a style description and optional lyrics. ' +\n      'Can generate 10 seconds to 10 minutes of music with control over BPM, key, and time signature. ' +\n      'Supports 50+ languages for lyrics. Use structure tags like [Verse], [Chorus], [Bridge] for song structure. ' +\n      'Supports reference audio for style transfer - provide a URL to match the vibe of an existing track. ' +\n      'NOTE: For best results, use cowrite_music first to help the user craft their request.',\n    parameters: {\n      type: 'object',\n      properties: {\n        prompt: {\n          type: 'string',\n          description:\n            'Musical style description. Be specific about genre, instruments, mood, and production style. ' +\n            'Example: \"upbeat indie folk with acoustic guitar, soft female vocals, warm production\"',\n        },\n        lyrics: {\n          type: 'string',\n          description:\n            'Optional lyrics with structure tags. Use [Verse], [Chorus], [Bridge], [Intro], [Outro] for structure. ' +\n            'Example: \"[Verse]\\\\nWalking down the street\\\\n[Chorus]\\\\nThis is where I want to be\"',\n        },\n        duration: {\n          type: 'number',\n          description: 'Duration in seconds (10-600). Default is 30 seconds. Use 180-300 for full songs.',\n        },\n        bpm: {\n          type: 'number',\n          description: 'Beats per minute (60-200). Leave empty for auto-detection from prompt.',\n        },\n        key: {\n          type: 'string',\n          description: 'Musical key like \"C major\", \"A minor\", \"F# major\". Leave empty for auto-detection.',\n        },\n        timeSignature: {\n          type: 'string',\n          description: 'Time signature like \"4/4\", \"3/4\", \"6/8\". Default is \"4/4\".',\n        },\n        referenceAudioUrl: {\n          type: 'string',\n          description:\n            'URL to a reference audio file for style transfer. The generated music will match the vibe, ' +\n            'energy, and production style of this reference. Supports MP3, WAV, FLAC.',\n        },\n        referenceStrength: {\n          type: 'number',\n          description:\n            'How strongly to match the reference audio style (0.0-1.0). Default is 0.5. ' +\n            'Higher values = closer to reference style, lower = more creative freedom.',\n        },\n        title: {\n          type: 'string',\n          description: 'Title for the generated track.',\n        },\n        saveToJamz: {\n          type: 'boolean',\n          description: 'If true, automatically add the generated track to Jamz Studio.',\n        },\n        projectId: {\n          type: 'string',\n          description: 'Jamz project ID to add the track to (if saveToJamz is true).',\n        },\n      },\n      required: ['prompt'],\n    },\n    ownerOnly: true,\n  },\n  {\n    name: 'analyze_audio',\n    description:\n      'Analyze audio to extract musical properties like BPM, key, time signature, and generate AI descriptions. ' +\n      'Can also extract lyrics with timestamps from vocal tracks. Useful for understanding existing music ' +\n      'before creating variations or matching styles.',\n    parameters: {\n      type: 'object',\n      properties: {\n        audioUrl: {\n          type: 'string',\n          description: 'URL of the audio file to analyze.',\n        },\n        extract: {\n          type: 'array',\n          description: 'What to extract from the audio.',\n          items: {\n            type: 'string',\n          },\n        },\n      },\n      required: ['audioUrl'],\n    },\n    ownerOnly: true,\n  },\n  {\n    name: 'separate_stems',\n    description:\n      'Separate audio into individual stems (vocals, drums, bass, other, piano, guitar). ' +\n      'Useful for remixing, isolating vocals for analysis, or creating karaoke versions. ' +\n      'Returns URLs to each separated stem audio file.',\n    parameters: {\n      type: 'object',\n      properties: {\n        audioUrl: {\n          type: 'string',\n          description: 'URL of the audio file to separate.',\n        },\n        stems: {\n          type: 'array',\n          description: 'Which stems to extract. Default is [\"vocals\", \"drums\", \"bass\", \"other\"].',\n          items: {\n            type: 'string',\n          },\n        },\n      },\n      required: ['audioUrl'],\n    },\n    ownerOnly: true,\n  },\n];\n\n// Convert tool definitions to OpenAI function format\nexport function getOpenAITools() {\n  return CLAW_AI_TOOLS.map((tool: ToolDefinition) => ({\n    type: 'function' as const,\n    function: {\n      name: tool.name,\n      description: tool.description,\n      parameters: tool.parameters,\n    },\n  }));\n}\n\n/**\n * Convert a list of ToolDefinition to OpenAI function format\n * Used for access-controlled tool lists\n */\nexport function toOpenAITools(tools: ToolDefinition[]) {\n  return tools.map((tool) => ({\n    type: 'function' as const,\n    function: {\n      name: tool.name,\n      description: tool.description,\n      parameters: tool.parameters,\n    },\n  }));\n}\n\n// Parse tool calls from OpenAI response\nexport function parseToolCalls(\n  toolCalls: Array<{\n    id: string;\n    function: { name: string; arguments: string };\n  }>\n): ToolCall[] {\n  return toolCalls.map((tc) => ({\n    name: tc.function.name,\n    arguments: JSON.parse(tc.function.arguments),\n  }));\n}\n","/**\n * 8gent Tool Executor - Execute tools and return results\n */\n\nimport { ToolCall, ToolResult, ToolAction, NAVIGATION_DESTINATIONS, NavigationDestination } from './tools';\nimport { searchSystem, getAllThemes, formatSearchResults, SearchOptions } from './search';\nimport { themes } from '@/lib/themes/definitions';\n// import { ConvexHttpClient } from 'convex/browser';\n// import { api } from '@/lib/convex-shim';\n// import type { Id } from '../../../convex/_generated/dataModel';\nimport { ConvexHttpClient, api, Id } from '../convex-shim';\nimport { MemoryManager, getMemoryManager } from '@/lib/memory';\nimport type { SemanticCategory, EpisodicMemoryType } from '@/lib/memory/types';\nimport { sendMessage, Platform } from '@/lib/channels/outbound-router';\nimport type { AccessLevel } from './access-control';\nimport {\n  generateVideoFromText,\n  generateVideoFromImage,\n  generateVideoWithPreset,\n  LTX_PRESETS,\n  getFrameCountForDuration,\n  isLTXConfigured,\n} from '@/lib/video/ltx-video';\n\n/**\n * Execution context passed from the chat route\n * Contains the authenticated user's information\n */\nexport interface ExecutionContext {\n  userId: string | null;\n  accessLevel: AccessLevel;\n  /** Optional job ID for tracking which background job triggered this tool */\n  jobId?: string;\n  /** Optional workspace ID for artifact storage */\n  workspaceId?: string;\n}\n\n// Default context for backwards compatibility (visitor with no userId)\nconst DEFAULT_CONTEXT: ExecutionContext = {\n  userId: null,\n  accessLevel: 'visitor',\n};\n\n/**\n * Get the effective userId for mutations\n * SECURITY: This ensures we never use a hardcoded owner ID\n * SECURITY: This function enforces that operations requiring a userId\n * are only executed by properly authenticated users with the correct access level.\n * The access level was already filtered at the API route level, but this\n * provides defense-in-depth in case of bugs in the filtering logic.\n */\nfunction getEffectiveUserId(\n  context: ExecutionContext,\n  requiredLevel: AccessLevel = 'owner'\n): string {\n  if (!context.userId) {\n    throw new Error('User ID required for this operation');\n  }\n\n  // Defense-in-depth: verify access level matches requirement\n  if (requiredLevel === 'owner' && context.accessLevel !== 'owner') {\n    throw new Error('Owner access required for this operation');\n  }\n\n  return context.userId;\n}\n\n// ============================================================================\n// PATH VALIDATION - Security Layer for File Operations\n// ============================================================================\n\n/**\n * Allowed base directories for file operations\n * Files outside these directories are rejected\n */\nconst ALLOWED_PATH_PREFIXES = [\n  '/workspace',\n  '/home/user',\n  '/tmp/sandbox',\n];\n\n/**\n * Blocked file patterns - these files should never be read/written\n * Even if they're in an allowed directory\n */\nconst BLOCKED_PATH_PATTERNS = [\n  /\\.env($|\\.)/i,                    // .env, .env.local, .env.production\n  /credentials/i,                     // Any credentials file\n  /secrets?\\.?(json|yaml|yml|toml)?$/i, // secrets.json, secret.yaml, etc.\n  /\\.key$/i,                          // Private keys\n  /\\.pem$/i,                          // Certificates/keys\n  /id_rsa/i,                          // SSH keys\n  /id_ed25519/i,                      // SSH keys\n  /\\.ssh\\//i,                         // SSH directory\n  /convex\\//,                         // Convex backend (should be modified via proper channels)\n  /node_modules\\//,                   // Don't touch node_modules\n  /\\.git\\//,                          // Git internals\n];\n\n/**\n * Path validation result\n */\ninterface PathValidationResult {\n  valid: boolean;\n  normalizedPath: string;\n  error?: string;\n}\n\n/**\n * Validate and normalize a file path for security\n *\n * Rules:\n * 1. Path must be absolute (starts with /)\n * 2. Path must be under an allowed prefix\n * 3. Path must not match any blocked patterns\n * 4. Path traversal (../) is rejected\n */\nfunction validatePath(path: string): PathValidationResult {\n  // Ensure path is a string\n  if (typeof path !== 'string' || !path) {\n    return { valid: false, normalizedPath: '', error: 'Path must be a non-empty string' };\n  }\n\n  // Check for path traversal attempts\n  if (path.includes('..')) {\n    return { valid: false, normalizedPath: '', error: 'Path traversal (..) is not allowed' };\n  }\n\n  // Ensure absolute path\n  if (!path.startsWith('/')) {\n    return { valid: false, normalizedPath: '', error: 'Path must be absolute (start with /)' };\n  }\n\n  // Normalize the path (remove double slashes, trailing slashes)\n  const normalizedPath = path\n    .replace(/\\/+/g, '/')           // Replace multiple slashes with single\n    .replace(/\\/$/, '');            // Remove trailing slash\n\n  // Check if path is under an allowed prefix\n  const isAllowedPrefix = ALLOWED_PATH_PREFIXES.some(prefix =>\n    normalizedPath === prefix || normalizedPath.startsWith(prefix + '/')\n  );\n\n  if (!isAllowedPrefix) {\n    return {\n      valid: false,\n      normalizedPath,\n      error: `Path must be under one of: ${ALLOWED_PATH_PREFIXES.join(', ')}`,\n    };\n  }\n\n  // Check against blocked patterns\n  for (const pattern of BLOCKED_PATH_PATTERNS) {\n    if (pattern.test(normalizedPath)) {\n      return {\n        valid: false,\n        normalizedPath,\n        error: `Access to this file type is blocked for security reasons`,\n      };\n    }\n  }\n\n  return { valid: true, normalizedPath };\n}\n\n/**\n * Helper to create a standardized path validation error result\n */\nfunction pathValidationError(error: string): ToolResult {\n  return {\n    success: false,\n    error: `[PATH SECURITY] ${error}`,\n  };\n}\n\n// ============================================================================\n// MESSAGE CONTENT VALIDATION - Security Layer for Channel Messages\n// ============================================================================\n\n/**\n * Patterns that indicate potential phishing or social engineering\n * These messages should be blocked or flagged for review\n */\nconst PHISHING_PATTERNS = [\n  // Credential harvesting\n  /password.*(?:expired|reset|verify|confirm|update)/i,\n  /(?:verify|confirm|update).*(?:account|identity|credentials)/i,\n  /(?:click|tap|visit).*(?:link|here).*(?:login|sign.?in|verify)/i,\n  /urgent.*(?:action|response).*required/i,\n\n  // Financial scams\n  /(?:wire|transfer|send).*(?:money|funds|payment|bitcoin|crypto)/i,\n  /(?:won|winner|lottery|prize|inheritance).*(?:claim|collect)/i,\n  /(?:bank|paypal|venmo).*(?:suspended|locked|verify)/i,\n\n  // Impersonation\n  /(?:i am|this is).*(?:ceo|cfo|president|boss|manager).*(?:need|want|request)/i,\n  /(?:gift.?card|itunes|amazon).*(?:purchase|buy|send)/i,\n\n  // Tech support scams\n  /(?:computer|device|account).*(?:infected|hacked|compromised)/i,\n  /(?:call|contact).*(?:immediately|urgently|asap)/i,\n];\n\n/**\n * URLs that look suspicious\n */\nconst SUSPICIOUS_URL_PATTERNS = [\n  /bit\\.ly/i,\n  /tinyurl/i,\n  /goo\\.gl/i,\n  /t\\.co(?!m)/i,  // t.co but not .com\n  /\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}/,  // Raw IP addresses\n  /(?:login|signin|verify|secure|account).*\\.(tk|ml|ga|cf|gq)/i, // Suspicious TLDs\n];\n\n/**\n * Message validation result\n */\ninterface MessageValidationResult {\n  valid: boolean;\n  error?: string;\n  warnings?: string[];\n}\n\n/**\n * Validate message content for security concerns\n */\nfunction validateMessageContent(content: string): MessageValidationResult {\n  if (!content || typeof content !== 'string') {\n    return { valid: false, error: 'Message content is required' };\n  }\n\n  // Check for empty or whitespace-only\n  if (content.trim().length === 0) {\n    return { valid: false, error: 'Message cannot be empty' };\n  }\n\n  // Check message length (prevent spam)\n  if (content.length > 10000) {\n    return { valid: false, error: 'Message too long (max 10000 characters)' };\n  }\n\n  // Check for phishing patterns\n  for (const pattern of PHISHING_PATTERNS) {\n    if (pattern.test(content)) {\n      return {\n        valid: false,\n        error: 'Message contains content that appears to be phishing or social engineering. Please rephrase.',\n      };\n    }\n  }\n\n  // Check for suspicious URLs (warning, not blocking)\n  const warnings: string[] = [];\n  for (const pattern of SUSPICIOUS_URL_PATTERNS) {\n    if (pattern.test(content)) {\n      warnings.push('Message contains a URL shortener or suspicious domain. Recipient may be cautious.');\n      break;\n    }\n  }\n\n  return { valid: true, warnings: warnings.length > 0 ? warnings : undefined };\n}\n\n/**\n * Helper to create a standardized message validation error result\n */\nfunction messageValidationError(error: string): ToolResult {\n  return {\n    success: false,\n    error: `[MESSAGE SECURITY] ${error}`,\n  };\n}\n\n// ============================================================================\n// SANDBOX VALIDATION - Security Layer for Code Execution\n// ============================================================================\n\n/**\n * Dangerous command patterns that should never be executed\n */\nconst DANGEROUS_COMMAND_PATTERNS = [\n  /rm\\s+-rf\\s+\\/(?![\\w])/i,           // rm -rf / (root)\n  /:\\s*\\(\\s*\\)\\s*\\{/i,                 // Fork bomb\n  />\\s*\\/dev\\/sd[a-z]/i,               // Writing to raw disk\n  /dd\\s+if=.*of=\\/dev/i,               // dd to device\n  /mkfs\\./i,                           // Format filesystem\n  /shutdown|reboot|halt|poweroff/i,    // System shutdown\n  /chmod\\s+777\\s+\\//i,                 // Chmod 777 root\n  /curl.*\\|\\s*(?:bash|sh)/i,           // Pipe curl to shell\n  /wget.*\\|\\s*(?:bash|sh)/i,           // Pipe wget to shell\n  /base64\\s+-d.*\\|\\s*(?:bash|sh)/i,    // Decode and execute\n  /eval\\s*\\(.*(?:curl|wget)/i,         // Eval with download\n];\n\n/**\n * Commands that require extra caution / explicit confirmation\n */\nconst CAUTIOUS_COMMAND_PATTERNS = [\n  /npm\\s+publish/i,                    // Publishing packages\n  /git\\s+push.*--force/i,              // Force push\n  /docker\\s+(?:rm|rmi)\\s+-f/i,         // Force remove containers/images\n  /kubectl\\s+delete/i,                 // Kubernetes delete\n  /aws\\s+.*delete/i,                   // AWS delete operations\n];\n\n/**\n * Command validation result\n */\ninterface CommandValidationResult {\n  valid: boolean;\n  error?: string;\n  warning?: string;\n  requiresSandbox: boolean;\n}\n\n/**\n * Validate a command for security concerns\n */\nfunction validateCommand(command: string): CommandValidationResult {\n  if (!command || typeof command !== 'string') {\n    return { valid: false, error: 'Command is required', requiresSandbox: true };\n  }\n\n  // Check for empty command\n  if (command.trim().length === 0) {\n    return { valid: false, error: 'Command cannot be empty', requiresSandbox: true };\n  }\n\n  // Check command length\n  if (command.length > 10000) {\n    return { valid: false, error: 'Command too long (max 10000 characters)', requiresSandbox: true };\n  }\n\n  // Check for dangerous patterns\n  for (const pattern of DANGEROUS_COMMAND_PATTERNS) {\n    if (pattern.test(command)) {\n      return {\n        valid: false,\n        error: 'Command contains dangerous patterns that could harm the system',\n        requiresSandbox: true,\n      };\n    }\n  }\n\n  // Check for cautious patterns (warn but allow)\n  let warning: string | undefined;\n  for (const pattern of CAUTIOUS_COMMAND_PATTERNS) {\n    if (pattern.test(command)) {\n      warning = 'This command performs a sensitive operation. Proceed with caution.';\n      break;\n    }\n  }\n\n  return { valid: true, warning, requiresSandbox: true };\n}\n\n/**\n * Helper to create a standardized command validation error result\n */\nfunction commandValidationError(error: string): ToolResult {\n  return {\n    success: false,\n    error: `[COMMAND SECURITY] ${error}`,\n  };\n}\n\n// ============================================================================\n// GIT BRANCH VALIDATION - Security Layer for Repository Operations\n// ============================================================================\n\n/**\n * Validate a Git branch name to prevent command injection\n *\n * Git branch names can contain alphanumeric characters, dots, slashes,\n * underscores, and hyphens. They must NOT contain shell metacharacters\n * that could enable command injection attacks.\n *\n * @param branch - The branch name to validate\n * @returns true if the branch name is valid, false otherwise\n */\nfunction isValidGitBranch(branch: string): boolean {\n  // Git branch names can contain: alphanumeric, ., /, _, -\n  // Must NOT contain shell metacharacters: ; | & $ ` ( ) { } < > \\n\n  const validBranchRegex = /^[a-zA-Z0-9._\\/-]+$/;\n  return (\n    validBranchRegex.test(branch) &&\n    !branch.includes('..') &&\n    branch.length > 0 &&\n    branch.length <= 255\n  );\n}\n\n// ============================================================================\n// NETWORK WHITELISTING - Phase 1.5 OpenClaw Safety Stack\n// ============================================================================\n\n/**\n * Whitelisted domains for agent network access\n * Only these domains can be accessed from sandbox environments\n */\nexport const NETWORK_WHITELIST = new Set([\n  // Package registries\n  'registry.npmjs.org',\n  'npm.pkg.github.com',\n  'pypi.org',\n  'files.pythonhosted.org',\n  'crates.io',\n  'static.crates.io',\n  'rubygems.org',\n\n  // Code hosting\n  'github.com',\n  'api.github.com',\n  'raw.githubusercontent.com',\n  'gist.githubusercontent.com',\n  'gitlab.com',\n  'bitbucket.org',\n\n  // Documentation\n  'docs.github.com',\n  'docs.npmjs.com',\n  'docs.python.org',\n  'devdocs.io',\n  'developer.mozilla.org',\n\n  // CDNs commonly needed for development\n  'cdn.jsdelivr.net',\n  'unpkg.com',\n  'cdnjs.cloudflare.com',\n\n  // Build tools\n  'nodejs.org',\n  'deno.land',\n\n  // Cloud providers (for CLI tools)\n  'vercel.com',\n  'api.vercel.com',\n  'registry.terraform.io',\n]);\n\n/**\n * Domains that are always blocked (even if in whitelist)\n */\nconst NETWORK_BLOCKLIST = new Set([\n  'localhost',\n  '127.0.0.1',\n  '0.0.0.0',\n  '169.254.169.254',  // AWS metadata endpoint\n  'metadata.google.internal',  // GCP metadata\n]);\n\n/**\n * Network validation result\n */\ninterface NetworkValidationResult {\n  valid: boolean;\n  domain?: string;\n  error?: string;\n  warning?: string;\n}\n\n/**\n * Extract domain from URL\n */\nfunction extractDomain(url: string): string | null {\n  try {\n    // Handle URLs with or without protocol\n    const urlWithProtocol = url.startsWith('http') ? url : `https://${url}`;\n    const parsed = new URL(urlWithProtocol);\n    return parsed.hostname.toLowerCase();\n  } catch {\n    // Try to extract domain from common patterns\n    const match = url.match(/^(?:https?:\\/\\/)?([^\\/:\\s]+)/);\n    return match ? match[1].toLowerCase() : null;\n  }\n}\n\n/**\n * Validate a URL against the network whitelist\n */\nexport function validateNetworkAccess(url: string): NetworkValidationResult {\n  const domain = extractDomain(url);\n\n  if (!domain) {\n    return {\n      valid: false,\n      error: 'Invalid URL format',\n    };\n  }\n\n  // Check blocklist first (absolute rejection)\n  if (NETWORK_BLOCKLIST.has(domain)) {\n    return {\n      valid: false,\n      domain,\n      error: `Access to ${domain} is blocked for security reasons`,\n    };\n  }\n\n  // Check if it's an IP address (block unless explicitly whitelisted)\n  if (/^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$/.test(domain)) {\n    return {\n      valid: false,\n      domain,\n      error: 'Direct IP address access is not allowed. Use domain names.',\n    };\n  }\n\n  // Check whitelist\n  if (NETWORK_WHITELIST.has(domain)) {\n    return {\n      valid: true,\n      domain,\n    };\n  }\n\n  // Check for subdomains of whitelisted domains\n  for (const whitelisted of NETWORK_WHITELIST) {\n    if (domain.endsWith(`.${whitelisted}`)) {\n      return {\n        valid: true,\n        domain,\n        warning: `Subdomain of whitelisted domain: ${whitelisted}`,\n      };\n    }\n  }\n\n  // Not in whitelist\n  return {\n    valid: false,\n    domain,\n    error: `Domain not in network whitelist: ${domain}. Allowed: npm, github, pypi, and standard dev tools.`,\n  };\n}\n\n/**\n * Check if a command contains network access to non-whitelisted domains\n */\nexport function validateCommandNetworkAccess(command: string): NetworkValidationResult {\n  // Extract URLs from command\n  const urlPatterns = [\n    /https?:\\/\\/[^\\s\"']+/g,           // Standard URLs\n    /git@([^:]+):/g,                   // Git SSH URLs\n    /(?:curl|wget|fetch)\\s+[^\\s]+/g,   // Common download commands\n  ];\n\n  for (const pattern of urlPatterns) {\n    const matches = command.match(pattern);\n    if (matches) {\n      for (const match of matches) {\n        // Extract URL from the match\n        const url = match.replace(/^(curl|wget|fetch)\\s+/, '').replace(/git@/, 'https://');\n        const result = validateNetworkAccess(url);\n        if (!result.valid) {\n          return result;\n        }\n      }\n    }\n  }\n\n  return { valid: true };\n}\n\n/**\n * Helper to create network validation error result\n */\nfunction networkValidationError(error: string): ToolResult {\n  return {\n    success: false,\n    error: `[NETWORK SECURITY] ${error}`,\n  };\n}\n\n// ============================================================================\n// APPROVAL SYSTEM - Phase 1.2 OpenClaw Safety Stack\n// ============================================================================\n\n/**\n * Destructive actions that require user approval before execution\n */\nexport const DESTRUCTIVE_ACTIONS = new Set([\n  // File mutations\n  'delete_file',\n  // Git mutations that can't be easily undone\n  'git_push',\n  // External communications\n  'send_channel_message',\n  // System mutations\n  'delete_cron_job',\n  // Scheduling mutations that affect others\n  'cancel_meeting',\n]);\n\n/**\n * Actions that require approval on first use (e.g., new contact)\n */\nexport const FIRST_USE_APPROVAL_ACTIONS = new Set([\n  'send_channel_message',  // First message to new contact\n  'book_meeting',          // First meeting with new guest\n]);\n\n/**\n * Approval request returned when an action needs user confirmation\n */\nexport interface ApprovalRequest {\n  required: boolean;\n  reason: string;\n  actionType: 'destructive' | 'first_use' | 'expensive' | 'external';\n  toolName: string;\n  toolArgs: Record<string, unknown>;\n  consequences: string[];\n  approvalId: string;\n}\n\n/**\n * Check if a tool action requires approval\n * Returns null if no approval needed, or an ApprovalRequest if approval required\n */\nexport async function checkApprovalRequired(\n  toolName: string,\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ApprovalRequest | null> {\n  // Destructive actions always require approval\n  if (DESTRUCTIVE_ACTIONS.has(toolName)) {\n    const consequences = getDestructiveConsequences(toolName, args);\n    return {\n      required: true,\n      reason: getApprovalReason(toolName, args),\n      actionType: 'destructive',\n      toolName,\n      toolArgs: args,\n      consequences,\n      approvalId: generateApprovalId(toolName, args),\n    };\n  }\n\n  // Special case: send_channel_message to new contact\n  if (toolName === 'send_channel_message') {\n    const isNewContact = await checkIfNewContact(args, context);\n    if (isNewContact) {\n      return {\n        required: true,\n        reason: 'This is your first message to this contact. Please confirm.',\n        actionType: 'first_use',\n        toolName,\n        toolArgs: args,\n        consequences: ['Message will be sent externally', 'Contact will see you initiated conversation'],\n        approvalId: generateApprovalId(toolName, args),\n      };\n    }\n  }\n\n  return null;\n}\n\n/**\n * Get human-readable reason for why approval is needed\n */\nfunction getApprovalReason(toolName: string, args: Record<string, unknown>): string {\n  switch (toolName) {\n    case 'delete_file':\n      return `Delete file: ${args.path || 'unknown path'}`;\n    case 'git_push':\n      const branch = args.branch || 'current branch';\n      const force = args.force ? ' (FORCE PUSH)' : '';\n      return `Push to remote${force}: ${branch}`;\n    case 'send_channel_message':\n      return `Send message via ${args.channel || 'channel'}`;\n    case 'delete_cron_job':\n      return `Delete scheduled job: ${args.jobId || 'unknown'}`;\n    case 'cancel_meeting':\n      return `Cancel meeting: ${args.meetingId || 'unknown'}`;\n    default:\n      return `Execute ${toolName}`;\n  }\n}\n\n/**\n * Get list of consequences for destructive actions\n */\nfunction getDestructiveConsequences(toolName: string, args: Record<string, unknown>): string[] {\n  switch (toolName) {\n    case 'delete_file':\n      return [\n        'File will be permanently deleted',\n        'This cannot be undone',\n        'Any references to this file may break',\n      ];\n    case 'git_push':\n      if (args.force) {\n        return [\n          'Remote history will be overwritten',\n          'Other collaborators may lose work',\n          'This cannot be easily undone',\n        ];\n      }\n      return [\n        'Changes will be pushed to remote',\n        'Others will see these commits',\n      ];\n    case 'send_channel_message':\n      return [\n        'Message will be sent externally',\n        'Recipient will be notified',\n        'Message cannot be unsent',\n      ];\n    case 'delete_cron_job':\n      return [\n        'Scheduled automation will be stopped',\n        'Job configuration will be lost',\n      ];\n    case 'cancel_meeting':\n      return [\n        'All participants will be notified',\n        'Calendar events will be removed',\n      ];\n    default:\n      return ['This action may have permanent effects'];\n  }\n}\n\n/**\n * Generate a unique approval ID for tracking\n */\nfunction generateApprovalId(toolName: string, args: Record<string, unknown>): string {\n  const timestamp = Date.now();\n  const argsHash = JSON.stringify(args).slice(0, 50);\n  return `approval_${toolName}_${timestamp}_${Buffer.from(argsHash).toString('base64').slice(0, 10)}`;\n}\n\n/**\n * Result when approval is required (tool not executed)\n */\nexport function approvalRequiredResult(approval: ApprovalRequest): ToolResult {\n  return {\n    success: false,\n    requiresApproval: true,\n    approval,\n    data: {\n      message: `This action requires your approval: ${approval.reason}`,\n      approvalId: approval.approvalId,\n      consequences: approval.consequences,\n    },\n  };\n}\n\n// ============================================================================\n// CONTACT DEDUPLICATION - EPIC-001\n// ============================================================================\n\n/**\n * Normalize a name for fuzzy matching\n * Removes common titles, lowercases, removes punctuation\n */\nfunction normalizeName(name: string): string {\n  return name\n    .toLowerCase()\n    .replace(/^(mr|mrs|ms|dr|prof|sir|madam)\\.?\\s+/i, '') // Remove titles\n    .replace(/[^a-z0-9\\s]/g, '') // Remove punctuation\n    .replace(/\\s+/g, ' ') // Normalize spaces\n    .trim();\n}\n\n/**\n * Calculate Levenshtein distance between two strings\n * Used for fuzzy name matching\n */\nfunction levenshteinDistance(str1: string, str2: string): number {\n  const m = str1.length;\n  const n = str2.length;\n  const dp: number[][] = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));\n\n  for (let i = 0; i <= m; i++) dp[i][0] = i;\n  for (let j = 0; j <= n; j++) dp[0][j] = j;\n\n  for (let i = 1; i <= m; i++) {\n    for (let j = 1; j <= n; j++) {\n      if (str1[i - 1] === str2[j - 1]) {\n        dp[i][j] = dp[i - 1][j - 1];\n      } else {\n        dp[i][j] = Math.min(\n          dp[i - 1][j] + 1,    // deletion\n          dp[i][j - 1] + 1,    // insertion\n          dp[i - 1][j - 1] + 1 // substitution\n        );\n      }\n    }\n  }\n\n  return dp[m][n];\n}\n\n/**\n * Calculate name similarity score (0-1, where 1 is identical)\n */\nfunction calculateNameSimilarity(name1: string, name2: string): number {\n  const normalized1 = normalizeName(name1);\n  const normalized2 = normalizeName(name2);\n\n  if (normalized1 === normalized2) return 1.0;\n\n  const maxLen = Math.max(normalized1.length, normalized2.length);\n  if (maxLen === 0) return 0;\n\n  const distance = levenshteinDistance(normalized1, normalized2);\n  return 1 - (distance / maxLen);\n}\n\n/**\n * Normalize email for matching\n */\nfunction normalizeEmail(email: string): string {\n  return email.toLowerCase().trim();\n}\n\n/**\n * Normalize phone number for matching (strips all non-digits)\n */\nfunction normalizePhone(phone: string): string {\n  return phone.replace(/\\D/g, '');\n}\n\n/**\n * Contact match result\n */\ninterface ContactMatch {\n  contactId: string;\n  matchType: 'exact_phone' | 'exact_email' | 'fuzzy_name' | 'partial';\n  confidence: number; // 0-1\n  existingContact: any;\n}\n\n/**\n * Find matching contacts in the system\n * Checks phone, email, and name similarity\n */\nasync function findMatchingContacts(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ContactMatch[]> {\n  const recipientId = args.recipientId as string | undefined;\n  const recipientName = args.recipientName as string | undefined;\n  const recipientEmail = args.recipientEmail as string | undefined;\n\n  if (!recipientId && !recipientName && !recipientEmail) {\n    return [];\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return [];\n  }\n\n  const matches: ContactMatch[] = [];\n  const client = new ConvexHttpClient(convexUrl);\n\n  try {\n    // Check 1: Exact phone match (highest priority)\n    if (recipientId) {\n      const normalizedPhone = normalizePhone(recipientId);\n      const phoneContact = await client.query(api.whatsappContacts.getContactByPhone, {\n        phoneNumber: normalizedPhone,\n      });\n\n      if (phoneContact) {\n        matches.push({\n          contactId: phoneContact._id,\n          matchType: 'exact_phone',\n          confidence: 1.0,\n          existingContact: phoneContact,\n        });\n      }\n    }\n\n    // Check 2: Exact email match\n    if (recipientEmail && matches.length === 0) {\n      const normalizedEmail = normalizeEmail(recipientEmail);\n      const allContacts = await client.query(api.whatsappContacts.listContacts, {});\n\n      for (const contact of allContacts) {\n        if (contact.email && normalizeEmail(contact.email) === normalizedEmail) {\n          matches.push({\n            contactId: contact._id,\n            matchType: 'exact_email',\n            confidence: 1.0,\n            existingContact: contact,\n          });\n          break;\n        }\n      }\n    }\n\n    // Check 3: Fuzzy name match (if no exact matches found)\n    if (recipientName && matches.length === 0) {\n      const allContacts = await client.query(api.whatsappContacts.listContacts, {});\n\n      for (const contact of allContacts) {\n        if (contact.displayName) {\n          const similarity = calculateNameSimilarity(recipientName, contact.displayName);\n\n          // High confidence threshold: 0.85+ similarity\n          if (similarity >= 0.85) {\n            matches.push({\n              contactId: contact._id,\n              matchType: 'fuzzy_name',\n              confidence: similarity,\n              existingContact: contact,\n            });\n          }\n        }\n      }\n\n      // Sort by confidence (highest first)\n      matches.sort((a, b) => b.confidence - a.confidence);\n    }\n\n    return matches;\n  } catch (error) {\n    console.error('[ContactDedup] Error finding matching contacts:', error);\n    return [];\n  }\n}\n\n/**\n * Check if a contact is new (for approval flow)\n * Returns true if this is the first message to this contact\n */\nasync function checkIfNewContact(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<boolean> {\n  const integrationId = args.integrationId as string | undefined;\n  const recipientId = args.recipientId as string | undefined;\n\n  if (!integrationId || !recipientId) {\n    // If we can't determine the recipient, treat as new for safety\n    return true;\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return true;\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    // First check if contact exists\n    const matches = await findMatchingContacts(args, context);\n    if (matches.length === 0) {\n      return true; // No existing contact found\n    }\n\n    // Check if we've sent messages to this integration/recipient before\n    // Query channelMessages for any previous messages\n    const userId = context.userId;\n    if (!userId) {\n      return true; // No user context, treat as new\n    }\n\n    // Get the first match (highest confidence)\n    const bestMatch = matches[0];\n    const normalizedRecipient = normalizePhone(recipientId);\n\n    // Query for previous messages to this recipient via this integration\n    const userMessages = await client.query(api.channels.getUserMessages, {\n      userId,\n      limit: 100, // Check last 100 messages\n    });\n\n    // Check if any message was sent to this recipient\n    const hasPreviousMessages = userMessages.some((msg: any) => {\n      if (msg.integrationId !== integrationId) return false;\n      const msgRecipient = normalizePhone(msg.recipientId || '');\n      return msgRecipient === normalizedRecipient;\n    });\n\n    return !hasPreviousMessages;\n  } catch (error) {\n    console.error('[ContactDedup] Error checking if new contact:', error);\n    // On error, treat as new for safety (requires approval)\n    return true;\n  }\n}\n\n/**\n * Get or create contact with deduplication\n * Returns existing contact if found, creates new one otherwise\n */\nexport async function getOrCreateContact(\n  args: {\n    phoneNumber?: string;\n    email?: string;\n    displayName?: string;\n    accessLevel?: 'owner' | 'collaborator' | 'visitor';\n  },\n  context: ExecutionContext\n): Promise<{ contactId: string; isNew: boolean; matchType?: string }> {\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    throw new Error('Convex URL not configured');\n  }\n\n  const client = new ConvexHttpClient(convexUrl);\n\n  // Find matching contacts\n  const matches = await findMatchingContacts(args, context);\n\n  if (matches.length > 0) {\n    const bestMatch = matches[0];\n\n    // If confidence is high (0.95+), return existing contact\n    if (bestMatch.confidence >= 0.95) {\n      return {\n        contactId: bestMatch.contactId,\n        isNew: false,\n        matchType: bestMatch.matchType,\n      };\n    }\n\n    // If confidence is medium (0.85-0.95), could implement merge logic here\n    // For now, we'll create a new contact and let the user merge manually\n  }\n\n  // No match found or low confidence - create new contact\n  const contactId = await client.mutation(api.whatsappContacts.upsertContact, {\n    phoneNumber: args.phoneNumber || '',\n    displayName: args.displayName,\n    email: args.email,\n    accessLevel: args.accessLevel || 'visitor',\n  });\n\n  return {\n    contactId,\n    isNew: true,\n  };\n}\n\n// ============================================================================\n// COST ESTIMATION - Phase 1.3 OpenClaw Safety Stack\n// ============================================================================\n\n/**\n * Cost types for different resources\n */\nexport interface CostEstimate {\n  estimatedTokens?: number;      // AI tokens (input + output)\n  estimatedApiCalls?: number;    // External API calls\n  estimatedTimeMs?: number;      // Wall-clock time\n  estimatedCredits?: number;     // Platform credits (Vercel, etc.)\n  breakdown?: CostBreakdownItem[];\n  warning?: string;\n  requiresConfirmation: boolean;\n}\n\nexport interface CostBreakdownItem {\n  resource: string;\n  amount: number;\n  unit: string;\n  cost?: number;  // In cents, if applicable\n}\n\n/**\n * Operations that are considered \"expensive\" and need cost estimation\n */\nconst EXPENSIVE_OPERATIONS: Record<string, {\n  baseTokens?: number;\n  baseTimeMs?: number;\n  apiCalls?: number;\n  creditsPerCall?: number;\n  tokensPerKb?: number;  // For file operations\n  confirmationThreshold?: {\n    tokens?: number;\n    time?: number;\n    cost?: number;\n  };\n}> = {\n  // AI operations\n  'compact_conversation': {\n    baseTokens: 10000,\n    baseTimeMs: 5000,\n    confirmationThreshold: { tokens: 50000 },\n  },\n  // Code execution\n  'run_command': {\n    baseTimeMs: 30000,\n    confirmationThreshold: { time: 60000 },\n  },\n  'start_dev_server': {\n    baseTimeMs: 60000,\n    creditsPerCall: 10,  // Vercel sandbox credits\n    confirmationThreshold: { time: 120000 },\n  },\n  // Repository operations\n  'clone_repository': {\n    baseTimeMs: 30000,\n    apiCalls: 1,\n    confirmationThreshold: { time: 60000 },\n  },\n  // Large file operations\n  'write_file': {\n    tokensPerKb: 100,\n    baseTimeMs: 1000,\n  },\n  'read_file': {\n    tokensPerKb: 50,\n    baseTimeMs: 500,\n  },\n  // External communications\n  'send_channel_message': {\n    apiCalls: 1,\n    baseTimeMs: 2000,\n  },\n};\n\n/**\n * Estimate the cost of executing a tool\n * Returns null if the operation is cheap/instant\n */\nexport function estimateCost(\n  toolName: string,\n  args: Record<string, unknown>\n): CostEstimate | null {\n  const config = EXPENSIVE_OPERATIONS[toolName];\n  if (!config) {\n    return null;  // Not an expensive operation\n  }\n\n  const breakdown: CostBreakdownItem[] = [];\n  let totalTokens = config.baseTokens || 0;\n  let totalTimeMs = config.baseTimeMs || 0;\n  let totalApiCalls = config.apiCalls || 0;\n  let totalCredits = config.creditsPerCall || 0;\n  let warning: string | undefined;\n\n  // Estimate based on content size if applicable\n  if (config.tokensPerKb && args.content) {\n    const contentLength = String(args.content).length;\n    const contentKb = contentLength / 1024;\n    const contentTokens = Math.ceil(contentKb * config.tokensPerKb);\n    totalTokens += contentTokens;\n    breakdown.push({\n      resource: 'Content processing',\n      amount: contentTokens,\n      unit: 'tokens',\n    });\n  }\n\n  // Estimate time based on command complexity\n  if (toolName === 'run_command' && args.command) {\n    const command = String(args.command);\n    // npm/pnpm installs take longer\n    if (/npm|pnpm|yarn/.test(command) && /install|add|update/.test(command)) {\n      totalTimeMs *= 3;\n      warning = 'Package installation can take several minutes';\n    }\n    // Build commands take longer\n    if (/build|compile|test/.test(command)) {\n      totalTimeMs *= 2;\n    }\n  }\n\n  // Check if confirmation is needed\n  const threshold = config.confirmationThreshold || {};\n  const requiresConfirmation = !!(\n    (threshold.tokens && totalTokens > threshold.tokens) ||\n    (threshold.time && totalTimeMs > threshold.time) ||\n    (threshold.cost && totalCredits > (threshold.cost || 0))\n  );\n\n  // Add standard breakdown items\n  if (totalTokens > 0) {\n    breakdown.push({\n      resource: 'AI tokens',\n      amount: totalTokens,\n      unit: 'tokens',\n      cost: Math.ceil(totalTokens * 0.003),  // ~$0.003 per 1K tokens estimate\n    });\n  }\n  if (totalTimeMs > 0) {\n    breakdown.push({\n      resource: 'Estimated time',\n      amount: Math.ceil(totalTimeMs / 1000),\n      unit: 'seconds',\n    });\n  }\n  if (totalApiCalls > 0) {\n    breakdown.push({\n      resource: 'External API calls',\n      amount: totalApiCalls,\n      unit: 'calls',\n    });\n  }\n  if (totalCredits > 0) {\n    breakdown.push({\n      resource: 'Platform credits',\n      amount: totalCredits,\n      unit: 'credits',\n    });\n  }\n\n  // Only return if there's meaningful cost\n  if (breakdown.length === 0) {\n    return null;\n  }\n\n  return {\n    estimatedTokens: totalTokens > 0 ? totalTokens : undefined,\n    estimatedTimeMs: totalTimeMs > 0 ? totalTimeMs : undefined,\n    estimatedApiCalls: totalApiCalls > 0 ? totalApiCalls : undefined,\n    estimatedCredits: totalCredits > 0 ? totalCredits : undefined,\n    breakdown,\n    warning,\n    requiresConfirmation,\n  };\n}\n\n/**\n * Format cost estimate for display\n */\nexport function formatCostEstimate(cost: CostEstimate): string {\n  const parts: string[] = [];\n\n  if (cost.estimatedTimeMs) {\n    const seconds = Math.ceil(cost.estimatedTimeMs / 1000);\n    parts.push(`~${seconds}s`);\n  }\n  if (cost.estimatedTokens) {\n    parts.push(`~${(cost.estimatedTokens / 1000).toFixed(1)}K tokens`);\n  }\n  if (cost.estimatedApiCalls) {\n    parts.push(`${cost.estimatedApiCalls} API call${cost.estimatedApiCalls > 1 ? 's' : ''}`);\n  }\n\n  return parts.join(' | ') || 'minimal cost';\n}\n\n// Execute a single tool call\nexport async function executeTool(\n  toolCall: ToolCall,\n  context: ExecutionContext = DEFAULT_CONTEXT,\n  options: { skipApprovalCheck?: boolean; approvalId?: string; skipCostEstimate?: boolean } = {}\n): Promise<ToolResult> {\n  const { name, arguments: args } = toolCall;\n\n  // SECURITY: Check if approval is required for destructive actions\n  // Skip if approval was already granted (approvalId matches)\n  if (!options.skipApprovalCheck) {\n    const approvalRequired = await checkApprovalRequired(name, args as Record<string, unknown>, context);\n    if (approvalRequired && approvalRequired.approvalId !== options.approvalId) {\n      return approvalRequiredResult(approvalRequired);\n    }\n  }\n\n  // COST: Calculate cost estimate for expensive operations\n  const costEstimate = !options.skipCostEstimate\n    ? estimateCost(name, args as Record<string, unknown>)\n    : null;\n\n  // Helper to attach cost estimate to results\n  const withCost = (result: ToolResult): ToolResult => {\n    if (costEstimate) {\n      return { ...result, costEstimate };\n    }\n    return result;\n  };\n\n  try {\n    switch (name) {\n      case 'search_system':\n        return withCost(executeSearchSystem(args));\n\n      case 'navigate_to':\n        return executeNavigateTo(args);\n\n      case 'schedule_call':\n        return executeScheduleCall(args);\n\n      case 'list_themes':\n        return executeListThemes(args);\n\n      case 'open_search_app':\n        return executeOpenSearchApp(args);\n\n      case 'show_weather':\n        return executeShowWeather(args);\n\n      case 'show_kanban_tasks':\n        return executeShowKanbanTasks(args);\n\n      case 'show_photos':\n        return executeShowPhotos(args);\n\n      case 'render_ui':\n        return executeRenderUI(args);\n\n      // Agentic Product Lifecycle Tools\n      case 'create_project':\n        return executeCreateProject(args);\n\n      case 'create_prd':\n        return executeCreatePRD(args);\n\n      case 'create_ticket':\n        return executeCreateTicket(args);\n\n      case 'update_ticket':\n        return executeUpdateTicket(args);\n\n      case 'shard_prd':\n        return executeShardPRD(args);\n\n      case 'get_project_kanban':\n        return executeGetProjectKanban(args);\n\n      case 'list_projects':\n        return executeListProjects(args);\n\n      // Scheduling Tools\n      case 'get_available_times':\n        return await executeGetAvailableTimes(args);\n\n      case 'get_upcoming_bookings':\n        return await executeGetUpcomingBookings(args);\n\n      case 'book_meeting':\n        return await executeBookMeeting(args);\n\n      case 'reschedule_meeting':\n        return await executeRescheduleMeeting(args);\n\n      case 'cancel_meeting':\n        return await executeCancelMeeting(args);\n\n      // Memory Tools (RLM - Recursive Memory Layer)\n      // SECURITY: These tools require authenticated userId\n      case 'remember':\n        return await executeRemember(args, context);\n\n      case 'recall_preference':\n        return await executeRecallPreference(args, context);\n\n      case 'memorize':\n        return await executeMemorize(args, context);\n\n      case 'learn':\n        return await executeLearn(args, context);\n\n      case 'forget':\n        return await executeForget(args, context);\n\n      // OpenClaw Coding Tools\n      case 'set_active_context':\n        return await executeSetActiveContext(args);\n\n      case 'get_active_context':\n        return await executeGetActiveContext(args);\n\n      case 'load_context_from_reference':\n        return await executeLoadContextFromReference(args);\n\n      case 'clone_repository':\n        return await executeCloneRepository(args);\n\n      case 'list_directory':\n        return await executeListDirectory(args);\n\n      case 'search_codebase':\n        return await executeSearchCodebase(args);\n\n      case 'read_file':\n        return await executeReadFile(args);\n\n      case 'write_file':\n        return await executeWriteFile(args);\n\n      case 'edit_file':\n        return await executeEditFile(args);\n\n      case 'delete_file':\n        return await executeDeleteFile(args);\n\n      case 'run_command':\n        return await executeRunCommand(args);\n\n      case 'start_dev_server':\n        return await executeStartDevServer(args);\n\n      case 'get_preview_url':\n        return await executeGetPreviewUrl(args);\n\n      case 'git_status':\n        return await executeGitStatus(args);\n\n      case 'git_diff':\n        return await executeGitDiff(args);\n\n      case 'git_commit':\n        return await executeGitCommit(args);\n\n      case 'git_push':\n        return await executeGitPush(args);\n\n      case 'create_branch':\n        return await executeCreateBranch(args);\n\n      case 'create_coding_task':\n        return await executeCreateCodingTask(args);\n\n      case 'update_coding_task':\n        return await executeUpdateCodingTask(args);\n\n      case 'list_coding_tasks':\n        return await executeListCodingTasks(args);\n\n      // Cron Job Tools\n      // SECURITY: These tools require authenticated userId\n      case 'create_cron_job':\n        return await executeCreateCronJob(args, context);\n\n      case 'list_cron_jobs':\n        return await executeListCronJobs(args, context);\n\n      case 'toggle_cron_job':\n        return await executeToggleCronJob(args);\n\n      case 'delete_cron_job':\n        return await executeDeleteCronJob(args);\n\n      // Compaction Tools\n      // SECURITY: Compaction uses memory APIs that require userId\n      case 'compact_conversation':\n        return await executeCompactConversation(args, context);\n\n      case 'get_compaction_summary':\n        return await executeGetCompactionSummary(args);\n\n      // ======================================================================\n      // Channel Integration Tools\n      // SECURITY: Channel tools require authenticated userId\n      // ======================================================================\n      case 'list_channel_integrations':\n        return await executeListChannelIntegrations(args, context);\n\n      case 'get_channel_conversations':\n        return await executeGetChannelConversations(args, context);\n\n      case 'send_channel_message':\n        return await executeSendChannelMessage(args, context);\n\n      case 'search_channel_messages':\n        return await executeSearchChannelMessages(args, context);\n\n      // ERV Dimension Tools\n      case 'create_dimension':\n        return await executeCreateDimension(args);\n\n      case 'navigate_to_dimension':\n        return executeNavigateToDimension(args);\n\n      case 'list_dimensions':\n        return await executeListDimensions(args);\n\n      case 'search_entities':\n        return await executeSearchEntities(args);\n\n      // ERV Ontology Tools - AI-Assisted Classification\n      case 'analyze_and_create_entity':\n        return await executeAnalyzeAndCreateEntity(args, context);\n\n      case 'suggest_entity_relationships':\n        return await executeSuggestEntityRelationships(args, context);\n\n      case 'bulk_classify_entities':\n        return await executeBulkClassifyEntities(args, context);\n\n      // Video/Remotion Tools\n      case 'create_video_composition':\n        return executeCreateVideoComposition(args);\n      case 'add_text_overlay':\n        return executeAddTextOverlay(args);\n      case 'add_lyrics_to_video':\n        return executeAddLyricsToVideo(args);\n      case 'add_media_to_video':\n        return executeAddMediaToVideo(args);\n      case 'preview_video':\n        return executePreviewVideo(args);\n      case 'render_video':\n        return await executeRenderVideo(args);\n      case 'sync_lyrics_to_audio':\n        return await executeSyncLyricsToAudio(args);\n      case 'get_render_status':\n        return await executeGetRenderStatus(args);\n\n      // Talking Video Tools\n      case 'create_talking_video':\n        return await executeCreateTalkingVideo(args);\n      case 'generate_video_script':\n        return await executeGenerateVideoScript(args);\n      case 'generate_voice_audio':\n        return await executeGenerateVoiceAudio(args);\n      case 'navigate_to_video_studio':\n        return executeNavigateToVideoStudio(args);\n\n      // LTX-2 Video Generation Tools\n      case 'generate_video':\n        return await executeGenerateVideo(args);\n      case 'animate_image':\n        return await executeAnimateImage(args);\n      case 'list_video_presets':\n        return executeListVideoPresets();\n\n      // AI Provider Tools\n      case 'get_ai_provider_status':\n        return executeGetAIProviderStatus(args);\n\n      case 'navigate_to_ai_settings':\n        return executeNavigateToAISettings();\n\n      // Kanban Task Reading Tools\n      case 'get_kanban_task':\n        return await executeGetKanbanTask(args);\n      case 'search_kanban_tasks':\n        return await executeSearchKanbanTasks(args);\n\n      // Design Canvas Tools\n      case 'create_canvas':\n        return await executeCreateCanvas(args, context);\n      case 'list_canvases':\n        return await executeListCanvases(args, context);\n      case 'get_canvas':\n        return await executeGetCanvas(args);\n      case 'add_canvas_node':\n        return await executeAddCanvasNode(args, context);\n      case 'add_canvas_edge':\n        return await executeAddCanvasEdge(args);\n      case 'update_canvas_node':\n        return await executeUpdateCanvasNode(args);\n\n      // Apple Health Tools\n      case 'get_health_summary':\n        return await executeGetHealthSummary(args, context);\n      case 'get_health_trends':\n        return await executeGetHealthTrends(args, context);\n      case 'get_health_metric':\n        return await executeGetHealthMetric(args, context);\n      case 'compare_health_periods':\n        return await executeCompareHealthPeriods(args, context);\n      case 'generate_health_api_key':\n        return await executeGenerateHealthApiKey(args, context);\n      case 'list_health_api_keys':\n        return await executeListHealthApiKeys(context);\n      case 'revoke_health_api_key':\n        return await executeRevokeHealthApiKey(args, context);\n      case 'get_health_sync_status':\n        return await executeGetHealthSyncStatus(args, context);\n\n      // =========================================================================\n      // Autonomous Execution Tools\n      // =========================================================================\n      case 'spawn_task':\n        return await executeSpawnTask(args);\n\n      case 'list_background_tasks':\n        return await executeListBackgroundTasks(args);\n\n      case 'cancel_background_task':\n        return await executeCancelBackgroundTask(args);\n\n      case 'get_task_result':\n        return await executeGetTaskResult(args);\n\n      case 'iterate_on_code':\n        return await executeIterateOnCode(args);\n\n      case 'delegate_to_specialist':\n        return await executeDelegateToSpecialist(args);\n\n      // =========================================================================\n      // Music Generation Tools (ACE-Step via Lynkr)\n      // =========================================================================\n      case 'cowrite_music':\n        return await executeCowriteMusic(args, context);\n\n      case 'generate_music':\n        return await executeGenerateMusic(args, context);\n\n      case 'analyze_audio':\n        return await executeAnalyzeAudio(args, context);\n\n      case 'separate_stems':\n        return await executeSeparateStems(args, context);\n\n      default:\n        return withCost({\n          success: false,\n          error: `Unknown tool: ${name}`,\n        });\n    }\n  } catch (error) {\n    return withCost({\n      success: false,\n      error: error instanceof Error ? error.message : 'Tool execution failed',\n    });\n  }\n}\n\n// Execute multiple tool calls\nexport async function executeTools(\n  toolCalls: ToolCall[]\n): Promise<Map<string, ToolResult>> {\n  const results = new Map<string, ToolResult>();\n\n  for (const toolCall of toolCalls) {\n    const result = await executeTool(toolCall);\n    results.set(toolCall.name, result);\n  }\n\n  return results;\n}\n\n// Format tool results for the AI to use in response\nexport function formatToolResults(\n  results: Map<string, ToolResult>\n): string {\n  const sections: string[] = [];\n\n  for (const [toolName, result] of results) {\n    if (result.success) {\n      sections.push(`[${toolName}]: ${JSON.stringify(result.data)}`);\n    } else {\n      sections.push(`[${toolName}]: Error - ${result.error}`);\n    }\n  }\n\n  return sections.join('\\n\\n');\n}\n\n// Individual tool executors\n\nfunction executeSearchSystem(\n  args: Record<string, unknown>\n): ToolResult {\n  const query = args.query as string;\n  const category = (args.category as SearchOptions['category']) || 'all';\n\n  if (!query) {\n    return {\n      success: false,\n      error: 'Search query is required',\n    };\n  }\n\n  const results = searchSystem(query, { category, limit: 8 });\n  const formattedResults = formatSearchResults(results);\n\n  return {\n    success: true,\n    data: {\n      query,\n      category,\n      resultCount: results.length,\n      results: results.map((r: any) => ({\n        type: r.type,\n        title: r.title,\n        description: r.description.slice(0, 200),\n        url: r.url,\n        metadata: r.metadata,\n      })),\n      formatted: formattedResults,\n    },\n    action: {\n      type: 'show_results',\n      payload: {\n        results,\n        query,\n      },\n    },\n  };\n}\n\nfunction executeNavigateTo(args: Record<string, unknown>): ToolResult {\n  const destination = args.destination as string;\n  const theme = args.theme as string | undefined;\n\n  // Validate destination\n  if (!NAVIGATION_DESTINATIONS.includes(destination as NavigationDestination)) {\n    return {\n      success: false,\n      error: `Invalid destination: ${destination}. Valid destinations: ${NAVIGATION_DESTINATIONS.join(', ')}`,\n    };\n  }\n\n  // Validate theme if provided\n  if (theme && !themes.some((t) => t.name === theme)) {\n    return {\n      success: false,\n      error: `Invalid theme: ${theme}`,\n    };\n  }\n\n  // Build the URL\n  const destinationMap: Record<string, string> = {\n    home: '/',\n    story: '/story',\n    design: '/design',\n    resume: '/resume',\n    projects: '/projects',\n    blog: '/blog',\n    music: '/music',\n    humans: '/humans',\n    themes: '/design',\n    photos: '/photos',\n    video: '/video',\n    canvas: '/canvas',\n    search: '/search',\n  };\n\n  let url = destinationMap[destination] || `/${destination}`;\n\n  if (theme) {\n    url += `${url.includes('?') ? '&' : '?'}theme=${theme}`;\n  }\n\n  return {\n    success: true,\n    data: {\n      destination,\n      url,\n      theme,\n      message: `Navigating to ${destination}${theme ? ` with the ${theme} theme` : ''}`,\n    },\n    action: {\n      type: 'navigate',\n      payload: {\n        url,\n        destination,\n        theme,\n      },\n    },\n  };\n}\n\nfunction executeScheduleCall(args: Record<string, unknown>): ToolResult {\n  const topic = args.topic as string | undefined;\n\n  // Calendly URL - would be configured in env\n  const calendlyUrl = process.env.NEXT_PUBLIC_CALENDLY_URL || 'https://calendly.com/james-spalding';\n\n  let url = calendlyUrl;\n  if (topic) {\n    // Calendly supports prefilling via query params\n    url += `?a1=${encodeURIComponent(topic)}`;\n  }\n\n  return {\n    success: true,\n    data: {\n      url,\n      topic,\n      message: topic\n        ? `Opening calendar to schedule a call about: ${topic}`\n        : 'Opening calendar to schedule a call',\n    },\n    action: {\n      type: 'open_calendar',\n      payload: {\n        url,\n        topic,\n      },\n    },\n  };\n}\n\nfunction executeListThemes(args: Record<string, unknown>): ToolResult {\n  const category = args.category as string | undefined;\n\n  const allThemes = getAllThemes(category);\n\n  // Group themes for better presentation\n  const themeList = allThemes.map((t) => t.title).join(', ');\n\n  return {\n    success: true,\n    data: {\n      count: allThemes.length,\n      themes: allThemes.map((t) => ({\n        name: t.metadata?.themeName,\n        label: t.title,\n        url: t.url,\n      })),\n      formatted: `Available themes (${allThemes.length}): ${themeList}`,\n    },\n  };\n}\n\n// New tool executors for rich components\n\nfunction executeOpenSearchApp(args: Record<string, unknown>): ToolResult {\n  const query = args.query as string;\n\n  if (!query) {\n    return {\n      success: false,\n      error: 'Search query is required',\n    };\n  }\n\n  return {\n    success: true,\n    data: {\n      query,\n      message: `Opening Search app with query: \"${query}\"`,\n    },\n    action: {\n      type: 'open_search',\n      payload: {\n        url: `/search?q=${encodeURIComponent(query)}`,\n        query,\n      },\n    },\n  };\n}\n\nfunction executeShowWeather(args: Record<string, unknown>): ToolResult {\n  const location = (args.location as string) || 'San Francisco';\n\n  // Mock weather data for now - in production would call a weather API\n  const conditions = ['sunny', 'cloudy', 'rainy', 'windy'] as const;\n  const randomCondition = conditions[Math.floor(Math.random() * conditions.length)];\n\n  const weatherData = {\n    location,\n    temperature: Math.floor(55 + Math.random() * 25), // 55-80F\n    condition: randomCondition,\n    humidity: Math.floor(40 + Math.random() * 40),\n    windSpeed: Math.floor(5 + Math.random() * 15),\n  };\n\n  return {\n    success: true,\n    data: weatherData,\n  };\n}\n\nfunction executeShowKanbanTasks(args: Record<string, unknown>): ToolResult {\n  const filter = (args.filter as string) || 'all';\n  const tag = args.tag as string | undefined;\n  const limit = (args.limit as number) || 5;\n\n  // Import sample tasks from kanban types would be ideal\n  // For now, return some representative tasks\n  const sampleTasks = [\n    {\n      id: 'p8-1',\n      title: '[P8] 8gent Search - Tool Definitions',\n      description: 'Create tools.ts with search_system, navigate_to, schedule_call, list_themes.',\n      status: 'done' as const,\n      priority: 'high' as const,\n      tags: ['P8', 'claw-ai', 'tools'],\n    },\n    {\n      id: 'p8-2',\n      title: '[P8] 8gent Search - Convex Integration',\n      description: 'Integrate search with Convex backend for persistent indexing.',\n      status: 'in-progress' as const,\n      priority: 'high' as const,\n      tags: ['P8', 'claw-ai', 'search', 'convex'],\n    },\n    {\n      id: 'p0-1',\n      title: '[P0] Command Palette - Core Component',\n      description: 'Create CommandPalette.tsx with Liquid Glass styling.',\n      status: 'todo' as const,\n      priority: 'urgent' as const,\n      tags: ['P0', 'command-palette', 'macro'],\n    },\n    {\n      id: 'p1-1',\n      title: '[P1] Projects Landing - Folder Cards',\n      description: 'Create ProjectsLanding.tsx with folder cards.',\n      status: 'todo' as const,\n      priority: 'high' as const,\n      tags: ['P1', 'projects', 'landing'],\n    },\n    {\n      id: 'done-1',\n      title: 'Next.js 14 App Router Setup',\n      description: 'Initial project setup with Next.js 14, TypeScript, and Tailwind CSS',\n      status: 'done' as const,\n      priority: 'high' as const,\n      tags: ['foundation', 'setup'],\n    },\n  ];\n\n  // Filter tasks\n  let filteredTasks = sampleTasks;\n\n  if (filter !== 'all') {\n    filteredTasks = filteredTasks.filter((t) => t.status === filter);\n  }\n\n  if (tag) {\n    filteredTasks = filteredTasks.filter((t) =>\n      t.tags.some((taskTag) => taskTag.toLowerCase().includes(tag.toLowerCase()))\n    );\n  }\n\n  const tasks = filteredTasks.slice(0, limit);\n\n  return {\n    success: true,\n    data: {\n      filter,\n      tag,\n      count: tasks.length,\n      tasks,\n    },\n  };\n}\n\nfunction executeShowPhotos(args: Record<string, unknown>): ToolResult {\n  const count = (args.count as number) || 6;\n\n  // Real photos from James's gallery - Irish landscapes and nature photography\n  const galleryPhotos = [\n    { id: '1', src: '/photos/aurora.jpeg', alt: 'Aurora Borealis', caption: 'Northern Lights over Ireland' },\n    { id: '2', src: '/photos/Sunriseoverhowth.jpeg', alt: 'Sunrise over Howth', caption: 'Sunrise over Howth, Dublin' },\n    { id: '3', src: '/photos/Donabatebeach.jpeg', alt: 'Donabate Beach', caption: 'Donabate Beach, North Dublin' },\n    { id: '4', src: '/photos/SunsetPortrane.jpeg', alt: 'Sunset at Portrane', caption: 'Sunset at Portrane' },\n    { id: '5', src: '/photos/Glenofthedowns.jpeg', alt: 'Glen of the Downs', caption: 'Glen of the Downs, Wicklow' },\n    { id: '6', src: '/photos/Robin.jpeg', alt: 'Robin', caption: 'Robin in the garden' },\n    { id: '7', src: '/photos/Nightsky.jpeg', alt: 'Night Sky', caption: 'Night sky photography' },\n    { id: '8', src: '/photos/Mistysunrise.jpeg', alt: 'Misty Sunrise', caption: 'Misty morning sunrise' },\n    { id: '9', src: '/photos/Corballis.jpeg', alt: 'Corballis', caption: 'Corballis, North Dublin' },\n    { id: '10', src: '/photos/sunsetachill.jpeg', alt: 'Sunset Achill', caption: 'Sunset at Achill Island' },\n    { id: '11', src: '/photos/SunsetSalvador.jpeg', alt: 'Sunset Salvador', caption: 'Sunset in Salvador, Brazil' },\n    { id: '12', src: '/photos/Portranedemense.jpeg', alt: 'Portrane Demesne', caption: 'Portrane Demesne woods' },\n  ];\n\n  const photos = galleryPhotos.slice(0, Math.min(count, galleryPhotos.length));\n\n  return {\n    success: true,\n    data: {\n      count: photos.length,\n      photos,\n      message: `Showing ${photos.length} photos from the user's gallery. These are mostly from Ireland where the system was developed.`,\n    },\n  };\n}\n\nfunction executeRenderUI(args: Record<string, unknown>): ToolResult {\n  const uiTree = args.ui_tree as Record<string, unknown> | undefined;\n  const title = args.title as string | undefined;\n\n  if (!uiTree) {\n    return {\n      success: false,\n      error: 'UI tree is required',\n    };\n  }\n\n  // Validate basic structure\n  if (!uiTree.root || !uiTree.elements) {\n    return {\n      success: false,\n      error: 'Invalid UI tree structure. Must have \"root\" and \"elements\" properties.',\n    };\n  }\n\n  return {\n    success: true,\n    data: {\n      title,\n      ui_tree: uiTree,\n    },\n    action: {\n      type: 'render_ui',\n      payload: {\n        title,\n        ui_tree: uiTree,\n      },\n    },\n  };\n}\n\n// =============================================================================\n// Agentic Product Lifecycle Tool Executors\n// These tools enable 8gent to create and manage projects, PRDs, and tickets\n// Inspired by BMAD-METHOD and CCPM workflows\n// =============================================================================\n\n/**\n * Create a new product project\n * This is the entry point for the agentic product lifecycle\n */\nfunction executeCreateProject(args: Record<string, unknown>): ToolResult {\n  const name = args.name as string;\n  const description = args.description as string | undefined;\n  const color = args.color as string | undefined;\n\n  if (!name) {\n    return {\n      success: false,\n      error: 'Project name is required',\n    };\n  }\n\n  // Generate a temporary project ID - the actual creation happens via Convex mutation\n  // This returns an action that the frontend will use to call the Convex mutation\n  const tempSlug = name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');\n\n  return {\n    success: true,\n    data: {\n      name,\n      description,\n      color: color || '#8b5cf6',\n      slug: tempSlug,\n      message: `Creating project \"${name}\"...`,\n    },\n    action: {\n      type: 'project_created',\n      payload: {\n        name,\n        description,\n        color: color || '#8b5cf6',\n        slug: tempSlug,\n        // Frontend will call Convex mutation with these args\n        convexMutation: 'agentic:createProductProject',\n      },\n    },\n  };\n}\n\n/**\n * Create a Product Requirements Document (PRD)\n * Following BMAD methodology for structured requirements\n */\nfunction executeCreatePRD(args: Record<string, unknown>): ToolResult {\n  const projectId = args.projectId as string;\n  const title = args.title as string;\n  const executiveSummary = args.executiveSummary as string | undefined;\n  const problemStatement = args.problemStatement as string | undefined;\n\n  if (!projectId) {\n    return {\n      success: false,\n      error: 'Project ID is required to create a PRD',\n    };\n  }\n\n  if (!title) {\n    return {\n      success: false,\n      error: 'PRD title is required',\n    };\n  }\n\n  return {\n    success: true,\n    data: {\n      projectId,\n      title,\n      executiveSummary,\n      problemStatement,\n      message: `Creating PRD \"${title}\"...`,\n    },\n    action: {\n      type: 'prd_created',\n      payload: {\n        projectId,\n        title,\n        executiveSummary,\n        problemStatement,\n        generatedBy: 'ai',\n        convexMutation: 'agentic:createPRD',\n      },\n    },\n  };\n}\n\n/**\n * Create a ticket/story on the Kanban board\n * Supports BMAD user story format (As a... I want... So that...)\n */\nfunction executeCreateTicket(args: Record<string, unknown>): ToolResult {\n  const projectId = args.projectId as string;\n  const title = args.title as string;\n  const description = args.description as string | undefined;\n  const type = (args.type as string) || 'story';\n  const priority = (args.priority as string) || 'P2';\n  const asA = args.asA as string | undefined;\n  const iWant = args.iWant as string | undefined;\n  const soThat = args.soThat as string | undefined;\n  const labels = args.labels as string[] | undefined;\n\n  if (!projectId) {\n    return {\n      success: false,\n      error: 'Project ID is required to create a ticket',\n    };\n  }\n\n  if (!title) {\n    return {\n      success: false,\n      error: 'Ticket title is required',\n    };\n  }\n\n  return {\n    success: true,\n    data: {\n      projectId,\n      title,\n      description,\n      type,\n      priority,\n      asA,\n      iWant,\n      soThat,\n      labels,\n      message: `Creating ticket \"${title}\"...`,\n    },\n    action: {\n      type: 'ticket_created',\n      payload: {\n        projectId,\n        title,\n        description,\n        type,\n        priority,\n        asA,\n        iWant,\n        soThat,\n        labels,\n        createdBy: 'ai',\n        convexMutation: 'agentic:createTicket',\n      },\n    },\n  };\n}\n\n/**\n * Update an existing ticket\n * Can change status, priority, description, and other fields\n */\nfunction executeUpdateTicket(args: Record<string, unknown>): ToolResult {\n  const ticketId = args.ticketId as string;\n  const status = args.status as string | undefined;\n  const priority = args.priority as string | undefined;\n  const title = args.title as string | undefined;\n  const description = args.description as string | undefined;\n  const assigneeId = args.assigneeId as string | undefined;\n\n  if (!ticketId) {\n    return {\n      success: false,\n      error: 'Ticket ID is required',\n    };\n  }\n\n  const updates: Record<string, unknown> = {};\n  if (status) updates.status = status;\n  if (priority) updates.priority = priority;\n  if (title) updates.title = title;\n  if (description) updates.description = description;\n  if (assigneeId) updates.assigneeId = assigneeId;\n\n  if (Object.keys(updates).length === 0) {\n    return {\n      success: false,\n      error: 'At least one field to update is required',\n    };\n  }\n\n  return {\n    success: true,\n    data: {\n      ticketId,\n      updates,\n      message: `Updating ticket ${ticketId}...`,\n    },\n    action: {\n      type: 'ticket_updated',\n      payload: {\n        ticketId,\n        ...updates,\n        convexMutation: 'agentic:updateTicket',\n      },\n    },\n  };\n}\n\n/**\n * Shard a PRD into epics and tickets\n * Converts functional requirements into actionable Kanban items\n */\nfunction executeShardPRD(args: Record<string, unknown>): ToolResult {\n  const prdId = args.prdId as string;\n  const projectId = args.projectId as string;\n\n  if (!prdId) {\n    return {\n      success: false,\n      error: 'PRD ID is required',\n    };\n  }\n\n  if (!projectId) {\n    return {\n      success: false,\n      error: 'Project ID is required',\n    };\n  }\n\n  return {\n    success: true,\n    data: {\n      prdId,\n      projectId,\n      message: 'Sharding PRD into epics and tickets...',\n    },\n    action: {\n      type: 'prd_sharded',\n      payload: {\n        prdId,\n        projectId,\n        convexMutation: 'agentic:shardPRDToTickets',\n      },\n    },\n  };\n}\n\n/**\n * Get the Kanban board for a project\n * Returns tickets organized by status columns\n */\nfunction executeGetProjectKanban(args: Record<string, unknown>): ToolResult {\n  const projectId = args.projectId as string;\n\n  if (!projectId) {\n    return {\n      success: false,\n      error: 'Project ID is required',\n    };\n  }\n\n  return {\n    success: true,\n    data: {\n      projectId,\n      message: 'Loading Kanban board...',\n    },\n    action: {\n      type: 'show_kanban',\n      payload: {\n        projectId,\n        convexQuery: 'agentic:getKanbanBoard',\n      },\n    },\n  };\n}\n\n/**\n * List all product projects\n * Can filter by status\n */\nfunction executeListProjects(args: Record<string, unknown>): ToolResult {\n  const status = args.status as string | undefined;\n\n  return {\n    success: true,\n    data: {\n      status,\n      message: status ? `Loading ${status} projects...` : 'Loading all projects...',\n    },\n    action: {\n      type: 'render_component',\n      payload: {\n        componentType: 'projects',\n        status,\n        convexQuery: 'agentic:getProductProjects',\n      },\n    },\n  };\n}\n\n/**\n * Get available meeting times for a specific date\n */\nasync function executeGetAvailableTimes(args: Record<string, unknown>): Promise<ToolResult> {\n  const date = args.date as string | undefined;\n  const duration = (args.duration as number) || 30;\n\n  try {\n    const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n    if (!convexUrl) {\n      return {\n        success: false,\n        error: 'Convex URL not configured',\n      };\n    }\n\n    const client = new ConvexHttpClient(convexUrl);\n\n    // Get default event type (30-minute call) or first active event type\n    const eventTypes = await client.query(api.scheduling.getEventTypes, {});\n    const eventType = eventTypes?.find((et) => et.isActive && et.duration === duration) || eventTypes?.[0];\n\n    if (!eventType) {\n      return {\n        success: false,\n        error: 'No active event types found',\n      };\n    }\n\n    const targetDate = date || new Date().toISOString().split('T')[0];\n    const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n\n    const slots = await client.query(api.scheduling.getAvailableSlots, {\n      eventTypeId: eventType._id,\n      date: targetDate,\n      timezone,\n    });\n\n    const slotTimes = slots?.map((s: { time?: string; timestamp?: number }) => {\n      if (s.time) return s.time;\n      if (s.timestamp) return new Date(s.timestamp).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });\n      return '';\n    }).filter(Boolean) || [];\n\n    return {\n      success: true,\n      data: {\n        date: targetDate,\n        duration,\n        slots: slots || [],\n        formatted: slotTimes.length > 0\n          ? `Available times on ${targetDate}: ${slotTimes.join(', ')}`\n          : `No available times on ${targetDate}`,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to get available times',\n    };\n  }\n}\n\n/**\n * Get upcoming scheduled bookings\n */\nasync function executeGetUpcomingBookings(args: Record<string, unknown>): Promise<ToolResult> {\n  const limit = (args.limit as number) || 5;\n\n  try {\n    const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n    if (!convexUrl) {\n      return {\n        success: false,\n        error: 'Convex URL not configured',\n      };\n    }\n\n    const client = new ConvexHttpClient(convexUrl);\n\n    // Get bookings for the authenticated user\n    // Note: This requires authentication context, which may not be available in tool executor\n    // For now, return a message indicating the user should check the calendar\n    return {\n      success: true,\n      data: {\n        message: 'To view upcoming bookings, please check the calendar dashboard at /calendar',\n        limit,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to get upcoming bookings',\n    };\n  }\n}\n\n/**\n * Book a meeting with the admin\n */\nasync function executeBookMeeting(args: Record<string, unknown>): Promise<ToolResult> {\n  const guestName = args.guestName as string;\n  const guestEmail = args.guestEmail as string;\n  const startTime = args.startTime as number;\n  const topic = args.topic as string | undefined;\n  const duration = (args.duration as number) || 30;\n\n  if (!guestName || !guestEmail || !startTime) {\n    return {\n      success: false,\n      error: 'guestName, guestEmail, and startTime are required',\n    };\n  }\n\n  try {\n    const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n    if (!convexUrl) {\n      return {\n        success: false,\n        error: 'Convex URL not configured',\n      };\n    }\n\n    const client = new ConvexHttpClient(convexUrl);\n\n    // Get default event type matching the duration\n    // Note: This requires authentication - will work when called from authenticated context\n    const eventTypes = await client.query(api.scheduling.getEventTypes, {});\n    const eventType = eventTypes?.find((et) => et.isActive && et.duration === duration) || eventTypes?.[0];\n\n    if (!eventType) {\n      return {\n        success: false,\n        error: 'No active event type found for the specified duration. Please ensure you are authenticated and have created event types.',\n      };\n    }\n\n    const guestTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n\n    // Create booking\n    const bookingId = await client.mutation(api.scheduling.createBooking, {\n      eventTypeId: eventType._id,\n      guestName,\n      guestEmail,\n      guestTimezone,\n      startTime,\n      notes: topic,\n    });\n\n    return {\n      success: true,\n      data: {\n        bookingId,\n        guestName,\n        guestEmail,\n        startTime: new Date(startTime).toISOString(),\n        duration,\n        message: `Meeting booked successfully for ${guestName} on ${new Date(startTime).toLocaleString()}`,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to book meeting',\n    };\n  }\n}\n\n/**\n * Reschedule an existing meeting\n */\nasync function executeRescheduleMeeting(args: Record<string, unknown>): Promise<ToolResult> {\n  const bookingId = args.bookingId as string;\n  const newStartTime = args.newStartTime as number;\n\n  if (!bookingId || !newStartTime) {\n    return {\n      success: false,\n      error: 'bookingId and newStartTime are required',\n    };\n  }\n\n  try {\n    const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n    if (!convexUrl) {\n      return {\n        success: false,\n        error: 'Convex URL not configured',\n      };\n    }\n\n    const client = new ConvexHttpClient(convexUrl);\n\n    const newBookingId = await client.mutation(api.scheduling.rescheduleBooking, {\n      id: bookingId as Id<'bookings'>,\n      newStartTime,\n    });\n\n    return {\n      success: true,\n      data: {\n        oldBookingId: bookingId,\n        newBookingId,\n        newStartTime: new Date(newStartTime).toISOString(),\n        message: `Meeting rescheduled to ${new Date(newStartTime).toLocaleString()}`,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to reschedule meeting',\n    };\n  }\n}\n\n/**\n * Cancel a scheduled meeting\n */\nasync function executeCancelMeeting(args: Record<string, unknown>): Promise<ToolResult> {\n  const bookingId = args.bookingId as string;\n  const reason = args.reason as string | undefined;\n\n  if (!bookingId) {\n    return {\n      success: false,\n      error: 'bookingId is required',\n    };\n  }\n\n  try {\n    const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n    if (!convexUrl) {\n      return {\n        success: false,\n        error: 'Convex URL not configured',\n      };\n    }\n\n    const client = new ConvexHttpClient(convexUrl);\n\n    await client.mutation(api.scheduling.updateBookingStatus, {\n      id: bookingId as Id<'bookings'>,\n      status: 'cancelled',\n      cancelReason: reason,\n      cancelledBy: 'host',\n    });\n\n    return {\n      success: true,\n      data: {\n        bookingId,\n        message: `Meeting cancelled${reason ? `: ${reason}` : ''}`,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to cancel meeting',\n    };\n  }\n}\n\n// =============================================================================\n// Memory Tools (RLM - Recursive Memory Layer)\n// These tools enable 8gent to actively manage memories for the owner\n// =============================================================================\n\n/**\n * Search through memories to recall past interactions, decisions, preferences\n */\nasync function executeRemember(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const query = args.query as string;\n  const memoryType = (args.memoryType as string) || 'all';\n  const limit = (args.limit as number) || 10;\n\n  if (!query) {\n    return {\n      success: false,\n      error: 'Query is required to search memories',\n    };\n  }\n\n  try {\n    const userId = getEffectiveUserId(context);\n    const memoryManager = getMemoryManager();\n\n    // Search both episodic and semantic memories\n    const result = await memoryManager.loadRelevantMemories(\n      userId,\n      query,\n      { limit, includeEpisodic: true, includeSemantic: true }\n    );\n\n    // Filter by memory type if specified\n    let episodic = result.episodic;\n    if (memoryType !== 'all') {\n      episodic = episodic.filter(m => m.memoryType === memoryType);\n    }\n\n    const memoriesFound = episodic.length + result.semantic.length;\n\n    // Format memories for display\n    const formattedEpisodic = episodic.map(m => ({\n      id: m._id,\n      type: m.memoryType,\n      content: m.content,\n      importance: m.importance,\n      timestamp: m.timestamp,\n    }));\n\n    const formattedSemantic = result.semantic.map(m => ({\n      id: m._id,\n      category: m.category,\n      key: m.key,\n      value: m.value,\n      confidence: m.confidence,\n    }));\n\n    return {\n      success: true,\n      data: {\n        query,\n        memoriesFound,\n        episodic: formattedEpisodic,\n        semantic: formattedSemantic,\n        contextSummary: result.contextSummary,\n        message: memoriesFound > 0\n          ? `Found ${memoriesFound} relevant memories`\n          : 'No memories found matching your query',\n      },\n      action: {\n        type: 'memory_recalled',\n        payload: {\n          query,\n          count: memoriesFound,\n          episodic: formattedEpisodic,\n          semantic: formattedSemantic,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to search memories',\n    };\n  }\n}\n\n/**\n * Recall specific preferences, patterns, or learned facts\n */\nasync function executeRecallPreference(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const category = args.category as SemanticCategory;\n  const key = args.key as string | undefined;\n\n  if (!category) {\n    return {\n      success: false,\n      error: 'Category is required to recall preferences',\n    };\n  }\n\n  try {\n    const userId = getEffectiveUserId(context);\n    const memoryManager = getMemoryManager();\n\n    // Get semantic memories by category\n    const memories = await memoryManager.loadSemanticMemories(\n      userId,\n      [category]\n    );\n\n    // Filter by key if provided\n    let filtered = memories;\n    if (key) {\n      filtered = memories.filter(m => m.key.includes(key));\n    }\n\n    // Sort by confidence\n    filtered.sort((a, b) => b.confidence - a.confidence);\n\n    const formattedMemories = filtered.map(m => ({\n      id: m._id,\n      category: m.category,\n      key: m.key,\n      value: m.value,\n      confidence: m.confidence,\n      lastUpdated: m.updatedAt,\n    }));\n\n    return {\n      success: true,\n      data: {\n        category,\n        key,\n        count: formattedMemories.length,\n        preferences: formattedMemories,\n        message: formattedMemories.length > 0\n          ? `Found ${formattedMemories.length} ${category}(s)`\n          : `No ${category}s found${key ? ` matching \"${key}\"` : ''}`,\n      },\n      action: {\n        type: 'memory_recalled',\n        payload: {\n          category,\n          key,\n          preferences: formattedMemories,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to recall preferences',\n    };\n  }\n}\n\n/**\n * Store an important memory explicitly\n */\nasync function executeMemorize(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const content = args.content as string;\n  const memoryType = args.memoryType as EpisodicMemoryType;\n  const importance = (args.importance as number) || 0.7;\n  const projectId = args.projectId as string | undefined;\n\n  if (!content) {\n    return {\n      success: false,\n      error: 'Content is required to store a memory',\n    };\n  }\n\n  if (!memoryType) {\n    return {\n      success: false,\n      error: 'Memory type is required',\n    };\n  }\n\n  // Validate importance is between 0 and 1\n  const validImportance = Math.max(0, Math.min(1, importance));\n\n  try {\n    const userId = getEffectiveUserId(context);\n    const memoryManager = getMemoryManager();\n\n    const memoryId = await memoryManager.storeEpisodicMemory(\n      userId,\n      content,\n      memoryType,\n      validImportance,\n      projectId as Id<'productProjects'> | undefined,\n      { toolsUsed: ['memorize'], outcome: 'Explicitly stored by user request' }\n    );\n\n    return {\n      success: true,\n      data: {\n        memoryId,\n        content,\n        memoryType,\n        importance: validImportance,\n        message: `Memory stored successfully as a ${memoryType} with importance ${validImportance}`,\n      },\n      action: {\n        type: 'memory_stored',\n        payload: {\n          memoryId,\n          content,\n          memoryType,\n          importance: validImportance,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to store memory',\n    };\n  }\n}\n\n/**\n * Learn a new fact, preference, skill, or pattern\n */\nasync function executeLearn(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const category = args.category as SemanticCategory;\n  const key = args.key as string;\n  const value = args.value as string;\n  const confidence = (args.confidence as number) || 0.7;\n\n  if (!category || !key || !value) {\n    return {\n      success: false,\n      error: 'Category, key, and value are required to learn something new',\n    };\n  }\n\n  // Validate confidence is between 0 and 1\n  const validConfidence = Math.max(0, Math.min(1, confidence));\n\n  try {\n    const userId = getEffectiveUserId(context);\n    const memoryManager = getMemoryManager();\n\n    const memoryId = await memoryManager.upsertSemanticMemory(\n      userId,\n      category,\n      key,\n      value,\n      validConfidence,\n      'learn_tool'\n    );\n\n    return {\n      success: true,\n      data: {\n        memoryId,\n        category,\n        key,\n        value,\n        confidence: validConfidence,\n        message: `Learned: ${category} \"${key}\" = \"${value}\" (confidence: ${validConfidence})`,\n      },\n      action: {\n        type: 'memory_learned',\n        payload: {\n          memoryId,\n          category,\n          key,\n          value,\n          confidence: validConfidence,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to learn',\n    };\n  }\n}\n\n/**\n * Remove a specific memory\n */\nasync function executeForget(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const memoryId = args.memoryId as string;\n  const memoryKind = args.memoryKind as 'episodic' | 'semantic';\n\n  if (!memoryId) {\n    return {\n      success: false,\n      error: 'Memory ID is required to forget a memory',\n    };\n  }\n\n  if (!memoryKind || !['episodic', 'semantic'].includes(memoryKind)) {\n    return {\n      success: false,\n      error: 'Memory kind must be either \"episodic\" or \"semantic\"',\n    };\n  }\n\n  try {\n    const userId = getEffectiveUserId(context);\n    const memoryManager = getMemoryManager();\n\n    if (memoryKind === 'episodic') {\n      await memoryManager.deleteEpisodicMemory(\n        memoryId as Id<'episodicMemories'>,\n        userId\n      );\n    } else {\n      await memoryManager.deleteSemanticMemory(\n        memoryId as Id<'semanticMemories'>,\n        userId\n      );\n    }\n\n    return {\n      success: true,\n      data: {\n        memoryId,\n        memoryKind,\n        message: `Memory deleted successfully`,\n      },\n      action: {\n        type: 'memory_deleted',\n        payload: {\n          memoryId,\n          memoryKind,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to delete memory',\n    };\n  }\n}\n\n// =============================================================================\n// OpenClaw Coding Tools - Full coding agent capabilities\n// These tools enable 8gent to clone repos, read/write files, execute\n// commands, and manage git operations.\n// @see docs/planning/infinity-agent-coding-integration.md\n// =============================================================================\n\n// --------------------------------------------------------------------------\n// Working Context Tools\n// --------------------------------------------------------------------------\n\n/**\n * Set the active working context\n */\nasync function executeSetActiveContext(args: Record<string, unknown>): Promise<ToolResult> {\n  const projectId = args.projectId as string | undefined;\n  const projectSlug = args.projectSlug as string | undefined;\n  const prdId = args.prdId as string | undefined;\n  const ticketId = args.ticketId as string | undefined;\n  const canvasId = args.canvasId as string | undefined;\n  const sandboxId = args.sandboxId as string | undefined;\n  const repositoryUrl = args.repositoryUrl as string | undefined;\n\n  // This action will be handled by the frontend to call the Convex mutation\n  return {\n    success: true,\n    data: {\n      projectId,\n      projectSlug,\n      prdId,\n      ticketId,\n      canvasId,\n      sandboxId,\n      repositoryUrl,\n      message: 'Setting active context...',\n    },\n    action: {\n      type: 'context_updated',\n      payload: {\n        projectId,\n        projectSlug,\n        prdId,\n        ticketId,\n        canvasId,\n        sandboxId,\n        repositoryUrl,\n        convexMutation: 'workingContext:updateActiveContext',\n      },\n    },\n  };\n}\n\n/**\n * Get the active working context\n */\nasync function executeGetActiveContext(args: Record<string, unknown>): Promise<ToolResult> {\n  // This action will be handled by the frontend to query the Convex data\n  return {\n    success: true,\n    data: {\n      message: 'Loading active context...',\n    },\n    action: {\n      type: 'context_loaded',\n      payload: {\n        convexQuery: 'workingContext:getActiveContext',\n      },\n    },\n  };\n}\n\n/**\n * Load full context chain from an @mention reference\n */\nasync function executeLoadContextFromReference(args: Record<string, unknown>): Promise<ToolResult> {\n  const referenceType = args.referenceType as string;\n  const referenceId = args.referenceId as string;\n\n  if (!referenceType || !referenceId) {\n    return {\n      success: false,\n      error: 'Reference type and ID are required',\n    };\n  }\n\n  // Map reference type to appropriate Convex query\n  const queryMap: Record<string, string> = {\n    ticket: 'workingContext:loadContextFromTicket',\n    project: 'workingContext:loadContextFromProject',\n    prd: 'workingContext:loadContextFromPRD',\n    epic: 'workingContext:loadContextFromEpic',\n    canvas: 'workingContext:loadContextFromCanvas',\n    memory: 'workingContext:loadContextFromMemory',\n  };\n\n  const convexQuery = queryMap[referenceType];\n  if (!convexQuery) {\n    return {\n      success: false,\n      error: `Unknown reference type: ${referenceType}`,\n    };\n  }\n\n  return {\n    success: true,\n    data: {\n      referenceType,\n      referenceId,\n      message: `Loading context for @${referenceType}:${referenceId}...`,\n    },\n    action: {\n      type: 'context_loaded',\n      payload: {\n        referenceType,\n        referenceId,\n        convexQuery,\n      },\n    },\n  };\n}\n\n// --------------------------------------------------------------------------\n// Repository Operations\n// --------------------------------------------------------------------------\n\n/**\n * Clone a GitHub repository to the sandbox\n */\nasync function executeCloneRepository(args: Record<string, unknown>): Promise<ToolResult> {\n  const url = args.url as string;\n  const branch = args.branch as string | undefined;\n\n  if (!url) {\n    return {\n      success: false,\n      error: 'Repository URL is required',\n    };\n  }\n\n  // Validate branch name to prevent command injection\n  if (branch && !isValidGitBranch(branch)) {\n    return {\n      success: false,\n      error: 'Invalid branch name. Branch names can only contain letters, numbers, dots, slashes, underscores, and hyphens.',\n    };\n  }\n\n  // Validate URL format\n  const githubRegex = /^https:\\/\\/github\\.com\\/[\\w-]+\\/[\\w.-]+$/;\n  if (!githubRegex.test(url.replace(/\\.git$/, ''))) {\n    return {\n      success: false,\n      error: 'Invalid GitHub repository URL. Expected format: https://github.com/owner/repo',\n    };\n  }\n\n  // Parse owner and repo from URL\n  const match = url.replace(/\\.git$/, '').match(/github\\.com\\/([\\w-]+)\\/([\\w.-]+)/);\n  const owner = match?.[1];\n  const repo = match?.[2];\n\n  return {\n    success: true,\n    data: {\n      url,\n      branch,\n      owner,\n      repo,\n      message: `Cloning ${owner}/${repo}${branch ? ` (branch: ${branch})` : ''}...`,\n    },\n    action: {\n      type: 'repo_cloned',\n      payload: {\n        url,\n        branch,\n        owner,\n        repo,\n        sandboxOperation: 'clone',\n      },\n    },\n  };\n}\n\n/**\n * List files and directories in the sandbox\n */\nasync function executeListDirectory(args: Record<string, unknown>): Promise<ToolResult> {\n  const path = args.path as string;\n  const recursive = (args.recursive as boolean) || false;\n  const maxDepth = (args.maxDepth as number) || 3;\n\n  if (!path) {\n    return {\n      success: false,\n      error: 'Path is required',\n    };\n  }\n\n  return {\n    success: true,\n    data: {\n      path,\n      recursive,\n      maxDepth,\n      message: `Listing ${recursive ? 'recursively ' : ''}${path}...`,\n    },\n    action: {\n      type: 'directory_listed',\n      payload: {\n        path,\n        recursive,\n        maxDepth,\n        sandboxOperation: 'listDir',\n      },\n    },\n  };\n}\n\n/**\n * Search for patterns in the codebase\n */\nasync function executeSearchCodebase(args: Record<string, unknown>): Promise<ToolResult> {\n  const pattern = args.pattern as string;\n  const path = (args.path as string) || '.';\n  const filePattern = args.filePattern as string | undefined;\n  const caseSensitive = (args.caseSensitive as boolean) || false;\n  const maxResults = (args.maxResults as number) || 50;\n\n  if (!pattern) {\n    return {\n      success: false,\n      error: 'Search pattern is required',\n    };\n  }\n\n  return {\n    success: true,\n    data: {\n      pattern,\n      path,\n      filePattern,\n      caseSensitive,\n      maxResults,\n      message: `Searching for \"${pattern}\"${filePattern ? ` in ${filePattern} files` : ''}...`,\n    },\n    action: {\n      type: 'files_searched',\n      payload: {\n        pattern,\n        path,\n        filePattern,\n        caseSensitive,\n        maxResults,\n        sandboxOperation: 'grep',\n      },\n    },\n  };\n}\n\n// --------------------------------------------------------------------------\n// File Operations\n// --------------------------------------------------------------------------\n\n/**\n * Read a file from the sandbox\n */\nasync function executeReadFile(args: Record<string, unknown>): Promise<ToolResult> {\n  const path = args.path as string;\n  const startLine = args.startLine as number | undefined;\n  const endLine = args.endLine as number | undefined;\n\n  if (!path) {\n    return {\n      success: false,\n      error: 'File path is required',\n    };\n  }\n\n  // SECURITY: Validate path before reading\n  const validation = validatePath(path);\n  if (!validation.valid) {\n    return pathValidationError(validation.error || 'Invalid path');\n  }\n\n  return {\n    success: true,\n    data: {\n      path: validation.normalizedPath,\n      startLine,\n      endLine,\n      message: `Reading ${validation.normalizedPath}${startLine ? ` (lines ${startLine}-${endLine || 'end'})` : ''}...`,\n    },\n    action: {\n      type: 'file_read',\n      payload: {\n        path: validation.normalizedPath,\n        startLine,\n        endLine,\n        sandboxOperation: 'readFile',\n      },\n    },\n  };\n}\n\n/**\n * Write content to a file in the sandbox\n */\nasync function executeWriteFile(args: Record<string, unknown>): Promise<ToolResult> {\n  const path = args.path as string;\n  const content = args.content as string;\n  const createDirectories = (args.createDirectories as boolean) ?? true;\n\n  if (!path) {\n    return {\n      success: false,\n      error: 'File path is required',\n    };\n  }\n\n  if (content === undefined || content === null) {\n    return {\n      success: false,\n      error: 'Content is required',\n    };\n  }\n\n  // SECURITY: Validate path before writing\n  const validation = validatePath(path);\n  if (!validation.valid) {\n    return pathValidationError(validation.error || 'Invalid path');\n  }\n\n  return {\n    success: true,\n    data: {\n      path: validation.normalizedPath,\n      contentLength: content.length,\n      createDirectories,\n      message: `Writing to ${validation.normalizedPath} (${content.length} characters)...`,\n    },\n    action: {\n      type: 'file_written',\n      payload: {\n        path: validation.normalizedPath,\n        content,\n        createDirectories,\n        sandboxOperation: 'writeFile',\n      },\n    },\n  };\n}\n\n/**\n * Make surgical edits to a file\n */\nasync function executeEditFile(args: Record<string, unknown>): Promise<ToolResult> {\n  const path = args.path as string;\n  const oldText = args.oldText as string;\n  const newText = args.newText as string;\n  const replaceAll = (args.replaceAll as boolean) || false;\n\n  if (!path) {\n    return {\n      success: false,\n      error: 'File path is required',\n    };\n  }\n\n  if (!oldText) {\n    return {\n      success: false,\n      error: 'Old text to replace is required',\n    };\n  }\n\n  if (newText === undefined || newText === null) {\n    return {\n      success: false,\n      error: 'New text is required',\n    };\n  }\n\n  // SECURITY: Validate path before editing\n  const validation = validatePath(path);\n  if (!validation.valid) {\n    return pathValidationError(validation.error || 'Invalid path');\n  }\n\n  return {\n    success: true,\n    data: {\n      path: validation.normalizedPath,\n      replaceAll,\n      message: `Editing ${validation.normalizedPath}${replaceAll ? ' (all occurrences)' : ''}...`,\n    },\n    action: {\n      type: 'file_written',\n      payload: {\n        path: validation.normalizedPath,\n        oldText,\n        newText,\n        replaceAll,\n        sandboxOperation: 'editFile',\n      },\n    },\n  };\n}\n\n/**\n * Delete a file or directory\n */\nasync function executeDeleteFile(args: Record<string, unknown>): Promise<ToolResult> {\n  const path = args.path as string;\n  const recursive = (args.recursive as boolean) || false;\n\n  if (!path) {\n    return {\n      success: false,\n      error: 'Path is required',\n    };\n  }\n\n  // SECURITY: Validate path before deleting\n  const validation = validatePath(path);\n  if (!validation.valid) {\n    return pathValidationError(validation.error || 'Invalid path');\n  }\n\n  return {\n    success: true,\n    data: {\n      path: validation.normalizedPath,\n      recursive,\n      message: `Deleting ${validation.normalizedPath}${recursive ? ' (recursive)' : ''}...`,\n    },\n    action: {\n      type: 'file_written',\n      payload: {\n        path: validation.normalizedPath,\n        recursive,\n        sandboxOperation: 'delete',\n      },\n    },\n  };\n}\n\n// --------------------------------------------------------------------------\n// Execution\n// --------------------------------------------------------------------------\n\n/**\n * Execute a shell command in the sandbox\n *\n * SECURITY: Commands MUST be executed within a sandbox environment.\n * The frontend/sandbox context is responsible for:\n * 1. Ensuring a sandbox is active\n * 2. Setting resource limits (CPU, memory, time)\n * 3. Network isolation (whitelisted domains only)\n * 4. Auto-termination after 30 minutes\n */\nasync function executeRunCommand(args: Record<string, unknown>): Promise<ToolResult> {\n  const command = args.command as string;\n  const cwd = args.cwd as string | undefined;\n  const timeout = Math.min((args.timeout as number) || 60000, 300000); // Max 5 minutes\n\n  if (!command) {\n    return {\n      success: false,\n      error: 'Command is required',\n    };\n  }\n\n  // SECURITY: Validate command for dangerous patterns\n  const validation = validateCommand(command);\n  if (!validation.valid) {\n    return commandValidationError(validation.error || 'Invalid command');\n  }\n\n  // SECURITY: Validate network access in command (Phase 1.5)\n  const networkValidation = validateCommandNetworkAccess(command);\n  if (!networkValidation.valid) {\n    return networkValidationError(networkValidation.error || 'Network access denied');\n  }\n\n  // Validate cwd if provided\n  if (cwd) {\n    const cwdValidation = validatePath(cwd);\n    if (!cwdValidation.valid) {\n      return pathValidationError(`Working directory: ${cwdValidation.error}`);\n    }\n  }\n\n  return {\n    success: true,\n    data: {\n      command,\n      cwd,\n      timeout,\n      message: `Running: ${command}${cwd ? ` (in ${cwd})` : ''}...`,\n      warning: validation.warning,\n      // IMPORTANT: requiresSandbox flag tells frontend this MUST run in sandbox\n      requiresSandbox: true,\n    },\n    action: {\n      type: 'command_executed',\n      payload: {\n        command,\n        cwd,\n        timeout,\n        sandboxOperation: 'exec',\n      },\n    },\n  };\n}\n\n/**\n * Start a development server\n */\nasync function executeStartDevServer(args: Record<string, unknown>): Promise<ToolResult> {\n  const command = (args.command as string) || 'npm run dev';\n  const port = (args.port as number) || 3000;\n\n  return {\n    success: true,\n    data: {\n      command,\n      port,\n      message: `Starting dev server on port ${port}...`,\n    },\n    action: {\n      type: 'server_started',\n      payload: {\n        command,\n        port,\n        sandboxOperation: 'startServer',\n      },\n    },\n  };\n}\n\n/**\n * Get the preview URL for the running sandbox\n */\nasync function executeGetPreviewUrl(args: Record<string, unknown>): Promise<ToolResult> {\n  return {\n    success: true,\n    data: {\n      message: 'Getting preview URL...',\n    },\n    action: {\n      type: 'preview_ready',\n      payload: {\n        sandboxOperation: 'getPreviewUrl',\n      },\n    },\n  };\n}\n\n// --------------------------------------------------------------------------\n// Git Operations\n// --------------------------------------------------------------------------\n\n/**\n * Get git status\n */\nasync function executeGitStatus(args: Record<string, unknown>): Promise<ToolResult> {\n  return {\n    success: true,\n    data: {\n      message: 'Getting git status...',\n    },\n    action: {\n      type: 'git_status',\n      payload: {\n        sandboxOperation: 'gitStatus',\n      },\n    },\n  };\n}\n\n/**\n * Get git diff\n */\nasync function executeGitDiff(args: Record<string, unknown>): Promise<ToolResult> {\n  const path = args.path as string | undefined;\n  const staged = (args.staged as boolean) || false;\n\n  return {\n    success: true,\n    data: {\n      path,\n      staged,\n      message: `Getting ${staged ? 'staged ' : ''}diff${path ? ` for ${path}` : ''}...`,\n    },\n    action: {\n      type: 'git_diff',\n      payload: {\n        path,\n        staged,\n        sandboxOperation: 'gitDiff',\n      },\n    },\n  };\n}\n\n/**\n * Commit changes\n */\nasync function executeGitCommit(args: Record<string, unknown>): Promise<ToolResult> {\n  const message = args.message as string;\n  const stageAll = (args.stageAll as boolean) || false;\n\n  if (!message) {\n    return {\n      success: false,\n      error: 'Commit message is required',\n    };\n  }\n\n  return {\n    success: true,\n    data: {\n      message,\n      stageAll,\n      commitMessage: message,\n    },\n    action: {\n      type: 'git_committed',\n      payload: {\n        message,\n        stageAll,\n        sandboxOperation: 'gitCommit',\n      },\n    },\n  };\n}\n\n/**\n * Push commits to remote\n */\nasync function executeGitPush(args: Record<string, unknown>): Promise<ToolResult> {\n  const branch = args.branch as string | undefined;\n  const setUpstream = (args.setUpstream as boolean) ?? true;\n\n  return {\n    success: true,\n    data: {\n      branch,\n      setUpstream,\n      message: `Pushing${branch ? ` to ${branch}` : ''}...`,\n    },\n    action: {\n      type: 'git_pushed',\n      payload: {\n        branch,\n        setUpstream,\n        sandboxOperation: 'gitPush',\n      },\n    },\n  };\n}\n\n/**\n * Create and checkout a new branch\n */\nasync function executeCreateBranch(args: Record<string, unknown>): Promise<ToolResult> {\n  const name = args.name as string | undefined;\n  const fromBranch = args.fromBranch as string | undefined;\n\n  // If no name provided, indicate that it should be auto-generated from context\n  const branchInfo = name\n    ? { name, autoGenerated: false }\n    : { autoGenerated: true, message: 'Branch name will be generated from active ticket context' };\n\n  return {\n    success: true,\n    data: {\n      ...branchInfo,\n      fromBranch,\n      message: name\n        ? `Creating branch ${name}${fromBranch ? ` from ${fromBranch}` : ''}...`\n        : 'Creating branch from ticket context...',\n    },\n    action: {\n      type: 'branch_created',\n      payload: {\n        name,\n        fromBranch,\n        autoGenerate: !name,\n        sandboxOperation: 'gitBranch',\n      },\n    },\n  };\n}\n\n// --------------------------------------------------------------------------\n// Coding Task Management\n// --------------------------------------------------------------------------\n\n/**\n * Create a new coding task\n */\nasync function executeCreateCodingTask(args: Record<string, unknown>): Promise<ToolResult> {\n  const title = args.title as string;\n  const description = args.description as string;\n  const projectId = args.projectId as string | undefined;\n  const ticketId = args.ticketId as string | undefined;\n  const repositoryUrl = args.repositoryUrl as string | undefined;\n\n  if (!title || !description) {\n    return {\n      success: false,\n      error: 'Title and description are required',\n    };\n  }\n\n  return {\n    success: true,\n    data: {\n      title,\n      description,\n      projectId,\n      ticketId,\n      repositoryUrl,\n      message: `Creating coding task: ${title}...`,\n    },\n    action: {\n      type: 'coding_task_created',\n      payload: {\n        title,\n        description,\n        projectId,\n        ticketId,\n        repositoryUrl,\n        agent: 'claude-code',\n        convexMutation: 'workingContext:createCodingTask',\n      },\n    },\n  };\n}\n\n/**\n * Update a coding task\n */\nasync function executeUpdateCodingTask(args: Record<string, unknown>): Promise<ToolResult> {\n  const taskId = args.taskId as string;\n  const status = args.status as string | undefined;\n  const filesModified = args.filesModified as string[] | undefined;\n  const commitSha = args.commitSha as string | undefined;\n\n  if (!taskId) {\n    return {\n      success: false,\n      error: 'Task ID is required',\n    };\n  }\n\n  const updates: Record<string, unknown> = {};\n  if (status) updates.status = status;\n  if (filesModified) updates.filesModified = filesModified;\n  if (commitSha) updates.commitSha = commitSha;\n\n  return {\n    success: true,\n    data: {\n      taskId,\n      updates,\n      message: `Updating coding task ${taskId}...`,\n    },\n    action: {\n      type: 'coding_task_updated',\n      payload: {\n        taskId,\n        ...updates,\n        convexMutation: 'workingContext:updateCodingTaskStatus',\n      },\n    },\n  };\n}\n\n/**\n * List coding tasks\n */\nasync function executeListCodingTasks(args: Record<string, unknown>): Promise<ToolResult> {\n  const status = args.status as string | undefined;\n  const limit = (args.limit as number) || 10;\n\n  return {\n    success: true,\n    data: {\n      status,\n      limit,\n      message: status\n        ? `Loading ${status} coding tasks...`\n        : 'Loading coding tasks...',\n    },\n    action: {\n      type: 'render_component',\n      payload: {\n        componentType: 'codingTasks',\n        status,\n        limit,\n        convexQuery: 'workingContext:listCodingTasks',\n      },\n    },\n  };\n}\n\n// =============================================================================\n// Cron Job Tool Executors\n// =============================================================================\n\n/**\n * Parse natural language schedule time into schedule configuration\n */\nfunction parseScheduleTime(\n  scheduleType: string,\n  scheduleTime?: string,\n  daysOfWeek?: number[]\n): {\n  runAt?: number;\n  intervalMinutes?: number;\n  hour?: number;\n  minute?: number;\n  daysOfWeek?: number[];\n  cronExpression?: string;\n} {\n  const now = new Date();\n\n  switch (scheduleType) {\n    case 'once': {\n      if (!scheduleTime) {\n        // Default to 1 hour from now\n        return { runAt: Date.now() + 60 * 60 * 1000 };\n      }\n\n      // Try parsing as ISO date or relative time\n      const parsed = Date.parse(scheduleTime);\n      if (!isNaN(parsed)) {\n        return { runAt: parsed };\n      }\n\n      // Handle relative times like \"in 2 hours\", \"in 30 minutes\"\n      const relativeMatch = scheduleTime.match(/in\\s+(\\d+)\\s+(minute|hour|day)s?/i);\n      if (relativeMatch) {\n        const amount = parseInt(relativeMatch[1]);\n        const unit = relativeMatch[2].toLowerCase();\n        const multipliers: Record<string, number> = {\n          minute: 60 * 1000,\n          hour: 60 * 60 * 1000,\n          day: 24 * 60 * 60 * 1000,\n        };\n        return { runAt: Date.now() + amount * multipliers[unit] };\n      }\n\n      // Handle \"tomorrow at 9am\" style\n      const tomorrowMatch = scheduleTime.match(/tomorrow\\s+at\\s+(\\d{1,2})(?::(\\d{2}))?\\s*(am|pm)?/i);\n      if (tomorrowMatch) {\n        let hour = parseInt(tomorrowMatch[1]);\n        const minute = tomorrowMatch[2] ? parseInt(tomorrowMatch[2]) : 0;\n        const ampm = tomorrowMatch[3]?.toLowerCase();\n        if (ampm === 'pm' && hour < 12) hour += 12;\n        if (ampm === 'am' && hour === 12) hour = 0;\n\n        const tomorrow = new Date();\n        tomorrow.setDate(tomorrow.getDate() + 1);\n        tomorrow.setHours(hour, minute, 0, 0);\n        return { runAt: tomorrow.getTime() };\n      }\n\n      return { runAt: Date.now() + 60 * 60 * 1000 };\n    }\n\n    case 'interval': {\n      // Parse interval like \"30\", \"60\", \"every 2 hours\"\n      if (!scheduleTime) return { intervalMinutes: 60 };\n\n      const intervalMatch = scheduleTime.match(/(\\d+)\\s*(minute|hour)?s?/i);\n      if (intervalMatch) {\n        const amount = parseInt(intervalMatch[1]);\n        const unit = intervalMatch[2]?.toLowerCase() || 'minute';\n        return { intervalMinutes: unit === 'hour' ? amount * 60 : amount };\n      }\n      return { intervalMinutes: 60 };\n    }\n\n    case 'daily': {\n      // Parse time like \"9:00\", \"9am\", \"14:30\"\n      if (!scheduleTime) return { hour: 9, minute: 0 };\n\n      const timeMatch = scheduleTime.match(/(\\d{1,2})(?::(\\d{2}))?\\s*(am|pm)?/i);\n      if (timeMatch) {\n        let hour = parseInt(timeMatch[1]);\n        const minute = timeMatch[2] ? parseInt(timeMatch[2]) : 0;\n        const ampm = timeMatch[3]?.toLowerCase();\n        if (ampm === 'pm' && hour < 12) hour += 12;\n        if (ampm === 'am' && hour === 12) hour = 0;\n        return { hour, minute };\n      }\n      return { hour: 9, minute: 0 };\n    }\n\n    case 'weekly': {\n      // Parse time and use provided daysOfWeek\n      const timeConfig = parseScheduleTime('daily', scheduleTime);\n      return {\n        hour: timeConfig.hour,\n        minute: timeConfig.minute,\n        daysOfWeek: daysOfWeek || [1], // Default to Monday\n      };\n    }\n\n    case 'cron': {\n      return { cronExpression: scheduleTime || '0 9 * * *' };\n    }\n\n    default:\n      return { hour: 9, minute: 0 };\n  }\n}\n\n/**\n * Create a new scheduled cron job\n */\nasync function executeCreateCronJob(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const name = args.name as string;\n  const description = args.description as string | undefined;\n  const scheduleType = args.scheduleType as string;\n  const scheduleTime = args.scheduleTime as string | undefined;\n  const daysOfWeek = args.daysOfWeek as number[] | undefined;\n  const actionType = args.actionType as string;\n  const prompt = args.prompt as string | undefined;\n  const emailSubject = args.emailSubject as string | undefined;\n  const emailBody = args.emailBody as string | undefined;\n  const recipientEmail = args.recipientEmail as string | undefined;\n  const webhookUrl = args.webhookUrl as string | undefined;\n  const deliveryChannel = args.deliveryChannel as string | undefined;\n  const timezone = (args.timezone as string) || 'America/Los_Angeles';\n\n  if (!name) {\n    return {\n      success: false,\n      error: 'Job name is required',\n    };\n  }\n\n  if (!scheduleType || !['once', 'interval', 'daily', 'weekly', 'cron'].includes(scheduleType)) {\n    return {\n      success: false,\n      error: 'Valid schedule type is required: once, interval, daily, weekly, or cron',\n    };\n  }\n\n  if (!actionType || !['ai_message', 'notification', 'email', 'webhook', 'memory_snapshot'].includes(actionType)) {\n    return {\n      success: false,\n      error: 'Valid action type is required: ai_message, notification, email, webhook, or memory_snapshot',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const userId = getEffectiveUserId(context);\n    const client = new ConvexHttpClient(convexUrl);\n\n    const scheduleConfig = {\n      ...parseScheduleTime(scheduleType, scheduleTime, daysOfWeek),\n      timezone,\n    };\n\n    const actionPayload: Record<string, unknown> = {};\n    if (prompt) actionPayload.prompt = prompt;\n    if (emailSubject) actionPayload.subject = emailSubject;\n    if (emailBody) actionPayload.body = emailBody;\n    if (recipientEmail) actionPayload.recipientEmail = recipientEmail;\n    if (webhookUrl) actionPayload.webhookUrl = webhookUrl;\n\n    const deliverTo = deliveryChannel\n      ? { channel: deliveryChannel as 'web' | 'email' | 'whatsapp' | 'telegram' | 'imessage' }\n      : undefined;\n\n    const result = await client.mutation(api.userCronJobs.createJob, {\n      userId,\n      name,\n      description,\n      scheduleType: scheduleType as 'once' | 'interval' | 'daily' | 'weekly' | 'cron',\n      scheduleConfig,\n      actionType: actionType as 'ai_message' | 'notification' | 'email' | 'webhook' | 'memory_snapshot',\n      actionPayload,\n      deliverTo,\n    });\n\n    return {\n      success: true,\n      data: {\n        jobId: result.jobId,\n        name,\n        scheduleType,\n        actionType,\n        message: `Created scheduled job \"${name}\" (${result.jobId})`,\n      },\n      action: {\n        type: 'cron_job_created',\n        payload: {\n          jobId: result.jobId,\n          name,\n          scheduleType,\n          actionType,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to create cron job',\n    };\n  }\n}\n\n/**\n * List user's cron jobs\n */\nasync function executeListCronJobs(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const includeInactive = args.includeInactive as boolean | undefined;\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const userId = getEffectiveUserId(context);\n    const client = new ConvexHttpClient(convexUrl);\n\n    const jobs = await client.query(api.userCronJobs.getUserJobs, {\n      userId,\n      includeInactive: includeInactive ?? false,\n    });\n\n    const jobSummaries = jobs.map((job) => ({\n      jobId: job.jobId,\n      name: job.name,\n      description: job.description,\n      scheduleType: job.scheduleType,\n      actionType: job.actionType,\n      isActive: job.isActive,\n      nextRunAt: job.nextRunAt ? new Date(job.nextRunAt).toISOString() : null,\n      lastRunAt: job.lastRunAt ? new Date(job.lastRunAt).toISOString() : null,\n      lastRunStatus: job.lastRunStatus,\n      runCount: job.runCount,\n      successCount: job.successCount,\n      errorCount: job.errorCount,\n    }));\n\n    return {\n      success: true,\n      data: {\n        jobs: jobSummaries,\n        count: jobs.length,\n        message: jobs.length > 0\n          ? `Found ${jobs.length} scheduled job${jobs.length === 1 ? '' : 's'}`\n          : 'No scheduled jobs found',\n      },\n      action: {\n        type: 'cron_jobs_listed',\n        payload: {\n          count: jobs.length,\n          jobs: jobSummaries,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to list cron jobs',\n    };\n  }\n}\n\n/**\n * Toggle a cron job active/inactive\n */\nasync function executeToggleCronJob(args: Record<string, unknown>): Promise<ToolResult> {\n  const jobId = args.jobId as string;\n\n  if (!jobId) {\n    return {\n      success: false,\n      error: 'Job ID is required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    const result = await client.mutation(api.userCronJobs.toggleJob, {\n      jobId,\n    });\n\n    return {\n      success: true,\n      data: {\n        jobId,\n        isActive: result.isActive,\n        message: `Job ${jobId} is now ${result.isActive ? 'active' : 'paused'}`,\n      },\n      action: {\n        type: 'cron_job_updated',\n        payload: {\n          jobId,\n          isActive: result.isActive,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to toggle cron job',\n    };\n  }\n}\n\n/**\n * Delete a cron job\n */\nasync function executeDeleteCronJob(args: Record<string, unknown>): Promise<ToolResult> {\n  const jobId = args.jobId as string;\n\n  if (!jobId) {\n    return {\n      success: false,\n      error: 'Job ID is required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    await client.mutation(api.userCronJobs.deleteJob, {\n      jobId,\n    });\n\n    return {\n      success: true,\n      data: {\n        jobId,\n        message: `Deleted scheduled job ${jobId}`,\n      },\n      action: {\n        type: 'cron_job_deleted',\n        payload: {\n          jobId,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to delete cron job',\n    };\n  }\n}\n\n// =============================================================================\n// Conversation Compaction Executors\n// =============================================================================\n\n/**\n * Compact a conversation by summarizing older messages\n */\nasync function executeCompactConversation(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const sessionId = args.sessionId as string;\n  const keepRecentCount = (args.keepRecentCount as number) || 10;\n  const instructions = args.instructions as string | undefined;\n\n  if (!sessionId) {\n    return {\n      success: false,\n      error: 'Session ID is required',\n    };\n  }\n\n  try {\n    const userId = getEffectiveUserId(context);\n\n    // Call the compact API endpoint\n    const baseUrl = process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000';\n    const response = await fetch(`${baseUrl}/api/chat/compact`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        sessionId,\n        keepRecentCount,\n        instructions,\n        // Note: messages would be passed by the client hook, not here\n        // This tool is more for triggering compaction from the AI side\n        messages: [], // Placeholder - actual messages come from client\n      }),\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json();\n      return {\n        success: false,\n        error: errorData.error || 'Compaction request failed',\n      };\n    }\n\n    const result = await response.json();\n\n    // ========================================================================\n    // MEMORY INTEGRATION - Extract memories from compaction\n    // ========================================================================\n    let episodicMemoryId: string | undefined;\n    const semanticMemoryIds: string[] = [];\n\n    try {\n      const memoryManager = getMemoryManager();\n\n      // 1. Create episodic memory for the conversation summary\n      if (result.summary) {\n        episodicMemoryId = await memoryManager.storeEpisodicMemory(\n          userId,\n          result.summary,\n          'milestone' as EpisodicMemoryType, // conversation_summary maps to milestone\n          0.6, // Medium-high importance for compacted conversations\n          undefined, // No project context\n          {\n            toolsUsed: ['compact_conversation'],\n            outcome: `Auto-extracted from conversation compaction (${result.originalMessageCount} messages, topics: ${result.topics?.join(', ') || 'none'})`,\n          }\n        );\n      }\n\n      // 2. Extract semantic memories from decisions\n      if (result.decisions && Array.isArray(result.decisions)) {\n        for (const decision of result.decisions) {\n          const decisionText = typeof decision === 'string' ? decision : JSON.stringify(decision);\n          const memId = await memoryManager.upsertSemanticMemory(\n            userId,\n            'preference' as SemanticCategory, // Decisions are user preferences\n            `decision_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`,\n            decisionText,\n            0.8, // High confidence for explicit decisions\n            `compaction_${result.compactionId}`\n          );\n          if (memId) semanticMemoryIds.push(memId);\n        }\n      }\n\n      // 3. Extract semantic memories from key points (as facts)\n      if (result.keyPoints && Array.isArray(result.keyPoints)) {\n        for (const keyPoint of result.keyPoints) {\n          const keyPointText = typeof keyPoint === 'string' ? keyPoint : JSON.stringify(keyPoint);\n          const memId = await memoryManager.upsertSemanticMemory(\n            userId,\n            'fact' as SemanticCategory,\n            `keypoint_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`,\n            keyPointText,\n            0.7, // Good confidence for key points\n            `compaction_${result.compactionId}`\n          );\n          if (memId) semanticMemoryIds.push(memId);\n        }\n      }\n    } catch (memoryError) {\n      // Log but don't fail compaction if memory extraction fails\n      console.error('Memory extraction from compaction failed:', memoryError);\n    }\n\n    return {\n      success: true,\n      data: {\n        compactionId: result.compactionId,\n        summary: result.summary,\n        keyPoints: result.keyPoints,\n        decisions: result.decisions,\n        openQuestions: result.openQuestions,\n        topics: result.topics,\n        originalMessageCount: result.originalMessageCount,\n        tokensSaved: result.tokensSaved,\n        message: `Compacted ${result.originalMessageCount} messages, saved ~${result.tokensSaved} tokens`,\n        // Memory integration results\n        memoryExtracted: true,\n        episodicMemoryId,\n        semanticMemoryCount: semanticMemoryIds.length,\n      },\n      action: {\n        type: 'conversation_compacted',\n        payload: {\n          compactionId: result.compactionId,\n          summary: result.summary,\n          keyPoints: result.keyPoints,\n          tokensSaved: result.tokensSaved,\n          episodicMemoryId,\n          semanticMemoryIds,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to compact conversation',\n    };\n  }\n}\n\n/**\n * Get existing compaction summary for a session\n */\nasync function executeGetCompactionSummary(args: Record<string, unknown>): Promise<ToolResult> {\n  const sessionId = args.sessionId as string;\n\n  if (!sessionId) {\n    return {\n      success: false,\n      error: 'Session ID is required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    const compaction = await client.query(api.compaction.getLatestCompaction, {\n      sessionId,\n    });\n\n    if (!compaction) {\n      return {\n        success: true,\n        data: {\n          found: false,\n          message: 'No compaction found for this session',\n        },\n      };\n    }\n\n    return {\n      success: true,\n      data: {\n        found: true,\n        compactionId: compaction.compactionId,\n        summary: compaction.summary,\n        keyPoints: compaction.keyPoints,\n        decisions: compaction.decisions,\n        openQuestions: compaction.openQuestions,\n        topics: compaction.topics,\n        originalMessageCount: compaction.originalMessageCount,\n        createdAt: new Date(compaction.createdAt).toISOString(),\n        message: `Found compaction from ${new Date(compaction.createdAt).toLocaleDateString()}`,\n      },\n      action: {\n        type: 'compaction_retrieved',\n        payload: {\n          compactionId: compaction.compactionId,\n          summary: compaction.summary,\n          keyPoints: compaction.keyPoints,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to get compaction summary',\n    };\n  }\n}\n\n// ============================================================================\n// CHANNEL INTEGRATION TOOLS - WhatsApp, Telegram, iMessage, Slack, Discord\n// ============================================================================\n\n/**\n * List all connected channel integrations\n */\nasync function executeListChannelIntegrations(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const includeDisabled = args.includeDisabled as boolean || false;\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const userId = getEffectiveUserId(context);\n    const client = new ConvexHttpClient(convexUrl);\n\n    const integrations = await client.query(api.channels.getUserIntegrations, {\n      userId,\n    });\n\n    // Filter based on includeDisabled\n    const filtered = includeDisabled\n      ? integrations\n      : integrations.filter((i) => i.settings?.enabled);\n\n    return {\n      success: true,\n      data: {\n        integrations: filtered.map((i) => ({\n          id: i._id,\n          platform: i.platform,\n          enabled: i.settings?.enabled ?? false,\n          status: i.connectionStatus,\n          identifier: i.platformUserId,\n        })),\n        count: filtered.length,\n        message: `Found ${filtered.length} channel integration${filtered.length !== 1 ? 's' : ''}`,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to list channel integrations',\n    };\n  }\n}\n\n/**\n * Get conversations from connected channels\n */\nasync function executeGetChannelConversations(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const platform = args.platform as string | undefined;\n  const limit = (args.limit as number) || 20;\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const userId = getEffectiveUserId(context);\n    const client = new ConvexHttpClient(convexUrl);\n\n    const conversations = await client.query(api.channels.getConversations, {\n      userId,\n    });\n\n    // Filter by platform if specified and limit results\n    const filtered = conversations\n      .filter((c) => !platform || c.platform === platform)\n      .slice(0, limit);\n\n    return {\n      success: true,\n      data: {\n        conversations: filtered.map((c) => ({\n          recipientId: c.platformUserId,\n          recipientName: c.platformUsername || c.platformUserId,\n          platform: c.platform,\n          lastMessage: c.lastMessage?.content || '',\n          lastMessageAt: c.lastMessage ? new Date(c.lastMessage._creationTime).toISOString() : '',\n          unreadCount: c.unreadCount ?? 0,\n          integrationId: c.integrationId,\n        })),\n        count: conversations.length,\n        message: `Found ${conversations.length} conversation${conversations.length !== 1 ? 's' : ''}${platform ? ` on ${platform}` : ''}`,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to get channel conversations',\n    };\n  }\n}\n\n/**\n * Send a message via a connected channel\n */\nasync function executeSendChannelMessage(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const integrationId = args.integrationId as string;\n  const recipientId = args.recipientId as string;\n  const content = args.content as string;\n  const messageType = (args.messageType as string) || 'text';\n\n  if (!integrationId || !content) {\n    return {\n      success: false,\n      error: 'Integration ID and content are required',\n    };\n  }\n\n  // SECURITY: Validate message content for phishing/social engineering\n  const contentValidation = validateMessageContent(content);\n  if (!contentValidation.valid) {\n    return messageValidationError(contentValidation.error || 'Invalid message content');\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const userId = getEffectiveUserId(context);\n    const client = new ConvexHttpClient(convexUrl);\n\n    // First, get the integration to determine the platform and credentials\n    const integration = await client.query(api.channels.getIntegration, {\n      integrationId,\n    });\n\n    if (!integration) {\n      return {\n        success: false,\n        error: 'Integration not found',\n      };\n    }\n\n    // Check if integration is enabled\n    if (!integration.settings.enabled) {\n      return {\n        success: false,\n        error: 'Integration is disabled',\n      };\n    }\n\n    // Use the recipient from the integration if not provided\n    const targetRecipient = recipientId || integration.platformUserId;\n\n    // Send the message via the outbound router\n    const sendResult = await sendMessage(\n      {\n        integrationId,\n        platform: integration.platform as Platform,\n        recipientId: targetRecipient,\n        content,\n        messageType: messageType as 'text' | 'voice' | 'image',\n      },\n      integration.credentials\n    );\n\n    if (!sendResult.success) {\n      return {\n        success: false,\n        error: sendResult.error || 'Failed to send message',\n      };\n    }\n\n    // Log the outbound message\n    // NOTE: Rate limiting should be enforced in the Convex mutation (per-recipient limits)\n    const { messageId } = await client.mutation(api.channels.logOutboundMessage, {\n      integrationId,\n      userId,\n      platform: integration.platform,\n      platformMessageId: sendResult.platformMessageId,\n      content,\n      messageType: messageType as 'text' | 'voice' | 'image' | 'document' | 'sticker',\n      toolsUsed: ['send_channel_message'],\n    });\n\n    // Include any warnings about suspicious URLs\n    const warnings = contentValidation.warnings;\n\n    return {\n      success: true,\n      data: {\n        messageId,\n        platformMessageId: sendResult.platformMessageId,\n        sent: true,\n        platform: integration.platform,\n        recipientId: targetRecipient,\n        content: content.slice(0, 100) + (content.length > 100 ? '...' : ''),\n        message: `Message sent successfully via ${integration.platform}`,\n        warnings, // Include any security warnings\n      },\n      action: {\n        type: 'message_sent' as const,\n        payload: {\n          messageId,\n          integrationId,\n          recipientId: targetRecipient,\n          platform: integration.platform,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to send channel message',\n    };\n  }\n}\n\n/**\n * Search messages across all connected channels\n */\nasync function executeSearchChannelMessages(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const query = args.query as string;\n  const platform = args.platform as string | undefined;\n  const limit = (args.limit as number) || 20;\n\n  if (!query) {\n    return {\n      success: false,\n      error: 'Search query is required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const userId = getEffectiveUserId(context);\n    const client = new ConvexHttpClient(convexUrl);\n\n    const messages = await client.query(api.channels.searchMessages, {\n      userId,\n      query,\n      limit,\n    });\n\n    // Filter by platform if specified\n    const filtered = platform\n      ? messages.filter((m) => m.platform === platform)\n      : messages;\n\n    return {\n      success: true,\n      data: {\n        messages: filtered.map((m) => ({\n          id: m._id,\n          platform: m.platform,\n          direction: m.direction,\n          content: m.content,\n          timestamp: new Date(m._creationTime).toISOString(),\n          contact: m.integrationId,\n        })),\n        count: messages.length,\n        query,\n        message: `Found ${messages.length} message${messages.length !== 1 ? 's' : ''} matching \"${query}\"`,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to search channel messages',\n    };\n  }\n}\n\n// =============================================================================\n// ERV DIMENSION TOOLS - Create, navigate, and search dimensions/entities\n// =============================================================================\n\n/**\n * Preset dimension configurations for reference\n */\nconst PRESET_DIMENSIONS = [\n  { id: 'feed', name: 'Feed', icon: '', description: 'Chronological stream of all entities' },\n  { id: 'kanban', name: 'Kanban', icon: '', description: 'Ticket and task management board' },\n  { id: 'graph', name: 'Graph', icon: '', description: 'Entity relationship visualization' },\n  { id: 'graph-3d', name: 'Graph 3D', icon: '', description: 'Immersive 3D relationship space' },\n  { id: 'calendar', name: 'Calendar', icon: '', description: 'Time-based event visualization' },\n  { id: 'grid', name: 'Grid', icon: '', description: 'Gallery-style entity browser' },\n  { id: 'table', name: 'Table', icon: '', description: 'Spreadsheet-like data view' },\n  { id: 'ipod', name: 'iPod', icon: '', description: 'Music-centric navigation' },\n  { id: 'quest-log', name: 'Quest Log', icon: '', description: 'Gamified task progression' },\n  { id: 'skill-tree', name: 'Skill Tree', icon: '', description: 'Interconnected skill progression' },\n];\n\n/**\n * Map metaphors to dimension configurations\n */\nconst METAPHOR_CONFIGS: Record<string, Partial<{\n  container: string;\n  arrangement: string;\n  entityShape: string;\n  connectionStyle: string;\n  gradient: string;\n}>> = {\n  river: { container: 'frame', arrangement: 'list', entityShape: 'square', connectionStyle: 'none', gradient: 'from-blue-500 to-cyan-500' },\n  board: { container: 'panel', arrangement: 'grid', entityShape: 'square', connectionStyle: 'none', gradient: 'from-violet-500 to-purple-500' },\n  constellation: { container: 'frame', arrangement: 'graph', entityShape: 'circle', connectionStyle: 'curve', gradient: 'from-emerald-500 to-green-500' },\n  solar: { container: 'frame', arrangement: 'orbit', entityShape: 'circle', connectionStyle: 'glow', gradient: 'from-pink-500 to-rose-500' },\n  timeline: { container: 'panel', arrangement: 'list', entityShape: 'square', connectionStyle: 'line', gradient: 'from-amber-500 to-orange-500' },\n  mosaic: { container: 'frame', arrangement: 'grid', entityShape: 'square', connectionStyle: 'none', gradient: 'from-cyan-500 to-teal-500' },\n  ledger: { container: 'panel', arrangement: 'list', entityShape: 'square', connectionStyle: 'none', gradient: 'from-slate-500 to-zinc-500' },\n  vinyl: { container: 'card', arrangement: 'flow', entityShape: 'square', connectionStyle: 'none', gradient: 'from-indigo-500 to-blue-500' },\n  dungeon: { container: 'panel', arrangement: 'tree', entityShape: 'hexagon', connectionStyle: 'arrow', gradient: 'from-red-500 to-orange-500' },\n  tree: { container: 'frame', arrangement: 'tree', entityShape: 'circle', connectionStyle: 'curve', gradient: 'from-emerald-500 to-teal-500' },\n};\n\n/**\n * Create a custom dimension\n */\nasync function executeCreateDimension(args: Record<string, unknown>): Promise<ToolResult> {\n  const name = args.name as string;\n  const metaphor = args.metaphor as string;\n  const arrangement = args.arrangement as string;\n  const entityTypes = args.entityTypes as string[] | undefined;\n  const description = args.description as string | undefined;\n\n  if (!name || !metaphor || !arrangement) {\n    return {\n      success: false,\n      error: 'Name, metaphor, and arrangement are required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    // Get metaphor configuration\n    const metaphorConfig = METAPHOR_CONFIGS[metaphor] || METAPHOR_CONFIGS['mosaic'];\n\n    // Build dimension config\n    const config = {\n      container: metaphorConfig.container,\n      arrangement: arrangement,\n      entityShape: metaphorConfig.entityShape,\n      connectionStyle: metaphorConfig.connectionStyle,\n      decorations: [{ type: 'shadow' }],\n      interactions: [\n        { type: 'click', action: 'navigate' },\n        { type: 'longpress', action: 'reveal' },\n      ],\n      transition: 'morph',\n      filter: entityTypes?.length ? { entityTypes } : undefined,\n    };\n\n    const result = await client.mutation(api.erv.createDimension, {\n      name,\n      description: description || `Custom ${metaphor} dimension`,\n      metaphor,\n      config: JSON.stringify(config),\n      icon: METAPHOR_CONFIGS[metaphor] ? '' : '',\n      gradient: metaphorConfig.gradient,\n      allowedEntityTypes: entityTypes,\n    });\n\n    return {\n      success: true,\n      data: {\n        dimensionId: result.dimensionId,\n        name,\n        metaphor,\n        arrangement,\n        entityTypes: entityTypes || 'all',\n        message: `Created dimension \"${name}\" with ${metaphor} metaphor`,\n      },\n      action: {\n        type: 'dimension_created',\n        payload: {\n          dimensionId: result.dimensionId,\n          name,\n          metaphor,\n          navigateTo: `/d/${result.dimensionId}`,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to create dimension',\n    };\n  }\n}\n\n/**\n * Navigate to a dimension\n */\nfunction executeNavigateToDimension(args: Record<string, unknown>): ToolResult {\n  const dimensionId = args.dimensionId as string;\n\n  if (!dimensionId) {\n    return {\n      success: false,\n      error: 'Dimension ID is required',\n    };\n  }\n\n  // Check if it's a preset\n  const preset = PRESET_DIMENSIONS.find((d) => d.id === dimensionId);\n  const name = preset?.name || dimensionId;\n\n  return {\n    success: true,\n    data: {\n      dimensionId,\n      name,\n      isPreset: !!preset,\n      message: `Navigating to ${name} dimension...`,\n    },\n    action: {\n      type: 'dimension_navigated',\n      payload: {\n        dimensionId,\n        name,\n        navigateTo: `/d/${dimensionId}`,\n      },\n    },\n  };\n}\n\n/**\n * List available dimensions\n */\nasync function executeListDimensions(args: Record<string, unknown>): Promise<ToolResult> {\n  const includePresets = args.includePresets !== false;\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    // Return just presets if no Convex connection\n    return {\n      success: true,\n      data: {\n        presets: PRESET_DIMENSIONS,\n        custom: [],\n        message: `${PRESET_DIMENSIONS.length} preset dimensions available`,\n      },\n      action: {\n        type: 'dimensions_listed',\n        payload: {\n          presets: PRESET_DIMENSIONS,\n          custom: [],\n        },\n      },\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    const dimensions = await client.query(api.erv.listDimensions, {\n      includePresets,\n    });\n\n    // Separate presets and custom\n    const custom = dimensions.filter((d) => !d.isPreset).map((d) => ({\n      id: d.dimensionId,\n      name: d.name,\n      icon: d.icon || '',\n      description: d.description,\n      metaphor: d.metaphor,\n    }));\n\n    return {\n      success: true,\n      data: {\n        presets: includePresets ? PRESET_DIMENSIONS : [],\n        custom,\n        totalCount: (includePresets ? PRESET_DIMENSIONS.length : 0) + custom.length,\n        message: `Found ${custom.length} custom dimension${custom.length !== 1 ? 's' : ''} and ${PRESET_DIMENSIONS.length} presets`,\n      },\n      action: {\n        type: 'dimensions_listed',\n        payload: {\n          presets: includePresets ? PRESET_DIMENSIONS : [],\n          custom,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to list dimensions',\n    };\n  }\n}\n\n/**\n * Search entities in the ERV system\n */\nasync function executeSearchEntities(args: Record<string, unknown>): Promise<ToolResult> {\n  const query = args.query as string;\n  const entityTypes = args.entityTypes as string[] | undefined;\n  const limit = (args.limit as number) || 20;\n\n  if (!query) {\n    return {\n      success: false,\n      error: 'Search query is required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    const entities = await client.query(api.erv.searchEntities, {\n      query,\n      entityTypes: entityTypes as Array<'Person' | 'Project' | 'Track' | 'Draft' | 'Sketch' | 'Ticket' | 'Epic' | 'Event' | 'Memory' | 'Value' | 'Dimension' | 'Collection' | 'Skill' | 'Reminder'> | undefined,\n      limit,\n    });\n\n    // Format results\n    const results = entities.map((e) => {\n      let parsedData: Record<string, unknown> = {};\n      try {\n        parsedData = JSON.parse(e.data);\n      } catch {\n        // ignore parse errors\n      }\n\n      return {\n        entityId: e.entityId,\n        type: e.entityType,\n        name: e.name,\n        tags: e.tags,\n        importance: e.importance,\n        // Include some type-specific fields\n        ...(e.entityType === 'Ticket' && {\n          ticketId: parsedData.ticketId,\n          status: parsedData.status,\n          priority: parsedData.priority,\n        }),\n        ...(e.entityType === 'Project' && {\n          status: parsedData.status,\n        }),\n        ...(e.entityType === 'Track' && {\n          artist: parsedData.artist,\n          album: parsedData.album,\n        }),\n      };\n    });\n\n    return {\n      success: true,\n      data: {\n        results,\n        count: results.length,\n        query,\n        entityTypes: entityTypes || 'all',\n        message: `Found ${results.length} entit${results.length !== 1 ? 'ies' : 'y'} matching \"${query}\"`,\n      },\n      action: {\n        type: 'entities_searched',\n        payload: {\n          query,\n          count: results.length,\n          results: results.slice(0, 5), // Preview first 5\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to search entities',\n    };\n  }\n}\n\n// =============================================================================\n// Video/Remotion Tool Handlers\n// =============================================================================\n\n// In-memory storage for video compositions (would be Convex in production)\nconst videoCompositions = new Map<string, {\n  id: string;\n  name: string;\n  type: string;\n  preset: string;\n  width: number;\n  height: number;\n  fps: number;\n  durationInFrames: number;\n  layers: Array<{\n    id: string;\n    type: string;\n    [key: string]: unknown;\n  }>;\n  audio?: { src: string; volume: number };\n  backgroundColor?: string;\n  backgroundGradient?: string;\n  createdAt: number;\n  updatedAt: number;\n}>();\n\nconst VIDEO_PRESETS: Record<string, { width: number; height: number; fps: number }> = {\n  'instagram-story': { width: 1080, height: 1920, fps: 30 },\n  'instagram-post': { width: 1080, height: 1080, fps: 30 },\n  'instagram-reel': { width: 1080, height: 1920, fps: 30 },\n  'tiktok': { width: 1080, height: 1920, fps: 30 },\n  'youtube': { width: 1920, height: 1080, fps: 30 },\n  'youtube-short': { width: 1080, height: 1920, fps: 30 },\n  'twitter': { width: 1280, height: 720, fps: 30 },\n  '1080p': { width: 1920, height: 1080, fps: 30 },\n  '720p': { width: 1280, height: 720, fps: 30 },\n  '4k': { width: 3840, height: 2160, fps: 30 },\n  'square': { width: 1080, height: 1080, fps: 30 },\n  'portrait': { width: 1080, height: 1350, fps: 30 },\n};\n\nfunction executeCreateVideoComposition(args: Record<string, unknown>): ToolResult {\n  const name = args.name as string;\n  const type = args.type as string;\n  const presetKey = (args.preset as string) || '1080p';\n  const durationSeconds = (args.durationSeconds as number) || 30;\n  const backgroundColor = args.backgroundColor as string | undefined;\n  const backgroundGradient = args.backgroundGradient as string | undefined;\n\n  if (!name) {\n    return {\n      success: false,\n      error: 'Composition name is required',\n    };\n  }\n\n  const preset = VIDEO_PRESETS[presetKey] || VIDEO_PRESETS['1080p'];\n  const id = `video-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;\n  const now = Date.now();\n\n  const composition = {\n    id,\n    name,\n    type,\n    preset: presetKey,\n    width: preset.width,\n    height: preset.height,\n    fps: preset.fps,\n    durationInFrames: durationSeconds * preset.fps,\n    layers: [],\n    backgroundColor: backgroundColor || '#000000',\n    backgroundGradient,\n    createdAt: now,\n    updatedAt: now,\n  };\n\n  videoCompositions.set(id, composition);\n\n  return {\n    success: true,\n    data: {\n      compositionId: id,\n      name,\n      type,\n      preset: presetKey,\n      dimensions: `${preset.width}x${preset.height}`,\n      fps: preset.fps,\n      durationSeconds,\n      durationInFrames: composition.durationInFrames,\n      message: `Created ${type} composition \"${name}\" (${preset.width}x${preset.height} @ ${preset.fps}fps, ${durationSeconds}s)`,\n    },\n    action: {\n      type: 'video_composition_created',\n      payload: {\n        compositionId: id,\n        composition: {\n          name,\n          type,\n          width: preset.width,\n          height: preset.height,\n          durationSeconds,\n        },\n      },\n    },\n  };\n}\n\nfunction executeAddTextOverlay(args: Record<string, unknown>): ToolResult {\n  const compositionId = args.compositionId as string;\n  const text = args.text as string;\n  const position = (args.position as string) || 'center';\n  const startTime = (args.startTime as number) || 0;\n  const duration = args.duration as number | undefined;\n  const fontSize = (args.fontSize as number) || 32;\n  const color = (args.color as string) || '#ffffff';\n  const animation = (args.animation as string) || 'fade';\n\n  if (!compositionId) {\n    return {\n      success: false,\n      error: 'Composition ID is required',\n    };\n  }\n\n  if (!text) {\n    return {\n      success: false,\n      error: 'Text content is required',\n    };\n  }\n\n  const composition = videoCompositions.get(compositionId);\n  if (!composition) {\n    return {\n      success: false,\n      error: `Composition not found: ${compositionId}`,\n    };\n  }\n\n  const layerId = `text-${Date.now()}-${Math.random().toString(36).slice(2, 6)}`;\n  const startFrame = Math.floor(startTime * composition.fps);\n  const durationInFrames = duration\n    ? Math.floor(duration * composition.fps)\n    : composition.durationInFrames - startFrame;\n\n  const layer = {\n    id: layerId,\n    type: 'text',\n    text,\n    position,\n    startFrame,\n    durationInFrames,\n    fontSize,\n    color,\n    animationIn: animation,\n    animationOut: 'fade',\n    zIndex: composition.layers.length + 1,\n  };\n\n  composition.layers.push(layer);\n  composition.updatedAt = Date.now();\n\n  return {\n    success: true,\n    data: {\n      layerId,\n      compositionId,\n      text: text.slice(0, 50) + (text.length > 50 ? '...' : ''),\n      position,\n      startTime,\n      duration: duration || (composition.durationInFrames - startFrame) / composition.fps,\n      animation,\n      message: `Added text overlay \"${text.slice(0, 30)}${text.length > 30 ? '...' : ''}\" at ${position}`,\n    },\n    action: {\n      type: 'video_layer_added',\n      payload: {\n        compositionId,\n        layerId,\n        layerType: 'text',\n        preview: text.slice(0, 50),\n      },\n    },\n  };\n}\n\nfunction executeAddLyricsToVideo(args: Record<string, unknown>): ToolResult {\n  const compositionId = args.compositionId as string;\n  const audioSrc = args.audioSrc as string;\n  const lyrics = args.lyrics as Array<{ text: string; startTime: number; endTime: number }>;\n  const style = (args.style as string) || 'karaoke';\n  const fontFamily = (args.fontFamily as string) || 'Inter, sans-serif';\n  const color = (args.color as string) || '#ffffff';\n  const highlightColor = (args.highlightColor as string) || '#ffcc00';\n  const position = (args.position as string) || 'center';\n\n  if (!compositionId) {\n    return {\n      success: false,\n      error: 'Composition ID is required',\n    };\n  }\n\n  if (!audioSrc) {\n    return {\n      success: false,\n      error: 'Audio source is required',\n    };\n  }\n\n  if (!lyrics || lyrics.length === 0) {\n    return {\n      success: false,\n      error: 'Lyrics array is required with timing information',\n    };\n  }\n\n  const composition = videoCompositions.get(compositionId);\n  if (!composition) {\n    return {\n      success: false,\n      error: `Composition not found: ${compositionId}`,\n    };\n  }\n\n  // Set audio\n  composition.audio = {\n    src: audioSrc,\n    volume: 1,\n  };\n\n  // Add lyrics layer\n  const layerId = `lyrics-${Date.now()}`;\n  const maxEndTime = Math.max(...lyrics.map((l) => l.endTime));\n  const durationInFrames = Math.ceil(maxEndTime * composition.fps);\n\n  // Update composition duration if lyrics are longer\n  if (durationInFrames > composition.durationInFrames) {\n    composition.durationInFrames = durationInFrames;\n  }\n\n  const layer = {\n    id: layerId,\n    type: 'lyrics',\n    lyrics,\n    audioSrc,\n    style,\n    fontFamily,\n    fontSize: 48,\n    color,\n    highlightColor,\n    position,\n    startFrame: 0,\n    durationInFrames: composition.durationInFrames,\n    zIndex: composition.layers.length + 1,\n  };\n\n  composition.layers.push(layer);\n  composition.updatedAt = Date.now();\n\n  return {\n    success: true,\n    data: {\n      layerId,\n      compositionId,\n      lyricCount: lyrics.length,\n      style,\n      audioSrc,\n      totalDuration: maxEndTime,\n      message: `Added ${lyrics.length} lyric lines with ${style} style. Total duration: ${maxEndTime.toFixed(1)}s`,\n    },\n    action: {\n      type: 'video_lyrics_added',\n      payload: {\n        compositionId,\n        layerId,\n        lyricCount: lyrics.length,\n        style,\n        previewLyrics: lyrics.slice(0, 3).map((l) => l.text),\n      },\n    },\n  };\n}\n\nfunction executeAddMediaToVideo(args: Record<string, unknown>): ToolResult {\n  const compositionId = args.compositionId as string;\n  const mediaSrc = args.mediaSrc as string;\n  const mediaType = args.mediaType as 'image' | 'video';\n  const startTime = (args.startTime as number) || 0;\n  const duration = args.duration as number | undefined;\n  const position = (args.position as { x: number; y: number }) || { x: 0, y: 0 };\n  const scale = (args.scale as number) || 1;\n  const opacity = (args.opacity as number) ?? 1;\n  const objectFit = (args.objectFit as string) || 'cover';\n\n  if (!compositionId) {\n    return {\n      success: false,\n      error: 'Composition ID is required',\n    };\n  }\n\n  if (!mediaSrc) {\n    return {\n      success: false,\n      error: 'Media source is required',\n    };\n  }\n\n  const composition = videoCompositions.get(compositionId);\n  if (!composition) {\n    return {\n      success: false,\n      error: `Composition not found: ${compositionId}`,\n    };\n  }\n\n  const layerId = `${mediaType}-${Date.now()}-${Math.random().toString(36).slice(2, 6)}`;\n  const startFrame = Math.floor(startTime * composition.fps);\n  const durationInFrames = duration\n    ? Math.floor(duration * composition.fps)\n    : composition.durationInFrames - startFrame;\n\n  const layer = {\n    id: layerId,\n    type: mediaType,\n    src: mediaSrc,\n    position,\n    startFrame,\n    durationInFrames,\n    scale: { x: scale, y: scale },\n    opacity,\n    objectFit,\n    zIndex: composition.layers.length + 1,\n  };\n\n  composition.layers.push(layer);\n  composition.updatedAt = Date.now();\n\n  return {\n    success: true,\n    data: {\n      layerId,\n      compositionId,\n      mediaType,\n      mediaSrc,\n      startTime,\n      duration: durationInFrames / composition.fps,\n      message: `Added ${mediaType} layer from ${mediaSrc.split('/').pop() || mediaSrc}`,\n    },\n    action: {\n      type: 'video_layer_added',\n      payload: {\n        compositionId,\n        layerId,\n        layerType: mediaType,\n        mediaSrc,\n      },\n    },\n  };\n}\n\nfunction executePreviewVideo(args: Record<string, unknown>): ToolResult {\n  const compositionId = args.compositionId as string;\n  const openInCanvas = (args.openInCanvas as boolean) || false;\n\n  if (!compositionId) {\n    return {\n      success: false,\n      error: 'Composition ID is required',\n    };\n  }\n\n  const composition = videoCompositions.get(compositionId);\n  if (!composition) {\n    return {\n      success: false,\n      error: `Composition not found: ${compositionId}`,\n    };\n  }\n\n  return {\n    success: true,\n    data: {\n      compositionId,\n      composition: {\n        name: composition.name,\n        type: composition.type,\n        width: composition.width,\n        height: composition.height,\n        fps: composition.fps,\n        durationInFrames: composition.durationInFrames,\n        durationSeconds: composition.durationInFrames / composition.fps,\n        layerCount: composition.layers.length,\n        layers: composition.layers.map((l) => ({\n          id: l.id,\n          type: l.type,\n        })),\n        hasAudio: !!composition.audio,\n      },\n      openInCanvas,\n      message: `Preview ready for \"${composition.name}\" - ${composition.layers.length} layers, ${(composition.durationInFrames / composition.fps).toFixed(1)}s`,\n    },\n    action: {\n      type: 'video_preview_ready',\n      payload: {\n        compositionId,\n        composition,\n        openInCanvas,\n      },\n    },\n  };\n}\n\nasync function executeRenderVideo(args: Record<string, unknown>): Promise<ToolResult> {\n  const compositionId = args.compositionId as string;\n  const format = (args.format as string) || 'mp4';\n  const quality = (args.quality as string) || 'standard';\n  const mode = (args.mode as string) || 'sandbox'; // Default to sandbox (free)\n\n  if (!compositionId) {\n    return {\n      success: false,\n      error: 'Composition ID is required',\n    };\n  }\n\n  const composition = videoCompositions.get(compositionId);\n  if (!composition) {\n    return {\n      success: false,\n      error: `Composition not found: ${compositionId}`,\n    };\n  }\n\n  const durationSeconds = composition.durationInFrames / composition.fps;\n\n  // Sandbox mode - render locally using ffmpeg.wasm\n  if (mode === 'sandbox') {\n    // Check if composition is too long for sandbox rendering\n    if (durationSeconds > 60) {\n      return {\n        success: false,\n        error: `Composition is ${Math.round(durationSeconds)}s long. Sandbox mode supports up to 60s. Use mode=\"server\" for longer videos.`,\n      };\n    }\n\n    return {\n      success: true,\n      data: {\n        renderMode: 'sandbox',\n        compositionId,\n        compositionName: composition.name,\n        format,\n        quality,\n        durationSeconds,\n        composition: {\n          ...composition,\n          layers: composition.layers.map((l) => ({ id: l.id, type: l.type })),\n        },\n        instructions: [\n          '1. Capture frames from the composition using Remotion player',\n          '2. Pass frames to renderInSandbox() from sandbox-renderer',\n          '3. ffmpeg.wasm will encode the video locally',\n          '4. Download the result - no cloud costs!',\n        ],\n        message: `Ready to render \"${composition.name}\" locally (${format}, ${quality}). Sandbox mode uses ffmpeg.wasm - completely free, no cloud needed.`,\n        note: 'Rendering happens in your browser/sandbox. For videos over 60s, use mode=\"server\".',\n      },\n      action: {\n        type: 'video_render_started',\n        payload: {\n          renderMode: 'sandbox',\n          compositionId,\n          compositionName: composition.name,\n          format,\n          quality,\n          status: 'ready_to_render',\n          localRender: true,\n        },\n      },\n    };\n  }\n\n  // Server mode - use cloud rendering\n  try {\n    const response = await fetch('/api/video/render', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        compositionId,\n        compositionName: composition.name,\n        compositionData: {\n          width: composition.width,\n          height: composition.height,\n          fps: composition.fps,\n          durationInFrames: composition.durationInFrames,\n          props: {\n            compositionType: composition.type === 'lyric-video' ? 'lyric' :\n              composition.type === 'text-overlay' ? 'text-overlay' : 'base',\n            compositionProps: composition,\n          },\n        },\n        format,\n        quality,\n      }),\n    });\n\n    const result = await response.json();\n\n    if (!result.success) {\n      return {\n        success: false,\n        error: result.error || 'Failed to start render',\n      };\n    }\n\n    const estimatedDuration = Math.ceil(durationSeconds) * 2;\n\n    return {\n      success: true,\n      data: {\n        renderMode: 'server',\n        jobId: result.job.id,\n        compositionId,\n        status: result.job.status,\n        format,\n        quality,\n        estimatedDuration,\n        message: `Server render started for \"${composition.name}\" (${format}, ${quality}). Job ID: ${result.job.id}. Use get_render_status to check progress.`,\n      },\n      action: {\n        type: 'video_render_started',\n        payload: {\n          renderMode: 'server',\n          jobId: result.job.id,\n          compositionId,\n          compositionName: composition.name,\n          format,\n          quality,\n          status: result.job.status,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to start render',\n    };\n  }\n}\n\nasync function executeSyncLyricsToAudio(args: Record<string, unknown>): Promise<ToolResult> {\n  const audioSrc = args.audioSrc as string;\n  const lyricsText = args.lyrics as string;\n  const language = args.language as string | undefined;\n\n  if (!audioSrc) {\n    return {\n      success: false,\n      error: 'Audio source is required',\n    };\n  }\n\n  if (!lyricsText) {\n    return {\n      success: false,\n      error: 'Lyrics text is required',\n    };\n  }\n\n  try {\n    // Parse lyrics into lines\n    const lyricLines = lyricsText\n      .split('\\n')\n      .map((line) => line.trim())\n      .filter((line) => line.length > 0);\n\n    if (lyricLines.length === 0) {\n      return {\n        success: false,\n        error: 'No valid lyric lines found',\n      };\n    }\n\n    // Call Whisper API for transcription with timestamps\n    const formData = new FormData();\n\n    // If audioSrc is a URL, fetch and convert to blob\n    let audioBlob: Blob;\n    if (audioSrc.startsWith('http')) {\n      const audioResponse = await fetch(audioSrc);\n      audioBlob = await audioResponse.blob();\n    } else {\n      // Assume it's a base64 data URL or local path\n      return {\n        success: false,\n        error: 'Audio must be provided as a URL. Upload the audio file first.',\n      };\n    }\n\n    formData.append('file', audioBlob, 'audio.mp3');\n    formData.append('model', 'whisper-1');\n    formData.append('response_format', 'verbose_json');\n    formData.append('timestamp_granularities[]', 'word');\n    if (language) {\n      formData.append('language', language);\n    }\n\n    const whisperResponse = await fetch('/api/whisper', {\n      method: 'POST',\n      body: formData,\n    });\n\n    if (!whisperResponse.ok) {\n      // Fallback: estimate timing based on audio duration assumption\n      const estimatedDuration = lyricLines.length * 4; // Assume ~4 seconds per line\n      const syncedLyrics = lyricLines.map((text, index) => ({\n        text,\n        startTime: index * (estimatedDuration / lyricLines.length),\n        endTime: (index + 1) * (estimatedDuration / lyricLines.length),\n      }));\n\n      return {\n        success: true,\n        data: {\n          lyrics: syncedLyrics,\n          lyricCount: syncedLyrics.length,\n          method: 'estimated',\n          message: `Estimated timing for ${syncedLyrics.length} lines (Whisper unavailable). Consider providing manual timestamps for better sync.`,\n        },\n        action: {\n          type: 'lyrics_synced',\n          payload: {\n            lyricCount: syncedLyrics.length,\n            method: 'estimated',\n            previewLyrics: syncedLyrics.slice(0, 3),\n          },\n        },\n      };\n    }\n\n    const whisperResult = await whisperResponse.json();\n\n    // Match transcribed words to lyric lines\n    const words = whisperResult.words || [];\n    const syncedLyrics = matchLyricsToWords(lyricLines, words);\n\n    return {\n      success: true,\n      data: {\n        lyrics: syncedLyrics,\n        lyricCount: syncedLyrics.length,\n        method: 'whisper',\n        totalDuration: syncedLyrics.length > 0 ? syncedLyrics[syncedLyrics.length - 1].endTime : 0,\n        message: `Synced ${syncedLyrics.length} lyric lines using Whisper AI. Ready for add_lyrics_to_video.`,\n      },\n      action: {\n        type: 'lyrics_synced',\n        payload: {\n          lyricCount: syncedLyrics.length,\n          method: 'whisper',\n          previewLyrics: syncedLyrics.slice(0, 3),\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to sync lyrics',\n    };\n  }\n}\n\n/**\n * Match lyric lines to Whisper word timestamps using fuzzy matching\n */\nfunction matchLyricsToWords(\n  lyricLines: string[],\n  words: Array<{ word: string; start: number; end: number }>\n): Array<{ text: string; startTime: number; endTime: number }> {\n  if (words.length === 0) {\n    // Fallback to estimated timing\n    const estimatedDuration = lyricLines.length * 4;\n    return lyricLines.map((text, index) => ({\n      text,\n      startTime: index * (estimatedDuration / lyricLines.length),\n      endTime: (index + 1) * (estimatedDuration / lyricLines.length),\n    }));\n  }\n\n  const result: Array<{ text: string; startTime: number; endTime: number }> = [];\n  let wordIndex = 0;\n\n  for (const line of lyricLines) {\n    const lineWords = line.toLowerCase().split(/\\s+/).filter(Boolean);\n    const startWord = words[wordIndex];\n\n    if (!startWord) {\n      // No more words, estimate remaining\n      const lastEnd = result.length > 0 ? result[result.length - 1].endTime : 0;\n      result.push({\n        text: line,\n        startTime: lastEnd,\n        endTime: lastEnd + 3,\n      });\n      continue;\n    }\n\n    const startTime = startWord.start;\n\n    // Find matching words for this line\n    let matchedWords = 0;\n    let endTime = startWord.end;\n\n    while (wordIndex < words.length && matchedWords < lineWords.length) {\n      endTime = words[wordIndex].end;\n      wordIndex++;\n      matchedWords++;\n    }\n\n    result.push({\n      text: line,\n      startTime,\n      endTime,\n    });\n  }\n\n  return result;\n}\n\nasync function executeGetRenderStatus(args: Record<string, unknown>): Promise<ToolResult> {\n  const jobId = args.jobId as string;\n\n  if (!jobId) {\n    return {\n      success: false,\n      error: 'Job ID is required',\n    };\n  }\n\n  try {\n    const response = await fetch(`/api/video/render?jobId=${encodeURIComponent(jobId)}`);\n    const result = await response.json();\n\n    if (!result.success) {\n      return {\n        success: false,\n        error: result.error || 'Failed to get render status',\n      };\n    }\n\n    const job = result.job;\n\n    return {\n      success: true,\n      data: {\n        jobId: job.id,\n        status: job.status,\n        progress: job.progress,\n        outputUrl: job.outputUrl,\n        error: job.error,\n        durationMs: job.durationMs,\n        message: job.status === 'completed'\n          ? `Render complete! Download: ${job.outputUrl}`\n          : job.status === 'failed'\n            ? `Render failed: ${job.error}`\n            : `Rendering: ${job.progress}% complete`,\n      },\n      action: {\n        type: job.status === 'completed' ? 'video_render_complete' : 'video_render_status',\n        payload: {\n          jobId: job.id,\n          status: job.status,\n          progress: job.progress,\n          outputUrl: job.outputUrl,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to get render status',\n    };\n  }\n}\n\n// --------------------------------------------------------------------------\n// Talking Video Tools\n// --------------------------------------------------------------------------\n\n/**\n * Create a talking head video with AI-generated script, voice, and lip sync\n */\nasync function executeCreateTalkingVideo(args: Record<string, unknown>): Promise<ToolResult> {\n  const topic = args.topic as string;\n  const sourcePhotoUrl = args.sourcePhotoUrl as string;\n  const sceneStyle = args.sceneStyle as string || 'podcast_studio';\n  const customScenePrompt = args.customScenePrompt as string | undefined;\n  const duration = args.duration as number || 90;\n  const tone = args.tone as string || 'professional';\n\n  if (!topic) {\n    return {\n      success: false,\n      error: 'Topic is required',\n    };\n  }\n\n  if (!sourcePhotoUrl) {\n    return {\n      success: false,\n      error: 'Source photo URL is required',\n    };\n  }\n\n  try {\n    const response = await fetch('/api/talking-video', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        action: 'run_workflow',\n        topic,\n        sourcePhotoUrl,\n        sceneStyle,\n        customScenePrompt,\n        duration,\n        tone,\n      }),\n    });\n\n    const result = await response.json();\n\n    if (result.error) {\n      return {\n        success: false,\n        error: result.error,\n        action: {\n          type: 'talking_video_error',\n          payload: { error: result.error },\n        },\n      };\n    }\n\n    return {\n      success: true,\n      data: {\n        projectId: result.projectId,\n        status: result.status,\n        script: result.script,\n        audioUrl: result.audioUrl,\n        backgroundVideoUrl: result.backgroundVideoUrl,\n        finalVideoUrl: result.finalVideoUrl,\n        message: result.finalVideoUrl\n          ? `Talking video created successfully! Watch it here: ${result.finalVideoUrl}`\n          : 'Video creation started...',\n      },\n      action: {\n        type: 'talking_video_complete',\n        payload: {\n          projectId: result.projectId,\n          finalVideoUrl: result.finalVideoUrl,\n          script: result.script,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to create talking video',\n    };\n  }\n}\n\n/**\n * Generate just the script for a talking video\n */\nasync function executeGenerateVideoScript(args: Record<string, unknown>): Promise<ToolResult> {\n  const topic = args.topic as string;\n  const duration = args.duration as number || 90;\n  const tone = args.tone as string || 'professional';\n  const style = args.style as string || 'monologue';\n\n  if (!topic) {\n    return {\n      success: false,\n      error: 'Topic is required',\n    };\n  }\n\n  try {\n    const response = await fetch('/api/talking-video', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        action: 'generate_script',\n        topic,\n        duration,\n        tone,\n        style,\n      }),\n    });\n\n    const result = await response.json();\n\n    if (result.error) {\n      return {\n        success: false,\n        error: result.error,\n      };\n    }\n\n    return {\n      success: true,\n      data: {\n        script: result.script,\n        estimatedDuration: result.estimatedDuration,\n        wordCount: result.wordCount,\n        message: `Generated a ${result.estimatedDuration}-second script (${result.wordCount} words)`,\n      },\n      action: {\n        type: 'talking_video_script_generated',\n        payload: {\n          script: result.script,\n          estimatedDuration: result.estimatedDuration,\n          wordCount: result.wordCount,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to generate script',\n    };\n  }\n}\n\n/**\n * Generate voice audio from text using ElevenLabs\n */\nasync function executeGenerateVoiceAudio(args: Record<string, unknown>): Promise<ToolResult> {\n  const text = args.text as string;\n  const voiceId = args.voiceId as string | undefined;\n  const stability = args.stability as number | undefined;\n  const similarityBoost = args.similarityBoost as number | undefined;\n\n  if (!text) {\n    return {\n      success: false,\n      error: 'Text is required',\n    };\n  }\n\n  // Note: This would call the ElevenLabs API directly in production\n  // For now, we return a placeholder that the frontend can handle\n  return {\n    success: true,\n    data: {\n      text,\n      voiceId,\n      stability,\n      similarityBoost,\n      message: 'Voice generation queued. The audio will be generated using your cloned voice.',\n    },\n    action: {\n      type: 'talking_video_voice_generated',\n      payload: {\n        text,\n        voiceId,\n        stability,\n        similarityBoost,\n        apiCall: 'elevenlabs/text-to-speech',\n      },\n    },\n  };\n}\n\n/**\n * Navigate to the video studio page\n */\nfunction executeNavigateToVideoStudio(args: Record<string, unknown>): ToolResult {\n  const prefillTopic = args.prefillTopic as string | undefined;\n\n  let url = '/video';\n  if (prefillTopic) {\n    url += `?topic=${encodeURIComponent(prefillTopic)}`;\n  }\n\n  return {\n    success: true,\n    data: {\n      url,\n      prefillTopic,\n      message: 'Opening the video studio...',\n    },\n    action: {\n      type: 'navigate',\n      payload: {\n        url,\n        destination: 'video',\n        prefillTopic,\n      },\n    },\n  };\n}\n\n// =============================================================================\n// LTX-2 Video Generation Tools\n// =============================================================================\n\n/**\n * Generate a video from a text prompt using LTX-2\n */\nasync function executeGenerateVideo(args: Record<string, unknown>): Promise<ToolResult> {\n  const prompt = args.prompt as string;\n  const negative_prompt = args.negative_prompt as string | undefined;\n  const preset = args.preset as string | undefined;\n  const duration_seconds = args.duration_seconds as number | undefined;\n  const seed = args.seed as number | undefined;\n\n  if (!prompt) {\n    return {\n      success: false,\n      error: 'Prompt is required for video generation',\n    };\n  }\n\n  if (!isLTXConfigured()) {\n    return {\n      success: false,\n      error: 'Video generation is not configured. FAL_KEY environment variable is missing.',\n    };\n  }\n\n  try {\n    let result;\n\n    if (preset && LTX_PRESETS[preset as keyof typeof LTX_PRESETS]) {\n      // Use preset\n      result = await generateVideoWithPreset(prompt, preset as keyof typeof LTX_PRESETS, {\n        negative_prompt,\n        seed,\n      });\n    } else {\n      // Use custom settings\n      const num_frames = duration_seconds ? getFrameCountForDuration(duration_seconds) : 97;\n      result = await generateVideoFromText({\n        prompt,\n        negative_prompt,\n        num_frames,\n        seed,\n      });\n    }\n\n    return {\n      success: true,\n      data: {\n        videoUrl: result.video.url,\n        fileName: result.video.file_name,\n        fileSize: result.video.file_size,\n        seed: result.seed,\n        message: `Video generated successfully! Here's your video: ${result.video.url}`,\n      },\n      action: {\n        type: 'video_generated',\n        payload: {\n          videoUrl: result.video.url,\n          fileName: result.video.file_name,\n          prompt,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: `Failed to generate video: ${error instanceof Error ? error.message : 'Unknown error'}`,\n    };\n  }\n}\n\n/**\n * Animate an image into a video using LTX-2 image-to-video\n */\nasync function executeAnimateImage(args: Record<string, unknown>): Promise<ToolResult> {\n  const image_url = args.image_url as string;\n  const prompt = args.prompt as string;\n  const negative_prompt = args.negative_prompt as string | undefined;\n  const duration_seconds = args.duration_seconds as number | undefined;\n  const seed = args.seed as number | undefined;\n\n  if (!image_url) {\n    return {\n      success: false,\n      error: 'Image URL is required for animation',\n    };\n  }\n\n  if (!prompt) {\n    return {\n      success: false,\n      error: 'Prompt describing the motion is required',\n    };\n  }\n\n  if (!isLTXConfigured()) {\n    return {\n      success: false,\n      error: 'Video generation is not configured. FAL_KEY environment variable is missing.',\n    };\n  }\n\n  try {\n    const num_frames = duration_seconds ? getFrameCountForDuration(duration_seconds) : 97;\n\n    const result = await generateVideoFromImage({\n      image_url,\n      prompt,\n      negative_prompt,\n      num_frames,\n      seed,\n    });\n\n    return {\n      success: true,\n      data: {\n        videoUrl: result.video.url,\n        fileName: result.video.file_name,\n        fileSize: result.video.file_size,\n        seed: result.seed,\n        message: `Image animated successfully! Here's your video: ${result.video.url}`,\n      },\n      action: {\n        type: 'image_animated',\n        payload: {\n          videoUrl: result.video.url,\n          fileName: result.video.file_name,\n          originalImage: image_url,\n          prompt,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: `Failed to animate image: ${error instanceof Error ? error.message : 'Unknown error'}`,\n    };\n  }\n}\n\n/**\n * List available video generation presets\n */\nfunction executeListVideoPresets(): ToolResult {\n  const presets = Object.entries(LTX_PRESETS).map(([key, preset]) => ({\n    id: key,\n    name: preset.name,\n    description: preset.description,\n    width: preset.width,\n    height: preset.height,\n    frames: preset.num_frames,\n    approximateDuration: `~${Math.round(preset.num_frames / 24)} seconds`,\n  }));\n\n  return {\n    success: true,\n    data: {\n      presets,\n      message: 'Available video generation presets:',\n    },\n  };\n}\n\n// =============================================================================\n// AI Provider Tools (Phase 3 Local LLM Integration)\n// =============================================================================\n\n/**\n * Get the current AI provider status and configuration\n * This tool helps users understand which AI backend is being used\n */\nfunction executeGetAIProviderStatus(args: Record<string, unknown>): ToolResult {\n  const includeLatency = args.includeLatency as boolean | undefined;\n\n  // Note: The actual provider status comes from the chat route's response metadata\n  // This tool returns an action that the frontend can use to fetch/display detailed status\n  return {\n    success: true,\n    data: {\n      message: 'Checking AI provider status...',\n      note: 'The current provider information is included in each chat response. Check the response metadata for provider, providerModel, and fallbackUsed fields.',\n      settingsUrl: '/settings/ai',\n    },\n    action: {\n      type: 'check_provider_status',\n      payload: {\n        includeLatency: includeLatency ?? false,\n        healthEndpoint: '/api/health/providers',\n        settingsUrl: '/settings/ai',\n      },\n    },\n  };\n}\n\n/**\n * Navigate to AI settings page\n */\nfunction executeNavigateToAISettings(): ToolResult {\n  return {\n    success: true,\n    data: {\n      url: '/settings/ai',\n      message: 'Opening AI provider settings...',\n    },\n    action: {\n      type: 'navigate',\n      payload: {\n        url: '/settings/ai',\n        destination: 'settings',\n      },\n    },\n  };\n}\n// ============================================================================\n// KANBAN TASK READING TOOLS - Read and understand tasks\n// ============================================================================\n\n/**\n * Get a specific Kanban task by ID\n */\nasync function executeGetKanbanTask(args: Record<string, unknown>): Promise<ToolResult> {\n  const taskId = args.taskId as string;\n\n  if (!taskId) {\n    return {\n      success: false,\n      error: 'Task ID is required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    const task = await client.query(api.kanban.getTaskById, {\n      taskId,\n    });\n\n    if (!task) {\n      return {\n        success: false,\n        error: `Task not found: ${taskId}`,\n      };\n    }\n\n    return {\n      success: true,\n      data: {\n        task: {\n          id: task.id,\n          title: task.title,\n          description: task.description,\n          priority: task.priority,\n          status: task.status,\n          tags: task.tags,\n          createdAt: task.createdAt,\n          updatedAt: task.updatedAt,\n        },\n        message: `Found task \"${task.title}\" (${task.status})`,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to get task',\n    };\n  }\n}\n\n/**\n * Search Kanban tasks by keyword\n */\nasync function executeSearchKanbanTasks(args: Record<string, unknown>): Promise<ToolResult> {\n  const query = args.query as string;\n  const status = args.status as string | undefined;\n\n  if (!query) {\n    return {\n      success: false,\n      error: 'Search query is required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    const tasks = await client.query(api.kanban.searchTasks, {\n      query,\n      status: status as 'backlog' | 'todo' | 'in-progress' | 'review' | 'done' | undefined,\n    });\n\n    return {\n      success: true,\n      data: {\n        tasks: tasks.map((t) => ({\n          id: t.id,\n          title: t.title,\n          status: t.status,\n          priority: t.priority,\n          tags: t.tags,\n        })),\n        count: tasks.length,\n        message: `Found ${tasks.length} task${tasks.length !== 1 ? 's' : ''} matching \"${query}\"`,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to search tasks',\n    };\n  }\n}\n\n// ============================================================================\n// DESIGN CANVAS TOOLS - Infinite canvas for visual composition\n// ============================================================================\n\n/**\n * Create a new design canvas\n */\nasync function executeCreateCanvas(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const name = args.name as string;\n  const canvasType = (args.canvasType as string) || 'freeform';\n  const description = args.description as string | undefined;\n  const backgroundColor = (args.backgroundColor as string) || '#1a1a2e';\n  const gridEnabled = args.gridEnabled !== false;\n\n  if (!name) {\n    return {\n      success: false,\n      error: 'Canvas name is required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const userId = getEffectiveUserId(context);\n    const client = new ConvexHttpClient(convexUrl);\n\n    const canvasId = await client.mutation(api.designCanvas.createCanvas, {\n      name,\n      description,\n      ownerId: userId,\n      canvasType: canvasType as 'freeform' | 'wireframe' | 'moodboard' | 'storyboard' | 'mindmap' | 'flowchart',\n      backgroundColor,\n      gridEnabled,\n      gridSize: 20,\n    });\n\n    return {\n      success: true,\n      data: {\n        canvasId,\n        name,\n        canvasType,\n        backgroundColor,\n        message: `Created canvas \"${name}\" (${canvasType})`,\n      },\n      action: {\n        type: 'canvas_created',\n        payload: {\n          canvasId,\n          name,\n          canvasType,\n          url: `/canvas/${canvasId}`,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to create canvas',\n    };\n  }\n}\n\n/**\n * List all design canvases\n */\nasync function executeListCanvases(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const status = args.status as string | undefined;\n  const limit = (args.limit as number) || 20;\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const userId = getEffectiveUserId(context);\n    const client = new ConvexHttpClient(convexUrl);\n\n    const canvases = await client.query(api.designCanvas.getUserCanvases, {\n      ownerId: userId,\n      status: status as 'active' | 'archived' | 'template' | undefined,\n    });\n\n    const limitedCanvases = canvases.slice(0, limit);\n\n    return {\n      success: true,\n      data: {\n        canvases: limitedCanvases.map((c) => ({\n          id: c._id,\n          name: c.name,\n          type: c.canvasType,\n          status: c.status,\n          createdAt: new Date(c.createdAt).toISOString(),\n          updatedAt: new Date(c.updatedAt).toISOString(),\n        })),\n        count: limitedCanvases.length,\n        totalCount: canvases.length,\n        message: `Found ${canvases.length} canvas${canvases.length !== 1 ? 'es' : ''}`,\n      },\n      action: {\n        type: 'canvases_listed',\n        payload: {\n          count: limitedCanvases.length,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to list canvases',\n    };\n  }\n}\n\n/**\n * Get a specific canvas with its nodes and edges\n */\nasync function executeGetCanvas(args: Record<string, unknown>): Promise<ToolResult> {\n  const canvasId = args.canvasId as string;\n\n  if (!canvasId) {\n    return {\n      success: false,\n      error: 'Canvas ID is required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    const canvas = await client.query(api.designCanvas.getCanvas, {\n      canvasId: canvasId as Id<'designCanvases'>,\n    });\n\n    if (!canvas) {\n      return {\n        success: false,\n        error: `Canvas not found: ${canvasId}`,\n      };\n    }\n\n    const nodes = await client.query(api.designCanvas.getCanvasNodes, {\n      canvasId: canvasId as Id<'designCanvases'>,\n    });\n\n    const edges = await client.query(api.designCanvas.getCanvasEdges, {\n      canvasId: canvasId as Id<'designCanvases'>,\n    });\n\n    return {\n      success: true,\n      data: {\n        canvas: {\n          id: canvas._id,\n          name: canvas.name,\n          type: canvas.canvasType,\n          status: canvas.status,\n          backgroundColor: canvas.backgroundColor,\n        },\n        nodes: nodes.map((n) => ({\n          nodeId: n.nodeId,\n          type: n.nodeType,\n          x: n.x,\n          y: n.y,\n          width: n.width,\n          height: n.height,\n          content: n.content,\n        })),\n        edges: edges.map((e) => ({\n          edgeId: e.edgeId,\n          type: e.edgeType,\n          source: e.sourceNodeId,\n          target: e.targetNodeId,\n          label: e.label,\n        })),\n        nodeCount: nodes.length,\n        edgeCount: edges.length,\n        message: `Canvas \"${canvas.name}\" has ${nodes.length} nodes and ${edges.length} edges`,\n      },\n      action: {\n        type: 'canvas_retrieved',\n        payload: {\n          canvasId: canvas._id,\n          name: canvas.name,\n          nodeCount: nodes.length,\n          edgeCount: edges.length,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to get canvas',\n    };\n  }\n}\n\n/**\n * Add a node to a canvas\n */\nasync function executeAddCanvasNode(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const canvasId = args.canvasId as string;\n  const nodeType = args.nodeType as string;\n  const x = (args.x as number) || 0;\n  const y = (args.y as number) || 0;\n  const content = args.content as string;\n  const width = (args.width as number) || getDefaultWidth(nodeType);\n  const height = (args.height as number) || getDefaultHeight(nodeType);\n  const style = args.style as string | undefined;\n\n  if (!canvasId || !nodeType || content === undefined) {\n    return {\n      success: false,\n      error: 'Canvas ID, node type, and content are required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const userId = getEffectiveUserId(context);\n    const client = new ConvexHttpClient(convexUrl);\n\n    // Generate a unique node ID\n    const nodeId = `node_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n\n    await client.mutation(api.designCanvas.addNode, {\n      canvasId: canvasId as Id<'designCanvases'>,\n      nodeId,\n      nodeType: nodeType as 'text' | 'image' | 'shape' | 'sticky' | 'frame' | 'code' | 'embed' | 'audio' | 'video' | 'link',\n      x,\n      y,\n      width,\n      height,\n      content,\n      style,\n      createdBy: userId,\n    });\n\n    return {\n      success: true,\n      data: {\n        nodeId,\n        nodeType,\n        x,\n        y,\n        width,\n        height,\n        content: content.length > 50 ? content.slice(0, 50) + '...' : content,\n        message: `Added ${nodeType} node at (${x}, ${y})`,\n      },\n      action: {\n        type: 'canvas_node_added',\n        payload: {\n          canvasId,\n          nodeId,\n          nodeType,\n          x,\n          y,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to add canvas node',\n    };\n  }\n}\n\n/**\n * Get default width for node type\n */\nfunction getDefaultWidth(nodeType: string): number {\n  switch (nodeType) {\n    case 'text':\n      return 200;\n    case 'sticky':\n      return 200;\n    case 'shape':\n      return 100;\n    case 'image':\n      return 300;\n    case 'code':\n      return 400;\n    case 'frame':\n      return 400;\n    default:\n      return 150;\n  }\n}\n\n/**\n * Get default height for node type\n */\nfunction getDefaultHeight(nodeType: string): number {\n  switch (nodeType) {\n    case 'text':\n      return 50;\n    case 'sticky':\n      return 200;\n    case 'shape':\n      return 100;\n    case 'image':\n      return 200;\n    case 'code':\n      return 300;\n    case 'frame':\n      return 300;\n    default:\n      return 100;\n  }\n}\n\n/**\n * Add an edge between nodes on a canvas\n */\nasync function executeAddCanvasEdge(args: Record<string, unknown>): Promise<ToolResult> {\n  const canvasId = args.canvasId as string;\n  const sourceNodeId = args.sourceNodeId as string;\n  const targetNodeId = args.targetNodeId as string;\n  const edgeType = (args.edgeType as string) || 'arrow';\n  const label = args.label as string | undefined;\n  const style = args.style as string | undefined;\n\n  if (!canvasId || !sourceNodeId || !targetNodeId) {\n    return {\n      success: false,\n      error: 'Canvas ID, source node ID, and target node ID are required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    // Generate a unique edge ID\n    const edgeId = `edge_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n\n    await client.mutation(api.designCanvas.addEdge, {\n      canvasId: canvasId as Id<'designCanvases'>,\n      edgeId,\n      sourceNodeId,\n      targetNodeId,\n      edgeType: edgeType as 'straight' | 'curved' | 'step' | 'arrow',\n      label,\n      style,\n    });\n\n    return {\n      success: true,\n      data: {\n        edgeId,\n        edgeType,\n        source: sourceNodeId,\n        target: targetNodeId,\n        label,\n        message: `Connected ${sourceNodeId}  ${targetNodeId}${label ? ` (${label})` : ''}`,\n      },\n      action: {\n        type: 'canvas_edge_added',\n        payload: {\n          canvasId,\n          edgeId,\n          source: sourceNodeId,\n          target: targetNodeId,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to add canvas edge',\n    };\n  }\n}\n\n/**\n * Update an existing canvas node\n */\nasync function executeUpdateCanvasNode(args: Record<string, unknown>): Promise<ToolResult> {\n  const canvasId = args.canvasId as string;\n  const nodeId = args.nodeId as string;\n  const x = args.x as number | undefined;\n  const y = args.y as number | undefined;\n  const width = args.width as number | undefined;\n  const height = args.height as number | undefined;\n  const content = args.content as string | undefined;\n  const style = args.style as string | undefined;\n\n  if (!canvasId || !nodeId) {\n    return {\n      success: false,\n      error: 'Canvas ID and node ID are required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    await client.mutation(api.designCanvas.updateNode, {\n      canvasId: canvasId as Id<'designCanvases'>,\n      nodeId,\n      x,\n      y,\n      width,\n      height,\n      content,\n      style,\n    });\n\n    const updates = [];\n    if (x !== undefined || y !== undefined) updates.push(`position (${x ?? '?'}, ${y ?? '?'})`);\n    if (width !== undefined || height !== undefined) updates.push(`size (${width ?? '?'}x${height ?? '?'})`);\n    if (content !== undefined) updates.push('content');\n    if (style !== undefined) updates.push('style');\n\n    return {\n      success: true,\n      data: {\n        nodeId,\n        updated: updates,\n        message: `Updated node ${nodeId}: ${updates.join(', ')}`,\n      },\n      action: {\n        type: 'canvas_node_updated',\n        payload: {\n          canvasId,\n          nodeId,\n          updates,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to update canvas node',\n    };\n  }\n}\n\n// =============================================================================\n// Apple Health Tool Executors\n// =============================================================================\n\n// Type assertion helper for health API (types generated at deploy time)\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst healthApi: Record<string, any> = (api as any).health || {};\n\n/**\n * Get health summary for a specific date\n */\nasync function executeGetHealthSummary(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const userId = getEffectiveUserId(context);\n  if (!userId) {\n    return {\n      success: false,\n      error: 'Authentication required to access health data',\n    };\n  }\n\n  const date = (args.date as string) || new Date().toISOString().split('T')[0];\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    const summary = await client.query(healthApi.getDailySummary, { date });\n\n    if (!summary) {\n      return {\n        success: true,\n        data: {\n          date,\n          message: `No health data found for ${date}. Make sure you've synced your Apple Health data using the iOS Shortcut.`,\n          hasData: false,\n        },\n      };\n    }\n\n    // Format the summary for display\n    const formattedSummary = {\n      date,\n      hasData: true,\n      activity: {\n        steps: summary.steps,\n        distance: summary.distance ? `${(summary.distance / 1000).toFixed(2)} km` : undefined,\n        activeEnergy: summary.activeEnergy ? `${Math.round(summary.activeEnergy)} kcal` : undefined,\n        exerciseMinutes: summary.exerciseMinutes,\n        standHours: summary.standHours,\n        flightsClimbed: summary.flightsClimbed,\n      },\n      heart: {\n        averageHeartRate: summary.avgHeartRate ? `${Math.round(summary.avgHeartRate)} bpm` : undefined,\n        restingHeartRate: summary.restingHeartRate ? `${Math.round(summary.restingHeartRate)} bpm` : undefined,\n        heartRateVariability: summary.heartRateVariability ? `${Math.round(summary.heartRateVariability)} ms` : undefined,\n        minHeartRate: summary.minHeartRate ? `${Math.round(summary.minHeartRate)} bpm` : undefined,\n        maxHeartRate: summary.maxHeartRate ? `${Math.round(summary.maxHeartRate)} bpm` : undefined,\n      },\n      sleep: {\n        sleepHours: summary.sleepHours ? `${summary.sleepHours.toFixed(1)} hours` : undefined,\n        timeInBed: summary.timeInBed ? `${summary.timeInBed.toFixed(1)} hours` : undefined,\n      },\n      body: {\n        weight: summary.weight ? `${summary.weight.toFixed(1)} kg` : undefined,\n        bodyFat: summary.bodyFat ? `${summary.bodyFat.toFixed(1)}%` : undefined,\n      },\n      vitals: {\n        bloodOxygen: summary.bloodOxygen ? `${summary.bloodOxygen.toFixed(1)}%` : undefined,\n        respiratoryRate: summary.respiratoryRate ? `${summary.respiratoryRate.toFixed(1)} breaths/min` : undefined,\n      },\n      mindfulness: {\n        mindfulMinutes: summary.mindfulMinutes,\n      },\n      workouts: {\n        count: summary.workoutCount,\n        totalMinutes: summary.workoutMinutes ? Math.round(summary.workoutMinutes) : undefined,\n        totalCalories: summary.workoutCalories ? Math.round(summary.workoutCalories) : undefined,\n      },\n      scores: {\n        activity: summary.activityScore,\n        sleep: summary.sleepScore,\n        readiness: summary.readinessScore,\n      },\n    };\n\n    return {\n      success: true,\n      data: formattedSummary,\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to get health summary',\n    };\n  }\n}\n\n/**\n * Get health trends over time\n */\nasync function executeGetHealthTrends(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const userId = getEffectiveUserId(context);\n  if (!userId) {\n    return {\n      success: false,\n      error: 'Authentication required to access health data',\n    };\n  }\n\n  const weeks = (args.weeks as number) || 4;\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    const trends = await client.query(healthApi.getHealthTrends, { weeks });\n\n    if (!trends || trends.length === 0) {\n      return {\n        success: true,\n        data: {\n          weeks,\n          message: 'No health trend data available. Sync more data from Apple Health to see trends.',\n          hasData: false,\n        },\n      };\n    }\n\n    return {\n      success: true,\n      data: {\n        weeks,\n        hasData: true,\n        weeklyTrends: (trends as Array<{\n          week: string;\n          avgSteps: number | null;\n          avgSleep: number | null;\n          avgHeartRate: number | null;\n          avgActivityScore: number | null;\n        }>).map((week) => ({\n          week: week.week,\n          avgSteps: week.avgSteps ? Math.round(week.avgSteps) : null,\n          avgSleepHours: week.avgSleep ? week.avgSleep.toFixed(1) : null,\n          avgHeartRate: week.avgHeartRate ? Math.round(week.avgHeartRate) : null,\n          avgActivityScore: week.avgActivityScore ? Math.round(week.avgActivityScore) : null,\n        })),\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to get health trends',\n    };\n  }\n}\n\n/**\n * Get detailed data for a specific health metric\n */\nasync function executeGetHealthMetric(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const userId = getEffectiveUserId(context);\n  if (!userId) {\n    return {\n      success: false,\n      error: 'Authentication required to access health data',\n    };\n  }\n\n  const metric = args.metric as string;\n  if (!metric) {\n    return {\n      success: false,\n      error: 'Metric type is required',\n    };\n  }\n\n  const endDate = (args.endDate as string) || new Date().toISOString().split('T')[0];\n  const startDate = (args.startDate as string) ||\n    new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];\n\n  const startTimestamp = new Date(`${startDate}T00:00:00Z`).getTime();\n  const endTimestamp = new Date(`${endDate}T23:59:59.999Z`).getTime();\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    const samples = await client.query(healthApi.getSamples, {\n      sampleType: metric as 'steps' | 'heartRate' | 'sleepAnalysis' | 'weight' | 'workout',\n      startDate: startTimestamp,\n      endDate: endTimestamp,\n      limit: 100,\n    });\n\n    if (!samples || samples.length === 0) {\n      return {\n        success: true,\n        data: {\n          metric,\n          startDate,\n          endDate,\n          message: `No ${metric} data found for the specified date range.`,\n          hasData: false,\n        },\n      };\n    }\n\n    // Aggregate by date\n    const byDate: Record<string, number[]> = {};\n    for (const sample of samples) {\n      const date = new Date(sample.startDate).toISOString().split('T')[0];\n      if (!byDate[date]) {\n        byDate[date] = [];\n      }\n      byDate[date].push(sample.value);\n    }\n\n    const dailyData = Object.entries(byDate).map(([date, values]) => ({\n      date,\n      value: metric === 'steps' || metric === 'activeEnergy' || metric === 'distance'\n        ? values.reduce((a, b) => a + b, 0) // Sum for cumulative metrics\n        : values.reduce((a, b) => a + b, 0) / values.length, // Average for others\n      sampleCount: values.length,\n    })).sort((a, b) => a.date.localeCompare(b.date));\n\n    return {\n      success: true,\n      data: {\n        metric,\n        startDate,\n        endDate,\n        hasData: true,\n        totalSamples: samples.length,\n        dailyData,\n        unit: samples[0]?.unit || 'unknown',\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to get health metric data',\n    };\n  }\n}\n\n/**\n * Compare health metrics between two periods\n */\nasync function executeCompareHealthPeriods(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const userId = getEffectiveUserId(context);\n  if (!userId) {\n    return {\n      success: false,\n      error: 'Authentication required to access health data',\n    };\n  }\n\n  const period1Start = args.period1Start as string;\n  const period1End = args.period1End as string;\n  const period2Start = args.period2Start as string;\n  const period2End = args.period2End as string;\n  const metrics = (args.metrics as string[]) || ['steps', 'sleepHours', 'avgHeartRate', 'activityScore'];\n\n  if (!period1Start || !period1End || !period2Start || !period2End) {\n    return {\n      success: false,\n      error: 'All period start and end dates are required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    // Get summaries for both periods\n    const period1Summaries = await client.query(healthApi.getDailySummaries, {\n      startDate: period1Start,\n      endDate: period1End,\n    });\n\n    const period2Summaries = await client.query(healthApi.getDailySummaries, {\n      startDate: period2Start,\n      endDate: period2End,\n    });\n\n    // Calculate averages for each period\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const calcAvg = (summaries: any[], metric: string) => {\n      const values = summaries\n        .map((s: Record<string, number | null | undefined>) => s[metric])\n        .filter((v): v is number => v != null);\n      return values.length > 0 ? values.reduce((a, b) => a + b, 0) / values.length : null;\n    };\n\n    const comparison: Record<string, { period1: number | null; period2: number | null; change: string | null }> = {};\n\n    for (const metric of metrics) {\n      const p1Avg = calcAvg(period1Summaries, metric);\n      const p2Avg = calcAvg(period2Summaries, metric);\n\n      let change: string | null = null;\n      if (p1Avg != null && p2Avg != null && p1Avg !== 0) {\n        const percentChange = ((p2Avg - p1Avg) / p1Avg) * 100;\n        change = `${percentChange >= 0 ? '+' : ''}${percentChange.toFixed(1)}%`;\n      }\n\n      comparison[metric] = {\n        period1: p1Avg != null ? Math.round(p1Avg * 10) / 10 : null,\n        period2: p2Avg != null ? Math.round(p2Avg * 10) / 10 : null,\n        change,\n      };\n    }\n\n    return {\n      success: true,\n      data: {\n        period1: { start: period1Start, end: period1End, daysWithData: period1Summaries.length },\n        period2: { start: period2Start, end: period2End, daysWithData: period2Summaries.length },\n        comparison,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to compare health periods',\n    };\n  }\n}\n\n/**\n * Generate a new API key for health data syncing\n */\nasync function executeGenerateHealthApiKey(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const userId = getEffectiveUserId(context);\n  if (!userId) {\n    return {\n      success: false,\n      error: 'Authentication required to generate API key',\n    };\n  }\n\n  const name = args.name as string;\n  if (!name) {\n    return {\n      success: false,\n      error: 'API key name is required',\n    };\n  }\n\n  const expiresInDays = args.expiresInDays as number | undefined;\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    // Note: This mutation requires authentication via Clerk\n    // The webhook endpoint will use the API key for auth\n    const result = await client.mutation(healthApi.generateApiKey, {\n      name,\n      expiresInDays,\n    });\n\n    return {\n      success: true,\n      data: {\n        apiKey: result.apiKey,\n        name: result.name,\n        expiresAt: result.expiresAt ? new Date(result.expiresAt).toISOString() : 'Never',\n        message: result.message,\n        webhookUrl: 'https://openclaw.io/api/webhooks/health',\n        instructions: [\n          '1. Copy the API key above (it will not be shown again)',\n          '2. Create a new iOS Shortcut',\n          '3. Add \"Find Health Samples\" actions for the data you want to sync',\n          '4. Add \"Get Contents of URL\" action with:',\n          '   - URL: https://openclaw.io/api/webhooks/health',\n          '   - Method: POST',\n          '   - Headers: Authorization: Bearer YOUR_API_KEY',\n          '   - Body: JSON with your health data',\n          '5. Set up automation to run the shortcut daily',\n        ],\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to generate API key',\n    };\n  }\n}\n\n/**\n * List all health API keys\n */\nasync function executeListHealthApiKeys(\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const userId = getEffectiveUserId(context);\n  if (!userId) {\n    return {\n      success: false,\n      error: 'Authentication required to list API keys',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    const keys = await client.query(healthApi.listApiKeys, {});\n\n    if (!keys || keys.length === 0) {\n      return {\n        success: true,\n        data: {\n          message: 'No API keys found. Generate one to start syncing health data.',\n          keys: [],\n        },\n      };\n    }\n\n    return {\n      success: true,\n      data: {\n        keys: (keys as Array<{\n          id: string;\n          name: string;\n          isActive: boolean;\n          isExpired: boolean;\n          lastUsedAt?: number;\n          usageCount: number;\n          createdAt: number;\n          expiresAt?: number;\n        }>).map((key) => ({\n          id: key.id,\n          name: key.name,\n          isActive: key.isActive,\n          isExpired: key.isExpired,\n          lastUsedAt: key.lastUsedAt ? new Date(key.lastUsedAt).toISOString() : 'Never',\n          usageCount: key.usageCount,\n          createdAt: new Date(key.createdAt).toISOString(),\n          expiresAt: key.expiresAt ? new Date(key.expiresAt).toISOString() : 'Never',\n        })),\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to list API keys',\n    };\n  }\n}\n\n/**\n * Revoke a health API key\n */\nasync function executeRevokeHealthApiKey(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const userId = getEffectiveUserId(context);\n  if (!userId) {\n    return {\n      success: false,\n      error: 'Authentication required to revoke API key',\n    };\n  }\n\n  const keyId = args.keyId as string;\n  if (!keyId) {\n    return {\n      success: false,\n      error: 'API key ID is required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    await client.mutation(healthApi.revokeApiKey, {\n      keyId: keyId as Id<'healthApiKeys'>,\n    });\n\n    return {\n      success: true,\n      data: {\n        message: 'API key has been revoked. It can no longer be used for syncing.',\n        keyId,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to revoke API key',\n    };\n  }\n}\n\n/**\n * Get health sync status\n */\nasync function executeGetHealthSyncStatus(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const userId = getEffectiveUserId(context);\n  if (!userId) {\n    return {\n      success: false,\n      error: 'Authentication required to check sync status',\n    };\n  }\n\n  const limit = (args.limit as number) || 5;\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    const logs = await client.query(healthApi.getSyncLogs, { limit });\n\n    if (!logs || logs.length === 0) {\n      return {\n        success: true,\n        data: {\n          message: 'No sync history found. Health data has not been synced yet.',\n          syncs: [],\n        },\n      };\n    }\n\n    type SyncLog = {\n      syncId: string;\n      status: string;\n      samplesReceived: number;\n      samplesStored: number;\n      sampleTypes: string[];\n      errors?: string[];\n      syncedAt: number;\n    };\n\n    const typedLogs = logs as SyncLog[];\n\n    return {\n      success: true,\n      data: {\n        recentSyncs: typedLogs.map((log) => ({\n          syncId: log.syncId,\n          status: log.status,\n          samplesReceived: log.samplesReceived,\n          samplesStored: log.samplesStored,\n          sampleTypes: log.sampleTypes,\n          errors: log.errors,\n          syncedAt: new Date(log.syncedAt).toISOString(),\n        })),\n        lastSync: typedLogs[0] ? {\n          status: typedLogs[0].status,\n          samplesStored: typedLogs[0].samplesStored,\n          syncedAt: new Date(typedLogs[0].syncedAt).toISOString(),\n          timeSince: formatTimeSince(typedLogs[0].syncedAt),\n        } : null,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to get sync status',\n    };\n  }\n}\n\n/**\n * Format time since a timestamp\n */\nfunction formatTimeSince(timestamp: number): string {\n  const now = Date.now();\n  const diff = now - timestamp;\n\n  const minutes = Math.floor(diff / (1000 * 60));\n  const hours = Math.floor(diff / (1000 * 60 * 60));\n  const days = Math.floor(diff / (1000 * 60 * 60 * 24));\n\n  if (days > 0) return `${days} day${days > 1 ? 's' : ''} ago`;\n  if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''} ago`;\n  if (minutes > 0) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;\n  return 'Just now';\n}\n\n// =============================================================================\n// ERV Ontology Tools - AI-Assisted Entity Classification & Relationship Suggestion\n// =============================================================================\n\n/**\n * Entity type definitions with classification hints\n */\nconst ENTITY_TYPE_SCHEMAS = {\n  Person: {\n    keywords: ['person', 'contact', 'colleague', 'friend', 'team', 'member', 'employee', 'met', 'introduced'],\n    requiredFields: [],\n    optionalFields: ['email', 'company', 'title', 'phone', 'linkedin', 'twitter', 'location', 'notes', 'relationship'],\n    defaultTags: ['contact'],\n  },\n  Project: {\n    keywords: ['project', 'app', 'website', 'repo', 'build', 'create', 'develop', 'startup', 'product', 'initiative'],\n    requiredFields: ['status', 'color'],\n    optionalFields: ['githubRepo', 'description', 'stack', 'url', 'startDate', 'endDate'],\n    defaultTags: ['project'],\n  },\n  Track: {\n    keywords: ['song', 'track', 'music', 'audio', 'beat', 'album', 'artist', 'spotify', 'soundcloud'],\n    requiredFields: ['artist', 'audioUrl', 'isPrivate'],\n    optionalFields: ['album', 'duration', 'genre', 'bpm', 'key', 'lyrics'],\n    defaultTags: ['music'],\n  },\n  Event: {\n    keywords: ['event', 'meeting', 'conference', 'deadline', 'appointment', 'call', 'reminder', 'date', 'schedule'],\n    requiredFields: ['startTime', 'endTime', 'timezone', 'isAllDay'],\n    optionalFields: ['location', 'description', 'attendees', 'recurring'],\n    defaultTags: ['calendar'],\n  },\n  Memory: {\n    keywords: ['remember', 'memory', 'note', 'thought', 'idea', 'insight', 'learned', 'decision', 'milestone'],\n    requiredFields: ['memoryType', 'content', 'importance', 'timestamp'],\n    optionalFields: ['context', 'projectId', 'emotions'],\n    defaultTags: ['memory'],\n  },\n  Ticket: {\n    keywords: ['ticket', 'task', 'bug', 'feature', 'story', 'issue', 'todo', 'fix', 'implement'],\n    requiredFields: ['ticketId', 'type', 'priority', 'status'],\n    optionalFields: ['description', 'asA', 'iWant', 'soThat', 'acceptanceCriteria', 'labels', 'epicId'],\n    defaultTags: ['task'],\n  },\n  Draft: {\n    keywords: ['draft', 'writing', 'blog', 'article', 'post', 'essay', 'document', 'content'],\n    requiredFields: [],\n    optionalFields: ['content', 'wordCount', 'status', 'publishedAt', 'category'],\n    defaultTags: ['writing'],\n  },\n  Collection: {\n    keywords: ['collection', 'list', 'group', 'folder', 'category', 'set', 'bundle'],\n    requiredFields: [],\n    optionalFields: ['description', 'entityIds', 'icon', 'color'],\n    defaultTags: ['collection'],\n  },\n  Skill: {\n    keywords: ['skill', 'ability', 'expertise', 'technology', 'tool', 'language', 'framework'],\n    requiredFields: [],\n    optionalFields: ['level', 'yearsExperience', 'category', 'endorsements'],\n    defaultTags: ['skill'],\n  },\n  Value: {\n    keywords: ['value', 'principle', 'belief', 'philosophy', 'core', 'important'],\n    requiredFields: [],\n    optionalFields: ['description', 'priority', 'examples'],\n    defaultTags: ['values'],\n  },\n} as const;\n\ntype EntityTypeName = keyof typeof ENTITY_TYPE_SCHEMAS;\n\n/**\n * Relationship type definitions with semantic hints\n */\nconst RELATIONSHIP_HINTS = {\n  collaboratedOn: ['worked with', 'built with', 'created with', 'partnered'],\n  createdBy: ['made by', 'authored by', 'developed by', 'written by'],\n  assignedTo: ['assigned', 'responsible', 'owned by', 'belongs to'],\n  belongsTo: ['part of', 'in', 'under', 'within', 'member of'],\n  contains: ['includes', 'has', 'comprises', 'holds'],\n  parentOf: ['parent', 'above', 'manages', 'oversees'],\n  mentions: ['references', 'talks about', 'cites', 'links to'],\n  relatedTo: ['related', 'connected', 'similar', 'associated'],\n  derivedFrom: ['based on', 'inspired by', 'forked from', 'evolved from'],\n  followedBy: ['then', 'next', 'after', 'succeeds'],\n  blockedBy: ['blocked', 'waiting on', 'depends on', 'requires'],\n};\n\n/**\n * Classify content into an entity type using keyword matching and heuristics\n */\nfunction classifyEntityType(\n  content: string,\n  suggestedType?: string,\n  contentType?: string\n): { entityType: EntityTypeName; confidence: number; reasoning: string } {\n  // If user suggested a type and it's valid, use it with high confidence\n  if (suggestedType && suggestedType in ENTITY_TYPE_SCHEMAS) {\n    return {\n      entityType: suggestedType as EntityTypeName,\n      confidence: 0.95,\n      reasoning: `User suggested type: ${suggestedType}`,\n    };\n  }\n\n  const lowerContent = content.toLowerCase();\n\n  // URL detection - likely a Project, Track, or reference\n  if (contentType === 'url' || lowerContent.match(/^https?:\\/\\//)) {\n    if (lowerContent.includes('github.com')) {\n      return { entityType: 'Project', confidence: 0.9, reasoning: 'GitHub URL detected' };\n    }\n    if (lowerContent.includes('spotify.com') || lowerContent.includes('soundcloud.com')) {\n      return { entityType: 'Track', confidence: 0.9, reasoning: 'Music platform URL detected' };\n    }\n    if (lowerContent.includes('linkedin.com')) {\n      return { entityType: 'Person', confidence: 0.85, reasoning: 'LinkedIn profile URL detected' };\n    }\n  }\n\n  // Score each entity type based on keyword matches\n  const scores: Array<{ type: EntityTypeName; score: number; matches: string[] }> = [];\n\n  for (const [typeName, schema] of Object.entries(ENTITY_TYPE_SCHEMAS)) {\n    const matches = schema.keywords.filter((kw) => lowerContent.includes(kw));\n    const score = matches.length / schema.keywords.length;\n    scores.push({ type: typeName as EntityTypeName, score, matches });\n  }\n\n  // Sort by score descending\n  scores.sort((a, b) => b.score - a.score);\n\n  const best = scores[0];\n\n  if (best.score > 0) {\n    return {\n      entityType: best.type,\n      confidence: Math.min(0.5 + best.score * 0.5, 0.9),\n      reasoning: `Matched keywords: ${best.matches.join(', ')}`,\n    };\n  }\n\n  // Default to Memory if no clear match\n  return {\n    entityType: 'Memory',\n    confidence: 0.4,\n    reasoning: 'No strong type signals detected, defaulting to Memory',\n  };\n}\n\n/**\n * Extract entity name from content\n */\nfunction extractEntityName(content: string, entityType: EntityTypeName): string {\n  // Try to extract a title or name from the content\n  const lines = content.split('\\n').filter((l) => l.trim());\n\n  // If first line is short, use it as the name\n  if (lines[0] && lines[0].length < 100) {\n    return lines[0].trim();\n  }\n\n  // For URLs, extract domain or repo name\n  const urlMatch = content.match(/https?:\\/\\/(?:www\\.)?([^\\/]+)(?:\\/([^\\/\\s]+))?/);\n  if (urlMatch) {\n    if (urlMatch[2]) return urlMatch[2].replace(/[-_]/g, ' ');\n    return urlMatch[1];\n  }\n\n  // Truncate long content\n  return content.slice(0, 60).trim() + (content.length > 60 ? '...' : '');\n}\n\n/**\n * Extract data attributes from content based on entity type\n */\nfunction extractEntityData(\n  content: string,\n  entityType: EntityTypeName,\n  additionalContext?: string\n): Record<string, unknown> {\n  const data: Record<string, unknown> = {};\n  const lowerContent = (content + ' ' + (additionalContext || '')).toLowerCase();\n\n  switch (entityType) {\n    case 'Person': {\n      // Extract email\n      const emailMatch = content.match(/[\\w.-]+@[\\w.-]+\\.\\w+/);\n      if (emailMatch) data.email = emailMatch[0];\n\n      // Extract potential company mentions\n      const companyPatterns = [/at\\s+([A-Z][A-Za-z0-9\\s]+)/g, /works?\\s+(?:at|for)\\s+([A-Z][A-Za-z0-9\\s]+)/gi];\n      for (const pattern of companyPatterns) {\n        const match = pattern.exec(content);\n        if (match) {\n          data.company = match[1].trim();\n          break;\n        }\n      }\n\n      data.notes = content;\n      break;\n    }\n\n    case 'Project': {\n      data.status = 'discovery';\n      data.color = '#8b5cf6'; // Purple default\n\n      // Extract GitHub URL\n      const githubMatch = content.match(/https?:\\/\\/github\\.com\\/[\\w-]+\\/[\\w-]+/);\n      if (githubMatch) data.githubRepo = githubMatch[0];\n\n      data.description = content;\n      break;\n    }\n\n    case 'Track': {\n      data.isPrivate = false;\n\n      // Try to extract artist from \"by\" or \"-\" patterns\n      const artistPatterns = [/by\\s+([^,\\n]+)/i, /[-]\\s*([^,\\n]+)/];\n      for (const pattern of artistPatterns) {\n        const match = pattern.exec(content);\n        if (match) {\n          data.artist = match[1].trim();\n          break;\n        }\n      }\n      if (!data.artist) data.artist = 'Unknown Artist';\n\n      // Extract audio URL\n      const audioMatch = content.match(/https?:\\/\\/[^\\s]+\\.(mp3|wav|m4a|ogg)/i);\n      if (audioMatch) data.audioUrl = audioMatch[0];\n      else data.audioUrl = '';\n\n      break;\n    }\n\n    case 'Event': {\n      data.timezone = 'America/Los_Angeles';\n      data.isAllDay = false;\n\n      // Try to parse date/time\n      const now = Date.now();\n      data.startTime = now;\n      data.endTime = now + 60 * 60 * 1000; // 1 hour default\n\n      data.description = content;\n      break;\n    }\n\n    case 'Memory': {\n      data.memoryType = lowerContent.includes('decision') ? 'decision' :\n        lowerContent.includes('preference') ? 'preference' :\n          lowerContent.includes('milestone') ? 'milestone' : 'interaction';\n      data.content = content;\n      data.importance = 0.7;\n      data.timestamp = Date.now();\n      if (additionalContext) data.context = additionalContext;\n      break;\n    }\n\n    case 'Ticket': {\n      // Generate ticket ID\n      data.ticketId = `IMPORT-${Date.now().toString(36).toUpperCase()}`;\n      data.type = lowerContent.includes('bug') ? 'bug' :\n        lowerContent.includes('feature') ? 'story' : 'task';\n      data.priority = 'P2';\n      data.status = 'backlog';\n      data.description = content;\n      break;\n    }\n\n    case 'Draft': {\n      data.content = content;\n      data.wordCount = content.split(/\\s+/).length;\n      data.status = 'draft';\n      break;\n    }\n\n    case 'Collection': {\n      data.description = content;\n      data.entityIds = [];\n      break;\n    }\n\n    case 'Skill': {\n      data.level = 'intermediate';\n      data.description = content;\n      break;\n    }\n\n    case 'Value': {\n      data.description = content;\n      data.priority = 1;\n      break;\n    }\n  }\n\n  return data;\n}\n\n/**\n * Analyze content and create an ERV entity\n */\nasync function executeAnalyzeAndCreateEntity(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const content = args.content as string;\n  const contentType = (args.contentType as string) || 'auto';\n  const suggestedType = args.suggestedType as string | undefined;\n  const additionalContext = args.additionalContext as string | undefined;\n\n  if (!content) {\n    return {\n      success: false,\n      error: 'Content is required for entity classification',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    // Classify the content\n    const classification = classifyEntityType(content, suggestedType, contentType);\n\n    // Extract entity name and data\n    const name = extractEntityName(content, classification.entityType);\n    const data = extractEntityData(content, classification.entityType, additionalContext);\n\n    // Get default tags for the entity type\n    const schema = ENTITY_TYPE_SCHEMAS[classification.entityType];\n    const tags: string[] = [...schema.defaultTags];\n\n    // Add import tag\n    tags.push(`import-${new Date().toISOString().slice(0, 7)}`);\n\n    // Create the entity\n    const client = new ConvexHttpClient(convexUrl);\n    const result = await client.mutation(api.erv.createEntity, {\n      entityType: classification.entityType,\n      name,\n      data: JSON.stringify(data),\n      tags,\n      source: 'ai_classification',\n      importance: classification.confidence,\n    });\n\n    return {\n      success: true,\n      data: {\n        entityId: result.entityId,\n        entityType: classification.entityType,\n        name,\n        confidence: classification.confidence,\n        reasoning: classification.reasoning,\n        extractedData: data,\n        tags,\n      },\n      action: {\n        type: 'entity_classified',\n        payload: {\n          entityId: result.entityId,\n          entityType: classification.entityType,\n          name,\n          confidence: classification.confidence,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to classify and create entity',\n    };\n  }\n}\n\n/**\n * Suggest relationships for an entity\n */\nasync function executeSuggestEntityRelationships(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const entityId = args.entityId as string;\n  const relationshipTypes = args.relationshipTypes as string[] | undefined;\n  const maxSuggestions = (args.maxSuggestions as number) || 10;\n  const minConfidence = (args.minConfidence as number) || 0.5;\n  const autoCreate = (args.autoCreate as boolean) || false;\n\n  if (!entityId) {\n    return {\n      success: false,\n      error: 'Entity ID is required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    // Get the source entity\n    const sourceEntity = await client.query(api.erv.getEntity, { entityId });\n    if (!sourceEntity) {\n      return {\n        success: false,\n        error: `Entity not found: ${entityId}`,\n      };\n    }\n\n    // Parse source entity data\n    let sourceData: Record<string, unknown> = {};\n    try {\n      sourceData = JSON.parse(sourceEntity.data);\n    } catch {\n      // ignore\n    }\n\n    // Search for potentially related entities\n    const searchTerms = [\n      sourceEntity.name,\n      ...sourceEntity.tags,\n      ...(Object.values(sourceData).filter((v) => typeof v === 'string') as string[]),\n    ].join(' ');\n\n    const candidates = await client.query(api.erv.searchEntities, {\n      query: searchTerms,\n      limit: 50,\n    });\n\n    // Filter out the source entity and score candidates\n    const suggestions: Array<{\n      targetEntityId: string;\n      targetName: string;\n      targetType: string;\n      relationshipType: string;\n      confidence: number;\n      reasoning: string;\n    }> = [];\n\n    for (const candidate of candidates) {\n      if (candidate.entityId === entityId) continue;\n\n      // Calculate relationship suggestions\n      let candidateData: Record<string, unknown> = {};\n      try {\n        candidateData = JSON.parse(candidate.data);\n      } catch {\n        // ignore\n      }\n\n      // Check for tag overlap\n      const tagOverlap = sourceEntity.tags.filter((t) => candidate.tags.includes(t));\n      const tagScore = tagOverlap.length > 0 ? 0.3 + tagOverlap.length * 0.1 : 0;\n\n      // Check for name similarity\n      const nameScore = sourceEntity.name.toLowerCase().includes(candidate.name.toLowerCase()) ||\n        candidate.name.toLowerCase().includes(sourceEntity.name.toLowerCase()) ? 0.3 : 0;\n\n      // Determine relationship type based on entity types\n      let relType = 'relatedTo';\n      let typeReasoning = 'General relationship based on content similarity';\n\n      // Person  Project = collaboratedOn\n      if (sourceEntity.entityType === 'Person' && candidate.entityType === 'Project') {\n        relType = 'collaboratedOn';\n        typeReasoning = 'Person may have collaborated on this project';\n      }\n      // Ticket  Project = belongsTo\n      else if (sourceEntity.entityType === 'Ticket' && candidate.entityType === 'Project') {\n        relType = 'belongsTo';\n        typeReasoning = 'Ticket likely belongs to this project';\n      }\n      // Ticket  Ticket = blockedBy or relatedTo\n      else if (sourceEntity.entityType === 'Ticket' && candidate.entityType === 'Ticket') {\n        relType = 'relatedTo';\n        typeReasoning = 'Related tickets with similar content';\n      }\n      // Memory  Project = mentions\n      else if (sourceEntity.entityType === 'Memory' && candidate.entityType === 'Project') {\n        relType = 'mentions';\n        typeReasoning = 'Memory may reference this project';\n      }\n\n      // Filter by requested relationship types\n      if (relationshipTypes && !relationshipTypes.includes(relType)) {\n        continue;\n      }\n\n      const totalScore = Math.min(tagScore + nameScore + 0.2, 1);\n\n      if (totalScore >= minConfidence) {\n        suggestions.push({\n          targetEntityId: candidate.entityId,\n          targetName: candidate.name,\n          targetType: candidate.entityType,\n          relationshipType: relType,\n          confidence: totalScore,\n          reasoning: typeReasoning + (tagOverlap.length > 0 ? `. Shared tags: ${tagOverlap.join(', ')}` : ''),\n        });\n      }\n    }\n\n    // Sort by confidence and limit\n    suggestions.sort((a, b) => b.confidence - a.confidence);\n    const topSuggestions = suggestions.slice(0, maxSuggestions);\n\n    // Auto-create relationships if requested\n    const createdRelationships: string[] = [];\n    if (autoCreate) {\n      for (const suggestion of topSuggestions) {\n        try {\n          await client.mutation(api.erv.createRelationship, {\n            sourceEntityId: entityId,\n            targetEntityId: suggestion.targetEntityId,\n            relationshipType: suggestion.relationshipType as 'collaboratedOn' | 'createdBy' | 'assignedTo' | 'belongsTo' | 'contains' | 'parentOf' | 'mentions' | 'relatedTo' | 'derivedFrom' | 'followedBy' | 'blockedBy' | 'respondedTo' | 'discussedIn' | 'custom',\n            source: 'ai_suggestion',\n          });\n          createdRelationships.push(`${suggestion.relationshipType}  ${suggestion.targetName}`);\n        } catch {\n          // Relationship may already exist, skip\n        }\n      }\n    }\n\n    return {\n      success: true,\n      data: {\n        entityId,\n        entityName: sourceEntity.name,\n        entityType: sourceEntity.entityType,\n        suggestions: topSuggestions,\n        totalCandidatesAnalyzed: candidates.length,\n        createdRelationships: autoCreate ? createdRelationships : undefined,\n      },\n      action: {\n        type: 'relationships_suggested',\n        payload: {\n          entityId,\n          suggestionCount: topSuggestions.length,\n          autoCreated: createdRelationships.length,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to suggest relationships',\n    };\n  }\n}\n\n/**\n * Bulk classify and create entities\n */\nasync function executeBulkClassifyEntities(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  const items = args.items as Array<{ content: string; hint?: string }>;\n  const sourceFormat = (args.sourceFormat as string) || 'auto';\n  const defaultType = args.defaultType as EntityTypeName | undefined;\n  const commonTags = (args.commonTags as string[]) || [];\n  const dryRun = (args.dryRun as boolean) || false;\n\n  if (!items || !Array.isArray(items) || items.length === 0) {\n    return {\n      success: false,\n      error: 'Items array is required and must not be empty',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    const results: Array<{\n      index: number;\n      content: string;\n      entityType: EntityTypeName;\n      name: string;\n      confidence: number;\n      reasoning: string;\n      entityId?: string;\n      error?: string;\n    }> = [];\n\n    const typeCounts: Record<string, number> = {};\n\n    for (let i = 0; i < items.length; i++) {\n      const item = items[i];\n      const content = item.content;\n\n      if (!content || typeof content !== 'string') {\n        results.push({\n          index: i,\n          content: String(content || ''),\n          entityType: 'Memory',\n          name: '',\n          confidence: 0,\n          reasoning: 'Invalid content',\n          error: 'Content must be a non-empty string',\n        });\n        continue;\n      }\n\n      // Classify the item\n      const classification = classifyEntityType(content, defaultType, sourceFormat);\n      const name = extractEntityName(content, classification.entityType);\n      const data = extractEntityData(content, classification.entityType, item.hint);\n\n      // Get tags\n      const schema = ENTITY_TYPE_SCHEMAS[classification.entityType];\n      const tags = [...schema.defaultTags, ...commonTags];\n\n      // Track type counts\n      typeCounts[classification.entityType] = (typeCounts[classification.entityType] || 0) + 1;\n\n      if (dryRun) {\n        results.push({\n          index: i,\n          content: content.slice(0, 100),\n          entityType: classification.entityType,\n          name,\n          confidence: classification.confidence,\n          reasoning: classification.reasoning,\n        });\n      } else {\n        try {\n          const result = await client.mutation(api.erv.createEntity, {\n            entityType: classification.entityType,\n            name,\n            data: JSON.stringify(data),\n            tags,\n            source: 'bulk_import',\n            importance: classification.confidence,\n          });\n\n          results.push({\n            index: i,\n            content: content.slice(0, 100),\n            entityType: classification.entityType,\n            name,\n            confidence: classification.confidence,\n            reasoning: classification.reasoning,\n            entityId: result.entityId,\n          });\n        } catch (err) {\n          results.push({\n            index: i,\n            content: content.slice(0, 100),\n            entityType: classification.entityType,\n            name,\n            confidence: classification.confidence,\n            reasoning: classification.reasoning,\n            error: err instanceof Error ? err.message : 'Failed to create entity',\n          });\n        }\n      }\n    }\n\n    const successCount = results.filter((r) => !r.error && r.entityId).length;\n    const errorCount = results.filter((r) => r.error).length;\n\n    return {\n      success: true,\n      data: {\n        totalItems: items.length,\n        dryRun,\n        successCount,\n        errorCount,\n        typeCounts,\n        results,\n      },\n      action: {\n        type: 'bulk_classification_complete',\n        payload: {\n          totalItems: items.length,\n          successCount,\n          errorCount,\n          dryRun,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to bulk classify entities',\n    };\n  }\n}\n\n// =============================================================================\n// Autonomous Execution Tools\n// These enable 8gent to do real work - spawn tasks, iterate on code,\n// and delegate to specialists. Inspired by OpenClaw's sessions_spawn.\n// =============================================================================\n\n/**\n * Spawn a background task that runs independently\n * Creates an ERV AgentTask entity for observability through activity/threads/security apps\n */\nasync function executeSpawnTask(args: Record<string, unknown>): Promise<ToolResult> {\n  const task = args.task as string;\n  const label = args.label as string | undefined;\n  const timeoutSeconds = Math.min((args.timeoutSeconds as number) || 300, 600);\n  const announceResult = (args.announceResult as boolean) !== false;\n  const priority = (args.priority as 'low' | 'normal' | 'high') || 'normal';\n  const context = args.context as Record<string, unknown> | undefined;\n\n  if (!task) {\n    return {\n      success: false,\n      error: 'Task description is required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    const result = await client.mutation(api.jobs.queueAgentTask, {\n      task,\n      label,\n      timeoutSeconds,\n      announceResult,\n      priority,\n      context: context as { projectId?: string; ticketId?: string; sandboxId?: string; repositoryUrl?: string } | undefined,\n    });\n\n    // Create ERV AgentTask entity for observability\n    const agentTaskData = {\n      jobId: result.jobId,\n      jobType: 'agent_task' as const,\n      status: result.status as 'queued' | 'running' | 'succeeded' | 'failed' | 'cancelled',\n      task,\n      label: label || task.slice(0, 50),\n      priority,\n      progress: 0,\n      announceResult,\n      context: context as { projectId?: string; ticketId?: string; sandboxId?: string; repositoryUrl?: string } | undefined,\n    };\n\n    try {\n      // Create the ERV entity\n      const entityResult = await client.mutation(api.erv.createEntity, {\n        entityType: 'AgentTask',\n        name: label || task.slice(0, 50),\n        data: JSON.stringify(agentTaskData),\n        tags: ['background-task', priority, 'agent_task'],\n        importance: priority === 'high' ? 0.8 : priority === 'normal' ? 0.5 : 0.3,\n        source: 'ai',\n      });\n\n      // Create relationships to context entities if provided\n      if (context?.projectId) {\n        await client.mutation(api.erv.createRelationship, {\n          sourceEntityId: entityResult.entityId,\n          targetEntityId: context.projectId as string,\n          relationshipType: 'spawnedFor',\n          bidirectional: false,\n          source: 'ai',\n        }).catch(() => { /* Relationship creation is optional */ });\n      }\n\n      if (context?.ticketId) {\n        await client.mutation(api.erv.createRelationship, {\n          sourceEntityId: entityResult.entityId,\n          targetEntityId: context.ticketId as string,\n          relationshipType: 'spawnedFor',\n          bidirectional: false,\n          source: 'ai',\n        }).catch(() => { /* Relationship creation is optional */ });\n      }\n\n      if (context?.sandboxId) {\n        await client.mutation(api.erv.createRelationship, {\n          sourceEntityId: entityResult.entityId,\n          targetEntityId: context.sandboxId as string,\n          relationshipType: 'executedIn',\n          bidirectional: false,\n          source: 'ai',\n        }).catch(() => { /* Relationship creation is optional */ });\n      }\n    } catch {\n      // ERV entity creation is optional - don't fail the main task\n      console.warn('Failed to create ERV entity for agent task');\n    }\n\n    return {\n      success: true,\n      data: {\n        jobId: result.jobId,\n        status: result.status,\n        task,\n        label: label || task.slice(0, 50),\n        timeoutSeconds,\n        message: `Task spawned! Job ID: ${result.jobId}. I'll work on this in the background and announce the result when done.`,\n      },\n      action: {\n        type: 'task_spawned',\n        payload: {\n          jobId: result.jobId,\n          task,\n          label,\n          priority,\n          announceResult,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to spawn task',\n    };\n  }\n}\n\n/**\n * List background tasks\n */\nasync function executeListBackgroundTasks(args: Record<string, unknown>): Promise<ToolResult> {\n  const status = args.status as string | undefined;\n  const limit = (args.limit as number) || 10;\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    const jobs = await client.query(api.jobs.getAgentJobs, {\n      status: status as 'queued' | 'running' | 'succeeded' | 'failed' | 'cancelled' | 'all' | undefined,\n      limit,\n    });\n\n    const formattedJobs = jobs.map((job: { jobId: string; jobType: string; status: string; progress?: number; progressMessage?: string; createdAt: number; completedAt?: number; input: { task?: string; label?: string; goal?: string; specialist?: string } }) => ({\n      jobId: job.jobId,\n      type: job.jobType,\n      status: job.status,\n      progress: job.progress || 0,\n      progressMessage: job.progressMessage,\n      label: job.input?.label || job.input?.task?.slice(0, 50) || job.input?.goal?.slice(0, 50) || job.input?.specialist,\n      createdAt: new Date(job.createdAt).toISOString(),\n      completedAt: job.completedAt ? new Date(job.completedAt).toISOString() : undefined,\n    }));\n\n    return {\n      success: true,\n      data: {\n        tasks: formattedJobs,\n        count: formattedJobs.length,\n        message: formattedJobs.length > 0\n          ? `Found ${formattedJobs.length} background task(s)`\n          : 'No background tasks found',\n      },\n      action: {\n        type: 'tasks_listed',\n        payload: {\n          tasks: formattedJobs,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to list tasks',\n    };\n  }\n}\n\n/**\n * Cancel a background task\n */\nasync function executeCancelBackgroundTask(args: Record<string, unknown>): Promise<ToolResult> {\n  const jobId = args.jobId as string;\n\n  if (!jobId) {\n    return {\n      success: false,\n      error: 'Job ID is required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    await client.mutation(api.jobs.cancelJob, { jobId });\n\n    return {\n      success: true,\n      data: {\n        jobId,\n        message: `Task ${jobId} has been cancelled`,\n      },\n      action: {\n        type: 'task_cancelled',\n        payload: {\n          jobId,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to cancel task',\n    };\n  }\n}\n\n/**\n * Get result of a completed task\n */\nasync function executeGetTaskResult(args: Record<string, unknown>): Promise<ToolResult> {\n  const jobId = args.jobId as string;\n\n  if (!jobId) {\n    return {\n      success: false,\n      error: 'Job ID is required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    const job = await client.query(api.jobs.getJob, { jobId });\n\n    if (!job) {\n      return {\n        success: false,\n        error: `Task ${jobId} not found`,\n      };\n    }\n\n    return {\n      success: true,\n      data: {\n        jobId: job.jobId,\n        status: job.status,\n        progress: job.progress,\n        progressMessage: job.progressMessage,\n        input: job.input,\n        output: job.output,\n        createdAt: new Date(job.createdAt).toISOString(),\n        completedAt: job.completedAt ? new Date(job.completedAt).toISOString() : undefined,\n        message: job.status === 'succeeded'\n          ? 'Task completed successfully'\n          : job.status === 'failed'\n            ? `Task failed: ${job.lastError || 'Unknown error'}`\n            : `Task is ${job.status}`,\n      },\n      action: {\n        type: job.status === 'succeeded' ? 'task_completed' : job.status === 'failed' ? 'task_failed' : 'task_progress',\n        payload: {\n          jobId: job.jobId,\n          status: job.status,\n          output: job.output,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to get task result',\n    };\n  }\n}\n\n/**\n * Start an autonomous code iteration session\n * Creates an ERV AgentTask entity for observability\n */\nasync function executeIterateOnCode(args: Record<string, unknown>): Promise<ToolResult> {\n  const goal = args.goal as string;\n  const sandboxId = args.sandboxId as string;\n  const maxIterations = Math.min((args.maxIterations as number) || 5, 10);\n  const stopOnSuccess = (args.stopOnSuccess as boolean) !== false;\n  const commitChanges = (args.commitChanges as boolean) || false;\n  const testCommand = args.testCommand as string | undefined;\n\n  if (!goal) {\n    return {\n      success: false,\n      error: 'Goal is required',\n    };\n  }\n\n  if (!sandboxId) {\n    return {\n      success: false,\n      error: 'Sandbox ID is required - clone a repo first',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    const result = await client.mutation(api.jobs.queueCodeIteration, {\n      goal,\n      sandboxId,\n      maxIterations,\n      stopOnSuccess,\n      commitChanges,\n      testCommand,\n    });\n\n    // Create ERV AgentTask entity for code iteration observability\n    const agentTaskData = {\n      jobId: result.jobId,\n      jobType: 'code_iteration' as const,\n      status: result.status as 'queued' | 'running' | 'succeeded' | 'failed' | 'cancelled',\n      task: goal,\n      label: `Code: ${goal.slice(0, 40)}`,\n      priority: 'normal' as const,\n      progress: 0,\n      sandboxId,\n      testCommand,\n      maxIterations,\n      announceResult: true,\n    };\n\n    try {\n      const entityResult = await client.mutation(api.erv.createEntity, {\n        entityType: 'AgentTask',\n        name: `Code: ${goal.slice(0, 40)}`,\n        data: JSON.stringify(agentTaskData),\n        tags: ['code-iteration', 'autonomous', sandboxId ? 'sandbox' : 'local'],\n        importance: 0.7,\n        source: 'ai',\n      });\n\n      // Link to sandbox\n      if (sandboxId) {\n        await client.mutation(api.erv.createRelationship, {\n          sourceEntityId: entityResult.entityId,\n          targetEntityId: sandboxId,\n          relationshipType: 'executedIn',\n          bidirectional: false,\n          source: 'ai',\n        }).catch(() => { /* Optional */ });\n      }\n    } catch {\n      console.warn('Failed to create ERV entity for code iteration');\n    }\n\n    return {\n      success: true,\n      data: {\n        jobId: result.jobId,\n        status: result.status,\n        goal,\n        sandboxId,\n        maxIterations,\n        testCommand,\n        message: `Code iteration started! Job ID: ${result.jobId}. I'll analyze the code, make changes, and iterate up to ${maxIterations} times until ${testCommand ? `\"${testCommand}\" passes` : 'the goal is achieved'}.`,\n      },\n      action: {\n        type: 'iteration_started',\n        payload: {\n          jobId: result.jobId,\n          goal,\n          sandboxId,\n          maxIterations,\n          testCommand,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to start code iteration',\n    };\n  }\n}\n\n/**\n * Delegate a task to a specialist agent\n * Creates an ERV AgentTask entity for observability\n */\nasync function executeDelegateToSpecialist(args: Record<string, unknown>): Promise<ToolResult> {\n  const specialist = args.specialist as string;\n  const task = args.task as string;\n  const context = args.context as Record<string, unknown> | undefined;\n  const announceResult = (args.announceResult as boolean) !== false;\n\n  const validSpecialists = [\n    'code-reviewer',\n    'security-auditor',\n    'performance-analyst',\n    'documentation-writer',\n    'test-generator',\n    'refactoring-expert',\n  ];\n\n  if (!specialist || !validSpecialists.includes(specialist)) {\n    return {\n      success: false,\n      error: `Invalid specialist. Choose from: ${validSpecialists.join(', ')}`,\n    };\n  }\n\n  if (!task) {\n    return {\n      success: false,\n      error: 'Task description is required',\n    };\n  }\n\n  const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n  if (!convexUrl) {\n    return {\n      success: false,\n      error: 'Convex URL not configured',\n    };\n  }\n\n  try {\n    const client = new ConvexHttpClient(convexUrl);\n\n    const result = await client.mutation(api.jobs.queueSpecialistDelegation, {\n      specialist: specialist as 'code-reviewer' | 'security-auditor' | 'performance-analyst' | 'documentation-writer' | 'test-generator' | 'refactoring-expert',\n      task,\n      context,\n      announceResult,\n    });\n\n    const specialistDescriptions: Record<string, string> = {\n      'code-reviewer': 'reviewing the code for quality, patterns, and potential issues',\n      'security-auditor': 'analyzing for security vulnerabilities and best practices',\n      'performance-analyst': 'identifying performance bottlenecks and optimizations',\n      'documentation-writer': 'generating comprehensive documentation',\n      'test-generator': 'creating test cases and improving test coverage',\n      'refactoring-expert': 'suggesting and implementing code refactoring',\n    };\n\n    // Create ERV AgentTask entity for specialist delegation observability\n    const agentTaskData = {\n      jobId: result.jobId,\n      jobType: 'specialist_delegation' as const,\n      status: result.status as 'queued' | 'running' | 'succeeded' | 'failed' | 'cancelled',\n      task,\n      label: `${specialist}: ${task.slice(0, 30)}`,\n      priority: 'normal' as const,\n      progress: 0,\n      specialist,\n      announceResult,\n      context: context as { projectId?: string; ticketId?: string; sandboxId?: string; repositoryUrl?: string } | undefined,\n    };\n\n    try {\n      const entityResult = await client.mutation(api.erv.createEntity, {\n        entityType: 'AgentTask',\n        name: `${specialist}: ${task.slice(0, 30)}`,\n        data: JSON.stringify(agentTaskData),\n        tags: ['specialist', specialist, 'delegation'],\n        importance: specialist === 'security-auditor' ? 0.9 : 0.6,\n        source: 'ai',\n      });\n\n      // Create relationship to indicate delegation type\n      await client.mutation(api.erv.createRelationship, {\n        sourceEntityId: entityResult.entityId,\n        targetEntityId: specialist, // Specialist type as target\n        relationshipType: 'delegatedTo',\n        bidirectional: false,\n        label: specialist,\n        source: 'ai',\n      }).catch(() => { /* Optional */ });\n\n      // Link to context entities if provided\n      if (context?.projectId) {\n        await client.mutation(api.erv.createRelationship, {\n          sourceEntityId: entityResult.entityId,\n          targetEntityId: context.projectId as string,\n          relationshipType: 'spawnedFor',\n          bidirectional: false,\n          source: 'ai',\n        }).catch(() => { /* Optional */ });\n      }\n\n      if (context?.sandboxId) {\n        await client.mutation(api.erv.createRelationship, {\n          sourceEntityId: entityResult.entityId,\n          targetEntityId: context.sandboxId as string,\n          relationshipType: 'executedIn',\n          bidirectional: false,\n          source: 'ai',\n        }).catch(() => { /* Optional */ });\n      }\n    } catch {\n      console.warn('Failed to create ERV entity for specialist delegation');\n    }\n\n    return {\n      success: true,\n      data: {\n        jobId: result.jobId,\n        status: result.status,\n        specialist,\n        task,\n        message: `Delegated to ${specialist}! Job ID: ${result.jobId}. The specialist is ${specialistDescriptions[specialist]}. I'll announce the findings when complete.`,\n      },\n      action: {\n        type: 'specialist_delegated',\n        payload: {\n          jobId: result.jobId,\n          specialist,\n          task,\n          announceResult,\n        },\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to delegate to specialist',\n    };\n  }\n}\n\n// ============================================================================\n// Music Generation Tools (ACE-Step via Lynkr)\n// ============================================================================\n\ninterface MusicCowriteDraft {\n  prompt?: string;\n  lyrics?: string;\n  duration?: number;\n  bpm?: number;\n  key?: string;\n  timeSignature?: string;\n  title?: string;\n  referenceAudioUrl?: string;\n  referenceStrength?: number;\n}\n\ninterface MusicCowriteArgs {\n  step: 'start' | 'refine_style' | 'add_lyrics' | 'set_structure' | 'add_reference' | 'finalize' | 'generate';\n  userInput: string;\n  currentDraft?: string | MusicCowriteDraft; // JSON string (from AI) or object\n}\n\ninterface MusicGenerateArgs {\n  prompt: string;\n  lyrics?: string;\n  duration?: number;\n  bpm?: number;\n  key?: string;\n  timeSignature?: string;\n  referenceAudioUrl?: string;\n  referenceStrength?: number;\n  title?: string;\n  saveToJamz?: boolean;\n  projectId?: string;\n}\n\ninterface MusicGenerateResult {\n  id: string;\n  status: 'completed' | 'processing' | 'failed';\n  audioUrl?: string;\n  audioBase64?: string;\n  duration: number;\n  metadata: {\n    bpm: number;\n    key: string;\n    timeSignature: string;\n    model: string;\n    lmModel?: string;\n  };\n  provider: string;\n  title?: string;\n}\n\n/**\n * Cowrite Music - Conversational music creation assistant\n * Guides users through crafting the perfect music generation request\n */\nasync function executeCowriteMusic(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  // SECURITY: Owner only\n  if (context.accessLevel !== 'owner') {\n    return {\n      success: false,\n      error: 'Music creation is only available to the owner.',\n    };\n  }\n\n  const params = args as unknown as MusicCowriteArgs;\n  // Parse currentDraft from JSON string (tool definition changed to string type for TypeScript compatibility)\n  let draft: MusicCowriteDraft = {};\n  if (params.currentDraft) {\n    try {\n      const parsed = typeof params.currentDraft === 'string'\n        ? JSON.parse(params.currentDraft)\n        : params.currentDraft;\n      draft = parsed as MusicCowriteDraft;\n    } catch {\n      // If parsing fails, start with empty draft\n      draft = {};\n    }\n  }\n  const input = params.userInput || '';\n\n  // Build helpful guidance based on step\n  switch (params.step) {\n    case 'start':\n      return {\n        success: true,\n        data: {\n          step: 'start',\n          draft,\n          guidance: {\n            message: \"Let's create some music together! Tell me about your vision.\",\n            questions: [\n              \"What genre or style are you thinking? (e.g., lofi hip-hop, cinematic orchestral, indie folk)\",\n              \"What mood or feeling should it evoke? (e.g., chill, energetic, melancholic, triumphant)\",\n              \"Is this for something specific? (podcast intro, background music, a full song with lyrics)\",\n            ],\n            suggestions: [\n              \"chill lofi beats for studying\",\n              \"epic cinematic trailer music\",\n              \"upbeat indie pop with catchy hooks\",\n              \"ambient electronic soundscape\",\n              \"acoustic folk ballad\",\n            ],\n          },\n          nextSteps: ['refine_style', 'add_lyrics'],\n        },\n      };\n\n    case 'refine_style':\n      // Parse user input to build style description\n      const styleKeywords = extractStyleKeywords(input);\n      const enhancedPrompt = buildEnhancedPrompt(input, styleKeywords);\n\n      return {\n        success: true,\n        data: {\n          step: 'refine_style',\n          draft: {\n            ...draft,\n            prompt: enhancedPrompt,\n          },\n          guidance: {\n            message: \"Great! I've crafted a style description. Here's what I have:\",\n            currentPrompt: enhancedPrompt,\n            questions: [\n              \"Should we add or change any instruments?\",\n              \"Any specific production style? (lo-fi, polished, raw, vintage)\",\n              \"What tempo/energy level? (slow and dreamy, mid-tempo groove, fast and energetic)\",\n            ],\n            suggestions: generateStyleSuggestions(styleKeywords),\n          },\n          nextSteps: ['add_lyrics', 'set_structure', 'add_reference', 'finalize'],\n        },\n      };\n\n    case 'add_lyrics':\n      // Help structure lyrics with proper tags\n      const structuredLyrics = structureLyrics(input, draft.lyrics);\n\n      return {\n        success: true,\n        data: {\n          step: 'add_lyrics',\n          draft: {\n            ...draft,\n            lyrics: structuredLyrics || draft.lyrics,\n          },\n          guidance: {\n            message: structuredLyrics\n              ? \"I've structured your lyrics with song sections:\"\n              : \"Let's write some lyrics! I can help with structure.\",\n            currentLyrics: structuredLyrics || draft.lyrics,\n            tips: [\n              \"Use [Verse], [Chorus], [Bridge], [Intro], [Outro] tags for structure\",\n              \"Keep verses 4-8 lines, choruses memorable and repeatable\",\n              \"Consider syllable count for natural flow\",\n              \"Leave blank for instrumental tracks\",\n            ],\n            example: `[Intro]\\n(Instrumental)\\n\\n[Verse 1]\\nWalking through the morning light\\nEverything feels just right\\n\\n[Chorus]\\nThis is where I want to be\\nFinally feeling free`,\n          },\n          nextSteps: ['set_structure', 'add_reference', 'finalize'],\n        },\n      };\n\n    case 'set_structure':\n      // Help set technical parameters\n      const suggestedBpm = suggestBpmFromStyle(draft.prompt || input);\n      const suggestedKey = suggestKeyFromMood(draft.prompt || input);\n      const suggestedDuration = suggestDurationFromType(input, draft.lyrics);\n\n      return {\n        success: true,\n        data: {\n          step: 'set_structure',\n          draft: {\n            ...draft,\n            bpm: draft.bpm || suggestedBpm,\n            key: draft.key || suggestedKey,\n            duration: draft.duration || suggestedDuration,\n            timeSignature: draft.timeSignature || '4/4',\n          },\n          guidance: {\n            message: \"Let's dial in the technical specs:\",\n            suggestions: {\n              bpm: { suggested: suggestedBpm, range: \"60-200\", description: \"Tempo/speed of the track\" },\n              key: { suggested: suggestedKey, common: [\"C major\", \"G major\", \"A minor\", \"E minor\", \"F major\"] },\n              duration: { suggested: suggestedDuration, range: \"10-600 seconds\", note: \"30s = short clip, 180s = full song\" },\n              timeSignature: { suggested: \"4/4\", options: [\"4/4 (standard)\", \"3/4 (waltz)\", \"6/8 (compound)\"] },\n            },\n          },\n          nextSteps: ['add_reference', 'finalize'],\n        },\n      };\n\n    case 'add_reference':\n      // Handle reference audio\n      const refUrl = extractUrl(input) || draft.referenceAudioUrl;\n\n      return {\n        success: true,\n        data: {\n          step: 'add_reference',\n          draft: {\n            ...draft,\n            referenceAudioUrl: refUrl,\n            referenceStrength: draft.referenceStrength || 0.5,\n          },\n          guidance: {\n            message: refUrl\n              ? \"Reference audio set! The AI will match this track's vibe.\"\n              : \"Want to use a reference track? The AI can match the style of an existing song.\",\n            currentReference: refUrl,\n            tips: [\n              \"Provide a URL to an MP3, WAV, or audio file\",\n              \"The AI will capture the vibe, energy, and production style\",\n              \"Reference strength (0-1): higher = closer match, lower = more creative freedom\",\n              \"Skip this step if you want fully original style\",\n            ],\n            strengthGuide: {\n              \"0.2-0.3\": \"Subtle influence, mostly original\",\n              \"0.4-0.6\": \"Balanced (recommended)\",\n              \"0.7-0.9\": \"Strong style match\",\n            },\n          },\n          nextSteps: ['finalize'],\n        },\n      };\n\n    case 'finalize':\n      // Show complete draft for review\n      return {\n        success: true,\n        data: {\n          step: 'finalize',\n          draft,\n          readyToGenerate: !!(draft.prompt && draft.prompt.length > 0),\n          guidance: {\n            message: \"Here's your complete music request. Ready to generate?\",\n            summary: {\n              style: draft.prompt || \"Not set\",\n              lyrics: draft.lyrics ? `${draft.lyrics.split('\\n').length} lines` : \"Instrumental\",\n              duration: draft.duration ? `${draft.duration} seconds` : \"30 seconds (default)\",\n              bpm: draft.bpm || \"Auto-detect\",\n              key: draft.key || \"Auto-detect\",\n              timeSignature: draft.timeSignature || \"4/4\",\n              reference: draft.referenceAudioUrl ? \"Yes\" : \"No\",\n            },\n            estimatedTime: estimateGenerationTime(draft.duration || 30),\n          },\n          nextSteps: ['generate'],\n        },\n      };\n\n    case 'generate':\n      // User confirmed, trigger actual generation\n      if (!draft.prompt) {\n        return {\n          success: false,\n          error: 'No style prompt set. Use refine_style step first.',\n        };\n      }\n\n      return {\n        success: true,\n        data: {\n          step: 'generate',\n          action: 'TRIGGER_GENERATION',\n          payload: {\n            prompt: draft.prompt,\n            lyrics: draft.lyrics,\n            duration: draft.duration || 30,\n            bpm: draft.bpm,\n            key: draft.key,\n            timeSignature: draft.timeSignature || '4/4',\n            referenceAudioUrl: draft.referenceAudioUrl,\n            referenceStrength: draft.referenceStrength,\n            title: draft.title,\n          },\n          message: \"Starting music generation! This may take a few minutes on CPU.\",\n        },\n      };\n\n    default:\n      return {\n        success: false,\n        error: `Unknown cowrite step: ${params.step}`,\n      };\n  }\n}\n\n// Helper functions for cowrite_music\nfunction extractStyleKeywords(input: string): string[] {\n  const keywords: string[] = [];\n  const genrePatterns = /\\b(lofi|lo-fi|hip-hop|hiphop|pop|rock|jazz|blues|electronic|edm|house|techno|ambient|classical|orchestral|cinematic|folk|country|r&b|rnb|soul|funk|reggae|metal|punk|indie|alternative|acoustic|synth|trap|drill|dubstep|dnb|drum and bass)\\b/gi;\n  const moodPatterns = /\\b(chill|relaxing|energetic|upbeat|melancholic|sad|happy|dark|bright|dreamy|ethereal|aggressive|peaceful|nostalgic|epic|dramatic|romantic|playful|mysterious|intense|mellow)\\b/gi;\n  const instrumentPatterns = /\\b(piano|guitar|synth|drums|bass|strings|violin|cello|flute|saxophone|trumpet|organ|vocals|choir|beats|808|percussion)\\b/gi;\n\n  const genres = input.match(genrePatterns) || [];\n  const moods = input.match(moodPatterns) || [];\n  const instruments = input.match(instrumentPatterns) || [];\n\n  return [...new Set([...genres, ...moods, ...instruments].map(k => k.toLowerCase()))];\n}\n\nfunction buildEnhancedPrompt(input: string, keywords: string[]): string {\n  // If input is already detailed, use it; otherwise enhance\n  if (input.length > 50) return input;\n\n  const parts: string[] = [];\n\n  // Add genre if found\n  const genres = keywords.filter(k =>\n    ['lofi', 'pop', 'rock', 'jazz', 'electronic', 'ambient', 'classical', 'folk', 'hip-hop'].some(g => k.includes(g))\n  );\n  if (genres.length > 0) parts.push(genres.join(' '));\n\n  // Add mood\n  const moods = keywords.filter(k =>\n    ['chill', 'energetic', 'melancholic', 'dreamy', 'epic', 'peaceful'].some(m => k.includes(m))\n  );\n  if (moods.length > 0) parts.push(`${moods.join(', ')} mood`);\n\n  // Add instruments\n  const instruments = keywords.filter(k =>\n    ['piano', 'guitar', 'synth', 'drums', 'strings', 'vocals'].some(i => k.includes(i))\n  );\n  if (instruments.length > 0) parts.push(`featuring ${instruments.join(', ')}`);\n\n  return parts.length > 0 ? parts.join(', ') : input;\n}\n\nfunction generateStyleSuggestions(keywords: string[]): string[] {\n  const suggestions: string[] = [];\n\n  if (keywords.includes('lofi') || keywords.includes('chill')) {\n    suggestions.push(\"Add vinyl crackle and warm tape saturation\");\n    suggestions.push(\"Include jazzy chord progressions\");\n  }\n  if (keywords.includes('electronic') || keywords.includes('synth')) {\n    suggestions.push(\"Add arpeggiated synth leads\");\n    suggestions.push(\"Include sidechained bass and punchy kicks\");\n  }\n  if (keywords.includes('acoustic') || keywords.includes('folk')) {\n    suggestions.push(\"Add fingerpicked guitar patterns\");\n    suggestions.push(\"Include soft harmonies and warm vocals\");\n  }\n  if (keywords.includes('cinematic') || keywords.includes('epic')) {\n    suggestions.push(\"Add sweeping string arrangements\");\n    suggestions.push(\"Include building percussion and brass\");\n  }\n\n  if (suggestions.length === 0) {\n    suggestions.push(\"Add more detail about the production style\");\n    suggestions.push(\"Specify the main instruments you'd like\");\n    suggestions.push(\"Describe the energy/vibe in more detail\");\n  }\n\n  return suggestions;\n}\n\nfunction structureLyrics(input: string, existingLyrics?: string): string | null {\n  // If input contains structure tags, return as-is\n  if (input.includes('[Verse]') || input.includes('[Chorus]')) {\n    return input;\n  }\n\n  // If input looks like lyrics (multiple lines), add basic structure\n  const lines = input.split('\\n').filter(l => l.trim());\n  if (lines.length >= 4) {\n    const structured: string[] = [];\n    for (let i = 0; i < lines.length; i++) {\n      if (i === 0) structured.push('[Verse 1]');\n      else if (i === 4 && lines.length > 6) structured.push('\\n[Chorus]');\n      else if (i === 8 && lines.length > 10) structured.push('\\n[Verse 2]');\n      structured.push(lines[i]);\n    }\n    return structured.join('\\n');\n  }\n\n  return existingLyrics || null;\n}\n\nfunction suggestBpmFromStyle(style: string): number {\n  const lower = style.toLowerCase();\n  if (lower.includes('ballad') || lower.includes('slow') || lower.includes('ambient')) return 70;\n  if (lower.includes('lofi') || lower.includes('chill') || lower.includes('jazz')) return 85;\n  if (lower.includes('pop') || lower.includes('indie') || lower.includes('folk')) return 110;\n  if (lower.includes('rock') || lower.includes('funk')) return 120;\n  if (lower.includes('house') || lower.includes('electronic')) return 125;\n  if (lower.includes('dnb') || lower.includes('drum and bass')) return 170;\n  if (lower.includes('trap') || lower.includes('hip-hop') || lower.includes('hiphop')) return 140;\n  return 100; // Default\n}\n\nfunction suggestKeyFromMood(style: string): string {\n  const lower = style.toLowerCase();\n  if (lower.includes('sad') || lower.includes('melancholic') || lower.includes('dark')) return 'A minor';\n  if (lower.includes('happy') || lower.includes('bright') || lower.includes('upbeat')) return 'C major';\n  if (lower.includes('dreamy') || lower.includes('ethereal')) return 'E major';\n  if (lower.includes('epic') || lower.includes('dramatic')) return 'D minor';\n  if (lower.includes('peaceful') || lower.includes('calm')) return 'G major';\n  return 'C major'; // Default\n}\n\nfunction suggestDurationFromType(input: string, lyrics?: string): number {\n  const lower = input.toLowerCase();\n  if (lower.includes('intro') || lower.includes('jingle') || lower.includes('short')) return 15;\n  if (lower.includes('loop') || lower.includes('clip')) return 30;\n  if (lower.includes('full song') || lower.includes('complete')) return 180;\n  if (lyrics && lyrics.length > 200) return 180; // Long lyrics = full song\n  if (lyrics && lyrics.length > 50) return 90; // Some lyrics\n  return 30; // Default\n}\n\nfunction extractUrl(input: string): string | null {\n  const urlMatch = input.match(/https?:\\/\\/[^\\s]+/);\n  return urlMatch ? urlMatch[0] : null;\n}\n\nfunction estimateGenerationTime(duration: number): string {\n  // Rough estimate: CPU takes about 2-3x the duration\n  const estimate = Math.ceil(duration * 3 / 60);\n  if (estimate <= 1) return \"About 1-2 minutes\";\n  return `About ${estimate}-${estimate + 1} minutes`;\n}\n\nasync function executeGenerateMusic(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  // SECURITY: Owner only\n  if (context.accessLevel !== 'owner') {\n    return {\n      success: false,\n      error: 'Music generation is only available to the owner.',\n    };\n  }\n\n  const params = args as unknown as MusicGenerateArgs;\n\n  if (!params.prompt) {\n    return {\n      success: false,\n      error: 'Prompt is required for music generation.',\n    };\n  }\n\n  // Validate duration\n  const duration = params.duration || 30;\n  if (duration < 10 || duration > 600) {\n    return {\n      success: false,\n      error: 'Duration must be between 10 and 600 seconds.',\n    };\n  }\n\n  try {\n    console.log('[MusicGen] Starting generation:', {\n      prompt: params.prompt.slice(0, 100),\n      duration,\n      bpm: params.bpm,\n      key: params.key,\n      hasReference: !!params.referenceAudioUrl,\n    });\n\n    // Call our API endpoint\n    const response = await fetch(`${getBaseUrl()}/api/music/generate`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        action: 'generate',\n        prompt: params.prompt,\n        lyrics: params.lyrics,\n        duration,\n        bpm: params.bpm,\n        key: params.key,\n        timeSignature: params.timeSignature,\n        referenceAudio: params.referenceAudioUrl,\n        referenceStrength: params.referenceStrength ?? 0.5,\n        title: params.title,\n        saveToJamz: params.saveToJamz,\n        projectId: params.projectId,\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      return {\n        success: false,\n        error: error.error || 'Music generation failed.',\n      };\n    }\n\n    const result: MusicGenerateResult = await response.json();\n\n    // If saveToJamz is true, create the track in Convex\n    if (params.saveToJamz && result.audioUrl) {\n      try {\n        const convexUrl = process.env.NEXT_PUBLIC_CONVEX_URL;\n        if (!convexUrl) throw new Error('Convex URL not configured');\n        const client = new ConvexHttpClient(convexUrl);\n        const trackName = params.title || `AI: ${params.prompt.slice(0, 30)}`;\n\n        // Create or get default project\n        let projectId = params.projectId;\n        if (!projectId) {\n          // Create a new project for AI-generated tracks\n          const project = await client.mutation(api.jamz.createProject, {\n            name: 'AI Generated Music',\n            bpm: result.metadata.bpm,\n            timeSignatureBeats: parseInt(result.metadata.timeSignature.split('/')[0]) || 4,\n            timeSignatureUnit: parseInt(result.metadata.timeSignature.split('/')[1]) || 4,\n          });\n          projectId = project;\n        }\n\n        // Create the track\n        const track = await client.mutation(api.jamz.createTrack, {\n          projectId: projectId as Id<'jamzProjects'>,\n          name: trackName,\n          type: 'audio',\n          color: '#8B5CF6', // Purple for AI-generated\n        });\n\n        // Create the clip\n        await client.mutation(api.jamz.createClip, {\n          trackId: track as Id<'jamzTracks'>,\n          name: trackName,\n          startBeat: 0,\n          lengthBeats: Math.round((result.duration * result.metadata.bpm) / 60),\n          audioUrl: result.audioUrl,\n        });\n\n        console.log('[MusicGen] Saved to Jamz Studio:', track);\n      } catch (err) {\n        console.error('[MusicGen] Failed to save to Jamz:', err);\n        // Don't fail the whole operation, just note it\n      }\n    }\n\n    return {\n      success: true,\n      data: {\n        id: result.id,\n        audioUrl: result.audioUrl,\n        duration: result.duration,\n        metadata: result.metadata,\n        title: result.title || params.title,\n        provider: result.provider,\n        message: `Generated ${result.duration}s of music at ${result.metadata.bpm} BPM in ${result.metadata.key}.`,\n      },\n      action: {\n        type: 'music_generated',\n        payload: {\n          id: result.id,\n          audioUrl: result.audioUrl,\n          duration: result.duration,\n          metadata: result.metadata,\n          title: result.title || params.title,\n        },\n      },\n    };\n  } catch (error) {\n    console.error('[MusicGen] Error:', error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Music generation failed.',\n    };\n  }\n}\n\ninterface AnalyzeAudioArgs {\n  audioUrl: string;\n  extract?: ('bpm' | 'key' | 'time_signature' | 'caption' | 'lyrics')[];\n}\n\nasync function executeAnalyzeAudio(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  // SECURITY: Owner only\n  if (context.accessLevel !== 'owner') {\n    return {\n      success: false,\n      error: 'Audio analysis is only available to the owner.',\n    };\n  }\n\n  const params = args as unknown as AnalyzeAudioArgs;\n\n  if (!params.audioUrl) {\n    return {\n      success: false,\n      error: 'audioUrl is required for analysis.',\n    };\n  }\n\n  try {\n    console.log('[MusicGen] Analyzing audio:', params.audioUrl);\n\n    const response = await fetch(`${getBaseUrl()}/api/music/generate`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        action: 'analyze',\n        audioUrl: params.audioUrl,\n        extract: params.extract || ['bpm', 'key', 'time_signature', 'caption'],\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      return {\n        success: false,\n        error: error.error || 'Audio analysis failed.',\n      };\n    }\n\n    const result = await response.json();\n\n    return {\n      success: true,\n      data: {\n        ...result,\n        message: `Analysis complete: ${result.bpm ? `${result.bpm} BPM` : ''}${result.key ? `, ${result.key}` : ''}${result.caption ? `. ${result.caption}` : ''}`,\n      },\n      action: {\n        type: 'audio_analyzed',\n        payload: result,\n      },\n    };\n  } catch (error) {\n    console.error('[MusicGen] Analysis error:', error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Audio analysis failed.',\n    };\n  }\n}\n\ninterface SeparateStemsArgs {\n  audioUrl: string;\n  stems?: ('vocals' | 'drums' | 'bass' | 'other' | 'piano' | 'guitar')[];\n}\n\nasync function executeSeparateStems(\n  args: Record<string, unknown>,\n  context: ExecutionContext\n): Promise<ToolResult> {\n  // SECURITY: Owner only\n  if (context.accessLevel !== 'owner') {\n    return {\n      success: false,\n      error: 'Stem separation is only available to the owner.',\n    };\n  }\n\n  const params = args as unknown as SeparateStemsArgs;\n\n  if (!params.audioUrl) {\n    return {\n      success: false,\n      error: 'audioUrl is required for stem separation.',\n    };\n  }\n\n  try {\n    console.log('[MusicGen] Separating stems:', params.audioUrl);\n\n    const response = await fetch(`${getBaseUrl()}/api/music/generate`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        action: 'separate',\n        audioUrl: params.audioUrl,\n        stems: params.stems || ['vocals', 'drums', 'bass', 'other'],\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      return {\n        success: false,\n        error: error.error || 'Stem separation failed.',\n      };\n    }\n\n    const result = await response.json();\n    const stemCount = Object.keys(result.stems).length;\n\n    return {\n      success: true,\n      data: {\n        stems: result.stems,\n        provider: result.provider,\n        message: `Separated ${stemCount} stems: ${Object.keys(result.stems).join(', ')}`,\n      },\n      action: {\n        type: 'stems_separated',\n        payload: result,\n      },\n    };\n  } catch (error) {\n    console.error('[MusicGen] Separation error:', error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Stem separation failed.',\n    };\n  }\n}\n\n// Helper to get base URL for internal API calls\nfunction getBaseUrl(): string {\n  if (typeof window !== 'undefined') {\n    return window.location.origin;\n  }\n  // Server-side: use environment variable or default\n  return process.env.NEXT_PUBLIC_APP_URL || process.env.VERCEL_URL\n    ? `https://${process.env.VERCEL_URL}`\n    : 'http://localhost:3000';\n}\n"],"names":[],"mappings":"+CA+KO,IAAM,EAA0B,CACrC,OACA,QACA,SACA,SACA,WACA,OACA,QACA,SACA,SACA,SACA,SACA,QACA,SACD,CAKY,EAAkC,CAC7C,CACE,KAAM,gBACN,YACE,kLACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YACE,8GACJ,EACA,SAAU,CACR,KAAM,SACN,YAAa,8BACb,KAAM,CAAC,WAAY,SAAU,OAAQ,YAAa,MAAM,AAC1D,CACF,EACA,SAAU,CAAC,QAAQ,AACrB,CACF,EACA,CACE,KAAM,cACN,YACE,8KACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,YAAa,CACX,KAAM,SACN,YAAa,0BACb,KAAM,IAAI,EAAwB,AACpC,EACA,MAAO,CACL,KAAM,SACN,YACE,sFACJ,CACF,EACA,SAAU,CAAC,cAAc,AAC3B,CACF,EACA,CACE,KAAM,gBACN,YACE,mIACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YACE,6DACJ,CACF,EACA,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,sBACN,YACE,gJACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,KAAM,CACJ,KAAM,SACN,YACE,8FACJ,EACA,SAAU,CACR,KAAM,SACN,YACE,2EACJ,CACF,EACA,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,wBACN,YACE,4GACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YAAa,sDACf,CACF,EACA,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,eACN,YACE,8HACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,UAAW,CACT,KAAM,SACN,YAAa,6CACf,EACA,WAAY,CACV,KAAM,SACN,YAAa,sDACf,EACA,UAAW,CACT,KAAM,SACN,YAAa,gDACf,EACA,MAAO,CACL,KAAM,SACN,YAAa,sCACf,EACA,SAAU,CACR,KAAM,SACN,YAAa,8CACf,CACF,EACA,SAAU,CAAC,YAAa,aAAc,YAAY,AACpD,CACF,EACA,CACE,KAAM,qBACN,YACE,+HACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,UAAW,CACT,KAAM,SACN,YAAa,sCACf,EACA,aAAc,CACZ,KAAM,SACN,YAAa,oDACf,CACF,EACA,SAAU,CAAC,YAAa,eAC1B,AADyC,CAE3C,EACA,CACE,KAAM,iBACN,YACE,wFACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,UAAW,CACT,KAAM,SACN,YAAa,kCACf,EACA,OAAQ,CACN,KAAM,SACN,YAAa,mCACf,CACF,EACA,SAAU,CAAC,YAAY,AACzB,CACF,EACA,CACE,KAAM,cACN,YACE,mJACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,SAAU,CACR,KAAM,SACN,YAAa,iCACb,KAAM,CAAC,MAAO,OAAQ,QAAS,WAAY,UAC7C,AADuD,CAEzD,EACA,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,kBACN,YACE,2RACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YAAa,gDACf,CACF,EACA,SAAU,CAAC,QAAQ,AACrB,CACF,EACA,CACE,KAAM,eACN,YACE,iHACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,SAAU,CACR,KAAM,SACN,YAAa,sDACf,CACF,EACA,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,oBACN,YACE,uHACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,OAAQ,CACN,KAAM,SACN,YAAa,yBACb,KAAM,CAAC,MAAO,OAAQ,cAAe,OAAQ,UAAU,AACzD,EACA,IAAK,CACH,KAAM,SACN,YAAa,mDACf,EACA,MAAO,CACL,KAAM,SACN,YAAa,6CACf,CACF,EACA,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,cACN,YACE,8GACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YAAa,sCACf,CACF,EACA,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,YACN,YACE,kTACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,QAAS,CACP,KAAM,SACN,YACE,gPACJ,EACA,MAAO,CACL,KAAM,SACN,YAAa,8CACf,CACF,EACA,SAAU,CAAC,UAAU,AACvB,CACF,EAKA,CACE,KAAM,iBACN,YACE,+LACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,KAAM,CACJ,KAAM,SACN,YAAa,sEACf,EACA,YAAa,CACX,KAAM,SACN,YAAa,6DACf,EACA,MAAO,CACL,KAAM,SACN,YAAa,2EACf,CACF,EACA,SAAU,CAAC,OAAO,AACpB,CACF,EACA,CACE,KAAM,aACN,YACE,0QACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,UAAW,CACT,KAAM,SACN,YAAa,6CACf,EACA,MAAO,CACL,KAAM,SACN,YAAa,wDACf,EACA,iBAAkB,CAChB,KAAM,SACN,YAAa,mDACf,EACA,iBAAkB,CAChB,KAAM,SACN,YAAa,yCACf,CACF,EACA,SAAU,CAAC,YAAa,QAAQ,AAClC,CACF,EACA,CACE,KAAM,gBACN,YACE,uMACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,UAAW,CACT,KAAM,SACN,YAAa,4CACf,EACA,MAAO,CACL,KAAM,SACN,YAAa,yBACf,EACA,YAAa,CACX,KAAM,SACN,YAAa,oCACf,EACA,KAAM,CACJ,KAAM,SACN,YAAa,qBACb,KAAM,CAAC,QAAS,MAAO,OAAQ,QAAS,QAAQ,AAClD,EACA,SAAU,CACR,KAAM,SACN,YAAa,2DACb,KAAM,CAAC,KAAM,KAAM,KAAM,KAAK,AAChC,EACA,IAAK,CACH,KAAM,SACN,YAAa,uCACf,EACA,MAAO,CACL,KAAM,SACN,YAAa,0CACf,EACA,OAAQ,CACN,KAAM,SACN,YAAa,wCACf,EACA,OAAQ,CACN,KAAM,QACN,MAAO,CAAE,KAAM,QAAS,EACxB,YAAa,4BACf,CACF,EACA,SAAU,CAAC,YAAa,QAAQ,AAClC,CACF,EACA,CACE,KAAM,gBACN,YACE,gKACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,SAAU,CACR,KAAM,SACN,YAAa,iDACf,EACA,OAAQ,CACN,KAAM,SACN,YAAa,4BACb,KAAM,CAAC,UAAW,OAAQ,cAAe,SAAU,OAAQ,YAAY,AACzE,EACA,SAAU,CACR,KAAM,SACN,YAAa,qBACb,KAAM,CAAC,KAAM,KAAM,KAAM,KAC3B,AADgC,EAEhC,MAAO,CACL,KAAM,SACN,YAAa,0BACf,EACA,YAAa,CACX,KAAM,SACN,YAAa,gCACf,EACA,WAAY,CACV,KAAM,SACN,YAAa,gEACf,CACF,EACA,SAAU,CAAC,WAAW,AACxB,CACF,EACA,CACE,KAAM,YACN,YACE,iNACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YAAa,4BACf,EACA,UAAW,CACT,KAAM,SACN,YAAa,0CACf,CACF,EACA,SAAU,CAAC,QAAS,YAAY,AAClC,CACF,EACA,CACE,KAAM,qBACN,YACE,yIACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,UAAW,CACT,KAAM,SACN,YAAa,mDACf,CACF,EACA,SAAU,CAAC,YAAY,AACzB,CACF,EACA,CACE,KAAM,gBACN,YACE,kIACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,OAAQ,CACN,KAAM,SACN,YAAa,oCACb,KAAM,CAAC,YAAa,SAAU,WAAY,WAAY,WAAY,WAAW,AAC/E,CACF,EACA,SAAU,EAAE,AACd,CACF,EAMA,CACE,KAAM,WACN,YACE,iMACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YAAa,kIACf,EACA,WAAY,CACV,KAAM,SACN,YAAa,iCACb,KAAM,CAAC,MAAO,cAAe,WAAY,aAAc,WAAY,YACrE,AADiF,EAEjF,MAAO,CACL,KAAM,SACN,YAAa,mDACf,CACF,EACA,SAAU,CAAC,QACb,AADqB,CAEvB,EACA,CACE,KAAM,oBACN,YACE,sPACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,SAAU,CACR,KAAM,SACN,YAAa,uCACb,KAAM,CAAC,aAAc,QAAS,UAAW,OAAO,AAClD,EACA,IAAK,CACH,KAAM,SACN,YAAa,4EACf,CACF,EACA,SAAU,CAAC,WAAW,AACxB,CACF,EACA,CACE,KAAM,WACN,YACE,+OACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,QAAS,CACP,KAAM,SACN,YAAa,0FACf,EACA,WAAY,CACV,KAAM,SACN,YAAa,8BACb,KAAM,CAAC,cAAe,WAAY,aAAc,WAAY,YAAY,AAC1E,EACA,WAAY,CACV,KAAM,SACN,YAAa,kFACf,EACA,UAAW,CACT,KAAM,SACN,YAAa,mDACf,CACF,EACA,SAAU,CAAC,UAAW,aAAa,AACrC,CACF,EACA,CACE,KAAM,QACN,YACE,4NACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,SAAU,CACR,KAAM,SACN,YAAa,0CACb,KAAM,CAAC,aAAc,QAAS,UAAW,OAC3C,AADkD,EAElD,IAAK,CACH,KAAM,SACN,YAAa,8FACf,EACA,MAAO,CACL,KAAM,SACN,YAAa,mEACf,EACA,WAAY,CACV,KAAM,SACN,YAAa,qFACf,CACF,EACA,SAAU,CAAC,WAAY,MAAO,QAAQ,AACxC,CACF,EACA,CACE,KAAM,SACN,YACE,6MACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,SAAU,CACR,KAAM,SACN,YAAa,gCACf,EACA,WAAY,CACV,KAAM,SACN,YAAa,8FACb,KAAM,CAAC,WAAY,WAAW,AAChC,CACF,EACA,SAAU,CAAC,WAAY,aAAa,AACtC,CACF,EAWA,CACE,KAAM,qBACN,YACE,6NACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,UAAW,CACT,KAAM,SACN,YAAa,8BACf,EACA,YAAa,CACX,KAAM,SACN,YAAa,gDACf,EACA,MAAO,CACL,KAAM,SACN,YAAa,0BACf,EACA,SAAU,CACR,KAAM,SACN,YAAa,6BACf,EACA,SAAU,CACR,KAAM,SACN,YAAa,oCACf,EACA,UAAW,CACT,KAAM,SACN,YAAa,8BACf,EACA,cAAe,CACb,KAAM,SACN,YAAa,kCACf,CACF,EACA,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,qBACN,YACE,+LACF,WAAY,CACV,KAAM,SACN,WAAY,CAAC,EACb,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,8BACN,YACE,iOACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,cAAe,CACb,KAAM,SACN,YAAa,qCACb,KAAM,CAAC,SAAU,UAAW,MAAO,OAAQ,SAAU,SAAS,AAChE,EACA,YAAa,CACX,KAAM,SACN,YAAa,2EACf,CACF,EACA,SAAU,CAAC,gBAAiB,cAAc,AAC5C,CACF,EAKA,CACE,KAAM,mBACN,YACE,yOACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,IAAK,CACH,KAAM,SACN,YAAa,mEACf,EACA,OAAQ,CACN,KAAM,SACN,YAAa,uDACf,CACF,EACA,SAAU,CAAC,MAAM,AACnB,CACF,EACA,CACE,KAAM,iBACN,YACE,qJACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,KAAM,CACJ,KAAM,SACN,YAAa,oEACf,EACA,UAAW,CACT,KAAM,UACN,YAAa,kDACf,EACA,SAAU,CACR,KAAM,SACN,YAAa,kDACf,CACF,EACA,SAAU,CAAC,OAAO,AACpB,CACF,EACA,CACE,KAAM,kBACN,YACE,wJACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,QAAS,CACP,KAAM,SACN,YAAa,qCACf,EACA,KAAM,CACJ,KAAM,SACN,YAAa,0DACf,EACA,YAAa,CACX,KAAM,SACN,YAAa,sDACf,EACA,cAAe,CACb,KAAM,UACN,YAAa,mDACf,EACA,WAAY,CACV,KAAM,SACN,YAAa,mDACf,CACF,EACA,SAAU,CAAC,UAAU,AACvB,CACF,EAKA,CACE,KAAM,YACN,YACE,qKACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,KAAM,CACJ,KAAM,SACN,YAAa,8CACf,EACA,UAAW,CACT,KAAM,SACN,YAAa,2CACf,EACA,QAAS,CACP,KAAM,SACN,YAAa,yCACf,CACF,EACA,SAAU,CAAC,OAAO,AACpB,CACF,EACA,CACE,KAAM,aACN,YACE,yKACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,KAAM,CACJ,KAAM,SACN,YAAa,8CACf,EACA,QAAS,CACP,KAAM,SACN,YAAa,kCACf,EACA,kBAAmB,CACjB,KAAM,UACN,YAAa,gEACf,CACF,EACA,SAAU,CAAC,OAAQ,UAAU,AAC/B,CACF,EACA,CACE,KAAM,YACN,YACE,wKACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,KAAM,CACJ,KAAM,SACN,YAAa,8CACf,EACA,QAAS,CACP,KAAM,SACN,YAAa,oCACf,EACA,QAAS,CACP,KAAM,SACN,YAAa,6BACf,EACA,WAAY,CACV,KAAM,UACN,YAAa,+DACf,CACF,EACA,SAAU,CAAC,OAAQ,UAAW,UAAU,AAC1C,CACF,EACA,CACE,KAAM,cACN,YACE,sHACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,KAAM,CACJ,KAAM,SACN,YAAa,4CACf,EACA,UAAW,CACT,KAAM,UACN,YAAa,+CACf,CACF,EACA,SAAU,CAAC,OAAO,AACpB,CACF,EAKA,CACE,KAAM,cACN,YACE,6KACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,QAAS,CACP,KAAM,SACN,YAAa,4DACf,EACA,IAAK,CACH,KAAM,SACN,YAAa,oDACf,EACA,QAAS,CACP,KAAM,SACN,YAAa,0CACf,CACF,EACA,SAAU,CAAC,UAAU,AACvB,CACF,EACA,CACE,KAAM,mBACN,YACE,6IACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,QAAS,CACP,KAAM,SACN,YAAa,mEACf,EACA,KAAM,CACJ,KAAM,SACN,YAAa,iDACf,CACF,EACA,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,kBACN,YACE,mIACF,WAAY,CACV,KAAM,SACN,WAAY,CAAC,EACb,SAAU,EACZ,AADc,CAEhB,EAKA,CACE,KAAM,aACN,YACE,wIACF,WAAY,CACV,KAAM,SACN,WAAY,CAAC,EACb,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,WACN,YACE,uGACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,KAAM,CACJ,KAAM,SACN,YAAa,uCACf,EACA,OAAQ,CACN,KAAM,UACN,YAAa,kEACf,CACF,EACA,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,aACN,YACE,yIACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,QAAS,CACP,KAAM,SACN,YAAa,2CACf,EACA,SAAU,CACR,KAAM,UACN,YAAa,6DACf,CACF,EACA,SAAU,CAAC,UAAU,AACvB,CACF,EACA,CACE,KAAM,WACN,YACE,8IACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,OAAQ,CACN,KAAM,SACN,YAAa,iDACf,EACA,YAAa,CACX,KAAM,UACN,YAAa,uEACf,CACF,EACA,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,gBACN,YACE,mJACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,KAAM,CACJ,KAAM,SACN,YAAa,kGACf,EACA,WAAY,CACV,KAAM,SACN,YAAa,wDACf,CACF,EACA,SAAU,EAAE,AACd,CACF,EAKA,CACE,KAAM,qBACN,YACE,6JACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YAAa,kCACf,EACA,YAAa,CACX,KAAM,SACN,YAAa,+CACf,EACA,UAAW,CACT,KAAM,SACN,YAAa,0CACf,EACA,SAAU,CACR,KAAM,SACN,YAAa,yCACf,EACA,cAAe,CACb,KAAM,SACN,YAAa,kCACf,CACF,EACA,SAAU,CAAC,QAAS,cAAc,AACpC,CACF,EACA,CACE,KAAM,qBACN,YACE,kHACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,OAAQ,CACN,KAAM,SACN,YAAa,qCACf,EACA,OAAQ,CACN,KAAM,SACN,YAAa,0BACb,KAAM,CAAC,UAAW,UAAW,gBAAiB,YAAa,SAAU,YACvE,AADmF,EAEnF,cAAe,CACb,KAAM,QACN,MAAO,CAAE,KAAM,QAAS,EACxB,YAAa,kCACf,EACA,UAAW,CACT,KAAM,SACN,YAAa,0CACf,CACF,EACA,SAAU,CAAC,SAAS,AACtB,CACF,EACA,CACE,KAAM,oBACN,YACE,4FACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,OAAQ,CACN,KAAM,SACN,YAAa,4BACb,KAAM,CAAC,UAAW,UAAW,gBAAiB,YAAa,SAAU,YAAY,AACnF,EACA,MAAO,CACL,KAAM,SACN,YAAa,iDACf,CACF,EACA,SAAU,EAAE,AACd,CACF,EAMA,CACE,KAAM,kBACN,YACE,0TACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,KAAM,CACJ,KAAM,SACN,YAAa,0FACf,EACA,YAAa,CACX,KAAM,SACN,YAAa,mDACf,EACA,aAAc,CACZ,KAAM,SACN,YAAa,+BACb,KAAM,CAAC,OAAQ,WAAY,QAAS,SAAS,AAC/C,EACA,aAAc,CACZ,KAAM,SACN,YAAa,gIACf,EACA,WAAY,CACV,KAAM,QACN,MAAO,CAAE,KAAM,QAAS,EACxB,YAAa,+DACf,EACA,WAAY,CACV,KAAM,SACN,YAAa,wCACb,KAAM,CAAC,aAAc,QAAS,UAAU,AAC1C,EACA,OAAQ,CACN,KAAM,SACN,YAAa,+DACf,EACA,aAAc,CACZ,KAAM,SACN,YAAa,6BACf,EACA,UAAW,CACT,KAAM,SACN,YAAa,6BACf,EACA,eAAgB,CACd,KAAM,SACN,YAAa,oDACf,EACA,WAAY,CACV,KAAM,SACN,YAAa,8BACf,EACA,gBAAiB,CACf,KAAM,SACN,YAAa,sDACb,KAAM,CAAC,MAAO,QAAS,WAAY,WAAW,AAChD,EACA,SAAU,CACR,KAAM,SACN,YAAa,0FACf,CACF,EACA,SAAU,CAAC,OAAQ,eAAgB,aAAa,AAClD,CACF,EACA,CACE,KAAM,iBACN,YACE,4HACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,gBAAiB,CACf,KAAM,UACN,YAAa,6DACf,CACF,EACA,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,kBACN,YACE,kHACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YAAa,6BACf,CACF,EACA,SAAU,CAAC,QAAQ,AACrB,CACF,EACA,CACE,KAAM,kBACN,YACE,wGACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YAAa,6BACf,CACF,EACA,SAAU,CAAC,QAAQ,AACrB,CACF,EAKA,CACE,KAAM,uBACN,YACE,uFACA,uFACA,kFACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,UAAW,CACT,KAAM,SACN,YAAa,gCACf,EACA,gBAAiB,CACf,KAAM,SACN,YAAa,6DACf,EACA,aAAc,CACZ,KAAM,SACN,YAAa,kEACf,CACF,EACA,SAAU,CAAC,YAAY,AACzB,CACF,EACA,CACE,KAAM,yBACN,YACE,0EACA,6DACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,UAAW,CACT,KAAM,SACN,YAAa,2CACf,CACF,EACA,SAAU,CAAC,YACb,AADyB,CAE3B,EAKA,CACE,KAAM,4BACN,YACE,+EACA,qFACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,gBAAiB,CACf,KAAM,UACN,YAAa,gDACf,CACF,EACA,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,4BACN,YACE,oFACA,4DACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,SAAU,CACR,KAAM,SACN,KAAM,CAAC,WAAY,WAAY,WAAY,QAAS,UAAU,CAC9D,YAAa,wCACf,EACA,MAAO,CACL,KAAM,SACN,YAAa,+CACf,CACF,EACA,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,uBACN,YACE,6EACA,+EACA,+CACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,cAAe,CACb,KAAM,SACN,YAAa,4CACf,EACA,YAAa,CACX,KAAM,SACN,YAAa,wDACf,EACA,QAAS,CACP,KAAM,SACN,YAAa,yBACf,EACA,YAAa,CACX,KAAM,SACN,KAAM,CAAC,OAAQ,QAAQ,CACvB,YAAa,8BACf,CACF,EACA,SAAU,CAAC,gBAAiB,cAAe,UAAU,AACvD,EACA,WAAW,CACb,EACA,CACE,KAAM,0BACN,YACE,kFACA,oEACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YAAa,cACf,EACA,SAAU,CACR,KAAM,SACN,KAAM,CAAC,WAAY,WAAY,WAAY,QAAS,UAAU,CAC9D,YAAa,wCACf,EACA,MAAO,CACL,KAAM,SACN,YAAa,yCACf,CACF,EACA,SAAU,CAAC,QAAQ,AACrB,CACF,EAMA,CACE,KAAM,mBACN,YACE,8EACA,mFACA,+EACA,oBACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,KAAM,CACJ,KAAM,SACN,YAAa,yEACf,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CAAC,gBAAiB,WAAY,SAAS,AACnD,CACF,EACA,CACE,KAAM,qBACN,YACE,kFACA,4BACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,cAAe,CACb,KAAM,SACN,YAAa,6BACf,EACA,SAAU,CACR,KAAM,SACN,YAAa,gDACf,EACA,UAAW,CACT,KAAM,SACN,YAAa,gBACb,KAAM,CAAC,QAAS,QAAQ,AAC1B,EACA,UAAW,CACT,KAAM,SACN,YAAa,qCACf,EACA,SAAU,CACR,KAAM,SACN,YAAa,iDACf,EACA,SAAU,CACR,KAAM,SACN,YAAa,2BACf,EACA,MAAO,CACL,KAAM,SACN,YAAa,kCACf,EACA,QAAS,CACP,KAAM,SACN,YAAa,aACf,EACA,UAAW,CACT,KAAM,SACN,YAAa,mCACb,KAAM,CAAC,UAAW,QAAS,OAAO,AACpC,CACF,EACA,SAAU,CAAC,gBAAiB,WAAY,YAAY,AACtD,CACF,EACA,CACE,KAAM,gBACN,YACE,wFACA,4CACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,cAAe,CACb,KAAM,SACN,YAAa,wCACf,EACA,aAAc,CACZ,KAAM,UACN,YAAa,qEACf,CACF,EACA,SAAU,CAAC,gBAAgB,AAC7B,CACF,EACA,CACE,KAAM,eACN,YACE,2FACA,+FACA,4DACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,cAAe,CACb,KAAM,SACN,YAAa,uCACf,EACA,OAAQ,CACN,KAAM,SACN,YAAa,gBACb,KAAM,CAAC,MAAO,OAAQ,MAAM,AAC9B,EACA,QAAS,CACP,KAAM,SACN,YAAa,+DACb,KAAM,CAAC,QAAS,WAAY,OAAO,AACrC,EACA,KAAM,CACJ,KAAM,SACN,YAAa,gEACb,KAAM,CAAC,UAAW,SAAS,AAC7B,CACF,EACA,SAAU,CAAC,gBAAgB,AAC7B,CACF,EACA,CACE,KAAM,uBACN,YACE,8FACA,6FACA,wBACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,SAAU,CACR,KAAM,SACN,YAAa,+BACf,EACA,OAAQ,CACN,KAAM,SACN,YAAa,iEACf,EACA,SAAU,CACR,KAAM,SACN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O,CAAE,KAAM,QAAS,EACxB,YAAa,uCACf,EACA,QAAS,CACP,KAAM,SACN,YAAa,qCACf,EACA,SAAU,CACR,KAAM,SACN,YAAa,6BACf,EACA,SAAU,CACR,KAAM,UACN,YAAa,iDACf,CACF,EACA,SAAU,CAAC,OACb,AADoB,CAEtB,EAMA,CACE,KAAM,uBACN,YACE,uFACA,4FACA,yFACA,wFAEF,EADE,SACU,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YAAa,2EACf,EACA,eAAgB,CACd,KAAM,SACN,YAAa,sDACf,EACA,WAAY,CACV,KAAM,SACN,YAAa,uCACb,KAAM,CAAC,iBAAkB,SAAU,UAAW,YAAa,cAAe,aAAa,AACzF,EACA,kBAAmB,CACjB,KAAM,SACN,YAAa,6DACf,EACA,SAAU,CACR,KAAM,SACN,YAAa,gDACf,EACA,KAAM,CACJ,KAAM,SACN,YAAa,kCACb,KAAM,CAAC,eAAgB,SAAU,cAAe,eAClD,AADiE,CAEnE,EACA,SAAU,CAAC,QAAS,iBAAiB,AACvC,CACF,EACA,CACE,KAAM,wBACN,YACE,mFACA,sFACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YAAa,iCACf,EACA,SAAU,CACR,KAAM,SACN,YAAa,iFACf,EACA,KAAM,CACJ,KAAM,SACN,YAAa,qBACb,KAAM,CAAC,eAAgB,SAAU,cAAe,eAClD,AADiE,EAEjE,MAAO,CACL,KAAM,SACN,YAAa,sBACb,KAAM,CAAC,YAAa,YAAa,WAAY,QAAQ,AACvD,CACF,EACA,SAAU,CAAC,QAAQ,AACrB,CACF,EACA,CACE,KAAM,uBACN,YACE,4FACA,6FACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,KAAM,CACJ,KAAM,SACN,YAAa,+BACf,EACA,QAAS,CACP,KAAM,SACN,YAAa,4DACf,EACA,UAAW,CACT,KAAM,SACN,YAAa,yEACf,EACA,gBAAiB,CACf,KAAM,SACN,YAAa,0DACf,CACF,EACA,SAAU,CAAC,OAAO,AACpB,CACF,EACA,CACE,KAAM,2BACN,YACE,0FACA,kGACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,aAAc,CACZ,KAAM,SACN,YAAa,gDACf,CACF,EACA,SAAU,EAAE,AACd,CACF,EAOA,CACE,KAAM,iBACN,YACE,2FACA,qGACA,uEACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,OAAQ,CACN,KAAM,SACN,YAAa,gGACf,EACA,gBAAiB,CACf,KAAM,SACN,YAAa,iFACf,EACA,OAAQ,CACN,KAAM,SACN,YAAa,6CACb,KAAM,CAAC,kBAAmB,iBAAkB,iBAAkB,gBAAiB,SAAU,YAC3F,AADuG,EAEvG,iBAAkB,CAChB,KAAM,SACN,YAAa,uDACf,EACA,KAAM,CACJ,KAAM,SACN,YAAa,iCACf,CACF,EACA,SAAU,CAAC,SAAS,AACtB,CACF,EACA,CACE,KAAM,gBACN,YACE,+FACA,0GACA,yBACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,UAAW,CACT,KAAM,SACN,YAAa,6BACf,EACA,OAAQ,CACN,KAAM,SACN,YAAa,2GACf,EACA,gBAAiB,CACf,KAAM,SACN,YAAa,gCACf,EACA,iBAAkB,CAChB,KAAM,SACN,YAAa,uDACf,EACA,KAAM,CACJ,KAAM,SACN,YAAa,iCACf,CACF,EACA,SAAU,CAAC,YAAa,SAC1B,AADmC,CAErC,EACA,CACE,KAAM,qBACN,YACE,qFACA,yDACF,WAAY,CACV,KAAM,SACN,WAAY,CAAC,EACb,SAAU,EAAE,AACd,CACF,EAQA,CACE,KAAM,aACN,YACE,yFACA,kGACA,8FACA,qFACA,wCACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,KAAM,CACJ,KAAM,SACN,YAAa,2EACf,EACA,MAAO,CACL,KAAM,SACN,YAAa,2EACf,EACA,eAAgB,CACd,KAAM,SACN,YAAa,sEACf,EACA,eAAgB,CACd,KAAM,UACN,YAAa,uEACf,EACA,SAAU,CACR,KAAM,SACN,YAAa,mCACb,KAAM,CAAC,MAAO,SAAU,OAAO,AACjC,EACA,QAAS,CACP,KAAM,SACN,YAAa,6EACf,CACF,EACA,SAAU,CAAC,OAAO,AACpB,CACF,EACA,CACE,KAAM,wBACN,YACE,kFACA,2CACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,OAAQ,CACN,KAAM,SACN,YAAa,wBACb,KAAM,CAAC,SAAU,UAAW,YAAa,SAAU,YAAa,MAAM,AACxE,EACA,MAAO,CACL,KAAM,SACN,YAAa,iDACf,CACF,EACA,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,yBACN,YACE,iFACA,yDACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YAAa,kCACf,CACF,EACA,SAAU,CAAC,QAAQ,AACrB,CACF,EACA,CACE,KAAM,kBACN,YACE,oFACA,kCACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YAAa,2CACf,CACF,EACA,SAAU,CAAC,QAAQ,AACrB,CACF,EACA,CACE,KAAM,kBACN,YACE,wFACA,kFACA,4FACA,sCACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,KAAM,CACJ,KAAM,SACN,YAAa,yGACf,EACA,UAAW,CACT,KAAM,SACN,YAAa,2CACf,EACA,cAAe,CACb,KAAM,SACN,YAAa,oEACf,EACA,cAAe,CACb,KAAM,UACN,YAAa,iDACf,EACA,cAAe,CACb,KAAM,UACN,YAAa,uDACf,EACA,YAAa,CACX,KAAM,SACN,YAAa,iEACf,CACF,EACA,SAAU,CAAC,OAAQ,YACrB,AADiC,CAEnC,EACA,CACE,KAAM,yBACN,YACE,mFACA,8EACA,0DACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,WAAY,CACV,KAAM,SACN,YAAa,wCACb,KAAM,CACJ,gBACA,mBACA,sBACA,uBACA,iBACA,qBAEJ,AADG,EAEH,KAAM,CACJ,KAAM,SACN,YAAa,kDACf,EACA,QAAS,CACP,KAAM,SACN,YAAa,gEACf,EACA,eAAgB,CACd,KAAM,UACN,YAAa,sDACf,CACF,EACA,SAAU,CAAC,aAAc,OAC3B,AADkC,CAEpC,EAMA,CACE,KAAM,yBACN,YACE,sFACA,qFACA,oGACA,mDACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,eAAgB,CACd,KAAM,UACN,YAAa,yDACf,CACF,EACA,SAAU,EAAE,AACd,EACA,WAAW,CACb,EACA,CACE,KAAM,0BACN,YACE,yFACA,4FACA,2EACF,WAAY,CACV,KAAM,SACN,WAAY,CAAC,EACb,SAAU,EAAE,AACd,EACA,WAAW,CACb,EAMA,CACE,KAAM,kBACN,YACE,6FACA,iFACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,OAAQ,CACN,KAAM,SACN,YAAa,oDACf,CACF,EACA,SAAU,CAAC,SAAS,AACtB,CACF,EACA,CACE,KAAM,sBACN,YACE,gFACA,sCACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YAAa,2DACf,EACA,OAAQ,CACN,KAAM,SACN,YAAa,6BACb,KAAM,CAAC,UAAW,OAAQ,cAAe,SAAU,OAAO,AAC5D,CACF,EACA,SAAU,CAAC,QAAQ,AACrB,CACF,EAMA,CACE,KAAM,gBACN,YACE,8FACA,gGACA,kFACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,KAAM,CACJ,KAAM,SACN,YAAa,uEACf,EACA,WAAY,CACV,KAAM,SACN,YAAa,wBACb,KAAM,CAAC,WAAY,YAAa,YAAa,aAAc,UAAW,YACxE,AADoF,EAEpF,YAAa,CACX,KAAM,SACN,YAAa,iDACf,EACA,gBAAiB,CACf,KAAM,SACN,YAAa,uEACf,EACA,YAAa,CACX,KAAM,UACN,YAAa,4CACf,CACF,EACA,SAAU,CAAC,OAAQ,aAAa,AAClC,CACF,EACA,CACE,KAAM,gBACN,YACE,qFACA,2BACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,OAAQ,CACN,KAAM,SACN,YAAa,0BACb,KAAM,CAAC,SAAU,WAAY,WAAW,AAC1C,EACA,MAAO,CACL,KAAM,SACN,YAAa,oDACf,CACF,EACA,SAAU,EACZ,AADc,CAEhB,EACA,CACE,KAAM,aACN,YACE,sFACA,+CACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,SAAU,CACR,KAAM,SACN,YAAa,kCACf,CACF,EACA,SAAU,CAAC,WAAW,AACxB,CACF,EACA,CACE,KAAM,kBACN,YACE,wFACA,sFACA,6DACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,SAAU,CACR,KAAM,SACN,YAAa,yCACf,EACA,SAAU,CACR,KAAM,SACN,YAAa,yBACb,KAAM,CAAC,OAAQ,QAAS,QAAS,SAAU,QAAS,OAAQ,QAAS,QAAS,QAAS,OAAO,AAChG,EACA,EAAG,CACD,KAAM,SACN,YAAa,uCACf,EACA,EAAG,CACD,KAAM,SACN,YAAa,sCACf,EACA,MAAO,CACL,KAAM,SACN,YAAa,uDACf,EACA,OAAQ,CACN,KAAM,SACN,YAAa,wDACf,EACA,QAAS,CACP,KAAM,SACN,YAAa,uLACf,EACA,MAAO,CACL,KAAM,SACN,YAAa,kJACf,CACF,EACA,SAAU,CAAC,WAAY,WAAY,IAAK,IAAK,UAAU,AACzD,CACF,EACA,CACE,KAAM,kBACN,YACE,oFACA,sFACA,yCACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,SAAU,CACR,KAAM,SACN,YAAa,sBACf,EACA,aAAc,CACZ,KAAM,SACN,YAAa,+CACf,EACA,aAAc,CACZ,KAAM,SACN,YAAa,6CACf,EACA,SAAU,CACR,KAAM,SACN,YAAa,0BACb,KAAM,CAAC,WAAY,SAAU,OAAQ,QAAQ,AAC/C,EACA,MAAO,CACL,KAAM,SACN,YAAa,uCACf,EACA,MAAO,CACL,KAAM,SACN,YAAa,+FACf,CACF,EACA,SAAU,CAAC,WAAY,eAAgB,eAAgB,WAAW,AACpE,CACF,EACA,CACE,KAAM,qBACN,YACE,sFACA,uBACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,SAAU,CACR,KAAM,SACN,YAAa,sBACf,EACA,OAAQ,CACN,KAAM,SACN,YAAa,8BACf,EACA,EAAG,CACD,KAAM,SACN,YAAa,gBACf,EACA,EAAG,CACD,KAAM,SACN,YAAa,gBACf,EACA,MAAO,CACL,KAAM,SACN,YAAa,WACf,EACA,OAAQ,CACN,KAAM,SACN,YAAa,YACf,EACA,QAAS,CACP,KAAM,SACN,YAAa,aACf,EACA,MAAO,CACL,KAAM,SACN,YAAa,gBACf,CACF,EACA,SAAU,CAAC,WAAY,SAAS,AAClC,CACF,EAMA,CACE,KAAM,qBACN,YACE,2FACA,gFACA,0EACF,WAAW,EACX,WAAY,CACV,KAAM,SACN,WAAY,CACV,KAAM,CACJ,KAAM,SACN,YACE,6FACJ,CACF,EACA,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,oBACN,YACE,0FACA,2FACA,oEACF,WAAW,EACX,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YAAa,kDACf,CACF,EACA,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,oBACN,YACE,2FACA,4FACA,oCACF,WAAW,EACX,WAAY,CACV,KAAM,SACN,WAAY,CACV,OAAQ,CACN,KAAM,SACN,YAAa,6BACb,KAAM,CACJ,QACA,WACA,eACA,YACA,mBACA,uBACA,gBACA,SACA,UACA,cACA,iBACA,UACA,kBACA,aACD,AACH,EACA,UAAW,CACT,KAAM,SACN,YAAa,0DACf,EACA,QAAS,CACP,KAAM,SACN,YAAa,mDACf,CACF,EACA,SAAU,CAAC,SAAS,AACtB,CACF,EACA,CACE,KAAM,yBACN,YACE,uFACA,oEACF,WAAW,EACX,WAAY,CACV,KAAM,SACN,WAAY,CACV,aAAc,CACZ,KAAM,SACN,YAAa,yCACf,EACA,WAAY,CACV,KAAM,SACN,YAAa,uCACf,EACA,aAAc,CACZ,KAAM,SACN,YAAa,0CACf,EACA,WAAY,CACV,KAAM,SACN,YAAa,wCACf,EACA,QAAS,CACP,KAAM,QACN,YAAa,2BACb,MAAO,CACL,KAAM,QACR,CACF,CACF,EACA,SAAU,CAAC,eAAgB,aAAc,eAAgB,aAAa,AACxE,CACF,EACA,CACE,KAAM,0BACN,YACE,gFACA,sFACA,+CACF,WAAW,EACX,WAAY,CACV,KAAM,SACN,WAAY,CACV,KAAM,CACJ,KAAM,SACN,YAAa,kEACf,EACA,cAAe,CACb,KAAM,SACN,YAAa,sEACf,CACF,EACA,SAAU,CAAC,OAAO,AACpB,CACF,EACA,CACE,KAAM,uBACN,YACE,mFACA,oFACA,oBACF,WAAW,EACX,WAAY,CACV,KAAM,SACN,WAAY,CAAC,EACb,SAAU,EAAE,AACd,CACF,EACA,CACE,KAAM,wBACN,YACE,2EACA,yDACF,WAAW,EACX,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YAAa,iCACf,CACF,EACA,SAAU,CAAC,QAAQ,AACrB,CACF,EACA,CACE,KAAM,yBACN,YACE,kFACA,iFACA,iDACF,WAAW,EACX,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YAAa,gDACf,CACF,EACA,SAAU,EAAE,AACd,CACF,EAOA,CACE,KAAM,4BACN,YACE,8GACA,8GACA,wGACA,yEACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,QAAS,CACP,KAAM,SACN,YAAa,wGACf,EACA,YAAa,CACX,KAAM,SACN,YAAa,qDACb,KAAM,CAAC,MAAO,OAAQ,OAAQ,cAAe,OAAO,AACtD,EACA,cAAe,CACb,KAAM,SACN,YAAa,+FACb,KAAM,CAAC,SAAU,UAAW,QAAS,QAAS,SAAU,SAAU,OAAQ,QAAS,SAAU,QAAS,aAAc,QAAS,WAAW,AAC1I,EACA,kBAAmB,CACjB,KAAM,SACN,YAAa,sHACf,CACF,EACA,SAAU,CAAC,UAAU,AACvB,EACA,UAAW,EACb,EACA,CACE,KAAM,+BACN,YACE,+FACA,gHACA,2EACA,4FACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,SAAU,CACR,KAAM,SACN,YAAa,yCACf,EACA,kBAAmB,CACjB,KAAM,QACN,MAAO,CAAE,KAAM,QAAS,EACxB,YAAa,wGACf,EACA,eAAgB,CACd,KAAM,SACN,YAAa,oEACf,EACA,cAAe,CACb,KAAM,SACN,YAAa,iEACf,EACA,WAAY,CACV,KAAM,UACN,YAAa,6FACf,CACF,EACA,SAAU,CAAC,WAAW,AACxB,EACA,WAAW,CACb,EACA,CACE,KAAM,yBACN,YACE,mGACA,mGACA,4EACA,gEACF,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,QACN,YAAa,kFACb,MA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"}