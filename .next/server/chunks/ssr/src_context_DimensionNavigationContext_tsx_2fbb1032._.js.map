{"version":3,"sources":["../../../../src/context/DimensionNavigationContext.tsx"],"sourcesContent":["/**\n * Dimension Navigation Context\n *\n * Tracks navigation state across dimensions and apps:\n * - Current dimension/app\n * - Navigation history (back/forward)\n * - Project context\n * - Swipe navigation support\n * - 8gent context updates\n *\n * Phase 3: Navigation infrastructure for ERV\n */\n\n\"use client\";\n\nimport {\n  createContext,\n  useContext,\n  useCallback,\n  useState,\n  useEffect,\n  useRef,\n  type ReactNode,\n} from \"react\";\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface NavigationLocation {\n  /** Current dimension ID or app path */\n  dimensionId: string;\n  /** Human-readable label */\n  label: string;\n  /** Entity filter if any */\n  filter?: {\n    entityTypes?: string[];\n    tags?: string[];\n    projectId?: string;\n  };\n  /** Timestamp when navigated here */\n  timestamp: number;\n}\n\nexport interface NavigationState {\n  /** Current location */\n  current: NavigationLocation;\n  /** Navigation history (for back) */\n  history: NavigationLocation[];\n  /** Forward stack (for forward after back) */\n  forward: NavigationLocation[];\n  /** Active project context */\n  projectId?: string;\n  projectName?: string;\n}\n\nexport interface DimensionNavigationContextValue {\n  /** Current navigation state */\n  state: NavigationState;\n  /** Navigate to a dimension */\n  navigateTo: (dimensionId: string, label: string, filter?: NavigationLocation[\"filter\"]) => void;\n  /** Go back in history */\n  goBack: () => boolean;\n  /** Go forward in history */\n  goForward: () => boolean;\n  /** Can go back? */\n  canGoBack: boolean;\n  /** Can go forward? */\n  canGoForward: boolean;\n  /** Set active project context */\n  setProject: (projectId: string | undefined, projectName?: string) => void;\n  /** Get context string for 8gent */\n  getAIContext: () => string;\n  /** Subscribe to navigation changes (for 8gent updates) */\n  onNavigate: (callback: (location: NavigationLocation) => void) => () => void;\n}\n\n// =============================================================================\n// Default State\n// =============================================================================\n\nconst DEFAULT_LOCATION: NavigationLocation = {\n  dimensionId: \"home\",\n  label: \"Home\",\n  timestamp: Date.now(),\n};\n\nconst DEFAULT_STATE: NavigationState = {\n  current: DEFAULT_LOCATION,\n  history: [],\n  forward: [],\n};\n\n// =============================================================================\n// Context\n// =============================================================================\n\nconst DimensionNavigationContext = createContext<DimensionNavigationContextValue | null>(null);\n\n// =============================================================================\n// Provider\n// =============================================================================\n\ninterface DimensionNavigationProviderProps {\n  children: ReactNode;\n  /** Initial dimension */\n  initialDimension?: string;\n  /** Initial project context */\n  initialProjectId?: string;\n}\n\nexport function DimensionNavigationProvider({\n  children,\n  initialDimension,\n  initialProjectId,\n}: DimensionNavigationProviderProps) {\n  // Navigation state\n  const [state, setState] = useState<NavigationState>(() => ({\n    ...DEFAULT_STATE,\n    current: initialDimension\n      ? { dimensionId: initialDimension, label: initialDimension, timestamp: Date.now() }\n      : DEFAULT_LOCATION,\n    projectId: initialProjectId,\n  }));\n\n  // Subscribers for navigation events (8gent listens here)\n  const subscribersRef = useRef<Set<(location: NavigationLocation) => void>>(new Set());\n\n  // Notify subscribers of navigation\n  const notifySubscribers = useCallback((location: NavigationLocation) => {\n    subscribersRef.current.forEach((callback) => callback(location));\n  }, []);\n\n  // Navigate to a dimension\n  const navigateTo = useCallback(\n    (dimensionId: string, label: string, filter?: NavigationLocation[\"filter\"]) => {\n      const newLocation: NavigationLocation = {\n        dimensionId,\n        label,\n        filter,\n        timestamp: Date.now(),\n      };\n\n      setState((prev) => ({\n        ...prev,\n        history: [...prev.history, prev.current],\n        current: newLocation,\n        forward: [], // Clear forward stack on new navigation\n      }));\n\n      notifySubscribers(newLocation);\n    },\n    [notifySubscribers]\n  );\n\n  // Go back\n  const goBack = useCallback((): boolean => {\n    let didGoBack = false;\n\n    setState((prev) => {\n      if (prev.history.length === 0) return prev;\n\n      const newHistory = [...prev.history];\n      const previousLocation = newHistory.pop()!;\n\n      didGoBack = true;\n\n      // Notify after state update\n      setTimeout(() => notifySubscribers(previousLocation), 0);\n\n      return {\n        ...prev,\n        history: newHistory,\n        current: previousLocation,\n        forward: [prev.current, ...prev.forward],\n      };\n    });\n\n    return didGoBack;\n  }, [notifySubscribers]);\n\n  // Go forward\n  const goForward = useCallback((): boolean => {\n    let didGoForward = false;\n\n    setState((prev) => {\n      if (prev.forward.length === 0) return prev;\n\n      const newForward = [...prev.forward];\n      const nextLocation = newForward.shift()!;\n\n      didGoForward = true;\n\n      // Notify after state update\n      setTimeout(() => notifySubscribers(nextLocation), 0);\n\n      return {\n        ...prev,\n        history: [...prev.history, prev.current],\n        current: nextLocation,\n        forward: newForward,\n      };\n    });\n\n    return didGoForward;\n  }, [notifySubscribers]);\n\n  // Set project context\n  const setProject = useCallback((projectId: string | undefined, projectName?: string) => {\n    setState((prev) => ({\n      ...prev,\n      projectId,\n      projectName,\n    }));\n  }, []);\n\n  // Generate context string for 8gent\n  const getAIContext = useCallback((): string => {\n    const parts: string[] = [];\n\n    // Current location\n    parts.push(`Currently viewing: ${state.current.label} (${state.current.dimensionId})`);\n\n    // Project context\n    if (state.projectName) {\n      parts.push(`Active project: ${state.projectName}`);\n    }\n\n    // Filter context\n    if (state.current.filter) {\n      if (state.current.filter.entityTypes?.length) {\n        parts.push(`Filtered to: ${state.current.filter.entityTypes.join(\", \")}`);\n      }\n      if (state.current.filter.tags?.length) {\n        parts.push(`Tags: ${state.current.filter.tags.join(\", \")}`);\n      }\n    }\n\n    // Navigation depth\n    if (state.history.length > 0) {\n      parts.push(`Navigation depth: ${state.history.length} steps from home`);\n    }\n\n    return parts.join(\". \");\n  }, [state]);\n\n  // Subscribe to navigation changes\n  const onNavigate = useCallback((callback: (location: NavigationLocation) => void) => {\n    subscribersRef.current.add(callback);\n    return () => {\n      subscribersRef.current.delete(callback);\n    };\n  }, []);\n\n  // Computed values\n  const canGoBack = state.history.length > 0;\n  const canGoForward = state.forward.length > 0;\n\n  const value: DimensionNavigationContextValue = {\n    state,\n    navigateTo,\n    goBack,\n    goForward,\n    canGoBack,\n    canGoForward,\n    setProject,\n    getAIContext,\n    onNavigate,\n  };\n\n  return (\n    <DimensionNavigationContext.Provider value={value}>\n      {children}\n    </DimensionNavigationContext.Provider>\n  );\n}\n\n// =============================================================================\n// Hook\n// =============================================================================\n\nexport function useDimensionNavigation(): DimensionNavigationContextValue {\n  const context = useContext(DimensionNavigationContext);\n  if (!context) {\n    throw new Error(\"useDimensionNavigation must be used within DimensionNavigationProvider\");\n  }\n  return context;\n}\n\n// =============================================================================\n// Swipe Navigation Hook\n// =============================================================================\n\ninterface UseSwipeNavigationOptions {\n  /** Minimum swipe distance to trigger (default: 50) */\n  threshold?: number;\n  /** Whether swipe is enabled (default: true) */\n  enabled?: boolean;\n  /** Callback on swipe left (forward) */\n  onSwipeLeft?: () => void;\n  /** Callback on swipe right (back) */\n  onSwipeRight?: () => void;\n}\n\nexport function useSwipeNavigation(options: UseSwipeNavigationOptions = {}) {\n  const { threshold = 50, enabled = true, onSwipeLeft, onSwipeRight } = options;\n  const { goBack, goForward, canGoBack, canGoForward } = useDimensionNavigation();\n\n  const touchStartRef = useRef<{ x: number; y: number } | null>(null);\n\n  const handleTouchStart = useCallback(\n    (e: React.TouchEvent) => {\n      if (!enabled) return;\n      const touch = e.touches[0];\n      touchStartRef.current = { x: touch.clientX, y: touch.clientY };\n    },\n    [enabled]\n  );\n\n  const handleTouchEnd = useCallback(\n    (e: React.TouchEvent) => {\n      if (!enabled || !touchStartRef.current) return;\n\n      const touch = e.changedTouches[0];\n      const deltaX = touch.clientX - touchStartRef.current.x;\n      const deltaY = touch.clientY - touchStartRef.current.y;\n\n      // Only trigger if horizontal swipe is dominant\n      if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > threshold) {\n        if (deltaX > 0 && canGoBack) {\n          // Swipe right = go back\n          goBack();\n          onSwipeRight?.();\n        } else if (deltaX < 0 && canGoForward) {\n          // Swipe left = go forward\n          goForward();\n          onSwipeLeft?.();\n        }\n      }\n\n      touchStartRef.current = null;\n    },\n    [enabled, threshold, canGoBack, canGoForward, goBack, goForward, onSwipeLeft, onSwipeRight]\n  );\n\n  return {\n    touchHandlers: {\n      onTouchStart: handleTouchStart,\n      onTouchEnd: handleTouchEnd,\n    },\n  };\n}\n\n// =============================================================================\n// 8gent Integration Hook\n// =============================================================================\n\n/**\n * Hook for 8gent to stay informed about navigation context.\n * Returns current context and subscribes to changes.\n */\nexport function useAINavigationContext(\n  onContextChange?: (context: string, location: NavigationLocation) => void\n) {\n  const { state, getAIContext, onNavigate } = useDimensionNavigation();\n\n  useEffect(() => {\n    if (!onContextChange) return;\n\n    // Subscribe to navigation changes\n    const unsubscribe = onNavigate((location) => {\n      // Small delay to ensure state is updated\n      setTimeout(() => {\n        onContextChange(getAIContext(), location);\n      }, 10);\n    });\n\n    return unsubscribe;\n  }, [onNavigate, getAIContext, onContextChange]);\n\n  return {\n    currentContext: getAIContext(),\n    currentLocation: state.current,\n    projectContext: state.projectName ? `Project: ${state.projectName}` : undefined,\n  };\n}\n\nexport default DimensionNavigationContext;\n"],"names":[],"mappings":"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"}