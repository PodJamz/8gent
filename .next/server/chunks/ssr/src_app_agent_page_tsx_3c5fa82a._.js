module.exports=[210808,a=>{"use strict";var b=a.i(499969),c=a.i(863050),d=a.i(155399),e=a.i(278739),f=a.i(858025),g=a.i(797003),h=a.i(113165),i=a.i(159030),j=a.i(436995),k=a.i(588655),l=a.i(662482),m=a.i(368114),n=a.i(233849),o=a.i(374570),p=a.i(567031),q=a.i(128002),r=a.i(172777),s=a.i(390341),t=a.i(887080),u=a.i(139136),v=a.i(101170),w=a.i(284069),x=a.i(712957),y=a.i(346752),y=y,z=a.i(518600),A=a.i(832728),B=a.i(149605);function C({isOpen:a,onClose:c,threads:d,activeThreadId:f,onNewThread:g,onSelectThread:h,onDeleteThread:i,memoryStats:j={episodic:0,semantic:0,working:0},recentMentions:k=[],activeTask:l=null,onMentionClick:n}){return(0,b.jsx)(e.AnimatePresence,{children:a&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},onClick:c,className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-40 lg:hidden"}),(0,b.jsxs)(p.motion.aside,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"-100%",opacity:0},transition:{type:"spring",damping:30,stiffness:300},className:(0,m.cn)("fixed lg:relative inset-y-0 left-0 z-50 lg:z-auto","w-80 max-w-[85vw] lg:w-72 xl:w-80","flex flex-col","touch-none lg:touch-auto"),style:{paddingTop:"env(safe-area-inset-top, 0px)",paddingBottom:"env(safe-area-inset-bottom, 0px)",background:"hsl(var(--theme-chat-sidebar-bg, var(--theme-card)))",borderRight:"1px solid hsl(var(--theme-chat-sidebar-border, var(--theme-border)))",fontFamily:"var(--theme-font)"},children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-4 py-4",style:{borderBottom:"1px solid hsl(var(--theme-border))"},children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{background:"hsl(var(--theme-primary) / 0.2)"},children:(0,b.jsx)(x.Zap,{className:"w-4 h-4",style:{color:"hsl(var(--theme-primary))"}})}),(0,b.jsx)("h2",{className:"text-lg font-semibold",style:{color:"hsl(var(--theme-foreground))"},children:"Agent"})]}),(0,b.jsx)("button",{onClick:c,className:"p-2 rounded-full transition-colors lg:hidden",style:{color:"hsl(var(--theme-muted-foreground))"},onMouseEnter:a=>a.currentTarget.style.background="hsl(var(--theme-muted))",onMouseLeave:a=>a.currentTarget.style.background="transparent",children:(0,b.jsx)(t.X,{className:"w-5 h-5"})})]}),(0,b.jsx)("div",{className:"px-3 py-3",children:(0,b.jsxs)("button",{onClick:()=>{g(),c()},className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all",style:{background:"hsl(var(--theme-primary))",color:"hsl(var(--theme-primary-foreground))"},onMouseEnter:a=>a.currentTarget.style.opacity="0.9",onMouseLeave:a=>a.currentTarget.style.opacity="1",children:[(0,b.jsx)(q.Plus,{className:"w-5 h-5"}),(0,b.jsx)("span",{className:"font-medium",children:"New session"})]})}),l&&(0,b.jsx)("div",{className:"px-3 pb-2",children:(0,b.jsxs)("div",{className:"px-3 py-2.5 rounded-lg bg-muted/50 border border-border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("div",{className:(0,m.cn)("w-2 h-2 rounded-full","running"===l.status&&"bg-green-400 animate-pulse","paused"===l.status&&"bg-yellow-400","completed"===l.status&&"bg-blue-400","failed"===l.status&&"bg-red-400","pending"===l.status&&"bg-muted-foreground")}),(0,b.jsx)("span",{className:(0,m.cn)("text-xs font-medium uppercase",function(a){switch(a){case"running":return"text-green-400";case"paused":return"text-yellow-400";case"failed":return"text-red-400";case"completed":return"text-blue-400";default:return"text-muted-foreground"}}(l.status)),children:l.status})]}),(0,b.jsx)("p",{className:"text-sm text-foreground truncate",children:l.title}),void 0!==l.progress&&(0,b.jsx)("div",{className:"mt-2 h-1 rounded-full bg-muted overflow-hidden",children:(0,b.jsx)(p.motion.div,{className:"h-full bg-primary",initial:{width:0},animate:{width:`${l.progress}%`},transition:{duration:.3}})})]})}),(0,b.jsx)("div",{className:"px-3 pb-2",children:(0,b.jsxs)("div",{className:"px-3 py-2 rounded-lg",style:{background:"hsl(var(--theme-muted) / 0.3)"},children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(u.Brain,{className:"w-4 h-4",style:{color:"hsl(var(--theme-muted-foreground))"}}),(0,b.jsx)("span",{className:"text-xs font-medium uppercase tracking-wide",style:{color:"hsl(var(--theme-muted-foreground))"},children:"Memory"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-lg font-semibold",style:{color:"hsl(var(--theme-foreground))"},children:j.episodic}),(0,b.jsx)("div",{className:"text-[10px]",style:{color:"hsl(var(--theme-muted-foreground))"},children:"Episodic"})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-lg font-semibold",style:{color:"hsl(var(--theme-foreground))"},children:j.semantic}),(0,b.jsx)("div",{className:"text-[10px]",style:{color:"hsl(var(--theme-muted-foreground))"},children:"Semantic"})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-lg font-semibold",style:{color:"hsl(var(--theme-foreground))"},children:j.working}),(0,b.jsx)("div",{className:"text-[10px]",style:{color:"hsl(var(--theme-muted-foreground))"},children:"Working"})]})]})]})}),k.length>0&&(0,b.jsxs)("div",{className:"px-3 pb-2",children:[(0,b.jsx)("div",{className:"px-1 mb-2",children:(0,b.jsxs)("span",{className:"text-xs font-medium uppercase tracking-wide flex items-center gap-1.5",style:{color:"hsl(var(--theme-muted-foreground))"},children:[(0,b.jsx)(y.default,{className:"w-3 h-3"}),"Recent Mentions"]})}),(0,b.jsx)("div",{className:"space-y-1",children:k.slice(0,5).map(a=>{let c=function(a){switch(a){case"project":return A.Folder;case"prd":return B.FileText;case"ticket":case"file":return z.FileCode;default:return y.default}}(a.type);return(0,b.jsxs)("button",{onClick:()=>n?.(a),className:"w-full flex items-center gap-2 px-2 py-1.5 rounded-md transition-colors text-left",onMouseEnter:a=>a.currentTarget.style.background="hsl(var(--theme-muted))",onMouseLeave:a=>a.currentTarget.style.background="transparent",children:[(0,b.jsx)(c,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:"hsl(var(--theme-muted-foreground))"}}),(0,b.jsxs)("span",{className:"text-sm truncate flex-1",style:{color:"hsl(var(--theme-foreground))"},children:["@",a.name]}),(0,b.jsx)(w.ChevronRight,{className:"w-3 h-3",style:{color:"hsl(var(--theme-muted-foreground) / 0.5)"}})]},a.id)})})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto px-3 pb-3",children:[(0,b.jsx)("div",{className:"px-1 mb-2",children:(0,b.jsxs)("span",{className:"text-xs font-medium uppercase tracking-wide flex items-center gap-1.5",style:{color:"hsl(var(--theme-muted-foreground))"},children:[(0,b.jsx)(r.MessageSquare,{className:"w-3 h-3"}),"Sessions"]})}),0===d.length?(0,b.jsxs)("div",{className:"text-center py-8 px-4",children:[(0,b.jsx)(r.MessageSquare,{className:"w-12 h-12 mx-auto mb-3",style:{color:"hsl(var(--theme-muted-foreground) / 0.3)"}}),(0,b.jsx)("p",{className:"text-sm",style:{color:"hsl(var(--theme-muted-foreground))"},children:"No sessions yet"}),(0,b.jsx)("p",{className:"text-xs mt-1",style:{color:"hsl(var(--theme-muted-foreground) / 0.7)"},children:"Start a new session to begin"})]}):(0,b.jsx)("div",{className:"space-y-1",children:d.map(a=>{var d;let e,g,j,k;return(0,b.jsxs)(p.motion.div,{layout:!0,initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"group relative",children:[(0,b.jsx)("button",{onClick:()=>{h(a.id),window.innerWidth<1024&&c()},className:"w-full text-left px-3 py-2.5 rounded-lg transition-all",style:{background:a.id===f?"hsl(var(--theme-primary) / 0.1)":"transparent",borderLeft:a.id===f?"2px solid hsl(var(--theme-chat-sidebar-active, var(--theme-primary)))":"2px solid transparent"},onMouseEnter:b=>{a.id!==f&&(b.currentTarget.style.background="hsl(var(--theme-chat-sidebar-hover, var(--theme-muted)))")},onMouseLeave:b=>{a.id!==f&&(b.currentTarget.style.background="transparent")},children:(0,b.jsxs)("div",{className:"flex items-start gap-2.5",children:[(0,b.jsx)(r.MessageSquare,{className:"w-4 h-4 mt-0.5 flex-shrink-0",style:{color:a.id===f?"hsl(var(--theme-primary))":"hsl(var(--theme-muted-foreground))"}}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium truncate",style:{color:a.id===f?"hsl(var(--theme-foreground))":"hsl(var(--theme-muted-foreground))"},children:a.title}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-0.5",children:[(0,b.jsxs)("span",{className:"text-[10px]",style:{color:"hsl(var(--theme-muted-foreground) / 0.7)"},children:[a.messages.length," msg",1!==a.messages.length?"s":""]}),(0,b.jsx)("span",{className:"text-[10px]",style:{color:"hsl(var(--theme-muted-foreground) / 0.5)"},children:"·"}),(0,b.jsx)("span",{className:"text-[10px]",style:{color:"hsl(var(--theme-muted-foreground) / 0.7)"},children:(d=a.lastModified,g=Math.floor((e=Date.now()-d)/6e4),j=Math.floor(e/36e5),k=Math.floor(e/864e5),g<1?"Just now":g<60?`${g}m ago`:j<24?`${j}h ago`:k<7?`${k}d ago`:new Date(d).toLocaleDateString())})]})]})]})}),(0,b.jsx)("button",{onClick:b=>{b.stopPropagation(),i(a.id)},className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 rounded-md opacity-0 group-hover:opacity-100 focus:opacity-100 transition-opacity","aria-label":"Delete session",style:{background:"hsl(var(--theme-muted))"},onMouseEnter:a=>a.currentTarget.style.background="hsl(0 84% 60% / 0.2)",onMouseLeave:a=>a.currentTarget.style.background="hsl(var(--theme-muted))",children:(0,b.jsx)(s.Trash2,{className:"w-3.5 h-3.5",style:{color:"hsl(var(--theme-muted-foreground))"}})})]},a.id)})})]}),(0,b.jsx)("div",{className:"px-4 py-3",style:{borderTop:"1px solid hsl(var(--theme-border))"},children:(0,b.jsxs)("div",{className:"flex items-center justify-between text-xs",style:{color:"hsl(var(--theme-muted-foreground))"},children:[(0,b.jsxs)("span",{children:[d.length," session",1!==d.length?"s":""]}),(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)(v.Database,{className:"w-3 h-3"}),(0,b.jsx)("span",{children:"Convex"})]})]})})]})]})})}var D=a.i(683560),E=a.i(734307),F=a.i(468563),G=a.i(327428),H=a.i(424449),H=H,I=a.i(8146);let J={project:{icon:A.Folder,color:"text-blue-400",label:"Project"},prd:{icon:B.FileText,color:"text-purple-400",label:"PRD"},epic:{icon:F.Layers,color:"text-amber-400",label:"Epic"},ticket:{icon:E.Ticket,color:"text-green-400",label:"Ticket"},file:{icon:z.FileCode,color:"text-orange-400",label:"File"}},K={chat:{icon:G.Eye,label:"Chat"},code:{icon:i.Code,label:"Code"},kanban:{icon:H.default,label:"Kanban"},docs:{icon:I.BookOpen,label:"Docs"}};function L({entity:a,isLast:d,onClick:f,onRemove:g}){let[h,i]=(0,c.useState)(!1),j=J[a.type],k=j.icon;return(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsxs)(p.motion.div,{layout:!0,className:(0,m.cn)("relative group flex items-center gap-1.5 px-2 py-1 rounded-md","transition-colors cursor-pointer",h?"bg-muted":"hover:bg-muted/50"),onClick:f,children:[(0,b.jsx)(k,{className:(0,m.cn)("w-3.5 h-3.5",j.color)}),(0,b.jsxs)("span",{className:"text-sm text-foreground font-medium",children:["@",a.name]}),a.status&&(0,b.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-muted text-muted-foreground uppercase",children:a.status}),(0,b.jsx)("button",{onClick:a=>{a.stopPropagation(),g()},className:"absolute -right-1 -top-1 w-4 h-4 rounded-full bg-muted-foreground/20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity hover:bg-destructive/50",children:(0,b.jsx)(t.X,{className:"w-2.5 h-2.5 text-muted-foreground"})}),(0,b.jsx)(e.AnimatePresence,{children:h&&a.description&&(0,b.jsxs)(p.motion.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"absolute top-full left-0 mt-1 z-50 w-64 p-3 rounded-lg bg-popover border border-border shadow-lg",onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(k,{className:(0,m.cn)("w-4 h-4",j.color)}),(0,b.jsx)("span",{className:"text-xs font-medium text-muted-foreground uppercase",children:j.label})]}),(0,b.jsx)("p",{className:"text-sm text-foreground font-medium mb-1",children:a.name}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground line-clamp-3",children:a.description})]})})]}),!d&&(0,b.jsx)(w.ChevronRight,{className:"w-4 h-4 text-muted-foreground/50 mx-1 flex-shrink-0"})]})}function M({currentView:a,onViewChange:d}){let[f,g]=(0,c.useState)(!1),h=(0,c.useRef)(null),i=K[a],j=i.icon;return(0,c.useEffect)(()=>{function a(a){h.current&&!h.current.contains(a.target)&&g(!1)}return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),(0,b.jsxs)("div",{className:"relative",ref:h,children:[(0,b.jsxs)("button",{onClick:()=>g(!f),className:(0,m.cn)("flex items-center gap-2 px-3 py-1.5 rounded-md","text-sm font-medium transition-colors","bg-muted/50 hover:bg-muted text-foreground"),children:[(0,b.jsx)(j,{className:"w-4 h-4"}),(0,b.jsx)("span",{children:i.label}),(0,b.jsx)(D.ChevronDown,{className:(0,m.cn)("w-3.5 h-3.5 transition-transform",f&&"rotate-180")})]}),(0,b.jsx)(e.AnimatePresence,{children:f&&(0,b.jsx)(p.motion.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"absolute top-full right-0 mt-1 z-50 w-40 rounded-lg bg-popover border border-border shadow-lg overflow-hidden",children:Object.entries(K).map(([c,e])=>{let f=e.icon;return(0,b.jsxs)("button",{onClick:()=>{d(c),g(!1)},className:(0,m.cn)("w-full flex items-center gap-2 px-3 py-2 text-sm transition-colors",c===a?"bg-primary/10 text-primary":"hover:bg-muted text-foreground"),children:[(0,b.jsx)(f,{className:"w-4 h-4"}),(0,b.jsx)("span",{children:e.label})]},c)})})})]})}function N({contextChain:a,currentView:c,onViewChange:d,onEntityClick:e,onRemoveEntity:f,onClearContext:g,className:h}){return(0,b.jsxs)("div",{className:(0,m.cn)("flex items-center justify-between gap-4 px-4 py-2","bg-card/50 border-b border-border backdrop-blur-sm",h),children:[(0,b.jsx)("div",{className:"flex items-center gap-1 overflow-x-auto hide-scrollbar",children:0===a.length?(0,b.jsx)("span",{className:"text-sm text-muted-foreground italic",children:"No context selected - type @ to add"}):(0,b.jsxs)(b.Fragment,{children:[a.map((c,d)=>(0,b.jsx)(L,{entity:c,isLast:d===a.length-1,onClick:()=>e(c),onRemove:()=>f(c.id)},c.id)),a.length>1&&(0,b.jsx)("button",{onClick:g,className:"ml-2 p-1 rounded hover:bg-muted transition-colors",title:"Clear all context",children:(0,b.jsx)(t.X,{className:"w-4 h-4 text-muted-foreground"})})]})}),(0,b.jsx)(M,{currentView:c,onViewChange:d})]})}var O=a.i(158439),O=O,P=a.i(169114),Q=a.i(253177),R=a.i(967965),S=a.i(151686),T=a.i(476012),U=a.i(885275),V=a.i(456819),W=a.i(80335);function X({tab:a,isActive:c,onClick:d,icon:e,label:f,badge:g}){return(0,b.jsxs)("button",{onClick:d,className:(0,m.cn)("flex items-center gap-2 px-3 py-2 text-sm font-medium transition-colors relative",c?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground"),children:[(0,b.jsx)(e,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:f}),void 0!==g&&g>0&&(0,b.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 rounded-full bg-primary text-primary-foreground text-[10px] flex items-center justify-center",children:g})]})}function Y({node:a,depth:d,onSelect:e,selectedPath:f}){let[g,h]=(0,c.useState)(a.isOpen??!1),i=f===a.path;return(0,b.jsxs)("div",{children:[(0,b.jsxs)("button",{onClick:()=>{"folder"===a.type?h(!g):e(a.path)},className:(0,m.cn)("w-full flex items-center gap-1.5 px-2 py-1 text-sm transition-colors rounded",i?"bg-primary/20 text-primary":"hover:bg-muted text-foreground"),style:{paddingLeft:`${12*d+8}px`},children:["folder"===a.type?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.ChevronRight,{className:(0,m.cn)("w-3 h-3 text-muted-foreground transition-transform",g&&"rotate-90")}),(0,b.jsx)(A.Folder,{className:"w-4 h-4 text-amber-400"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"w-3"}),(0,b.jsx)(S.File,{className:"w-4 h-4 text-blue-400"})]}),(0,b.jsx)("span",{className:"truncate",children:a.name})]}),"folder"===a.type&&g&&a.children&&(0,b.jsx)("div",{children:a.children.map(a=>(0,b.jsx)(Y,{node:a,depth:d+1,onSelect:e,selectedPath:f},a.path))})]})}function Z({code:a,language:d,onChange:e,readOnly:f=!1}){let[g,h]=(0,c.useState)(!1),i=(0,c.useRef)(null),j=async()=>{await navigator.clipboard.writeText(a),h(!0),setTimeout(()=>h(!1),2e3)},k=Array.from({length:a.split("\n").length},(a,b)=>b+1);return(0,b.jsxs)("div",{className:"relative h-full flex flex-col bg-[#1e1e1e] rounded-lg overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/10",children:[(0,b.jsx)("span",{className:"text-xs text-muted-foreground font-mono",children:d}),(0,b.jsx)("button",{onClick:j,className:"p-1.5 rounded hover:bg-white/10 transition-colors",title:"Copy code",children:g?(0,b.jsx)(U.Check,{className:"w-4 h-4 text-green-400"}):(0,b.jsx)(T.Copy,{className:"w-4 h-4 text-muted-foreground"})})]}),(0,b.jsxs)("div",{className:"flex-1 flex overflow-auto",children:[(0,b.jsx)("div",{className:"flex-shrink-0 px-3 py-2 text-right text-xs text-muted-foreground/50 font-mono select-none border-r border-white/5",children:k.map(a=>(0,b.jsx)("div",{className:"leading-6",children:a},a))}),(0,b.jsx)("div",{className:"flex-1 relative",children:(0,b.jsx)("textarea",{ref:i,value:a,onChange:a=>e?.(a.target.value),readOnly:f,className:(0,m.cn)("absolute inset-0 w-full h-full px-4 py-2 bg-transparent resize-none","font-mono text-sm text-white leading-6","focus:outline-none",f&&"cursor-default"),spellCheck:!1})})]})]})}function $({output:a,onRunCommand:d,isRunning:e}){let[f,g]=(0,c.useState)(""),h=(0,c.useRef)(null);return(0,c.useEffect)(()=>{h.current&&(h.current.scrollTop=h.current.scrollHeight)},[a]),(0,b.jsxs)("div",{className:"h-full flex flex-col bg-[#1e1e1e] rounded-lg overflow-hidden font-mono",children:[(0,b.jsxs)("div",{ref:h,className:"flex-1 overflow-auto p-3 space-y-1",children:[0===a.length?(0,b.jsx)("div",{className:"text-muted-foreground text-sm",children:"Terminal ready. Type a command to get started."}):a.map(a=>(0,b.jsxs)("div",{className:(0,m.cn)("text-sm whitespace-pre-wrap","command"===a.type&&"text-green-400","output"===a.type&&"text-white/80","error"===a.type&&"text-red-400"),children:["command"===a.type&&(0,b.jsx)("span",{className:"text-muted-foreground",children:"$ "}),a.content]},a.id)),e&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-400 animate-pulse"}),"Running..."]})]}),(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),f.trim()&&!e&&(d(f.trim()),g(""))},className:"flex items-center gap-2 px-3 py-2 border-t border-white/10",children:[(0,b.jsx)("span",{className:"text-green-400 text-sm",children:"$"}),(0,b.jsx)("input",{type:"text",value:f,onChange:a=>g(a.target.value),disabled:e,className:"flex-1 bg-transparent text-sm text-white focus:outline-none disabled:opacity-50",placeholder:"Enter command...",autoCapitalize:"off",autoCorrect:"off",autoComplete:"off",spellCheck:!1}),(0,b.jsx)("button",{type:"submit",disabled:!f.trim()||e,className:"p-1.5 rounded hover:bg-white/10 transition-colors disabled:opacity-50",children:(0,b.jsx)(j.Play,{className:"w-4 h-4 text-green-400"})})]})]})}function _({url:a,onRefresh:d}){let[e,f]=(0,c.useState)(!0);return a?(0,b.jsxs)("div",{className:"h-full flex flex-col bg-card rounded-lg overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 border-b border-border",children:[(0,b.jsx)("button",{onClick:d,className:"p-1.5 rounded hover:bg-muted transition-colors",title:"Refresh",children:(0,b.jsx)(V.RefreshCw,{className:(0,m.cn)("w-4 h-4 text-muted-foreground",e&&"animate-spin")})}),(0,b.jsx)("div",{className:"flex-1 px-3 py-1.5 rounded bg-muted text-sm text-muted-foreground truncate",children:a}),(0,b.jsx)("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 rounded hover:bg-muted transition-colors",title:"Open in new tab",children:(0,b.jsx)(W.ExternalLink,{className:"w-4 h-4 text-muted-foreground"})})]}),(0,b.jsxs)("div",{className:"flex-1 relative",children:[e&&(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-muted/50",children:(0,b.jsx)(V.RefreshCw,{className:"w-6 h-6 text-muted-foreground animate-spin"})}),(0,b.jsx)("iframe",{src:a,className:"w-full h-full border-0",onLoad:()=>f(!1),title:"Preview"})]})]}):(0,b.jsxs)("div",{className:"h-full flex flex-col items-center justify-center bg-muted/20 rounded-lg",children:[(0,b.jsx)(G.Eye,{className:"w-12 h-12 text-muted-foreground/30 mb-3"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No preview available"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground/70 mt-1",children:"Run a dev server to see the preview"})]})}function aa({isVisible:a,isExpanded:c,activeTab:d,onTabChange:f,onToggleExpanded:g,onClose:h,code:j,language:k,currentFile:l,onCodeChange:n,files:o,onFileSelect:q,terminalOutput:r,onRunCommand:s,isRunning:u=!1,previewUrl:v,onRefreshPreview:w}){return a?(0,b.jsxs)(p.motion.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:(0,m.cn)("bg-card border-t border-border flex flex-col",c?"h-[70vh]":"h-[300px] md:h-[350px]"),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-4 border-b border-border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(X,{tab:"code",isActive:"code"===d,onClick:()=>f("code"),icon:i.Code,label:"Code"}),(0,b.jsx)(X,{tab:"files",isActive:"files"===d,onClick:()=>f("files"),icon:O.default,label:"Files"}),(0,b.jsx)(X,{tab:"terminal",isActive:"terminal"===d,onClick:()=>f("terminal"),icon:P.Terminal,label:"Terminal",badge:r.filter(a=>"error"===a.type).length}),(0,b.jsx)(X,{tab:"preview",isActive:"preview"===d,onClick:()=>f("preview"),icon:G.Eye,label:"Preview"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[l&&(0,b.jsx)("span",{className:"text-xs text-muted-foreground mr-2 hidden sm:block",children:l}),(0,b.jsx)("button",{onClick:g,className:"p-2 rounded hover:bg-muted transition-colors",title:c?"Minimize":"Maximize",children:c?(0,b.jsx)(R.Minimize2,{className:"w-4 h-4 text-muted-foreground"}):(0,b.jsx)(Q.Maximize2,{className:"w-4 h-4 text-muted-foreground"})}),(0,b.jsx)("button",{onClick:h,className:"p-2 rounded hover:bg-muted transition-colors",title:"Close",children:(0,b.jsx)(t.X,{className:"w-4 h-4 text-muted-foreground"})})]})]}),(0,b.jsx)("div",{className:"flex-1 overflow-hidden p-3",children:(0,b.jsxs)(e.AnimatePresence,{mode:"wait",children:["code"===d&&(0,b.jsx)(p.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"h-full",children:(0,b.jsx)(Z,{code:j,language:k,onChange:n})},"code"),"files"===d&&(0,b.jsx)(p.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"h-full overflow-auto",children:(0,b.jsx)("div",{className:"space-y-0.5",children:0===o.length?(0,b.jsx)("div",{className:"text-sm text-muted-foreground text-center py-8",children:"No files in workspace"}):o.map(a=>(0,b.jsx)(Y,{node:a,depth:0,onSelect:q||(()=>{}),selectedPath:l},a.path))})},"files"),"terminal"===d&&(0,b.jsx)(p.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"h-full",children:(0,b.jsx)($,{output:r,onRunCommand:s||(()=>{}),isRunning:u})},"terminal"),"preview"===d&&(0,b.jsx)(p.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"h-full",children:(0,b.jsx)(_,{url:v,onRefresh:w||(()=>{})})},"preview")]})})]}):null}var ab=a.i(496760),ac=a.i(422720),ad=a.i(998612),ae=a.i(90569),y=y,af=a.i(742926),ag=a.i(824764),ag=ag,ah=a.i(218956),ai=a.i(715828),aj=a.i(496948),ak=a.i(853916);let al={project:A.Folder,prd:B.FileText,epic:B.FileText,ticket:E.Ticket,file:z.FileCode},am={project:"text-blue-400",prd:"text-purple-400",epic:"text-amber-400",ticket:"text-green-400",file:"text-orange-400"};function an({tool:a}){return(0,b.jsxs)("div",{className:"rounded-lg p-3",style:{background:"hsl(var(--theme-muted) / 0.5)",border:"1px solid hsl(var(--theme-border))"},children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)("div",{className:"w-6 h-6 rounded-md flex items-center justify-center",style:{background:"complete"===a.status&&a.result?.success?"hsl(142 70% 45% / 0.2)":"complete"!==a.status||a.result?.success?"executing"===a.status?"hsl(var(--theme-primary) / 0.2)":"hsl(var(--theme-muted))":"hsl(0 84% 60% / 0.2)"},children:"executing"===a.status?(0,b.jsx)(l.Loader2,{className:"w-3.5 h-3.5 animate-spin",style:{color:"hsl(var(--theme-primary))"}}):"complete"===a.status&&a.result?.success?(0,b.jsx)(U.Check,{className:"w-3.5 h-3.5",style:{color:"hsl(142 70% 45%)"}}):"complete"!==a.status||a.result?.success?(0,b.jsx)(af.Sparkles,{className:"w-3.5 h-3.5",style:{color:"hsl(var(--theme-muted-foreground))"}}):(0,b.jsx)(t.X,{className:"w-3.5 h-3.5",style:{color:"hsl(0 84% 60%)"}})}),(0,b.jsx)("span",{className:"text-sm font-medium",style:{color:"hsl(var(--theme-foreground))"},children:a.name.replace(/_/g," ")}),"executing"===a.status&&(0,b.jsx)("span",{className:"text-xs animate-pulse",style:{color:"hsl(var(--theme-muted-foreground))"},children:"Running..."})]}),"complete"===a.status&&a.result&&(0,b.jsx)("div",{className:"mt-2 text-xs",children:a.result.success?(0,b.jsx)("div",{style:{color:"hsl(var(--theme-muted-foreground))"},children:a.result.data&&Object.keys(a.result.data).length>0&&(0,b.jsx)("pre",{className:"rounded p-2 overflow-auto max-h-24",style:{background:"hsl(var(--theme-background))"},children:JSON.stringify(a.result.data,null,2)})}):(0,b.jsxs)("div",{style:{color:"hsl(0 84% 60%)"},children:["Error: ",a.result.error]})})]})}function ao({entity:a}){let c=al[a.type],d=am[a.type];return(0,b.jsxs)("div",{className:"inline-flex items-center gap-1.5 px-2 py-1 rounded-md",style:{background:"hsl(var(--theme-muted))"},children:[(0,b.jsx)(c,{className:(0,m.cn)("w-3.5 h-3.5",d)}),(0,b.jsxs)("span",{className:"text-sm font-medium",style:{color:"hsl(var(--theme-foreground))"},children:["@",a.name]})]})}function ap({message:a}){let c="user"===a.role;return"system"===a.role?(0,b.jsx)("div",{className:"flex justify-center my-4",children:(0,b.jsx)("div",{className:"px-3 py-1.5 rounded-full text-xs",style:{background:"hsl(var(--theme-muted))",color:"hsl(var(--theme-muted-foreground))"},children:a.content})}):(0,b.jsxs)(p.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:(0,m.cn)("flex gap-3 mb-4",c&&"flex-row-reverse"),style:{gap:"var(--theme-chat-message-gap, 0.75rem)"},children:[c?(0,b.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{background:"hsl(var(--theme-chat-avatar-user, var(--theme-primary)))"},children:(0,b.jsx)(ae.User,{className:"w-4 h-4",style:{color:"hsl(var(--theme-primary-foreground))"}})}):(0,b.jsx)(ak.ClawAIAvatar,{size:32,isActive:a.isStreaming}),(0,b.jsxs)("div",{className:(0,m.cn)("flex-1 space-y-2",c&&"flex flex-col items-end"),style:{maxWidth:"var(--theme-chat-max-width, 85%)"},children:[a.mentions&&a.mentions.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-1.5 mb-1",children:a.mentions.map(a=>(0,b.jsx)(ao,{entity:a},a.id))}),(0,b.jsx)("div",{className:"px-4 py-2.5",style:{background:c?"var(--theme-chat-user-bg, hsl(var(--theme-primary)))":"hsl(var(--theme-chat-assistant-bg, var(--theme-muted)))",color:c?"hsl(var(--theme-chat-user-fg, var(--theme-primary-foreground)))":"hsl(var(--theme-chat-assistant-fg, var(--theme-foreground)))",borderRadius:c?"var(--theme-chat-bubble-radius, 1rem) var(--theme-chat-bubble-radius, 1rem) var(--theme-chat-bubble-radius-tail, 0.25rem) var(--theme-chat-bubble-radius, 1rem)":"var(--theme-chat-bubble-radius-tail, 0.25rem) var(--theme-chat-bubble-radius, 1rem) var(--theme-chat-bubble-radius, 1rem) var(--theme-chat-bubble-radius, 1rem)"},children:(0,b.jsxs)("p",{className:"text-sm whitespace-pre-wrap",children:[a.content,a.isStreaming&&(0,b.jsx)("span",{className:"inline-block w-1.5 h-4 ml-1 bg-current animate-pulse"})]})}),a.toolCalls&&a.toolCalls.length>0&&(0,b.jsx)("div",{className:"space-y-2 w-full",children:a.toolCalls.map(a=>(0,b.jsx)(an,{tool:a},a.id))}),(0,b.jsx)("span",{className:"text-[10px]",style:{color:"hsl(var(--theme-muted-foreground) / 0.7)"},children:a.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})}function aq({suggestions:a,selectedIndex:c,onSelect:d}){return 0===a.length?null:(0,b.jsx)(p.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute bottom-full left-0 right-0 mb-2 rounded-lg shadow-lg overflow-hidden z-50",style:{background:"hsl(var(--theme-card))",border:"1px solid hsl(var(--theme-border))"},children:(0,b.jsx)("div",{className:"max-h-48 overflow-y-auto",children:a.map((a,e)=>{let f=al[a.type],g=am[a.type];return(0,b.jsxs)("button",{onClick:()=>d(a),className:"w-full flex items-center gap-3 px-3 py-2 transition-colors",style:{background:e===c?"hsl(var(--theme-muted))":"transparent"},onMouseEnter:a=>{e!==c&&(a.currentTarget.style.background="hsl(var(--theme-muted) / 0.5)")},onMouseLeave:a=>{e!==c&&(a.currentTarget.style.background="transparent")},children:[(0,b.jsx)(f,{className:(0,m.cn)("w-4 h-4",g)}),(0,b.jsxs)("div",{className:"flex-1 text-left",children:[(0,b.jsxs)("p",{className:"text-sm font-medium",style:{color:"hsl(var(--theme-foreground))"},children:["@",a.name]}),a.description&&(0,b.jsx)("p",{className:"text-xs truncate",style:{color:"hsl(var(--theme-muted-foreground))"},children:a.description})]}),(0,b.jsx)("span",{className:"text-[10px] uppercase",style:{color:"hsl(var(--theme-muted-foreground))"},children:a.type})]},a.id)})})})}function ar({messages:a,isStreaming:d,onSendMessage:f,onAbort:g,mentionSuggestions:h=[],onMentionSearch:i,onMentionSelect:j,onVoiceInput:k,isVoiceEnabled:l=!1,className:n}){let[o,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(!1),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(0),[z,A]=(0,c.useState)([]),[C,D]=(0,c.useState)(!1),E=(0,c.useRef)(null),F=(0,c.useRef)(null),G=(0,aj.useFileAttachment)({maxFiles:5,maxSizeBytes:0xa00000,onError:a=>console.error("[AgentChat] Attachment error:",a)});(0,c.useEffect)(()=>{E.current?.scrollIntoView({behavior:"smooth"})},[a]);let H=a=>{let b=o.lastIndexOf("@");q(o.slice(0,b)+`@${a.name} `),s(!1),x(0);let c={id:a.id,type:a.type,name:a.name,description:a.description};A(a=>[...a,c]),j?.(a),F.current?.focus()},I=()=>{let a=o.trim().length>0,b=G.hasAttachments;if(!a&&!b||d)return;let c=o.trim();if(G.attachments.length>0){let a=G.attachments.map(a=>a.name).join(", ");c=c?`${c}

[Attached: ${a}]`:`[Attached: ${a}]`}f(c||"Please analyze the attached files.",z),q(""),A([]),G.clearAttachments()};return(0,c.useEffect)(()=>{F.current&&(F.current.style.height="auto",F.current.style.height=`${Math.min(F.current.scrollHeight,150)}px`)},[o]),(0,b.jsxs)("div",{className:(0,m.cn)("flex flex-col h-full",n),style:{background:"hsl(var(--theme-background))",fontFamily:"var(--theme-font)"},children:[(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:[0===a.length?(0,b.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-center",children:[(0,b.jsx)("div",{className:"mb-4",children:(0,b.jsx)(ak.ClawAIAvatar,{size:64,isActive:!1})}),(0,b.jsx)("h3",{className:"text-lg font-semibold mb-2",style:{color:"hsl(var(--theme-foreground))"},children:"Start a conversation"}),(0,b.jsx)("p",{className:"text-sm max-w-sm",style:{color:"hsl(var(--theme-muted-foreground))"},children:"Ask me to help with code, design, or product work. Use @ to reference projects, PRDs, or tickets."})]}):a.map(a=>(0,b.jsx)(ap,{message:a},a.id)),(0,b.jsx)("div",{ref:E})]}),(0,b.jsxs)("div",{className:"p-4",style:{borderTop:"1px solid hsl(var(--theme-border))"},children:[z.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-1.5 mb-2",children:z.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-1 px-2 py-1 rounded-md",style:{background:"hsl(var(--theme-muted))"},children:[(0,b.jsx)(ao,{entity:a}),(0,b.jsx)("button",{onClick:()=>A(b=>b.filter(b=>b.id!==a.id)),className:"p-0.5 rounded transition-colors",style:{color:"hsl(var(--theme-muted-foreground))"},onMouseEnter:a=>a.currentTarget.style.background="hsl(var(--theme-muted-foreground) / 0.2)",onMouseLeave:a=>a.currentTarget.style.background="transparent",children:(0,b.jsx)(t.X,{className:"w-3 h-3"})})]},a.id))}),(0,b.jsx)("input",{ref:G.fileInputRef,type:"file",accept:G.acceptedTypesString,multiple:!0,onChange:G.handleFileInputChange,className:"hidden"}),(0,b.jsx)(e.AnimatePresence,{children:G.hasAttachments&&(0,b.jsx)(p.motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-2",children:(0,b.jsx)("div",{className:"flex flex-wrap gap-2 p-2 rounded-lg",style:{background:"hsl(var(--theme-muted) / 0.5)",border:"1px solid hsl(var(--theme-border) / 0.5)"},children:G.attachments.map(a=>{let c=a.type.startsWith("image/")?ai.Image:"application/pdf"===a.type||a.type.startsWith("text/")?B.FileText:S.File;return(0,b.jsxs)("div",{className:"relative group",children:[a.preview?(0,b.jsxs)("div",{className:"relative w-16 h-16 rounded-lg overflow-hidden",children:[(0,b.jsx)("img",{src:a.preview,alt:a.name,className:"w-full h-full object-cover"}),(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity"})]}):(0,b.jsxs)("div",{className:"w-16 h-16 rounded-lg flex flex-col items-center justify-center gap-1 p-1",style:{background:"hsl(var(--theme-muted))"},children:[(0,b.jsx)(c,{className:"w-5 h-5",style:{color:"hsl(var(--theme-primary))"}}),(0,b.jsx)("span",{className:"text-[9px] truncate w-full text-center",style:{color:"hsl(var(--theme-muted-foreground))"},children:a.name.length>10?`${a.name.slice(0,8)}...`:a.name})]}),(0,b.jsx)("button",{type:"button",onClick:()=>G.removeAttachment(a.id),className:"absolute -top-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",style:{background:"hsl(0 84% 60%)",color:"white"},"aria-label":`Remove ${a.name}`,children:(0,b.jsx)(t.X,{className:"w-3 h-3"})})]},a.id)})})})}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(e.AnimatePresence,{children:r&&h.length>0&&(0,b.jsx)(aq,{suggestions:h,selectedIndex:w,onSelect:H})}),(0,b.jsxs)("div",{className:"flex items-end gap-2 rounded-xl p-2",style:{background:"hsl(var(--theme-chat-input-bg, var(--theme-muted)))",border:"1px solid hsl(var(--theme-chat-input-border, var(--theme-border)) / 0.5)"},children:[(0,b.jsx)("button",{onClick:G.openFilePicker,disabled:d,className:"p-2 rounded-lg transition-colors disabled:opacity-50",title:"Attach file",style:{color:"hsl(var(--theme-muted-foreground))"},onMouseEnter:a=>a.currentTarget.style.background="hsl(var(--theme-background))",onMouseLeave:a=>a.currentTarget.style.background="transparent",children:(0,b.jsx)(ah.Paperclip,{className:"w-5 h-5"})}),(0,b.jsx)("button",{onClick:()=>{q(a=>a+"@"),s(!0),i?.(""),F.current?.focus()},className:"p-2 rounded-lg transition-colors",title:"Add mention",style:{color:"hsl(var(--theme-muted-foreground))"},onMouseEnter:a=>a.currentTarget.style.background="hsl(var(--theme-background))",onMouseLeave:a=>a.currentTarget.style.background="transparent",children:(0,b.jsx)(y.default,{className:"w-5 h-5"})}),(0,b.jsx)("textarea",{ref:F,value:o,onChange:a=>(a=>{q(a);let b=a.lastIndexOf("@");if(-1!==b){let c=a.slice(b+1);if(!c.includes(" ")&&c.length<=20){v(c),s(!0),i?.(c);return}}s(!1)})(a.target.value),onKeyDown:a=>{r&&h.length>0?"ArrowDown"===a.key?(a.preventDefault(),x(a=>(a+1)%h.length)):"ArrowUp"===a.key?(a.preventDefault(),x(a=>(a-1+h.length)%h.length)):"Enter"!==a.key||a.shiftKey?"Escape"===a.key&&s(!1):(a.preventDefault(),H(h[w])):"Enter"!==a.key||a.shiftKey||(a.preventDefault(),I())},placeholder:"Ask anything... (@ to mention)",rows:1,className:"flex-1 bg-transparent resize-none focus:outline-none text-sm py-2",style:{maxHeight:"150px",color:"hsl(var(--theme-chat-input-fg, var(--theme-foreground)))"}}),l&&(0,b.jsx)("button",{onClick:()=>{C?D(!1):D(!0)},className:"p-2 rounded-lg transition-colors",title:C?"Stop recording":"Voice input",style:{background:C?"hsl(0 84% 60% / 0.2)":"transparent",color:C?"hsl(0 84% 60%)":"hsl(var(--theme-muted-foreground))"},onMouseEnter:a=>{C||(a.currentTarget.style.background="hsl(var(--theme-background))")},onMouseLeave:a=>{C||(a.currentTarget.style.background="transparent")},children:C?(0,b.jsx)(ad.MicOff,{className:"w-5 h-5"}):(0,b.jsx)(ac.Mic,{className:"w-5 h-5"})}),d?(0,b.jsx)("button",{onClick:g,className:"p-2 rounded-lg transition-colors",title:"Stop generating",style:{background:"hsl(0 84% 60% / 0.2)",color:"hsl(0 84% 60%)"},onMouseEnter:a=>a.currentTarget.style.background="hsl(0 84% 60% / 0.3)",onMouseLeave:a=>a.currentTarget.style.background="hsl(0 84% 60% / 0.2)",children:(0,b.jsx)(ag.default,{className:"w-5 h-5"})}):(0,b.jsx)("button",{onClick:I,disabled:!o.trim()&&!G.hasAttachments,className:"p-2 rounded-lg transition-colors",title:"Send message",style:{background:o.trim()||G.hasAttachments?"hsl(var(--theme-chat-send-bg, var(--theme-primary)))":"hsl(var(--theme-chat-send-disabled-bg, var(--theme-muted-foreground) / 0.2))",color:o.trim()||G.hasAttachments?"hsl(var(--theme-chat-send-fg, var(--theme-primary-foreground)))":"hsl(var(--theme-chat-send-disabled-fg, var(--theme-muted-foreground)))",cursor:o.trim()||G.hasAttachments?"pointer":"not-allowed"},children:(0,b.jsx)(ab.Send,{className:"w-5 h-5"})})]})]})]})]})}var as=a.i(174912),at=a.i(371029),au=a.i(951571),av=a.i(499506);function aw({isOpen:a,onClose:d,onAuthenticated:f,errorMessage:g}){let{user:h,isSignedIn:i}=(0,o.useUser)(),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(null),n=h?.externalAccounts?.some(a=>"github"===a.provider);(0,c.useEffect)(()=>{},[i]);let q=(0,c.useCallback)(()=>{window.location.href="/settings/integrations"},[]);return a?(f?.(),d(),null):(0,b.jsx)(e.AnimatePresence,{children:a&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/80 backdrop-blur-sm",onClick:d}),(0,b.jsx)(p.motion.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",stiffness:300,damping:30},className:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:a=>a.stopPropagation(),children:(0,b.jsxs)("div",{className:"w-full max-w-md bg-gradient-to-b from-neutral-900 to-black rounded-3xl border border-white/10 overflow-hidden shadow-2xl",children:[(0,b.jsx)("button",{onClick:d,className:"absolute top-4 right-4 p-2 text-white/40 hover:text-white/80 transition-colors rounded-full hover:bg-white/5",children:(0,b.jsx)(t.X,{className:"w-5 h-5"})}),(0,b.jsxs)("div",{className:"px-6 pt-8 pb-6 text-center",children:[(0,b.jsx)(p.motion.div,{className:"w-20 h-20 mx-auto mb-4 relative",animate:{boxShadow:j?["0 0 30px rgba(34, 197, 94, 0.5)","0 0 50px rgba(34, 197, 94, 0.7)","0 0 30px rgba(34, 197, 94, 0.5)"]:["0 0 20px rgba(34, 197, 94, 0.3)","0 0 30px rgba(34, 197, 94, 0.4)","0 0 20px rgba(34, 197, 94, 0.3)"]},transition:{duration:2,repeat:1/0},style:{borderRadius:"50%"},children:(0,b.jsx)("div",{className:"w-full h-full rounded-full bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center",children:(0,b.jsx)(as.Github,{className:"w-8 h-8 text-white"})})}),g&&(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-4 px-3 py-2 rounded-lg bg-red-500/10 border border-red-500/20",children:[(0,b.jsx)(av.AlertTriangle,{className:"w-4 h-4 text-red-400"}),(0,b.jsx)("span",{className:"text-sm text-red-300",children:g})]}),(0,b.jsx)("h2",{className:"text-xl font-bold text-white mb-2",children:"GitHub Authentication Required"}),(0,b.jsx)("p",{className:"text-white/50 text-sm leading-relaxed",children:i&&!n?"Connect your GitHub account to enable sandbox features.":"To use the sandbox environment, you need to authenticate with GitHub. This enables secure code execution and repository access."})]}),(0,b.jsx)("div",{className:"px-6 pb-6",children:(0,b.jsxs)("div",{className:"bg-white/5 rounded-2xl p-4 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center",children:(0,b.jsx)(at.Shield,{className:"w-4 h-4 text-white/60"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-white/80",children:"Secure Sandbox Access"}),(0,b.jsx)("p",{className:"text-white/40 text-xs",children:"Run code in isolated cloud environments"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center",children:(0,b.jsx)(au.Code2,{className:"w-4 h-4 text-white/60"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-white/80",children:"Repository Integration"}),(0,b.jsx)("p",{className:"text-white/40 text-xs",children:"Clone, commit, and push to your repos"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center",children:(0,b.jsx)(P.Terminal,{className:"w-4 h-4 text-white/60"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-white/80",children:"Full Terminal Access"}),(0,b.jsx)("p",{className:"text-white/40 text-xs",children:"Run commands and build projects"})]})]})]})}),(0,b.jsxs)("div",{className:"px-6 pb-8",children:[i?(0,b.jsxs)("button",{onClick:q,onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),className:"w-full flex items-center justify-center gap-3 px-6 py-4 rounded-2xl bg-gradient-to-r from-green-500 to-green-600 hover:from-green-400 hover:to-green-500 text-white font-semibold transition-all shadow-lg shadow-green-500/25",children:[(0,b.jsx)(as.Github,{className:"w-5 h-5"}),(0,b.jsx)("span",{children:"Connect GitHub Account"}),(0,b.jsx)(W.ExternalLink,{className:"w-4 h-4 opacity-60"})]}):l?(0,b.jsx)(l,{mode:"modal",children:(0,b.jsxs)("button",{onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),className:"w-full flex items-center justify-center gap-3 px-6 py-4 rounded-2xl bg-gradient-to-r from-green-500 to-green-600 hover:from-green-400 hover:to-green-500 text-white font-semibold transition-all shadow-lg shadow-green-500/25",children:[(0,b.jsx)(as.Github,{className:"w-5 h-5"}),(0,b.jsx)("span",{children:"Sign in with GitHub"})]})}):(0,b.jsxs)("button",{onClick:()=>{f?.(),d()},className:"w-full flex items-center justify-center gap-3 px-6 py-4 rounded-2xl bg-gradient-to-r from-green-500 to-green-600 hover:from-green-400 hover:to-green-500 text-white font-semibold transition-all shadow-lg shadow-green-500/25",children:[(0,b.jsx)(as.Github,{className:"w-5 h-5"}),(0,b.jsx)("span",{children:"Continue"})]}),(0,b.jsx)("p",{className:"text-center text-white/30 text-xs mt-4",children:i?"You'll be redirected to connect your GitHub account":"Authentication is required for sandbox operations"})]}),(0,b.jsx)("div",{className:"px-6 pb-6 text-center",children:(0,b.jsx)("button",{onClick:d,className:"text-white/40 hover:text-white/60 text-sm transition-colors",children:"Cancel and go back"})})]})})]})})}var ax=a.i(903994),ay=a.i(480878),az=a.i(443305),aA=a.i(1891),aB=a.i(189198),aC=a.i(389089),aD=a.i(730676),aE=a.i(161977);let aF=["Ah, here's the thing...","I'd love to let you into the workshop, truly I would. But this particular room is where I keep all the sharp tools and live wires.","The ∞gent can execute code, push to repos, and deploy to production. So I keep it locked up tight. Nothing personal, just being a responsible host."],aG=aF.join(" ");async function aH(a){try{let b=await fetch("/api/tts/elevenlabs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:a,stability:.5,similarityBoost:.75})});if(b.ok){let a=await b.blob();if(a.size>0)return console.log("[AgentAccessRestricted] Using Eleven Labs TTS"),a}let c=await b.json().catch(()=>null);if(c?.fallback!=="openai")throw Error("Eleven Labs failed without fallback")}catch(a){console.log("[AgentAccessRestricted] Eleven Labs unavailable, trying OpenAI:",a)}console.log("[AgentAccessRestricted] Using OpenAI TTS fallback");let b=await fetch("/api/tts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:a,voice:"onyx",model:"tts-1-hd",speed:1})});if(!b.ok)throw Error("Both TTS services failed");return b.blob()}function aI({isLoading:a,isSignedIn:d,clerkId:e,userEmail:f}){let[g,h]=(0,c.useState)(0),[i,j]=(0,c.useState)(""),[k,l]=(0,c.useState)(!0),[m,n]=(0,c.useState)(!1),[o,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(!1),[t,u]=(0,c.useState)(!1),w=(0,c.useRef)(null),x=(0,c.useRef)(!1);(0,c.useCallback)(()=>{e&&(navigator.clipboard.writeText(e),q(!0),setTimeout(()=>q(!1),2e3))},[e]);let y="james_restricted_audio_v1";(0,c.useEffect)(()=>{if(!a&&!x.current)return x.current=!0,(async()=>{try{let a,b=localStorage.getItem(y);if(b)console.log("[AgentAccessRestricted] Using cached audio"),a=b;else{console.log("[AgentAccessRestricted] Generating speech (will cache)...");let b=await aH(aG),c=new FileReader;a=await new Promise(a=>{c.onloadend=()=>a(c.result),c.readAsDataURL(b)});try{localStorage.setItem(y,a),console.log("[AgentAccessRestricted] Audio cached")}catch(a){console.warn("[AgentAccessRestricted] Could not cache audio:",a)}}let c=new Audio(a);c.onended=()=>{s(!1),console.log("[AgentAccessRestricted] Audio ended")},c.onerror=a=>{console.error("[AgentAccessRestricted] Audio error:",a),s(!1),localStorage.removeItem(y)},w.current=c;try{await c.play(),s(!0),console.log("[AgentAccessRestricted] Audio playing")}catch(a){console.warn("[AgentAccessRestricted] Autoplay blocked:",a)}}catch(a){console.error("[AgentAccessRestricted] TTS error:",a)}})(),()=>{w.current&&(w.current.pause(),w.current=null)}},[a]);let z=(0,c.useCallback)(()=>{w.current&&(t?(w.current.muted=!1,u(!1)):(w.current.muted=!0,u(!0)))},[t]),A=(0,c.useCallback)(async()=>{if(w.current&&!r)try{await w.current.play(),s(!0)}catch(a){console.error("[AgentAccessRestricted] Play failed:",a)}},[r]);return((0,c.useEffect)(()=>{if(a)return;if(g>=aF.length){l(!1);let a=setTimeout(()=>n(!0),500);return()=>clearTimeout(a)}let b=aF[g],c=0;j(""),l(!0);let d=setInterval(()=>{c<b.length?(j(b.slice(0,c+1)),c++):(clearInterval(d),setTimeout(()=>{h(a=>a+1)},0===g?800:1200))},30);return()=>clearInterval(d)},[g,a]),a)?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",style:{background:"hsl(var(--theme-background))",color:"hsl(var(--theme-foreground))"},children:(0,b.jsxs)(p.motion.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center gap-4",children:[(0,b.jsx)(p.motion.div,{className:"w-16 h-16 rounded-full overflow-hidden ring-4 ring-[hsl(var(--theme-primary)/0.3)]",animate:{boxShadow:["0 0 20px hsl(var(--theme-primary) / 0.2)","0 0 40px hsl(var(--theme-primary) / 0.4)","0 0 20px hsl(var(--theme-primary) / 0.2)"]},transition:{duration:2,repeat:1/0},children:(0,b.jsx)(aC.default,{src:"/openclaw-logo.png",alt:"James",width:64,height:64,className:"w-full h-full object-cover"})}),(0,b.jsx)("p",{className:"text-sm",style:{color:"hsl(var(--theme-muted-foreground))"},children:"One moment..."})]})}):(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",style:{background:"hsl(var(--theme-background))",color:"hsl(var(--theme-foreground))"},children:(0,b.jsxs)(p.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-md w-full text-center",children:[(0,b.jsxs)("div",{className:"relative w-24 h-24 mx-auto mb-6",children:[(0,b.jsx)(p.motion.div,{className:"w-full h-full rounded-full overflow-hidden ring-4 ring-[hsl(var(--theme-primary)/0.3)]",initial:{scale:.8},animate:{scale:1,boxShadow:r?["0 0 20px hsl(var(--theme-primary) / 0.3)","0 0 40px hsl(var(--theme-primary) / 0.5)","0 0 20px hsl(var(--theme-primary) / 0.3)"]:["0 0 20px hsl(var(--theme-primary) / 0.2)","0 0 30px hsl(var(--theme-primary) / 0.3)","0 0 20px hsl(var(--theme-primary) / 0.2)"]},transition:{scale:{type:"spring",stiffness:200,delay:.1},boxShadow:{duration:r?1:3,repeat:1/0}},children:(0,b.jsx)(aC.default,{src:"/openclaw-logo.png",alt:"James",width:96,height:96,className:"w-full h-full object-cover"})}),(0,b.jsx)(p.motion.button,{onClick:r?z:A,className:"absolute -bottom-1 -right-1 w-8 h-8 rounded-full flex items-center justify-center transition-colors",style:{background:"hsl(var(--theme-primary))",color:"white"},whileHover:{scale:1.1},whileTap:{scale:.95},initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{delay:.5},title:r?t?"Unmute":"Mute":"Play audio",children:r&&t?(0,b.jsx)(aA.VolumeX,{className:"w-4 h-4"}):(0,b.jsx)(az.Volume2,{className:"w-4 h-4"})}),r&&!t&&(0,b.jsx)(p.motion.div,{className:"absolute -top-1 -right-1 flex gap-0.5",initial:{opacity:0},animate:{opacity:1},children:[0,.1,.2].map((a,c)=>(0,b.jsx)(p.motion.div,{className:"w-1 rounded-full",style:{background:"hsl(var(--theme-primary))"},animate:{height:[4,12,4]},transition:{duration:.4,repeat:1/0,delay:a}},c))})]}),(0,b.jsxs)("div",{className:"min-h-[200px] flex flex-col justify-start",children:[g>=0&&(0,b.jsx)(p.motion.h1,{className:"text-2xl font-bold mb-4",style:{color:"hsl(var(--theme-foreground))"},initial:{opacity:0},animate:{opacity:1},children:0===g?(0,b.jsxs)(b.Fragment,{children:[i,k&&(0,b.jsx)(p.motion.span,{animate:{opacity:[1,0]},transition:{duration:.5,repeat:1/0},className:"inline-block w-0.5 h-6 bg-current ml-0.5 align-middle"})]}):aF[0]}),g>=1&&(0,b.jsx)(p.motion.p,{className:"text-base mb-4 leading-relaxed",style:{color:"hsl(var(--theme-muted-foreground))"},initial:{opacity:0},animate:{opacity:1},children:1===g?(0,b.jsxs)(b.Fragment,{children:[i,k&&(0,b.jsx)(p.motion.span,{animate:{opacity:[1,0]},transition:{duration:.5,repeat:1/0},className:"inline-block w-0.5 h-5 bg-current ml-0.5 align-middle"})]}):aF[1]}),g>=2&&(0,b.jsx)(p.motion.p,{className:"text-base mb-6 leading-relaxed",style:{color:"hsl(var(--theme-muted-foreground))"},initial:{opacity:0},animate:{opacity:1},children:2===g?(0,b.jsxs)(b.Fragment,{children:[i,k&&(0,b.jsx)(p.motion.span,{animate:{opacity:[1,0]},transition:{duration:.5,repeat:1/0},className:"inline-block w-0.5 h-5 bg-current ml-0.5 align-middle"})]}):aF[2]})]}),m&&(0,b.jsxs)(b.Fragment,{children:[d&&e?(0,b.jsxs)(p.motion.div,{className:"mb-6 p-4 rounded-xl text-left",style:{background:"hsl(var(--theme-primary) / 0.1)"},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05},children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,b.jsx)(v.Database,{className:"w-4 h-4",style:{color:"hsl(var(--theme-primary))"}}),(0,b.jsx)("span",{className:"text-sm font-medium",style:{color:"hsl(var(--theme-primary))"},children:"Almost there! Run this in your terminal:"})]}),(0,b.jsx)("div",{className:"mt-3 p-3 rounded-lg font-mono text-xs overflow-x-auto",style:{background:"hsl(var(--theme-background))"},children:(0,b.jsxs)("code",{style:{color:"hsl(var(--theme-muted-foreground))"},children:["npx convex run userManagement:seedOwner ",`'{"email":"${f||"your@email.com"}","displayName":"Your Name","clerkId":"${e}"}'`]})}),(0,b.jsxs)("button",{onClick:()=>{let a=`npx convex run userManagement:seedOwner '{"email":"${f||"your@email.com"}","displayName":"Your Name","clerkId":"${e}"}'`;navigator.clipboard.writeText(a),q(!0),setTimeout(()=>q(!1),2e3)},className:"mt-3 inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all hover:scale-[1.02]",style:{background:"hsl(var(--theme-primary))",color:"white"},children:[o?(0,b.jsx)(U.Check,{className:"w-4 h-4"}):(0,b.jsx)(T.Copy,{className:"w-4 h-4"}),o?"Copied!":"Copy Command"]}),(0,b.jsx)("p",{className:"mt-3 text-xs",style:{color:"hsl(var(--theme-muted-foreground) / 0.7)"},children:"This sets up owner permissions automatically. Refresh after running."})]}):(0,b.jsx)(aE.SignedOut,{children:(0,b.jsxs)(p.motion.div,{className:"mb-6",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05},children:[(0,b.jsx)("p",{className:"text-sm mb-3",style:{color:"hsl(var(--theme-muted-foreground))"},children:"Wait, are you the owner?"}),(0,b.jsx)(aD.SignInButton,{mode:"modal",children:(0,b.jsxs)("button",{className:"inline-flex items-center gap-2 px-6 py-3 rounded-xl font-medium transition-all hover:scale-[1.02] active:scale-[0.98]",style:{background:"hsl(142 70% 45%)",color:"white"},children:[(0,b.jsx)(as.Github,{className:"w-4 h-4"}),"Sign in to prove it"]})})]})}),(0,b.jsxs)(p.motion.div,{className:"flex items-center gap-4 mb-6",initial:{opacity:0},animate:{opacity:1},transition:{delay:.1},children:[(0,b.jsx)("div",{className:"flex-1 h-px",style:{background:"hsl(var(--theme-border))"}}),(0,b.jsx)("span",{className:"text-xs",style:{color:"hsl(var(--theme-muted-foreground))"},children:"or"}),(0,b.jsx)("div",{className:"flex-1 h-px",style:{background:"hsl(var(--theme-border))"}})]}),(0,b.jsxs)(p.motion.div,{className:"flex items-center justify-center gap-2 mb-6 px-4 py-3 rounded-xl",style:{background:"hsl(var(--theme-primary) / 0.1)"},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.15},children:[(0,b.jsx)(ax.Heart,{className:"w-4 h-4",style:{color:"hsl(var(--theme-primary))"}}),(0,b.jsx)("span",{className:"text-sm",style:{color:"hsl(var(--theme-primary))"},children:"Thanks for understanding"})]}),(0,b.jsx)(p.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},children:(0,b.jsx)(aB.default,{href:"/",children:(0,b.jsxs)(p.motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"inline-flex items-center gap-2 px-6 py-3 rounded-xl font-medium transition-colors",style:{background:"hsl(var(--theme-muted))",color:"hsl(var(--theme-foreground))"},children:[(0,b.jsx)(ay.ArrowLeft,{className:"w-4 h-4"}),"Let's explore something else"]})})}),(0,b.jsxs)(p.motion.p,{className:"text-sm mt-8 flex items-center justify-center gap-2",style:{color:"hsl(var(--theme-muted-foreground) / 0.7)"},initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:[(0,b.jsx)(af.Sparkles,{className:"w-3 h-3"}),"Plenty of other interesting corners to discover",(0,b.jsx)(af.Sparkles,{className:"w-3 h-3"})]})]})]})})}var aJ=a.i(713281),aK=a.i(665770),aL=a.i(135981);let aM=aL.api?.userManagement?.getManagedUserByClerkId??null,aN={episodic:42,semantic:18,working:3},aO=[{id:"proj-1",type:"project",name:"OpenClaw-OS",description:"Professional agentic operating system"},{id:"proj-2",type:"project",name:"8gent",description:"Next-gen agent platform"},{id:"prd-1",type:"prd",name:"infinity-agent",description:"PRD for coding agent integration"},{id:"ticket-1",type:"ticket",name:"ARC-001",description:"Implement context bar component"},{id:"ticket-2",type:"ticket",name:"ARC-002",description:"Add code panel with monaco editor"},{id:"file-1",type:"file",name:"agent/page.tsx",description:"Main agent page component"}],aP=["Authentication required","authentication required","Unauthorized","unauthorized","GitHub OAuth","OAuth","oauth","token expired","Token expired","invalid token","Invalid token","access denied","Access denied","not authenticated","Not authenticated","Status code 400","Status code 401","Status code 403"];function aQ(a){return!!a&&aP.some(b=>a.includes(b))}function aR({children:a}){let{user:c,isLoaded:d}=(0,o.useUser)(),e=c?.id,f=(0,n.useQuery)(aM,aM&&e?{clerkId:e}:"skip"),g=!d||aM&&e&&void 0===f,h=!aM||f?.role==="owner"||f?.role==="admin";return g?(0,b.jsx)(aI,{isLoading:!0}):h?(0,b.jsx)(b.Fragment,{children:a}):(0,b.jsx)(aI,{isSignedIn:!!c,clerkId:e,userEmail:c?.primaryEmailAddress?.emailAddress})}function aS(){let[a,d]=(0,c.useState)(!1),[n,o]=(0,c.useState)(),p=(0,c.useRef)(null),[q,r]=(0,c.useState)(!0),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)("chat"),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(!1),[D,E]=(0,c.useState)("code"),[F,G]=(0,c.useState)([]),H=function(){let a=(0,aJ.useSandboxContext)(),[b,d]=(0,c.useState)(null),[e,f]=(0,c.useState)([]),[g,h]=(0,c.useState)(!1),[i,j]=(0,c.useState)(null),k=(0,c.useCallback)((a,b)=>{f(c=>[...c,{id:`term_${Date.now()}_${Math.random().toString(36).slice(2)}`,type:a,content:b,timestamp:Date.now()}])},[]),l=(0,c.useCallback)(async()=>{try{k("system","Starting sandbox environment..."),await a.create({timeout:6e5,ports:[3e3,5173,8080]}),await a.listFiles("."),k("system","Sandbox ready!")}catch(a){k("error",`Failed to start sandbox: ${a}`)}},[a,k]),m=(0,c.useCallback)(async()=>{try{k("system","Terminating sandbox..."),await a.terminate(),d(null),j(null),k("system","Sandbox terminated")}catch(a){k("error",`Failed to stop sandbox: ${a}`)}},[a,k]),n=(0,c.useCallback)(async(b,c)=>{a.isConnected||await l(),k("command",`git clone ${b} (authenticated via GitHub)`),h(!0);try{let c=await a.cloneRepo(b);c.success?(k("system",`Repository cloned to ${c.projectDir}`),await a.listFiles(c.projectDir||"./project")):k("error",c.error||"Failed to clone repository")}catch(a){k("error",`Clone failed: ${a}`)}finally{h(!1)}},[a,l,k]),o=(0,c.useCallback)(async b=>{let c=await a.readFile(b);return d({path:b,content:c,language:{ts:"typescript",tsx:"typescript",js:"javascript",jsx:"javascript",json:"json",md:"markdown",mdx:"markdown",css:"css",scss:"scss",html:"html",py:"python",rs:"rust",go:"go",sh:"shell",bash:"shell",yml:"yaml",yaml:"yaml",toml:"toml",sql:"sql"}[b.split(".").pop()?.toLowerCase()||""]||"plaintext"}),c},[a]),p=(0,c.useCallback)(async(c,e)=>{await a.writeFile(c,e),k("system",`Wrote file: ${c}`),b?.path===c&&d({...b,content:e})},[a,b,k]),q=(0,c.useCallback)(async b=>{k("command",`$ ${b}`),h(!0);try{let c=b.match(/^git\s+clone\s+(\S+)(?:\s+(\S+))?$/i);if(c){let b=c[1];k("system","Using authenticated clone..."),k("system",`Fetching GitHub token and cloning ${b}...`);try{let c=await a.cloneRepo(b);return console.log("[Clone] Result:",c),c.success?(k("output",`✓ Cloned successfully to ${c.projectDir}`),k("system","Refreshing file list..."),await a.listFiles(c.projectDir),k("output",'Ready! Use "ls" to see files.')):k("error",`✗ Clone failed: ${c.error||"Unknown error"}`),{cmdId:`cmd_clone_${Date.now()}`,command:"git",args:["clone",b],status:c.success?"completed":"error",startedAt:Date.now(),exitCode:+!c.success,stdout:c.success?`Cloned to ${c.projectDir}`:"",stderr:c.error||""}}catch(c){console.error("[Clone] Error:",c);let a=c instanceof Error?c.message:"Clone failed";return k("error",`✗ ${a}`),{cmdId:`cmd_clone_${Date.now()}`,command:"git",args:["clone",b],status:"error",startedAt:Date.now(),exitCode:1,stdout:"",stderr:a}}}let d=b.split(" "),e=d[0],f=d.slice(1),g=await a.runCommand(e,f);return g.stdout&&k("output",g.stdout),g.stderr&&k("error",g.stderr),g}finally{h(!1)}},[a,k]),r=(0,c.useCallback)(async(b="npm run dev",c=3e3)=>{k("command",`$ ${b}`),h(!0);try{let d=b.split(" ");await a.runCommand(d[0],d.slice(1),{wait:!1}),await new Promise(a=>setTimeout(a,3e3));let e=await a.getPreviewUrl(c);return k("system",`Dev server started at ${e}`),e}finally{h(!1)}},[a,k]),s=(0,c.useCallback)(async()=>{a.isConnected&&await a.listFiles()},[a]),t=(0,c.useCallback)(async b=>{let{type:c,payload:d}=b;switch(c){case"repo_cloned":{let{url:a,branch:b}=d;await n(a,b);break}case"file_read":{let{path:a}=d;await o(a);break}case"file_written":{let{path:a,content:b}=d;await p(a,b);break}case"command_executed":{let{command:a}=d;await q(a);break}case"server_started":{let{command:a,port:b}=d;await r(a,b);break}case"preview_ready":{let{port:b}=d;await a.getPreviewUrl(b||3e3);break}case"git_status":{let a=await q("git status --porcelain"),b=a.stdout?.split("\n").filter(Boolean)||[],c={branch:"main",modified:[],staged:[],untracked:[]};b.forEach(a=>{let b=a.substring(0,2),d=a.substring(3);b.includes("M")&&c.modified.push(d),b.includes("A")&&c.staged.push(d),"??"===b&&c.untracked.push(d)}),j(c);break}case"git_diff":{let{path:a}=d;await q(a?`git diff ${a}`:"git diff");break}case"git_committed":{let{message:a}=d;await q(`git add -A && git commit -m "${a}"`);break}case"git_pushed":{let{branch:a}=d;await q(a?`git push origin ${a}`:"git push");break}case"branch_created":{let{name:a}=d;await q(`git checkout -b ${a}`);break}case"directory_listed":{let{path:b}=d;await a.listFiles(b||".");break}case"files_searched":{let{pattern:a,path:b}=d;await q(`grep -r "${a}" ${b||"."}`);break}default:console.log("Unhandled sandbox action:",c,d)}},[n,o,p,q,r,a]);return{isConnected:a.isConnected,isCreating:a.isCreating,sandboxId:a.state.sandboxId,previewUrl:a.state.previewUrl,error:a.error,files:a.state.files,currentFile:b,terminalOutput:e,isRunning:g,gitStatus:i,startSandbox:l,stopSandbox:m,executeToolAction:t,cloneRepository:n,readFile:o,writeFile:p,runCommand:q,startDevServer:r,refreshFiles:s,logs:a.logs,clearLogs:a.clearLogs}}();(0,c.useEffect)(()=>{let a=H.error;a!==p.current&&aQ(a)&&(o(a||"Authentication required"),d(!0)),p.current=a},[H.error]),(0,c.useEffect)(()=>{let a=H.terminalOutput[H.terminalOutput.length-1];a?.type==="error"&&aQ(a.content)&&(o(a.content),d(!0))},[H.terminalOutput]);let I=(0,c.useMemo)(()=>(function(a){let b=[],c=new Map;for(let e of[...a].sort((a,b)=>"directory"===a.type&&"file"===b.type?-1:"file"===a.type&&"directory"===b.type?1:a.path.localeCompare(b.path))){var d;let a=e.path.split("/").filter(Boolean),f=a[a.length-1],g="/"+a.slice(0,-1).join("/"),h={name:f,path:e.path,type:"directory"===e.type?"folder":"file",children:"directory"===e.type?[]:void 0,language:"file"===e.type?(d=f,({ts:"typescript",tsx:"typescript",js:"javascript",jsx:"javascript",json:"json",md:"markdown",css:"css",html:"html",py:"python"})[d.split(".").pop()?.toLowerCase()||""]||"plaintext"):void 0};if(c.set(e.path,h),1===a.length||"/home/user"===g||"/home"===g)b.push(h);else{let a=c.get(g);a&&a.children?a.children.push(h):b.push(h)}}return b})(H.files),[H.files]),J=(0,c.useMemo)(()=>H.terminalOutput.map(a=>({id:a.id,type:"command"===a.type?"command":"error"===a.type?"error":"output",content:a.content,timestamp:a.timestamp})),[H.terminalOutput]),{threads:K,activeThreadId:L,createThread:M,switchThread:O,deleteThread:P,ensureThread:Q}=(0,aK.useChatThreads)(),{messages:R,isStreaming:S,sendMessage:T,abortStream:U}=function(a={}){let{model:b="default",themeContext:d,onStreamStart:e,onStreamEnd:f,onError:g}=a,[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)([]),p=(0,c.useRef)(null),q=()=>`msg_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,r=(0,c.useCallback)(async a=>{if(!a.trim()||j)return;m(null);let c={id:q(),role:"user",content:a.trim(),timestamp:new Date},l={id:q(),role:"assistant",content:"",timestamp:new Date,isStreaming:!0,thinking:"",isThinkingStreaming:!1};i(a=>[...a,c,l]),k(!0),e?.(),p.current=new AbortController;try{let a=[...h,c].map(a=>({role:a.role,content:a.content})),e=await fetch("/api/chat/stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:a,model:b,themeContext:d}),signal:p.current.signal});if(!e.ok){let a=await e.json().catch(()=>({}));throw Error(a.error||"Failed to get response")}let f=e.body?.getReader();if(!f)throw Error("No response body");let g=new TextDecoder,j="",k="";for(;;){let{done:a,value:b}=await f.read();if(a)break;for(let a of g.decode(b,{stream:!0}).split("\n"))if(a.startsWith("data: ")){let b=a.slice(6);if("[DONE]"===b)continue;try{let a=JSON.parse(b);if(a.content&&(j+=a.content,i(a=>a.map(a=>a.id===l.id?{...a,content:j,isThinkingStreaming:!1}:a))),a.thinking&&(k+=a.thinking,i(a=>a.map(a=>a.id===l.id?{...a,thinking:k,isThinkingStreaming:!0}:a))),a.toolCall){let{id:b,name:c,status:d}=a.toolCall;o(a=>a.find(a=>a.id===b)?a.map(a=>a.id===b?{...a,status:d}:a):[...a,{id:b,name:c,status:d}])}if(a.toolResult){let{id:b,name:c,result:d}=a.toolResult;o(a=>a.map(a=>a.id===b?{...a,status:"complete",result:d}:a))}if(a.toolError){let{id:b,error:c}=a.toolError;o(a=>a.map(a=>a.id===b?{...a,status:"error",error:c}:a))}if(a.toolDenied){let{name:b,reason:c}=a.toolDenied,d=`denied_${Date.now()}`;o(a=>[...a,{id:d,name:b,status:"denied",error:c}])}}catch{}}}o(a=>(i(b=>b.map(b=>b.id===l.id?{...b,isStreaming:!1,isThinkingStreaming:!1,toolCalls:a.length>0?[...a]:void 0}:b)),[]))}catch(a){if(a instanceof Error&&"AbortError"===a.name)i(a=>a.map(a=>a.id===l.id?{...a,isStreaming:!1,content:a.content||"Request cancelled."}:a));else{let b=a instanceof Error?a.message:"Unknown error";m(b),g?.(a instanceof Error?a:Error(b)),i(a=>a.map(a=>a.id===l.id?{...a,isStreaming:!1,content:`Sorry, I encountered an error: ${b}. Please try again.`}:a))}}finally{k(!1),p.current=null,f?.()}},[h,j,b,d,e,f,g]);return{messages:h,isStreaming:j,error:l,activeToolCalls:n,sendMessage:r,clearMessages:(0,c.useCallback)(()=>{i([]),m(null),o([])},[]),setMessages:i,abortStream:(0,c.useCallback)(()=>{p.current&&p.current.abort()},[])}}({onStreamStart:()=>console.log("Stream started"),onStreamEnd:()=>console.log("Stream ended")}),V=(0,c.useMemo)(()=>R.map(a=>({id:a.id,role:a.role,content:a.content,timestamp:a.timestamp,isStreaming:a.isStreaming})),[R]),W=(0,c.useCallback)(()=>{d(!1),o(void 0),H.startSandbox()},[H]),X=(0,c.useCallback)((a,b)=>{Q(),b&&b.length>0&&v(a=>{let c=[...a];return b.forEach(a=>{c.find(b=>b.id===a.id)||c.push(a)}),c});let c="";H.isConnected&&(c+="\n\n[SANDBOX CONNECTED - You have full coding capabilities: clone repos with git, run terminal commands, create/edit files, install packages, run dev servers. Use the terminal below to execute commands.]"),u.length>0&&(c+=`

[Active Context: ${u.map(a=>`@${a.type}:${a.name}`).join(", ")}]`),T(a+c),["code","implement","create","build","fix","debug","file","component","clone","repo","git"].some(b=>a.toLowerCase().includes(b))&&z(!0)},[Q,T,u,H.isConnected]),Y=(0,c.useCallback)(a=>{G(aO.filter(b=>b.name.toLowerCase().includes(a.toLowerCase())||b.description?.toLowerCase().includes(a.toLowerCase())))},[]),Z=(0,c.useCallback)(a=>{let b={id:a.id,type:a.type,name:a.name,description:a.description};v(a=>a.find(a=>a.id===b.id)?a:[...a,b])},[]),$=(0,c.useCallback)(a=>{v(b=>b.filter(b=>b.id!==a))},[]),_=(0,c.useCallback)(()=>{v([])},[]),ab=(0,c.useCallback)(async a=>{if(H.isConnected)try{await H.readFile(a),E("code")}catch(a){console.error("Failed to read file:",a)}},[H]),ac=(0,c.useCallback)(async a=>{H.isConnected&&await H.runCommand(a)},[H]),ad=(0,c.useCallback)(()=>{r(a=>!a)},[]),ae=(0,c.useCallback)(()=>{t(a=>!a)},[]);return(0,c.useEffect)(()=>{let a=()=>{window.innerWidth>=1024&&r(!0)};return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aw,{isOpen:a,onClose:()=>d(!1),onAuthenticated:W,errorMessage:n}),(0,b.jsx)("div",{className:"h-screen flex flex-col overflow-hidden",style:{background:"hsl(var(--theme-background))",color:"hsl(var(--theme-foreground))",fontFamily:"var(--theme-font)"},children:(0,b.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,b.jsx)(e.AnimatePresence,{children:(q||!1)&&!s&&(0,b.jsx)(C,{isOpen:q,onClose:()=>r(!1),threads:K,activeThreadId:L,onNewThread:M,onSelectThread:O,onDeleteThread:P,memoryStats:aN,recentMentions:u.slice(-5).map(a=>({id:a.id,type:a.type,name:a.name,timestamp:Date.now()})),onMentionClick:a=>{let b=u.find(b=>b.id===a.id);b&&console.log("Clicked mention:",b)}})}),(0,b.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 px-4 py-2",style:{background:"hsl(var(--theme-card))",borderBottom:"1px solid hsl(var(--theme-border))"},children:[(0,b.jsx)("button",{onClick:ad,className:"p-2 rounded-lg transition-colors lg:hidden",style:{color:"hsl(var(--theme-foreground))"},onMouseEnter:a=>a.currentTarget.style.background="hsl(var(--theme-muted))",onMouseLeave:a=>a.currentTarget.style.background="transparent",children:(0,b.jsx)(f.Menu,{className:"w-5 h-5"})}),(0,b.jsx)("button",{onClick:ae,className:"p-2 rounded-lg transition-colors hidden lg:flex",title:s?"Show sidebar":"Hide sidebar",style:{color:"hsl(var(--theme-foreground))"},onMouseEnter:a=>a.currentTarget.style.background="hsl(var(--theme-muted))",onMouseLeave:a=>a.currentTarget.style.background="transparent",children:s?(0,b.jsx)(h.PanelLeft,{className:"w-5 h-5"}):(0,b.jsx)(g.PanelLeftClose,{className:"w-5 h-5"})}),(0,b.jsx)("h1",{className:"text-lg font-semibold",style:{color:"hsl(var(--theme-foreground))"},children:"∞gent"}),(0,b.jsx)("div",{className:"flex-1"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[H.isConnected?(0,b.jsxs)("button",{onClick:H.stopSandbox,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm transition-colors",style:{background:"hsl(0 84% 60% / 0.2)",color:"hsl(0 84% 60%)"},onMouseEnter:a=>a.currentTarget.style.background="hsl(0 84% 60% / 0.3)",onMouseLeave:a=>a.currentTarget.style.background="hsl(0 84% 60% / 0.2)",children:[(0,b.jsx)(k.Square,{className:"w-4 h-4"}),"Stop"]}):(0,b.jsx)("button",{onClick:H.startSandbox,disabled:H.isCreating,className:(0,m.cn)("flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm transition-colors","disabled:opacity-50 disabled:cursor-not-allowed"),style:{background:"hsl(var(--theme-primary) / 0.2)",color:"hsl(var(--theme-primary))"},onMouseEnter:a=>a.currentTarget.style.background="hsl(var(--theme-primary) / 0.3)",onMouseLeave:a=>a.currentTarget.style.background="hsl(var(--theme-primary) / 0.2)",children:H.isCreating?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Loader2,{className:"w-4 h-4 animate-spin"}),"Starting..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j.Play,{className:"w-4 h-4"}),"Start Sandbox"]})}),H.isConnected&&(0,b.jsx)("span",{className:"text-xs font-medium",style:{color:"hsl(142 70% 45%)"},children:"● Connected"})]}),(0,b.jsx)("button",{onClick:()=>z(a=>!a),className:"p-2 rounded-lg transition-colors",title:y?"Hide code panel":"Show code panel",style:{background:y?"hsl(var(--theme-primary) / 0.2)":"transparent",color:y?"hsl(var(--theme-primary))":"hsl(var(--theme-muted-foreground))"},onMouseEnter:a=>{y||(a.currentTarget.style.background="hsl(var(--theme-muted))")},onMouseLeave:a=>{y||(a.currentTarget.style.background="transparent")},children:(0,b.jsx)(i.Code,{className:"w-5 h-5"})})]}),(0,b.jsx)(N,{contextChain:u,currentView:w,onViewChange:x,onEntityClick:a=>console.log("Entity clicked:",a),onRemoveEntity:$,onClearContext:_}),(0,b.jsx)("div",{className:"flex-1 min-h-0",children:(0,b.jsx)(ar,{messages:V,isStreaming:S,onSendMessage:X,onAbort:U,mentionSuggestions:F,onMentionSearch:Y,onMentionSelect:Z,isVoiceEnabled:!0})}),(0,b.jsx)(e.AnimatePresence,{children:y&&(0,b.jsx)(aa,{isVisible:y,isExpanded:A,activeTab:D,onTabChange:E,onToggleExpanded:()=>B(a=>!a),onClose:()=>z(!1),code:H.currentFile?.content||"// Select a file or start coding...",language:H.currentFile?.language||"typescript",currentFile:H.currentFile?.path,onCodeChange:a=>{H.currentFile?.path&&H.writeFile(H.currentFile.path,a)},files:I,onFileSelect:ab,terminalOutput:J,onRunCommand:ac,isRunning:H.isRunning,previewUrl:H.previewUrl||void 0,onRefreshPreview:()=>{H.isConnected&&H.startDevServer()}})})]})]})})]})}function aT(){return(0,b.jsx)(aR,{children:(0,b.jsx)(aJ.SandboxProvider,{children:(0,b.jsx)(aS,{})})})}let aU=(0,d.default)(()=>Promise.resolve(aT),{ssr:!1,loading:()=>(0,b.jsx)(aI,{isLoading:!0})});a.s(["default",0,aU],210808)}];

//# sourceMappingURL=src_app_agent_page_tsx_3c5fa82a._.js.map