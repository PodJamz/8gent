{"version":3,"sources":["../../../../src/app/cowrite/page.tsx","../../../../src/context/CowriteContext.tsx","../../../../src/components/cowrite/CowriteApp.tsx","../../../../src/lib/cowrite/claw-ai-cowrite-prompt.ts","../../../../src/lib/cowrite/style-presets.ts"],"sourcesContent":["'use client';\n\nimport { PageTransition } from '@/components/ios';\nimport { CowriteProvider } from '@/context/CowriteContext';\nimport { CowriteApp } from '@/components/cowrite';\n\nexport default function CowritePage() {\n  return (\n    <PageTransition>\n      <CowriteProvider>\n        <CowriteApp />\n      </CowriteProvider>\n    </PageTransition>\n  );\n}\n","'use client';\n\nimport {\n  createContext,\n  useContext,\n  useState,\n  useCallback,\n  useEffect,\n  type ReactNode,\n} from 'react';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface StylePrompt {\n  id: string;\n  name: string;\n  content: string;\n  isFavorite: boolean;\n  createdAt: number;\n  updatedAt: number;\n}\n\nexport interface LyricsPrompt {\n  id: string;\n  name: string;\n  content: string;\n  stylePromptId: string | null;\n  version: number;\n  parentVersionId: string | null;\n  createdAt: number;\n  updatedAt: number;\n}\n\nexport interface CowriteSession {\n  id: string;\n  name: string;\n  stylePromptId: string | null;\n  lyricsPromptId: string | null;\n  createdAt: number;\n  updatedAt: number;\n}\n\nexport type ActiveTab = 'style' | 'lyrics' | 'chat';\n\ninterface CowriteState {\n  stylePrompts: StylePrompt[];\n  lyricsPrompts: LyricsPrompt[];\n  sessions: CowriteSession[];\n  activeStylePromptId: string | null;\n  activeLyricsPromptId: string | null;\n  activeSessionId: string | null;\n  activeTab: ActiveTab;\n  isChatOpen: boolean;\n}\n\ninterface CowriteContextType extends CowriteState {\n  // Style Prompt CRUD\n  createStylePrompt: (name?: string, content?: string) => StylePrompt;\n  updateStylePrompt: (id: string, updates: Partial<Omit<StylePrompt, 'id' | 'createdAt'>>) => void;\n  deleteStylePrompt: (id: string) => void;\n  duplicateStylePrompt: (id: string) => StylePrompt | null;\n  toggleFavoriteStyle: (id: string) => void;\n\n  // Lyrics Prompt CRUD\n  createLyricsPrompt: (name?: string, content?: string, stylePromptId?: string | null) => LyricsPrompt;\n  updateLyricsPrompt: (id: string, updates: Partial<Omit<LyricsPrompt, 'id' | 'createdAt' | 'version' | 'parentVersionId'>>) => void;\n  deleteLyricsPrompt: (id: string) => void;\n  duplicateLyricsPrompt: (id: string) => LyricsPrompt | null;\n  createLyricsVersion: (id: string, newContent: string) => LyricsPrompt | null;\n  getLyricsVersionHistory: (id: string) => LyricsPrompt[];\n\n  // Session CRUD\n  createSession: (name?: string) => CowriteSession;\n  updateSession: (id: string, updates: Partial<Omit<CowriteSession, 'id' | 'createdAt'>>) => void;\n  deleteSession: (id: string) => void;\n\n  // Selection\n  selectStylePrompt: (id: string | null) => void;\n  selectLyricsPrompt: (id: string | null) => void;\n  selectSession: (id: string | null) => void;\n\n  // Tab Navigation\n  setActiveTab: (tab: ActiveTab) => void;\n\n  // Chat\n  openChat: () => void;\n  closeChat: () => void;\n  toggleChat: () => void;\n\n  // Computed\n  activeStylePrompt: StylePrompt | null;\n  activeLyricsPrompt: LyricsPrompt | null;\n  activeSession: CowriteSession | null;\n  favoriteStylePrompts: StylePrompt[];\n}\n\n// ============================================================================\n// Storage Keys\n// ============================================================================\n\nconst STORAGE_KEYS = {\n  stylePrompts: 'openclaw.cowrite.stylePrompts',\n  lyricsPrompts: 'openclaw.cowrite.lyricsPrompts',\n  sessions: 'openclaw.cowrite.sessions',\n  activeStylePromptId: 'openclaw.cowrite.activeStylePromptId',\n  activeLyricsPromptId: 'openclaw.cowrite.activeLyricsPromptId',\n  activeSessionId: 'openclaw.cowrite.activeSessionId',\n  activeTab: 'openclaw.cowrite.activeTab',\n} as const;\n\n// ============================================================================\n// Defaults\n// ============================================================================\n\nconst DEFAULT_STYLE_PROMPT: StylePrompt = {\n  id: 'default-style',\n  name: 'Starter Style',\n  content: `[Is_Max_Mode:Max]\n[Quality:Maxi]\n[Realism:Max]\n[Real_Instruments:Max]\n[Persona:Max]\n\nGENRE: Cinematic Pop / Synth-Pop Fusion\nTEMPO: 118 BPM, steady groove with dynamic builds\nVOCALS: Ethereal female lead, breathy verses, powerful chorus\nCADENCE: Relaxed verses, driving pre-hooks, anthemic hooks\nINSTRUMENTATION: Layered synths, organic drums, atmospheric pads, subtle strings\nMOOD: Hopeful, introspective, triumphant crescendos`,\n  isFavorite: true,\n  createdAt: Date.now(),\n  updatedAt: Date.now(),\n};\n\nconst DEFAULT_LYRICS_PROMPT: LyricsPrompt = {\n  id: 'default-lyrics',\n  name: 'Starter Lyrics',\n  content: `/|/***///\n\n[INTRO - INSTRUMENTAL]\n(soft synth pads, building anticipation)\n\n[VERSE 1]\nWalking through the static haze\nEvery signal finds its way\nThrough the noise I hear your voice\nCalling me to make a choice\n\n[PRE-HOOK]\nAnd I know, yeah I know\nThis is where we start to grow\n\n[HOOK]\nLight it up, light it up\nWe're the spark that won't give up\nRising high, breaking through\nEverything I am is you\n\n[VERSE 2]\nShadows fade when you appear\nAll my doubts just disappear\nIn this moment, crystal clear\nThis is why we're standing here\n\n[PRE-HOOK]\nAnd I know, yeah I know\nThis is where we start to glow\n\n[HOOK]\nLight it up, light it up\nWe're the spark that won't give up\nRising high, breaking through\nEverything I am is you\n\n[BRIDGE]\n(soft, intimate)\nWhen the world goes quiet\nWe'll still be the riot\nIn each other's eyes\n\n[FINAL HOOK - BIG]\nLight it up, light it UP\nWe're the spark that won't give up\nRising high, breaking through\nEverything I am is you\n(is you... is you...)\n\n[OUTRO]\n(fade with ambient pads and gentle hum)`,\n  stylePromptId: 'default-style',\n  version: 1,\n  parentVersionId: null,\n  createdAt: Date.now(),\n  updatedAt: Date.now(),\n};\n\n// ============================================================================\n// Utilities\n// ============================================================================\n\nfunction generateId(): string {\n  return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n}\n\nfunction safeJsonParse<T>(json: string | null, fallback: T): T {\n  if (!json) return fallback;\n  try {\n    return JSON.parse(json);\n  } catch {\n    return fallback;\n  }\n}\n\n// ============================================================================\n// Context\n// ============================================================================\n\nconst CowriteContext = createContext<CowriteContextType | null>(null);\n\nexport function CowriteProvider({ children }: { children: ReactNode }) {\n  // State\n  const [stylePrompts, setStylePrompts] = useState<StylePrompt[]>([]);\n  const [lyricsPrompts, setLyricsPrompts] = useState<LyricsPrompt[]>([]);\n  const [sessions, setSessions] = useState<CowriteSession[]>([]);\n  const [activeStylePromptId, setActiveStylePromptId] = useState<string | null>(null);\n  const [activeLyricsPromptId, setActiveLyricsPromptId] = useState<string | null>(null);\n  const [activeSessionId, setActiveSessionId] = useState<string | null>(null);\n  const [activeTab, setActiveTab] = useState<ActiveTab>('lyrics');\n  const [isChatOpen, setIsChatOpen] = useState(false);\n  const [isHydrated, setIsHydrated] = useState(false);\n\n  // Load from localStorage on mount\n  useEffect(() => {\n    const storedStylePrompts = safeJsonParse<StylePrompt[]>(\n      localStorage.getItem(STORAGE_KEYS.stylePrompts),\n      []\n    );\n    const storedLyricsPrompts = safeJsonParse<LyricsPrompt[]>(\n      localStorage.getItem(STORAGE_KEYS.lyricsPrompts),\n      []\n    );\n    const storedSessions = safeJsonParse<CowriteSession[]>(\n      localStorage.getItem(STORAGE_KEYS.sessions),\n      []\n    );\n    const storedActiveStyleId = localStorage.getItem(STORAGE_KEYS.activeStylePromptId);\n    const storedActiveLyricsId = localStorage.getItem(STORAGE_KEYS.activeLyricsPromptId);\n    const storedActiveSessionId = localStorage.getItem(STORAGE_KEYS.activeSessionId);\n    const storedActiveTab = localStorage.getItem(STORAGE_KEYS.activeTab) as ActiveTab | null;\n\n    // Initialize with defaults if empty\n    if (storedStylePrompts.length === 0) {\n      setStylePrompts([DEFAULT_STYLE_PROMPT]);\n      setActiveStylePromptId(DEFAULT_STYLE_PROMPT.id);\n    } else {\n      setStylePrompts(storedStylePrompts);\n      if (storedActiveStyleId) setActiveStylePromptId(storedActiveStyleId);\n    }\n\n    if (storedLyricsPrompts.length === 0) {\n      setLyricsPrompts([DEFAULT_LYRICS_PROMPT]);\n      setActiveLyricsPromptId(DEFAULT_LYRICS_PROMPT.id);\n    } else {\n      setLyricsPrompts(storedLyricsPrompts);\n      if (storedActiveLyricsId) setActiveLyricsPromptId(storedActiveLyricsId);\n    }\n\n    setSessions(storedSessions);\n    if (storedActiveSessionId) setActiveSessionId(storedActiveSessionId);\n    if (storedActiveTab) setActiveTab(storedActiveTab);\n\n    setIsHydrated(true);\n  }, []);\n\n  // Persist to localStorage\n  useEffect(() => {\n    if (!isHydrated) return;\n    localStorage.setItem(STORAGE_KEYS.stylePrompts, JSON.stringify(stylePrompts));\n  }, [stylePrompts, isHydrated]);\n\n  useEffect(() => {\n    if (!isHydrated) return;\n    localStorage.setItem(STORAGE_KEYS.lyricsPrompts, JSON.stringify(lyricsPrompts));\n  }, [lyricsPrompts, isHydrated]);\n\n  useEffect(() => {\n    if (!isHydrated) return;\n    localStorage.setItem(STORAGE_KEYS.sessions, JSON.stringify(sessions));\n  }, [sessions, isHydrated]);\n\n  useEffect(() => {\n    if (!isHydrated) return;\n    if (activeStylePromptId) {\n      localStorage.setItem(STORAGE_KEYS.activeStylePromptId, activeStylePromptId);\n    } else {\n      localStorage.removeItem(STORAGE_KEYS.activeStylePromptId);\n    }\n  }, [activeStylePromptId, isHydrated]);\n\n  useEffect(() => {\n    if (!isHydrated) return;\n    if (activeLyricsPromptId) {\n      localStorage.setItem(STORAGE_KEYS.activeLyricsPromptId, activeLyricsPromptId);\n    } else {\n      localStorage.removeItem(STORAGE_KEYS.activeLyricsPromptId);\n    }\n  }, [activeLyricsPromptId, isHydrated]);\n\n  useEffect(() => {\n    if (!isHydrated) return;\n    if (activeSessionId) {\n      localStorage.setItem(STORAGE_KEYS.activeSessionId, activeSessionId);\n    } else {\n      localStorage.removeItem(STORAGE_KEYS.activeSessionId);\n    }\n  }, [activeSessionId, isHydrated]);\n\n  useEffect(() => {\n    if (!isHydrated) return;\n    localStorage.setItem(STORAGE_KEYS.activeTab, activeTab);\n  }, [activeTab, isHydrated]);\n\n  // ============================================================================\n  // Style Prompt CRUD\n  // ============================================================================\n\n  const createStylePrompt = useCallback((name = 'Untitled Style', content = ''): StylePrompt => {\n    const newPrompt: StylePrompt = {\n      id: generateId(),\n      name,\n      content: content || `[Is_Max_Mode:Max]\n[Quality:Maxi]\n[Realism:Max]\n[Real_Instruments:Max]\n[Persona:Max]\n\nGENRE:\nTEMPO:\nVOCALS:\nCADENCE:\nINSTRUMENTATION:\nMOOD: `,\n      isFavorite: false,\n      createdAt: Date.now(),\n      updatedAt: Date.now(),\n    };\n    setStylePrompts((prev) => [newPrompt, ...prev]);\n    setActiveStylePromptId(newPrompt.id);\n    return newPrompt;\n  }, []);\n\n  const updateStylePrompt = useCallback(\n    (id: string, updates: Partial<Omit<StylePrompt, 'id' | 'createdAt'>>) => {\n      setStylePrompts((prev) =>\n        prev.map((prompt) =>\n          prompt.id === id\n            ? { ...prompt, ...updates, updatedAt: Date.now() }\n            : prompt\n        )\n      );\n    },\n    []\n  );\n\n  const deleteStylePrompt = useCallback((id: string) => {\n    setStylePrompts((prev) => prev.filter((prompt) => prompt.id !== id));\n    setActiveStylePromptId((prev) => (prev === id ? null : prev));\n  }, []);\n\n  const duplicateStylePrompt = useCallback((id: string): StylePrompt | null => {\n    const original = stylePrompts.find((p) => p.id === id);\n    if (!original) return null;\n\n    const duplicate: StylePrompt = {\n      ...original,\n      id: generateId(),\n      name: `${original.name} (Copy)`,\n      isFavorite: false,\n      createdAt: Date.now(),\n      updatedAt: Date.now(),\n    };\n    setStylePrompts((prev) => [duplicate, ...prev]);\n    setActiveStylePromptId(duplicate.id);\n    return duplicate;\n  }, [stylePrompts]);\n\n  const toggleFavoriteStyle = useCallback((id: string) => {\n    setStylePrompts((prev) =>\n      prev.map((prompt) =>\n        prompt.id === id\n          ? { ...prompt, isFavorite: !prompt.isFavorite, updatedAt: Date.now() }\n          : prompt\n      )\n    );\n  }, []);\n\n  // ============================================================================\n  // Lyrics Prompt CRUD\n  // ============================================================================\n\n  const createLyricsPrompt = useCallback(\n    (name = 'Untitled Lyrics', content = '', stylePromptId: string | null = null): LyricsPrompt => {\n      const newPrompt: LyricsPrompt = {\n        id: generateId(),\n        name,\n        content: content || `/|/***///\n\n[INTRO]\n\n[VERSE 1]\n\n[PRE-HOOK]\n\n[HOOK]\n\n[VERSE 2]\n\n[HOOK]\n\n[BRIDGE]\n\n[FINAL HOOK]\n\n[OUTRO]`,\n        stylePromptId: stylePromptId ?? activeStylePromptId,\n        version: 1,\n        parentVersionId: null,\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      };\n      setLyricsPrompts((prev) => [newPrompt, ...prev]);\n      setActiveLyricsPromptId(newPrompt.id);\n      return newPrompt;\n    },\n    [activeStylePromptId]\n  );\n\n  const updateLyricsPrompt = useCallback(\n    (id: string, updates: Partial<Omit<LyricsPrompt, 'id' | 'createdAt' | 'version' | 'parentVersionId'>>) => {\n      setLyricsPrompts((prev) =>\n        prev.map((prompt) =>\n          prompt.id === id\n            ? { ...prompt, ...updates, updatedAt: Date.now() }\n            : prompt\n        )\n      );\n    },\n    []\n  );\n\n  const deleteLyricsPrompt = useCallback((id: string) => {\n    setLyricsPrompts((prev) => prev.filter((prompt) => prompt.id !== id));\n    setActiveLyricsPromptId((prev) => (prev === id ? null : prev));\n  }, []);\n\n  const duplicateLyricsPrompt = useCallback((id: string): LyricsPrompt | null => {\n    const original = lyricsPrompts.find((p) => p.id === id);\n    if (!original) return null;\n\n    const duplicate: LyricsPrompt = {\n      ...original,\n      id: generateId(),\n      name: `${original.name} (Copy)`,\n      version: 1,\n      parentVersionId: null,\n      createdAt: Date.now(),\n      updatedAt: Date.now(),\n    };\n    setLyricsPrompts((prev) => [duplicate, ...prev]);\n    setActiveLyricsPromptId(duplicate.id);\n    return duplicate;\n  }, [lyricsPrompts]);\n\n  const createLyricsVersion = useCallback((id: string, newContent: string): LyricsPrompt | null => {\n    const original = lyricsPrompts.find((p) => p.id === id);\n    if (!original) return null;\n\n    const newVersion: LyricsPrompt = {\n      ...original,\n      id: generateId(),\n      content: newContent,\n      version: original.version + 1,\n      parentVersionId: original.id,\n      createdAt: Date.now(),\n      updatedAt: Date.now(),\n    };\n    setLyricsPrompts((prev) => [newVersion, ...prev]);\n    setActiveLyricsPromptId(newVersion.id);\n    return newVersion;\n  }, [lyricsPrompts]);\n\n  const getLyricsVersionHistory = useCallback((id: string): LyricsPrompt[] => {\n    const prompt = lyricsPrompts.find((p) => p.id === id);\n    if (!prompt) return [];\n\n    // Find the root (version 1)\n    let root = prompt;\n    while (root.parentVersionId) {\n      const parent = lyricsPrompts.find((p) => p.id === root.parentVersionId);\n      if (parent) root = parent;\n      else break;\n    }\n\n    // Collect all versions from root\n    const versions: LyricsPrompt[] = [root];\n    const findChildren = (parentId: string) => {\n      const children = lyricsPrompts.filter((p) => p.parentVersionId === parentId);\n      for (const child of children) {\n        versions.push(child);\n        findChildren(child.id);\n      }\n    };\n    findChildren(root.id);\n\n    return versions.sort((a, b) => a.version - b.version);\n  }, [lyricsPrompts]);\n\n  // ============================================================================\n  // Session CRUD\n  // ============================================================================\n\n  const createSession = useCallback((name = 'Untitled Session'): CowriteSession => {\n    const newSession: CowriteSession = {\n      id: generateId(),\n      name,\n      stylePromptId: activeStylePromptId,\n      lyricsPromptId: activeLyricsPromptId,\n      createdAt: Date.now(),\n      updatedAt: Date.now(),\n    };\n    setSessions((prev) => [newSession, ...prev]);\n    setActiveSessionId(newSession.id);\n    return newSession;\n  }, [activeStylePromptId, activeLyricsPromptId]);\n\n  const updateSession = useCallback(\n    (id: string, updates: Partial<Omit<CowriteSession, 'id' | 'createdAt'>>) => {\n      setSessions((prev) =>\n        prev.map((session) =>\n          session.id === id\n            ? { ...session, ...updates, updatedAt: Date.now() }\n            : session\n        )\n      );\n    },\n    []\n  );\n\n  const deleteSession = useCallback((id: string) => {\n    setSessions((prev) => prev.filter((session) => session.id !== id));\n    setActiveSessionId((prev) => (prev === id ? null : prev));\n  }, []);\n\n  // ============================================================================\n  // Selection\n  // ============================================================================\n\n  const selectStylePrompt = useCallback((id: string | null) => {\n    setActiveStylePromptId(id);\n  }, []);\n\n  const selectLyricsPrompt = useCallback((id: string | null) => {\n    setActiveLyricsPromptId(id);\n  }, []);\n\n  const selectSession = useCallback((id: string | null) => {\n    setActiveSessionId(id);\n    // Load session prompts\n    const session = sessions.find((s) => s.id === id);\n    if (session) {\n      if (session.stylePromptId) setActiveStylePromptId(session.stylePromptId);\n      if (session.lyricsPromptId) setActiveLyricsPromptId(session.lyricsPromptId);\n    }\n  }, [sessions]);\n\n  // ============================================================================\n  // Chat\n  // ============================================================================\n\n  const openChat = useCallback(() => setIsChatOpen(true), []);\n  const closeChat = useCallback(() => setIsChatOpen(false), []);\n  const toggleChat = useCallback(() => setIsChatOpen((prev) => !prev), []);\n\n  // ============================================================================\n  // Computed Values\n  // ============================================================================\n\n  const activeStylePrompt = stylePrompts.find((p) => p.id === activeStylePromptId) ?? null;\n  const activeLyricsPrompt = lyricsPrompts.find((p) => p.id === activeLyricsPromptId) ?? null;\n  const activeSession = sessions.find((s) => s.id === activeSessionId) ?? null;\n  const favoriteStylePrompts = stylePrompts.filter((p) => p.isFavorite).sort((a, b) => b.updatedAt - a.updatedAt);\n\n  // ============================================================================\n  // Context Value\n  // ============================================================================\n\n  const value: CowriteContextType = {\n    // State\n    stylePrompts,\n    lyricsPrompts,\n    sessions,\n    activeStylePromptId,\n    activeLyricsPromptId,\n    activeSessionId,\n    activeTab,\n    isChatOpen,\n\n    // Style Prompt CRUD\n    createStylePrompt,\n    updateStylePrompt,\n    deleteStylePrompt,\n    duplicateStylePrompt,\n    toggleFavoriteStyle,\n\n    // Lyrics Prompt CRUD\n    createLyricsPrompt,\n    updateLyricsPrompt,\n    deleteLyricsPrompt,\n    duplicateLyricsPrompt,\n    createLyricsVersion,\n    getLyricsVersionHistory,\n\n    // Session CRUD\n    createSession,\n    updateSession,\n    deleteSession,\n\n    // Selection\n    selectStylePrompt,\n    selectLyricsPrompt,\n    selectSession,\n\n    // Tab Navigation\n    setActiveTab,\n\n    // Chat\n    openChat,\n    closeChat,\n    toggleChat,\n\n    // Computed\n    activeStylePrompt,\n    activeLyricsPrompt,\n    activeSession,\n    favoriteStylePrompts,\n  };\n\n  return <CowriteContext.Provider value={value}>{children}</CowriteContext.Provider>;\n}\n\nexport function useCowrite() {\n  const context = useContext(CowriteContext);\n  if (!context) {\n    throw new Error('useCowrite must be used within a CowriteProvider');\n  }\n  return context;\n}\n","'use client';\n\nimport { useState, useRef, useEffect, useCallback } from 'react';\nimport { motion } from 'framer-motion';\nimport { useCowrite } from '@/context/CowriteContext';\nimport { useVoiceRecorder } from '@/hooks/useVoiceRecorder';\nimport {\n  Music4,\n  Mic2,\n  Copy,\n  Check,\n  Send,\n  Loader2,\n  Mic,\n  Square,\n  Minimize2,\n  Maximize2,\n  RotateCcw,\n  Scissors,\n  Plus,\n  ArrowUpDown,\n  AlertCircle,\n  Wand2,\n  Lock,\n  Unlock,\n  Palette,\n  ChevronDown,\n  Pencil,\n  Eye,\n  MessageSquare,\n  FileText,\n  Download,\n  Upload,\n  Save,\n  Undo2,\n  Redo2,\n  Keyboard,\n} from 'lucide-react';\nimport { CLAW_AI_COWRITE_SYSTEM_PROMPT } from '@/lib/cowrite/claw-ai-cowrite-prompt';\nimport {\n  STYLE_PRESETS,\n  BLANK_STYLE_PRESET,\n  MAX_MODE_HEADER,\n  applyMaxMode,\n  type StylePreset,\n} from '@/lib/cowrite/style-presets';\n\n// ============================================================================\n// Types\n// ============================================================================\n\ninterface ChatMessage {\n  id: string;\n  role: 'user' | 'assistant';\n  content: string;\n  isVoice?: boolean;\n  reference?: {\n    text: string;\n    source: 'style' | 'lyrics';\n  };\n}\n\ninterface QuickAction {\n  id: string;\n  label: string;\n  icon: React.ComponentType<{ className?: string }>;\n  prompt: string;\n  target: 'style' | 'lyrics' | 'both';\n}\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nconst QUICK_ACTIONS: QuickAction[] = [\n  {\n    id: 'tighten',\n    label: 'Tighten',\n    icon: Scissors,\n    prompt: 'Make the current prompts more sparse and concise. Remove unnecessary words. Add more space and pauses. Keep the core message but use fewer words.',\n    target: 'both',\n  },\n  {\n    id: 'expand',\n    label: 'Expand',\n    icon: Plus,\n    prompt: 'Expand the current prompts. Add more verses, develop the themes further, and make the song longer while maintaining the style and voice.',\n    target: 'lyrics',\n  },\n  {\n    id: 'reorder',\n    label: 'Reorder',\n    icon: ArrowUpDown,\n    prompt: 'Fix the chronology and reorder the sections for better narrative flow. Do not rewrite the bars, just rearrange the structure.',\n    target: 'lyrics',\n  },\n  {\n    id: 'sanity',\n    label: 'Check',\n    icon: AlertCircle,\n    prompt: 'Review the current prompts for any issues: facts, names, pronunciation problems, character limits, or formatting errors. Fix any problems found.',\n    target: 'both',\n  },\n  {\n    id: 'darker',\n    label: 'Darker',\n    icon: Wand2,\n    prompt: 'Make the tone darker and more intense. Adjust both the style and lyrics to be more moody, atmospheric, and emotionally heavy.',\n    target: 'both',\n  },\n];\n\n// ============================================================================\n// Session & History Types\n// ============================================================================\n\ninterface CowriteSession {\n  id: string;\n  name: string;\n  styleContent: string;\n  lyricsContent: string;\n  messages: ChatMessage[];\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface HistoryState {\n  styleContent: string;\n  lyricsContent: string;\n}\n\nconst SESSIONS_STORAGE_KEY = 'cowrite_sessions';\nconst CURRENT_SESSION_KEY = 'cowrite_current_session';\nconst MAX_HISTORY_LENGTH = 50;\n\n// Session storage utilities\nconst saveSessions = (sessions: CowriteSession[]) => {\n  if (typeof window !== 'undefined') {\n    localStorage.setItem(SESSIONS_STORAGE_KEY, JSON.stringify(sessions));\n  }\n};\n\nconst loadSessions = (): CowriteSession[] => {\n  if (typeof window === 'undefined') return [];\n  const stored = localStorage.getItem(SESSIONS_STORAGE_KEY);\n  return stored ? JSON.parse(stored) : [];\n};\n\nconst saveCurrentSession = (session: CowriteSession) => {\n  if (typeof window !== 'undefined') {\n    localStorage.setItem(CURRENT_SESSION_KEY, JSON.stringify(session));\n  }\n};\n\nconst loadCurrentSession = (): CowriteSession | null => {\n  if (typeof window === 'undefined') return null;\n  const stored = localStorage.getItem(CURRENT_SESSION_KEY);\n  return stored ? JSON.parse(stored) : null;\n};\n\n// Export utilities\nconst exportToFile = (content: string, filename: string, type: 'txt' | 'md') => {\n  const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = `${filename}.${type}`;\n  document.body.appendChild(a);\n  a.click();\n  document.body.removeChild(a);\n  URL.revokeObjectURL(url);\n};\n\nconst formatExportContent = (style: string, lyrics: string): string => {\n  return `# CoWrite Session Export\nGenerated: ${new Date().toLocaleString()}\n\n## Style Prompt\n\\`\\`\\`\n${style}\n\\`\\`\\`\n\n## Lyrics Prompt\n\\`\\`\\`\n${lyrics}\n\\`\\`\\`\n`;\n};\n\n// ============================================================================\n// Selection Popover Component\n// ============================================================================\n\ninterface SelectionPopoverProps {\n  selectedText: string;\n  position: { x: number; y: number };\n  onCopy: () => void;\n  onAddToChat: () => void;\n  onClose: () => void;\n}\n\nfunction SelectionPopover({ selectedText, position, onCopy, onAddToChat, onClose }: SelectionPopoverProps) {\n  const popoverRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    const handleClickOutside = (e: MouseEvent) => {\n      if (popoverRef.current && !popoverRef.current.contains(e.target as Node)) {\n        onClose();\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, [onClose]);\n\n  if (!selectedText) return null;\n\n  return (\n    <motion.div\n      ref={popoverRef}\n      initial={{ opacity: 0, y: 4 }}\n      animate={{ opacity: 1, y: 0 }}\n      exit={{ opacity: 0, y: 4 }}\n      className=\"fixed z-50 flex items-center gap-1 p-1 bg-card border border-border rounded-lg shadow-xl\"\n      style={{\n        left: Math.max(8, Math.min(position.x - 60, window.innerWidth - 140)),\n        top: Math.max(8, position.y - 44),\n      }}\n    >\n      <button\n        onClick={onCopy}\n        className=\"flex items-center gap-1.5 px-2.5 py-1.5 text-xs font-medium rounded-md hover:bg-muted transition-colors text-foreground\"\n      >\n        <Copy className=\"w-3.5 h-3.5\" />\n        Copy\n      </button>\n      <div className=\"w-px h-4 bg-border\" />\n      <button\n        onClick={onAddToChat}\n        className=\"flex items-center gap-1.5 px-2.5 py-1.5 text-xs font-medium rounded-md hover:bg-muted transition-colors\"\n        style={{ color: 'hsl(var(--theme-primary))' }}\n      >\n        <MessageSquare className=\"w-3.5 h-3.5\" />\n        Add to Chat\n      </button>\n    </motion.div>\n  );\n}\n\n// ============================================================================\n// Rich Content View Component - Document-style rendering (Apple Notes feel)\n// ============================================================================\n\ninterface RichContentViewProps {\n  content: string;\n  type: 'style' | 'lyrics';\n}\n\nfunction RichContentView({ content, type }: RichContentViewProps) {\n  // Parse and render content with elegant document styling\n  const renderContent = () => {\n    if (!content) {\n      return (\n        <p className=\"text-muted-foreground italic text-sm\">\n          {type === 'style' ? 'No style prompt yet...' : 'No lyrics yet...'}\n        </p>\n      );\n    }\n\n    const lines = content.split('\\n');\n    const elements: React.ReactNode[] = [];\n\n    lines.forEach((line, index) => {\n      const trimmedLine = line.trim();\n\n      // Empty lines - gentle spacing\n      if (!trimmedLine) {\n        elements.push(<div key={index} className=\"h-2\" />);\n        return;\n      }\n\n      // MAX MODE header tags like [Is_Max_Mode:Max], [Quality:Maxi], etc.\n      const maxModeMatch = trimmedLine.match(/^\\[([A-Za-z_]+):([A-Za-z]+)\\]$/);\n      if (maxModeMatch) {\n        elements.push(\n          <div key={index} className=\"flex items-center gap-2 py-1\">\n            <span className=\"text-xs font-medium text-muted-foreground\">\n              {maxModeMatch[1].replace(/_/g, ' ')}\n            </span>\n            <span className=\"text-xs font-semibold text-foreground\">\n              {maxModeMatch[2]}\n            </span>\n          </div>\n        );\n        return;\n      }\n\n      // Section tags like [VERSE], [CHORUS], [HOOK], [INTRO], [OUTRO], [BRIDGE], [BREAK]\n      const sectionMatch = trimmedLine.match(/^\\[([A-Z0-9\\s-]+)\\]$/);\n      if (sectionMatch) {\n        const sectionName = sectionMatch[1];\n        elements.push(\n          <div key={index} className=\"flex items-center gap-3 mt-6 mb-3 first:mt-0\">\n            <div\n              className=\"h-px flex-1 max-w-8\"\n              style={{ backgroundColor: 'hsl(var(--theme-primary) / 0.3)' }}\n            />\n            <span\n              className=\"text-xs font-semibold uppercase tracking-widest\"\n              style={{ color: 'hsl(var(--theme-primary))' }}\n            >\n              {sectionName}\n            </span>\n            <div\n              className=\"h-px flex-1\"\n              style={{ backgroundColor: 'hsl(var(--theme-primary) / 0.3)' }}\n            />\n          </div>\n        );\n        return;\n      }\n\n      // Suno signature line /|/***///\n      if (trimmedLine.includes('/|/***///') || trimmedLine.match(/^\\/\\|\\/\\*+\\/\\/\\/$/)) {\n        elements.push(\n          <div key={index} className=\"flex items-center justify-center py-3 my-2\">\n            <span className=\"text-xs text-muted-foreground/50 tracking-[0.3em]\">\n              ✦ ✦ ✦\n            </span>\n          </div>\n        );\n        return;\n      }\n\n      // Inline tags in lyrics like [spoken], [whispered], [grunt], etc.\n      const hasInlineTags = /\\[[^\\]]+\\]/.test(trimmedLine) && !sectionMatch && !maxModeMatch;\n      if (hasInlineTags && type === 'lyrics') {\n        const parts = trimmedLine.split(/(\\[[^\\]]+\\])/g);\n        elements.push(\n          <p key={index} className=\"text-sm leading-7 text-foreground\">\n            {parts.map((part, partIndex) => {\n              if (part.match(/^\\[[^\\]]+\\]$/)) {\n                return (\n                  <span\n                    key={partIndex}\n                    className=\"inline-flex items-center mx-0.5 px-1.5 py-0.5 rounded-md text-xs bg-muted text-muted-foreground\"\n                  >\n                    {part.slice(1, -1)}\n                  </span>\n                );\n              }\n              return <span key={partIndex}>{part}</span>;\n            })}\n          </p>\n        );\n        return;\n      }\n\n      // Style prompt descriptive lines\n      if (type === 'style' && !maxModeMatch) {\n        elements.push(\n          <p key={index} className=\"text-sm leading-7 text-foreground\">\n            {trimmedLine}\n          </p>\n        );\n        return;\n      }\n\n      // Regular lyrics lines - elegant typography\n      elements.push(\n        <p key={index} className=\"text-sm leading-7 text-foreground\">\n          {line || '\\u00A0'}\n        </p>\n      );\n    });\n\n    return elements;\n  };\n\n  return (\n    <article className=\"space-y-0\">\n      {renderContent()}\n    </article>\n  );\n}\n\n// ============================================================================\n// Artifact Panel Component\n// ============================================================================\n\ninterface ArtifactPanelProps {\n  type: 'style' | 'lyrics';\n  title: string;\n  icon: React.ComponentType<{ className?: string }>;\n  content: string;\n  onChange: (content: string) => void;\n  isLocked: boolean;\n  onToggleLock: () => void;\n  charLimit: number;\n  headerExtra?: React.ReactNode;\n  isExpanded: boolean;\n  onToggleExpand: () => void;\n  onAddToChat?: (text: string, source: 'style' | 'lyrics') => void;\n}\n\nfunction ArtifactPanel({\n  type,\n  title,\n  icon: Icon,\n  content,\n  onChange,\n  isLocked,\n  onToggleLock,\n  charLimit,\n  headerExtra,\n  isExpanded,\n  onToggleExpand,\n  onAddToChat,\n}: ArtifactPanelProps) {\n  const [copied, setCopied] = useState(false);\n  const [isEditing, setIsEditing] = useState(false);\n  const [selection, setSelection] = useState<{ text: string; position: { x: number; y: number } } | null>(null);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const contentRef = useRef<HTMLDivElement>(null);\n\n  const handleCopy = () => {\n    navigator.clipboard.writeText(content);\n    setCopied(true);\n    setTimeout(() => setCopied(false), 2000);\n  };\n\n  const handleTextSelection = useCallback(() => {\n    const selectedText = window.getSelection()?.toString().trim();\n    if (selectedText && selectedText.length > 0) {\n      const selectionObj = window.getSelection();\n      if (selectionObj && selectionObj.rangeCount > 0) {\n        const range = selectionObj.getRangeAt(0);\n        const rect = range.getBoundingClientRect();\n        setSelection({\n          text: selectedText,\n          position: { x: rect.left + rect.width / 2, y: rect.top },\n        });\n      }\n    }\n  }, []);\n\n  const handleSelectionCopy = () => {\n    if (selection?.text) {\n      navigator.clipboard.writeText(selection.text);\n      setSelection(null);\n    }\n  };\n\n  const handleAddToChat = () => {\n    if (selection?.text && onAddToChat) {\n      onAddToChat(selection.text, type);\n      setSelection(null);\n    }\n  };\n\n  const charCount = content.length;\n  const isOverLimit = charCount > charLimit;\n\n  // Focus textarea when entering edit mode\n  useEffect(() => {\n    if (isEditing && textareaRef.current) {\n      textareaRef.current.focus();\n    }\n  }, [isEditing]);\n\n  // Minimized view\n  if (!isExpanded) {\n    return (\n      <div className=\"flex items-center justify-between px-4 py-3 bg-card rounded-2xl border border-border\">\n        <div className=\"flex items-center gap-2\">\n          <span style={{ color: 'hsl(var(--theme-primary))' }}>\n            <Icon className=\"w-4 h-4\" />\n          </span>\n          <span className=\"font-semibold text-sm text-foreground\">{title}</span>\n          <span className=\"text-xs text-muted-foreground\">{charCount} chars</span>\n        </div>\n        <button\n          onClick={onToggleExpand}\n          className=\"p-1.5 rounded-lg text-muted-foreground hover:text-foreground hover:bg-muted transition-colors\"\n          title=\"Expand\"\n        >\n          <Maximize2 className=\"w-4 h-4\" />\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col h-full bg-card rounded-2xl border border-border overflow-hidden\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between px-3 py-2 border-b border-border bg-muted/30\">\n        <div className=\"flex items-center gap-2\">\n          <span style={{ color: 'hsl(var(--theme-primary))' }}>\n            <Icon className=\"w-4 h-4\" />\n          </span>\n          <span className=\"font-semibold text-sm text-foreground\">{title}</span>\n          <span\n            className={`text-xs px-1.5 py-0.5 rounded-full ${\n              isOverLimit\n                ? 'bg-red-500/10 text-red-500'\n                : 'bg-muted text-muted-foreground'\n            }`}\n          >\n            {charCount}/{charLimit}\n          </span>\n          {headerExtra}\n        </div>\n        <div className=\"flex items-center gap-0.5\">\n          {/* View/Edit toggle */}\n          <button\n            onClick={() => setIsEditing(!isEditing)}\n            className={`p-1.5 rounded-lg transition-colors ${\n              isEditing\n                ? 'text-foreground bg-muted'\n                : 'text-muted-foreground hover:text-foreground hover:bg-muted'\n            }`}\n            style={\n              isEditing\n                ? { color: 'hsl(var(--theme-primary))' }\n                : undefined\n            }\n            title={isEditing ? 'View formatted' : 'Edit raw'}\n          >\n            {isEditing ? <Eye className=\"w-4 h-4\" /> : <Pencil className=\"w-4 h-4\" />}\n          </button>\n          <button\n            onClick={onToggleLock}\n            className=\"p-1.5 rounded-lg text-muted-foreground hover:text-foreground hover:bg-muted transition-colors\"\n            title={isLocked ? 'Unlock editing' : 'Lock from AI edits'}\n          >\n            {isLocked ? <Lock className=\"w-4 h-4\" /> : <Unlock className=\"w-4 h-4\" />}\n          </button>\n          <button\n            onClick={handleCopy}\n            className=\"p-1.5 rounded-lg transition-colors text-muted-foreground hover:text-foreground hover:bg-muted\"\n            style={\n              copied\n                ? { color: 'hsl(var(--theme-primary))' }\n                : undefined\n            }\n            title={copied ? 'Copied!' : 'Copy'}\n          >\n            {copied ? <Check className=\"w-4 h-4\" /> : <Copy className=\"w-4 h-4\" />}\n          </button>\n          <button\n            onClick={onToggleExpand}\n            className=\"p-1.5 rounded-lg text-muted-foreground hover:text-foreground hover:bg-muted transition-colors\"\n            title=\"Minimize\"\n          >\n            <Minimize2 className=\"w-4 h-4\" />\n          </button>\n        </div>\n      </div>\n\n      {/* Content Area - Rich View or Editor */}\n      <div className=\"flex-1 overflow-hidden relative\">\n        {isEditing ? (\n          /* Raw Editor */\n          <textarea\n            ref={textareaRef}\n            value={content}\n            onChange={(e) => onChange(e.target.value)}\n            disabled={isLocked}\n            className={`w-full h-full p-4 font-mono text-sm resize-none focus:outline-none ${\n              isLocked ? 'bg-muted/50 text-muted-foreground cursor-not-allowed' : 'bg-card text-foreground'\n            }`}\n            style={{\n              lineHeight: '1.6',\n            }}\n            spellCheck={false}\n          />\n        ) : (\n          /* Rich Text View */\n          <div\n            ref={contentRef}\n            className={`w-full h-full p-4 overflow-y-auto select-text ${\n              isLocked ? 'bg-muted/30' : 'bg-card'\n            }`}\n            style={{\n              lineHeight: '1.6',\n            }}\n            onMouseUp={handleTextSelection}\n            onTouchEnd={handleTextSelection}\n          >\n            <RichContentView content={content} type={type} />\n          </div>\n        )}\n        {isLocked && (\n          <div className=\"absolute inset-0 flex items-center justify-center bg-background/50 backdrop-blur-[1px]\">\n            <div className=\"flex items-center gap-2 text-muted-foreground text-sm\">\n              <Lock className=\"w-4 h-4\" />\n              <span>Locked from AI edits</span>\n            </div>\n          </div>\n        )}\n        {/* Selection Popover */}\n        {selection && onAddToChat && (\n          <SelectionPopover\n            selectedText={selection.text}\n            position={selection.position}\n            onCopy={handleSelectionCopy}\n            onAddToChat={handleAddToChat}\n            onClose={() => setSelection(null)}\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n\n// ============================================================================\n// Voice Input Button\n// ============================================================================\n\ninterface VoiceInputButtonProps {\n  onTranscription: (text: string) => void;\n  disabled?: boolean;\n}\n\nfunction VoiceInputButton({ onTranscription, disabled }: VoiceInputButtonProps) {\n  const [isTranscribing, setIsTranscribing] = useState(false);\n  const { isRecording, duration, audioLevels, startRecording, stopRecording, isSupported } =\n    useVoiceRecorder({\n      maxDuration: 120,\n    });\n\n  const formatDuration = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const handleToggleRecording = async () => {\n    if (isRecording) {\n      const blob = await stopRecording();\n      if (blob) {\n        setIsTranscribing(true);\n        try {\n          const formData = new FormData();\n          formData.append('audio', blob, 'recording.webm');\n\n          const response = await fetch('/api/whisper', {\n            method: 'POST',\n            body: formData,\n          });\n\n          if (response.ok) {\n            const data = await response.json();\n            if (data.text) {\n              onTranscription(data.text);\n            }\n          }\n        } catch (error) {\n          console.error('Transcription error:', error);\n        } finally {\n          setIsTranscribing(false);\n        }\n      }\n    } else {\n      await startRecording();\n    }\n  };\n\n  if (!isSupported) return null;\n\n  return (\n    <div className=\"flex items-center gap-2\">\n      {isRecording && (\n        <div className=\"flex items-center gap-2\">\n          {/* Waveform visualization */}\n          <div className=\"flex items-center gap-0.5 h-6\">\n            {audioLevels.slice(-8).map((level, i) => (\n              <div\n                key={i}\n                className=\"w-1 rounded-full transition-all duration-75\"\n                style={{\n                  height: `${Math.max(4, level * 24)}px`,\n                  backgroundColor: 'hsl(var(--theme-primary))',\n                  opacity: 0.6 + level * 0.4,\n                }}\n              />\n            ))}\n          </div>\n          <span className=\"text-xs text-muted-foreground tabular-nums\">\n            {formatDuration(duration)}\n          </span>\n        </div>\n      )}\n\n      <motion.button\n        onClick={handleToggleRecording}\n        disabled={disabled || isTranscribing}\n        whileHover={{ scale: 1.05 }}\n        whileTap={{ scale: 0.95 }}\n        className={`p-3 rounded-full transition-colors ${\n          isRecording\n            ? 'bg-red-500 text-white'\n            : isTranscribing\n            ? 'bg-muted text-muted-foreground'\n            : 'bg-muted text-foreground hover:bg-muted/80'\n        }`}\n      >\n        {isTranscribing ? (\n          <Loader2 className=\"w-4 h-4 animate-spin\" />\n        ) : isRecording ? (\n          <Square className=\"w-4 h-4 fill-current\" />\n        ) : (\n          <Mic className=\"w-4 h-4\" />\n        )}\n      </motion.button>\n    </div>\n  );\n}\n\n// ============================================================================\n// Quick Actions Bar\n// ============================================================================\n\ninterface QuickActionsBarProps {\n  onAction: (action: QuickAction) => void;\n  isLoading: boolean;\n}\n\nfunction QuickActionsBar({ onAction, isLoading }: QuickActionsBarProps) {\n  return (\n    <div className=\"flex items-center gap-2 overflow-x-auto py-2 px-1 scrollbar-hide\">\n      {QUICK_ACTIONS.map((action) => (\n        <button\n          key={action.id}\n          onClick={() => onAction(action)}\n          disabled={isLoading}\n          className=\"flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-colors bg-muted text-foreground hover:bg-muted/80 disabled:opacity-50\"\n        >\n          <action.icon className=\"w-3.5 h-3.5\" />\n          {action.label}\n        </button>\n      ))}\n    </div>\n  );\n}\n\n// ============================================================================\n// Preset Selector Component\n// ============================================================================\n\ninterface PresetSelectorProps {\n  onSelectPreset: (preset: StylePreset) => void;\n}\n\nfunction PresetSelector({ onSelectPreset }: PresetSelectorProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n\n  // Close on click outside\n  useEffect(() => {\n    function handleClickOutside(event: MouseEvent) {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n      }\n    }\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const handleSelect = (preset: StylePreset) => {\n    onSelectPreset(preset);\n    setIsOpen(false);\n  };\n\n  // Group presets by category\n  const categories = [\n    { name: 'Kinetic / Rhythmic', ids: ['wild-cadence-neo-soul', 'scatter-swagger', 'modern-poet'] },\n    { name: 'Soul / Introspective', ids: ['brazilian-retro-soul', 'irish-neo-soul', 'afro-soul-introspection', 'lofi-soul-confessional', 'warm-affirmation'] },\n    { name: 'Cinematic / Abstract', ids: ['abstract-spoken-melody', 'cinematic-inner-dialogue'] },\n    { name: 'Groove / Funk', ids: ['minimal-funk'] },\n    { name: 'Experimental', ids: ['tech-poetry-os'] },\n  ];\n\n  return (\n    <div className=\"relative\" ref={dropdownRef}>\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm transition-colors bg-muted text-foreground hover:bg-muted/80\"\n      >\n        <Palette className=\"w-4 h-4\" />\n        <span>Presets</span>\n        <ChevronDown className={`w-3.5 h-3.5 transition-transform ${isOpen ? 'rotate-180' : ''}`} />\n      </button>\n\n      {isOpen && (\n        <motion.div\n          initial={{ opacity: 0, y: -10 }}\n          animate={{ opacity: 1, y: 0 }}\n          exit={{ opacity: 0, y: -10 }}\n          className=\"absolute top-full left-0 mt-2 w-80 max-h-96 overflow-y-auto bg-card border border-border rounded-xl shadow-xl z-50\"\n        >\n          {/* Blank option */}\n          <button\n            onClick={() => handleSelect(BLANK_STYLE_PRESET)}\n            className=\"w-full flex items-center gap-3 px-4 py-3 text-left hover:bg-muted/50 transition-colors border-b border-border\"\n          >\n            <span className=\"text-lg\">{BLANK_STYLE_PRESET.emoji}</span>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-sm font-medium text-foreground\">{BLANK_STYLE_PRESET.name}</p>\n              <p className=\"text-xs text-muted-foreground truncate\">{BLANK_STYLE_PRESET.description}</p>\n            </div>\n          </button>\n\n          {/* Categorized presets */}\n          {categories.map((category) => (\n            <div key={category.name}>\n              <div className=\"px-4 py-2 bg-muted/30\">\n                <p className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wide\">{category.name}</p>\n              </div>\n              {category.ids.map((id) => {\n                const preset = STYLE_PRESETS.find((p) => p.id === id);\n                if (!preset) return null;\n                return (\n                  <button\n                    key={preset.id}\n                    onClick={() => handleSelect(preset)}\n                    className=\"w-full flex items-center gap-3 px-4 py-2.5 text-left hover:bg-muted/50 transition-colors\"\n                  >\n                    <span className=\"text-lg\">{preset.emoji}</span>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"text-sm font-medium text-foreground\">{preset.name}</p>\n                      <p className=\"text-xs text-muted-foreground truncate\">{preset.description}</p>\n                    </div>\n                  </button>\n                );\n              })}\n            </div>\n          ))}\n        </motion.div>\n      )}\n    </div>\n  );\n}\n\n// ============================================================================\n// Session Manager Component\n// ============================================================================\n\ninterface SessionManagerProps {\n  onSave: () => void;\n  onLoad: (session: CowriteSession) => void;\n  onExport: () => void;\n  currentSessionName: string;\n  onRename: (name: string) => void;\n}\n\nfunction SessionManager({ onSave, onLoad, onExport, currentSessionName, onRename }: SessionManagerProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [sessions, setSessions] = useState<CowriteSession[]>([]);\n  const [editingName, setEditingName] = useState(false);\n  const [nameInput, setNameInput] = useState(currentSessionName);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    setSessions(loadSessions());\n  }, [isOpen]);\n\n  useEffect(() => {\n    const handleClickOutside = (e: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(e.target as Node)) {\n        setIsOpen(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const handleSave = () => {\n    onSave();\n    setIsOpen(false);\n  };\n\n  const handleDelete = (id: string) => {\n    const updated = sessions.filter(s => s.id !== id);\n    saveSessions(updated);\n    setSessions(updated);\n  };\n\n  return (\n    <div className=\"relative\" ref={dropdownRef}>\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm bg-muted text-foreground hover:bg-muted/80 transition-colors\"\n      >\n        <Save className=\"w-4 h-4\" />\n        <span className=\"hidden sm:inline\">Sessions</span>\n      </button>\n\n      {isOpen && (\n        <motion.div\n          initial={{ opacity: 0, y: -10 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"absolute top-full right-0 mt-2 w-72 bg-card border border-border rounded-xl shadow-xl z-50\"\n        >\n          {/* Current session */}\n          <div className=\"p-3 border-b border-border\">\n            <p className=\"text-xs text-muted-foreground mb-1\">Current Session</p>\n            {editingName ? (\n              <input\n                type=\"text\"\n                value={nameInput}\n                onChange={(e) => setNameInput(e.target.value)}\n                onBlur={() => {\n                  onRename(nameInput);\n                  setEditingName(false);\n                }}\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter') {\n                    onRename(nameInput);\n                    setEditingName(false);\n                  }\n                }}\n                className=\"w-full px-2 py-1 text-sm bg-muted rounded border-none focus:outline-none focus:ring-1\"\n                style={{ '--tw-ring-color': 'hsl(var(--theme-primary))' } as React.CSSProperties}\n                autoFocus\n              />\n            ) : (\n              <p\n                className=\"text-sm font-medium cursor-pointer hover:text-muted-foreground\"\n                onClick={() => setEditingName(true)}\n              >\n                {currentSessionName || 'Untitled Session'}\n              </p>\n            )}\n          </div>\n\n          {/* Actions */}\n          <div className=\"p-2 border-b border-border flex gap-2\">\n            <button\n              onClick={handleSave}\n              className=\"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 text-xs font-medium rounded-lg bg-muted hover:bg-muted/80 transition-colors\"\n            >\n              <Save className=\"w-3.5 h-3.5\" />\n              Save\n            </button>\n            <button\n              onClick={() => { onExport(); setIsOpen(false); }}\n              className=\"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 text-xs font-medium rounded-lg bg-muted hover:bg-muted/80 transition-colors\"\n            >\n              <Download className=\"w-3.5 h-3.5\" />\n              Export\n            </button>\n          </div>\n\n          {/* Saved sessions */}\n          <div className=\"max-h-48 overflow-y-auto\">\n            {sessions.length === 0 ? (\n              <p className=\"p-3 text-xs text-muted-foreground text-center\">No saved sessions</p>\n            ) : (\n              sessions.map((session) => (\n                <div\n                  key={session.id}\n                  className=\"flex items-center justify-between px-3 py-2 hover:bg-muted/50 transition-colors\"\n                >\n                  <button\n                    onClick={() => { onLoad(session); setIsOpen(false); }}\n                    className=\"flex-1 text-left\"\n                  >\n                    <p className=\"text-sm font-medium truncate\">{session.name}</p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {new Date(session.updatedAt).toLocaleDateString()}\n                    </p>\n                  </button>\n                  <button\n                    onClick={() => handleDelete(session.id)}\n                    className=\"p-1.5 text-muted-foreground hover:text-red-500 transition-colors\"\n                  >\n                    <RotateCcw className=\"w-3.5 h-3.5\" />\n                  </button>\n                </div>\n              ))\n            )}\n          </div>\n        </motion.div>\n      )}\n    </div>\n  );\n}\n\n// ============================================================================\n// Keyboard Shortcuts Hook\n// ============================================================================\n\ninterface UseKeyboardShortcutsProps {\n  onUndo: () => void;\n  onRedo: () => void;\n  onSave: () => void;\n  onExport: () => void;\n  canUndo: boolean;\n  canRedo: boolean;\n}\n\nfunction useKeyboardShortcuts({ onUndo, onRedo, onSave, onExport, canUndo, canRedo }: UseKeyboardShortcutsProps) {\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;\n      const modifier = isMac ? e.metaKey : e.ctrlKey;\n\n      if (modifier && e.key === 'z' && !e.shiftKey && canUndo) {\n        e.preventDefault();\n        onUndo();\n      } else if (modifier && e.key === 'z' && e.shiftKey && canRedo) {\n        e.preventDefault();\n        onRedo();\n      } else if (modifier && e.key === 'y' && canRedo) {\n        e.preventDefault();\n        onRedo();\n      } else if (modifier && e.key === 's') {\n        e.preventDefault();\n        onSave();\n      } else if (modifier && e.key === 'e') {\n        e.preventDefault();\n        onExport();\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [onUndo, onRedo, onSave, onExport, canUndo, canRedo]);\n}\n\n// ============================================================================\n// Chat Panel\n// ============================================================================\n\ninterface ChatPanelProps {\n  messages: ChatMessage[];\n  onSendMessage: (message: string, isVoice?: boolean) => void;\n  onQuickAction: (action: QuickAction) => void;\n  isLoading: boolean;\n  isMinimized: boolean;\n  onToggleMinimize: () => void;\n}\n\nfunction ChatPanel({\n  messages,\n  onSendMessage,\n  onQuickAction,\n  isLoading,\n  isMinimized,\n  onToggleMinimize,\n}: ChatPanelProps) {\n  const [inputValue, setInputValue] = useState('');\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const scrollToBottom = useCallback(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, []);\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages, scrollToBottom]);\n\n  const handleSend = () => {\n    if (!inputValue.trim() || isLoading) return;\n    onSendMessage(inputValue.trim());\n    setInputValue('');\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  };\n\n  const handleVoiceTranscription = (text: string) => {\n    onSendMessage(text, true);\n  };\n\n  if (isMinimized) {\n    return (\n      <div className=\"flex items-center justify-between p-3 bg-card rounded-2xl border border-border\">\n        <div className=\"flex items-center gap-2\">\n          <div\n            className=\"w-8 h-8 rounded-full flex items-center justify-center\"\n            style={{ backgroundColor: 'hsl(var(--theme-primary))' }}\n          >\n            <Music4 className=\"w-4 h-4 text-white\" />\n          </div>\n          <span className=\"text-sm font-medium text-foreground\">8gent</span>\n          {messages.length > 1 && (\n            <span className=\"text-xs text-muted-foreground\">\n              {messages.length - 1} messages\n            </span>\n          )}\n        </div>\n        <button\n          onClick={onToggleMinimize}\n          className=\"p-2 rounded-lg text-muted-foreground hover:text-foreground hover:bg-muted transition-colors\"\n        >\n          <Maximize2 className=\"w-4 h-4\" />\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col h-full bg-card rounded-2xl border border-border overflow-hidden\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between px-4 py-3 border-b border-border bg-muted/30\">\n        <div className=\"flex items-center gap-2\">\n          <div\n            className=\"w-8 h-8 rounded-full flex items-center justify-center\"\n            style={{ backgroundColor: 'hsl(var(--theme-primary))' }}\n          >\n            <Music4 className=\"w-4 h-4 text-white\" />\n          </div>\n          <div>\n            <h2 className=\"text-foreground font-semibold text-sm\">8gent</h2>\n            <p className=\"text-muted-foreground text-xs\">Suno Architect</p>\n          </div>\n        </div>\n        <button\n          onClick={onToggleMinimize}\n          className=\"p-2 rounded-lg text-muted-foreground hover:text-foreground hover:bg-muted transition-colors\"\n        >\n          <Minimize2 className=\"w-4 h-4\" />\n        </button>\n      </div>\n\n      {/* Quick Actions */}\n      <div className=\"px-3 border-b border-border\">\n        <QuickActionsBar onAction={onQuickAction} isLoading={isLoading} />\n      </div>\n\n      {/* Messages */}\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\n        {messages.map((message) => (\n          <motion.div\n            key={message.id}\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}\n          >\n            <div\n              className={`max-w-[85%] rounded-2xl px-4 py-3 ${\n                message.role === 'user' ? '' : 'bg-muted text-foreground'\n              }`}\n              style={\n                message.role === 'user'\n                  ? {\n                      backgroundColor: 'hsl(var(--theme-primary) / 0.15)',\n                      color: 'hsl(var(--theme-primary))',\n                    }\n                  : undefined\n              }\n            >\n              {message.isVoice && message.role === 'user' && (\n                <div className=\"flex items-center gap-1.5 mb-1 text-xs opacity-70\">\n                  <Mic className=\"w-3 h-3\" />\n                  <span>Voice</span>\n                </div>\n              )}\n              {/* Reference block */}\n              {message.reference && (\n                <div\n                  className=\"mb-2 p-2 rounded-lg border-l-2 bg-muted/50\"\n                  style={{ borderColor: 'hsl(var(--theme-primary))' }}\n                >\n                  <div className=\"flex items-center gap-1.5 mb-1\">\n                    <span\n                      className=\"text-[10px] font-semibold uppercase tracking-wide px-1.5 py-0.5 rounded\"\n                      style={{\n                        backgroundColor: 'hsl(var(--theme-primary) / 0.15)',\n                        color: 'hsl(var(--theme-primary))',\n                      }}\n                    >\n                      {message.reference.source}\n                    </span>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground italic line-clamp-3\">\n                    \"{message.reference.text}\"\n                  </p>\n                </div>\n              )}\n              <p className=\"text-sm leading-relaxed whitespace-pre-wrap\">{message.content}</p>\n            </div>\n          </motion.div>\n        ))}\n\n        {isLoading && (\n          <motion.div\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"flex justify-start\"\n          >\n            <div className=\"bg-muted rounded-2xl px-4 py-3\">\n              <div className=\"flex gap-1\">\n                <span\n                  className=\"w-2 h-2 rounded-full animate-bounce\"\n                  style={{\n                    backgroundColor: 'hsl(var(--theme-primary) / 0.6)',\n                    animationDelay: '0ms',\n                  }}\n                />\n                <span\n                  className=\"w-2 h-2 rounded-full animate-bounce\"\n                  style={{\n                    backgroundColor: 'hsl(var(--theme-primary) / 0.6)',\n                    animationDelay: '150ms',\n                  }}\n                />\n                <span\n                  className=\"w-2 h-2 rounded-full animate-bounce\"\n                  style={{\n                    backgroundColor: 'hsl(var(--theme-primary) / 0.6)',\n                    animationDelay: '300ms',\n                  }}\n                />\n              </div>\n            </div>\n          </motion.div>\n        )}\n\n        <div ref={messagesEndRef} />\n      </div>\n\n      {/* Input */}\n      <div className=\"p-3 border-t border-border\">\n        <div className=\"flex items-center gap-2\">\n          <input\n            ref={inputRef}\n            type=\"text\"\n            value={inputValue}\n            onChange={(e) => setInputValue(e.target.value)}\n            onKeyDown={handleKeyPress}\n            placeholder=\"Describe your song vision...\"\n            className=\"flex-1 bg-muted rounded-full px-4 py-3 text-foreground text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2\"\n            style={{ '--tw-ring-color': 'hsl(var(--theme-primary) / 0.3)' } as React.CSSProperties}\n            disabled={isLoading}\n          />\n          <VoiceInputButton onTranscription={handleVoiceTranscription} disabled={isLoading} />\n          <motion.button\n            onClick={handleSend}\n            disabled={!inputValue.trim() || isLoading}\n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.95 }}\n            className={`p-3 rounded-full transition-colors ${\n              inputValue.trim() && !isLoading ? '' : 'bg-muted text-muted-foreground'\n            }`}\n            style={\n              inputValue.trim() && !isLoading\n                ? {\n                    background:\n                      'linear-gradient(135deg, hsl(var(--theme-primary)) 0%, hsl(var(--theme-accent)) 100%)',\n                    color: 'white',\n                  }\n                : undefined\n            }\n          >\n            <Send className=\"w-4 h-4\" />\n          </motion.button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// ============================================================================\n// Main Workspace Component\n// ============================================================================\n\nexport function CowriteApp() {\n  const {\n    activeStylePrompt,\n    activeLyricsPrompt,\n    updateStylePrompt,\n    updateLyricsPrompt,\n    createStylePrompt,\n    createLyricsPrompt,\n  } = useCowrite();\n\n  // Chat state\n  const [messages, setMessages] = useState<ChatMessage[]>([\n    {\n      id: '1',\n      role: 'assistant',\n      content:\n        \"Hey! I'm here to help you craft the perfect Suno prompts. Drop your concept, mood, or rough lyrics, and I'll help shape them into polished Style and Lyrics prompts. Both artifacts on the right update in real-time as we work.\",\n    },\n  ]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [styleLocked, setStyleLocked] = useState(false);\n  const [lyricsLocked, setLyricsLocked] = useState(false);\n  const [styleExpanded, setStyleExpanded] = useState(true);\n  const [lyricsExpanded, setLyricsExpanded] = useState(true);\n\n  // Mobile tab state\n  type MobileTab = 'lyrics' | 'style' | 'chat';\n  const [activeTab, setActiveTab] = useState<MobileTab>('chat');\n\n  // History for undo/redo\n  const [history, setHistory] = useState<HistoryState[]>([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n  const [isUndoRedo, setIsUndoRedo] = useState(false);\n\n  // Session management\n  const [sessionName, setSessionName] = useState('Untitled Session');\n  const [sessionId, setSessionId] = useState(() => Date.now().toString());\n\n  // Track content changes for history\n  const prevStyleRef = useRef<string>('');\n  const prevLyricsRef = useRef<string>('');\n\n  // Add to history when content changes (not from undo/redo)\n  useEffect(() => {\n    const currentStyle = activeStylePrompt?.content || '';\n    const currentLyrics = activeLyricsPrompt?.content || '';\n\n    if (isUndoRedo) {\n      setIsUndoRedo(false);\n      prevStyleRef.current = currentStyle;\n      prevLyricsRef.current = currentLyrics;\n      return;\n    }\n\n    if (currentStyle !== prevStyleRef.current || currentLyrics !== prevLyricsRef.current) {\n      // Only add to history if there's actual change\n      if (prevStyleRef.current !== '' || prevLyricsRef.current !== '') {\n        const newState: HistoryState = {\n          styleContent: currentStyle,\n          lyricsContent: currentLyrics,\n        };\n\n        // Remove any future history if we're not at the end\n        const newHistory = history.slice(0, historyIndex + 1);\n        newHistory.push(newState);\n\n        // Limit history size\n        if (newHistory.length > MAX_HISTORY_LENGTH) {\n          newHistory.shift();\n        }\n\n        setHistory(newHistory);\n        setHistoryIndex(newHistory.length - 1);\n      }\n\n      prevStyleRef.current = currentStyle;\n      prevLyricsRef.current = currentLyrics;\n    }\n  }, [activeStylePrompt?.content, activeLyricsPrompt?.content, history, historyIndex, isUndoRedo]);\n\n  // Undo handler\n  const handleUndo = useCallback(() => {\n    if (historyIndex > 0) {\n      const prevState = history[historyIndex - 1];\n      setIsUndoRedo(true);\n      if (activeStylePrompt) {\n        updateStylePrompt(activeStylePrompt.id, { content: prevState.styleContent });\n      }\n      if (activeLyricsPrompt) {\n        updateLyricsPrompt(activeLyricsPrompt.id, { content: prevState.lyricsContent });\n      }\n      setHistoryIndex(historyIndex - 1);\n    }\n  }, [history, historyIndex, activeStylePrompt, activeLyricsPrompt, updateStylePrompt, updateLyricsPrompt]);\n\n  // Redo handler\n  const handleRedo = useCallback(() => {\n    if (historyIndex < history.length - 1) {\n      const nextState = history[historyIndex + 1];\n      setIsUndoRedo(true);\n      if (activeStylePrompt) {\n        updateStylePrompt(activeStylePrompt.id, { content: nextState.styleContent });\n      }\n      if (activeLyricsPrompt) {\n        updateLyricsPrompt(activeLyricsPrompt.id, { content: nextState.lyricsContent });\n      }\n      setHistoryIndex(historyIndex + 1);\n    }\n  }, [history, historyIndex, activeStylePrompt, activeLyricsPrompt, updateStylePrompt, updateLyricsPrompt]);\n\n  // Save session\n  const handleSaveSession = useCallback(() => {\n    const session: CowriteSession = {\n      id: sessionId,\n      name: sessionName,\n      styleContent: activeStylePrompt?.content || '',\n      lyricsContent: activeLyricsPrompt?.content || '',\n      messages,\n      createdAt: new Date().toISOString(),\n      updatedAt: new Date().toISOString(),\n    };\n\n    const sessions = loadSessions();\n    const existingIndex = sessions.findIndex(s => s.id === sessionId);\n\n    if (existingIndex >= 0) {\n      sessions[existingIndex] = session;\n    } else {\n      sessions.unshift(session);\n    }\n\n    saveSessions(sessions);\n    saveCurrentSession(session);\n  }, [sessionId, sessionName, activeStylePrompt?.content, activeLyricsPrompt?.content, messages]);\n\n  // Load session\n  const handleLoadSession = useCallback((session: CowriteSession) => {\n    setSessionId(session.id);\n    setSessionName(session.name);\n    setMessages(session.messages);\n\n    if (activeStylePrompt) {\n      updateStylePrompt(activeStylePrompt.id, { content: session.styleContent });\n    }\n    if (activeLyricsPrompt) {\n      updateLyricsPrompt(activeLyricsPrompt.id, { content: session.lyricsContent });\n    }\n\n    // Reset history\n    setHistory([]);\n    setHistoryIndex(-1);\n  }, [activeStylePrompt, activeLyricsPrompt, updateStylePrompt, updateLyricsPrompt]);\n\n  // Export to file\n  const handleExport = useCallback(() => {\n    const content = formatExportContent(\n      activeStylePrompt?.content || '',\n      activeLyricsPrompt?.content || ''\n    );\n    exportToFile(content, sessionName.replace(/\\s+/g, '_'), 'md');\n  }, [activeStylePrompt?.content, activeLyricsPrompt?.content, sessionName]);\n\n  // Keyboard shortcuts\n  useKeyboardShortcuts({\n    onUndo: handleUndo,\n    onRedo: handleRedo,\n    onSave: handleSaveSession,\n    onExport: handleExport,\n    canUndo: historyIndex > 0,\n    canRedo: historyIndex < history.length - 1,\n  });\n\n  // Load current session on mount\n  useEffect(() => {\n    const saved = loadCurrentSession();\n    if (saved) {\n      setSessionId(saved.id);\n      setSessionName(saved.name);\n      // Don't auto-restore content - let user choose\n    }\n  }, []);\n\n  // Ensure we have active prompts\n  useEffect(() => {\n    if (!activeStylePrompt) {\n      createStylePrompt();\n    }\n    if (!activeLyricsPrompt) {\n      createLyricsPrompt();\n    }\n  }, [activeStylePrompt, activeLyricsPrompt, createStylePrompt, createLyricsPrompt]);\n\n  // Parse AI response for style and lyrics updates\n  const parseAndApplyUpdates = useCallback(\n    (response: string) => {\n      // Extract style prompt from code blocks\n      const stylePatterns = [\n        /```style\\n?([\\s\\S]*?)```/i,\n        /```(?:style prompt)?\\n?(\\[Is_Max_Mode[\\s\\S]*?)```/i,\n        /STYLE PROMPT:?\\s*```\\n?([\\s\\S]*?)```/i,\n      ];\n\n      // Extract lyrics prompt from code blocks\n      const lyricsPatterns = [\n        /```lyrics\\n?([\\s\\S]*?)```/i,\n        /```(?:lyrics prompt)?\\n?(\\/\\|\\[\\/\\*{3}\\/\\/\\/[\\s\\S]*?)```/i,\n        /```(?:lyrics prompt)?\\n?(\\[(?:INTRO|VERSE|HOOK|CHORUS)[\\s\\S]*?)```/i,\n        /LYRICS PROMPT:?\\s*```\\n?([\\s\\S]*?)```/i,\n      ];\n\n      let styleUpdated = false;\n      let lyricsUpdated = false;\n\n      // Try to extract and apply style\n      if (!styleLocked && activeStylePrompt) {\n        for (const pattern of stylePatterns) {\n          const match = response.match(pattern);\n          if (match && match[1]) {\n            const newContent = match[1].trim();\n            if (newContent.includes('[Is_Max_Mode') || newContent.includes('GENRE')) {\n              updateStylePrompt(activeStylePrompt.id, { content: newContent });\n              styleUpdated = true;\n              break;\n            }\n          }\n        }\n      }\n\n      // Try to extract and apply lyrics\n      if (!lyricsLocked && activeLyricsPrompt) {\n        for (const pattern of lyricsPatterns) {\n          const match = response.match(pattern);\n          if (match && match[1]) {\n            const newContent = match[1].trim();\n            if (\n              newContent.includes('[VERSE') ||\n              newContent.includes('[HOOK') ||\n              newContent.includes('[INTRO') ||\n              newContent.includes('/|/')\n            ) {\n              updateLyricsPrompt(activeLyricsPrompt.id, { content: newContent });\n              lyricsUpdated = true;\n              break;\n            }\n          }\n        }\n      }\n\n      return { styleUpdated, lyricsUpdated };\n    },\n    [\n      activeStylePrompt,\n      activeLyricsPrompt,\n      updateStylePrompt,\n      updateLyricsPrompt,\n      styleLocked,\n      lyricsLocked,\n    ]\n  );\n\n  // Send message to AI\n  const handleSendMessage = async (content: string, isVoice = false) => {\n    const userMessage: ChatMessage = {\n      id: Date.now().toString(),\n      role: 'user',\n      content,\n      isVoice,\n    };\n\n    setMessages((prev) => [...prev, userMessage]);\n    setIsLoading(true);\n\n    try {\n      // Build context with current prompts\n      const context = `\nCURRENT STYLE PROMPT${styleLocked ? ' (LOCKED - DO NOT MODIFY)' : ''}:\n\\`\\`\\`\n${activeStylePrompt?.content || 'No style prompt yet'}\n\\`\\`\\`\n\nCURRENT LYRICS PROMPT${lyricsLocked ? ' (LOCKED - DO NOT MODIFY)' : ''}:\n\\`\\`\\`\n${activeLyricsPrompt?.content || 'No lyrics yet'}\n\\`\\`\\`\n\nIMPORTANT: Always output the complete, updated prompts in code blocks. Use \\`\\`\\`style and \\`\\`\\`lyrics labels. The user sees both artifacts update in real-time.\n`;\n\n      const systemPrompt = `${CLAW_AI_COWRITE_SYSTEM_PROMPT}\n\n${context}\n\nREFINEMENT INSTRUCTIONS:\n- When the user provides rough material, normalize it immediately into proper format\n- Style prompts must start with MAX MODE headers\n- Lyrics prompts should have proper section tags in []\n- Output BOTH complete prompts after every edit, even small changes\n- Never output partial prompts - always the full artifact\n- Label code blocks clearly: \\`\\`\\`style and \\`\\`\\`lyrics\n- Respect locked prompts - do not modify them`;\n\n      const response = await fetch('/api/chat', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          messages: [\n            { role: 'system', content: systemPrompt },\n            ...messages.slice(-10).map((m) => ({ role: m.role, content: m.content })),\n            { role: 'user', content },\n          ],\n          model: 'cowrite',\n        }),\n      });\n\n      let assistantContent: string;\n\n      if (response.ok) {\n        const data = await response.json();\n        assistantContent = data.message || \"I couldn't process that. Could you try again?\";\n\n        // Parse and apply updates to artifacts\n        parseAndApplyUpdates(assistantContent);\n      } else {\n        assistantContent = \"I'm having trouble connecting. Please try again.\";\n      }\n\n      const assistantMessage: ChatMessage = {\n        id: (Date.now() + 1).toString(),\n        role: 'assistant',\n        content: assistantContent,\n      };\n      setMessages((prev) => [...prev, assistantMessage]);\n    } catch (error) {\n      console.error('Chat error:', error);\n      const assistantMessage: ChatMessage = {\n        id: (Date.now() + 1).toString(),\n        role: 'assistant',\n        content: \"Something went wrong. Let's try that again.\",\n      };\n      setMessages((prev) => [...prev, assistantMessage]);\n    }\n\n    setIsLoading(false);\n  };\n\n  // Handle quick action\n  const handleQuickAction = (action: QuickAction) => {\n    handleSendMessage(action.prompt);\n  };\n\n  // Handle artifact changes\n  const handleStyleChange = (content: string) => {\n    if (activeStylePrompt) {\n      updateStylePrompt(activeStylePrompt.id, { content });\n    }\n  };\n\n  const handleLyricsChange = (content: string) => {\n    if (activeLyricsPrompt) {\n      updateLyricsPrompt(activeLyricsPrompt.id, { content });\n    }\n  };\n\n  // Handle preset selection - applies MAX MODE automatically\n  const handlePresetSelect = (preset: StylePreset) => {\n    if (activeStylePrompt) {\n      const contentWithMaxMode = applyMaxMode(preset.content);\n      updateStylePrompt(activeStylePrompt.id, { content: contentWithMaxMode });\n    }\n  };\n\n  // Handle adding selected text to chat as a reference\n  const handleAddToChat = (text: string, source: 'style' | 'lyrics') => {\n    const referenceMessage: ChatMessage = {\n      id: Date.now().toString(),\n      role: 'user',\n      content: `Edit this section:`,\n      reference: { text, source },\n    };\n    setMessages((prev) => [...prev, referenceMessage]);\n    // Switch to chat tab on mobile\n    setActiveTab('chat');\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background text-foreground\">\n      <div className=\"flex flex-col h-screen\">\n        {/* Header */}\n        <header className=\"flex items-center justify-between px-4 py-3 border-b border-border bg-background/80 backdrop-blur-xl sticky top-0 z-40\">\n          <div className=\"flex items-center gap-3\">\n            <div\n              className=\"w-10 h-10 rounded-2xl flex items-center justify-center shadow-lg\"\n              style={{\n                background:\n                  'linear-gradient(135deg, hsl(var(--theme-primary)) 0%, hsl(var(--theme-accent)) 100%)',\n                boxShadow: '0 4px 14px hsl(var(--theme-primary) / 0.3)',\n              }}\n            >\n              <Music4 className=\"w-5 h-5 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"text-lg font-bold text-foreground\">CoWrite</h1>\n              <p className=\"text-xs text-muted-foreground\">Suno Prompt Studio</p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-1 sm:gap-2\">\n            {/* Undo/Redo */}\n            <div className=\"hidden sm:flex items-center gap-1 mr-2\">\n              <button\n                onClick={handleUndo}\n                disabled={historyIndex <= 0}\n                className=\"p-1.5 rounded-lg text-muted-foreground hover:text-foreground hover:bg-muted transition-colors disabled:opacity-30 disabled:cursor-not-allowed\"\n                title=\"Undo (Cmd+Z)\"\n              >\n                <Undo2 className=\"w-4 h-4\" />\n              </button>\n              <button\n                onClick={handleRedo}\n                disabled={historyIndex >= history.length - 1}\n                className=\"p-1.5 rounded-lg text-muted-foreground hover:text-foreground hover:bg-muted transition-colors disabled:opacity-30 disabled:cursor-not-allowed\"\n                title=\"Redo (Cmd+Shift+Z)\"\n              >\n                <Redo2 className=\"w-4 h-4\" />\n              </button>\n            </div>\n\n            {/* Session Manager */}\n            <SessionManager\n              onSave={handleSaveSession}\n              onLoad={handleLoadSession}\n              onExport={handleExport}\n              currentSessionName={sessionName}\n              onRename={setSessionName}\n            />\n\n            {/* Reset */}\n            <button\n              onClick={() => {\n                setMessages([\n                  {\n                    id: '1',\n                    role: 'assistant',\n                    content: \"Fresh start! What song would you like to create?\",\n                  },\n                ]);\n                setSessionId(Date.now().toString());\n                setSessionName('Untitled Session');\n                setHistory([]);\n                setHistoryIndex(-1);\n              }}\n              className=\"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm bg-muted text-foreground hover:bg-muted/80 transition-colors\"\n            >\n              <RotateCcw className=\"w-4 h-4\" />\n              <span className=\"hidden sm:inline\">Reset</span>\n            </button>\n          </div>\n        </header>\n\n        {/* Mobile Tab Navigation */}\n        <div className=\"lg:hidden flex border-b border-border bg-card\">\n          {[\n            { id: 'lyrics' as MobileTab, label: 'Lyrics', icon: FileText },\n            { id: 'style' as MobileTab, label: 'Style', icon: Music4 },\n            { id: 'chat' as MobileTab, label: 'Chat', icon: MessageSquare },\n          ].map((tab) => (\n            <button\n              key={tab.id}\n              onClick={() => setActiveTab(tab.id)}\n              className={`flex-1 flex items-center justify-center gap-2 py-3 text-sm font-medium transition-colors ${\n                activeTab === tab.id\n                  ? 'text-foreground border-b-2'\n                  : 'text-muted-foreground'\n              }`}\n              style={\n                activeTab === tab.id\n                  ? { borderColor: 'hsl(var(--theme-primary))' }\n                  : undefined\n              }\n            >\n              <tab.icon className=\"w-4 h-4\" />\n              {tab.label}\n            </button>\n          ))}\n        </div>\n\n        {/* Main Content */}\n        <main className=\"flex-1 overflow-hidden p-4\">\n          {/* Mobile View - Single panel based on active tab */}\n          <div className=\"lg:hidden h-full\">\n            {activeTab === 'lyrics' && (\n              <div className=\"h-full\">\n                <ArtifactPanel\n                  type=\"lyrics\"\n                  title=\"LYRICS\"\n                  icon={Mic2}\n                  content={activeLyricsPrompt?.content || ''}\n                  onChange={handleLyricsChange}\n                  isLocked={lyricsLocked}\n                  onToggleLock={() => setLyricsLocked(!lyricsLocked)}\n                  charLimit={5000}\n                  isExpanded={true}\n                  onToggleExpand={() => {}}\n                  onAddToChat={handleAddToChat}\n                />\n              </div>\n            )}\n            {activeTab === 'style' && (\n              <div className=\"h-full\">\n                <ArtifactPanel\n                  type=\"style\"\n                  title=\"STYLE\"\n                  icon={Music4}\n                  content={activeStylePrompt?.content || ''}\n                  onChange={handleStyleChange}\n                  isLocked={styleLocked}\n                  onToggleLock={() => setStyleLocked(!styleLocked)}\n                  charLimit={1000}\n                  headerExtra={<PresetSelector onSelectPreset={handlePresetSelect} />}\n                  isExpanded={true}\n                  onToggleExpand={() => {}}\n                  onAddToChat={handleAddToChat}\n                />\n              </div>\n            )}\n            {activeTab === 'chat' && (\n              <div className=\"h-full\">\n                <ChatPanel\n                  messages={messages}\n                  onSendMessage={handleSendMessage}\n                  onQuickAction={handleQuickAction}\n                  isLoading={isLoading}\n                  isMinimized={false}\n                  onToggleMinimize={() => {}}\n                />\n              </div>\n            )}\n          </div>\n\n          {/* Desktop View - Grid layout: Lyrics 50% | Style 25% + Chat 25% */}\n          <div className=\"hidden lg:grid h-full grid-cols-4 gap-4\">\n            {/* Left Panel - Lyrics (50%) */}\n            <div className=\"col-span-2 flex flex-col min-h-0\">\n              <ArtifactPanel\n                type=\"lyrics\"\n                title=\"LYRICS\"\n                icon={Mic2}\n                content={activeLyricsPrompt?.content || ''}\n                onChange={handleLyricsChange}\n                isLocked={lyricsLocked}\n                onToggleLock={() => setLyricsLocked(!lyricsLocked)}\n                charLimit={5000}\n                isExpanded={lyricsExpanded}\n                onToggleExpand={() => setLyricsExpanded(!lyricsExpanded)}\n                onAddToChat={handleAddToChat}\n              />\n            </div>\n\n            {/* Right Panel - Style + Chat (25% each stacked) */}\n            <div className=\"col-span-2 flex flex-col gap-4 min-h-0\">\n              {/* Style (top right) */}\n              <div className={styleExpanded ? 'flex-1 min-h-0' : ''}>\n                <ArtifactPanel\n                  type=\"style\"\n                  title=\"STYLE\"\n                  icon={Music4}\n                  content={activeStylePrompt?.content || ''}\n                  onChange={handleStyleChange}\n                  isLocked={styleLocked}\n                  onToggleLock={() => setStyleLocked(!styleLocked)}\n                  charLimit={1000}\n                  headerExtra={<PresetSelector onSelectPreset={handlePresetSelect} />}\n                  onAddToChat={handleAddToChat}\n                  isExpanded={styleExpanded}\n                  onToggleExpand={() => setStyleExpanded(!styleExpanded)}\n                />\n              </div>\n\n              {/* Chat (bottom right) */}\n              <div className=\"flex-1 min-h-0\">\n                <ChatPanel\n                  messages={messages}\n                  onSendMessage={handleSendMessage}\n                  onQuickAction={handleQuickAction}\n                  isLoading={isLoading}\n                  isMinimized={false}\n                  onToggleMinimize={() => {}}\n                />\n              </div>\n            </div>\n          </div>\n        </main>\n      </div>\n    </div>\n  );\n}\n\nexport default CowriteApp;\n","/**\n * 8gent Cowrite - Suno Songwriting Assistant\n *\n * A specialized mode for 8gent focused on crafting\n * lyrics and style prompts for Suno AI music generation.\n */\n\nexport const CLAW_AI_COWRITE_SYSTEM_PROMPT = `You are an AI-native songwriting and arrangement assistant designed specifically for Suno.\n\nYour role is to help users craft:\n1) A STYLE PROMPT\n2) A LYRICS PROMPT\n\nThese MUST ALWAYS be delivered in TWO SEPARATE CODE BLOCKS for easy copy/paste into Suno.\n\nGLOBAL RULES\n- Always begin STYLE PROMPTS with:\n  [Is_Max_Mode:Max]\n  [Quality:Maxi]\n  [Realism:Max]\n  [Real_Instruments:Max]\n  [Persona:Max]\n\n- Use square-bracket TAGS [] for all song sections.\n- Never mix style instructions into the lyrics block.\n- Never mix lyrics into the style block.\n- Respect Suno character limits (approximately 1000 chars for style, approximately 5000 for lyrics).\n- No emojis. No markdown inside code blocks.\n- No repeated ad-lib or scat sounds unless explicitly requested.\n- Silence, space, and pacing are valid musical tools.\n\nSTYLE PROMPT RULES\nThe STYLE PROMPT must:\n- Describe genre, groove, tempo, mood, instrumentation, and vocal characteristics.\n- Clearly define cadence, phrasing, and rhythmic behavior.\n- Specify lead vs backing vocals if relevant.\n- Be concise, directive, and performance-focused.\n- Never include lyrics, song titles, or section text.\n\nExample structure (do not copy verbatim):\nSTYLE:\nGENRE / FUSION\nVOCALS\nCADENCE\nINSTRUMENTATION\nMOOD / RULES\n\nLYRICS PROMPT RULES\nThe LYRICS PROMPT must:\n- Begin with /|/***/// if the user requests it.\n- Use clear section tags such as:\n  [INTRO - SPOKEN]\n  [VERSE]\n  [PRE-HOOK]\n  [HOOK]\n  [BRIDGE]\n  [BREAK]\n  [OUTRO]\n\n- Lyrics should be written for performance, not poetry.\n- Line length, pauses, and spacing should reflect cadence.\n- Hooks should be intentional and not over-repeated.\n- Ad-libs (e.g. scats, breaths, sounds) must be:\n  - Unique\n  - Musically placed\n  - Wrapped in parentheses\n\nCLAW AI GUIDANCE MODE\nWhen assisting the user, you should:\n- Ask clarifying questions only when necessary.\n- Suggest structural improvements before rewriting lyrics.\n- Offer alternate hooks, bridges, or arrangements as optional upgrades.\n- Preserve the user's voice, tone, and intent.\n- Default to minimalism unless told otherwise.\n\nYou are not here to overwrite the artist.\nYou are here to help them finish what they already hear.\n\nOUTPUT FORMAT (MANDATORY)\nAlways respond in this order:\n\n1) STYLE PROMPT - wrapped in \\`\\`\\`style code block\n2) LYRICS PROMPT - wrapped in \\`\\`\\`lyrics code block\n\nCRITICAL CODE BLOCK RULES:\n- Always use \\`\\`\\`style to open style prompt blocks\n- Always use \\`\\`\\`lyrics to open lyrics prompt blocks\n- Output the COMPLETE prompt every time, never partial updates\n- Both artifacts are displayed side-by-side and update in real-time\n- The user can lock either prompt to prevent AI changes\n- If a prompt is marked as LOCKED, do not modify it\n\nSTYLE PROMPT must always start with:\n\\`\\`\\`style\n[Is_Max_Mode:Max]\n[Quality:Maxi]\n[Realism:Max]\n[Real_Instruments:Max]\n[Persona:Max]\n...rest of style...\n\\`\\`\\`\n\nLYRICS PROMPT should follow this structure:\n\\`\\`\\`lyrics\n/|/***///\n\n[INTRO]\n...\n\n[VERSE 1]\n...\n\\`\\`\\`\n\nNever combine them.\nKeep explanatory text brief. The artifacts speak for themselves.\n\nYou are a Suno Architect.\nBuild with intention.`;\n\n// Context for different moods/genres\nexport const COWRITE_MOOD_CONTEXTS: Record<string, string> = {\n  upbeat: `\nFocus on:\n- High energy, driving rhythms\n- Major keys, bright tones\n- Energetic vocal delivery\n- Danceable grooves\n- Celebratory or empowering themes`,\n\n  melancholic: `\nFocus on:\n- Slower tempos, space between notes\n- Minor keys, atmospheric textures\n- Vulnerable, intimate vocals\n- Sparse instrumentation building to emotional peaks\n- Themes of loss, longing, or reflection`,\n\n  aggressive: `\nFocus on:\n- Heavy, distorted instrumentation\n- Powerful, raw vocal delivery\n- Driving, relentless rhythms\n- Intense dynamics and builds\n- Themes of defiance, strength, or catharsis`,\n\n  dreamy: `\nFocus on:\n- Ethereal, layered textures\n- Floating, reverb-heavy vocals\n- Ambient pads and subtle percussion\n- Non-linear song structures\n- Themes of wonder, escape, or transcendence`,\n\n  romantic: `\nFocus on:\n- Warm, intimate production\n- Smooth, soulful vocals\n- Gentle rhythms that breathe\n- Lush harmonies and strings\n- Themes of love, connection, or desire`,\n\n  nostalgic: `\nFocus on:\n- Retro production techniques\n- Analog-inspired sounds\n- Warm, slightly saturated tones\n- Classic song structures\n- Themes of memory, past, or simpler times`,\n};\n\n// Genre-specific style templates\nexport const COWRITE_GENRE_TEMPLATES: Record<string, string> = {\n  pop: `[Is_Max_Mode:Max]\n[Quality:Maxi]\n[Realism:Max]\n[Real_Instruments:Max]\n[Persona:Max]\n\nGENRE: Contemporary Pop\nTEMPO: 110-130 BPM\nVOCALS: Clear, polished lead with layered harmonies\nCADENCE: Verse-prechorus-chorus structure, catchy hooks\nINSTRUMENTATION: Synth pads, programmed drums, bass, subtle guitar accents\nMOOD: Radio-friendly, emotionally accessible`,\n\n  hiphop: `[Is_Max_Mode:Max]\n[Quality:Maxi]\n[Realism:Max]\n[Real_Instruments:Max]\n[Persona:Max]\n\nGENRE: Hip-Hop / Trap\nTEMPO: 70-90 BPM (half-time feel)\nVOCALS: Confident delivery, rhythmic flow, ad-libs\nCADENCE: 16-bar verses, 8-bar hooks, emphasis on pocket\nINSTRUMENTATION: 808s, hi-hats, dark synths, atmospheric samples\nMOOD: Hard-hitting, street-ready`,\n\n  rnb: `[Is_Max_Mode:Max]\n[Quality:Maxi]\n[Realism:Max]\n[Real_Instruments:Max]\n[Persona:Max]\n\nGENRE: Contemporary R&B\nTEMPO: 70-95 BPM\nVOCALS: Soulful, melismatic, intimate falsetto moments\nCADENCE: Smooth, flowing verses with emotional builds\nINSTRUMENTATION: Live bass, soft keys, organic drums, subtle strings\nMOOD: Sensual, sophisticated, late-night`,\n\n  rock: `[Is_Max_Mode:Max]\n[Quality:Maxi]\n[Realism:Max]\n[Real_Instruments:Max]\n[Persona:Max]\n\nGENRE: Alternative Rock\nTEMPO: 120-140 BPM\nVOCALS: Raw, passionate, dynamic range from soft to powerful\nCADENCE: Building verses, explosive choruses, breakdowns\nINSTRUMENTATION: Electric guitars, live drums, bass, keys for texture\nMOOD: Anthemic, cathartic, driving`,\n\n  electronic: `[Is_Max_Mode:Max]\n[Quality:Maxi]\n[Realism:Max]\n[Real_Instruments:Max]\n[Persona:Max]\n\nGENRE: Electronic / Synthwave\nTEMPO: 100-128 BPM\nVOCALS: Processed, ethereal, sometimes vocoded\nCADENCE: Build-drop structure, evolving sections\nINSTRUMENTATION: Analog synths, arpeggios, sidechained bass, crisp drums\nMOOD: Futuristic, immersive, hypnotic`,\n\n  acoustic: `[Is_Max_Mode:Max]\n[Quality:Maxi]\n[Realism:Max]\n[Real_Instruments:Max]\n[Persona:Max]\n\nGENRE: Acoustic / Folk\nTEMPO: 80-110 BPM\nVOCALS: Natural, honest, storytelling delivery\nCADENCE: Intimate verses, singalong choruses\nINSTRUMENTATION: Acoustic guitar, light percussion, strings, harmonies\nMOOD: Warm, authentic, heartfelt`,\n\n  cinematic: `[Is_Max_Mode:Max]\n[Quality:Maxi]\n[Realism:Max]\n[Real_Instruments:Max]\n[Persona:Max]\n\nGENRE: Cinematic Pop / Epic\nTEMPO: 90-120 BPM\nVOCALS: Powerful, soaring, emotionally charged\nCADENCE: Slow build through verses, massive crescendos\nINSTRUMENTATION: Full orchestra, epic drums, choir elements, synths\nMOOD: Triumphant, emotional, larger-than-life`,\n};\n\n// Lyrics section templates\nexport const COWRITE_SECTION_TEMPLATES: Record<string, string> = {\n  intro: `[INTRO]\n(instrumental build or spoken word)`,\n\n  verse: `[VERSE]\nFour lines of narrative\nSetting the scene or story\nBuilding toward the hook\nEach line around 6-10 syllables`,\n\n  prehook: `[PRE-HOOK]\nTwo to four lines\nBuilding tension and anticipation\nLeading directly into the hook`,\n\n  hook: `[HOOK]\nThe memorable centerpiece\nRepeat key phrase or concept\nMake it sing-along ready\nThis is what sticks`,\n\n  bridge: `[BRIDGE]\nA shift in perspective\nNew melodic territory\nThe emotional peak or twist\nBefore the final hook`,\n\n  outro: `[OUTRO]\n(fade with key motif)\n(or final statement)`,\n};\n","// ============================================================================\n// CoWrite Style Presets Library v2\n// 12 Suno-ready presets - MAX MODE auto-applied\n// ============================================================================\n\nexport interface StylePreset {\n  id: string;\n  name: string;\n  emoji: string;\n  description: string;\n  content: string;\n}\n\n// ============================================================================\n// MAX MODE HEADER - Auto-applied to all style prompts\n// ============================================================================\n\nexport const MAX_MODE_HEADER = `[Is_Max_Mode:Max]\n[Quality:Maxi]\n[Realism:Max]\n[Real_Instruments:Max]\n[Persona:Max]`;\n\n// Helper to apply MAX MODE to any style content\nexport function applyMaxMode(content: string): string {\n  if (content.includes('[Is_Max_Mode:Max]')) {\n    return content;\n  }\n  return `${MAX_MODE_HEADER}\\n\\n${content}`;\n}\n\n// ============================================================================\n// STYLE PRESETS (12 Suno-ready presets)\n// ============================================================================\n\nexport const STYLE_PRESETS: StylePreset[] = [\n  {\n    id: 'wild-cadence-neo-soul',\n    name: 'Wild Cadence / Neo-Soul Hybrid',\n    emoji: '⚡',\n    description: 'Percussive sing-talk with elastic, jittery rhythm',\n    content: `Male Irish lead. Close-mic. Percussive sing-talk with elastic, jittery rhythm. Voice as drum. Crisp consonants, clipped endings, minimal vibrato. Off-kilter push-pull timing, micro-pauses, sudden stops. Neo-soul with Brazilian rhythmic undercurrent. Minimal groove, space-forward. Calm surface, simmering bite. Slight swagger. No belting.`,\n  },\n  {\n    id: 'brazilian-retro-soul',\n    name: 'Brazilian Retro-Soul',\n    emoji: '🌃',\n    description: 'Late night Rio, smoky baritone, intimate storytelling',\n    content: `Male deep baritone. Smoky, warm, gravelly. Conversational phrasing. Afro-Brazilian groove with semba swing, thumb bass, rim clicks, pandeiro. Rhodes, muted trumpet, bari sax stabs. Small-room warmth. Loose but intentional. Intimate storytelling.`,\n  },\n  {\n    id: 'irish-neo-soul',\n    name: 'Irish Neo-Soul Storyteller',\n    emoji: '🍀',\n    description: 'Reflective, grounded, talking truth quietly',\n    content: `Male Irish lead, reflective and grounded. Clear diction, emotional restraint. Neo-soul with subtle folk undertones. Guitar-led, warm bass, brushed drums. Melodic but understated. Feels like talking truth quietly rather than performing.`,\n  },\n  {\n    id: 'abstract-spoken-melody',\n    name: 'Abstract Spoken-Melody',\n    emoji: '🌀',\n    description: 'Future monologue, philosophical, no hooks',\n    content: `Male lead. Rhythmic speak-sing, half-spoken melody. Sparse production, negative space. Tempo slow-mid. Voice front and center. Philosophical, observational tone. No hooks, evolving flow. Minimal harmony, maximum intention.`,\n  },\n  {\n    id: 'scatter-swagger',\n    name: 'Scatter Swagger',\n    emoji: '🎤',\n    description: 'Playful syncopated flow, humor baked in',\n    content: `Male lead with playful confidence. Syncopated rap-adjacent flow, unpredictable phrasing, humor baked in. Quick pivots, internal rhymes, conversational asides. Funk-leaning beat. Light bravado without aggression.`,\n  },\n  {\n    id: 'minimal-funk',\n    name: 'Minimal Funk / Pocket Discipline',\n    emoji: '🎸',\n    description: 'Tight pocket, groove does the talking',\n    content: `Male baritone. Tight pocket, behind-the-beat delivery. Funk bass, clean guitar, minimal drums. Short phrases, restraint over flash. Groove does the talking. Repetition used as power.`,\n  },\n  {\n    id: 'afro-soul-introspection',\n    name: 'Afro-Soul Introspection',\n    emoji: '🌍',\n    description: 'Warm, introspective, mantra-like hooks',\n    content: `Male lead, warm and introspective. Afro-influenced rhythms, rolling percussion, gentle syncopation. Emotional clarity without melodrama. Hooks are subtle, mantra-like. Organic and grounded.`,\n  },\n  {\n    id: 'cinematic-inner-dialogue',\n    name: 'Cinematic Inner Dialogue',\n    emoji: '🎬',\n    description: 'Slow build, internal narration, emotional payoff',\n    content: `Male lead, intimate and restrained. Slow build, cinematic chords, low drums. Lyrics feel like internal narration. Sparse verses, swelling sections, emotional payoff without climax shouting.`,\n  },\n  {\n    id: 'lofi-soul-confessional',\n    name: 'Lo-Fi Soul Confessional',\n    emoji: '💔',\n    description: 'Close and imperfect, vulnerability as texture',\n    content: `Male lead, close and imperfect. Slight grit, breath audible. Lo-fi textures, soft keys, vinyl warmth. Conversational melodies. Vulnerability as texture, not drama.`,\n  },\n  {\n    id: 'modern-poet',\n    name: 'Modern Poet / Beat-First',\n    emoji: '📝',\n    description: 'Voice as rhythm instrument, intelligent feel',\n    content: `Male lead. Voice treated as rhythm instrument first, melody second. Short lines, clipped phrases. Experimental groove. Silence used deliberately. Intelligent, contemporary feel.`,\n  },\n  {\n    id: 'warm-affirmation',\n    name: 'Warm Affirmation Groove',\n    emoji: '☀️',\n    description: 'Reassuring, comforting, understated optimism',\n    content: `Male lead, reassuring tone. Mid-tempo soul groove. Simple, repetitive lyrical structure. Comforting energy, understated optimism. Feels like someone steadying you rather than hyping you.`,\n  },\n  {\n    id: 'tech-poetry-os',\n    name: 'Experimental OS / Tech-Poetry',\n    emoji: '💻',\n    description: 'Abstract futuristic, glitch-adjacent but musical',\n    content: `Male lead. Abstract, futuristic lyrical themes. Rhythmic spoken melody. Glitch-adjacent but musical. Clean low-end, minimal synths, mechanical pulse softened by soul phrasing.`,\n  },\n];\n\n// Helper to get preset by ID\nexport function getPresetById(id: string): StylePreset | undefined {\n  return STYLE_PRESETS.find((p) => p.id === id);\n}\n\n// Default preset (blank canvas)\nexport const BLANK_STYLE_PRESET: StylePreset = {\n  id: 'blank',\n  name: 'Blank Canvas',\n  emoji: '📝',\n  description: 'Start from scratch',\n  content: `Male lead. [Describe voice qualities]\n\n[Describe groove/instrumentation]\n\n[Describe mood/feel]`,\n};\n\n// Get preset with MAX MODE applied\nexport function getPresetWithMaxMode(preset: StylePreset): string {\n  return applyMaxMode(preset.content);\n}\n"],"names":[],"mappings":"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"}