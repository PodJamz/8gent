module.exports=[658304,a=>{"use strict";let b,c,d;var e=a.i(499969),f=a.i(863050),g=a.i(925440),h=a.i(233849),i=a.i(374570),j=a.i(567031),k=a.i(278739),l=a.i(730676),m=a.i(341010),n=a.i(352219),o=a.i(456819),p=a.i(904291),q=a.i(167890),q=q,r=a.i(25770);let s="[ClubSpaces]",t=(a,b)=>console.log(`${s} ${a}`,b??"");var u=a.i(422720),v=a.i(894935),w=a.i(128002),x=a.i(311970),y=a.i(284069),z=a.i(662482),A=a.i(368114);function B({onCreateRoom:a,onJoinRoom:b,user:c,isConnecting:d}){let[g,h]=(0,f.useState)(""),[i,l]=(0,f.useState)(""),[o,p]=(0,f.useState)(""),[q,r]=(0,f.useState)("create"),[s,t]=(0,f.useState)("");return(0,e.jsxs)("div",{className:"min-h-dvh flex flex-col bg-black",children:[(0,e.jsxs)("header",{className:"flex items-center justify-between px-6 py-4 border-b border-white/[0.06]",children:[(0,e.jsxs)("div",{className:"flex items-center gap-3",children:[(0,e.jsx)("div",{className:"w-9 h-9 rounded-xl bg-amber-500 flex items-center justify-center",children:(0,e.jsx)(n.Radio,{className:"w-5 h-5 text-black"})}),(0,e.jsx)("span",{className:"text-lg font-semibold text-white tracking-tight",children:"ClubSpaces"})]}),c&&(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsx)("div",{className:"w-8 h-8 rounded-full bg-white/10 flex items-center justify-center text-sm font-medium text-white",children:(c.firstName||c.fullName||"U").charAt(0).toUpperCase()})})]}),(0,e.jsx)("div",{className:"flex-1 flex items-center justify-center px-4 py-8",children:(0,e.jsxs)("div",{className:"w-full max-w-sm",children:[(0,e.jsxs)(j.motion.div,{className:"text-center mb-8",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.25,.46,.45,.94]},children:[(0,e.jsx)("h1",{className:"text-3xl font-bold text-white tracking-tight mb-2",children:"Drop in audio"}),(0,e.jsx)("p",{className:"text-white/50 text-sm leading-relaxed",children:"Real-time voice rooms. Create a space or join one."})]}),(0,e.jsxs)(j.motion.div,{className:"flex gap-1 mb-6 p-1 bg-white/[0.04] rounded-xl border border-white/[0.06]",initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},children:[(0,e.jsxs)("button",{onClick:()=>r("create"),className:(0,A.cn)("flex-1 px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-200","create"===q?"bg-amber-500 text-black shadow-sm":"text-white/50 hover:text-white"),children:[(0,e.jsx)(w.Plus,{className:"w-3.5 h-3.5 inline mr-1.5 -mt-0.5"}),"Create"]}),(0,e.jsxs)("button",{onClick:()=>r("join"),className:(0,A.cn)("flex-1 px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-200","join"===q?"bg-amber-500 text-black shadow-sm":"text-white/50 hover:text-white"),children:[(0,e.jsx)(m.LogIn,{className:"w-3.5 h-3.5 inline mr-1.5 -mt-0.5"}),"Join"]})]}),(0,e.jsxs)(j.motion.form,{onSubmit:c=>{if(c.preventDefault(),"create"===q){if(!g.trim())return;let b=o.split(",").map(a=>a.trim()).filter(a=>a.length>0);a(g.trim(),i.trim()||void 0,b.length>0?b:void 0)}else{if(!s.trim())return;b(s.trim())}},className:"space-y-3",initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.1},children:[(0,e.jsx)(k.AnimatePresence,{mode:"wait",children:"create"===q?(0,e.jsxs)(j.motion.div,{initial:{opacity:0,x:-8},animate:{opacity:1,x:0},exit:{opacity:0,x:8},transition:{duration:.2},className:"space-y-3",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{className:"block text-xs font-medium text-white/40 uppercase tracking-wider mb-1.5 pl-1",children:"Room Name"}),(0,e.jsx)("input",{type:"text",value:g,onChange:a=>h(a.target.value),placeholder:"Late night music",className:"w-full px-4 py-3 bg-white/[0.04] border border-white/[0.08] rounded-xl text-white placeholder-white/20 focus:outline-none focus:border-amber-500/50 focus:bg-white/[0.06] transition-all text-sm",autoFocus:!0})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{className:"block text-xs font-medium text-white/40 uppercase tracking-wider mb-1.5 pl-1",children:"Description"}),(0,e.jsx)("textarea",{value:i,onChange:a=>l(a.target.value),placeholder:"What's this room about?",rows:2,className:"w-full px-4 py-3 bg-white/[0.04] border border-white/[0.08] rounded-xl text-white placeholder-white/20 focus:outline-none focus:border-amber-500/50 focus:bg-white/[0.06] transition-all resize-none text-sm"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{className:"block text-xs font-medium text-white/40 uppercase tracking-wider mb-1.5 pl-1",children:"Topics"}),(0,e.jsx)("input",{type:"text",value:o,onChange:a=>p(a.target.value),placeholder:"tech, AI, design...",className:"w-full px-4 py-3 bg-white/[0.04] border border-white/[0.08] rounded-xl text-white placeholder-white/20 focus:outline-none focus:border-amber-500/50 focus:bg-white/[0.06] transition-all text-sm"})]})]},"create"):(0,e.jsxs)(j.motion.div,{initial:{opacity:0,x:8},animate:{opacity:1,x:0},exit:{opacity:0,x:-8},transition:{duration:.2},className:"space-y-3",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{className:"block text-xs font-medium text-white/40 uppercase tracking-wider mb-1.5 pl-1",children:"Room Code or URL"}),(0,e.jsx)("input",{type:"text",value:s,onChange:a=>t(a.target.value),placeholder:"Paste room link or enter code...",className:"w-full px-4 py-3 bg-white/[0.04] border border-white/[0.08] rounded-xl text-white placeholder-white/20 focus:outline-none focus:border-amber-500/50 focus:bg-white/[0.06] transition-all text-sm",autoFocus:!0})]}),(0,e.jsx)("p",{className:"text-xs text-white/30 pl-1",children:"Enter a room name, URL, or invite link"})]},"join")}),(0,e.jsxs)(j.motion.button,{type:"submit",disabled:d||("create"===q?!g.trim():!s.trim()),whileTap:{scale:.98},className:"w-full px-6 py-3.5 bg-amber-500 hover:bg-amber-400 text-black font-semibold rounded-xl shadow-sm disabled:opacity-30 disabled:cursor-not-allowed transition-all text-sm flex items-center justify-center gap-2",children:[d?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(z.Loader2,{className:"w-4 h-4 animate-spin"}),"Connecting..."]}):"create"===q?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(u.Mic,{className:"w-4 h-4"}),"Start Room"]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(x.Headphones,{className:"w-4 h-4"}),"Join Room"]}),!d&&(0,e.jsx)(y.ChevronRight,{className:"w-4 h-4 ml-auto"})]})]}),(0,e.jsxs)(j.motion.div,{className:"mt-8 grid grid-cols-2 gap-3",initial:{opacity:0},animate:{opacity:1},transition:{delay:.25,duration:.4},children:[(0,e.jsxs)("div",{className:"p-4 bg-white/[0.03] rounded-xl border border-white/[0.06]",children:[(0,e.jsx)(v.Users,{className:"w-5 h-5 text-amber-500 mb-2"}),(0,e.jsx)("p",{className:"text-sm text-white/80 font-medium",children:"Multi-person"}),(0,e.jsx)("p",{className:"text-xs text-white/30 mt-0.5",children:"Stage + audience"})]}),(0,e.jsxs)("div",{className:"p-4 bg-white/[0.03] rounded-xl border border-white/[0.06]",children:[(0,e.jsx)(u.Mic,{className:"w-5 h-5 text-amber-500 mb-2"}),(0,e.jsx)("p",{className:"text-sm text-white/80 font-medium",children:"Real-time"}),(0,e.jsx)("p",{className:"text-xs text-white/30 mt-0.5",children:"Low latency audio"})]})]})]})})]})}var C=a.i(998612),D=a.i(773933),E=a.i(673856),F=a.i(172777),G=a.i(442956),H=a.i(476012),I=a.i(885275),J=a.i(683560),K=a.i(644469),L=a.i(750394),M=a.i(410275);let N=["#f59e0b","#ef4444","#10b981","#3b82f6","#f97316","#06b6d4","#ec4899","#84cc16","#14b8a6","#e11d48"];function O({name:a,role:b,isMuted:c,isSpeaking:d,audioLevel:f,hasRaisedHand:g,isLocal:h}){let i=N[a.split("").reduce((a,b)=>a+b.charCodeAt(0),0)%N.length],k="host"===b||"co-host"===b||"speaker"===b;return(0,e.jsxs)(j.motion.div,{className:"flex flex-col items-center gap-1.5",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},children:[(0,e.jsxs)("div",{className:"relative",children:[d&&(0,e.jsx)(j.motion.div,{className:"absolute -inset-1 rounded-full border-[2.5px] border-amber-500",initial:{opacity:0},animate:{opacity:[.5,1,.5]},transition:{duration:1.5,repeat:1/0}}),(0,e.jsx)("div",{className:(0,A.cn)("w-16 h-16 rounded-full flex items-center justify-center text-lg font-bold text-white relative",k?"w-[72px] h-[72px]":"w-16 h-16"),style:{backgroundColor:i},children:a.charAt(0).toUpperCase()}),c&&k&&(0,e.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center border-2 border-black",children:(0,e.jsx)(C.MicOff,{className:"w-2.5 h-2.5 text-white"})}),"host"===b&&(0,e.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-amber-500 rounded-full flex items-center justify-center border-2 border-black",children:(0,e.jsx)(L.Crown,{className:"w-2.5 h-2.5 text-black"})}),"co-host"===b&&(0,e.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-white/90 rounded-full flex items-center justify-center border-2 border-black",children:(0,e.jsx)(M.Star,{className:"w-2.5 h-2.5 text-black"})}),g&&"listener"===b&&(0,e.jsx)(j.motion.div,{className:"absolute -top-2 -right-2 text-base",initial:{scale:0},animate:{scale:1,y:[0,-3,0]},transition:{y:{repeat:1/0,duration:1}},children:"âœ‹"})]}),(0,e.jsxs)("div",{className:"text-center max-w-[80px]",children:[(0,e.jsx)("p",{className:(0,A.cn)("text-xs font-medium truncate",h?"text-amber-500":"text-white/80"),children:h?"You":a}),"host"===b&&(0,e.jsx)("p",{className:"text-[10px] text-amber-500/70 font-medium",children:"HOST"}),"co-host"===b&&(0,e.jsx)("p",{className:"text-[10px] text-white/40 font-medium",children:"CO-HOST"})]})]})}var P=a.i(887080),Q=a.i(496760);function R({messages:a,onSendMessage:b,onClose:c}){let[d,g]=(0,f.useState)(""),h=(0,f.useRef)(null);return(0,f.useEffect)(()=>{h.current?.scrollIntoView({behavior:"smooth"})},[a]),(0,e.jsxs)(j.motion.div,{className:"fixed right-0 top-0 bottom-20 w-80 bg-neutral-950 border-l border-white/[0.06] flex flex-col z-40",initial:{x:320},animate:{x:0},exit:{x:320},transition:{duration:.25,ease:[.25,.46,.45,.94]},children:[(0,e.jsxs)("div",{className:"p-4 border-b border-white/[0.06] flex items-center justify-between",children:[(0,e.jsx)("h2",{className:"text-sm font-semibold text-white",children:"Chat"}),(0,e.jsx)("button",{onClick:c,className:"w-7 h-7 rounded-lg hover:bg-white/[0.06] flex items-center justify-center text-white/30 hover:text-white transition-colors",children:(0,e.jsx)(P.X,{className:"w-3.5 h-3.5"})})]}),(0,e.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[0===a.length?(0,e.jsx)("div",{className:"text-center text-white/20 text-xs mt-8",children:"No messages yet"}):a.map(a=>(0,e.jsxs)("div",{className:(0,A.cn)("flex flex-col","system"===a.type?"items-center":"items-start"),children:["text"===a.type&&(0,e.jsx)("div",{className:"text-[10px] text-amber-500/60 font-medium mb-0.5",children:a.participantName}),(0,e.jsx)("div",{className:(0,A.cn)("px-3 py-1.5 rounded-lg text-sm","system"===a.type?"bg-white/[0.02] text-white/20 text-xs":"bg-white/[0.04] text-white/80"),children:a.content}),(0,e.jsx)("div",{className:"text-[10px] text-white/15 mt-0.5",children:new Date(a.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},a.id)),(0,e.jsx)("div",{ref:h})]}),(0,e.jsx)("form",{onSubmit:a=>{a.preventDefault(),d.trim()&&(b(d),g(""))},className:"p-3 border-t border-white/[0.06]",children:(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)("input",{type:"text",value:d,onChange:a=>g(a.target.value),placeholder:"Message...",className:"flex-1 px-3 py-2 bg-white/[0.04] border border-white/[0.08] rounded-lg text-white text-sm placeholder-white/20 focus:outline-none focus:border-amber-500/30 transition-colors",autoFocus:!0}),(0,e.jsx)("button",{type:"submit",disabled:!d.trim(),className:"px-3 py-2 bg-amber-500 hover:bg-amber-400 text-black rounded-lg disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:(0,e.jsx)(Q.Send,{className:"w-4 h-4"})})]})})]})}var S=a.i(132581);function T({room:a,onPromoteToSpeaker:b,onMuteParticipant:c,onClose:d}){if(!a)return null;let f=Array.from(a.remoteParticipants.values()).filter(a=>{let b=a.metadata?JSON.parse(a.metadata):{};return("listener"===b.role||!b.role)&&!0===b.hasRaisedHand}),g=Array.from(a.remoteParticipants.values());return(0,e.jsxs)(j.motion.div,{className:"bg-white/[0.03] border border-white/[0.06] rounded-xl p-4",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:[(0,e.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,e.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Host Controls"}),(0,e.jsx)("button",{onClick:d,className:"w-7 h-7 rounded-lg hover:bg-white/[0.06] flex items-center justify-center text-white/30 hover:text-white transition-colors",children:(0,e.jsx)(P.X,{className:"w-3.5 h-3.5"})})]}),f.length>0&&(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("h4",{className:"text-xs font-medium text-white/30 uppercase tracking-wider mb-2",children:"Raised Hands"}),(0,e.jsx)("div",{className:"space-y-1.5",children:f.map(a=>(0,e.jsxs)("div",{className:"flex items-center justify-between p-2.5 bg-white/[0.03] rounded-lg border border-white/[0.04]",children:[(0,e.jsx)("span",{className:"text-sm text-white/80",children:a.name||a.identity}),(0,e.jsxs)("button",{onClick:()=>b(a.identity),className:"px-3 py-1 bg-amber-500 hover:bg-amber-400 text-black text-xs font-medium rounded-lg transition-colors flex items-center gap-1",children:[(0,e.jsx)(S.UserPlus,{className:"w-3 h-3"}),"Promote"]})]},a.identity))})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-xs font-medium text-white/30 uppercase tracking-wider mb-2",children:"Participants"}),(0,e.jsx)("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:g.map(a=>{let d=a.metadata?JSON.parse(a.metadata):{},f=a.audioTrackPublications.values().next().value?.track,g=f?.isMuted??!1;return(0,e.jsxs)("div",{className:"flex items-center justify-between p-2.5 bg-white/[0.03] rounded-lg border border-white/[0.04]",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("span",{className:"text-sm text-white/80",children:a.name||a.identity}),d.role&&(0,e.jsx)("span",{className:"px-1.5 py-0.5 bg-amber-500/10 text-amber-500 text-[10px] rounded font-medium uppercase",children:d.role})]}),(0,e.jsxs)("div",{className:"flex gap-1.5",children:["listener"===d.role&&(0,e.jsx)("button",{onClick:()=>b(a.identity),className:"px-2 py-1 bg-amber-500/10 hover:bg-amber-500/20 text-amber-500 text-xs rounded-lg transition-colors",children:"Promote"}),"speaker"===d.role&&(0,e.jsxs)("button",{onClick:()=>c(a.identity),className:"px-2 py-1 bg-red-500/10 hover:bg-red-500/20 text-red-400 text-xs rounded-lg transition-colors flex items-center gap-1",children:[g?(0,e.jsx)(C.MicOff,{className:"w-3 h-3"}):(0,e.jsx)(u.Mic,{className:"w-3 h-3"}),g?"Unmute":"Mute"]})]})]},a.identity)})})]})]})}try{b=(()=>{let a=Error("Cannot find module '../../../convex/_generated/api'");throw a.code="MODULE_NOT_FOUND",a})().api}catch{b=null}function U({roomName:a,roomId:c,inviteToken:d,room:g,onLeave:i}){let[l,m]=(0,f.useState)(!1),[o,p]=(0,f.useState)(!1),q=(0,h.useQuery)(b?.clubspaces?.getRoomById||(async()=>null),b?.clubspaces?.getRoomById?{roomId:c}:"skip");d||q?.inviteToken,(0,f.useEffect)(()=>{if(!l)return;let a=a=>{a.target.closest(".share-menu-container")||m(!1)};return document.addEventListener("click",a),()=>document.removeEventListener("click",a)},[l]);let{localRole:r,roomMetadata:s,chatMessages:t,reactions:w,hasRaisedHand:x,toggleMute:y,raiseHand:z,sendChatMessage:B,sendReaction:L,promoteToSpeaker:M,muteParticipant:N}=function(){let a=(0,f.useContext)(V);if(!a)throw Error("useClubSpacesContext must be used within ClubSpacesApp");return a}(),[P,Q]=(0,f.useState)(!1),[S,U]=(0,f.useState)(!1),W=g?.localParticipant.audioTrackPublications.values().next().value?.track?.isMuted??!1,X=(g?.remoteParticipants.size??0)+1,Y="host"===r||"co-host"===r,Z="host"===r||"co-host"===r||"speaker"===r,$=g?Array.from(g.remoteParticipants.values()).filter(a=>{let b=a.metadata?JSON.parse(a.metadata):{};return"host"===b.role||"co-host"===b.role}):[],_=g?Array.from(g.remoteParticipants.values()).filter(a=>"speaker"===(a.metadata?JSON.parse(a.metadata):{}).role):[],aa=g?Array.from(g.remoteParticipants.values()).filter(a=>{let b=a.metadata?JSON.parse(a.metadata):{};return"listener"===b.role||!b.role}):[],ab=async a=>{await navigator.clipboard.writeText(a),p(!0),setTimeout(()=>p(!1),2e3)};return(0,e.jsxs)("div",{className:"min-h-dvh flex flex-col bg-black relative",children:[(0,e.jsxs)(j.motion.header,{className:"flex items-center justify-between px-5 py-3 border-b border-white/[0.06]",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(J.ChevronDown,{className:"w-5 h-5 text-white/40"}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(n.Radio,{className:"w-4 h-4 text-amber-500"}),(0,e.jsx)("span",{className:"text-sm font-medium text-white/60",children:"LIVE"})]})]}),(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsxs)("div",{className:"flex items-center gap-1.5 text-white/40 text-xs",children:[(0,e.jsx)(v.Users,{className:"w-3.5 h-3.5"}),(0,e.jsx)("span",{children:X})]})})]}),(0,e.jsxs)("div",{className:"flex-1 overflow-y-auto pb-28",children:[(0,e.jsxs)(j.motion.div,{className:"mx-4 mt-4 p-5 bg-white/[0.03] rounded-2xl border border-white/[0.06]",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.05},children:[(0,e.jsx)("h1",{className:"text-xl font-bold text-white mb-1",children:a}),s?.topics&&s.topics.length>0&&(0,e.jsx)("div",{className:"flex flex-wrap gap-1.5 mt-2",children:s.topics.map((a,b)=>(0,e.jsx)("span",{className:"px-2.5 py-0.5 bg-amber-500/10 text-amber-500 text-xs rounded-full border border-amber-500/20 font-medium",children:a},b))}),(0,e.jsxs)("div",{className:"flex items-center gap-2 mt-4",children:[(0,e.jsxs)("div",{className:"relative share-menu-container",children:[(0,e.jsxs)("button",{onClick:a=>{a.stopPropagation(),m(!l)},className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white/50 hover:text-white bg-white/[0.04] hover:bg-white/[0.08] rounded-lg border border-white/[0.06] transition-all",children:[(0,e.jsx)(G.Share2,{className:"w-3.5 h-3.5"}),"Share"]}),l&&(0,e.jsx)("div",{className:"absolute left-0 top-full mt-2 w-72 bg-neutral-900 border border-white/[0.08] rounded-xl p-4 shadow-2xl z-50",onClick:a=>a.stopPropagation(),children:(0,e.jsxs)("div",{className:"space-y-3",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"text-[10px] text-white/30 uppercase tracking-wider mb-1.5",children:"Room URL"}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("input",{type:"text",value:"",readOnly:!0,className:"flex-1 px-2.5 py-1.5 bg-white/[0.04] border border-white/[0.08] rounded-lg text-white text-xs font-mono"}),(0,e.jsx)("button",{onClick:()=>ab(""),className:"px-2.5 py-1.5 bg-amber-500 hover:bg-amber-400 text-black rounded-lg transition-colors",children:o?(0,e.jsx)(I.Check,{className:"w-3.5 h-3.5"}):(0,e.jsx)(H.Copy,{className:"w-3.5 h-3.5"})})]})]}),null]})})]}),Y&&(0,e.jsxs)("button",{onClick:()=>U(!S),className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-amber-500/80 hover:text-amber-500 bg-amber-500/[0.06] hover:bg-amber-500/10 rounded-lg border border-amber-500/10 transition-all",children:[(0,e.jsx)(K.Settings2,{className:"w-3.5 h-3.5"}),"Host"]})]})]}),(0,e.jsx)(k.AnimatePresence,{children:S&&Y&&(0,e.jsx)(j.motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mx-4 mt-3 overflow-hidden",children:(0,e.jsx)(T,{room:g,onPromoteToSpeaker:M,onMuteParticipant:N,onClose:()=>U(!1)})})}),(0,e.jsx)(j.motion.section,{className:"px-4 mt-6",initial:{opacity:0},animate:{opacity:1},transition:{delay:.15},children:(0,e.jsxs)("div",{className:"flex flex-wrap gap-6 justify-center py-4",children:[g&&(0,e.jsx)(O,{identity:g.localParticipant.identity,name:"You",role:r,isMuted:W,isSpeaking:!1,audioLevel:0,hasRaisedHand:x,isLocal:!0},g.localParticipant.identity),$.map(a=>{let b=a.audioTrackPublications.values().next().value,c=a.metadata?JSON.parse(a.metadata):{},d=b?.isMuted??!1,f=b?.track&&!b.isMuted?.3:0;return(0,e.jsx)(O,{identity:a.identity,name:a.name||a.identity,role:c.role||"host",isMuted:d,isSpeaking:f>.1,audioLevel:f,hasRaisedHand:c.hasRaisedHand,isLocal:!1},a.identity)}),_.map(a=>{let b=a.audioTrackPublications.values().next().value,c=a.metadata?JSON.parse(a.metadata):{},d=b?.isMuted??!1,f=b?.track&&!b.isMuted?.3:0;return(0,e.jsx)(O,{identity:a.identity,name:a.name||a.identity,role:"speaker",isMuted:d,isSpeaking:f>.1,audioLevel:f,hasRaisedHand:c.hasRaisedHand,isLocal:!1},a.identity)})]})}),aa.length>0&&(0,e.jsx)("div",{className:"mx-4 mt-4 mb-2",children:(0,e.jsxs)("div",{className:"flex items-center gap-3",children:[(0,e.jsx)("div",{className:"h-px flex-1 bg-white/[0.06]"}),(0,e.jsx)("span",{className:"text-[10px] text-white/20 uppercase tracking-widest font-medium",children:"Listeners"}),(0,e.jsx)("div",{className:"h-px flex-1 bg-white/[0.06]"})]})}),aa.length>0&&(0,e.jsx)("section",{className:"px-4 py-2",children:(0,e.jsx)("div",{className:"flex flex-wrap gap-4 justify-center",children:aa.map(a=>{let b=a.metadata?JSON.parse(a.metadata):{};return(0,e.jsx)(O,{identity:a.identity,name:a.name||a.identity,role:"listener",isMuted:!0,isSpeaking:!1,audioLevel:0,hasRaisedHand:b.hasRaisedHand,isLocal:!1},a.identity)})})})]}),(0,e.jsx)(k.AnimatePresence,{children:w.length>0&&(0,e.jsx)(j.motion.div,{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-50 flex gap-2",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:w.map((a,b)=>(0,e.jsx)(j.motion.div,{className:"text-4xl",initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},exit:{scale:0,rotate:180},transition:{type:"spring",stiffness:200,damping:10},children:a.emoji},b))})}),(0,e.jsx)(k.AnimatePresence,{children:P&&(0,e.jsx)(R,{messages:t,onSendMessage:B,onClose:()=>Q(!1)})}),(0,e.jsx)(j.motion.div,{className:"fixed bottom-0 left-0 right-0 px-4 py-3 bg-black/90 backdrop-blur-xl border-t border-white/[0.06]",initial:{y:100},animate:{y:0},transition:{duration:.3,ease:[.25,.46,.45,.94]},children:(0,e.jsxs)("div",{className:"max-w-lg mx-auto flex items-center justify-between",children:[(0,e.jsxs)("button",{onClick:i,className:"px-5 py-2.5 bg-white/[0.06] hover:bg-white/10 text-white/60 hover:text-white rounded-full text-sm font-medium transition-all flex items-center gap-2 border border-white/[0.06]",children:[(0,e.jsx)(D.LogOut,{className:"w-4 h-4"}),"Leave"]}),(0,e.jsx)("div",{className:"flex items-center gap-3",children:["ðŸ‘","â¤ï¸","ðŸ”¥"].map(a=>(0,e.jsx)("button",{onClick:()=>L(a),className:"w-10 h-10 rounded-full bg-white/[0.04] hover:bg-white/[0.08] text-lg flex items-center justify-center transition-all border border-white/[0.06]",children:a},a))}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("button",{onClick:()=>Q(!P),className:(0,A.cn)("w-10 h-10 rounded-full flex items-center justify-center transition-all",P?"bg-amber-500 text-black":"bg-white/[0.04] text-white/50 hover:text-white border border-white/[0.06]"),children:(0,e.jsx)(F.MessageSquare,{className:"w-4 h-4"})}),Z?(0,e.jsx)("button",{onClick:y,className:(0,A.cn)("w-12 h-12 rounded-full flex items-center justify-center transition-all",W?"bg-red-500/10 text-red-400 border border-red-500/20":"bg-amber-500 text-black shadow-sm"),children:W?(0,e.jsx)(C.MicOff,{className:"w-5 h-5"}):(0,e.jsx)(u.Mic,{className:"w-5 h-5"})}):(0,e.jsx)("button",{onClick:z,className:(0,A.cn)("w-12 h-12 rounded-full flex items-center justify-center transition-all",x?"bg-amber-500 text-black shadow-sm":"bg-white/[0.04] text-white/50 hover:text-white border border-white/[0.06]"),children:(0,e.jsx)(E.Hand,{className:"w-5 h-5"})})]})]})})]})}try{c=(()=>{let a=Error("Cannot find module '../../../convex/_generated/api'");throw a.code="MODULE_NOT_FOUND",a})().api}catch{c=null}let V=(0,f.createContext)(null);function W({initialRoomId:a,initialRoomData:b}={}){let{user:d,isLoaded:g}=(0,i.useUser)(),u=(0,h.useMutation)(c?.clubspaces?.createRoom||(async()=>({roomId:"",inviteToken:""}))),[v,w]=(0,f.useState)(a?"room":"lobby"),[x,y]=(0,f.useState)(b?.name||null),[z,A]=(0,f.useState)(a||null),[C,D]=(0,f.useState)(b?.inviteToken||null),[E,F]=(0,f.useState)(null),[G,H]=(0,f.useState)(null),[I,J]=(0,f.useState)(!1),K=function(){let[a,b]=(0,f.useState)(null),[c,d]=(0,f.useState)(!1),[e,g]=(0,f.useState)(new Map),[h,i]=(0,f.useState)(null),[j,k]=(0,f.useState)(null),[l,m]=(0,f.useState)([]),[n,o]=(0,f.useState)([]),[p,q]=(0,f.useState)("listener"),[u,v]=(0,f.useState)(!1),w=(0,f.useRef)(null),x=(0,f.useRef)(null),y=(0,f.useRef)(null);(0,f.useEffect)(()=>{if(!a||!c){y.current&&(clearInterval(y.current),y.current=null);return}return y.current=setInterval(()=>{let b=new Map,c=a.localParticipant;if(c){let a=c.audioTrackPublications.values().next().value,d=a?.track&&!a.isMuted?.3:0;b.set(c.identity,{identity:c.identity,name:c.name||"You",role:p,isMuted:a?.isMuted??!1,isSpeaking:d>.1,audioLevel:d,hasRaisedHand:u,joinedAt:Date.now()})}a.remoteParticipants.forEach(a=>{let c=a.audioTrackPublications.values().next().value,d=c?.track&&!c.isMuted?.3:0,e=a.metadata?JSON.parse(a.metadata).role:"listener",f=!!a.metadata&&!0===JSON.parse(a.metadata).hasRaisedHand;b.set(a.identity,{identity:a.identity,name:a.name||a.identity,role:e,isMuted:c?.isMuted??!1,isSpeaking:d>.1,audioLevel:d,hasRaisedHand:f,joinedAt:a.joinedAt?.getTime()??Date.now()})}),g(b);let d=b.get(a.localParticipant.identity);d&&i(d)},100),()=>{y.current&&(clearInterval(y.current),y.current=null)}},[a,c,p,u]);let z=(0,f.useCallback)(async(a,c="listener",e)=>{try{t("Connecting to room",{roomName:a,role:c}),q(c);let f=await fetch("/api/livekit/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomName:a})});if(!f.ok)throw Error(`Token generation failed: ${f.statusText}`);let{token:h,url:j}=await f.json(),l=new r.Room;if(w.current=l,l.on(r.RoomEvent.Connected,()=>{t("Room connected"),d(!0),b(l)}),l.on(r.RoomEvent.Disconnected,()=>{t("Room disconnected"),d(!1),b(null),g(new Map),i(null)}),l.on(r.RoomEvent.ParticipantConnected,a=>{t("Participant connected",{identity:a.identity})}),l.on(r.RoomEvent.ParticipantDisconnected,a=>{t("Participant disconnected",{identity:a.identity}),g(b=>{let c=new Map(b);return c.delete(a.identity),c})}),l.on(r.RoomEvent.TrackSubscribed,(a,b,c)=>{t("Track subscribed",{kind:a.kind,participant:c.identity})}),await l.connect(j,h),await l.localParticipant.setMetadata(JSON.stringify({role:c,hasRaisedHand:!1})),"host"===c&&e){let b={name:a,description:e.description,topics:e.topics,isPublic:e.isPublic??!0,maxSpeakers:e.maxSpeakers??13,hostIdentity:l.localParticipant.identity,createdAt:Date.now(),scheduledFor:e.scheduledFor};k(b),await l.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({type:"room_metadata",data:b})),{reliable:!0})}if(l.on(r.RoomEvent.DataReceived,(a,b)=>{try{let b=JSON.parse(new TextDecoder().decode(a));"room_metadata"===b.type?k(b.data):"chat_message"===b.type?m(a=>[...a,b.data]):"reaction"===b.type?o(a=>[...a,b.data]):"role_update"===b.type&&b.identity===l.localParticipant.identity&&q(b.role)}catch(a){}}),"listener"!==c){let a=await (0,r.createLocalAudioTrack)({echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0});x.current=a,await l.localParticipant.publishTrack(a,{source:r.Track.Source.Microphone}),t("Local audio track published")}else t("Joined as listener (no audio track)")}catch(a){throw console.error(`${s} Connection failed`,a??""),a}},[]),A=(0,f.useCallback)(async()=>{t("Disconnecting from room"),y.current&&(clearInterval(y.current),y.current=null),x.current&&(x.current.stop(),x.current=null),w.current&&(await w.current.disconnect(),w.current=null),d(!1),b(null),g(new Map),i(null)},[]),B=(0,f.useCallback)(()=>{let a=x.current;a&&(a.isMuted?a.unmute():a.mute())},[]),C=(0,f.useCallback)(async()=>{if(!a)return;let b=!u;v(b),await a.localParticipant.setMetadata(JSON.stringify({role:p,hasRaisedHand:b})),b&&await a.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({type:"hand_raised",identity:a.localParticipant.identity,name:a.localParticipant.name})),{reliable:!0})},[a,u,p]),D=(0,f.useCallback)(async b=>{if(!a||!b.trim())return;let c={id:`msg-${Date.now()}`,participantIdentity:a.localParticipant.identity,participantName:a.localParticipant.name||"You",content:b.trim(),timestamp:Date.now(),type:"text"};m(a=>[...a,c]),await a.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({type:"chat_message",data:c})),{reliable:!0})},[a]),E=(0,f.useCallback)(async b=>{if(!a)return;let c={emoji:b,participantIdentity:a.localParticipant.identity,timestamp:Date.now()};o(a=>[...a,c]),await a.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({type:"reaction",data:c})),{reliable:!0}),setTimeout(()=>{o(a=>a.filter(a=>a.timestamp!==c.timestamp))},3e3)},[a]),F=(0,f.useCallback)(async b=>{a&&("host"===p||"co-host"===p)&&await a.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({type:"role_update",identity:b,role:"speaker"})),{reliable:!0})},[a,p]),G=(0,f.useCallback)(async b=>{if(!a||"host"!==p&&"co-host"!==p)return;let c=a.remoteParticipants.get(b);c&&c.audioTrackPublications.values().next().value?.track&&await a.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({type:"mute_request",identity:b})),{reliable:!0})},[a,p]);return{room:a,isConnected:c,participants:Array.from(e.values()),localParticipant:h,localRole:p,roomMetadata:j,chatMessages:l,reactions:n,hasRaisedHand:u,connect:z,disconnect:A,toggleMute:B,raiseHand:C,sendChatMessage:D,sendReaction:E,promoteToSpeaker:F,muteParticipant:G}}(),{room:L,connect:M,disconnect:N,isConnected:O}=K;(0,f.useEffect)(()=>{d&&"signin"===v&&w("lobby")},[d,v]),(0,f.useEffect)(()=>{d&&E&&("create"===E.type?Q(...E.args):R(E.args[0]),F(null))},[d,E]);let P=a=>{let b=a instanceof Error?a.message:String(a);return b.includes("could not establish signal connection")||b.includes("Failed to fetch")?"LiveKit server is unreachable. Make sure your self-hosted LiveKit server is running and accessible.":b.includes("Token generation failed")||b.includes("LiveKit server not configured")?"LiveKit credentials are not configured. Check your LIVEKIT_API_KEY and LIVEKIT_API_SECRET environment variables.":b.includes("CORS")?"LiveKit server is blocking cross-origin requests. Check your Cloudflare Tunnel and CORS configuration.":`Connection failed: ${b}`},Q=async(a,b,e)=>{if(!d){F({type:"create",args:[a,b,e]}),w("signin");return}J(!0),H(null);try{let f,g;if(c?.clubspaces?.createRoom){let c=await u({name:a,description:b,topics:e||[],isPublic:!0,hostClerkId:d.id,hostName:d.fullName||d.firstName||d.emailAddresses[0]?.emailAddress||"Host",maxSpeakers:13});f=c.roomId,g=c.inviteToken}else console.error("Convex API not available - using fallback room creation"),f=`room-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,g=Math.random().toString(36).substr(2,16);A(f),y(a),D(g),await M(f,"host",{description:b,topics:e||[],isPublic:!0}),window.history.pushState({},"",`/clubspaces/room/${f}`),w("room")}catch(a){console.error("Failed to create room:",a),H(P(a)),w("error")}finally{J(!1)}},R=async a=>{if(!d){F({type:"join",args:[a]}),w("signin");return}J(!0),H(null);let b=a;a.includes("/clubspaces/room/")?b=a.split("/clubspaces/room/")[1]:a.includes("/clubspaces/invite/")&&(b=a.split("/clubspaces/invite/")[1]);try{y(b),A(b),await M(b,"listener"),window.history.pushState({},"",`/clubspaces/room/${b}`),w("room")}catch(a){console.error("Failed to join room:",a),H(P(a)),w("error")}finally{J(!1)}},S=async()=>{await N(),y(null),A(null),H(null),window.history.pushState({},"","/clubspaces"),w("lobby")};return(0,f.useEffect)(()=>{"room"!==v||O||(w("lobby"),y(null))},[O,v]),(0,e.jsx)(V.Provider,{value:K,children:(0,e.jsx)("div",{className:"min-h-dvh bg-black",children:(0,e.jsx)(k.AnimatePresence,{mode:"wait",children:"error"===v?(0,e.jsx)(j.motion.div,{initial:{opacity:0,scale:.97},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.97},transition:{duration:.3},className:"min-h-dvh flex flex-col items-center justify-center p-4 bg-black",children:(0,e.jsxs)("div",{className:"max-w-md w-full text-center",children:[(0,e.jsx)("div",{className:"w-14 h-14 rounded-2xl bg-red-500/10 border border-red-500/20 flex items-center justify-center mx-auto mb-6",children:(0,e.jsx)(q.default,{className:"w-7 h-7 text-red-400"})}),(0,e.jsx)("h1",{className:"text-xl font-bold text-white mb-2",children:"Connection Failed"}),(0,e.jsx)("p",{className:"text-white/50 text-sm mb-6 leading-relaxed",children:G}),(0,e.jsxs)("div",{className:"bg-white/[0.03] border border-white/[0.06] rounded-xl p-4 mb-6 text-left",children:[(0,e.jsx)("p",{className:"text-white/30 text-xs font-medium uppercase tracking-wider mb-3",children:"Troubleshooting"}),(0,e.jsxs)("ul",{className:"space-y-2 text-white/40 text-xs",children:[(0,e.jsxs)("li",{className:"flex items-start gap-2",children:[(0,e.jsx)(p.Wifi,{className:"w-3.5 h-3.5 text-amber-500/60 mt-0.5 shrink-0"}),(0,e.jsxs)("span",{children:["Ensure LiveKit Server is running (",(0,e.jsx)("code",{className:"text-amber-500/80 bg-white/[0.04] px-1 rounded",children:"docker ps"}),")"]})]}),(0,e.jsxs)("li",{className:"flex items-start gap-2",children:[(0,e.jsx)(p.Wifi,{className:"w-3.5 h-3.5 text-amber-500/60 mt-0.5 shrink-0"}),(0,e.jsx)("span",{children:"Check Cloudflare Tunnel is active and routing to port 7880"})]}),(0,e.jsxs)("li",{className:"flex items-start gap-2",children:[(0,e.jsx)(p.Wifi,{className:"w-3.5 h-3.5 text-amber-500/60 mt-0.5 shrink-0"}),(0,e.jsxs)("span",{children:["Verify ",(0,e.jsx)("code",{className:"text-amber-500/80 bg-white/[0.04] px-1 rounded",children:"LIVEKIT_URL"})," env var in Vercel matches your tunnel URL"]})]})]})]}),(0,e.jsxs)("div",{className:"flex gap-3",children:[(0,e.jsxs)("button",{onClick:()=>{H(null),w("lobby")},className:"flex-1 px-5 py-3 bg-amber-500 hover:bg-amber-400 text-black font-semibold rounded-xl transition-colors flex items-center justify-center gap-2",children:[(0,e.jsx)(o.RefreshCw,{className:"w-4 h-4"}),"Try Again"]}),(0,e.jsx)("button",{onClick:()=>{window.history.pushState({},"","/clubspaces"),w("lobby"),H(null)},className:"px-5 py-3 bg-white/[0.06] hover:bg-white/10 text-white/60 hover:text-white rounded-xl transition-colors border border-white/[0.06]",children:"Back"})]})]})},"error"):"signin"===v?(0,e.jsx)(j.motion.div,{initial:{opacity:0,scale:.97},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.97},transition:{duration:.3},className:"min-h-dvh flex flex-col items-center justify-center p-4 bg-black",children:(0,e.jsxs)("div",{className:"max-w-sm w-full text-center",children:[(0,e.jsx)("div",{className:"w-14 h-14 rounded-2xl bg-amber-500 flex items-center justify-center mx-auto mb-6",children:(0,e.jsx)(n.Radio,{className:"w-7 h-7 text-black"})}),(0,e.jsx)("h1",{className:"text-2xl font-bold text-white mb-2",children:"Sign in to continue"}),(0,e.jsx)("p",{className:"text-white/40 text-sm mb-8",children:"Sign in to create or join audio rooms"}),(0,e.jsx)(l.SignInButton,{mode:"modal",forceRedirectUrl:"/clubspaces",children:(0,e.jsxs)("button",{className:"w-full px-6 py-3.5 bg-amber-500 hover:bg-amber-400 text-black font-semibold rounded-xl transition-colors flex items-center justify-center gap-2",children:[(0,e.jsx)(m.LogIn,{className:"w-4 h-4"}),"Sign In"]})}),(0,e.jsx)("button",{onClick:()=>{F(null),w("lobby")},className:"mt-4 text-sm text-white/30 hover:text-white/60 transition-colors",children:"Back to lobby"})]})},"signin"):"lobby"===v?(0,e.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:(0,e.jsx)(B,{onCreateRoom:Q,onJoinRoom:R,user:d,isConnecting:I})},"lobby"):(0,e.jsx)(j.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.3},children:(0,e.jsx)(U,{roomName:x,roomId:z,inviteToken:C,room:L,onLeave:S})},"room")})})})}try{d=a.r(135981).api}catch{d=null}function X(){let a=(0,g.useParams)(),b=(0,g.useRouter)(),c=a.roomId,{user:k,isLoaded:l}=(0,i.useUser)(),[m,n]=(0,f.useState)(!1),o=(0,h.useQuery)(d?.clubspaces?.getRoomById||(async()=>null),d?.clubspaces?.getRoomById?{roomId:c}:"skip");return((0,f.useEffect)(()=>{if(l){if(!k)return void b.push("/clubspaces?signIn=true");if(null===o)return void b.push("/clubspaces?error=room_not_found");o&&!m&&n(!0)}},[k,l,o,b,m]),l)?k?void 0===o?(0,e.jsx)("div",{className:"min-h-dvh bg-black flex items-center justify-center",children:(0,e.jsx)(z.Loader2,{className:"w-6 h-6 text-amber-500 animate-spin"})}):null===o?(0,e.jsx)("div",{className:"min-h-dvh bg-black flex items-center justify-center p-4",children:(0,e.jsxs)(j.motion.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"text-center",children:[(0,e.jsx)("h1",{className:"text-xl font-bold text-white mb-2",children:"Room Not Found"}),(0,e.jsx)("p",{className:"text-white/40 text-sm mb-6",children:"This room doesn't exist or has been deleted."}),(0,e.jsx)("button",{onClick:()=>b.push("/clubspaces"),className:"px-5 py-2.5 bg-amber-500 hover:bg-amber-400 text-black font-medium rounded-xl transition-colors text-sm",children:"Go to Lobby"})]})}):(0,e.jsx)(W,{initialRoomId:c,initialRoomData:o}):null:(0,e.jsx)("div",{className:"min-h-dvh bg-black flex items-center justify-center",children:(0,e.jsx)(z.Loader2,{className:"w-6 h-6 text-amber-500 animate-spin"})})}a.s(["default",()=>X],658304)}];

//# sourceMappingURL=src_app_clubspaces_room_%5BroomId%5D_page_tsx_f3c456ce._.js.map