{"version":3,"sources":["../../../../src/components/vault/VaultUnlockForm.tsx/__nextjs-internal-proxy.mjs","../../../../src/app/vault/layout.tsx","../../../../src/lib/vaultAuth.ts"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const VaultUnlockForm = registerClientReference(\n    function() { throw new Error(\"Attempted to call VaultUnlockForm() from the server but VaultUnlockForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/vault/VaultUnlockForm.tsx\",\n    \"VaultUnlockForm\",\n);\n","import { cookies } from \"next/headers\";\nimport { verifySession, getVaultCookieName } from \"@/lib/vaultAuth\";\nimport React from \"react\";\nimport { VaultUnlockForm } from \"@/components/vault/VaultUnlockForm\";\n\nexport default async function VaultLayout({ children }: { children: React.ReactNode }) {\n  const cookieStore = await cookies();\n  const token = cookieStore.get(getVaultCookieName())?.value;\n  const session = verifySession(token);\n\n  if (!session) {\n    return (\n      <section className=\"max-w-[600px] mx-auto py-16 px-4\">\n        <h1 className=\"text-3xl font-bold mb-4\">Vault</h1>\n        <p className=\"text-zinc-500 mb-6\">Enter password to access the vault.</p>\n        <VaultUnlockForm />\n      </section>\n    );\n  }\n\n  return <>{children}</>;\n}\n","export type VaultSessionPayload = {\n  sub: \"vault\";\n  exp: number; // epoch ms\n};\n\nconst COOKIE_NAME = \"vault_session\" as const;\n\nfunction getEnv(name: string): string {\n  const value = process.env[name];\n  if (!value) throw new Error(`${name} is not set`);\n  return value;\n}\n\nfunction toBase64Url(input: string | Uint8Array): string {\n  const buf = typeof input === \"string\" ? Buffer.from(input, \"utf8\") : Buffer.from(input);\n  return buf.toString(\"base64\").replace(/=/g, \"\").replace(/\\+/g, \"-\").replace(/\\//g, \"_\");\n}\n\nfunction fromBase64Url(input: string): Buffer {\n  const pad = 4 - (input.length % 4 || 4);\n  const normalized = input.replace(/-/g, \"+\").replace(/_/g, \"/\") + \"=\".repeat(pad);\n  return Buffer.from(normalized, \"base64\");\n}\n\n// Constant-time comparison\nexport function safeEqual(a: string, b: string): boolean {\n  const ba = Buffer.from(a);\n  const bb = Buffer.from(b);\n  if (ba.length !== bb.length) return false;\n  return crypto.timingSafeEqual(ba, bb);\n}\n\nexport function hashSecret(secret: string, salt: string): string {\n  const h = crypto.createHmac(\"sha256\", salt);\n  h.update(secret);\n  return toBase64Url(h.digest());\n}\n\nexport function signSession(payload: VaultSessionPayload): string {\n  const secret = getEnv(\"VAULT_SIGNING_SECRET\");\n  const payloadB64 = toBase64Url(JSON.stringify(payload));\n  const sig = hashSecret(payloadB64, secret);\n  return `${payloadB64}.${sig}`;\n}\n\nexport function verifySession(token: string | undefined): VaultSessionPayload | null {\n  if (!token) return null;\n  const secret = getEnv(\"VAULT_SIGNING_SECRET\");\n  const parts = token.split(\".\");\n  if (parts.length !== 2) return null;\n  const [payloadB64, sig] = parts;\n  const expectedSig = hashSecret(payloadB64, secret);\n  if (!safeEqual(sig, expectedSig)) return null;\n  try {\n    const payloadStr = fromBase64Url(payloadB64).toString(\"utf8\");\n    const payload = JSON.parse(payloadStr) as VaultSessionPayload;\n    if (payload.sub !== \"vault\") return null;\n    if (typeof payload.exp !== \"number\" || Date.now() > payload.exp) return null;\n    return payload;\n  } catch {\n    return null;\n  }\n}\n\nexport function getVaultCookieName() {\n  return COOKIE_NAME;\n}\n\n// Node crypto import\nimport crypto from \"crypto\";\n"],"names":[],"mappings":"uIAEO,IAAM,EAAkB,CAAA,EAAA,AAD/B,EAAA,CAAA,CAAA,OAC+B,uBAAA,AAAuB,EAClD,WAAa,MAAM,AAAI,MAAM,4OAA8O,EAC3Q,yEACA,2EAHG,IAAM,EAAkB,CAAA,EAAA,AAD/B,EAAA,CAAA,CAAA,OAC+B,uBAAA,AAAuB,EAClD,WAAa,MAAM,AAAI,MAAM,4OAA8O,EAC3Q,qDACA,2HCLJ,EAAA,EAAA,CAAA,CAAA,QCqEA,EAAA,EAAA,CAAA,CAAA,QDlEA,EAAA,EAAA,CAAA,CAAA,QAEe,eAAe,EAAY,UAAE,CAAQ,CAAiC,EACnF,IAAM,EAAc,MAAM,CAAA,EAAA,EAAA,OAAA,AAAO,UAIjC,AAAI,CAAC,ACmCA,ADrCW,SAEF,ACmCA,AAAc,CAAyB,IDrCvB,ECKX,KAA0B,OAiC7C,GAAI,CAAC,EAAO,OAAO,KACnB,IAAM,EAAS,AAxCjB,SAAS,AAAO,CAAY,EAC1B,IAAM,EAAQ,QAAQ,GAAG,CAAC,EAAK,CAC/B,GAAI,CAAC,EAAO,MAAM,AAAI,MAAM,CAAA,EAAG,EAAK,WAAW,CAAC,EAChD,OAAO,CACT,EAoCwB,wBAChB,EAAQ,EAAM,KAAK,CAAC,KAC1B,GAAqB,IAAjB,EAAM,MAAM,CAAQ,OAAO,KAC/B,GAAM,CAAC,EAAY,EAAI,CAAG,EACpB,GAjBN,CADM,EAAI,EAAA,MAkBU,CAlBJ,CAAC,UAAU,CAAC,SAkBe,CAlBL,GACpC,MAAM,CAAC,AAiBsB,GApCxB,CADsB,UAAjB,OAAO,EAqBA,EAAE,MAAM,IArBa,OAAO,IAAI,CAAC,EAAO,QAAU,OAAO,IAAI,CAAC,EAAA,EACtE,QAAQ,CAAC,UAAU,OAAO,CAAC,KAAM,IAAI,OAAO,CAAC,MAAO,KAAK,OAAO,CAAC,MAAO,MAqCnF,GA1BM,CA0BF,CAAC,AA1BM,OAAO,IAAI,CAAC,AA0BR,GAzBT,EAAK,OAAO,IAAI,CAAC,AAyBH,KAxBpB,AAAI,EAAG,MAAM,GAAK,EAAG,MAAM,EACpB,AADsB,EACtB,KAD6B,EACvB,CAAC,eAAe,CAAC,EAAI,EADE,EAwBF,OAAO,KACzC,GAAI,SACI,EAAa,CAnCf,EAAM,GAAK,CAAD,CAAO,MAAM,CAAG,IAAK,CAAC,CAChC,EAAa,AAkCgB,EAlCV,OAAO,CAAC,KAAM,KAAK,OAAO,CAAC,KAAM,KAAO,IAAI,MAAM,CAAC,GACrE,OAAO,IAAI,CAAC,EAAY,WAiCgB,QAAQ,CAAC,QAChD,EAAU,KAAK,KAAK,CAAC,GAC3B,GAAoB,UAAhB,EAAQ,GAAG,EACY,UAAvB,OAAO,EAAQ,GAAG,EAAiB,KAAK,GAAG,GAAK,EAAQ,GAAG,CADlC,CACoC,MAD7B,CACoC,IACxE,OAAO,CACT,CAAE,KAAM,CACN,OAAO,IACT,CACF,EDvDgB,EAAY,GAAG,CCFX,ADEY,kBAAuB,OAKjD,CAAA,EAAA,EAAA,IAAA,EAAC,UAAA,CAAQ,UAAU,6CACjB,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,mCAA0B,UACxC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,8BAAqB,wCAClC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,CAAA,MAKf,CAAA,EAAA,EAAA,GAAA,EAAA,EAAA,QAAA,CAAA,UAAG,GACZ","ignoreList":[0]}