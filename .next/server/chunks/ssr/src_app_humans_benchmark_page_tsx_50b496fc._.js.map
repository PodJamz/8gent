{"version":3,"sources":["../../../../src/app/humans/benchmark/page.tsx","../../../../src/lib/humans/guardrails.ts","../../../../src/lib/humans/search-provider.ts"],"sourcesContent":["'use client';\n\nimport { useState, useCallback } from 'react';\nimport { motion } from 'framer-motion';\nimport Link from 'next/link';\nimport {\n  FlaskConical,\n  Play,\n  StopCircle,\n  ChevronLeft,\n  CheckCircle2,\n  XCircle,\n  AlertTriangle,\n  BarChart3,\n  RefreshCw,\n} from 'lucide-react';\nimport { getSearchProvider, buildSearchQuery, processSearchResults } from '@/lib/humans/search-provider';\nimport type { SearchQuery, SearchResult } from '@/lib/humans/types';\n\n// ============================================================================\n// Sample Benchmark Queries (based on Exa simple-people-benchmark format)\n// ============================================================================\n\ninterface BenchmarkQuery {\n  id: string;\n  query: SearchQuery;\n  expectedRole: string;\n  expectedLocation?: string;\n  expectedSeniority?: string;\n}\n\nconst BENCHMARK_QUERIES: BenchmarkQuery[] = [\n  {\n    id: 'bq-001',\n    query: {\n      intent: 'hire',\n      role: 'Senior Software Engineer',\n      location: 'San Francisco',\n      seniority: 'senior',\n    },\n    expectedRole: 'software engineer',\n    expectedLocation: 'san francisco',\n    expectedSeniority: 'senior',\n  },\n  {\n    id: 'bq-002',\n    query: {\n      intent: 'expert',\n      role: 'Machine Learning Engineer',\n      location: 'New York',\n    },\n    expectedRole: 'machine learning',\n    expectedLocation: 'new york',\n  },\n  {\n    id: 'bq-003',\n    query: {\n      intent: 'founder_investor',\n      role: 'Startup Founder',\n      keywords: 'fintech',\n    },\n    expectedRole: 'founder',\n  },\n  {\n    id: 'bq-004',\n    query: {\n      intent: 'hire',\n      role: 'Product Manager',\n      location: 'Remote',\n      seniority: 'lead',\n    },\n    expectedRole: 'product manager',\n    expectedSeniority: 'lead',\n  },\n  {\n    id: 'bq-005',\n    query: {\n      intent: 'collaborator',\n      role: 'UX Designer',\n      location: 'Austin',\n    },\n    expectedRole: 'ux designer',\n    expectedLocation: 'austin',\n  },\n  {\n    id: 'bq-006',\n    query: {\n      intent: 'expert',\n      role: 'Data Scientist',\n      seniority: 'director',\n    },\n    expectedRole: 'data scientist',\n    expectedSeniority: 'director',\n  },\n  {\n    id: 'bq-007',\n    query: {\n      intent: 'hire',\n      role: 'Frontend Developer',\n      keywords: 'React TypeScript',\n    },\n    expectedRole: 'frontend',\n  },\n  {\n    id: 'bq-008',\n    query: {\n      intent: 'founder_investor',\n      role: 'Venture Capitalist',\n      location: 'Boston',\n    },\n    expectedRole: 'venture',\n    expectedLocation: 'boston',\n  },\n  {\n    id: 'bq-009',\n    query: {\n      intent: 'expert',\n      role: 'Security Engineer',\n      seniority: 'senior',\n    },\n    expectedRole: 'security',\n    expectedSeniority: 'senior',\n  },\n  {\n    id: 'bq-010',\n    query: {\n      intent: 'hire',\n      role: 'DevOps Engineer',\n      location: 'Seattle',\n    },\n    expectedRole: 'devops',\n    expectedLocation: 'seattle',\n  },\n];\n\n// ============================================================================\n// Grading Functions\n// ============================================================================\n\ninterface GradeResult {\n  passed: boolean;\n  roleMatch: boolean;\n  locationMatch: boolean;\n  seniorityMatch: boolean;\n}\n\nfunction gradeResult(\n  result: SearchResult,\n  expected: BenchmarkQuery\n): GradeResult {\n  const searchText = `${result.name} ${result.title} ${result.company} ${result.snippet}`.toLowerCase();\n\n  const roleMatch = searchText.includes(expected.expectedRole.toLowerCase());\n\n  const locationMatch = !expected.expectedLocation ||\n    (result.location?.toLowerCase().includes(expected.expectedLocation.toLowerCase()) ?? false) ||\n    searchText.includes(expected.expectedLocation.toLowerCase());\n\n  const seniorityMatch = !expected.expectedSeniority ||\n    searchText.includes(expected.expectedSeniority.toLowerCase());\n\n  // Consider passed if role matches AND at least one other criteria matches (if specified)\n  const additionalCriteria = [locationMatch, seniorityMatch];\n  const relevantCriteria = additionalCriteria.filter((_, i) =>\n    i === 0 ? !!expected.expectedLocation : !!expected.expectedSeniority\n  );\n\n  const passed = roleMatch && (relevantCriteria.length === 0 || relevantCriteria.some(c => c));\n\n  return { passed, roleMatch, locationMatch, seniorityMatch };\n}\n\n// ============================================================================\n// Types\n// ============================================================================\n\ninterface BenchmarkResult {\n  queryId: string;\n  results: SearchResult[];\n  grades: GradeResult[];\n  recallAt1: number;\n  recallAt10: number;\n  precision: number;\n  duration: number;\n}\n\ninterface BenchmarkSummary {\n  totalQueries: number;\n  completedQueries: number;\n  avgRecallAt1: number;\n  avgRecallAt10: number;\n  avgPrecision: number;\n  avgDuration: number;\n}\n\n// ============================================================================\n// Dev Check\n// ============================================================================\n\nconst isDev = process.env.NODE_ENV === 'development';\n\n// ============================================================================\n// Main Component\n// ============================================================================\n\nexport default function BenchmarkPage() {\n  const [isRunning, setIsRunning] = useState(false);\n  const [currentQuery, setCurrentQuery] = useState<number>(0);\n  const [results, setResults] = useState<BenchmarkResult[]>([]);\n  const [summary, setSummary] = useState<BenchmarkSummary | null>(null);\n\n  const runBenchmark = useCallback(async () => {\n    setIsRunning(true);\n    setResults([]);\n    setSummary(null);\n\n    const provider = getSearchProvider('mock'); // Use mock provider for benchmark\n    const benchmarkResults: BenchmarkResult[] = [];\n\n    for (let i = 0; i < BENCHMARK_QUERIES.length; i++) {\n      setCurrentQuery(i);\n      const benchmark = BENCHMARK_QUERIES[i];\n\n      const startTime = Date.now();\n\n      try {\n        const searchString = buildSearchQuery(benchmark.query);\n        const rawResults = await provider.search(searchString, {\n          category: 'people',\n          includeText: true,\n          numResults: 10,\n        });\n\n        const processedResults = processSearchResults(rawResults, benchmark.query);\n        const duration = Date.now() - startTime;\n\n        // Grade each result\n        const grades = processedResults.map(r => gradeResult(r, benchmark));\n\n        // Calculate metrics\n        const passedCount = grades.filter(g => g.passed).length;\n        const recallAt1 = grades.length > 0 && grades[0].passed ? 1 : 0;\n        const recallAt10 = passedCount > 0 ? 1 : 0;\n        const precision = processedResults.length > 0 ? passedCount / processedResults.length : 0;\n\n        const result: BenchmarkResult = {\n          queryId: benchmark.id,\n          results: processedResults,\n          grades,\n          recallAt1,\n          recallAt10,\n          precision,\n          duration,\n        };\n\n        benchmarkResults.push(result);\n        setResults([...benchmarkResults]);\n      } catch (error) {\n        console.error(`Benchmark query ${benchmark.id} failed:`, error);\n      }\n\n      // Small delay between queries\n      await new Promise(resolve => setTimeout(resolve, 100));\n    }\n\n    // Calculate summary\n    const avgRecallAt1 = benchmarkResults.reduce((sum, r) => sum + r.recallAt1, 0) / benchmarkResults.length;\n    const avgRecallAt10 = benchmarkResults.reduce((sum, r) => sum + r.recallAt10, 0) / benchmarkResults.length;\n    const avgPrecision = benchmarkResults.reduce((sum, r) => sum + r.precision, 0) / benchmarkResults.length;\n    const avgDuration = benchmarkResults.reduce((sum, r) => sum + r.duration, 0) / benchmarkResults.length;\n\n    setSummary({\n      totalQueries: BENCHMARK_QUERIES.length,\n      completedQueries: benchmarkResults.length,\n      avgRecallAt1,\n      avgRecallAt10,\n      avgPrecision,\n      avgDuration,\n    });\n\n    setIsRunning(false);\n  }, []);\n\n  const reset = () => {\n    setResults([]);\n    setSummary(null);\n    setCurrentQuery(0);\n  };\n\n  // Show dev-only warning if not in development\n  if (!isDev) {\n    return (\n      <main className=\"min-h-screen bg-slate-950 text-white flex items-center justify-center p-4\">\n        <div className=\"text-center\">\n          <AlertTriangle className=\"w-12 h-12 text-amber-400 mx-auto mb-4\" />\n          <h1 className=\"text-xl font-bold mb-2\">Development Only</h1>\n          <p className=\"text-white/50 mb-4\">The benchmark harness is only available in development mode.</p>\n          <Link\n            href=\"/humans\"\n            className=\"text-sky-400 hover:text-sky-300 text-sm\"\n          >\n            Return to Humans\n          </Link>\n        </div>\n      </main>\n    );\n  }\n\n  return (\n    <main className=\"min-h-screen bg-slate-950 text-white\">\n      {/* Header */}\n      <header className=\"px-4 py-4 border-b border-white/10\">\n        <div className=\"max-w-4xl mx-auto flex items-center justify-between\">\n          <Link\n            href=\"/humans\"\n            className=\"flex items-center gap-2 text-white/50 hover:text-white/70 transition-colors\"\n          >\n            <ChevronLeft className=\"w-5 h-5\" />\n            <span className=\"text-sm\">Back to Humans</span>\n          </Link>\n\n          <div className=\"flex items-center gap-2\">\n            <FlaskConical className=\"w-5 h-5 text-amber-400\" />\n            <span className=\"font-semibold\">Benchmark Harness</span>\n            <span className=\"px-2 py-0.5 rounded-full bg-amber-500/20 text-amber-400 text-xs font-medium\">\n              DEV ONLY\n            </span>\n          </div>\n\n          <div className=\"w-24\" />\n        </div>\n      </header>\n\n      {/* Content */}\n      <div className=\"max-w-4xl mx-auto px-4 py-8\">\n        {/* Controls */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div>\n            <h1 className=\"text-2xl font-bold mb-1\">People Search Benchmark</h1>\n            <p className=\"text-white/50 text-sm\">\n              Test search quality against {BENCHMARK_QUERIES.length} synthetic queries\n            </p>\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            {results.length > 0 && !isRunning && (\n              <button\n                onClick={reset}\n                className=\"px-4 py-2 rounded-lg bg-white/10 text-white/70 text-sm font-medium flex items-center gap-2 hover:bg-white/20 transition-all\"\n              >\n                <RefreshCw className=\"w-4 h-4\" />\n                Reset\n              </button>\n            )}\n\n            <button\n              onClick={runBenchmark}\n              disabled={isRunning}\n              className={`px-4 py-2 rounded-lg font-medium text-sm flex items-center gap-2 transition-all ${\n                isRunning\n                  ? 'bg-rose-500/20 text-rose-400'\n                  : 'bg-sky-500 text-white hover:bg-sky-600'\n              }`}\n            >\n              {isRunning ? (\n                <>\n                  <StopCircle className=\"w-4 h-4\" />\n                  Running... ({currentQuery + 1}/{BENCHMARK_QUERIES.length})\n                </>\n              ) : (\n                <>\n                  <Play className=\"w-4 h-4\" />\n                  Run Benchmark\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n\n        {/* Summary */}\n        {summary && (\n          <motion.div\n            initial={{ opacity: 0, y: -10 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"grid grid-cols-4 gap-4 mb-8\"\n          >\n            <div className=\"p-4 rounded-xl bg-white/5 border border-white/10\">\n              <div className=\"flex items-center gap-2 text-white/50 text-xs mb-2\">\n                <BarChart3 className=\"w-4 h-4\" />\n                Recall@1\n              </div>\n              <div className=\"text-2xl font-bold text-emerald-400\">\n                {(summary.avgRecallAt1 * 100).toFixed(1)}%\n              </div>\n            </div>\n\n            <div className=\"p-4 rounded-xl bg-white/5 border border-white/10\">\n              <div className=\"flex items-center gap-2 text-white/50 text-xs mb-2\">\n                <BarChart3 className=\"w-4 h-4\" />\n                Recall@10\n              </div>\n              <div className=\"text-2xl font-bold text-sky-400\">\n                {(summary.avgRecallAt10 * 100).toFixed(1)}%\n              </div>\n            </div>\n\n            <div className=\"p-4 rounded-xl bg-white/5 border border-white/10\">\n              <div className=\"flex items-center gap-2 text-white/50 text-xs mb-2\">\n                <BarChart3 className=\"w-4 h-4\" />\n                Precision\n              </div>\n              <div className=\"text-2xl font-bold text-violet-400\">\n                {(summary.avgPrecision * 100).toFixed(1)}%\n              </div>\n            </div>\n\n            <div className=\"p-4 rounded-xl bg-white/5 border border-white/10\">\n              <div className=\"flex items-center gap-2 text-white/50 text-xs mb-2\">\n                <BarChart3 className=\"w-4 h-4\" />\n                Avg Duration\n              </div>\n              <div className=\"text-2xl font-bold text-amber-400\">\n                {summary.avgDuration.toFixed(0)}ms\n              </div>\n            </div>\n          </motion.div>\n        )}\n\n        {/* Results Table */}\n        {results.length > 0 && (\n          <div className=\"rounded-xl bg-white/[0.02] border border-white/10 overflow-hidden\">\n            <div className=\"px-4 py-3 border-b border-white/10 bg-white/[0.02]\">\n              <h2 className=\"font-semibold text-sm\">Query Results</h2>\n            </div>\n\n            <div className=\"divide-y divide-white/5\">\n              {results.map((result, i) => {\n                const benchmark = BENCHMARK_QUERIES.find(q => q.id === result.queryId);\n                const passedCount = result.grades.filter(g => g.passed).length;\n\n                return (\n                  <div key={result.queryId} className=\"px-4 py-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          {result.recallAt10 > 0 ? (\n                            <CheckCircle2 className=\"w-4 h-4 text-emerald-400\" />\n                          ) : (\n                            <XCircle className=\"w-4 h-4 text-rose-400\" />\n                          )}\n                          <span className=\"font-medium text-sm text-white\">\n                            {benchmark?.query.role}\n                          </span>\n                          {benchmark?.query.location && (\n                            <span className=\"text-white/40 text-xs\">\n                              in {benchmark.query.location}\n                            </span>\n                          )}\n                        </div>\n                        <div className=\"text-xs text-white/40\">\n                          {passedCount}/{result.results.length} matches passed • {result.duration}ms\n                        </div>\n                      </div>\n\n                      <div className=\"flex items-center gap-4 text-xs\">\n                        <div>\n                          <span className=\"text-white/40\">R@1: </span>\n                          <span className={result.recallAt1 > 0 ? 'text-emerald-400' : 'text-rose-400'}>\n                            {result.recallAt1 > 0 ? 'Pass' : 'Fail'}\n                          </span>\n                        </div>\n                        <div>\n                          <span className=\"text-white/40\">P: </span>\n                          <span className=\"text-white\">{(result.precision * 100).toFixed(0)}%</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        )}\n\n        {/* Empty State */}\n        {results.length === 0 && !isRunning && (\n          <div className=\"text-center py-16\">\n            <FlaskConical className=\"w-12 h-12 text-white/10 mx-auto mb-4\" />\n            <p className=\"text-white/40 text-sm mb-2\">No benchmark results yet</p>\n            <p className=\"text-white/25 text-xs\">\n              Click \"Run Benchmark\" to test search quality\n            </p>\n          </div>\n        )}\n      </div>\n    </main>\n  );\n}\n","// Humans App Guardrails\n// Responsible use detection and filtering\n\nimport type { GuardrailResult, GuardrailViolation, SearchResult } from './types';\n\n// Re-export types used by consumers\nexport type { GuardrailResult, GuardrailViolation } from './types';\n\n// ============================================================================\n// Query Risk Detection\n// ============================================================================\n\nconst RISKY_PATTERNS = {\n  home_address: [\n    /where\\s+(does|do)\\s+\\w+\\s+live/i,\n    /home\\s+address/i,\n    /residential\\s+address/i,\n    /find\\s+where\\s+\\w+\\s+lives/i,\n    /their\\s+house/i,\n    /their\\s+home/i,\n    /what\\s+street/i,\n    /apartment\\s+number/i,\n  ],\n  private_phone: [\n    /personal\\s+phone/i,\n    /cell\\s+(phone\\s+)?number/i,\n    /mobile\\s+number/i,\n    /private\\s+number/i,\n    /phone\\s+number\\s+of/i,\n    /call\\s+\\w+\\s+directly/i,\n  ],\n  personal_email: [\n    /personal\\s+email/i,\n    /private\\s+email/i,\n    /gmail\\s+address/i,\n    /non.?work\\s+email/i,\n  ],\n  stalking_intent: [\n    /track\\s+\\w+/i,\n    /follow\\s+\\w+/i,\n    /spy\\s+on/i,\n    /watch\\s+\\w+/i,\n    /monitor\\s+\\w+/i,\n    /keep\\s+tabs/i,\n    /find\\s+out\\s+everything/i,\n    /locate\\s+\\w+\\s+without/i,\n  ],\n  surveillance: [\n    /daily\\s+routine/i,\n    /schedule\\s+of/i,\n    /when\\s+(does|do)\\s+\\w+\\s+(leave|arrive)/i,\n    /whereabouts/i,\n    /movements/i,\n    /track\\s+location/i,\n  ],\n  private_individual: [\n    /ex.?(girlfriend|boyfriend|wife|husband|partner)/i,\n    /my\\s+neighbor/i,\n    /someone\\s+who\\s+blocked\\s+me/i,\n    /find\\s+my\\s+birth/i,\n    /family\\s+member/i,\n    /estranged/i,\n  ],\n};\n\nconst SAFE_ALTERNATIVE_MAP: Record<GuardrailViolation, string> = {\n  home_address: 'Search for their public professional profile or work location instead.',\n  private_phone: 'Search for their public work contact or company contact page.',\n  personal_email: 'Search for their professional work email through their company.',\n  stalking_intent: 'Search for their public professional profile on LinkedIn or similar platforms.',\n  surveillance: 'Search for their public work information or professional background.',\n  private_individual: 'For professional networking, search for public work profiles only.',\n};\n\n/**\n * Check a search query for potential misuse patterns\n */\nexport function checkQuerySafety(query: string): GuardrailResult {\n  const violations: GuardrailViolation[] = [];\n\n  for (const [violationType, patterns] of Object.entries(RISKY_PATTERNS)) {\n    for (const pattern of patterns) {\n      if (pattern.test(query)) {\n        violations.push(violationType as GuardrailViolation);\n        break; // Only add each violation type once\n      }\n    }\n  }\n\n  if (violations.length === 0) {\n    return { safe: true, violations: [] };\n  }\n\n  // Get the primary violation for the message\n  const primaryViolation = violations[0];\n  const safeAlternative = SAFE_ALTERNATIVE_MAP[primaryViolation];\n\n  const messages: Record<GuardrailViolation, string> = {\n    home_address: 'Humans cannot search for private residential information.',\n    private_phone: 'Humans cannot search for private phone numbers.',\n    personal_email: 'Humans cannot search for personal email addresses.',\n    stalking_intent: 'This search pattern suggests concerning intent. Humans is for professional networking only.',\n    surveillance: 'Humans cannot be used to track or monitor individuals.',\n    private_individual: 'Humans is designed for professional searches, not personal relationships.',\n  };\n\n  return {\n    safe: false,\n    violations,\n    message: messages[primaryViolation],\n    safeAlternative,\n  };\n}\n\n// ============================================================================\n// Result Filtering\n// ============================================================================\n\nconst SENSITIVE_DATA_PATTERNS = {\n  phone: [\n    /\\b\\d{3}[-.\\s]?\\d{3}[-.\\s]?\\d{4}\\b/, // US phone\n    /\\b\\+\\d{1,3}[-.\\s]?\\d{3,4}[-.\\s]?\\d{3,4}[-.\\s]?\\d{3,4}\\b/, // International\n  ],\n  personalEmail: [\n    /@gmail\\.com/i,\n    /@yahoo\\.com/i,\n    /@hotmail\\.com/i,\n    /@outlook\\.com/i,\n    /@icloud\\.com/i,\n    /@aol\\.com/i,\n    /@protonmail\\.com/i,\n  ],\n  address: [\n    /\\b\\d+\\s+\\w+\\s+(street|st|avenue|ave|road|rd|drive|dr|lane|ln|court|ct|way|place|pl)\\b/i,\n    /\\bapt\\.?\\s*#?\\s*\\d+/i,\n    /\\bunit\\s*#?\\s*\\d+/i,\n  ],\n  ssn: [\n    /\\b\\d{3}[-.\\s]?\\d{2}[-.\\s]?\\d{4}\\b/, // SSN pattern\n  ],\n};\n\n/**\n * Filter sensitive information from a text snippet\n */\nexport function filterSensitiveData(text: string): string {\n  let filtered = text;\n\n  // Replace phone numbers\n  for (const pattern of SENSITIVE_DATA_PATTERNS.phone) {\n    filtered = filtered.replace(pattern, '[phone redacted]');\n  }\n\n  // Replace personal email addresses (but keep work emails)\n  for (const pattern of SENSITIVE_DATA_PATTERNS.personalEmail) {\n    filtered = filtered.replace(\n      new RegExp(`[a-zA-Z0-9._%+-]+${pattern.source}`, 'gi'),\n      '[personal email redacted]'\n    );\n  }\n\n  // Replace potential addresses\n  for (const pattern of SENSITIVE_DATA_PATTERNS.address) {\n    filtered = filtered.replace(pattern, '[address redacted]');\n  }\n\n  // Replace SSN-like patterns\n  for (const pattern of SENSITIVE_DATA_PATTERNS.ssn) {\n    filtered = filtered.replace(pattern, '[redacted]');\n  }\n\n  return filtered;\n}\n\n/**\n * Check if a URL is from a professional/work context\n */\nexport function isProfessionalSource(url: string): boolean {\n  const professionalDomains = [\n    'linkedin.com',\n    'github.com',\n    'twitter.com',\n    'x.com',\n    'medium.com',\n    'dev.to',\n    'stackoverflow.com',\n    'behance.net',\n    'dribbble.com',\n    'angel.co',\n    'wellfound.com',\n    'crunchbase.com',\n    'about.me',\n    'substack.com',\n    'youtube.com',\n    'speakerdeck.com',\n    'slideshare.net',\n  ];\n\n  try {\n    const hostname = new URL(url).hostname.toLowerCase();\n    return professionalDomains.some(domain =>\n      hostname === domain || hostname.endsWith(`.${domain}`)\n    );\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Filter and clean search results\n */\nexport function sanitizeSearchResults(results: SearchResult[]): SearchResult[] {\n  return results.map(result => ({\n    ...result,\n    snippet: filterSensitiveData(result.snippet),\n    // Prioritize professional sources\n    confidence: isProfessionalSource(result.sourceUrl)\n      ? result.confidence\n      : (result.confidence === 'high' ? 'medium' : result.confidence),\n  }));\n}\n\n// ============================================================================\n// Export Safety Warning\n// ============================================================================\n\nexport const RESPONSIBLE_USE_NOTE = `Humans searches public professional information only.\nUse responsibly for legitimate purposes like recruiting, collaboration, and networking.`;\n\nexport const RESPONSIBLE_USE_SHORT = 'For professional networking only. No private data.';\n","// Humans App Search Provider\n// Abstraction layer for people search APIs\n\nimport type {\n  SearchProvider,\n  SearchProviderOptions,\n  SearchProviderResult,\n  SearchQuery,\n  SearchResult,\n  MatchConfidence,\n  MatchEvidence,\n  SocialLinks,\n} from './types';\nimport { filterSensitiveData, isProfessionalSource } from './guardrails';\n\n// ============================================================================\n// Mock Data for Development\n// ============================================================================\n\n// Extended mock data with rich social links - better than LinkedIn recruiting tools\ninterface MockPerson extends SearchProviderResult {\n  socialLinks: SocialLinks;\n}\n\nconst MOCK_PEOPLE: MockPerson[] = [\n  {\n    id: 'mock-1',\n    url: 'https://linkedin.com/in/sarah-chen-engineering',\n    title: 'Sarah Chen - Senior Software Engineer at Stripe',\n    snippet: 'Senior Software Engineer specializing in distributed systems and payment infrastructure. Previously at Google. Stanford CS. Based in San Francisco Bay Area. Contact: sarah.chen@stripe.com',\n    author: 'Sarah Chen',\n    socialLinks: {\n      linkedin: 'https://linkedin.com/in/sarah-chen-engineering',\n      x: 'sarahchendev',\n      github: 'https://github.com/sarahchen',\n      email: 'sarah.chen@stripe.com',\n    },\n  },\n  {\n    id: 'mock-2',\n    url: 'https://github.com/alexmartinez',\n    title: 'Alex Martinez - Full Stack Developer',\n    snippet: 'Full stack developer focused on React and Node.js. Building developer tools and open source projects. Currently leading engineering at a Series A startup in NYC. @alexmartinezdev on X.',\n    author: 'Alex Martinez',\n    socialLinks: {\n      linkedin: 'https://linkedin.com/in/alexmartinez-dev',\n      x: 'alexmartinezdev',\n      github: 'https://github.com/alexmartinez',\n      website: 'https://alexmartinez.dev',\n    },\n  },\n  {\n    id: 'mock-3',\n    url: 'https://linkedin.com/in/priya-patel-pm',\n    title: 'Priya Patel - Director of Product at Notion',\n    snippet: 'Director of Product at Notion. 10+ years in product management. Former PM at Slack and Microsoft. Stanford MBA. Passionate about productivity tools. priya@notion.so',\n    author: 'Priya Patel',\n    socialLinks: {\n      linkedin: 'https://linkedin.com/in/priya-patel-pm',\n      x: 'priyabuilds',\n      email: 'priya@notion.so',\n    },\n  },\n  {\n    id: 'mock-4',\n    url: 'https://twitter.com/markjohnson_vc',\n    title: 'Mark Johnson - Partner at Sequoia',\n    snippet: 'General Partner at Sequoia Capital. Investing in early-stage B2B SaaS. Board member at several unicorns. Previously founded two successful startups. DMs open @markjohnson_vc',\n    author: 'Mark Johnson',\n    socialLinks: {\n      linkedin: 'https://linkedin.com/in/markjohnson-sequoia',\n      x: 'markjohnson_vc',\n      email: 'mark@sequoiacap.com',\n      website: 'https://sequoiacap.com/people/mark-johnson',\n    },\n  },\n  {\n    id: 'mock-5',\n    url: 'https://linkedin.com/in/emily-wong-design',\n    title: 'Emily Wong - Head of Design at Figma',\n    snippet: 'Head of Design at Figma. Previously led design teams at Airbnb and Facebook. RISD graduate. Speaker at Config and design conferences worldwide. emily@figma.com',\n    author: 'Emily Wong',\n    socialLinks: {\n      linkedin: 'https://linkedin.com/in/emily-wong-design',\n      x: 'emilywongdesign',\n      email: 'emily@figma.com',\n      website: 'https://emilywong.design',\n    },\n  },\n  {\n    id: 'mock-6',\n    url: 'https://substack.com/@davidkim',\n    title: 'David Kim - AI Researcher and Writer',\n    snippet: 'AI researcher at OpenAI. PhD from MIT. Writing about machine learning, AI safety, and the future of work. Advisor to multiple AI startups. david.kim@openai.com',\n    author: 'David Kim',\n    socialLinks: {\n      linkedin: 'https://linkedin.com/in/davidkim-ai',\n      x: 'davidkimai',\n      github: 'https://github.com/davidkim-ml',\n      email: 'david.kim@openai.com',\n      website: 'https://davidkim.substack.com',\n    },\n  },\n  {\n    id: 'mock-7',\n    url: 'https://linkedin.com/in/rachel-green-sales',\n    title: 'Rachel Green - VP of Sales at HubSpot',\n    snippet: 'VP of Sales at HubSpot. 15 years in B2B sales leadership. Built sales teams from 5 to 500+. Expert in sales methodology and go-to-market strategy. rgreen@hubspot.com',\n    author: 'Rachel Green',\n    socialLinks: {\n      linkedin: 'https://linkedin.com/in/rachel-green-sales',\n      x: 'rachelgreensales',\n      email: 'rgreen@hubspot.com',\n    },\n  },\n  {\n    id: 'mock-8',\n    url: 'https://angel.co/u/james-lee-founder',\n    title: 'Angel Investor - Serial Entrepreneur & Angel Investor',\n    snippet: 'Serial entrepreneur with 3 exits. Angel investor in 50+ startups. YC alum. Currently building in the climate tech space. Based in Austin, TX. @jameslee_vc',\n    author: 'Angel Investor',\n    socialLinks: {\n      linkedin: 'https://linkedin.com/in/jameslee-founder',\n      x: 'jameslee_vc',\n      email: 'james@jameslee.vc',\n      website: 'https://jameslee.vc',\n    },\n  },\n  {\n    id: 'mock-9',\n    url: 'https://linkedin.com/in/maria-garcia-recruiter',\n    title: 'Maria Garcia - Head of Talent at Stripe',\n    snippet: 'Head of Talent Acquisition at Stripe. Previously built recruiting teams at Airbnb, Uber, and Google. Expert in scaling engineering orgs. maria.garcia@stripe.com',\n    author: 'Maria Garcia',\n    socialLinks: {\n      linkedin: 'https://linkedin.com/in/maria-garcia-recruiter',\n      x: 'mariagarciaTA',\n      email: 'maria.garcia@stripe.com',\n    },\n  },\n  {\n    id: 'mock-10',\n    url: 'https://linkedin.com/in/tom-wilson-cto',\n    title: 'Tom Wilson - CTO at Figma',\n    snippet: 'CTO at Figma. Previously VP Engineering at Dropbox. 20+ years building consumer and enterprise products. Stanford CS PhD. tom@figma.com',\n    author: 'Tom Wilson',\n    socialLinks: {\n      linkedin: 'https://linkedin.com/in/tom-wilson-cto',\n      x: 'tomwilsoncto',\n      github: 'https://github.com/tomwilson',\n      email: 'tom@figma.com',\n    },\n  },\n];\n\n// ============================================================================\n// Mock Search Provider (for development)\n// ============================================================================\n\nfunction createMockProvider(): SearchProvider {\n  return {\n    name: 'Mock',\n    available: true,\n    search: async (query: string, options?: SearchProviderOptions): Promise<SearchProviderResult[]> => {\n      // Simulate network delay\n      await new Promise(resolve => setTimeout(resolve, 800 + Math.random() * 400));\n\n      const queryLower = query.toLowerCase();\n\n      // Filter mock data based on query\n      const results = MOCK_PEOPLE.filter(person => {\n        const searchText = `${person.title} ${person.snippet}`.toLowerCase();\n        const queryWords = queryLower.split(/\\s+/);\n        return queryWords.some(word => searchText.includes(word));\n      });\n\n      // Return shuffled subset to simulate different results\n      const shuffled = results.sort(() => Math.random() - 0.5);\n      const numResults = options?.numResults || 10;\n      return shuffled.slice(0, numResults);\n    },\n  };\n}\n\n// ============================================================================\n// Exa Search Provider (via API route to avoid CORS)\n// ============================================================================\n\nfunction createExaProvider(): SearchProvider {\n  return {\n    name: 'Exa',\n    available: true, // Always available, API route handles fallback\n    search: async (query: string, options?: SearchProviderOptions): Promise<SearchProviderResult[]> => {\n      try {\n        const response = await fetch('/api/humans/search', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            query,\n            numResults: options?.numResults || 10,\n          }),\n        });\n\n        if (!response.ok) {\n          console.warn('Search API error, falling back to mock data');\n          return [];\n        }\n\n        const data = await response.json();\n\n        // If API tells us to use mock, return empty to trigger fallback\n        if (data.useMock) {\n          console.info('Using mock data:', data.message);\n          return [];\n        }\n\n        return data.results;\n      } catch (error) {\n        console.warn('Search API failed, falling back to mock data:', error);\n        return [];\n      }\n    },\n  };\n}\n\n// ============================================================================\n// Provider Factory\n// ============================================================================\n\nexport function getSearchProvider(preferredProvider?: 'exa' | 'mock'): SearchProvider {\n  // If mock is explicitly preferred, return mock\n  if (preferredProvider === 'mock') {\n    return createMockProvider();\n  }\n\n  // Create a combined provider that tries Exa first, then falls back to mock\n  const exaProvider = createExaProvider();\n  const mockProvider = createMockProvider();\n\n  return {\n    name: 'Combined',\n    available: true,\n    search: async (query: string, options?: SearchProviderOptions): Promise<SearchProviderResult[]> => {\n      // Try Exa first\n      const exaResults = await exaProvider.search(query, options);\n\n      // If we got results from Exa, use them\n      if (exaResults.length > 0) {\n        return exaResults;\n      }\n\n      // Otherwise fall back to mock data\n      console.info('Using mock data for search results');\n      return mockProvider.search(query, options);\n    },\n  };\n}\n\n// ============================================================================\n// Search Query Builder\n// ============================================================================\n\nexport function buildSearchQuery(query: SearchQuery): string {\n  const parts: string[] = [];\n\n  if (query.personName) {\n    parts.push(`\"${query.personName}\"`);\n  }\n\n  if (query.role) {\n    parts.push(query.role);\n  }\n\n  if (query.seniority && query.seniority !== 'any') {\n    const seniorityTerms: Record<string, string> = {\n      entry: 'junior OR entry-level',\n      mid: '',\n      senior: 'senior',\n      lead: 'lead OR principal OR staff',\n      director: 'director',\n      vp: 'VP OR vice president',\n      c_level: 'CEO OR CTO OR CFO OR COO OR chief',\n    };\n    if (seniorityTerms[query.seniority]) {\n      parts.push(seniorityTerms[query.seniority]);\n    }\n  }\n\n  if (query.location) {\n    parts.push(`${query.location}`);\n  }\n\n  if (query.keywords) {\n    parts.push(query.keywords);\n  }\n\n  return parts.filter(Boolean).join(' ');\n}\n\n// ============================================================================\n// Result Processor\n// ============================================================================\n\nexport function processSearchResults(\n  results: SearchProviderResult[],\n  query: SearchQuery\n): SearchResult[] {\n  return results.map((result, index) => {\n    // Extract name from title or author\n    const name = extractName(result.title, result.author);\n\n    // Extract title and company\n    const { title, company } = extractTitleAndCompany(result.title, result.snippet);\n\n    // Extract location\n    const location = extractLocation(result.snippet);\n\n    // Calculate confidence\n    const confidence = calculateConfidence(result, query);\n\n    // Build evidence\n    const evidence = buildEvidence(result, query);\n\n    // Extract social links - key differentiator from LinkedIn\n    const socialLinks = extractSocialLinks(result);\n\n    return {\n      id: result.id || `result-${index}`,\n      name,\n      title,\n      company,\n      location,\n      snippet: filterSensitiveData(result.snippet.slice(0, 300)),\n      sourceUrl: result.url,\n      sourceDomain: extractDomain(result.url),\n      confidence,\n      evidence,\n      socialLinks,\n    };\n  });\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nfunction extractName(title: string, author?: string): string {\n  if (author) return author;\n\n  // Try to extract name from patterns like \"John Doe - Title at Company\"\n  const dashPattern = title.match(/^([^-]+)\\s*-/);\n  if (dashPattern) {\n    return dashPattern[1].trim();\n  }\n\n  // Try to extract from \"Name | Title\"\n  const pipePattern = title.match(/^([^|]+)\\s*\\|/);\n  if (pipePattern) {\n    return pipePattern[1].trim();\n  }\n\n  // Return first two capitalized words\n  const words = title.split(/\\s+/);\n  const nameWords = words.slice(0, 2).filter(w => /^[A-Z]/.test(w));\n  return nameWords.join(' ') || title.slice(0, 30);\n}\n\nfunction extractTitleAndCompany(\n  sourceTitle: string,\n  snippet: string\n): { title?: string; company?: string } {\n  // Pattern: \"Name - Title at Company\"\n  const atPattern = sourceTitle.match(/\\s+-\\s+(.+)\\s+at\\s+(.+)$/i);\n  if (atPattern) {\n    return { title: atPattern[1].trim(), company: atPattern[2].trim() };\n  }\n\n  // Pattern: \"Name | Title, Company\"\n  const commaPattern = sourceTitle.match(/\\s+[|–-]\\s+([^,]+),\\s*(.+)$/);\n  if (commaPattern) {\n    return { title: commaPattern[1].trim(), company: commaPattern[2].trim() };\n  }\n\n  // Try to find in snippet\n  const snippetAt = snippet.match(/(?:^|\\s)([\\w\\s]+)\\s+at\\s+([\\w\\s]+)(?:\\.|,|$)/i);\n  if (snippetAt) {\n    return { title: snippetAt[1].trim(), company: snippetAt[2].trim() };\n  }\n\n  return {};\n}\n\nfunction extractLocation(snippet: string): string | undefined {\n  const locationPatterns = [\n    /(?:based\\s+in|located\\s+in|from)\\s+([A-Z][a-zA-Z\\s,]+?)(?:\\.|,|$)/i,\n    /([A-Z][a-z]+(?:\\s+[A-Z][a-z]+)*,\\s*[A-Z]{2})/, // City, State\n    /(San Francisco|New York|NYC|Los Angeles|LA|Seattle|Austin|Boston|Chicago|London|Berlin|Singapore|Tokyo)/i,\n  ];\n\n  for (const pattern of locationPatterns) {\n    const match = snippet.match(pattern);\n    if (match) {\n      return match[1].trim();\n    }\n  }\n\n  return undefined;\n}\n\nfunction extractDomain(url: string): string {\n  try {\n    const hostname = new URL(url).hostname;\n    return hostname.replace(/^www\\./, '');\n  } catch {\n    return url;\n  }\n}\n\nfunction calculateConfidence(\n  result: SearchProviderResult,\n  query: SearchQuery\n): MatchConfidence {\n  let score = 0;\n  const searchText = `${result.title} ${result.snippet}`.toLowerCase();\n\n  // Role match\n  if (query.role && searchText.includes(query.role.toLowerCase())) {\n    score += 3;\n  }\n\n  // Location match\n  if (query.location && searchText.includes(query.location.toLowerCase())) {\n    score += 2;\n  }\n\n  // Keywords match\n  if (query.keywords) {\n    const keywords = query.keywords.toLowerCase().split(/\\s+/);\n    const matches = keywords.filter(kw => searchText.includes(kw));\n    score += matches.length;\n  }\n\n  // Professional source bonus\n  if (isProfessionalSource(result.url)) {\n    score += 1;\n  }\n\n  // Name match for specific person\n  if (query.personName) {\n    const nameLower = query.personName.toLowerCase();\n    if (searchText.includes(nameLower)) {\n      score += 4;\n    }\n  }\n\n  if (score >= 5) return 'high';\n  if (score >= 2) return 'medium';\n  return 'low';\n}\n\nfunction buildEvidence(\n  result: SearchProviderResult,\n  query: SearchQuery\n): MatchEvidence {\n  const evidence: MatchEvidence = {};\n  const searchText = `${result.title} ${result.snippet}`.toLowerCase();\n\n  if (query.role && searchText.includes(query.role.toLowerCase())) {\n    evidence.roleMatch = query.role;\n  }\n\n  if (query.location && searchText.includes(query.location.toLowerCase())) {\n    evidence.locationMatch = query.location;\n  }\n\n  if (query.seniority && query.seniority !== 'any') {\n    const seniorityTerms: Record<string, string[]> = {\n      entry: ['junior', 'entry'],\n      mid: ['mid'],\n      senior: ['senior'],\n      lead: ['lead', 'principal', 'staff'],\n      director: ['director'],\n      vp: ['vp', 'vice president'],\n      c_level: ['ceo', 'cto', 'cfo', 'coo', 'chief'],\n    };\n    const terms = seniorityTerms[query.seniority] || [];\n    if (terms.some(t => searchText.includes(t))) {\n      evidence.seniorityMatch = query.seniority;\n    }\n  }\n\n  if (query.keywords) {\n    const keywords = query.keywords.split(/\\s+/);\n    const matches = keywords.filter(kw =>\n      searchText.includes(kw.toLowerCase())\n    );\n    if (matches.length > 0) {\n      evidence.keywordMatches = matches;\n    }\n  }\n\n  // Add a relevant snippet excerpt\n  evidence.sourceSnippet = result.snippet.slice(0, 150);\n\n  return evidence;\n}\n\n// ============================================================================\n// Social Links Extraction - Key Value Differentiator\n// ============================================================================\n\nfunction extractSocialLinks(result: SearchProviderResult & { socialLinks?: SocialLinks }): SocialLinks {\n  // If mock data already has social links, use them\n  if (result.socialLinks) {\n    return result.socialLinks;\n  }\n\n  const socialLinks: SocialLinks = {};\n  const text = `${result.url} ${result.title} ${result.snippet}`;\n\n  // Extract LinkedIn\n  const linkedinMatch = text.match(/linkedin\\.com\\/in\\/([a-zA-Z0-9_-]+)/i);\n  if (linkedinMatch) {\n    socialLinks.linkedin = `https://linkedin.com/in/${linkedinMatch[1]}`;\n  }\n\n  // Extract X/Twitter handle\n  const xHandleMatch = text.match(/@([a-zA-Z0-9_]{1,15})(?:\\s|$|,|\\.)/);\n  if (xHandleMatch) {\n    socialLinks.x = xHandleMatch[1];\n  }\n  // Also check for twitter.com or x.com URLs\n  const xUrlMatch = text.match(/(?:twitter|x)\\.com\\/([a-zA-Z0-9_]+)/i);\n  if (xUrlMatch && !socialLinks.x) {\n    socialLinks.x = xUrlMatch[1];\n  }\n\n  // Extract GitHub\n  const githubMatch = text.match(/github\\.com\\/([a-zA-Z0-9_-]+)/i);\n  if (githubMatch) {\n    socialLinks.github = `https://github.com/${githubMatch[1]}`;\n  }\n\n  // Extract work email (avoid personal email domains)\n  const emailMatch = text.match(/([a-zA-Z0-9._%+-]+@(?!gmail|yahoo|hotmail|outlook|icloud|aol|protonmail)[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,})/i);\n  if (emailMatch) {\n    socialLinks.email = emailMatch[1].toLowerCase();\n  }\n\n  // Extract personal website\n  const websitePatterns = [\n    /(?:website|site|workspace|blog):\\s*(https?:\\/\\/[^\\s,]+)/i,\n    /(?:https?:\\/\\/)?([a-zA-Z0-9-]+\\.(?:dev|io|me|com|co|design|tech))(?:\\/|$|\\s)/i,\n  ];\n  for (const pattern of websitePatterns) {\n    const match = text.match(pattern);\n    if (match) {\n      const url = match[1].startsWith('http') ? match[1] : `https://${match[1]}`;\n      // Avoid social media sites\n      if (!url.match(/linkedin|twitter|github|facebook|instagram/i)) {\n        socialLinks.website = url;\n        break;\n      }\n    }\n  }\n\n  return socialLinks;\n}\n\n// Helper to format X handle to full URL\nexport function getXUrl(handle: string): string {\n  const cleanHandle = handle.replace('@', '');\n  return `https://x.com/${cleanHandle}`;\n}\n\n// Helper to check if a social link exists\nexport function hasSocialLinks(links: SocialLinks): boolean {\n  return !!(links.linkedin || links.x || links.github || links.email || links.website);\n}\n"],"names":[],"mappings":"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"}