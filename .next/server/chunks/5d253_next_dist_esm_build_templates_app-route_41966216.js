module.exports=[92932,e=>{"use strict";var t=e.i(457375),r=e.i(174015),a=e.i(116384),n=e.i(63831),o=e.i(868001),i=e.i(842780),s=e.i(763077),l=e.i(502964),u=e.i(993216),c=e.i(783900),d=e.i(295731),p=e.i(726839),g=e.i(775778),f=e.i(40992),h=e.i(432128),m=e.i(193695);e.i(44807);var R=e.i(989978),v=e.i(39334),w=e.i(879389);let y={windowMs:36e5,maxRequests:20},C={"nano-banana":"gemini-2.5-flash-image","nano-banana-pro":"gemini-3-pro-image-preview"};async function E(e,t,r,a,n,o,i){let s=C[a]||C["nano-banana-pro"],l=[{text:t}];if(r&&r.length>0){for(let e of r)if(e.includes("base64,")){let[t,r]=e.split("base64,"),a=t.match(/data:([^;]+)/),n=a?a[1]:"image/png";l.push({inlineData:{mimeType:n,data:r}})}}let u={contents:[{role:"user",parts:l}],generationConfig:{responseModalities:["IMAGE","TEXT"]}};n&&(u.generationConfig||(u.generationConfig={}),u.generationConfig.imageConfig={aspectRatio:n}),"nano-banana-pro"===a&&o&&(u.generationConfig||(u.generationConfig={}),u.generationConfig.imageConfig||(u.generationConfig.imageConfig={}),u.generationConfig.imageConfig.imageSize=o);let c=[];"nano-banana-pro"===a&&i&&c.push({googleSearch:{}}),c.length>0&&(u.tools=c);let d=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${s}:generateContent?key=${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!d.ok){let e=await d.text();return{success:!1,error:`Gemini API error: ${e}`}}let p=(await d.json()).candidates;if(!p||0===p.length)return{success:!1,error:"No response from AI model"};let g=p[0].content?.parts;if(!g)return{success:!1,error:"No content in response"};for(let e of g)if(e.inlineData&&e.inlineData.data){let t=e.inlineData.mimeType||"image/png";return{success:!0,image:`data:${t};base64,${e.inlineData.data}`,contentType:"image"}}return{success:!1,error:"No image in response"}}async function A(e,t,r,a,n){let o="https://api.replicate.com/v1",[i,s]=r.split("/"),l=await fetch(`${o}/models/${i}/${s}`,{headers:{Authorization:`Bearer ${e}`}});if(!l.ok)return{success:!1,error:`Failed to get model: ${l.status}`};let u=await l.json(),c=u.latest_version?.id;if(!c)return{success:!1,error:"Model has no available version"};let d={prompt:t,...n};a&&a.length>0&&(d.image=a[0]);let p=await fetch(`${o}/predictions`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({version:c,input:d})});if(!p.ok){let e=await p.text();return{success:!1,error:`Replicate error: ${e}`}}let g=await p.json(),f=Date.now(),h=g;for(;"succeeded"!==h.status&&"failed"!==h.status&&"canceled"!==h.status;){if(Date.now()-f>3e5)return{success:!1,error:"Generation timed out"};await new Promise(e=>setTimeout(e,1e3));let t=await fetch(`${o}/predictions/${h.id}`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)return{success:!1,error:`Failed to poll: ${t.status}`};h=await t.json()}if("failed"===h.status)return{success:!1,error:h.error||"Prediction failed"};let m=h.output;if(!m)return{success:!1,error:"No output"};let R=Array.isArray(m)?m:[m];if(0===R.length)return{success:!1,error:"No output URLs"};let v=R[0],w=await fetch(v);if(!w.ok)return{success:!1,error:`Failed to fetch output: ${w.status}`};let y=w.headers.get("content-type")||"image/png",C=y.startsWith("video/"),E=await w.arrayBuffer(),A=Buffer.from(E).toString("base64");return C?E.byteLength/1048576>20?{success:!0,videoUrl:v,contentType:"video"}:{success:!0,video:`data:${y};base64,${A}`,contentType:"video"}:{success:!0,image:`data:${y};base64,${A}`,contentType:"image"}}async function x(e,t,r,a,n){let o={"Content-Type":"application/json"};e&&(o.Authorization=`Key ${e}`);let i={prompt:t,...n};a&&a.length>0&&(i.image_url=a[0]);let s=await fetch(`https://fal.run/${r}`,{method:"POST",headers:o,body:JSON.stringify(i),signal:AbortSignal.timeout(6e5)});if(!s.ok){let e=await s.text();return{success:!1,error:`fal.ai error: ${e}`}}let l=await s.json(),u=null,c=!1;if(l.video?.url?(u=l.video.url,c=!0):l.images?.[0]?.url?u=l.images[0].url:l.image?.url?u=l.image.url:l.output&&"string"==typeof l.output&&(u=l.output),!u)return{success:!1,error:"No media URL in response"};let d=await fetch(u);if(!d.ok)return{success:!1,error:`Failed to fetch output: ${d.status}`};let p=d.headers.get("content-type")||(c?"video/mp4":"image/png"),g=p.startsWith("video/")||c,f=await d.arrayBuffer(),h=f.byteLength/1048576;if(g&&h>20)return{success:!0,videoUrl:u,contentType:"video"};let m=Buffer.from(f).toString("base64");return g?{success:!0,video:`data:${p};base64,${m}`,contentType:"video"}:{success:!0,image:`data:${p};base64,${m}`,contentType:"image"}}async function b(e){try{let t=(0,w.getClientIp)(e),r=(0,w.checkRateLimit)(`providers-generate:${t}`,y);if(!r.allowed)return v.NextResponse.json({success:!1,error:"Rate limit exceeded. Please try again later."},{status:429,headers:{"Retry-After":String(Math.ceil((r.resetAt-Date.now())/1e3))}});let{prompt:a,provider:n,modelId:o,images:i,parameters:s,aspectRatio:l,resolution:u,useGoogleSearch:c}=await e.json();if(!a)return v.NextResponse.json({success:!1,error:"Prompt is required"},{status:400});if("gemini"===n){let e=process.env.GEMINI_API_KEY;if(!e)return v.NextResponse.json({success:!1,error:"Gemini API key not configured"},{status:500});let t=await E(e,a,i||[],o,l,u,c);return v.NextResponse.json(t)}if("replicate"===n){let e=process.env.REPLICATE_API_KEY;if(!e)return v.NextResponse.json({success:!1,error:"Replicate API key not configured"},{status:500});let t=await A(e,a,o,i,s);return v.NextResponse.json(t)}if("fal"===n){let e=process.env.FAL_API_KEY||null,t=await x(e,a,o,i,s);return v.NextResponse.json(t)}return v.NextResponse.json({success:!1,error:`Unsupported provider: ${n}`},{status:400})}catch(e){return console.error("[Generate API] Error:",e),v.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Generation failed"},{status:500})}}e.s(["POST",()=>b,"maxDuration",0,300],96171);var T=e.i(96171);let N=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/providers/generate/route",pathname:"/api/providers/generate",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/providers/generate/route.ts",nextConfigOutput:"",userland:T}),{workAsyncStorage:$,workUnitAsyncStorage:P,serverHooks:S}=N;function I(){return(0,a.patchFetch)({workAsyncStorage:$,workUnitAsyncStorage:P})}async function O(e,t,a){N.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/providers/generate/route";v=v.replace(/\/index$/,"")||"/";let w=await N.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:y,params:C,nextConfig:E,parsedUrl:A,isDraftMode:x,prerenderManifest:b,routerServerContext:T,isOnDemandRevalidate:$,revalidateOnlyGenerated:P,resolvedPathname:S,clientReferenceManifest:I,serverActionsManifest:O}=w,_=(0,s.normalizeAppPath)(v),j=!!(b.dynamicRoutes[_]||b.routes[S]),k=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,A,!1):t.end("This page could not be found"),null);if(j&&!x){let e=!!b.routes[S],t=b.dynamicRoutes[_];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await k();throw new m.NoFallbackError}}let D=null;!j||N.isDev||x||(D="/index"===(D=S)?"/":D);let U=!0===N.isDev||!j,M=j&&!U;O&&I&&(0,i.setManifestsSingleton)({page:v,clientReferenceManifest:I,serverActionsManifest:O});let H=e.method||"GET",q=(0,o.getTracer)(),F=q.getActiveScopeSpan(),B={params:C,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,n)=>N.onRequestError(e,t,a,n,T)},sharedContext:{buildId:y}},K=new l.NodeNextRequest(e),L=new l.NodeNextResponse(t),G=u.NextRequestAdapter.fromNodeNextRequest(K,(0,u.signalFromNodeResponse)(t));try{let i=async e=>N.handle(G,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=q.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${H} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${v}`)}),s=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var o,l;let u=async({previousCacheEntry:r})=>{try{if(!s&&$&&P&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await i(n);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let u=B.renderOpts.collectedTags;if(!j)return await (0,p.sendResponse)(K,L,o,B.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(o.headers);u&&(t[h.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,a=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await N.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:$})},!1,T),t}},c=await N.handleResponse({req:e,nextConfig:E,cacheKey:D,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:$,revalidateOnlyGenerated:P,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:s});if(!j)return null;if((null==c||null==(o=c.value)?void 0:o.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",$?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,g.fromNodeOutgoingHttpHeaders)(c.value.headers);return s&&j||m.delete(h.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,f.getCacheControlHeader)(c.cacheControl)),await (0,p.sendResponse)(K,L,new Response(c.value.body,{headers:m,status:c.value.status||200})),null};F?await l(F):await q.withPropagatedContext(e.headers,()=>q.trace(c.BaseServerSpan.handleRequest,{spanName:`${H} ${v}`,kind:o.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof m.NoFallbackError||await N.onRequestError(e,t,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:$})},!1,T),j)throw t;return await (0,p.sendResponse)(K,L,new Response(null,{status:500})),null}}e.s(["handler",()=>O,"patchFetch",()=>I,"routeModule",()=>N,"serverHooks",()=>S,"workAsyncStorage",()=>$,"workUnitAsyncStorage",()=>P],92932)}];

//# sourceMappingURL=5d253_next_dist_esm_build_templates_app-route_41966216.js.map