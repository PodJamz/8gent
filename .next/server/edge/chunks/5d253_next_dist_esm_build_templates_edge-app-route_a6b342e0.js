(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["chunks/5d253_next_dist_esm_build_templates_edge-app-route_a6b342e0.js",390622,e=>{"use strict";let t;var n,r=e.i(134730),s=e.i(543870),o=e.i(951615),a=e.i(553060),i=e.i(116954),l=e.i(454753),c=e.i(164299),d=e.i(75928),u=e.i(320312),p=e.i(338770),h=e.i(872287),f=e.i(58111),g=e.i(134292),w=e.i(115973),R=e.i(644899),y=e.i(440389),m=e.i(219332),C=e.i(932477);e.i(409472);var v=e.i(884059);let A=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&n[e]];return t};var E=null;let T=E="u">typeof WebSocket?WebSocket:"u">typeof MozWebSocket?MozWebSocket:e.g.WebSocket||e.g.MozWebSocket;class S{ws=null;url;authToken;pendingRequests=new Map;eventListeners=new Map;isConnected=!1;connectPromise=null;constructor(e){this.url=e.url,this.authToken=e.authToken}async connect(){if(!this.isConnected)return this.connectPromise||(this.connectPromise=new Promise((e,t)=>{try{this.ws=new T(this.url,{headers:{Origin:"http://localhost:18789"}}),this.ws.onopen=()=>{console.log("[OpenClawClient] WebSocket connected")},this.ws.onmessage=n=>{try{let r,s=n.data;if("string"==typeof s)r=JSON.parse(s);else if(o.Buffer.isBuffer(s))r=JSON.parse(s.toString());else if(s instanceof ArrayBuffer){let e=new TextDecoder;r=JSON.parse(e.decode(s))}else{if(!Array.isArray(s))return void console.warn("[OpenClawClient] Unknown message type:",typeof s);r=JSON.parse(o.Buffer.concat(s).toString())}this.handleMessage(r,e,t)}catch(e){console.error("[OpenClawClient] Failed to parse message:",e)}},this.ws.onerror=e=>{console.error("[OpenClawClient] WebSocket error:",e),this.isConnected||t(e)},this.ws.onclose=()=>{console.log("[OpenClawClient] WebSocket closed"),this.isConnected=!1,this.connectPromise=null}}catch(e){t(e)}})),this.connectPromise}handleMessage(e,t,n){if("event"===e.type&&"connect.challenge"===e.event)return void this.handleChallenge(e.payload,t,n);if("res"===e.type){let t=this.pendingRequests.get(e.id);t&&(e.ok?t.resolve(e.body||e.payload):t.reject(Error(e.error?.message||"Unknown error")),this.pendingRequests.delete(e.id));return}if("event"===e.type){let t=this.eventListeners.get(e.event);t&&t.forEach(t=>t(e.payload))}}handleChallenge(e,t,n){let r={type:"req",id:A(),method:"connect",params:{minProtocol:3,maxProtocol:3,role:"operator",client:{id:"webchat",displayName:"OpenClaw OS",version:"0.1.0",platform:"web",mode:"ui",deviceFamily:"browser"},auth:{token:this.authToken}}};this.ws&&(this.send(r),this.pendingRequests.set(r.id,{resolve:()=>{this.isConnected=!0,t()},reject:e=>{this.isConnected=!1,n(e)}}))}send(e){this.ws&&this.ws.readyState===T.OPEN?this.ws.send(JSON.stringify(e)):console.warn("[OpenClawClient] Cannot send, socket not open")}async request(e,t={}){await this.connect();let n=A();return new Promise((r,s)=>{this.pendingRequests.set(n,{resolve:r,reject:s}),this.send({type:"req",id:n,method:e,params:t})})}subscribe(e,t){return this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e).add(t),()=>{this.eventListeners.get(e)?.delete(t)}}}let O=process.env.NEXT_PUBLIC_OPENCLAW_GATEWAY_URL||"ws://localhost:3000",N=process.env.NEXT_PUBLIC_OPENCLAW_GATEWAY_TOKEN||"openclaw-admin-token";class P{static instance;static getInstance(){return P.instance||(P.instance=new S({url:O,authToken:N})),P.instance}}P.getInstance();let x=new Map;"u">typeof setInterval&&setInterval(()=>{let e=Date.now();for(let[t,n]of x.entries())n.resetAt<e&&x.delete(t)},6e4);let _={windowMs:6e4,maxRequests:10};async function b(e){try{let t=function(e){let t=e.headers,n=t.get("x-vercel-forwarded-for");if(n)return n.split(",")[0].trim();let r=t.get("cf-connecting-ip");if(r)return r;let s=t.get("x-forwarded-for");if(s)return s.split(",")[0].trim();let o=t.get("x-real-ip");return o||"unknown"}(e),n=function(e,t){let n=Date.now(),r=x.get(e);if(!r||r.resetAt<n){let r=n+t.windowMs;return x.set(e,{count:1,resetAt:r}),{allowed:!0,remaining:t.maxRequests-1,resetAt:r}}return r.count>=t.maxRequests?{allowed:!1,remaining:0,resetAt:r.resetAt}:(r.count++,{allowed:!0,remaining:t.maxRequests-r.count,resetAt:r.resetAt})}(`tts:${t}`,_);if(!n.allowed)return new Response(JSON.stringify({error:"Rate limit exceeded. Please wait before making more requests.",retryAfter:Math.ceil((n.resetAt-Date.now())/1e3)}),{status:429,headers:{"Content-Type":"application/json","Retry-After":String(Math.ceil((n.resetAt-Date.now())/1e3))}});let{text:r,voice:s="nova",model:o="tts-1-hd",speed:a=1}=await e.json();if(!r||"string"!=typeof r)return new Response(JSON.stringify({error:"Text is required"}),{status:400,headers:{"Content-Type":"application/json"}});if(r.length>4096)return new Response(JSON.stringify({error:"Text too long (max 4096 characters)"}),{status:400,headers:{"Content-Type":"application/json"}});let i=process.env.OPENAI_API_KEY;if(!i)return new Response(JSON.stringify({error:"OpenAI API key not configured"}),{status:500,headers:{"Content-Type":"application/json"}});let l=await fetch("https://api.openai.com/v1/audio/speech",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({model:o,input:r,voice:s,speed:a,response_format:"mp3"})});if(!l.ok){let e=await l.text();return console.error("OpenAI TTS API error:",e),new Response(JSON.stringify({error:"Failed to generate speech"}),{status:500,headers:{"Content-Type":"application/json"}})}let c=l.body;if(!c)return new Response(JSON.stringify({error:"No audio stream received"}),{status:500,headers:{"Content-Type":"application/json"}});return new Response(c,{headers:{"Content-Type":"audio/mpeg","Cache-Control":"no-cache","Transfer-Encoding":"chunked"}})}catch(e){return console.error("TTS API error:",e),new Response(JSON.stringify({error:"Internal server error"}),{status:500,headers:{"Content-Type":"application/json"}})}}e.s(["POST",()=>b,"runtime",0,"edge"],580156);var k=e.i(580156);let M=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/tts/route",pathname:"/api/tts",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/tts/route.ts",nextConfigOutput:"",userland:k}),{workAsyncStorage:I,workUnitAsyncStorage:q,serverHooks:U}=M;function j(){return(0,l.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:q})}async function D(e,t,n){M.isDev&&(0,c.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let s="/api/tts/route";s=s.replace(/\/index$/,"")||"/";let a=await M.prepare(e,t,{srcPage:s,multiZoneDraftMode:!1});if(!a)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:l,params:A,nextConfig:E,parsedUrl:T,isDraftMode:S,prerenderManifest:O,routerServerContext:N,isOnDemandRevalidate:P,revalidateOnlyGenerated:x,resolvedPathname:_,clientReferenceManifest:b,serverActionsManifest:k}=a,I=(0,u.normalizeAppPath)(s),q=!!(O.dynamicRoutes[I]||O.routes[_]),U=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,T,!1):t.end("This page could not be found"),null);if(q&&!S){let e=!!O.routes[_],t=O.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await U();throw new C.NoFallbackError}}let j=null;!q||M.isDev||S||(j="/index"===(j=_)?"/":j);let D=!0===M.isDev||!q,H=q&&!D;k&&b&&(0,r.setManifestsSingleton)({page:s,clientReferenceManifest:b,serverActionsManifest:k});let L=e.method||"GET",W=(0,d.getTracer)(),B=W.getActiveScopeSpan(),J={params:A,prerenderManifest:O,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,c.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,r,s)=>M.onRequestError(e,t,r,s,N)},sharedContext:{buildId:l}},F=new p.NodeNextRequest(e),K=new p.NodeNextResponse(t),$=h.NextRequestAdapter.fromNodeNextRequest(F,(0,h.signalFromNodeResponse)(t));try{let r=async e=>M.handle($,J).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=W.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==f.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=n.get("next.route");if(r){let t=`${L} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${L} ${s}`)}),a=!!(0,c.getRequestMeta)(e,"minimalMode"),l=async l=>{var c,d;let u=async({previousCacheEntry:i})=>{try{if(!a&&P&&x&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await r(l);e.fetchMetrics=J.renderOpts.fetchMetrics;let c=J.renderOpts.pendingWaitUntil;c&&n.waitUntil&&(n.waitUntil(c),c=void 0);let d=J.renderOpts.collectedTags;if(!q)return await (0,w.sendResponse)(F,K,s,J.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,R.toNodeOutgoingHttpHeaders)(s.headers);d&&(t[m.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==J.renderOpts.collectedRevalidate&&!(J.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&J.renderOpts.collectedRevalidate,r=void 0===J.renderOpts.collectedExpire||J.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:J.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:s.status,body:o.Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:r}}}}catch(t){throw(null==i?void 0:i.isStale)&&await M.onRequestError(e,t,{routerKind:"App Router",routePath:s,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:P})},!1,N),t}},p=await M.handleResponse({req:e,nextConfig:E,cacheKey:j,routeKind:i.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:O,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:x,responseGenerator:u,waitUntil:n.waitUntil,isMinimalMode:a});if(!q)return null;if((null==p||null==(c=p.value)?void 0:c.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(d=p.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});a||t.setHeader("x-nextjs-cache",P?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,R.fromNodeOutgoingHttpHeaders)(p.value.headers);return a&&q||h.delete(m.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,y.getCacheControlHeader)(p.cacheControl)),await (0,w.sendResponse)(F,K,new Response(p.value.body,{headers:h,status:p.value.status||200})),null};B?await l(B):await W.withPropagatedContext(e.headers,()=>W.trace(f.BaseServerSpan.handleRequest,{spanName:`${L} ${s}`,kind:d.SpanKind.SERVER,attributes:{"http.method":L,"http.target":e.url}},l))}catch(t){if(t instanceof C.NoFallbackError||await M.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:P})},!1,N),q)throw t;return await (0,w.sendResponse)(F,K,new Response(null,{status:500})),null}}e.s(["handler",()=>D,"patchFetch",()=>j,"routeModule",()=>M,"serverHooks",()=>U,"workAsyncStorage",()=>I,"workUnitAsyncStorage",()=>q],282571);var H=e.i(282571);let L=null==(n=self.__RSC_MANIFEST)?void 0:n["/api/tts/route"],W=(t=self.__RSC_SERVER_MANIFEST)?JSON.parse(t):void 0;L&&W&&(0,r.setManifestsSingleton)({page:"/api/tts/route",clientReferenceManifest:L,serverActionsManifest:W});let B=s.EdgeRouteModuleWrapper.wrap(H.routeModule,{page:"/api/tts/route"});e.s(["ComponentMod",0,H,"default",0,B],390622)}]);

//# sourceMappingURL=5d253_next_dist_esm_build_templates_edge-app-route_a6b342e0.js.map