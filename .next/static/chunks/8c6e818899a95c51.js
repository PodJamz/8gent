(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,810667,e=>{"use strict";let t,a;e.s(["ClubSpacesApp",()=>Y,"useClubSpacesContext",()=>z],810667);var i=e.i(726151),s=e.i(923041),n=e.i(662582),r=e.i(278124),l=e.i(946200),o=e.i(895579),c=e.i(850402),d=e.i(847562),m=e.i(790484),x=e.i(573138),u=e.i(424419),h=e.i(219198),h=h,p=e.i(368752);let b="[ClubSpaces]",w=(e,t)=>console.log(`${b} ${e}`,t??"");var f=e.i(122429),y=e.i(183904),g=e.i(55841),j=e.i(459201),v=e.i(752153),N=e.i(746115),k=e.i(975157);function S({onCreateRoom:e,onJoinRoom:t,user:a,isConnecting:l}){let[o,c]=(0,s.useState)(""),[x,u]=(0,s.useState)(""),[h,p]=(0,s.useState)(""),[b,w]=(0,s.useState)("create"),[S,C]=(0,s.useState)("");return(0,i.jsxs)("div",{className:"min-h-dvh flex flex-col bg-black",children:[(0,i.jsxs)("header",{className:"flex items-center justify-between px-6 py-4 border-b border-white/[0.06]",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("div",{className:"w-9 h-9 rounded-xl bg-amber-500 flex items-center justify-center",children:(0,i.jsx)(m.Radio,{className:"w-5 h-5 text-black"})}),(0,i.jsx)("span",{className:"text-lg font-semibold text-white tracking-tight",children:"ClubSpaces"})]}),a&&(0,i.jsx)("div",{className:"flex items-center gap-2",children:(0,i.jsx)("div",{className:"w-8 h-8 rounded-full bg-white/10 flex items-center justify-center text-sm font-medium text-white",children:(a.firstName||a.fullName||"U").charAt(0).toUpperCase()})})]}),(0,i.jsx)("div",{className:"flex-1 flex items-center justify-center px-4 py-8",children:(0,i.jsxs)("div",{className:"w-full max-w-sm",children:[(0,i.jsxs)(n.motion.div,{className:"text-center mb-8",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.25,.46,.45,.94]},children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-white tracking-tight mb-2",children:"Drop in audio"}),(0,i.jsx)("p",{className:"text-white/50 text-sm leading-relaxed",children:"Real-time voice rooms. Create a space or join one."})]}),(0,i.jsxs)(n.motion.div,{className:"flex gap-1 mb-6 p-1 bg-white/[0.04] rounded-xl border border-white/[0.06]",initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},children:[(0,i.jsxs)("button",{onClick:()=>w("create"),className:(0,k.cn)("flex-1 px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-200","create"===b?"bg-amber-500 text-black shadow-sm":"text-white/50 hover:text-white"),children:[(0,i.jsx)(g.Plus,{className:"w-3.5 h-3.5 inline mr-1.5 -mt-0.5"}),"Create"]}),(0,i.jsxs)("button",{onClick:()=>w("join"),className:(0,k.cn)("flex-1 px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-200","join"===b?"bg-amber-500 text-black shadow-sm":"text-white/50 hover:text-white"),children:[(0,i.jsx)(d.LogIn,{className:"w-3.5 h-3.5 inline mr-1.5 -mt-0.5"}),"Join"]})]}),(0,i.jsxs)(n.motion.form,{onSubmit:a=>{if(a.preventDefault(),"create"===b){if(!o.trim())return;let t=h.split(",").map(e=>e.trim()).filter(e=>e.length>0);e(o.trim(),x.trim()||void 0,t.length>0?t:void 0)}else{if(!S.trim())return;t(S.trim())}},className:"space-y-3",initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.1},children:[(0,i.jsx)(r.AnimatePresence,{mode:"wait",children:"create"===b?(0,i.jsxs)(n.motion.div,{initial:{opacity:0,x:-8},animate:{opacity:1,x:0},exit:{opacity:0,x:8},transition:{duration:.2},className:"space-y-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-xs font-medium text-white/40 uppercase tracking-wider mb-1.5 pl-1",children:"Room Name"}),(0,i.jsx)("input",{type:"text",value:o,onChange:e=>c(e.target.value),placeholder:"Late night music",className:"w-full px-4 py-3 bg-white/[0.04] border border-white/[0.08] rounded-xl text-white placeholder-white/20 focus:outline-none focus:border-amber-500/50 focus:bg-white/[0.06] transition-all text-sm",autoFocus:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-xs font-medium text-white/40 uppercase tracking-wider mb-1.5 pl-1",children:"Description"}),(0,i.jsx)("textarea",{value:x,onChange:e=>u(e.target.value),placeholder:"What's this room about?",rows:2,className:"w-full px-4 py-3 bg-white/[0.04] border border-white/[0.08] rounded-xl text-white placeholder-white/20 focus:outline-none focus:border-amber-500/50 focus:bg-white/[0.06] transition-all resize-none text-sm"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-xs font-medium text-white/40 uppercase tracking-wider mb-1.5 pl-1",children:"Topics"}),(0,i.jsx)("input",{type:"text",value:h,onChange:e=>p(e.target.value),placeholder:"tech, AI, design...",className:"w-full px-4 py-3 bg-white/[0.04] border border-white/[0.08] rounded-xl text-white placeholder-white/20 focus:outline-none focus:border-amber-500/50 focus:bg-white/[0.06] transition-all text-sm"})]})]},"create"):(0,i.jsxs)(n.motion.div,{initial:{opacity:0,x:8},animate:{opacity:1,x:0},exit:{opacity:0,x:-8},transition:{duration:.2},className:"space-y-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-xs font-medium text-white/40 uppercase tracking-wider mb-1.5 pl-1",children:"Room Code or URL"}),(0,i.jsx)("input",{type:"text",value:S,onChange:e=>C(e.target.value),placeholder:"Paste room link or enter code...",className:"w-full px-4 py-3 bg-white/[0.04] border border-white/[0.08] rounded-xl text-white placeholder-white/20 focus:outline-none focus:border-amber-500/50 focus:bg-white/[0.06] transition-all text-sm",autoFocus:!0})]}),(0,i.jsx)("p",{className:"text-xs text-white/30 pl-1",children:"Enter a room name, URL, or invite link"})]},"join")}),(0,i.jsxs)(n.motion.button,{type:"submit",disabled:l||("create"===b?!o.trim():!S.trim()),whileTap:{scale:.98},className:"w-full px-6 py-3.5 bg-amber-500 hover:bg-amber-400 text-black font-semibold rounded-xl shadow-sm disabled:opacity-30 disabled:cursor-not-allowed transition-all text-sm flex items-center justify-center gap-2",children:[l?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(N.Loader2,{className:"w-4 h-4 animate-spin"}),"Connecting..."]}):"create"===b?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(f.Mic,{className:"w-4 h-4"}),"Start Room"]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(j.Headphones,{className:"w-4 h-4"}),"Join Room"]}),!l&&(0,i.jsx)(v.ChevronRight,{className:"w-4 h-4 ml-auto"})]})]}),(0,i.jsxs)(n.motion.div,{className:"mt-8 grid grid-cols-2 gap-3",initial:{opacity:0},animate:{opacity:1},transition:{delay:.25,duration:.4},children:[(0,i.jsxs)("div",{className:"p-4 bg-white/[0.03] rounded-xl border border-white/[0.06]",children:[(0,i.jsx)(y.Users,{className:"w-5 h-5 text-amber-500 mb-2"}),(0,i.jsx)("p",{className:"text-sm text-white/80 font-medium",children:"Multi-person"}),(0,i.jsx)("p",{className:"text-xs text-white/30 mt-0.5",children:"Stage + audience"})]}),(0,i.jsxs)("div",{className:"p-4 bg-white/[0.03] rounded-xl border border-white/[0.06]",children:[(0,i.jsx)(f.Mic,{className:"w-5 h-5 text-amber-500 mb-2"}),(0,i.jsx)("p",{className:"text-sm text-white/80 font-medium",children:"Real-time"}),(0,i.jsx)("p",{className:"text-xs text-white/30 mt-0.5",children:"Low latency audio"})]})]})]})})]})}var C=e.i(950198),P=e.i(897652),R=e.i(317066),T=e.i(827447),M=e.i(799575),L=e.i(981779),O=e.i(8722),E=e.i(973493),A=e.i(688399),I=e.i(906509),D=e.i(268122);let J=["#f59e0b","#ef4444","#10b981","#3b82f6","#f97316","#06b6d4","#ec4899","#84cc16","#14b8a6","#e11d48"];function U({name:e,role:t,isMuted:a,isSpeaking:s,audioLevel:r,hasRaisedHand:l,isLocal:o}){let c=J[e.split("").reduce((e,t)=>e+t.charCodeAt(0),0)%J.length],d="host"===t||"co-host"===t||"speaker"===t;return(0,i.jsxs)(n.motion.div,{className:"flex flex-col items-center gap-1.5",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},children:[(0,i.jsxs)("div",{className:"relative",children:[s&&(0,i.jsx)(n.motion.div,{className:"absolute -inset-1 rounded-full border-[2.5px] border-amber-500",initial:{opacity:0},animate:{opacity:[.5,1,.5]},transition:{duration:1.5,repeat:1/0}}),(0,i.jsx)("div",{className:(0,k.cn)("w-16 h-16 rounded-full flex items-center justify-center text-lg font-bold text-white relative",d?"w-[72px] h-[72px]":"w-16 h-16"),style:{backgroundColor:c},children:e.charAt(0).toUpperCase()}),a&&d&&(0,i.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center border-2 border-black",children:(0,i.jsx)(C.MicOff,{className:"w-2.5 h-2.5 text-white"})}),"host"===t&&(0,i.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-amber-500 rounded-full flex items-center justify-center border-2 border-black",children:(0,i.jsx)(I.Crown,{className:"w-2.5 h-2.5 text-black"})}),"co-host"===t&&(0,i.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-white/90 rounded-full flex items-center justify-center border-2 border-black",children:(0,i.jsx)(D.Star,{className:"w-2.5 h-2.5 text-black"})}),l&&"listener"===t&&(0,i.jsx)(n.motion.div,{className:"absolute -top-2 -right-2 text-base",initial:{scale:0},animate:{scale:1,y:[0,-3,0]},transition:{y:{repeat:1/0,duration:1}},children:"âœ‹"})]}),(0,i.jsxs)("div",{className:"text-center max-w-[80px]",children:[(0,i.jsx)("p",{className:(0,k.cn)("text-xs font-medium truncate",o?"text-amber-500":"text-white/80"),children:o?"You":e}),"host"===t&&(0,i.jsx)("p",{className:"text-[10px] text-amber-500/70 font-medium",children:"HOST"}),"co-host"===t&&(0,i.jsx)("p",{className:"text-[10px] text-white/40 font-medium",children:"CO-HOST"})]})]})}var H=e.i(591372),_=e.i(726152);function F({messages:e,onSendMessage:t,onClose:a}){let[r,l]=(0,s.useState)(""),o=(0,s.useRef)(null);return(0,s.useEffect)(()=>{o.current?.scrollIntoView({behavior:"smooth"})},[e]),(0,i.jsxs)(n.motion.div,{className:"fixed right-0 top-0 bottom-20 w-80 bg-neutral-950 border-l border-white/[0.06] flex flex-col z-40",initial:{x:320},animate:{x:0},exit:{x:320},transition:{duration:.25,ease:[.25,.46,.45,.94]},children:[(0,i.jsxs)("div",{className:"p-4 border-b border-white/[0.06] flex items-center justify-between",children:[(0,i.jsx)("h2",{className:"text-sm font-semibold text-white",children:"Chat"}),(0,i.jsx)("button",{onClick:a,className:"w-7 h-7 rounded-lg hover:bg-white/[0.06] flex items-center justify-center text-white/30 hover:text-white transition-colors",children:(0,i.jsx)(H.X,{className:"w-3.5 h-3.5"})})]}),(0,i.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[0===e.length?(0,i.jsx)("div",{className:"text-center text-white/20 text-xs mt-8",children:"No messages yet"}):e.map(e=>(0,i.jsxs)("div",{className:(0,k.cn)("flex flex-col","system"===e.type?"items-center":"items-start"),children:["text"===e.type&&(0,i.jsx)("div",{className:"text-[10px] text-amber-500/60 font-medium mb-0.5",children:e.participantName}),(0,i.jsx)("div",{className:(0,k.cn)("px-3 py-1.5 rounded-lg text-sm","system"===e.type?"bg-white/[0.02] text-white/20 text-xs":"bg-white/[0.04] text-white/80"),children:e.content}),(0,i.jsx)("div",{className:"text-[10px] text-white/15 mt-0.5",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},e.id)),(0,i.jsx)("div",{ref:o})]}),(0,i.jsx)("form",{onSubmit:e=>{e.preventDefault(),r.trim()&&(t(r),l(""))},className:"p-3 border-t border-white/[0.06]",children:(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("input",{type:"text",value:r,onChange:e=>l(e.target.value),placeholder:"Message...",className:"flex-1 px-3 py-2 bg-white/[0.04] border border-white/[0.08] rounded-lg text-white text-sm placeholder-white/20 focus:outline-none focus:border-amber-500/30 transition-colors",autoFocus:!0}),(0,i.jsx)("button",{type:"submit",disabled:!r.trim(),className:"px-3 py-2 bg-amber-500 hover:bg-amber-400 text-black rounded-lg disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:(0,i.jsx)(_.Send,{className:"w-4 h-4"})})]})})]})}var $=e.i(835185);function K({room:e,onPromoteToSpeaker:t,onMuteParticipant:a,onClose:s}){if(!e)return null;let r=Array.from(e.remoteParticipants.values()).filter(e=>{let t=e.metadata?JSON.parse(e.metadata):{};return("listener"===t.role||!t.role)&&!0===t.hasRaisedHand}),l=Array.from(e.remoteParticipants.values());return(0,i.jsxs)(n.motion.div,{className:"bg-white/[0.03] border border-white/[0.06] rounded-xl p-4",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,i.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Host Controls"}),(0,i.jsx)("button",{onClick:s,className:"w-7 h-7 rounded-lg hover:bg-white/[0.06] flex items-center justify-center text-white/30 hover:text-white transition-colors",children:(0,i.jsx)(H.X,{className:"w-3.5 h-3.5"})})]}),r.length>0&&(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("h4",{className:"text-xs font-medium text-white/30 uppercase tracking-wider mb-2",children:"Raised Hands"}),(0,i.jsx)("div",{className:"space-y-1.5",children:r.map(e=>(0,i.jsxs)("div",{className:"flex items-center justify-between p-2.5 bg-white/[0.03] rounded-lg border border-white/[0.04]",children:[(0,i.jsx)("span",{className:"text-sm text-white/80",children:e.name||e.identity}),(0,i.jsxs)("button",{onClick:()=>t(e.identity),className:"px-3 py-1 bg-amber-500 hover:bg-amber-400 text-black text-xs font-medium rounded-lg transition-colors flex items-center gap-1",children:[(0,i.jsx)($.UserPlus,{className:"w-3 h-3"}),"Promote"]})]},e.identity))})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"text-xs font-medium text-white/30 uppercase tracking-wider mb-2",children:"Participants"}),(0,i.jsx)("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:l.map(e=>{let s=e.metadata?JSON.parse(e.metadata):{},n=e.audioTrackPublications.values().next().value?.track,r=n?.isMuted??!1;return(0,i.jsxs)("div",{className:"flex items-center justify-between p-2.5 bg-white/[0.03] rounded-lg border border-white/[0.04]",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-sm text-white/80",children:e.name||e.identity}),s.role&&(0,i.jsx)("span",{className:"px-1.5 py-0.5 bg-amber-500/10 text-amber-500 text-[10px] rounded font-medium uppercase",children:s.role})]}),(0,i.jsxs)("div",{className:"flex gap-1.5",children:["listener"===s.role&&(0,i.jsx)("button",{onClick:()=>t(e.identity),className:"px-2 py-1 bg-amber-500/10 hover:bg-amber-500/20 text-amber-500 text-xs rounded-lg transition-colors",children:"Promote"}),"speaker"===s.role&&(0,i.jsxs)("button",{onClick:()=>a(e.identity),className:"px-2 py-1 bg-red-500/10 hover:bg-red-500/20 text-red-400 text-xs rounded-lg transition-colors flex items-center gap-1",children:[r?(0,i.jsx)(C.MicOff,{className:"w-3 h-3"}):(0,i.jsx)(f.Mic,{className:"w-3 h-3"}),r?"Unmute":"Mute"]})]})]},e.identity)})})]})]})}try{t=(()=>{let e=Error("Cannot find module '../../../convex/_generated/api'");throw e.code="MODULE_NOT_FOUND",e})().api}catch{t=null}function B({roomName:e,roomId:a,inviteToken:l,room:o,onLeave:d}){let[x,u]=(0,s.useState)(!1),[h,p]=(0,s.useState)(!1),b=(0,c.useQuery)(t?.clubspaces?.getRoomById||(async()=>null),t?.clubspaces?.getRoomById?{roomId:a}:"skip"),w=l||b?.inviteToken||null,g=`${window.location.origin}/clubspaces/room/${a}`,j=w&&1?`${window.location.origin}/clubspaces/invite/${w}`:null;(0,s.useEffect)(()=>{if(!x)return;let e=e=>{e.target.closest(".share-menu-container")||u(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[x]);let{localRole:v,roomMetadata:N,chatMessages:S,reactions:I,hasRaisedHand:D,toggleMute:J,raiseHand:H,sendChatMessage:_,sendReaction:$,promoteToSpeaker:B,muteParticipant:V}=z(),[Y,W]=(0,s.useState)(!1),[q,X]=(0,s.useState)(!1),G=o?.localParticipant.audioTrackPublications.values().next().value?.track?.isMuted??!1,Q=(o?.remoteParticipants.size??0)+1,Z="host"===v||"co-host"===v,ee="host"===v||"co-host"===v||"speaker"===v,et=o?Array.from(o.remoteParticipants.values()).filter(e=>{let t=e.metadata?JSON.parse(e.metadata):{};return"host"===t.role||"co-host"===t.role}):[],ea=o?Array.from(o.remoteParticipants.values()).filter(e=>"speaker"===(e.metadata?JSON.parse(e.metadata):{}).role):[],ei=o?Array.from(o.remoteParticipants.values()).filter(e=>{let t=e.metadata?JSON.parse(e.metadata):{};return"listener"===t.role||!t.role}):[],es=async e=>{await navigator.clipboard.writeText(e),p(!0),setTimeout(()=>p(!1),2e3)};return(0,i.jsxs)("div",{className:"min-h-dvh flex flex-col bg-black relative",children:[(0,i.jsxs)(n.motion.header,{className:"flex items-center justify-between px-5 py-3 border-b border-white/[0.06]",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(E.ChevronDown,{className:"w-5 h-5 text-white/40"}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(m.Radio,{className:"w-4 h-4 text-amber-500"}),(0,i.jsx)("span",{className:"text-sm font-medium text-white/60",children:"LIVE"})]})]}),(0,i.jsx)("div",{className:"flex items-center gap-2",children:(0,i.jsxs)("div",{className:"flex items-center gap-1.5 text-white/40 text-xs",children:[(0,i.jsx)(y.Users,{className:"w-3.5 h-3.5"}),(0,i.jsx)("span",{children:Q})]})})]}),(0,i.jsxs)("div",{className:"flex-1 overflow-y-auto pb-28",children:[(0,i.jsxs)(n.motion.div,{className:"mx-4 mt-4 p-5 bg-white/[0.03] rounded-2xl border border-white/[0.06]",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.05},children:[(0,i.jsx)("h1",{className:"text-xl font-bold text-white mb-1",children:e}),N?.topics&&N.topics.length>0&&(0,i.jsx)("div",{className:"flex flex-wrap gap-1.5 mt-2",children:N.topics.map((e,t)=>(0,i.jsx)("span",{className:"px-2.5 py-0.5 bg-amber-500/10 text-amber-500 text-xs rounded-full border border-amber-500/20 font-medium",children:e},t))}),(0,i.jsxs)("div",{className:"flex items-center gap-2 mt-4",children:[(0,i.jsxs)("div",{className:"relative share-menu-container",children:[(0,i.jsxs)("button",{onClick:e=>{e.stopPropagation(),u(!x)},className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white/50 hover:text-white bg-white/[0.04] hover:bg-white/[0.08] rounded-lg border border-white/[0.06] transition-all",children:[(0,i.jsx)(M.Share2,{className:"w-3.5 h-3.5"}),"Share"]}),x&&(0,i.jsx)("div",{className:"absolute left-0 top-full mt-2 w-72 bg-neutral-900 border border-white/[0.08] rounded-xl p-4 shadow-2xl z-50",onClick:e=>e.stopPropagation(),children:(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[10px] text-white/30 uppercase tracking-wider mb-1.5",children:"Room URL"}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("input",{type:"text",value:g,readOnly:!0,className:"flex-1 px-2.5 py-1.5 bg-white/[0.04] border border-white/[0.08] rounded-lg text-white text-xs font-mono"}),(0,i.jsx)("button",{onClick:()=>es(g),className:"px-2.5 py-1.5 bg-amber-500 hover:bg-amber-400 text-black rounded-lg transition-colors",children:h?(0,i.jsx)(O.Check,{className:"w-3.5 h-3.5"}):(0,i.jsx)(L.Copy,{className:"w-3.5 h-3.5"})})]})]}),j&&(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[10px] text-white/30 uppercase tracking-wider mb-1.5",children:"Invite Link"}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("input",{type:"text",value:j,readOnly:!0,className:"flex-1 px-2.5 py-1.5 bg-white/[0.04] border border-white/[0.08] rounded-lg text-white text-xs font-mono"}),(0,i.jsx)("button",{onClick:()=>es(j),className:"px-2.5 py-1.5 bg-amber-500 hover:bg-amber-400 text-black rounded-lg transition-colors",children:h?(0,i.jsx)(O.Check,{className:"w-3.5 h-3.5"}):(0,i.jsx)(L.Copy,{className:"w-3.5 h-3.5"})})]})]})]})})]}),Z&&(0,i.jsxs)("button",{onClick:()=>X(!q),className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-amber-500/80 hover:text-amber-500 bg-amber-500/[0.06] hover:bg-amber-500/10 rounded-lg border border-amber-500/10 transition-all",children:[(0,i.jsx)(A.Settings2,{className:"w-3.5 h-3.5"}),"Host"]})]})]}),(0,i.jsx)(r.AnimatePresence,{children:q&&Z&&(0,i.jsx)(n.motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mx-4 mt-3 overflow-hidden",children:(0,i.jsx)(K,{room:o,onPromoteToSpeaker:B,onMuteParticipant:V,onClose:()=>X(!1)})})}),(0,i.jsx)(n.motion.section,{className:"px-4 mt-6",initial:{opacity:0},animate:{opacity:1},transition:{delay:.15},children:(0,i.jsxs)("div",{className:"flex flex-wrap gap-6 justify-center py-4",children:[o&&(0,i.jsx)(U,{identity:o.localParticipant.identity,name:"You",role:v,isMuted:G,isSpeaking:!1,audioLevel:0,hasRaisedHand:D,isLocal:!0},o.localParticipant.identity),et.map(e=>{let t=e.audioTrackPublications.values().next().value,a=e.metadata?JSON.parse(e.metadata):{},s=t?.isMuted??!1,n=t?.track&&!t.isMuted?.3:0;return(0,i.jsx)(U,{identity:e.identity,name:e.name||e.identity,role:a.role||"host",isMuted:s,isSpeaking:n>.1,audioLevel:n,hasRaisedHand:a.hasRaisedHand,isLocal:!1},e.identity)}),ea.map(e=>{let t=e.audioTrackPublications.values().next().value,a=e.metadata?JSON.parse(e.metadata):{},s=t?.isMuted??!1,n=t?.track&&!t.isMuted?.3:0;return(0,i.jsx)(U,{identity:e.identity,name:e.name||e.identity,role:"speaker",isMuted:s,isSpeaking:n>.1,audioLevel:n,hasRaisedHand:a.hasRaisedHand,isLocal:!1},e.identity)})]})}),ei.length>0&&(0,i.jsx)("div",{className:"mx-4 mt-4 mb-2",children:(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("div",{className:"h-px flex-1 bg-white/[0.06]"}),(0,i.jsx)("span",{className:"text-[10px] text-white/20 uppercase tracking-widest font-medium",children:"Listeners"}),(0,i.jsx)("div",{className:"h-px flex-1 bg-white/[0.06]"})]})}),ei.length>0&&(0,i.jsx)("section",{className:"px-4 py-2",children:(0,i.jsx)("div",{className:"flex flex-wrap gap-4 justify-center",children:ei.map(e=>{let t=e.metadata?JSON.parse(e.metadata):{};return(0,i.jsx)(U,{identity:e.identity,name:e.name||e.identity,role:"listener",isMuted:!0,isSpeaking:!1,audioLevel:0,hasRaisedHand:t.hasRaisedHand,isLocal:!1},e.identity)})})})]}),(0,i.jsx)(r.AnimatePresence,{children:I.length>0&&(0,i.jsx)(n.motion.div,{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-50 flex gap-2",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:I.map((e,t)=>(0,i.jsx)(n.motion.div,{className:"text-4xl",initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},exit:{scale:0,rotate:180},transition:{type:"spring",stiffness:200,damping:10},children:e.emoji},t))})}),(0,i.jsx)(r.AnimatePresence,{children:Y&&(0,i.jsx)(F,{messages:S,onSendMessage:_,onClose:()=>W(!1)})}),(0,i.jsx)(n.motion.div,{className:"fixed bottom-0 left-0 right-0 px-4 py-3 bg-black/90 backdrop-blur-xl border-t border-white/[0.06]",initial:{y:100},animate:{y:0},transition:{duration:.3,ease:[.25,.46,.45,.94]},children:(0,i.jsxs)("div",{className:"max-w-lg mx-auto flex items-center justify-between",children:[(0,i.jsxs)("button",{onClick:d,className:"px-5 py-2.5 bg-white/[0.06] hover:bg-white/10 text-white/60 hover:text-white rounded-full text-sm font-medium transition-all flex items-center gap-2 border border-white/[0.06]",children:[(0,i.jsx)(P.LogOut,{className:"w-4 h-4"}),"Leave"]}),(0,i.jsx)("div",{className:"flex items-center gap-3",children:["ðŸ‘","â¤ï¸","ðŸ”¥"].map(e=>(0,i.jsx)("button",{onClick:()=>$(e),className:"w-10 h-10 rounded-full bg-white/[0.04] hover:bg-white/[0.08] text-lg flex items-center justify-center transition-all border border-white/[0.06]",children:e},e))}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("button",{onClick:()=>W(!Y),className:(0,k.cn)("w-10 h-10 rounded-full flex items-center justify-center transition-all",Y?"bg-amber-500 text-black":"bg-white/[0.04] text-white/50 hover:text-white border border-white/[0.06]"),children:(0,i.jsx)(T.MessageSquare,{className:"w-4 h-4"})}),ee?(0,i.jsx)("button",{onClick:J,className:(0,k.cn)("w-12 h-12 rounded-full flex items-center justify-center transition-all",G?"bg-red-500/10 text-red-400 border border-red-500/20":"bg-amber-500 text-black shadow-sm"),children:G?(0,i.jsx)(C.MicOff,{className:"w-5 h-5"}):(0,i.jsx)(f.Mic,{className:"w-5 h-5"})}):(0,i.jsx)("button",{onClick:H,className:(0,k.cn)("w-12 h-12 rounded-full flex items-center justify-center transition-all",D?"bg-amber-500 text-black shadow-sm":"bg-white/[0.04] text-white/50 hover:text-white border border-white/[0.06]"),children:(0,i.jsx)(R.Hand,{className:"w-5 h-5"})})]})]})})]})}try{a=(()=>{let e=Error("Cannot find module '../../../convex/_generated/api'");throw e.code="MODULE_NOT_FOUND",e})().api}catch{a=null}let V=(0,s.createContext)(null);function z(){let e=(0,s.useContext)(V);if(!e)throw Error("useClubSpacesContext must be used within ClubSpacesApp");return e}function Y({initialRoomId:e,initialRoomData:t}={}){let{user:f,isLoaded:y}=(0,l.useUser)(),g=(0,c.useMutation)(a?.clubspaces?.createRoom||(async()=>({roomId:"",inviteToken:""}))),[j,v]=(0,s.useState)(e?"room":"lobby"),[N,k]=(0,s.useState)(t?.name||null),[C,P]=(0,s.useState)(e||null),[R,T]=(0,s.useState)(t?.inviteToken||null),[M,L]=(0,s.useState)(null),[O,E]=(0,s.useState)(null),[A,I]=(0,s.useState)(!1),D=function(){let[e,t]=(0,s.useState)(null),[a,i]=(0,s.useState)(!1),[n,r]=(0,s.useState)(new Map),[l,o]=(0,s.useState)(null),[c,d]=(0,s.useState)(null),[m,x]=(0,s.useState)([]),[u,h]=(0,s.useState)([]),[f,y]=(0,s.useState)("listener"),[g,j]=(0,s.useState)(!1),v=(0,s.useRef)(null),N=(0,s.useRef)(null),k=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!e||!a){k.current&&(clearInterval(k.current),k.current=null);return}return k.current=setInterval(()=>{let t=new Map,a=e.localParticipant;if(a){let e=a.audioTrackPublications.values().next().value,i=e?.track&&!e.isMuted?.3:0;t.set(a.identity,{identity:a.identity,name:a.name||"You",role:f,isMuted:e?.isMuted??!1,isSpeaking:i>.1,audioLevel:i,hasRaisedHand:g,joinedAt:Date.now()})}e.remoteParticipants.forEach(e=>{let a=e.audioTrackPublications.values().next().value,i=a?.track&&!a.isMuted?.3:0,s=e.metadata?JSON.parse(e.metadata).role:"listener",n=!!e.metadata&&!0===JSON.parse(e.metadata).hasRaisedHand;t.set(e.identity,{identity:e.identity,name:e.name||e.identity,role:s,isMuted:a?.isMuted??!1,isSpeaking:i>.1,audioLevel:i,hasRaisedHand:n,joinedAt:e.joinedAt?.getTime()??Date.now()})}),r(t);let i=t.get(e.localParticipant.identity);i&&o(i)},100),()=>{k.current&&(clearInterval(k.current),k.current=null)}},[e,a,f,g]);let S=(0,s.useCallback)(async(e,a="listener",s)=>{try{w("Connecting to room",{roomName:e,role:a}),y(a);let n=await fetch("/api/livekit/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomName:e})});if(!n.ok)throw Error(`Token generation failed: ${n.statusText}`);let{token:l,url:c}=await n.json(),m=new p.Room;if(v.current=m,m.on(p.RoomEvent.Connected,()=>{w("Room connected"),i(!0),t(m)}),m.on(p.RoomEvent.Disconnected,()=>{w("Room disconnected"),i(!1),t(null),r(new Map),o(null)}),m.on(p.RoomEvent.ParticipantConnected,e=>{w("Participant connected",{identity:e.identity})}),m.on(p.RoomEvent.ParticipantDisconnected,e=>{w("Participant disconnected",{identity:e.identity}),r(t=>{let a=new Map(t);return a.delete(e.identity),a})}),m.on(p.RoomEvent.TrackSubscribed,(e,t,a)=>{w("Track subscribed",{kind:e.kind,participant:a.identity})}),await m.connect(c,l),await m.localParticipant.setMetadata(JSON.stringify({role:a,hasRaisedHand:!1})),"host"===a&&s){let t={name:e,description:s.description,topics:s.topics,isPublic:s.isPublic??!0,maxSpeakers:s.maxSpeakers??13,hostIdentity:m.localParticipant.identity,createdAt:Date.now(),scheduledFor:s.scheduledFor};d(t),await m.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({type:"room_metadata",data:t})),{reliable:!0})}if(m.on(p.RoomEvent.DataReceived,(e,t)=>{try{let t=JSON.parse(new TextDecoder().decode(e));"room_metadata"===t.type?d(t.data):"chat_message"===t.type?x(e=>[...e,t.data]):"reaction"===t.type?h(e=>[...e,t.data]):"role_update"===t.type&&t.identity===m.localParticipant.identity&&y(t.role)}catch(e){}}),"listener"!==a){let e=await (0,p.createLocalAudioTrack)({echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0});N.current=e,await m.localParticipant.publishTrack(e,{source:p.Track.Source.Microphone}),w("Local audio track published")}else w("Joined as listener (no audio track)")}catch(e){throw console.error(`${b} Connection failed`,e??""),e}},[]),C=(0,s.useCallback)(async()=>{w("Disconnecting from room"),k.current&&(clearInterval(k.current),k.current=null),N.current&&(N.current.stop(),N.current=null),v.current&&(await v.current.disconnect(),v.current=null),i(!1),t(null),r(new Map),o(null)},[]),P=(0,s.useCallback)(()=>{let e=N.current;e&&(e.isMuted?e.unmute():e.mute())},[]),R=(0,s.useCallback)(async()=>{if(!e)return;let t=!g;j(t),await e.localParticipant.setMetadata(JSON.stringify({role:f,hasRaisedHand:t})),t&&await e.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({type:"hand_raised",identity:e.localParticipant.identity,name:e.localParticipant.name})),{reliable:!0})},[e,g,f]),T=(0,s.useCallback)(async t=>{if(!e||!t.trim())return;let a={id:`msg-${Date.now()}`,participantIdentity:e.localParticipant.identity,participantName:e.localParticipant.name||"You",content:t.trim(),timestamp:Date.now(),type:"text"};x(e=>[...e,a]),await e.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({type:"chat_message",data:a})),{reliable:!0})},[e]),M=(0,s.useCallback)(async t=>{if(!e)return;let a={emoji:t,participantIdentity:e.localParticipant.identity,timestamp:Date.now()};h(e=>[...e,a]),await e.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({type:"reaction",data:a})),{reliable:!0}),setTimeout(()=>{h(e=>e.filter(e=>e.timestamp!==a.timestamp))},3e3)},[e]),L=(0,s.useCallback)(async t=>{e&&("host"===f||"co-host"===f)&&await e.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({type:"role_update",identity:t,role:"speaker"})),{reliable:!0})},[e,f]),O=(0,s.useCallback)(async t=>{if(!e||"host"!==f&&"co-host"!==f)return;let a=e.remoteParticipants.get(t);a&&a.audioTrackPublications.values().next().value?.track&&await e.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({type:"mute_request",identity:t})),{reliable:!0})},[e,f]);return{room:e,isConnected:a,participants:Array.from(n.values()),localParticipant:l,localRole:f,roomMetadata:c,chatMessages:m,reactions:u,hasRaisedHand:g,connect:S,disconnect:C,toggleMute:P,raiseHand:R,sendChatMessage:T,sendReaction:M,promoteToSpeaker:L,muteParticipant:O}}(),{room:J,connect:U,disconnect:H,isConnected:_}=D;(0,s.useEffect)(()=>{f&&"signin"===j&&v("lobby")},[f,j]),(0,s.useEffect)(()=>{f&&M&&("create"===M.type?$(...M.args):K(M.args[0]),L(null))},[f,M]);let F=e=>{let t=e instanceof Error?e.message:String(e);return t.includes("could not establish signal connection")||t.includes("Failed to fetch")?"LiveKit server is unreachable. Make sure your self-hosted LiveKit server is running and accessible.":t.includes("Token generation failed")||t.includes("LiveKit server not configured")?"LiveKit credentials are not configured. Check your LIVEKIT_API_KEY and LIVEKIT_API_SECRET environment variables.":t.includes("CORS")?"LiveKit server is blocking cross-origin requests. Check your Cloudflare Tunnel and CORS configuration.":`Connection failed: ${t}`},$=async(e,t,i)=>{if(!f){L({type:"create",args:[e,t,i]}),v("signin");return}I(!0),E(null);try{let s,n;if(a?.clubspaces?.createRoom){let a=await g({name:e,description:t,topics:i||[],isPublic:!0,hostClerkId:f.id,hostName:f.fullName||f.firstName||f.emailAddresses[0]?.emailAddress||"Host",maxSpeakers:13});s=a.roomId,n=a.inviteToken}else console.error("Convex API not available - using fallback room creation"),s=`room-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n=Math.random().toString(36).substr(2,16);P(s),k(e),T(n),await U(s,"host",{description:t,topics:i||[],isPublic:!0}),window.history.pushState({},"",`/clubspaces/room/${s}`),v("room")}catch(e){console.error("Failed to create room:",e),E(F(e)),v("error")}finally{I(!1)}},K=async e=>{if(!f){L({type:"join",args:[e]}),v("signin");return}I(!0),E(null);let t=e;e.includes("/clubspaces/room/")?t=e.split("/clubspaces/room/")[1]:e.includes("/clubspaces/invite/")&&(t=e.split("/clubspaces/invite/")[1]);try{k(t),P(t),await U(t,"listener"),window.history.pushState({},"",`/clubspaces/room/${t}`),v("room")}catch(e){console.error("Failed to join room:",e),E(F(e)),v("error")}finally{I(!1)}},z=async()=>{await H(),k(null),P(null),E(null),window.history.pushState({},"","/clubspaces"),v("lobby")};return(0,s.useEffect)(()=>{"room"!==j||_||(v("lobby"),k(null))},[_,j]),(0,i.jsx)(V.Provider,{value:D,children:(0,i.jsx)("div",{className:"min-h-dvh bg-black",children:(0,i.jsx)(r.AnimatePresence,{mode:"wait",children:"error"===j?(0,i.jsx)(n.motion.div,{initial:{opacity:0,scale:.97},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.97},transition:{duration:.3},className:"min-h-dvh flex flex-col items-center justify-center p-4 bg-black",children:(0,i.jsxs)("div",{className:"max-w-md w-full text-center",children:[(0,i.jsx)("div",{className:"w-14 h-14 rounded-2xl bg-red-500/10 border border-red-500/20 flex items-center justify-center mx-auto mb-6",children:(0,i.jsx)(h.default,{className:"w-7 h-7 text-red-400"})}),(0,i.jsx)("h1",{className:"text-xl font-bold text-white mb-2",children:"Connection Failed"}),(0,i.jsx)("p",{className:"text-white/50 text-sm mb-6 leading-relaxed",children:O}),(0,i.jsxs)("div",{className:"bg-white/[0.03] border border-white/[0.06] rounded-xl p-4 mb-6 text-left",children:[(0,i.jsx)("p",{className:"text-white/30 text-xs font-medium uppercase tracking-wider mb-3",children:"Troubleshooting"}),(0,i.jsxs)("ul",{className:"space-y-2 text-white/40 text-xs",children:[(0,i.jsxs)("li",{className:"flex items-start gap-2",children:[(0,i.jsx)(u.Wifi,{className:"w-3.5 h-3.5 text-amber-500/60 mt-0.5 shrink-0"}),(0,i.jsxs)("span",{children:["Ensure LiveKit Server is running (",(0,i.jsx)("code",{className:"text-amber-500/80 bg-white/[0.04] px-1 rounded",children:"docker ps"}),")"]})]}),(0,i.jsxs)("li",{className:"flex items-start gap-2",children:[(0,i.jsx)(u.Wifi,{className:"w-3.5 h-3.5 text-amber-500/60 mt-0.5 shrink-0"}),(0,i.jsx)("span",{children:"Check Cloudflare Tunnel is active and routing to port 7880"})]}),(0,i.jsxs)("li",{className:"flex items-start gap-2",children:[(0,i.jsx)(u.Wifi,{className:"w-3.5 h-3.5 text-amber-500/60 mt-0.5 shrink-0"}),(0,i.jsxs)("span",{children:["Verify ",(0,i.jsx)("code",{className:"text-amber-500/80 bg-white/[0.04] px-1 rounded",children:"LIVEKIT_URL"})," env var in Vercel matches your tunnel URL"]})]})]})]}),(0,i.jsxs)("div",{className:"flex gap-3",children:[(0,i.jsxs)("button",{onClick:()=>{E(null),v("lobby")},className:"flex-1 px-5 py-3 bg-amber-500 hover:bg-amber-400 text-black font-semibold rounded-xl transition-colors flex items-center justify-center gap-2",children:[(0,i.jsx)(x.RefreshCw,{className:"w-4 h-4"}),"Try Again"]}),(0,i.jsx)("button",{onClick:()=>{window.history.pushState({},"","/clubspaces"),v("lobby"),E(null)},className:"px-5 py-3 bg-white/[0.06] hover:bg-white/10 text-white/60 hover:text-white rounded-xl transition-colors border border-white/[0.06]",children:"Back"})]})]})},"error"):"signin"===j?(0,i.jsx)(n.motion.div,{initial:{opacity:0,scale:.97},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.97},transition:{duration:.3},className:"min-h-dvh flex flex-col items-center justify-center p-4 bg-black",children:(0,i.jsxs)("div",{className:"max-w-sm w-full text-center",children:[(0,i.jsx)("div",{className:"w-14 h-14 rounded-2xl bg-amber-500 flex items-center justify-center mx-auto mb-6",children:(0,i.jsx)(m.Radio,{className:"w-7 h-7 text-black"})}),(0,i.jsx)("h1",{className:"text-2xl font-bold text-white mb-2",children:"Sign in to continue"}),(0,i.jsx)("p",{className:"text-white/40 text-sm mb-8",children:"Sign in to create or join audio rooms"}),(0,i.jsx)(o.SignInButton,{mode:"modal",forceRedirectUrl:"/clubspaces",children:(0,i.jsxs)("button",{className:"w-full px-6 py-3.5 bg-amber-500 hover:bg-amber-400 text-black font-semibold rounded-xl transition-colors flex items-center justify-center gap-2",children:[(0,i.jsx)(d.LogIn,{className:"w-4 h-4"}),"Sign In"]})}),(0,i.jsx)("button",{onClick:()=>{L(null),v("lobby")},className:"mt-4 text-sm text-white/30 hover:text-white/60 transition-colors",children:"Back to lobby"})]})},"signin"):"lobby"===j?(0,i.jsx)(n.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:(0,i.jsx)(S,{onCreateRoom:$,onJoinRoom:K,user:f,isConnecting:A})},"lobby"):(0,i.jsx)(n.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.3},children:(0,i.jsx)(B,{roomName:N,roomId:C,inviteToken:R,room:J,onLeave:z})},"room")})})})}}]);