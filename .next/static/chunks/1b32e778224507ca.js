(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,750365,e=>{"use strict";var t=e.i(726151),s=e.i(923041),r=e.i(17233),a=e.i(278124),l=e.i(940945),n=e.i(426710),i=e.i(266795),o=e.i(982512),c=e.i(86066),d=e.i(298130),m=e.i(746115),u=e.i(975157),h=e.i(850402),x=e.i(946200),p=e.i(662582),g=e.i(55841),f=e.i(827447),y=e.i(254862),v=e.i(591372),b=e.i(678295),j=e.i(950717),w=e.i(752153),N=e.i(734545),k=e.i(831160),k=k,C=e.i(371196),S=e.i(263012),A=e.i(517703);function T({isOpen:e,onClose:s,threads:r,activeThreadId:l,onNewThread:n,onSelectThread:i,onDeleteThread:o,memoryStats:c={episodic:0,semantic:0,working:0},recentMentions:d=[],activeTask:m=null,onMentionClick:h}){return(0,t.jsx)(a.AnimatePresence,{children:e&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},onClick:s,className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-40 lg:hidden"}),(0,t.jsxs)(p.motion.aside,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"-100%",opacity:0},transition:{type:"spring",damping:30,stiffness:300},className:(0,u.cn)("fixed lg:relative inset-y-0 left-0 z-50 lg:z-auto","w-80 max-w-[85vw] lg:w-72 xl:w-80","flex flex-col","touch-none lg:touch-auto"),style:{paddingTop:"env(safe-area-inset-top, 0px)",paddingBottom:"env(safe-area-inset-bottom, 0px)",background:"hsl(var(--theme-chat-sidebar-bg, var(--theme-card)))",borderRight:"1px solid hsl(var(--theme-chat-sidebar-border, var(--theme-border)))",fontFamily:"var(--theme-font)"},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 py-4",style:{borderBottom:"1px solid hsl(var(--theme-border))"},children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{background:"hsl(var(--theme-primary) / 0.2)"},children:(0,t.jsx)(N.Zap,{className:"w-4 h-4",style:{color:"hsl(var(--theme-primary))"}})}),(0,t.jsx)("h2",{className:"text-lg font-semibold",style:{color:"hsl(var(--theme-foreground))"},children:"Agent"})]}),(0,t.jsx)("button",{onClick:s,className:"p-2 rounded-full transition-colors lg:hidden",style:{color:"hsl(var(--theme-muted-foreground))"},onMouseEnter:e=>e.currentTarget.style.background="hsl(var(--theme-muted))",onMouseLeave:e=>e.currentTarget.style.background="transparent",children:(0,t.jsx)(v.X,{className:"w-5 h-5"})})]}),(0,t.jsx)("div",{className:"px-3 py-3",children:(0,t.jsxs)("button",{onClick:()=>{n(),s()},className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all",style:{background:"hsl(var(--theme-primary))",color:"hsl(var(--theme-primary-foreground))"},onMouseEnter:e=>e.currentTarget.style.opacity="0.9",onMouseLeave:e=>e.currentTarget.style.opacity="1",children:[(0,t.jsx)(g.Plus,{className:"w-5 h-5"}),(0,t.jsx)("span",{className:"font-medium",children:"New session"})]})}),m&&(0,t.jsx)("div",{className:"px-3 pb-2",children:(0,t.jsxs)("div",{className:"px-3 py-2.5 rounded-lg bg-muted/50 border border-border",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("div",{className:(0,u.cn)("w-2 h-2 rounded-full","running"===m.status&&"bg-green-400 animate-pulse","paused"===m.status&&"bg-yellow-400","completed"===m.status&&"bg-blue-400","failed"===m.status&&"bg-red-400","pending"===m.status&&"bg-muted-foreground")}),(0,t.jsx)("span",{className:(0,u.cn)("text-xs font-medium uppercase",function(e){switch(e){case"running":return"text-green-400";case"paused":return"text-yellow-400";case"failed":return"text-red-400";case"completed":return"text-blue-400";default:return"text-muted-foreground"}}(m.status)),children:m.status})]}),(0,t.jsx)("p",{className:"text-sm text-foreground truncate",children:m.title}),void 0!==m.progress&&(0,t.jsx)("div",{className:"mt-2 h-1 rounded-full bg-muted overflow-hidden",children:(0,t.jsx)(p.motion.div,{className:"h-full bg-primary",initial:{width:0},animate:{width:`${m.progress}%`},transition:{duration:.3}})})]})}),(0,t.jsx)("div",{className:"px-3 pb-2",children:(0,t.jsxs)("div",{className:"px-3 py-2 rounded-lg",style:{background:"hsl(var(--theme-muted) / 0.3)"},children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(b.Brain,{className:"w-4 h-4",style:{color:"hsl(var(--theme-muted-foreground))"}}),(0,t.jsx)("span",{className:"text-xs font-medium uppercase tracking-wide",style:{color:"hsl(var(--theme-muted-foreground))"},children:"Memory"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-lg font-semibold",style:{color:"hsl(var(--theme-foreground))"},children:c.episodic}),(0,t.jsx)("div",{className:"text-[10px]",style:{color:"hsl(var(--theme-muted-foreground))"},children:"Episodic"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-lg font-semibold",style:{color:"hsl(var(--theme-foreground))"},children:c.semantic}),(0,t.jsx)("div",{className:"text-[10px]",style:{color:"hsl(var(--theme-muted-foreground))"},children:"Semantic"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-lg font-semibold",style:{color:"hsl(var(--theme-foreground))"},children:c.working}),(0,t.jsx)("div",{className:"text-[10px]",style:{color:"hsl(var(--theme-muted-foreground))"},children:"Working"})]})]})]})}),d.length>0&&(0,t.jsxs)("div",{className:"px-3 pb-2",children:[(0,t.jsx)("div",{className:"px-1 mb-2",children:(0,t.jsxs)("span",{className:"text-xs font-medium uppercase tracking-wide flex items-center gap-1.5",style:{color:"hsl(var(--theme-muted-foreground))"},children:[(0,t.jsx)(k.default,{className:"w-3 h-3"}),"Recent Mentions"]})}),(0,t.jsx)("div",{className:"space-y-1",children:d.slice(0,5).map(e=>{let s=function(e){switch(e){case"project":return S.Folder;case"prd":return A.FileText;case"ticket":case"file":return C.FileCode;default:return k.default}}(e.type);return(0,t.jsxs)("button",{onClick:()=>h?.(e),className:"w-full flex items-center gap-2 px-2 py-1.5 rounded-md transition-colors text-left",onMouseEnter:e=>e.currentTarget.style.background="hsl(var(--theme-muted))",onMouseLeave:e=>e.currentTarget.style.background="transparent",children:[(0,t.jsx)(s,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:"hsl(var(--theme-muted-foreground))"}}),(0,t.jsxs)("span",{className:"text-sm truncate flex-1",style:{color:"hsl(var(--theme-foreground))"},children:["@",e.name]}),(0,t.jsx)(w.ChevronRight,{className:"w-3 h-3",style:{color:"hsl(var(--theme-muted-foreground) / 0.5)"}})]},e.id)})})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto px-3 pb-3",children:[(0,t.jsx)("div",{className:"px-1 mb-2",children:(0,t.jsxs)("span",{className:"text-xs font-medium uppercase tracking-wide flex items-center gap-1.5",style:{color:"hsl(var(--theme-muted-foreground))"},children:[(0,t.jsx)(f.MessageSquare,{className:"w-3 h-3"}),"Sessions"]})}),0===r.length?(0,t.jsxs)("div",{className:"text-center py-8 px-4",children:[(0,t.jsx)(f.MessageSquare,{className:"w-12 h-12 mx-auto mb-3",style:{color:"hsl(var(--theme-muted-foreground) / 0.3)"}}),(0,t.jsx)("p",{className:"text-sm",style:{color:"hsl(var(--theme-muted-foreground))"},children:"No sessions yet"}),(0,t.jsx)("p",{className:"text-xs mt-1",style:{color:"hsl(var(--theme-muted-foreground) / 0.7)"},children:"Start a new session to begin"})]}):(0,t.jsx)("div",{className:"space-y-1",children:r.map(e=>{var r;let a,n,c,d;return(0,t.jsxs)(p.motion.div,{layout:!0,initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"group relative",children:[(0,t.jsx)("button",{onClick:()=>{i(e.id),window.innerWidth<1024&&s()},className:"w-full text-left px-3 py-2.5 rounded-lg transition-all",style:{background:e.id===l?"hsl(var(--theme-primary) / 0.1)":"transparent",borderLeft:e.id===l?"2px solid hsl(var(--theme-chat-sidebar-active, var(--theme-primary)))":"2px solid transparent"},onMouseEnter:t=>{e.id!==l&&(t.currentTarget.style.background="hsl(var(--theme-chat-sidebar-hover, var(--theme-muted)))")},onMouseLeave:t=>{e.id!==l&&(t.currentTarget.style.background="transparent")},children:(0,t.jsxs)("div",{className:"flex items-start gap-2.5",children:[(0,t.jsx)(f.MessageSquare,{className:"w-4 h-4 mt-0.5 flex-shrink-0",style:{color:e.id===l?"hsl(var(--theme-primary))":"hsl(var(--theme-muted-foreground))"}}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-medium truncate",style:{color:e.id===l?"hsl(var(--theme-foreground))":"hsl(var(--theme-muted-foreground))"},children:e.title}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-0.5",children:[(0,t.jsxs)("span",{className:"text-[10px]",style:{color:"hsl(var(--theme-muted-foreground) / 0.7)"},children:[e.messages.length," msg",1!==e.messages.length?"s":""]}),(0,t.jsx)("span",{className:"text-[10px]",style:{color:"hsl(var(--theme-muted-foreground) / 0.5)"},children:"·"}),(0,t.jsx)("span",{className:"text-[10px]",style:{color:"hsl(var(--theme-muted-foreground) / 0.7)"},children:(r=e.lastModified,n=Math.floor((a=Date.now()-r)/6e4),c=Math.floor(a/36e5),d=Math.floor(a/864e5),n<1?"Just now":n<60?`${n}m ago`:c<24?`${c}h ago`:d<7?`${d}d ago`:new Date(r).toLocaleDateString())})]})]})]})}),(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),o(e.id)},className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 rounded-md opacity-0 group-hover:opacity-100 focus:opacity-100 transition-opacity","aria-label":"Delete session",style:{background:"hsl(var(--theme-muted))"},onMouseEnter:e=>e.currentTarget.style.background="hsl(0 84% 60% / 0.2)",onMouseLeave:e=>e.currentTarget.style.background="hsl(var(--theme-muted))",children:(0,t.jsx)(y.Trash2,{className:"w-3.5 h-3.5",style:{color:"hsl(var(--theme-muted-foreground))"}})})]},e.id)})})]}),(0,t.jsx)("div",{className:"px-4 py-3",style:{borderTop:"1px solid hsl(var(--theme-border))"},children:(0,t.jsxs)("div",{className:"flex items-center justify-between text-xs",style:{color:"hsl(var(--theme-muted-foreground))"},children:[(0,t.jsxs)("span",{children:[r.length," session",1!==r.length?"s":""]}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(j.Database,{className:"w-3 h-3"}),(0,t.jsx)("span",{children:"Convex"})]})]})})]})]})})}var E=e.i(973493),M=e.i(461321),R=e.i(384785),F=e.i(34345),L=e.i(481532),L=L,$=e.i(580393);let P={project:{icon:S.Folder,color:"text-blue-400",label:"Project"},prd:{icon:A.FileText,color:"text-purple-400",label:"PRD"},epic:{icon:R.Layers,color:"text-amber-400",label:"Epic"},ticket:{icon:M.Ticket,color:"text-green-400",label:"Ticket"},file:{icon:C.FileCode,color:"text-orange-400",label:"File"}},I={chat:{icon:F.Eye,label:"Chat"},code:{icon:o.Code,label:"Code"},kanban:{icon:L.default,label:"Kanban"},docs:{icon:$.BookOpen,label:"Docs"}};function D({entity:e,isLast:r,onClick:l,onRemove:n}){let[i,o]=(0,s.useState)(!1),c=P[e.type],d=c.icon;return(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsxs)(p.motion.div,{layout:!0,className:(0,u.cn)("relative group flex items-center gap-1.5 px-2 py-1 rounded-md","transition-colors cursor-pointer",i?"bg-muted":"hover:bg-muted/50"),onClick:l,children:[(0,t.jsx)(d,{className:(0,u.cn)("w-3.5 h-3.5",c.color)}),(0,t.jsxs)("span",{className:"text-sm text-foreground font-medium",children:["@",e.name]}),e.status&&(0,t.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-muted text-muted-foreground uppercase",children:e.status}),(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),n()},className:"absolute -right-1 -top-1 w-4 h-4 rounded-full bg-muted-foreground/20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity hover:bg-destructive/50",children:(0,t.jsx)(v.X,{className:"w-2.5 h-2.5 text-muted-foreground"})}),(0,t.jsx)(a.AnimatePresence,{children:i&&e.description&&(0,t.jsxs)(p.motion.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"absolute top-full left-0 mt-1 z-50 w-64 p-3 rounded-lg bg-popover border border-border shadow-lg",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(d,{className:(0,u.cn)("w-4 h-4",c.color)}),(0,t.jsx)("span",{className:"text-xs font-medium text-muted-foreground uppercase",children:c.label})]}),(0,t.jsx)("p",{className:"text-sm text-foreground font-medium mb-1",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground line-clamp-3",children:e.description})]})})]}),!r&&(0,t.jsx)(w.ChevronRight,{className:"w-4 h-4 text-muted-foreground/50 mx-1 flex-shrink-0"})]})}function O({currentView:e,onViewChange:r}){let[l,n]=(0,s.useState)(!1),i=(0,s.useRef)(null),o=I[e],c=o.icon;return(0,s.useEffect)(()=>{function e(e){i.current&&!i.current.contains(e.target)&&n(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,t.jsxs)("div",{className:"relative",ref:i,children:[(0,t.jsxs)("button",{onClick:()=>n(!l),className:(0,u.cn)("flex items-center gap-2 px-3 py-1.5 rounded-md","text-sm font-medium transition-colors","bg-muted/50 hover:bg-muted text-foreground"),children:[(0,t.jsx)(c,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:o.label}),(0,t.jsx)(E.ChevronDown,{className:(0,u.cn)("w-3.5 h-3.5 transition-transform",l&&"rotate-180")})]}),(0,t.jsx)(a.AnimatePresence,{children:l&&(0,t.jsx)(p.motion.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"absolute top-full right-0 mt-1 z-50 w-40 rounded-lg bg-popover border border-border shadow-lg overflow-hidden",children:Object.entries(I).map(([s,a])=>{let l=a.icon;return(0,t.jsxs)("button",{onClick:()=>{r(s),n(!1)},className:(0,u.cn)("w-full flex items-center gap-2 px-3 py-2 text-sm transition-colors",s===e?"bg-primary/10 text-primary":"hover:bg-muted text-foreground"),children:[(0,t.jsx)(l,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:a.label})]},s)})})})]})}function _({contextChain:e,currentView:s,onViewChange:r,onEntityClick:a,onRemoveEntity:l,onClearContext:n,className:i}){return(0,t.jsxs)("div",{className:(0,u.cn)("flex items-center justify-between gap-4 px-4 py-2","bg-card/50 border-b border-border backdrop-blur-sm",i),children:[(0,t.jsx)("div",{className:"flex items-center gap-1 overflow-x-auto hide-scrollbar",children:0===e.length?(0,t.jsx)("span",{className:"text-sm text-muted-foreground italic",children:"No context selected - type @ to add"}):(0,t.jsxs)(t.Fragment,{children:[e.map((s,r)=>(0,t.jsx)(D,{entity:s,isLast:r===e.length-1,onClick:()=>a(s),onRemove:()=>l(s.id)},s.id)),e.length>1&&(0,t.jsx)("button",{onClick:n,className:"ml-2 p-1 rounded hover:bg-muted transition-colors",title:"Clear all context",children:(0,t.jsx)(v.X,{className:"w-4 h-4 text-muted-foreground"})})]})}),(0,t.jsx)(O,{currentView:s,onViewChange:r})]})}var U=e.i(945388),U=U,z=e.i(961226),B=e.i(651555),H=e.i(274453),G=e.i(963268),q=e.i(981779),X=e.i(8722),V=e.i(573138),W=e.i(206449);function K({tab:e,isActive:s,onClick:r,icon:a,label:l,badge:n}){return(0,t.jsxs)("button",{onClick:r,className:(0,u.cn)("flex items-center gap-2 px-3 py-2 text-sm font-medium transition-colors relative",s?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground"),children:[(0,t.jsx)(a,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:l}),void 0!==n&&n>0&&(0,t.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 rounded-full bg-primary text-primary-foreground text-[10px] flex items-center justify-center",children:n})]})}function J({node:e,depth:r,onSelect:a,selectedPath:l}){let[n,i]=(0,s.useState)(e.isOpen??!1),o=l===e.path;return(0,t.jsxs)("div",{children:[(0,t.jsxs)("button",{onClick:()=>{"folder"===e.type?i(!n):a(e.path)},className:(0,u.cn)("w-full flex items-center gap-1.5 px-2 py-1 text-sm transition-colors rounded",o?"bg-primary/20 text-primary":"hover:bg-muted text-foreground"),style:{paddingLeft:`${12*r+8}px`},children:["folder"===e.type?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.ChevronRight,{className:(0,u.cn)("w-3 h-3 text-muted-foreground transition-transform",n&&"rotate-90")}),(0,t.jsx)(S.Folder,{className:"w-4 h-4 text-amber-400"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"w-3"}),(0,t.jsx)(G.File,{className:"w-4 h-4 text-blue-400"})]}),(0,t.jsx)("span",{className:"truncate",children:e.name})]}),"folder"===e.type&&n&&e.children&&(0,t.jsx)("div",{children:e.children.map(e=>(0,t.jsx)(J,{node:e,depth:r+1,onSelect:a,selectedPath:l},e.path))})]})}function Y({code:e,language:r,onChange:a,readOnly:l=!1}){let[n,i]=(0,s.useState)(!1),o=(0,s.useRef)(null),c=async()=>{await navigator.clipboard.writeText(e),i(!0),setTimeout(()=>i(!1),2e3)},d=Array.from({length:e.split("\n").length},(e,t)=>t+1);return(0,t.jsxs)("div",{className:"relative h-full flex flex-col bg-[#1e1e1e] rounded-lg overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/10",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground font-mono",children:r}),(0,t.jsx)("button",{onClick:c,className:"p-1.5 rounded hover:bg-white/10 transition-colors",title:"Copy code",children:n?(0,t.jsx)(X.Check,{className:"w-4 h-4 text-green-400"}):(0,t.jsx)(q.Copy,{className:"w-4 h-4 text-muted-foreground"})})]}),(0,t.jsxs)("div",{className:"flex-1 flex overflow-auto",children:[(0,t.jsx)("div",{className:"flex-shrink-0 px-3 py-2 text-right text-xs text-muted-foreground/50 font-mono select-none border-r border-white/5",children:d.map(e=>(0,t.jsx)("div",{className:"leading-6",children:e},e))}),(0,t.jsx)("div",{className:"flex-1 relative",children:(0,t.jsx)("textarea",{ref:o,value:e,onChange:e=>a?.(e.target.value),readOnly:l,className:(0,u.cn)("absolute inset-0 w-full h-full px-4 py-2 bg-transparent resize-none","font-mono text-sm text-white leading-6","focus:outline-none",l&&"cursor-default"),spellCheck:!1})})]})]})}function Q({output:e,onRunCommand:r,isRunning:a}){let[l,n]=(0,s.useState)(""),i=(0,s.useRef)(null);return(0,s.useEffect)(()=>{i.current&&(i.current.scrollTop=i.current.scrollHeight)},[e]),(0,t.jsxs)("div",{className:"h-full flex flex-col bg-[#1e1e1e] rounded-lg overflow-hidden font-mono",children:[(0,t.jsxs)("div",{ref:i,className:"flex-1 overflow-auto p-3 space-y-1",children:[0===e.length?(0,t.jsx)("div",{className:"text-muted-foreground text-sm",children:"Terminal ready. Type a command to get started."}):e.map(e=>(0,t.jsxs)("div",{className:(0,u.cn)("text-sm whitespace-pre-wrap","command"===e.type&&"text-green-400","output"===e.type&&"text-white/80","error"===e.type&&"text-red-400"),children:["command"===e.type&&(0,t.jsx)("span",{className:"text-muted-foreground",children:"$ "}),e.content]},e.id)),a&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-400 animate-pulse"}),"Running..."]})]}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),l.trim()&&!a&&(r(l.trim()),n(""))},className:"flex items-center gap-2 px-3 py-2 border-t border-white/10",children:[(0,t.jsx)("span",{className:"text-green-400 text-sm",children:"$"}),(0,t.jsx)("input",{type:"text",value:l,onChange:e=>n(e.target.value),disabled:a,className:"flex-1 bg-transparent text-sm text-white focus:outline-none disabled:opacity-50",placeholder:"Enter command...",autoCapitalize:"off",autoCorrect:"off",autoComplete:"off",spellCheck:!1}),(0,t.jsx)("button",{type:"submit",disabled:!l.trim()||a,className:"p-1.5 rounded hover:bg-white/10 transition-colors disabled:opacity-50",children:(0,t.jsx)(c.Play,{className:"w-4 h-4 text-green-400"})})]})]})}function Z({url:e,onRefresh:r}){let[a,l]=(0,s.useState)(!0);return e?(0,t.jsxs)("div",{className:"h-full flex flex-col bg-card rounded-lg overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 border-b border-border",children:[(0,t.jsx)("button",{onClick:r,className:"p-1.5 rounded hover:bg-muted transition-colors",title:"Refresh",children:(0,t.jsx)(V.RefreshCw,{className:(0,u.cn)("w-4 h-4 text-muted-foreground",a&&"animate-spin")})}),(0,t.jsx)("div",{className:"flex-1 px-3 py-1.5 rounded bg-muted text-sm text-muted-foreground truncate",children:e}),(0,t.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 rounded hover:bg-muted transition-colors",title:"Open in new tab",children:(0,t.jsx)(W.ExternalLink,{className:"w-4 h-4 text-muted-foreground"})})]}),(0,t.jsxs)("div",{className:"flex-1 relative",children:[a&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-muted/50",children:(0,t.jsx)(V.RefreshCw,{className:"w-6 h-6 text-muted-foreground animate-spin"})}),(0,t.jsx)("iframe",{src:e,className:"w-full h-full border-0",onLoad:()=>l(!1),title:"Preview"})]})]}):(0,t.jsxs)("div",{className:"h-full flex flex-col items-center justify-center bg-muted/20 rounded-lg",children:[(0,t.jsx)(F.Eye,{className:"w-12 h-12 text-muted-foreground/30 mb-3"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No preview available"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground/70 mt-1",children:"Run a dev server to see the preview"})]})}function ee({isVisible:e,isExpanded:s,activeTab:r,onTabChange:l,onToggleExpanded:n,onClose:i,code:c,language:d,currentFile:m,onCodeChange:h,files:x,onFileSelect:g,terminalOutput:f,onRunCommand:y,isRunning:b=!1,previewUrl:j,onRefreshPreview:w}){return e?(0,t.jsxs)(p.motion.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:(0,u.cn)("bg-card border-t border-border flex flex-col",s?"h-[70vh]":"h-[300px] md:h-[350px]"),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 border-b border-border",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(K,{tab:"code",isActive:"code"===r,onClick:()=>l("code"),icon:o.Code,label:"Code"}),(0,t.jsx)(K,{tab:"files",isActive:"files"===r,onClick:()=>l("files"),icon:U.default,label:"Files"}),(0,t.jsx)(K,{tab:"terminal",isActive:"terminal"===r,onClick:()=>l("terminal"),icon:z.Terminal,label:"Terminal",badge:f.filter(e=>"error"===e.type).length}),(0,t.jsx)(K,{tab:"preview",isActive:"preview"===r,onClick:()=>l("preview"),icon:F.Eye,label:"Preview"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[m&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground mr-2 hidden sm:block",children:m}),(0,t.jsx)("button",{onClick:n,className:"p-2 rounded hover:bg-muted transition-colors",title:s?"Minimize":"Maximize",children:s?(0,t.jsx)(H.Minimize2,{className:"w-4 h-4 text-muted-foreground"}):(0,t.jsx)(B.Maximize2,{className:"w-4 h-4 text-muted-foreground"})}),(0,t.jsx)("button",{onClick:i,className:"p-2 rounded hover:bg-muted transition-colors",title:"Close",children:(0,t.jsx)(v.X,{className:"w-4 h-4 text-muted-foreground"})})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-hidden p-3",children:(0,t.jsxs)(a.AnimatePresence,{mode:"wait",children:["code"===r&&(0,t.jsx)(p.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"h-full",children:(0,t.jsx)(Y,{code:c,language:d,onChange:h})},"code"),"files"===r&&(0,t.jsx)(p.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"h-full overflow-auto",children:(0,t.jsx)("div",{className:"space-y-0.5",children:0===x.length?(0,t.jsx)("div",{className:"text-sm text-muted-foreground text-center py-8",children:"No files in workspace"}):x.map(e=>(0,t.jsx)(J,{node:e,depth:0,onSelect:g||(()=>{}),selectedPath:m},e.path))})},"files"),"terminal"===r&&(0,t.jsx)(p.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"h-full",children:(0,t.jsx)(Q,{output:f,onRunCommand:y||(()=>{}),isRunning:b})},"terminal"),"preview"===r&&(0,t.jsx)(p.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"h-full",children:(0,t.jsx)(Z,{url:j,onRefresh:w||(()=>{})})},"preview")]})})]}):null}var et=e.i(726152),es=e.i(122429),er=e.i(950198),ea=e.i(305583),k=k,el=e.i(843762),en=e.i(536432),en=en,ei=e.i(384680),eo=e.i(657912),ec=e.i(230374),ed=e.i(770651);let em={project:S.Folder,prd:A.FileText,epic:A.FileText,ticket:M.Ticket,file:C.FileCode},eu={project:"text-blue-400",prd:"text-purple-400",epic:"text-amber-400",ticket:"text-green-400",file:"text-orange-400"};function eh({tool:e}){return(0,t.jsxs)("div",{className:"rounded-lg p-3",style:{background:"hsl(var(--theme-muted) / 0.5)",border:"1px solid hsl(var(--theme-border))"},children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)("div",{className:"w-6 h-6 rounded-md flex items-center justify-center",style:{background:"complete"===e.status&&e.result?.success?"hsl(142 70% 45% / 0.2)":"complete"!==e.status||e.result?.success?"executing"===e.status?"hsl(var(--theme-primary) / 0.2)":"hsl(var(--theme-muted))":"hsl(0 84% 60% / 0.2)"},children:"executing"===e.status?(0,t.jsx)(m.Loader2,{className:"w-3.5 h-3.5 animate-spin",style:{color:"hsl(var(--theme-primary))"}}):"complete"===e.status&&e.result?.success?(0,t.jsx)(X.Check,{className:"w-3.5 h-3.5",style:{color:"hsl(142 70% 45%)"}}):"complete"!==e.status||e.result?.success?(0,t.jsx)(el.Sparkles,{className:"w-3.5 h-3.5",style:{color:"hsl(var(--theme-muted-foreground))"}}):(0,t.jsx)(v.X,{className:"w-3.5 h-3.5",style:{color:"hsl(0 84% 60%)"}})}),(0,t.jsx)("span",{className:"text-sm font-medium",style:{color:"hsl(var(--theme-foreground))"},children:e.name.replace(/_/g," ")}),"executing"===e.status&&(0,t.jsx)("span",{className:"text-xs animate-pulse",style:{color:"hsl(var(--theme-muted-foreground))"},children:"Running..."})]}),"complete"===e.status&&e.result&&(0,t.jsx)("div",{className:"mt-2 text-xs",children:e.result.success?(0,t.jsx)("div",{style:{color:"hsl(var(--theme-muted-foreground))"},children:e.result.data&&Object.keys(e.result.data).length>0&&(0,t.jsx)("pre",{className:"rounded p-2 overflow-auto max-h-24",style:{background:"hsl(var(--theme-background))"},children:JSON.stringify(e.result.data,null,2)})}):(0,t.jsxs)("div",{style:{color:"hsl(0 84% 60%)"},children:["Error: ",e.result.error]})})]})}function ex({entity:e}){let s=em[e.type],r=eu[e.type];return(0,t.jsxs)("div",{className:"inline-flex items-center gap-1.5 px-2 py-1 rounded-md",style:{background:"hsl(var(--theme-muted))"},children:[(0,t.jsx)(s,{className:(0,u.cn)("w-3.5 h-3.5",r)}),(0,t.jsxs)("span",{className:"text-sm font-medium",style:{color:"hsl(var(--theme-foreground))"},children:["@",e.name]})]})}function ep({message:e}){let s="user"===e.role;return"system"===e.role?(0,t.jsx)("div",{className:"flex justify-center my-4",children:(0,t.jsx)("div",{className:"px-3 py-1.5 rounded-full text-xs",style:{background:"hsl(var(--theme-muted))",color:"hsl(var(--theme-muted-foreground))"},children:e.content})}):(0,t.jsxs)(p.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:(0,u.cn)("flex gap-3 mb-4",s&&"flex-row-reverse"),style:{gap:"var(--theme-chat-message-gap, 0.75rem)"},children:[s?(0,t.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{background:"hsl(var(--theme-chat-avatar-user, var(--theme-primary)))"},children:(0,t.jsx)(ea.User,{className:"w-4 h-4",style:{color:"hsl(var(--theme-primary-foreground))"}})}):(0,t.jsx)(ed.ClawAIAvatar,{size:32,isActive:e.isStreaming}),(0,t.jsxs)("div",{className:(0,u.cn)("flex-1 space-y-2",s&&"flex flex-col items-end"),style:{maxWidth:"var(--theme-chat-max-width, 85%)"},children:[e.mentions&&e.mentions.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-1.5 mb-1",children:e.mentions.map(e=>(0,t.jsx)(ex,{entity:e},e.id))}),(0,t.jsx)("div",{className:"px-4 py-2.5",style:{background:s?"var(--theme-chat-user-bg, hsl(var(--theme-primary)))":"hsl(var(--theme-chat-assistant-bg, var(--theme-muted)))",color:s?"hsl(var(--theme-chat-user-fg, var(--theme-primary-foreground)))":"hsl(var(--theme-chat-assistant-fg, var(--theme-foreground)))",borderRadius:s?"var(--theme-chat-bubble-radius, 1rem) var(--theme-chat-bubble-radius, 1rem) var(--theme-chat-bubble-radius-tail, 0.25rem) var(--theme-chat-bubble-radius, 1rem)":"var(--theme-chat-bubble-radius-tail, 0.25rem) var(--theme-chat-bubble-radius, 1rem) var(--theme-chat-bubble-radius, 1rem) var(--theme-chat-bubble-radius, 1rem)"},children:(0,t.jsxs)("p",{className:"text-sm whitespace-pre-wrap",children:[e.content,e.isStreaming&&(0,t.jsx)("span",{className:"inline-block w-1.5 h-4 ml-1 bg-current animate-pulse"})]})}),e.toolCalls&&e.toolCalls.length>0&&(0,t.jsx)("div",{className:"space-y-2 w-full",children:e.toolCalls.map(e=>(0,t.jsx)(eh,{tool:e},e.id))}),(0,t.jsx)("span",{className:"text-[10px]",style:{color:"hsl(var(--theme-muted-foreground) / 0.7)"},children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})}function eg({suggestions:e,selectedIndex:s,onSelect:r}){return 0===e.length?null:(0,t.jsx)(p.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute bottom-full left-0 right-0 mb-2 rounded-lg shadow-lg overflow-hidden z-50",style:{background:"hsl(var(--theme-card))",border:"1px solid hsl(var(--theme-border))"},children:(0,t.jsx)("div",{className:"max-h-48 overflow-y-auto",children:e.map((e,a)=>{let l=em[e.type],n=eu[e.type];return(0,t.jsxs)("button",{onClick:()=>r(e),className:"w-full flex items-center gap-3 px-3 py-2 transition-colors",style:{background:a===s?"hsl(var(--theme-muted))":"transparent"},onMouseEnter:e=>{a!==s&&(e.currentTarget.style.background="hsl(var(--theme-muted) / 0.5)")},onMouseLeave:e=>{a!==s&&(e.currentTarget.style.background="transparent")},children:[(0,t.jsx)(l,{className:(0,u.cn)("w-4 h-4",n)}),(0,t.jsxs)("div",{className:"flex-1 text-left",children:[(0,t.jsxs)("p",{className:"text-sm font-medium",style:{color:"hsl(var(--theme-foreground))"},children:["@",e.name]}),e.description&&(0,t.jsx)("p",{className:"text-xs truncate",style:{color:"hsl(var(--theme-muted-foreground))"},children:e.description})]}),(0,t.jsx)("span",{className:"text-[10px] uppercase",style:{color:"hsl(var(--theme-muted-foreground))"},children:e.type})]},e.id)})})})}function ef({messages:e,isStreaming:r,onSendMessage:l,onAbort:n,mentionSuggestions:i=[],onMentionSearch:o,onMentionSelect:c,onVoiceInput:d,isVoiceEnabled:m=!1,className:h}){let[x,g]=(0,s.useState)(""),[f,y]=(0,s.useState)(!1),[b,j]=(0,s.useState)(""),[w,N]=(0,s.useState)(0),[C,S]=(0,s.useState)([]),[T,E]=(0,s.useState)(!1),M=(0,s.useRef)(null),R=(0,s.useRef)(null),F=(0,ec.useFileAttachment)({maxFiles:5,maxSizeBytes:0xa00000,onError:e=>console.error("[AgentChat] Attachment error:",e)});(0,s.useEffect)(()=>{M.current?.scrollIntoView({behavior:"smooth"})},[e]);let L=e=>{let t=x.lastIndexOf("@");g(x.slice(0,t)+`@${e.name} `),y(!1),N(0);let s={id:e.id,type:e.type,name:e.name,description:e.description};S(e=>[...e,s]),c?.(e),R.current?.focus()},$=()=>{let e=x.trim().length>0,t=F.hasAttachments;if(!e&&!t||r)return;let s=x.trim();if(F.attachments.length>0){let e=F.attachments.map(e=>e.name).join(", ");s=s?`${s}

[Attached: ${e}]`:`[Attached: ${e}]`}l(s||"Please analyze the attached files.",C),g(""),S([]),F.clearAttachments()};return(0,s.useEffect)(()=>{R.current&&(R.current.style.height="auto",R.current.style.height=`${Math.min(R.current.scrollHeight,150)}px`)},[x]),(0,t.jsxs)("div",{className:(0,u.cn)("flex flex-col h-full",h),style:{background:"hsl(var(--theme-background))",fontFamily:"var(--theme-font)"},children:[(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:[0===e.length?(0,t.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-center",children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(ed.ClawAIAvatar,{size:64,isActive:!1})}),(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",style:{color:"hsl(var(--theme-foreground))"},children:"Start a conversation"}),(0,t.jsx)("p",{className:"text-sm max-w-sm",style:{color:"hsl(var(--theme-muted-foreground))"},children:"Ask me to help with code, design, or product work. Use @ to reference projects, PRDs, or tickets."})]}):e.map(e=>(0,t.jsx)(ep,{message:e},e.id)),(0,t.jsx)("div",{ref:M})]}),(0,t.jsxs)("div",{className:"p-4",style:{borderTop:"1px solid hsl(var(--theme-border))"},children:[C.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-1.5 mb-2",children:C.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-1 px-2 py-1 rounded-md",style:{background:"hsl(var(--theme-muted))"},children:[(0,t.jsx)(ex,{entity:e}),(0,t.jsx)("button",{onClick:()=>S(t=>t.filter(t=>t.id!==e.id)),className:"p-0.5 rounded transition-colors",style:{color:"hsl(var(--theme-muted-foreground))"},onMouseEnter:e=>e.currentTarget.style.background="hsl(var(--theme-muted-foreground) / 0.2)",onMouseLeave:e=>e.currentTarget.style.background="transparent",children:(0,t.jsx)(v.X,{className:"w-3 h-3"})})]},e.id))}),(0,t.jsx)("input",{ref:F.fileInputRef,type:"file",accept:F.acceptedTypesString,multiple:!0,onChange:F.handleFileInputChange,className:"hidden"}),(0,t.jsx)(a.AnimatePresence,{children:F.hasAttachments&&(0,t.jsx)(p.motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-2",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2 p-2 rounded-lg",style:{background:"hsl(var(--theme-muted) / 0.5)",border:"1px solid hsl(var(--theme-border) / 0.5)"},children:F.attachments.map(e=>{let s=e.type.startsWith("image/")?eo.Image:"application/pdf"===e.type||e.type.startsWith("text/")?A.FileText:G.File;return(0,t.jsxs)("div",{className:"relative group",children:[e.preview?(0,t.jsxs)("div",{className:"relative w-16 h-16 rounded-lg overflow-hidden",children:[(0,t.jsx)("img",{src:e.preview,alt:e.name,className:"w-full h-full object-cover"}),(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity"})]}):(0,t.jsxs)("div",{className:"w-16 h-16 rounded-lg flex flex-col items-center justify-center gap-1 p-1",style:{background:"hsl(var(--theme-muted))"},children:[(0,t.jsx)(s,{className:"w-5 h-5",style:{color:"hsl(var(--theme-primary))"}}),(0,t.jsx)("span",{className:"text-[9px] truncate w-full text-center",style:{color:"hsl(var(--theme-muted-foreground))"},children:e.name.length>10?`${e.name.slice(0,8)}...`:e.name})]}),(0,t.jsx)("button",{type:"button",onClick:()=>F.removeAttachment(e.id),className:"absolute -top-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",style:{background:"hsl(0 84% 60%)",color:"white"},"aria-label":`Remove ${e.name}`,children:(0,t.jsx)(v.X,{className:"w-3 h-3"})})]},e.id)})})})}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(a.AnimatePresence,{children:f&&i.length>0&&(0,t.jsx)(eg,{suggestions:i,selectedIndex:w,onSelect:L})}),(0,t.jsxs)("div",{className:"flex items-end gap-2 rounded-xl p-2",style:{background:"hsl(var(--theme-chat-input-bg, var(--theme-muted)))",border:"1px solid hsl(var(--theme-chat-input-border, var(--theme-border)) / 0.5)"},children:[(0,t.jsx)("button",{onClick:F.openFilePicker,disabled:r,className:"p-2 rounded-lg transition-colors disabled:opacity-50",title:"Attach file",style:{color:"hsl(var(--theme-muted-foreground))"},onMouseEnter:e=>e.currentTarget.style.background="hsl(var(--theme-background))",onMouseLeave:e=>e.currentTarget.style.background="transparent",children:(0,t.jsx)(ei.Paperclip,{className:"w-5 h-5"})}),(0,t.jsx)("button",{onClick:()=>{g(e=>e+"@"),y(!0),o?.(""),R.current?.focus()},className:"p-2 rounded-lg transition-colors",title:"Add mention",style:{color:"hsl(var(--theme-muted-foreground))"},onMouseEnter:e=>e.currentTarget.style.background="hsl(var(--theme-background))",onMouseLeave:e=>e.currentTarget.style.background="transparent",children:(0,t.jsx)(k.default,{className:"w-5 h-5"})}),(0,t.jsx)("textarea",{ref:R,value:x,onChange:e=>(e=>{g(e);let t=e.lastIndexOf("@");if(-1!==t){let s=e.slice(t+1);if(!s.includes(" ")&&s.length<=20){j(s),y(!0),o?.(s);return}}y(!1)})(e.target.value),onKeyDown:e=>{f&&i.length>0?"ArrowDown"===e.key?(e.preventDefault(),N(e=>(e+1)%i.length)):"ArrowUp"===e.key?(e.preventDefault(),N(e=>(e-1+i.length)%i.length)):"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&y(!1):(e.preventDefault(),L(i[w])):"Enter"!==e.key||e.shiftKey||(e.preventDefault(),$())},placeholder:"Ask anything... (@ to mention)",rows:1,className:"flex-1 bg-transparent resize-none focus:outline-none text-sm py-2",style:{maxHeight:"150px",color:"hsl(var(--theme-chat-input-fg, var(--theme-foreground)))"}}),m&&(0,t.jsx)("button",{onClick:()=>{T?E(!1):E(!0)},className:"p-2 rounded-lg transition-colors",title:T?"Stop recording":"Voice input",style:{background:T?"hsl(0 84% 60% / 0.2)":"transparent",color:T?"hsl(0 84% 60%)":"hsl(var(--theme-muted-foreground))"},onMouseEnter:e=>{T||(e.currentTarget.style.background="hsl(var(--theme-background))")},onMouseLeave:e=>{T||(e.currentTarget.style.background="transparent")},children:T?(0,t.jsx)(er.MicOff,{className:"w-5 h-5"}):(0,t.jsx)(es.Mic,{className:"w-5 h-5"})}),r?(0,t.jsx)("button",{onClick:n,className:"p-2 rounded-lg transition-colors",title:"Stop generating",style:{background:"hsl(0 84% 60% / 0.2)",color:"hsl(0 84% 60%)"},onMouseEnter:e=>e.currentTarget.style.background="hsl(0 84% 60% / 0.3)",onMouseLeave:e=>e.currentTarget.style.background="hsl(0 84% 60% / 0.2)",children:(0,t.jsx)(en.default,{className:"w-5 h-5"})}):(0,t.jsx)("button",{onClick:$,disabled:!x.trim()&&!F.hasAttachments,className:"p-2 rounded-lg transition-colors",title:"Send message",style:{background:x.trim()||F.hasAttachments?"hsl(var(--theme-chat-send-bg, var(--theme-primary)))":"hsl(var(--theme-chat-send-disabled-bg, var(--theme-muted-foreground) / 0.2))",color:x.trim()||F.hasAttachments?"hsl(var(--theme-chat-send-fg, var(--theme-primary-foreground)))":"hsl(var(--theme-chat-send-disabled-fg, var(--theme-muted-foreground)))",cursor:x.trim()||F.hasAttachments?"pointer":"not-allowed"},children:(0,t.jsx)(et.Send,{className:"w-5 h-5"})})]})]})]})]})}var ey=e.i(478522),ev=e.i(725481),eb=e.i(974478),ej=e.i(272690),ew=e.i(956352);let eN=void 0!==ey.default&&!!ey.default.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY;function ek({isOpen:r,onClose:l,onAuthenticated:n,errorMessage:i}){let{user:o,isSignedIn:c}=(0,x.useUser)(),[d,m]=(0,s.useState)(!1),[u,h]=(0,s.useState)(null),g=o?.externalAccounts?.some(e=>"github"===e.provider);(0,s.useEffect)(()=>{if(!eN||c)return;let t=!0;return(async()=>{try{let s=await e.A(665786);t&&h(()=>s.SignInButton)}catch{}})(),()=>{t=!1}},[c]);let f=(0,s.useCallback)(()=>{window.location.href="/settings/integrations"},[]);return!eN&&r?(n?.(),l(),null):(0,t.jsx)(a.AnimatePresence,{children:r&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/80 backdrop-blur-sm",onClick:l}),(0,t.jsx)(p.motion.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",stiffness:300,damping:30},className:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:e=>e.stopPropagation(),children:(0,t.jsxs)("div",{className:"w-full max-w-md bg-gradient-to-b from-neutral-900 to-black rounded-3xl border border-white/10 overflow-hidden shadow-2xl",children:[(0,t.jsx)("button",{onClick:l,className:"absolute top-4 right-4 p-2 text-white/40 hover:text-white/80 transition-colors rounded-full hover:bg-white/5",children:(0,t.jsx)(v.X,{className:"w-5 h-5"})}),(0,t.jsxs)("div",{className:"px-6 pt-8 pb-6 text-center",children:[(0,t.jsx)(p.motion.div,{className:"w-20 h-20 mx-auto mb-4 relative",animate:{boxShadow:d?["0 0 30px rgba(34, 197, 94, 0.5)","0 0 50px rgba(34, 197, 94, 0.7)","0 0 30px rgba(34, 197, 94, 0.5)"]:["0 0 20px rgba(34, 197, 94, 0.3)","0 0 30px rgba(34, 197, 94, 0.4)","0 0 20px rgba(34, 197, 94, 0.3)"]},transition:{duration:2,repeat:1/0},style:{borderRadius:"50%"},children:(0,t.jsx)("div",{className:"w-full h-full rounded-full bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center",children:(0,t.jsx)(ev.Github,{className:"w-8 h-8 text-white"})})}),i&&(0,t.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-4 px-3 py-2 rounded-lg bg-red-500/10 border border-red-500/20",children:[(0,t.jsx)(ew.AlertTriangle,{className:"w-4 h-4 text-red-400"}),(0,t.jsx)("span",{className:"text-sm text-red-300",children:i})]}),(0,t.jsx)("h2",{className:"text-xl font-bold text-white mb-2",children:"GitHub Authentication Required"}),(0,t.jsx)("p",{className:"text-white/50 text-sm leading-relaxed",children:c&&!g?"Connect your GitHub account to enable sandbox features.":"To use the sandbox environment, you need to authenticate with GitHub. This enables secure code execution and repository access."})]}),(0,t.jsx)("div",{className:"px-6 pb-6",children:(0,t.jsxs)("div",{className:"bg-white/5 rounded-2xl p-4 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center",children:(0,t.jsx)(eb.Shield,{className:"w-4 h-4 text-white/60"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-white/80",children:"Secure Sandbox Access"}),(0,t.jsx)("p",{className:"text-white/40 text-xs",children:"Run code in isolated cloud environments"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center",children:(0,t.jsx)(ej.Code2,{className:"w-4 h-4 text-white/60"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-white/80",children:"Repository Integration"}),(0,t.jsx)("p",{className:"text-white/40 text-xs",children:"Clone, commit, and push to your repos"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center",children:(0,t.jsx)(z.Terminal,{className:"w-4 h-4 text-white/60"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-white/80",children:"Full Terminal Access"}),(0,t.jsx)("p",{className:"text-white/40 text-xs",children:"Run commands and build projects"})]})]})]})}),(0,t.jsxs)("div",{className:"px-6 pb-8",children:[c?(0,t.jsxs)("button",{onClick:f,onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),className:"w-full flex items-center justify-center gap-3 px-6 py-4 rounded-2xl bg-gradient-to-r from-green-500 to-green-600 hover:from-green-400 hover:to-green-500 text-white font-semibold transition-all shadow-lg shadow-green-500/25",children:[(0,t.jsx)(ev.Github,{className:"w-5 h-5"}),(0,t.jsx)("span",{children:"Connect GitHub Account"}),(0,t.jsx)(W.ExternalLink,{className:"w-4 h-4 opacity-60"})]}):u?(0,t.jsx)(u,{mode:"modal",children:(0,t.jsxs)("button",{onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),className:"w-full flex items-center justify-center gap-3 px-6 py-4 rounded-2xl bg-gradient-to-r from-green-500 to-green-600 hover:from-green-400 hover:to-green-500 text-white font-semibold transition-all shadow-lg shadow-green-500/25",children:[(0,t.jsx)(ev.Github,{className:"w-5 h-5"}),(0,t.jsx)("span",{children:"Sign in with GitHub"})]})}):(0,t.jsxs)("button",{onClick:()=>{n?.(),l()},className:"w-full flex items-center justify-center gap-3 px-6 py-4 rounded-2xl bg-gradient-to-r from-green-500 to-green-600 hover:from-green-400 hover:to-green-500 text-white font-semibold transition-all shadow-lg shadow-green-500/25",children:[(0,t.jsx)(ev.Github,{className:"w-5 h-5"}),(0,t.jsx)("span",{children:"Continue"})]}),(0,t.jsx)("p",{className:"text-center text-white/30 text-xs mt-4",children:c?"You'll be redirected to connect your GitHub account":"Authentication is required for sandbox operations"})]}),(0,t.jsx)("div",{className:"px-6 pb-6 text-center",children:(0,t.jsx)("button",{onClick:l,className:"text-white/40 hover:text-white/60 text-sm transition-colors",children:"Cancel and go back"})})]})})]})})}var eC=e.i(479520),eS=e.i(300605),eA=e.i(684750),eT=e.i(134863),eE=e.i(140113),eM=e.i(601804),eR=e.i(895579),eF=e.i(982355);let eL=["Ah, here's the thing...","I'd love to let you into the workshop, truly I would. But this particular room is where I keep all the sharp tools and live wires.","The ∞gent can execute code, push to repos, and deploy to production. So I keep it locked up tight. Nothing personal, just being a responsible host."],e$=eL.join(" ");async function eP(e){try{let t=await fetch("/api/tts/elevenlabs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,stability:.5,similarityBoost:.75})});if(t.ok){let e=await t.blob();if(e.size>0)return console.log("[AgentAccessRestricted] Using Eleven Labs TTS"),e}let s=await t.json().catch(()=>null);if(s?.fallback!=="openai")throw Error("Eleven Labs failed without fallback")}catch(e){console.log("[AgentAccessRestricted] Eleven Labs unavailable, trying OpenAI:",e)}console.log("[AgentAccessRestricted] Using OpenAI TTS fallback");let t=await fetch("/api/tts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,voice:"onyx",model:"tts-1-hd",speed:1})});if(!t.ok)throw Error("Both TTS services failed");return t.blob()}function eI({isLoading:e,isSignedIn:r,clerkId:a,userEmail:l}){let[n,i]=(0,s.useState)(0),[o,c]=(0,s.useState)(""),[d,m]=(0,s.useState)(!0),[u,h]=(0,s.useState)(!1),[x,g]=(0,s.useState)(!1),[f,y]=(0,s.useState)(!1),[v,b]=(0,s.useState)(!1),w=(0,s.useRef)(null),N=(0,s.useRef)(!1);(0,s.useCallback)(()=>{a&&(navigator.clipboard.writeText(a),g(!0),setTimeout(()=>g(!1),2e3))},[a]);let k="james_restricted_audio_v1";(0,s.useEffect)(()=>{if(!e&&!N.current)return N.current=!0,(async()=>{try{let e,t=localStorage.getItem(k);if(t)console.log("[AgentAccessRestricted] Using cached audio"),e=t;else{console.log("[AgentAccessRestricted] Generating speech (will cache)...");let t=await eP(e$),s=new FileReader;e=await new Promise(e=>{s.onloadend=()=>e(s.result),s.readAsDataURL(t)});try{localStorage.setItem(k,e),console.log("[AgentAccessRestricted] Audio cached")}catch(e){console.warn("[AgentAccessRestricted] Could not cache audio:",e)}}let s=new Audio(e);s.onended=()=>{y(!1),console.log("[AgentAccessRestricted] Audio ended")},s.onerror=e=>{console.error("[AgentAccessRestricted] Audio error:",e),y(!1),localStorage.removeItem(k)},w.current=s;try{await s.play(),y(!0),console.log("[AgentAccessRestricted] Audio playing")}catch(e){console.warn("[AgentAccessRestricted] Autoplay blocked:",e)}}catch(e){console.error("[AgentAccessRestricted] TTS error:",e)}})(),()=>{w.current&&(w.current.pause(),w.current=null)}},[e]);let C=(0,s.useCallback)(()=>{w.current&&(v?(w.current.muted=!1,b(!1)):(w.current.muted=!0,b(!0)))},[v]),S=(0,s.useCallback)(async()=>{if(w.current&&!f)try{await w.current.play(),y(!0)}catch(e){console.error("[AgentAccessRestricted] Play failed:",e)}},[f]);return((0,s.useEffect)(()=>{if(e)return;if(n>=eL.length){m(!1);let e=setTimeout(()=>h(!0),500);return()=>clearTimeout(e)}let t=eL[n],s=0;c(""),m(!0);let r=setInterval(()=>{s<t.length?(c(t.slice(0,s+1)),s++):(clearInterval(r),setTimeout(()=>{i(e=>e+1)},0===n?800:1200))},30);return()=>clearInterval(r)},[n,e]),e)?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",style:{background:"hsl(var(--theme-background))",color:"hsl(var(--theme-foreground))"},children:(0,t.jsxs)(p.motion.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center gap-4",children:[(0,t.jsx)(p.motion.div,{className:"w-16 h-16 rounded-full overflow-hidden ring-4 ring-[hsl(var(--theme-primary)/0.3)]",animate:{boxShadow:["0 0 20px hsl(var(--theme-primary) / 0.2)","0 0 40px hsl(var(--theme-primary) / 0.4)","0 0 20px hsl(var(--theme-primary) / 0.2)"]},transition:{duration:2,repeat:1/0},children:(0,t.jsx)(eM.default,{src:"/openclaw-logo.png",alt:"James",width:64,height:64,className:"w-full h-full object-cover"})}),(0,t.jsx)("p",{className:"text-sm",style:{color:"hsl(var(--theme-muted-foreground))"},children:"One moment..."})]})}):(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",style:{background:"hsl(var(--theme-background))",color:"hsl(var(--theme-foreground))"},children:(0,t.jsxs)(p.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-md w-full text-center",children:[(0,t.jsxs)("div",{className:"relative w-24 h-24 mx-auto mb-6",children:[(0,t.jsx)(p.motion.div,{className:"w-full h-full rounded-full overflow-hidden ring-4 ring-[hsl(var(--theme-primary)/0.3)]",initial:{scale:.8},animate:{scale:1,boxShadow:f?["0 0 20px hsl(var(--theme-primary) / 0.3)","0 0 40px hsl(var(--theme-primary) / 0.5)","0 0 20px hsl(var(--theme-primary) / 0.3)"]:["0 0 20px hsl(var(--theme-primary) / 0.2)","0 0 30px hsl(var(--theme-primary) / 0.3)","0 0 20px hsl(var(--theme-primary) / 0.2)"]},transition:{scale:{type:"spring",stiffness:200,delay:.1},boxShadow:{duration:f?1:3,repeat:1/0}},children:(0,t.jsx)(eM.default,{src:"/openclaw-logo.png",alt:"James",width:96,height:96,className:"w-full h-full object-cover"})}),(0,t.jsx)(p.motion.button,{onClick:f?C:S,className:"absolute -bottom-1 -right-1 w-8 h-8 rounded-full flex items-center justify-center transition-colors",style:{background:"hsl(var(--theme-primary))",color:"white"},whileHover:{scale:1.1},whileTap:{scale:.95},initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{delay:.5},title:f?v?"Unmute":"Mute":"Play audio",children:f&&v?(0,t.jsx)(eT.VolumeX,{className:"w-4 h-4"}):(0,t.jsx)(eA.Volume2,{className:"w-4 h-4"})}),f&&!v&&(0,t.jsx)(p.motion.div,{className:"absolute -top-1 -right-1 flex gap-0.5",initial:{opacity:0},animate:{opacity:1},children:[0,.1,.2].map((e,s)=>(0,t.jsx)(p.motion.div,{className:"w-1 rounded-full",style:{background:"hsl(var(--theme-primary))"},animate:{height:[4,12,4]},transition:{duration:.4,repeat:1/0,delay:e}},s))})]}),(0,t.jsxs)("div",{className:"min-h-[200px] flex flex-col justify-start",children:[n>=0&&(0,t.jsx)(p.motion.h1,{className:"text-2xl font-bold mb-4",style:{color:"hsl(var(--theme-foreground))"},initial:{opacity:0},animate:{opacity:1},children:0===n?(0,t.jsxs)(t.Fragment,{children:[o,d&&(0,t.jsx)(p.motion.span,{animate:{opacity:[1,0]},transition:{duration:.5,repeat:1/0},className:"inline-block w-0.5 h-6 bg-current ml-0.5 align-middle"})]}):eL[0]}),n>=1&&(0,t.jsx)(p.motion.p,{className:"text-base mb-4 leading-relaxed",style:{color:"hsl(var(--theme-muted-foreground))"},initial:{opacity:0},animate:{opacity:1},children:1===n?(0,t.jsxs)(t.Fragment,{children:[o,d&&(0,t.jsx)(p.motion.span,{animate:{opacity:[1,0]},transition:{duration:.5,repeat:1/0},className:"inline-block w-0.5 h-5 bg-current ml-0.5 align-middle"})]}):eL[1]}),n>=2&&(0,t.jsx)(p.motion.p,{className:"text-base mb-6 leading-relaxed",style:{color:"hsl(var(--theme-muted-foreground))"},initial:{opacity:0},animate:{opacity:1},children:2===n?(0,t.jsxs)(t.Fragment,{children:[o,d&&(0,t.jsx)(p.motion.span,{animate:{opacity:[1,0]},transition:{duration:.5,repeat:1/0},className:"inline-block w-0.5 h-5 bg-current ml-0.5 align-middle"})]}):eL[2]})]}),u&&(0,t.jsxs)(t.Fragment,{children:[r&&a?(0,t.jsxs)(p.motion.div,{className:"mb-6 p-4 rounded-xl text-left",style:{background:"hsl(var(--theme-primary) / 0.1)"},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05},children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,t.jsx)(j.Database,{className:"w-4 h-4",style:{color:"hsl(var(--theme-primary))"}}),(0,t.jsx)("span",{className:"text-sm font-medium",style:{color:"hsl(var(--theme-primary))"},children:"Almost there! Run this in your terminal:"})]}),(0,t.jsx)("div",{className:"mt-3 p-3 rounded-lg font-mono text-xs overflow-x-auto",style:{background:"hsl(var(--theme-background))"},children:(0,t.jsxs)("code",{style:{color:"hsl(var(--theme-muted-foreground))"},children:["npx convex run userManagement:seedOwner ",`'{"email":"${l||"your@email.com"}","displayName":"Your Name","clerkId":"${a}"}'`]})}),(0,t.jsxs)("button",{onClick:()=>{let e=`npx convex run userManagement:seedOwner '{"email":"${l||"your@email.com"}","displayName":"Your Name","clerkId":"${a}"}'`;navigator.clipboard.writeText(e),g(!0),setTimeout(()=>g(!1),2e3)},className:"mt-3 inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all hover:scale-[1.02]",style:{background:"hsl(var(--theme-primary))",color:"white"},children:[x?(0,t.jsx)(X.Check,{className:"w-4 h-4"}):(0,t.jsx)(q.Copy,{className:"w-4 h-4"}),x?"Copied!":"Copy Command"]}),(0,t.jsx)("p",{className:"mt-3 text-xs",style:{color:"hsl(var(--theme-muted-foreground) / 0.7)"},children:"This sets up owner permissions automatically. Refresh after running."})]}):(0,t.jsx)(eF.SignedOut,{children:(0,t.jsxs)(p.motion.div,{className:"mb-6",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05},children:[(0,t.jsx)("p",{className:"text-sm mb-3",style:{color:"hsl(var(--theme-muted-foreground))"},children:"Wait, are you the owner?"}),(0,t.jsx)(eR.SignInButton,{mode:"modal",children:(0,t.jsxs)("button",{className:"inline-flex items-center gap-2 px-6 py-3 rounded-xl font-medium transition-all hover:scale-[1.02] active:scale-[0.98]",style:{background:"hsl(142 70% 45%)",color:"white"},children:[(0,t.jsx)(ev.Github,{className:"w-4 h-4"}),"Sign in to prove it"]})})]})}),(0,t.jsxs)(p.motion.div,{className:"flex items-center gap-4 mb-6",initial:{opacity:0},animate:{opacity:1},transition:{delay:.1},children:[(0,t.jsx)("div",{className:"flex-1 h-px",style:{background:"hsl(var(--theme-border))"}}),(0,t.jsx)("span",{className:"text-xs",style:{color:"hsl(var(--theme-muted-foreground))"},children:"or"}),(0,t.jsx)("div",{className:"flex-1 h-px",style:{background:"hsl(var(--theme-border))"}})]}),(0,t.jsxs)(p.motion.div,{className:"flex items-center justify-center gap-2 mb-6 px-4 py-3 rounded-xl",style:{background:"hsl(var(--theme-primary) / 0.1)"},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.15},children:[(0,t.jsx)(eC.Heart,{className:"w-4 h-4",style:{color:"hsl(var(--theme-primary))"}}),(0,t.jsx)("span",{className:"text-sm",style:{color:"hsl(var(--theme-primary))"},children:"Thanks for understanding"})]}),(0,t.jsx)(p.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},children:(0,t.jsx)(eE.default,{href:"/",children:(0,t.jsxs)(p.motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"inline-flex items-center gap-2 px-6 py-3 rounded-xl font-medium transition-colors",style:{background:"hsl(var(--theme-muted))",color:"hsl(var(--theme-foreground))"},children:[(0,t.jsx)(eS.ArrowLeft,{className:"w-4 h-4"}),"Let's explore something else"]})})}),(0,t.jsxs)(p.motion.p,{className:"text-sm mt-8 flex items-center justify-center gap-2",style:{color:"hsl(var(--theme-muted-foreground) / 0.7)"},initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:[(0,t.jsx)(el.Sparkles,{className:"w-3 h-3"}),"Plenty of other interesting corners to discover",(0,t.jsx)(el.Sparkles,{className:"w-3 h-3"})]})]})]})})}var eD=e.i(591337),eO=e.i(624635),e_=e.i(487611),eU=e.i(334905);let ez=eU.api?.userManagement?.getManagedUserByClerkId??null,eB={episodic:42,semantic:18,working:3},eH=[{id:"proj-1",type:"project",name:"OpenClaw-OS",description:"Professional agentic operating system"},{id:"proj-2",type:"project",name:"8gent",description:"Next-gen agent platform"},{id:"prd-1",type:"prd",name:"infinity-agent",description:"PRD for coding agent integration"},{id:"ticket-1",type:"ticket",name:"ARC-001",description:"Implement context bar component"},{id:"ticket-2",type:"ticket",name:"ARC-002",description:"Add code panel with monaco editor"},{id:"file-1",type:"file",name:"agent/page.tsx",description:"Main agent page component"}],eG=["Authentication required","authentication required","Unauthorized","unauthorized","GitHub OAuth","OAuth","oauth","token expired","Token expired","invalid token","Invalid token","access denied","Access denied","not authenticated","Not authenticated","Status code 400","Status code 401","Status code 403"];function eq(e){return!!e&&eG.some(t=>e.includes(t))}function eX({children:e}){let{user:s,isLoaded:r}=(0,x.useUser)(),a=s?.id,l=(0,h.useQuery)(ez,ez&&a?{clerkId:a}:"skip"),n=!r||ez&&a&&void 0===l,i=!ez||l?.role==="owner"||l?.role==="admin";return n?(0,t.jsx)(eI,{isLoading:!0}):i?(0,t.jsx)(t.Fragment,{children:e}):(0,t.jsx)(eI,{isSignedIn:!!s,clerkId:a,userEmail:s?.primaryEmailAddress?.emailAddress})}function eV(){let[e,r]=(0,s.useState)(!1),[h,x]=(0,s.useState)(),p=(0,s.useRef)(null),[g,f]=(0,s.useState)(!0),[y,v]=(0,s.useState)(!1),[b,j]=(0,s.useState)([]),[w,N]=(0,s.useState)("chat"),[k,C]=(0,s.useState)(!1),[S,A]=(0,s.useState)(!1),[E,M]=(0,s.useState)("code"),[R,F]=(0,s.useState)([]),L=function(){let e=(0,eD.useSandboxContext)(),[t,r]=(0,s.useState)(null),[a,l]=(0,s.useState)([]),[n,i]=(0,s.useState)(!1),[o,c]=(0,s.useState)(null),d=(0,s.useCallback)((e,t)=>{l(s=>[...s,{id:`term_${Date.now()}_${Math.random().toString(36).slice(2)}`,type:e,content:t,timestamp:Date.now()}])},[]),m=(0,s.useCallback)(async()=>{try{d("system","Starting sandbox environment..."),await e.create({timeout:6e5,ports:[3e3,5173,8080]}),await e.listFiles("."),d("system","Sandbox ready!")}catch(e){d("error",`Failed to start sandbox: ${e}`)}},[e,d]),u=(0,s.useCallback)(async()=>{try{d("system","Terminating sandbox..."),await e.terminate(),r(null),c(null),d("system","Sandbox terminated")}catch(e){d("error",`Failed to stop sandbox: ${e}`)}},[e,d]),h=(0,s.useCallback)(async(t,s)=>{e.isConnected||await m(),d("command",`git clone ${t} (authenticated via GitHub)`),i(!0);try{let s=await e.cloneRepo(t);s.success?(d("system",`Repository cloned to ${s.projectDir}`),await e.listFiles(s.projectDir||"./project")):d("error",s.error||"Failed to clone repository")}catch(e){d("error",`Clone failed: ${e}`)}finally{i(!1)}},[e,m,d]),x=(0,s.useCallback)(async t=>{let s=await e.readFile(t);return r({path:t,content:s,language:{ts:"typescript",tsx:"typescript",js:"javascript",jsx:"javascript",json:"json",md:"markdown",mdx:"markdown",css:"css",scss:"scss",html:"html",py:"python",rs:"rust",go:"go",sh:"shell",bash:"shell",yml:"yaml",yaml:"yaml",toml:"toml",sql:"sql"}[t.split(".").pop()?.toLowerCase()||""]||"plaintext"}),s},[e]),p=(0,s.useCallback)(async(s,a)=>{await e.writeFile(s,a),d("system",`Wrote file: ${s}`),t?.path===s&&r({...t,content:a})},[e,t,d]),g=(0,s.useCallback)(async t=>{d("command",`$ ${t}`),i(!0);try{let s=t.match(/^git\s+clone\s+(\S+)(?:\s+(\S+))?$/i);if(s){let t=s[1];d("system","Using authenticated clone..."),d("system",`Fetching GitHub token and cloning ${t}...`);try{let s=await e.cloneRepo(t);return console.log("[Clone] Result:",s),s.success?(d("output",`✓ Cloned successfully to ${s.projectDir}`),d("system","Refreshing file list..."),await e.listFiles(s.projectDir),d("output",'Ready! Use "ls" to see files.')):d("error",`✗ Clone failed: ${s.error||"Unknown error"}`),{cmdId:`cmd_clone_${Date.now()}`,command:"git",args:["clone",t],status:s.success?"completed":"error",startedAt:Date.now(),exitCode:+!s.success,stdout:s.success?`Cloned to ${s.projectDir}`:"",stderr:s.error||""}}catch(s){console.error("[Clone] Error:",s);let e=s instanceof Error?s.message:"Clone failed";return d("error",`✗ ${e}`),{cmdId:`cmd_clone_${Date.now()}`,command:"git",args:["clone",t],status:"error",startedAt:Date.now(),exitCode:1,stdout:"",stderr:e}}}let r=t.split(" "),a=r[0],l=r.slice(1),n=await e.runCommand(a,l);return n.stdout&&d("output",n.stdout),n.stderr&&d("error",n.stderr),n}finally{i(!1)}},[e,d]),f=(0,s.useCallback)(async(t="npm run dev",s=3e3)=>{d("command",`$ ${t}`),i(!0);try{let r=t.split(" ");await e.runCommand(r[0],r.slice(1),{wait:!1}),await new Promise(e=>setTimeout(e,3e3));let a=await e.getPreviewUrl(s);return d("system",`Dev server started at ${a}`),a}finally{i(!1)}},[e,d]),y=(0,s.useCallback)(async()=>{e.isConnected&&await e.listFiles()},[e]),v=(0,s.useCallback)(async t=>{let{type:s,payload:r}=t;switch(s){case"repo_cloned":{let{url:e,branch:t}=r;await h(e,t);break}case"file_read":{let{path:e}=r;await x(e);break}case"file_written":{let{path:e,content:t}=r;await p(e,t);break}case"command_executed":{let{command:e}=r;await g(e);break}case"server_started":{let{command:e,port:t}=r;await f(e,t);break}case"preview_ready":{let{port:t}=r;await e.getPreviewUrl(t||3e3);break}case"git_status":{let e=await g("git status --porcelain"),t=e.stdout?.split("\n").filter(Boolean)||[],s={branch:"main",modified:[],staged:[],untracked:[]};t.forEach(e=>{let t=e.substring(0,2),r=e.substring(3);t.includes("M")&&s.modified.push(r),t.includes("A")&&s.staged.push(r),"??"===t&&s.untracked.push(r)}),c(s);break}case"git_diff":{let{path:e}=r;await g(e?`git diff ${e}`:"git diff");break}case"git_committed":{let{message:e}=r;await g(`git add -A && git commit -m "${e}"`);break}case"git_pushed":{let{branch:e}=r;await g(e?`git push origin ${e}`:"git push");break}case"branch_created":{let{name:e}=r;await g(`git checkout -b ${e}`);break}case"directory_listed":{let{path:t}=r;await e.listFiles(t||".");break}case"files_searched":{let{pattern:e,path:t}=r;await g(`grep -r "${e}" ${t||"."}`);break}default:console.log("Unhandled sandbox action:",s,r)}},[h,x,p,g,f,e]);return{isConnected:e.isConnected,isCreating:e.isCreating,sandboxId:e.state.sandboxId,previewUrl:e.state.previewUrl,error:e.error,files:e.state.files,currentFile:t,terminalOutput:a,isRunning:n,gitStatus:o,startSandbox:m,stopSandbox:u,executeToolAction:v,cloneRepository:h,readFile:x,writeFile:p,runCommand:g,startDevServer:f,refreshFiles:y,logs:e.logs,clearLogs:e.clearLogs}}();(0,s.useEffect)(()=>{let e=L.error;e!==p.current&&eq(e)&&(x(e||"Authentication required"),r(!0)),p.current=e},[L.error]),(0,s.useEffect)(()=>{let e=L.terminalOutput[L.terminalOutput.length-1];e?.type==="error"&&eq(e.content)&&(x(e.content),r(!0))},[L.terminalOutput]);let $=(0,s.useMemo)(()=>(function(e){let t=[],s=new Map;for(let a of[...e].sort((e,t)=>"directory"===e.type&&"file"===t.type?-1:"file"===e.type&&"directory"===t.type?1:e.path.localeCompare(t.path))){var r;let e=a.path.split("/").filter(Boolean),l=e[e.length-1],n="/"+e.slice(0,-1).join("/"),i={name:l,path:a.path,type:"directory"===a.type?"folder":"file",children:"directory"===a.type?[]:void 0,language:"file"===a.type?(r=l,({ts:"typescript",tsx:"typescript",js:"javascript",jsx:"javascript",json:"json",md:"markdown",css:"css",html:"html",py:"python"})[r.split(".").pop()?.toLowerCase()||""]||"plaintext"):void 0};if(s.set(a.path,i),1===e.length||"/home/user"===n||"/home"===n)t.push(i);else{let e=s.get(n);e&&e.children?e.children.push(i):t.push(i)}}return t})(L.files),[L.files]),P=(0,s.useMemo)(()=>L.terminalOutput.map(e=>({id:e.id,type:"command"===e.type?"command":"error"===e.type?"error":"output",content:e.content,timestamp:e.timestamp})),[L.terminalOutput]),{threads:I,activeThreadId:D,createThread:O,switchThread:U,deleteThread:z,ensureThread:B}=(0,eO.useChatThreads)(),{messages:H,isStreaming:G,sendMessage:q,abortStream:X}=(0,e_.useStreamingChat)({onStreamStart:()=>console.log("Stream started"),onStreamEnd:()=>console.log("Stream ended")}),V=(0,s.useMemo)(()=>H.map(e=>({id:e.id,role:e.role,content:e.content,timestamp:e.timestamp,isStreaming:e.isStreaming})),[H]),W=(0,s.useCallback)(()=>{r(!1),x(void 0),L.startSandbox()},[L]),K=(0,s.useCallback)((e,t)=>{B(),t&&t.length>0&&j(e=>{let s=[...e];return t.forEach(e=>{s.find(t=>t.id===e.id)||s.push(e)}),s});let s="";L.isConnected&&(s+="\n\n[SANDBOX CONNECTED - You have full coding capabilities: clone repos with git, run terminal commands, create/edit files, install packages, run dev servers. Use the terminal below to execute commands.]"),b.length>0&&(s+=`

[Active Context: ${b.map(e=>`@${e.type}:${e.name}`).join(", ")}]`),q(e+s),["code","implement","create","build","fix","debug","file","component","clone","repo","git"].some(t=>e.toLowerCase().includes(t))&&C(!0)},[B,q,b,L.isConnected]),J=(0,s.useCallback)(e=>{F(eH.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())||t.description?.toLowerCase().includes(e.toLowerCase())))},[]),Y=(0,s.useCallback)(e=>{let t={id:e.id,type:e.type,name:e.name,description:e.description};j(e=>e.find(e=>e.id===t.id)?e:[...e,t])},[]),Q=(0,s.useCallback)(e=>{j(t=>t.filter(t=>t.id!==e))},[]),Z=(0,s.useCallback)(()=>{j([])},[]),et=(0,s.useCallback)(async e=>{if(L.isConnected)try{await L.readFile(e),M("code")}catch(e){console.error("Failed to read file:",e)}},[L]),es=(0,s.useCallback)(async e=>{L.isConnected&&await L.runCommand(e)},[L]),er=(0,s.useCallback)(()=>{f(e=>!e)},[]),ea=(0,s.useCallback)(()=>{v(e=>!e)},[]);return(0,s.useEffect)(()=>{let e=()=>{window.innerWidth>=1024&&f(!0)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ek,{isOpen:e,onClose:()=>r(!1),onAuthenticated:W,errorMessage:h}),(0,t.jsx)("div",{className:"h-screen flex flex-col overflow-hidden",style:{background:"hsl(var(--theme-background))",color:"hsl(var(--theme-foreground))",fontFamily:"var(--theme-font)"},children:(0,t.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,t.jsx)(a.AnimatePresence,{children:(g||window.innerWidth>=1024)&&!y&&(0,t.jsx)(T,{isOpen:g,onClose:()=>f(!1),threads:I,activeThreadId:D,onNewThread:O,onSelectThread:U,onDeleteThread:z,memoryStats:eB,recentMentions:b.slice(-5).map(e=>({id:e.id,type:e.type,name:e.name,timestamp:Date.now()})),onMentionClick:e=>{let t=b.find(t=>t.id===e.id);t&&console.log("Clicked mention:",t)}})}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 px-4 py-2",style:{background:"hsl(var(--theme-card))",borderBottom:"1px solid hsl(var(--theme-border))"},children:[(0,t.jsx)("button",{onClick:er,className:"p-2 rounded-lg transition-colors lg:hidden",style:{color:"hsl(var(--theme-foreground))"},onMouseEnter:e=>e.currentTarget.style.background="hsl(var(--theme-muted))",onMouseLeave:e=>e.currentTarget.style.background="transparent",children:(0,t.jsx)(l.Menu,{className:"w-5 h-5"})}),(0,t.jsx)("button",{onClick:ea,className:"p-2 rounded-lg transition-colors hidden lg:flex",title:y?"Show sidebar":"Hide sidebar",style:{color:"hsl(var(--theme-foreground))"},onMouseEnter:e=>e.currentTarget.style.background="hsl(var(--theme-muted))",onMouseLeave:e=>e.currentTarget.style.background="transparent",children:y?(0,t.jsx)(i.PanelLeft,{className:"w-5 h-5"}):(0,t.jsx)(n.PanelLeftClose,{className:"w-5 h-5"})}),(0,t.jsx)("h1",{className:"text-lg font-semibold",style:{color:"hsl(var(--theme-foreground))"},children:"∞gent"}),(0,t.jsx)("div",{className:"flex-1"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[L.isConnected?(0,t.jsxs)("button",{onClick:L.stopSandbox,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm transition-colors",style:{background:"hsl(0 84% 60% / 0.2)",color:"hsl(0 84% 60%)"},onMouseEnter:e=>e.currentTarget.style.background="hsl(0 84% 60% / 0.3)",onMouseLeave:e=>e.currentTarget.style.background="hsl(0 84% 60% / 0.2)",children:[(0,t.jsx)(d.Square,{className:"w-4 h-4"}),"Stop"]}):(0,t.jsx)("button",{onClick:L.startSandbox,disabled:L.isCreating,className:(0,u.cn)("flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm transition-colors","disabled:opacity-50 disabled:cursor-not-allowed"),style:{background:"hsl(var(--theme-primary) / 0.2)",color:"hsl(var(--theme-primary))"},onMouseEnter:e=>e.currentTarget.style.background="hsl(var(--theme-primary) / 0.3)",onMouseLeave:e=>e.currentTarget.style.background="hsl(var(--theme-primary) / 0.2)",children:L.isCreating?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Loader2,{className:"w-4 h-4 animate-spin"}),"Starting..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Play,{className:"w-4 h-4"}),"Start Sandbox"]})}),L.isConnected&&(0,t.jsx)("span",{className:"text-xs font-medium",style:{color:"hsl(142 70% 45%)"},children:"● Connected"})]}),(0,t.jsx)("button",{onClick:()=>C(e=>!e),className:"p-2 rounded-lg transition-colors",title:k?"Hide code panel":"Show code panel",style:{background:k?"hsl(var(--theme-primary) / 0.2)":"transparent",color:k?"hsl(var(--theme-primary))":"hsl(var(--theme-muted-foreground))"},onMouseEnter:e=>{k||(e.currentTarget.style.background="hsl(var(--theme-muted))")},onMouseLeave:e=>{k||(e.currentTarget.style.background="transparent")},children:(0,t.jsx)(o.Code,{className:"w-5 h-5"})})]}),(0,t.jsx)(_,{contextChain:b,currentView:w,onViewChange:N,onEntityClick:e=>console.log("Entity clicked:",e),onRemoveEntity:Q,onClearContext:Z}),(0,t.jsx)("div",{className:"flex-1 min-h-0",children:(0,t.jsx)(ef,{messages:V,isStreaming:G,onSendMessage:K,onAbort:X,mentionSuggestions:R,onMentionSearch:J,onMentionSelect:Y,isVoiceEnabled:!0})}),(0,t.jsx)(a.AnimatePresence,{children:k&&(0,t.jsx)(ee,{isVisible:k,isExpanded:S,activeTab:E,onTabChange:M,onToggleExpanded:()=>A(e=>!e),onClose:()=>C(!1),code:L.currentFile?.content||"// Select a file or start coding...",language:L.currentFile?.language||"typescript",currentFile:L.currentFile?.path,onCodeChange:e=>{L.currentFile?.path&&L.writeFile(L.currentFile.path,e)},files:$,onFileSelect:et,terminalOutput:P,onRunCommand:es,isRunning:L.isRunning,previewUrl:L.previewUrl||void 0,onRefreshPreview:()=>{L.isConnected&&L.startDevServer()}})})]})]})})]})}function eW(){return(0,t.jsx)(eX,{children:(0,t.jsx)(eD.SandboxProvider,{children:(0,t.jsx)(eV,{})})})}let eK=(0,r.default)(()=>Promise.resolve(eW),{ssr:!1,loading:()=>(0,t.jsx)(eI,{isLoading:!0})});e.s(["default",0,eK],750365)}]);