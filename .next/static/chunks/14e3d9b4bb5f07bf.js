(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,39992,e=>{"use strict";var t=e.i(726151),s=e.i(923041),a=e.i(569206),r=e.i(662582),i=e.i(278124),n=e.i(946200),o=e.i(850402),l=e.i(334905),c=e.i(910158),d=e.i(975157),u=e.i(843762),m=e.i(86066),h=e.i(576161),x=e.i(657912),p=e.i(733006),g=e.i(555603),f=e.i(339492),b=e.i(254862),y=e.i(976974),w=e.i(55841),v=e.i(811785),j=e.i(981779),N=e.i(752153),k=e.i(271119),C=e.i(23670),S=e.i(973493),M=e.i(279821),D=e.i(129828),T=e.i(117343),P=e.i(618453),P=P,E=e.i(64263),E=E,z=e.i(431529),A=e.i(573138),$=e.i(850166),L=e.i(651555),R=e.i(408547);let I={"iphone-15-pro":{width:393,height:852,cornerRadius:55,safeAreaTop:59,safeAreaBottom:34,hasDynamicIsland:!0,scale:.5},"iphone-15":{width:393,height:852,cornerRadius:55,safeAreaTop:59,safeAreaBottom:34,hasDynamicIsland:!0,scale:.5},"iphone-se":{width:375,height:667,cornerRadius:40,safeAreaTop:20,safeAreaBottom:0,hasDynamicIsland:!1,scale:.5},"ipad-pro-11":{width:834,height:1194,cornerRadius:18,safeAreaTop:24,safeAreaBottom:20,hasDynamicIsland:!1,scale:.35}};function B({time:e="9:41",hasDynamicIsland:s=!0}){return(0,t.jsxs)("div",{className:"absolute top-0 left-0 right-0 flex items-center justify-between px-6 pt-3 text-[11px] font-semibold text-white z-10",children:[(0,t.jsx)("span",{className:(0,d.cn)(s&&"ml-1"),children:e}),s&&(0,t.jsx)("div",{className:"absolute left-1/2 -translate-x-1/2 top-3 w-[126px] h-[37px] bg-black rounded-full"}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsxs)("svg",{width:"18",height:"12",viewBox:"0 0 18 12",fill:"currentColor",className:"opacity-90",children:[(0,t.jsx)("rect",{x:"0",y:"6",width:"3",height:"6",rx:"1"}),(0,t.jsx)("rect",{x:"5",y:"4",width:"3",height:"8",rx:"1"}),(0,t.jsx)("rect",{x:"10",y:"2",width:"3",height:"10",rx:"1"}),(0,t.jsx)("rect",{x:"15",y:"0",width:"3",height:"12",rx:"1"})]}),(0,t.jsxs)("svg",{width:"16",height:"12",viewBox:"0 0 16 12",fill:"currentColor",className:"opacity-90",children:[(0,t.jsx)("path",{d:"M8 2.5C10.5 2.5 12.7 3.5 14.3 5.1L15.7 3.7C13.7 1.7 11 0.5 8 0.5C5 0.5 2.3 1.7 0.3 3.7L1.7 5.1C3.3 3.5 5.5 2.5 8 2.5Z"}),(0,t.jsx)("path",{d:"M8 6C9.7 6 11.2 6.7 12.3 7.8L13.7 6.4C12.2 4.9 10.2 4 8 4C5.8 4 3.8 4.9 2.3 6.4L3.7 7.8C4.8 6.7 6.3 6 8 6Z"}),(0,t.jsx)("circle",{cx:"8",cy:"10",r:"2"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,t.jsx)("div",{className:"w-[25px] h-[12px] border border-current rounded-[3px] p-[1px] opacity-90",children:(0,t.jsx)("div",{className:"w-[80%] h-full bg-current rounded-[1px]"})}),(0,t.jsx)("div",{className:"w-[1.5px] h-[5px] bg-current rounded-r-sm opacity-90"})]})]})]})}function F(){return(0,t.jsx)("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 w-[134px] h-[5px] bg-white/30 rounded-full"})}function U({deviceType:e="iphone-15-pro",screenTitle:s,screenContent:a,isSelected:i=!1,className:n,showStatusBar:o=!0,showHomeIndicator:l=!0,backgroundColor:c="#000000"}){let u=I[e],m=u.width*u.scale,h=u.height*u.scale;return(0,t.jsxs)(r.motion.div,{className:(0,d.cn)("relative select-none",i&&"ring-2 ring-blue-500 ring-offset-2 ring-offset-transparent",n),style:{width:m,height:h},children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-[#1c1c1e] shadow-2xl",style:{borderRadius:u.cornerRadius*u.scale,border:"2px solid #3a3a3c"},children:(0,t.jsxs)("div",{className:"absolute inset-[3px] overflow-hidden",style:{borderRadius:(u.cornerRadius-3)*u.scale,backgroundColor:c},children:[o&&(0,t.jsx)("div",{style:{transform:`scale(${u.scale})`,transformOrigin:"top left"},children:(0,t.jsx)(B,{hasDynamicIsland:u.hasDynamicIsland})}),(0,t.jsx)("div",{className:"absolute left-0 right-0 overflow-hidden",style:{top:u.safeAreaTop*u.scale,bottom:u.safeAreaBottom*u.scale},children:a||(0,t.jsx)("div",{className:"flex items-center justify-center h-full text-white/50 text-xs",children:s||"Screen"})}),l&&u.safeAreaBottom>0&&(0,t.jsx)("div",{style:{transform:`scale(${u.scale})`,transformOrigin:"bottom center"},children:(0,t.jsx)(F,{})})]})}),s&&(0,t.jsx)("div",{className:"absolute -bottom-6 left-1/2 -translate-x-1/2 text-xs text-white/70 font-medium whitespace-nowrap",children:s})]})}var _=e.i(298130),O=e.i(944342),X=e.i(621845),X=X,Y=e.i(950717),H=e.i(205344),V=e.i(384785);let q={"flow-start":{fill:"#10b981",stroke:"#059669",text:"#ffffff"},"flow-end":{fill:"#ef4444",stroke:"#dc2626",text:"#ffffff"},"flow-decision":{fill:"#f59e0b",stroke:"#d97706",text:"#000000"},"flow-process":{fill:"#3b82f6",stroke:"#2563eb",text:"#ffffff"},"flow-screen":{fill:"#8b5cf6",stroke:"#7c3aed",text:"#ffffff"},"flow-data":{fill:"#06b6d4",stroke:"#0891b2",text:"#ffffff"},"flow-subprocess":{fill:"#6366f1",stroke:"#4f46e5",text:"#ffffff"}},G={"flow-start":{width:120,height:50},"flow-end":{width:120,height:50},"flow-decision":{width:140,height:100},"flow-process":{width:160,height:80},"flow-screen":{width:140,height:90},"flow-data":{width:150,height:70},"flow-subprocess":{width:160,height:80}};function W({label:e,isStart:s,colors:a,width:r,height:i,isSelected:n}){return(0,t.jsxs)("div",{className:(0,d.cn)("flex items-center justify-center gap-2 font-medium text-sm",n&&"ring-2 ring-white ring-offset-2 ring-offset-transparent"),style:{width:r,height:i,backgroundColor:a.fill,border:`2px solid ${a.stroke}`,borderRadius:i/2,color:a.text},children:[s?(0,t.jsx)(m.Play,{className:"w-3 h-3"}):(0,t.jsx)(_.Square,{className:"w-3 h-3"}),e]})}function K({label:e,colors:s,width:a,height:r,isSelected:i}){return(0,t.jsxs)("div",{className:(0,d.cn)("relative flex items-center justify-center",i&&"filter drop-shadow-[0_0_4px_rgba(255,255,255,0.8)]"),style:{width:a,height:r},children:[(0,t.jsx)("div",{className:"absolute inset-[10%]",style:{backgroundColor:s.fill,border:`2px solid ${s.stroke}`,transform:"rotate(45deg)",borderRadius:4}}),(0,t.jsx)("span",{className:"relative z-10 font-medium text-sm text-center px-2 max-w-[80%]",style:{color:s.text},children:e})]})}function J({label:e,description:s,colors:a,width:r,height:i,isSelected:n}){return(0,t.jsxs)("div",{className:(0,d.cn)("flex flex-col items-center justify-center p-3 rounded-lg",n&&"ring-2 ring-white ring-offset-2 ring-offset-transparent"),style:{width:r,height:i,backgroundColor:a.fill,border:`2px solid ${a.stroke}`},children:[(0,t.jsx)("span",{className:"font-medium text-sm",style:{color:a.text},children:e}),s&&(0,t.jsx)("span",{className:"text-xs mt-1 opacity-80",style:{color:a.text},children:s})]})}function Z({label:e,colors:s,width:a,height:r,isSelected:i}){return(0,t.jsxs)("div",{className:(0,d.cn)("flex flex-col items-center justify-center p-3 rounded-lg",i&&"ring-2 ring-white ring-offset-2 ring-offset-transparent"),style:{width:a,height:r,backgroundColor:s.fill,border:`2px solid ${s.stroke}`},children:[(0,t.jsx)(X.default,{className:"w-5 h-5 mb-1",style:{color:s.text}}),(0,t.jsx)("span",{className:"font-medium text-sm text-center",style:{color:s.text},children:e})]})}function Q({label:e,colors:s,width:a,height:r,isSelected:i}){return(0,t.jsxs)("div",{className:(0,d.cn)("relative flex items-center justify-center",i&&"filter drop-shadow-[0_0_4px_rgba(255,255,255,0.8)]"),style:{width:a,height:r},children:[(0,t.jsx)("div",{className:"absolute inset-0",style:{backgroundColor:s.fill,border:`2px solid ${s.stroke}`,transform:"skewX(-10deg)",borderRadius:4}}),(0,t.jsxs)("div",{className:"relative z-10 flex items-center gap-2",children:[(0,t.jsx)(Y.Database,{className:"w-4 h-4",style:{color:s.text}}),(0,t.jsx)("span",{className:"font-medium text-sm",style:{color:s.text},children:e})]})]})}function ee({label:e,colors:s,width:a,height:r,isSelected:i}){return(0,t.jsxs)("div",{className:(0,d.cn)("relative flex items-center justify-center p-3 rounded-lg",i&&"ring-2 ring-white ring-offset-2 ring-offset-transparent"),style:{width:a,height:r,backgroundColor:s.fill,border:`2px solid ${s.stroke}`},children:[(0,t.jsx)("div",{className:"absolute inset-2 rounded border-2 pointer-events-none",style:{borderColor:s.stroke,opacity:.5}}),(0,t.jsx)("span",{className:"font-medium text-sm",style:{color:s.text},children:e})]})}function et({type:e,label:s,description:a,isSelected:i=!1,width:n,height:o,style:l,className:c}){let u=G[e],m=q[e],h=n??u.width,x=o??u.height,p={fill:l?.fill??m.fill,stroke:l?.stroke??m.stroke,text:m.text};return(0,t.jsx)(r.motion.div,{className:(0,d.cn)("cursor-pointer select-none",c),whileHover:{scale:1.02},whileTap:{scale:.98},children:(()=>{switch(e){case"flow-start":return(0,t.jsx)(W,{label:s,isStart:!0,colors:p,width:h,height:x,isSelected:i});case"flow-end":return(0,t.jsx)(W,{label:s,isStart:!1,colors:p,width:h,height:x,isSelected:i});case"flow-decision":return(0,t.jsx)(K,{label:s,colors:p,width:h,height:x,isSelected:i});case"flow-process":default:return(0,t.jsx)(J,{label:s,description:a,colors:p,width:h,height:x,isSelected:i});case"flow-screen":return(0,t.jsx)(Z,{label:s,colors:p,width:h,height:x,isSelected:i});case"flow-data":return(0,t.jsx)(Q,{label:s,colors:p,width:h,height:x,isSelected:i});case"flow-subprocess":return(0,t.jsx)(ee,{label:s,colors:p,width:h,height:x,isSelected:i})}})()})}m.Play,_.Square,O.Diamond,V.Layers,X.default,Y.Database,H.HardDrive;let es={"arch-service":{fill:"#3b82f6",stroke:"#2563eb",text:"#ffffff"},"arch-database":{fill:"#10b981",stroke:"#059669",text:"#ffffff"},"arch-client":{fill:"#8b5cf6",stroke:"#7c3aed",text:"#ffffff"},"arch-api":{fill:"#f59e0b",stroke:"#d97706",text:"#000000"},"arch-queue":{fill:"#ec4899",stroke:"#db2777",text:"#ffffff"},"arch-cache":{fill:"#ef4444",stroke:"#dc2626",text:"#ffffff"},"arch-cdn":{fill:"#06b6d4",stroke:"#0891b2",text:"#ffffff"},"arch-cloud":{fill:"#1e293b",stroke:"#475569",text:"#ffffff"}};function ea({label:e,description:s,colors:a,width:r,height:i,isSelected:n}){let o=.15*i;return(0,t.jsxs)("div",{className:(0,d.cn)("relative flex flex-col items-center justify-center",n&&"filter drop-shadow-[0_0_4px_rgba(255,255,255,0.8)]"),style:{width:r,height:i},children:[(0,t.jsx)("div",{className:"absolute top-0 left-0 right-0",style:{height:2*o,backgroundColor:a.fill,borderRadius:"50%",border:`2px solid ${a.stroke}`}}),(0,t.jsx)("div",{className:"absolute left-0 right-0",style:{top:o,bottom:o,backgroundColor:a.fill,borderLeft:`2px solid ${a.stroke}`,borderRight:`2px solid ${a.stroke}`}}),(0,t.jsx)("div",{className:"absolute bottom-0 left-0 right-0",style:{height:2*o,backgroundColor:a.fill,borderRadius:"50%",border:`2px solid ${a.stroke}`}}),(0,t.jsxs)("div",{className:"relative z-10 flex flex-col items-center",children:[(0,t.jsx)(Y.Database,{className:"w-5 h-5 mb-1",style:{color:a.text}}),(0,t.jsx)("span",{className:"font-medium text-sm",style:{color:a.text},children:e}),s&&(0,t.jsx)("span",{className:"text-xs opacity-80",style:{color:a.text},children:s})]})]})}function er({type:e,label:s,description:a,isSelected:i=!1,width:n=140,height:o=100,className:l}){let c=es[e];return"arch-database"===e?(0,t.jsx)(r.motion.div,{className:(0,d.cn)("cursor-pointer select-none",l),whileHover:{scale:1.02},whileTap:{scale:.98},children:(0,t.jsx)(ea,{label:s,description:a,colors:c,width:n,height:o,isSelected:i})}):(0,t.jsx)(r.motion.div,{className:(0,d.cn)("cursor-pointer select-none",l),whileHover:{scale:1.02},whileTap:{scale:.98},children:(0,t.jsxs)("div",{className:(0,d.cn)("flex flex-col items-center justify-center p-4 rounded-xl",i&&"ring-2 ring-white ring-offset-2 ring-offset-transparent","arch-cloud"===e&&"border-dashed"),style:{width:n,height:o,backgroundColor:c.fill,border:`2px ${"arch-cloud"===e?"dashed":"solid"} ${c.stroke}`},children:[(0,t.jsx)("span",{className:"font-semibold text-sm",style:{color:c.text},children:s}),a&&(0,t.jsx)("span",{className:"text-xs mt-1 opacity-80 text-center",style:{color:c.text},children:a})]})})}var ei=e.i(688399),en=e.i(631845),eo=e.i(610724);let el={"lyric-video":"#f59e0b",presentation:"#3b82f6","text-overlay":"#8b5cf6","social-story":"#ec4899","music-visualizer":"#10b981",slideshow:"#6366f1",custom:"#64748b"},ec={"lyric-video":(0,t.jsx)(g.Music,{className:"w-3.5 h-3.5"}),presentation:(0,t.jsx)(V.Layers,{className:"w-3.5 h-3.5"}),"text-overlay":(0,t.jsx)(en.Type,{className:"w-3.5 h-3.5"}),"social-story":(0,t.jsx)(p.Video,{className:"w-3.5 h-3.5"}),"music-visualizer":(0,t.jsx)(g.Music,{className:"w-3.5 h-3.5"}),slideshow:(0,t.jsx)(V.Layers,{className:"w-3.5 h-3.5"}),custom:(0,t.jsx)(p.Video,{className:"w-3.5 h-3.5"})};function ed({composition:e,isPlaying:s,onPlayPause:a,onExpand:r,onEdit:i}){let n=el[e.type]||el.custom,o=ec[e.type]||ec.custom,l=e.durationInFrames/e.fps;return(0,t.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/10",style:{backgroundColor:`${n}15`},children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{style:{color:n},children:o}),(0,t.jsx)("span",{className:"text-xs font-medium text-white/80 truncate max-w-[150px]",children:e.name}),(0,t.jsxs)("span",{className:"text-[10px] text-white/40 flex items-center gap-1",children:[(0,t.jsx)(eo.Clock,{className:"w-2.5 h-2.5"}),l.toFixed(1),"s"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),a()},className:"p-1 rounded hover:bg-white/10 transition-colors",title:s?"Pause":"Play",children:s?(0,t.jsx)(h.Pause,{className:"w-3.5 h-3.5 text-white/60"}):(0,t.jsx)(m.Play,{className:"w-3.5 h-3.5 text-white/60"})}),i&&(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),i()},className:"p-1 rounded hover:bg-white/10 transition-colors",title:"Edit composition",children:(0,t.jsx)(ei.Settings2,{className:"w-3.5 h-3.5 text-white/60"})}),r&&(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),r()},className:"p-1 rounded hover:bg-white/10 transition-colors",title:"Expand",children:(0,t.jsx)(L.Maximize2,{className:"w-3.5 h-3.5 text-white/60"})})]})]})}function eu({composition:e,isPlaying:s}){let a=e.width/e.height,r=el[e.type]||el.custom;return(0,t.jsxs)("div",{className:"relative bg-black/50 rounded overflow-hidden",style:{aspectRatio:a},children:[(0,t.jsx)("div",{className:"absolute inset-0",style:{background:e.backgroundGradient||e.backgroundColor||`linear-gradient(135deg, ${r}30 0%, ${r}10 100%)`}}),(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:0===e.layers.length?(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(p.Video,{className:"w-8 h-8 text-white/20 mx-auto mb-2"}),(0,t.jsx)("p",{className:"text-[10px] text-white/30",children:"No layers yet"})]}):(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center gap-1 mb-2",children:[(0,t.jsx)(V.Layers,{className:"w-4 h-4 text-white/40"}),(0,t.jsx)("span",{className:"text-xs text-white/60",children:e.layers.length})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1 justify-center px-4",children:Array.from(new Set(e.layers.map(e=>e.type))).map(e=>(0,t.jsx)("span",{className:"text-[9px] px-1.5 py-0.5 bg-white/10 rounded text-white/50",children:e},e))}),e.audio&&(0,t.jsxs)("div",{className:"mt-2 flex items-center justify-center gap-1 text-white/40",children:[(0,t.jsx)(g.Music,{className:"w-3 h-3"}),(0,t.jsx)("span",{className:"text-[10px]",children:"Audio"})]})]})}),s&&(0,t.jsxs)("div",{className:"absolute top-2 left-2 flex items-center gap-1 px-1.5 py-0.5 bg-red-500/80 rounded text-[9px] text-white",children:[(0,t.jsx)("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),"PREVIEW"]}),(0,t.jsxs)("div",{className:"absolute bottom-2 right-2 text-[9px] px-1.5 py-0.5 bg-black/50 rounded text-white/60",children:[e.preset," • ",e.fps,"fps"]})]})}function em({composition:e}){return(0,t.jsxs)("div",{className:"px-3 py-2 border-t border-white/5 flex items-center justify-between text-[10px] text-white/40",children:[(0,t.jsxs)("span",{children:[e.width,"×",e.height]}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(V.Layers,{className:"w-3 h-3"}),e.layers.length," layer",1!==e.layers.length?"s":""]})]})}function eh({composition:e,isSelected:a,onSelect:i,onDelete:n,onExpand:o,onEdit:l,width:c=300,height:u}){let[m,h]=(0,s.useState)(!1),x=el[e.type]||el.custom,p=(0,s.useCallback)(()=>{h(e=>!e)},[]);return(0,t.jsxs)(r.motion.div,{className:(0,d.cn)("rounded-lg overflow-hidden backdrop-blur-sm border transition-all",a?"ring-2 ring-offset-2 ring-offset-black/50":"hover:border-white/20"),style:{width:c,backgroundColor:"rgba(0, 0, 0, 0.6)",borderColor:a?x:"rgba(255, 255, 255, 0.1)","--tw-ring-color":x},onClick:i,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},children:[(0,t.jsx)(ed,{composition:e,isPlaying:m,onPlayPause:p,onExpand:o,onEdit:l}),(0,t.jsx)("div",{className:"p-3",children:(0,t.jsx)(eu,{composition:e,isPlaying:m})}),(0,t.jsx)(em,{composition:e})]})}var ex=e.i(122429),ep=e.i(248516),eg=e.i(684750),ef=e.i(746115),eb=e.i(8722),ey=e.i(745834);function ew({topic:e,sourcePhotoUrl:a,sceneStyle:i="podcast_studio",status:n="draft",script:o,audioUrl:l,finalVideoUrl:c,isSelected:d,width:h=320,onGenerate:x}){let[g,f]=(0,s.useState)(e||""),[b,y]=(0,s.useState)(a||""),[w,v]=(0,s.useState)(i),[j,N]=(0,s.useState)(!c),[k,M]=(0,s.useState)(!1),D=(0,s.useCallback)(async()=>{if(g&&b){if(M(!0),x)x({topic:g,sourcePhotoUrl:b,sceneStyle:w});else try{let e=await fetch("/api/talking-video",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"run_workflow",topic:g,sourcePhotoUrl:b,sceneStyle:w})}),t=await e.json();console.log("Talking video result:",t)}catch(e){console.error("Error generating talking video:",e)}M(!1)}},[g,b,w,x]),T=["generating_script","generating_voice","generating_background","lip_syncing"].includes(n);return(0,t.jsxs)(r.motion.div,{className:`bg-gradient-to-br from-purple-900/40 to-pink-900/40 rounded-xl border overflow-hidden ${d?"border-purple-500 ring-2 ring-purple-500/30":"border-white/10"}`,style:{width:h},initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 bg-black/30 border-b border-white/10",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"p-1.5 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg",children:(0,t.jsx)(p.Video,{className:"w-3.5 h-3.5 text-white"})}),(0,t.jsx)("span",{className:"text-sm font-medium text-white",children:"Talking Video"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1 text-xs text-white/60",children:[(()=>{switch(n){case"generating_script":return(0,t.jsx)(u.Sparkles,{className:"w-4 h-4 animate-pulse"});case"generating_voice":return(0,t.jsx)(ex.Mic,{className:"w-4 h-4 animate-pulse"});case"generating_background":return(0,t.jsx)(ep.Film,{className:"w-4 h-4 animate-pulse"});case"lip_syncing":return(0,t.jsx)(eg.Volume2,{className:"w-4 h-4 animate-pulse"});case"complete":return(0,t.jsx)(eb.Check,{className:"w-4 h-4 text-green-400"});case"error":return(0,t.jsx)(A.RefreshCw,{className:"w-4 h-4 text-red-400"});default:return(0,t.jsx)(p.Video,{className:"w-4 h-4"})}})(),(0,t.jsx)("span",{children:(()=>{switch(n){case"generating_script":return"Writing script...";case"script_ready":return"Script ready";case"generating_voice":return"Generating voice...";case"voice_ready":return"Voice ready";case"generating_background":return"Creating background...";case"background_ready":return"Background ready";case"lip_syncing":return"Syncing lips...";case"complete":return"Complete!";case"error":return"Error";default:return"Ready to generate"}})()})]}),(0,t.jsx)("button",{onClick:()=>N(!j),className:"p-1 hover:bg-white/10 rounded transition-colors",children:j?(0,t.jsx)(C.ChevronUp,{className:"w-4 h-4 text-white/60"}):(0,t.jsx)(S.ChevronDown,{className:"w-4 h-4 text-white/60"})})]})]}),c?(0,t.jsxs)("div",{className:"p-2",children:[(0,t.jsx)("video",{src:c,controls:!0,className:"w-full rounded-lg",poster:b}),j&&o&&(0,t.jsxs)("div",{className:"mt-2 p-2 bg-black/30 rounded-lg",children:[(0,t.jsx)("p",{className:"text-xs text-white/50 mb-1",children:"Script:"}),(0,t.jsx)("p",{className:"text-xs text-white/80 line-clamp-3",children:o})]}),(0,t.jsxs)("a",{href:c,download:!0,className:"mt-2 flex items-center justify-center gap-2 px-3 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-sm transition-colors",children:[(0,t.jsx)(ey.Download,{className:"w-4 h-4"}),"Download"]})]}):j?(0,t.jsxs)("div",{className:"p-3 space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs text-white/50 mb-1 block",children:"Topic"}),(0,t.jsx)("textarea",{value:g,onChange:e=>f(e.target.value),placeholder:"What should the video be about?",className:"w-full bg-black/30 rounded-lg px-3 py-2 text-sm placeholder:text-white/30 focus:outline-none focus:ring-1 focus:ring-purple-500/50 resize-none",rows:2,disabled:T})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs text-white/50 mb-1 block",children:"Photo URL"}),(0,t.jsx)("input",{type:"url",value:b,onChange:e=>y(e.target.value),placeholder:"https://example.com/photo.jpg",className:"w-full bg-black/30 rounded-lg px-3 py-2 text-sm placeholder:text-white/30 focus:outline-none focus:ring-1 focus:ring-purple-500/50",disabled:T})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs text-white/50 mb-1 block",children:"Scene"}),(0,t.jsxs)("select",{value:w,onChange:e=>v(e.target.value),className:"w-full bg-black/30 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-purple-500/50",disabled:T,children:[(0,t.jsx)("option",{value:"podcast_studio",children:"Podcast Studio"}),(0,t.jsx)("option",{value:"office",children:"Office"}),(0,t.jsx)("option",{value:"outdoor",children:"Outdoor"}),(0,t.jsx)("option",{value:"news_desk",children:"News Desk"}),(0,t.jsx)("option",{value:"living_room",children:"Living Room"}),(0,t.jsx)("option",{value:"conference",children:"Conference Room"})]})]}),(0,t.jsx)("button",{onClick:D,disabled:!g||!b||T||k,className:"w-full flex items-center justify-center gap-2 py-2.5 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed transition-all hover:scale-[1.02] active:scale-[0.98]",children:T||k?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ef.Loader2,{className:"w-4 h-4 animate-spin"}),"Generating..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Play,{className:"w-4 h-4"}),"Generate Video"]})})]}):(0,t.jsx)("div",{className:"p-3",children:(0,t.jsx)("p",{className:"text-sm text-white/60 text-center",children:g||"No topic set"})}),T&&(0,t.jsx)("div",{className:"px-3 pb-3",children:(0,t.jsx)("div",{className:"flex gap-1",children:["generating_script","generating_voice","generating_background","lip_syncing"].map((e,s)=>{let a=["generating_script","script_ready","generating_voice","voice_ready","generating_background","background_ready","lip_syncing"].indexOf(n),r=2*s;return(0,t.jsx)("div",{className:`flex-1 h-1 rounded-full transition-colors ${a>r?"bg-green-500":a===r||a===r+1?"bg-purple-500 animate-pulse":"bg-white/20"}`},e)})})})]})}var ev=e.i(162220),ej=e.i(676516),eN=e.i(982512),ek=e.i(167281),eC=e.i(162647),eC=eC,eS=e.i(907928),P=P,E=E,eM=e.i(898019),eM=eM,eD=e.i(617415),eT=e.i(954621),eP=e.i(413698);function eE({position:e,onClose:a,onAddNode:n,onCopy:o,onCut:l,onPaste:c,onDelete:m,onDuplicate:h,onEdit:w,onRegenerate:N,onChangeStyle:k,onAddConnection:C,onAddToContext:S,onLock:T,onBringToFront:z,onSendToBack:L,onZoomToFit:R,onCenterView:I,onSelectAll:B,onCanvasSettings:F,isLocked:U=!1,canRegenerate:O=!1}){var X,H;let q,G,W=(0,s.useRef)(null);if((0,s.useEffect)(()=>{if(!e)return;let t=e=>{W.current&&!W.current.contains(e.target)&&a()},s=e=>{"Escape"===e.key&&a()};return document.addEventListener("mousedown",t),document.addEventListener("keydown",s),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",s)}},[e,a]),!e)return null;let K=[{id:"text",label:"Text",icon:(0,t.jsx)(en.Type,{className:"w-4 h-4"})},{id:"sticky",label:"Sticky Note",icon:(0,t.jsx)(ej.StickyNote,{className:"w-4 h-4"})},{id:"image",label:"Image",icon:(0,t.jsx)(x.Image,{className:"w-4 h-4"})},{id:"shape",label:"Shape",icon:(0,t.jsx)(_.Square,{className:"w-4 h-4"})},{id:"code",label:"Code Block",icon:(0,t.jsx)(eN.Code,{className:"w-4 h-4"})},{id:"divider-1",label:"",divider:!0},{id:"video",label:"Video",icon:(0,t.jsx)(p.Video,{className:"w-4 h-4"})},{id:"audio-beat-sync",label:"Audio / Beat Sync",icon:(0,t.jsx)(g.Music,{className:"w-4 h-4"})},{id:"ai_generation",label:"AI Generator",icon:(0,t.jsx)(u.Sparkles,{className:"w-4 h-4"})},{id:"divider-2",label:"",divider:!0},{id:"device-frame",label:"Device Frame",icon:(0,t.jsx)(ek.Smartphone,{className:"w-4 h-4"})},{id:"flow-process",label:"Flow Node",icon:(0,t.jsx)(f.GitBranch,{className:"w-4 h-4"})},{id:"arch-service",label:"Architecture Node",icon:(0,t.jsx)(Y.Database,{className:"w-4 h-4"})}],J=[{id:"add-node",label:"Add Node",icon:(0,t.jsx)(V.Layers,{className:"w-4 h-4"}),submenu:K},{id:"divider-1",label:"",divider:!0},{id:"paste",label:"Paste",icon:(0,t.jsx)(eC.default,{className:"w-4 h-4"}),shortcut:"⌘V",action:c},{id:"select-all",label:"Select All",icon:(0,t.jsx)(_.Square,{className:"w-4 h-4"}),shortcut:"⌘A",action:B},{id:"divider-2",label:"",divider:!0},{id:"zoom-fit",label:"Zoom to Fit",icon:(0,t.jsx)(eD.ZoomIn,{className:"w-4 h-4"}),action:R},{id:"center",label:"Center View",icon:(0,t.jsx)(eT.Target,{className:"w-4 h-4"}),shortcut:"⌘0",action:I},{id:"divider-3",label:"",divider:!0},{id:"settings",label:"Canvas Settings",icon:(0,t.jsx)(eP.Settings,{className:"w-4 h-4"}),action:F}],Z=[{id:"edit",label:"Edit",icon:(0,t.jsx)(v.Edit3,{className:"w-4 h-4"}),shortcut:"Enter",action:w},...O?[{id:"regenerate",label:"Regenerate",icon:(0,t.jsx)(A.RefreshCw,{className:"w-4 h-4"}),action:N}]:[],{id:"divider-1",label:"",divider:!0},{id:"copy",label:"Copy",icon:(0,t.jsx)(j.Copy,{className:"w-4 h-4"}),shortcut:"⌘C",action:o},{id:"cut",label:"Cut",icon:(0,t.jsx)(M.Scissors,{className:"w-4 h-4"}),shortcut:"⌘X",action:l},{id:"duplicate",label:"Duplicate",icon:(0,t.jsx)(j.Copy,{className:"w-4 h-4"}),shortcut:"⌘D",action:h},{id:"delete",label:"Delete",icon:(0,t.jsx)(b.Trash2,{className:"w-4 h-4"}),shortcut:"⌫",danger:!0,action:m},{id:"divider-2",label:"",divider:!0},{id:"style",label:"Change Style",icon:(0,t.jsx)(y.Palette,{className:"w-4 h-4"}),action:k},{id:"resize",label:"Resize",icon:(0,t.jsx)(eM.default,{className:"w-4 h-4"})},{id:"connection",label:"Add Connection",icon:(0,t.jsx)($.Link,{className:"w-4 h-4"}),action:C},{id:"context",label:"Add to Context",icon:(0,t.jsx)(eS.Pin,{className:"w-4 h-4"}),action:S},{id:"divider-3",label:"",divider:!0},{id:"lock",label:U?"Unlock Position":"Lock Position",icon:(0,t.jsx)(D.Lock,{className:"w-4 h-4"}),action:T},{id:"front",label:"Bring to Front",icon:(0,t.jsx)(P.default,{className:"w-4 h-4"}),shortcut:"]",action:z},{id:"back",label:"Send to Back",icon:(0,t.jsx)(E.default,{className:"w-4 h-4"}),shortcut:"[",action:L}],Q="canvas"===e.type?J:Z,{x:ee,y:et}=(X=e.x,H=e.y,q=X,G=H,X+220>window.innerWidth-8&&(q=window.innerWidth-220-8),H+400>window.innerHeight-8&&(G=window.innerHeight-400-8),{x:q,y:G});return(0,t.jsx)(i.AnimatePresence,{children:(0,t.jsx)(r.motion.div,{ref:W,initial:{opacity:0,scale:.95,y:-5},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95},transition:{duration:.12,ease:"easeOut"},className:"fixed z-[9999] min-w-[200px] py-1.5 rounded-xl bg-background/95 backdrop-blur-xl border border-border shadow-2xl",style:{left:ee,top:et},children:Q.map(s=>s.divider?(0,t.jsx)("div",{className:"my-1.5 h-px bg-border/50"},s.id):s.submenu?(0,t.jsx)(ez,{item:s,onSelect:t=>{n(t.id,e.x,e.y),a()}},s.id):(0,t.jsxs)("button",{onClick:()=>{s.action?.(),a()},disabled:s.disabled,className:(0,d.cn)("w-full flex items-center gap-3 px-3 py-2 text-sm text-left","hover:bg-accent/50 transition-colors duration-100","disabled:opacity-50 disabled:cursor-not-allowed",s.danger&&"text-destructive hover:bg-destructive/10"),children:[s.icon&&(0,t.jsx)("span",{className:"text-muted-foreground",children:s.icon}),(0,t.jsx)("span",{className:"flex-1",children:s.label}),s.shortcut&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground/70",children:s.shortcut})]},s.id))})})}function ez({item:e,onSelect:s}){return(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsxs)("button",{className:(0,d.cn)("w-full flex items-center gap-3 px-3 py-2 text-sm text-left","hover:bg-accent/50 transition-colors duration-100"),children:[e.icon&&(0,t.jsx)("span",{className:"text-muted-foreground",children:e.icon}),(0,t.jsx)("span",{className:"flex-1",children:e.label}),(0,t.jsx)(N.ChevronRight,{className:"w-4 h-4 text-muted-foreground"})]}),(0,t.jsx)("div",{className:"absolute left-full top-0 ml-1 hidden group-hover:block",children:(0,t.jsx)(r.motion.div,{initial:{opacity:0,x:-5},animate:{opacity:1,x:0},className:"min-w-[180px] py-1.5 rounded-xl bg-background/95 backdrop-blur-xl border border-border shadow-2xl",children:e.submenu?.map(e=>e.divider?(0,t.jsx)("div",{className:"my-1.5 h-px bg-border/50"},e.id):(0,t.jsxs)("button",{onClick:()=>s(e),className:(0,d.cn)("w-full flex items-center gap-3 px-3 py-2 text-sm text-left","hover:bg-accent/50 transition-colors duration-100"),children:[e.icon&&(0,t.jsx)("span",{className:"text-muted-foreground",children:e.icon}),(0,t.jsx)("span",{className:"flex-1",children:e.label})]},e.id))})})]})}var eA=e.i(629386),e$=e.i(734545),eL=e.i(465231),eR=e.i(429931),eI=e.i(42181),eB=e.i(72029);let eF={intro:{bg:"rgba(59, 130, 246, 0.15)",border:"rgba(59, 130, 246, 0.4)",glow:"rgba(59, 130, 246, 0.3)"},verse:{bg:"rgba(34, 197, 94, 0.15)",border:"rgba(34, 197, 94, 0.4)",glow:"rgba(34, 197, 94, 0.3)"},prechorus:{bg:"rgba(168, 85, 247, 0.15)",border:"rgba(168, 85, 247, 0.4)",glow:"rgba(168, 85, 247, 0.3)"},chorus:{bg:"rgba(168, 85, 247, 0.2)",border:"rgba(168, 85, 247, 0.5)",glow:"rgba(168, 85, 247, 0.4)"},bridge:{bg:"rgba(249, 115, 22, 0.15)",border:"rgba(249, 115, 22, 0.4)",glow:"rgba(249, 115, 22, 0.3)"},outro:{bg:"rgba(107, 114, 128, 0.15)",border:"rgba(107, 114, 128, 0.4)",glow:"rgba(107, 114, 128, 0.3)"},break:{bg:"rgba(236, 72, 153, 0.15)",border:"rgba(236, 72, 153, 0.4)",glow:"rgba(236, 72, 153, 0.3)"},solo:{bg:"rgba(234, 179, 8, 0.15)",border:"rgba(234, 179, 8, 0.4)",glow:"rgba(234, 179, 8, 0.3)"}},eU={kick:{color:"#EF4444",glow:"rgba(239, 68, 68, 0.6)"},snare:{color:"#3B82F6",glow:"rgba(59, 130, 246, 0.6)"},hihat:{color:"#EAB308",glow:"rgba(234, 179, 8, 0.4)"},crash:{color:"#EC4899",glow:"rgba(236, 72, 153, 0.6)"},other:{color:"#6B7280",glow:"rgba(107, 114, 128, 0.4)"}};function e_({waveformData:e,beats:a,sections:n,currentTime:o,duration:l,isPlaying:c,onSeek:u,width:m,height:h=120,showBeats:x=!0,showSections:p=!0,accentColor:g}){let f=(0,s.useRef)(null),b=(0,s.useRef)(null),y=(0,s.useRef)(null),[w,v]=(0,s.useState)(null),[j,N]=(0,s.useState)(!1),[k,C]=(0,s.useState)(null),S=(0,eI.useSpring)(0,{...eR.springs.smooth,bounce:0}),M=(0,s.useMemo)(()=>l>0?o/l*100:0,[o,l]);(0,s.useEffect)(()=>{S.set(M)},[M,S]);let D=(0,s.useMemo)(()=>{if(!n.length||!l)return null;let e=1e3*o;return n.find(t=>e>=t.startMs&&e<t.endMs)},[n,o,l]);(0,s.useEffect)(()=>{if(!c||!a.length)return void C(null);let e=1e3*o,t=a.find(t=>50>Math.abs(t.timeMs-e)&&t.intensity>.5);if(t){C(t);let e=setTimeout(()=>C(null),150);return()=>clearTimeout(e)}},[o,a,c]);let T=(0,s.useCallback)(()=>{let t=f.current;if(!t||!e.length)return;let s=t.getContext("2d");if(!s)return;let r=window.devicePixelRatio||1,i=t.width/r,c=t.height/r,d=c/2,u=i/e.length,m=l>0?o/l*i:0;if(s.clearRect(0,0,i*r,c*r),s.scale(r,r),p&&n.length&&l>0&&n.forEach(e=>{let t=e.startMs/1e3/l*i,a=e.endMs/1e3/l*i,r=eF[e.type]||eF.verse;s.fillStyle=r.bg,s.fillRect(t,0,a-t,c),e.startMs>0&&(s.fillStyle=r.border,s.fillRect(t,0,1,c))}),e.forEach((e,t)=>{let a=t*u,r=Math.max(2,e*c*.85),i=a<m,n=s.createLinearGradient(a,d-r/2,a,d+r/2);i?(n.addColorStop(0,g||"rgba(168, 85, 247, 0.9)"),n.addColorStop(.5,g||"rgba(139, 92, 246, 1)"),n.addColorStop(1,g||"rgba(168, 85, 247, 0.9)")):(n.addColorStop(0,"rgba(139, 92, 246, 0.25)"),n.addColorStop(.5,"rgba(139, 92, 246, 0.35)"),n.addColorStop(1,"rgba(139, 92, 246, 0.25)")),s.fillStyle=n;let o=Math.max(1,.15*u);s.fillRect(a,d-r/2,u-o,r)}),x&&a.length&&l>0&&a.forEach(e=>{let t=e.timeMs/1e3/l*i,a=eU[e.type]||eU.other;s.beginPath(),s.strokeStyle=a.color,s.lineWidth=e.isDownbeat?2.5:1.5,s.globalAlpha=.7*e.intensity,e.isDownbeat?s.setLineDash([]):s.setLineDash([2,4]),s.moveTo(t,0),s.lineTo(t,c),s.stroke(),s.globalAlpha=1,s.setLineDash([]),e.isDownbeat&&(s.beginPath(),s.fillStyle=a.color,s.arc(t,6,3,0,2*Math.PI),s.fill())}),null!==w&&l>0){let e=w/l*i;s.beginPath(),s.strokeStyle="rgba(255, 255, 255, 0.6)",s.lineWidth=1,s.setLineDash([3,3]),s.moveTo(e,0),s.lineTo(e,c),s.stroke(),s.setLineDash([])}s.setTransform(1,0,0,1,0,0)},[e,a,n,o,l,x,p,w,g]);(0,s.useEffect)(()=>{let e=f.current;if(!e)return;let t=window.devicePixelRatio||1;e.width=m*t,e.height=h*t,e.style.width=`${m}px`,e.style.height=`${h}px`},[m,h]),(0,s.useEffect)(()=>{let e=()=>{T(),c&&(y.current=requestAnimationFrame(e))};return e(),()=>{y.current&&cancelAnimationFrame(y.current)}},[T,c]),(0,s.useEffect)(()=>{T()},[T,e,a,n,o,w]);let P=(0,s.useCallback)(e=>{let t=b.current;if(!t||!l)return 0;let s=t.getBoundingClientRect();return Math.max(0,Math.min(1,(e-s.left)/s.width))*l},[l]),E=(0,s.useCallback)(e=>{let t=P(e.clientX);v(t),j&&u(t)},[P,j,u]),z=(0,s.useCallback)(e=>{N(!0),u(P(e.clientX))},[P,u]),A=(0,s.useCallback)(()=>{N(!1)},[]),$=(0,s.useCallback)(()=>{v(null),N(!1)},[]);(0,s.useEffect)(()=>{if(j){let e=()=>N(!1);return window.addEventListener("mouseup",e),()=>window.removeEventListener("mouseup",e)}},[j]);let L=e=>{let t=Math.floor(e/60),s=Math.floor(e%60);return`${t}:${s.toString().padStart(2,"0")}`};return(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("div",{ref:b,className:(0,d.cn)("relative rounded-xl overflow-hidden cursor-pointer","bg-gradient-to-b from-background/50 to-muted/30","ring-1 ring-border/30","transition-shadow duration-200",j&&"ring-2 ring-primary/50 shadow-lg shadow-primary/20"),style:{width:m,height:h},onMouseMove:E,onMouseDown:z,onMouseUp:A,onMouseLeave:$,children:[(0,t.jsx)("canvas",{ref:f,className:"absolute inset-0",style:{width:m,height:h}}),(0,t.jsx)(r.motion.div,{className:"absolute top-0 bottom-0 w-0.5 pointer-events-none z-10",style:{left:(0,eB.useTransform)(S,e=>`${e}%`),background:"linear-gradient(to bottom, rgba(34, 197, 94, 0.8), rgba(34, 197, 94, 1), rgba(34, 197, 94, 0.8))",boxShadow:c?"0 0 8px rgba(34, 197, 94, 0.8), 0 0 16px rgba(34, 197, 94, 0.4)":"0 0 4px rgba(34, 197, 94, 0.5)"},children:(0,t.jsx)(r.motion.div,{className:(0,d.cn)("absolute -top-1 left-1/2 -translate-x-1/2","w-3 h-3 rounded-full","bg-green-500 border-2 border-white shadow-lg"),animate:{scale:c?[1,1.1,1]:1},transition:{duration:.5,repeat:c?1/0:0,ease:"easeInOut"}})}),(0,t.jsx)(i.AnimatePresence,{children:k&&(0,t.jsx)(r.motion.div,{className:"absolute inset-0 pointer-events-none",initial:{opacity:.6},animate:{opacity:0},exit:{opacity:0},transition:{duration:.15},style:{background:k.isDownbeat?`radial-gradient(circle at 50% 50%, ${eU[k.type].glow}, transparent 70%)`:"transparent"}},k.timeMs)}),(0,t.jsx)(i.AnimatePresence,{children:null!==w&&!j&&(0,t.jsx)(r.motion.div,{className:(0,d.cn)("absolute top-2 px-2 py-1 rounded-md","bg-background/90 backdrop-blur-sm","text-xs font-mono text-foreground","border border-border/50 shadow-lg","pointer-events-none z-20"),initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:4},transition:eR.springs.snappy,style:{left:`${w/l*100}%`,transform:"translateX(-50%)"},children:L(w)})})]}),p&&n.length>0&&(0,t.jsx)("div",{className:"flex gap-0.5 mt-2",style:{width:m},children:n.map((e,s)=>{let a=(e.endMs-e.startMs)/1e3/l*100,i=eF[e.type]||eF.verse,n=D?.startMs===e.startMs;return(0,t.jsx)(r.motion.div,{className:(0,d.cn)("relative rounded-md px-1.5 py-1","text-[10px] font-medium text-center truncate","border transition-all duration-200",n&&"ring-1 ring-primary/50"),style:{width:`${a}%`,backgroundColor:i.bg,borderColor:i.border,boxShadow:n?`0 0 8px ${i.glow}`:"none"},animate:{scale:n?1.02:1},transition:eR.springs.snappy,children:(0,t.jsx)("span",{className:"opacity-80",children:e.label})},s)})}),(0,t.jsxs)("div",{className:"flex justify-between mt-2 px-1 text-xs font-mono text-muted-foreground",children:[(0,t.jsx)("span",{children:L(o)}),(0,t.jsx)("span",{className:"text-foreground/60",children:D&&(0,t.jsx)("span",{className:"mr-2 text-primary",children:D.label})}),(0,t.jsx)("span",{children:L(l)})]})]})}var eO=e.i(754401),eX=e.i(574238),eY=e.i(134863),eH=e.i(116556),eH=eH;function eV({isPlaying:e,onPlayPause:a,onSkipBack:n,onSkipForward:o,volume:l,onVolumeChange:c,isMuted:u,onToggleMute:x,currentTime:p,duration:g,disabled:f=!1,size:b="md",showVolumeSlider:y=!0,className:w}){let[v,j]=(0,s.useState)(!1),N={sm:{icon:"w-3.5 h-3.5",playIcon:"w-4 h-4",playBtn:"w-8 h-8",btn:"w-6 h-6 p-1"},md:{icon:"w-4 h-4",playIcon:"w-5 h-5",playBtn:"w-10 h-10",btn:"w-8 h-8 p-1.5"},lg:{icon:"w-5 h-5",playIcon:"w-6 h-6",playBtn:"w-12 h-12",btn:"w-10 h-10 p-2"}}[b],k=e=>{let t=Math.floor(e/60),s=Math.floor(e%60);return`${t}:${s.toString().padStart(2,"0")}`},C=u||0===l?eY.VolumeX:l<.5?eH.default:eg.Volume2;return(0,t.jsxs)("div",{className:(0,d.cn)("flex items-center gap-3",w),children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(r.motion.button,{onClick:n,disabled:f,className:(0,d.cn)("rounded-lg flex items-center justify-center","text-muted-foreground hover:text-foreground","hover:bg-accent/50 active:bg-accent","transition-colors duration-150","disabled:opacity-40 disabled:cursor-not-allowed",N.btn),whileHover:{scale:1.05},whileTap:{scale:.95},children:(0,t.jsx)(eO.SkipBack,{className:N.icon})}),(0,t.jsx)(r.motion.button,{onClick:a,disabled:f,className:(0,d.cn)("rounded-full flex items-center justify-center","bg-primary text-primary-foreground","hover:bg-primary/90 active:bg-primary/80","disabled:opacity-40 disabled:cursor-not-allowed","shadow-lg shadow-primary/20","transition-all duration-200",N.playBtn),whileHover:{scale:1.05},whileTap:{scale:.92},animate:{boxShadow:e?["0 4px 12px rgba(139, 92, 246, 0.3)","0 4px 20px rgba(139, 92, 246, 0.5)","0 4px 12px rgba(139, 92, 246, 0.3)"]:"0 4px 12px rgba(139, 92, 246, 0.3)"},transition:{boxShadow:{duration:1.5,repeat:e?1/0:0,ease:"easeInOut"}},children:(0,t.jsx)(i.AnimatePresence,{mode:"wait",children:(0,t.jsx)(r.motion.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.5,opacity:0},transition:eR.springs.snappy,children:e?(0,t.jsx)(h.Pause,{className:N.playIcon}):(0,t.jsx)(m.Play,{className:(0,d.cn)(N.playIcon,"ml-0.5")})},e?"pause":"play")})}),(0,t.jsx)(r.motion.button,{onClick:o,disabled:f,className:(0,d.cn)("rounded-lg flex items-center justify-center","text-muted-foreground hover:text-foreground","hover:bg-accent/50 active:bg-accent","transition-colors duration-150","disabled:opacity-40 disabled:cursor-not-allowed",N.btn),whileHover:{scale:1.05},whileTap:{scale:.95},children:(0,t.jsx)(eX.SkipForward,{className:N.icon})})]}),(0,t.jsxs)("div",{className:"relative flex items-center gap-1.5",onMouseEnter:()=>j(!0),onMouseLeave:()=>j(!1),children:[(0,t.jsx)(r.motion.button,{onClick:x,className:(0,d.cn)("rounded-lg flex items-center justify-center","text-muted-foreground hover:text-foreground","hover:bg-accent/50 active:bg-accent","transition-colors duration-150",N.btn),whileHover:{scale:1.05},whileTap:{scale:.95},children:(0,t.jsx)(C,{className:N.icon})}),(0,t.jsx)(i.AnimatePresence,{children:(y||v)&&(0,t.jsx)(r.motion.div,{className:"flex items-center",initial:{width:0,opacity:0},animate:{width:80,opacity:1},exit:{width:0,opacity:0},transition:eR.springs.snappy,children:(0,t.jsxs)("div",{className:"relative w-20 h-1.5 bg-muted rounded-full overflow-hidden",children:[(0,t.jsx)(r.motion.div,{className:"absolute inset-y-0 left-0 bg-primary rounded-full",style:{width:`${(u?0:l)*100}%`},layout:!0,transition:eR.springs.snappy}),(0,t.jsx)("input",{type:"range",min:"0",max:"1",step:"0.05",value:u?0:l,onChange:e=>c(parseFloat(e.target.value)),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),(0,t.jsx)(r.motion.div,{className:"absolute top-1/2 -translate-y-1/2 w-3 h-3 rounded-full bg-primary shadow-md",style:{left:`calc(${(u?0:l)*100}% - 6px)`},whileHover:{scale:1.2},transition:eR.springs.snappy})]})})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-xs font-mono text-muted-foreground ml-auto",children:[(0,t.jsx)("span",{className:"tabular-nums",children:k(p)}),(0,t.jsx)("span",{className:"text-foreground/30",children:"/"}),(0,t.jsx)("span",{className:"tabular-nums opacity-70",children:k(g)})]})]})}let eq={kick:{color:"bg-red-500",label:"Kick",ring:"ring-red-500/30"},snare:{color:"bg-blue-500",label:"Snare",ring:"ring-blue-500/30"},hihat:{color:"bg-yellow-500",label:"Hi-hat",ring:"ring-yellow-500/30"},crash:{color:"bg-pink-500",label:"Crash",ring:"ring-pink-500/30"},other:{color:"bg-gray-400",label:"Other",ring:"ring-gray-400/30"}};function eG({beats:e,showCounts:s=!0,className:a}){let i=e.reduce((e,t)=>(e[t.type]=(e[t.type]||0)+1,e),{}),n=e.filter(e=>e.isDownbeat).length;return(0,t.jsxs)("div",{className:(0,d.cn)("flex flex-wrap items-center gap-3 text-[10px]",a),children:[Object.entries(eq).map(([e,a])=>{let n=i[e]||0;return 0===n&&s?null:(0,t.jsxs)(r.motion.div,{className:"flex items-center gap-1.5",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.2},children:[(0,t.jsx)("div",{className:(0,d.cn)("w-2.5 h-2.5 rounded-full ring-2",a.color,a.ring)}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:[a.label,s&&n>0&&(0,t.jsxs)("span",{className:"ml-1 font-mono text-foreground/70",children:["(",n,")"]})]})]},e)}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5 ml-2 pl-2 border-l border-border/50",children:[(0,t.jsx)("div",{className:"w-4 h-0.5 bg-white ring-1 ring-white/40 rounded-full"}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:["Downbeat",s&&n>0&&(0,t.jsxs)("span",{className:"ml-1 font-mono text-foreground/70",children:["(",n,")"]})]})]})]})}async function eW(e,t={method:"web-audio",onsetThreshold:.3,classifyBeats:!0,detectSections:!0,frequencyRanges:{kick:[20,150],snare:[150,1e3],hihat:[3e3,16e3]}}){var s,a,r,i;let n=e.sampleRate,o=e.getChannelData(0),l=1e3*e.duration|0,c=function(e,t){if(e.length<4)return 120;let s=[];for(let t=1;t<e.length;t++)s.push(e[t].timeMs-e[t-1].timeMs);let a=Math.ceil(70),r=new Float64Array(a);for(let e of s){if(e>=300&&e<=1e3){let t=Math.floor((e-300)/10);t>=0&&t<a&&(r[t]+=1)}let t=e/2;if(t>=300&&t<=1e3){let e=Math.floor((t-300)/10);e>=0&&e<a&&(r[e]+=.5)}let s=2*e;if(s>=300&&s<=1e3){let e=Math.floor((s-300)/10);e>=0&&e<a&&(r[e]+=.5)}}let i=0,n=0;for(let e=0;e<a;e++)r[e]>n&&(n=r[e],i=e);return Math.max(60,Math.min(200,Math.round(6e4/(300+10*i+5)*10)/10))}(function(e,t,s){let a=Math.floor((e.length-1024)/512),r=[],i=null;for(let n=0;n<a;n++){let a=512*n,o=function(e,t){let s=new Float64Array(16),a=Math.floor(e.length/16);for(let t=0;t<16;t++){let r=0;for(let s=t*a;s<(t+1)*a&&s<e.length;s++)r+=e[s]*e[s];s[t]=Math.sqrt(r/a)}return s}(function(e){let t=new Float32Array(e.length);for(let s=0;s<e.length;s++){let a=.5*(1-Math.cos(2*Math.PI*s/(e.length-1)));t[s]=e[s]*a}return t}(e.slice(a,a+1024)),0);if(i){let e=0;for(let t=0;t<o.length;t++){let s=o[t]-i[t];s>0&&(e+=s)}let n=Math.min(e/10,1);if(n>s){let e=(a+512)/t*1e3;r.push({timeMs:e,intensity:n})}}i=o}var n=r;if(0===n.length)return[];let o=[n[0]];for(let e=1;e<n.length;e++){let t=o[o.length-1];n[e].timeMs-t.timeMs<50?n[e].intensity>t.intensity&&(o[o.length-1]=n[e]):o.push(n[e])}return o}(o,n,t.onsetThreshold),0),d=function(e,t){let s=6e4/e,a=[],r=1,i=1;for(let e=0;e<t;e+=s)a.push({timeMs:Math.round(100*e)/100,type:"other",intensity:1===i?.9:3===i?.7:.5,isDownbeat:1===i,measure:r,beatInMeasure:i}),++i>4&&(i=1,r++);return a}(c,l),u=t.classifyBeats?(s=d,a=o,r=n,i=t.frequencyRanges,s.map(e=>{let t=Math.max(0,Math.floor(e.timeMs/1e3*r)-512),s=Math.min(a.length,t+1024),n=a.slice(t,s);if(n.length<512)return e;let o=eK(n,r,i.kick),l=eK(n,r,i.snare),c=eK(n,r,i.hihat),d=Math.max(o,l,c);if(d<.01)return e;let u="other";return o===d?u="kick":l===d?u="snare":c===d&&(u="hihat"),1===e.beatInMeasure||3===e.beatInMeasure?o>.5*l&&(u="kick"):(2===e.beatInMeasure||4===e.beatInMeasure)&&l>.5*o&&(u="snare"),{...e,type:u,intensity:Math.min(10*d,1)}})):d,m=function(e,t){let s=Math.floor(.1*t),a=Math.floor(.05*t),r=[],i=0,n=[];for(let r=0;r<e.length-s;r+=a){let a=0;for(let t=r;t<r+s;t++)a+=e[t]*e[t];let o=Math.sqrt(a/s),l=(r+s/2)/t*1e3;n.push({timeMs:l,rms:o}),o>i&&(i=o)}for(let{timeMs:e,rms:t}of n)r.push({timeMs:Math.round(e),energy:i>0?t/i:0});return r}(o,n),h=t.detectSections?function(e,t,s){var a,r,i,n,o;if(0===e.length)return[];let l=(a=e).map((e,t)=>{let s=Math.max(0,t-20),r=Math.min(a.length,t+20+1),i=0;for(let e=s;e<r;e++)i+=a[e].energy;return{timeMs:e.timeMs,energy:i/(r-s)}}),c=[0,...(function(e){let t=[];for(let s=1;s<e.length;s++)if(Math.abs(e[s].energy-e[s-1].energy)>.15){let a=t[t.length-1];(!a||e[s].timeMs-a>4e3)&&t.push(e[s].timeMs)}return t})(l).map(e=>t.reduce((t,s)=>s.isDownbeat&&Math.abs(s.timeMs-e)<Math.abs(t-e)?s.timeMs:t,e)),s],d=[],u={};for(let e=0;e<c.length-1;e++){let t=c[e],s=c[e+1],a=l.filter(e=>e.timeMs>=t&&e.timeMs<=s).reduce((e,t)=>e+t.energy,0)/Math.max(1,l.filter(e=>e.timeMs>=t&&e.timeMs<=s).length),m=(r=e,i=c.length-1,n=a,o=s-t,0===r&&n<.4&&o<15e3?"intro":r===i-1&&n<.5&&o<15e3?"outro":n>.7?"chorus":n>.3?"verse":n<=.3?o<8e3?"break":"bridge":"verse");u[m]=(u[m]||0)+1;let h=`${m}${u[m]>1?u[m]:""}`;d.push({type:m,startMs:Math.round(t),endMs:Math.round(s),label:h,energy:Math.round(100*a)/100})}return d}(m,u,l):[];return{songId:"",bpm:c,timeSignature:"4/4",durationMs:l,beats:u,sections:h,energyCurve:m,analysis:{method:"web-audio",confidence:.7,analyzedAt:new Date().toISOString()}}}function eK(e,t,[s,a]){let r=Math.floor(s/t*e.length),i=Math.floor(a/t*e.length),n=0,o=Math.max(0,r),l=Math.min(e.length,i);for(let t=o;t<l;t++)n+=e[t]*e[t];return Math.sqrt(n/Math.max(1,l-o))}function eJ({id:e,content:a,isSelected:n,onContentChange:o,onSyncNode:l,width:c=620,height:m=500}){let[h,x]=(0,s.useState)(!1),[p,f]=(0,s.useState)(0),[b,y]=(0,s.useState)(0),[w,v]=(0,s.useState)(.8),[j,N]=(0,s.useState)(!1),[k,C]=(0,s.useState)(!1),[S,M]=(0,s.useState)(null),D=(0,s.useRef)(null),T=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(a.audioUrl)return D.current||(D.current=new Audio(a.audioUrl),D.current.volume=w,D.current.addEventListener("loadedmetadata",()=>{y(D.current?.duration||0)}),D.current.addEventListener("timeupdate",()=>{f(D.current?.currentTime||0)}),D.current.addEventListener("ended",()=>{x(!1)})),(async()=>{try{T.current||(T.current=new AudioContext);let e=await fetch(a.audioUrl),t=await e.arrayBuffer(),s=await T.current.decodeAudioData(t);if(M(s),!a.waveformData?.length){let e=P(s,200);o({...a,waveformData:e})}}catch(e){console.error("Failed to load audio buffer:",e)}})(),()=>{D.current&&(D.current.pause(),D.current=null)}},[a.audioUrl]),(0,s.useEffect)(()=>{D.current&&(D.current.volume=j?0:w)},[w,j]);let P=(e,t)=>{let s=e.getChannelData(0),a=Math.floor(s.length/t),r=[];for(let e=0;e<t;e++){let t=0,i=e*a,n=Math.min(i+a,s.length);for(let e=i;e<n;e++){let a=Math.abs(s[e]);a>t&&(t=a)}r.push(t)}return r},E=(0,s.useCallback)(()=>{D.current&&(h?D.current.pause():D.current.play(),x(!h))},[h]),z=(0,s.useCallback)(e=>{D.current&&(D.current.currentTime=e,f(e))},[]),$=(0,s.useCallback)(()=>{D.current&&(D.current.currentTime=Math.max(0,D.current.currentTime-5))},[]),L=(0,s.useCallback)(()=>{D.current&&b&&(D.current.currentTime=Math.min(b,D.current.currentTime+5))},[b]),R=(0,s.useCallback)(()=>{N(!j)},[j]),I=(0,s.useCallback)(e=>{v(e),e>0&&j&&N(!1)},[j]),B=(0,s.useCallback)(async()=>{if(!S)return void console.error("No audio buffer available for analysis");o({...a,analyzeStatus:"analyzing"});try{let e=await eW(S),t=a.waveformData?.length?a.waveformData:P(S,200);o({...a,bpm:e.bpm,timeSignature:e.timeSignature,analyzeStatus:"complete",beats:e.beats,sections:e.sections,waveformData:t,energyCurve:e.energyCurve})}catch(e){console.error("Beat analysis failed:",e),o({...a,analyzeStatus:"error"})}},[S,a,o]);return(0,t.jsxs)(r.motion.div,{className:(0,d.cn)("relative rounded-2xl overflow-hidden","bg-gradient-to-br from-background/95 via-background/90 to-muted/50","backdrop-blur-xl","border-2 transition-all duration-300",n?"border-primary/60 shadow-2xl shadow-primary/20 ring-2 ring-primary/20":"border-border/40 shadow-xl"),style:{width:c,height:m},initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:eR.springs.smooth,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-5 py-3 border-b border-border/30 bg-gradient-to-r from-purple-500/5 via-transparent to-emerald-500/5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(r.motion.div,{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 via-violet-500 to-emerald-500 flex items-center justify-center shadow-lg shadow-purple-500/30",animate:{boxShadow:h?["0 4px 12px rgba(139, 92, 246, 0.3)","0 4px 24px rgba(139, 92, 246, 0.5)","0 4px 12px rgba(139, 92, 246, 0.3)"]:"0 4px 12px rgba(139, 92, 246, 0.3)"},transition:{duration:1.5,repeat:h?1/0:0,ease:"easeInOut"},children:(0,t.jsx)(g.Music,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"font-semibold text-sm flex items-center gap-2",children:["Beat Sync Engine","complete"===a.analyzeStatus&&(0,t.jsx)(u.Sparkles,{className:"w-3.5 h-3.5 text-emerald-500"})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground truncate max-w-[200px]",children:a.audioName||"Drop audio to analyze"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[a.bpm&&(0,t.jsxs)(r.motion.div,{className:"px-2.5 py-1 rounded-full bg-purple-500/15 border border-purple-500/30 text-xs font-mono font-bold text-purple-400",initial:{scale:0},animate:{scale:1},transition:eR.springs.bouncy,children:[Math.round(a.bpm)," BPM"]}),a.timeSignature&&(0,t.jsx)(r.motion.div,{className:"px-2.5 py-1 rounded-full bg-emerald-500/15 border border-emerald-500/30 text-xs font-mono font-bold text-emerald-400",initial:{scale:0},animate:{scale:1},transition:{...eR.springs.bouncy,delay:.1},children:a.timeSignature}),(0,t.jsx)("button",{onClick:()=>C(!k),className:"p-2 rounded-lg hover:bg-accent/50 transition-colors",children:(0,t.jsx)(eP.Settings,{className:"w-4 h-4"})})]})]}),(0,t.jsx)("div",{className:"px-5 py-4",children:a.waveformData?.length?(0,t.jsx)(e_,{waveformData:a.waveformData,beats:a.beats,sections:a.sections,currentTime:p,duration:b,isPlaying:h,onSeek:z,width:c-40,height:140,showBeats:"complete"===a.analyzeStatus,showSections:"complete"===a.analyzeStatus}):(0,t.jsx)("div",{className:"flex items-center justify-center rounded-xl bg-muted/30 border border-dashed border-border/50",style:{width:c-40,height:140},children:(0,t.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,t.jsx)(eA.AudioWaveform,{className:"w-8 h-8 mx-auto mb-2 opacity-40"}),(0,t.jsx)("p",{className:"text-xs",children:"Load audio to visualize waveform"})]})})}),(0,t.jsx)("div",{className:"px-5 pb-3",children:(0,t.jsx)(eV,{isPlaying:h,onPlayPause:E,onSkipBack:$,onSkipForward:L,volume:w,onVolumeChange:I,isMuted:j,onToggleMute:R,currentTime:p,duration:b,disabled:!a.audioUrl,size:"md"})}),(0,t.jsx)(i.AnimatePresence,{children:a.syncedNodes.length>0&&(0,t.jsxs)(r.motion.div,{className:"px-5 py-3 border-t border-border/20",initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:eR.springs.smooth,children:[(0,t.jsxs)("p",{className:"text-xs font-medium text-muted-foreground mb-2 flex items-center gap-1.5",children:[(0,t.jsx)(eL.Link2,{className:"w-3.5 h-3.5"}),"Synced Nodes (",a.syncedNodes.length,")"]}),(0,t.jsx)("div",{className:"space-y-1.5",children:a.syncedNodes.map((e,s)=>(0,t.jsxs)(r.motion.div,{className:"flex items-center justify-between text-xs px-3 py-2 rounded-lg bg-accent/30 border border-border/30",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.05*s},children:[(0,t.jsx)("span",{className:"font-medium",children:e.nodeName||e.nodeId}),(0,t.jsxs)("span",{className:"text-muted-foreground font-mono",children:["Beat ",e.beatOffset," • ",e.animationType]})]},s))})]})}),(0,t.jsxs)("div",{className:"px-5 py-3 border-t border-border/20 bg-muted/10 flex gap-2",children:[(0,t.jsx)(r.motion.button,{onClick:B,disabled:"analyzing"===a.analyzeStatus||!S,className:(0,d.cn)("flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold","bg-gradient-to-r from-purple-500 to-emerald-500 text-white","hover:from-purple-600 hover:to-emerald-600","shadow-lg shadow-purple-500/20","transition-all duration-200","disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none"),whileHover:{scale:1.02},whileTap:{scale:.98},children:"analyzing"===a.analyzeStatus?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ef.Loader2,{className:"w-4 h-4 animate-spin"}),"Analyzing Beats..."]}):"complete"===a.analyzeStatus?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(A.RefreshCw,{className:"w-4 h-4"}),"Re-analyze"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eA.AudioWaveform,{className:"w-4 h-4"}),"Analyze Beats"]})}),(0,t.jsxs)(r.motion.button,{onClick:()=>l?.(e,{}),disabled:0===a.beats.length,className:(0,d.cn)("flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-sm font-medium","border-2 border-border/50 hover:border-primary/50 hover:bg-primary/5","transition-all duration-200","disabled:opacity-40 disabled:cursor-not-allowed"),whileHover:{scale:1.02},whileTap:{scale:.98},children:[(0,t.jsx)(e$.Zap,{className:"w-4 h-4"}),"Sync"]}),(0,t.jsx)(r.motion.button,{disabled:0===a.beats.length,className:(0,d.cn)("flex items-center justify-center px-3 py-2.5 rounded-xl","border-2 border-border/50 hover:border-border hover:bg-accent/30","transition-all duration-200","disabled:opacity-40 disabled:cursor-not-allowed"),whileHover:{scale:1.02},whileTap:{scale:.98},children:(0,t.jsx)(ey.Download,{className:"w-4 h-4"})})]}),(0,t.jsx)("div",{className:"px-5 py-3 border-t border-border/20 bg-background/50",children:(0,t.jsx)(eG,{beats:a.beats,showCounts:"complete"===a.analyzeStatus})})]})}function eZ(e,t){return{audioUrl:e,audioName:t,analyzeStatus:"idle",beats:[],sections:[],syncedNodes:[]}}let eQ={v:"select",h:"pan",p:"pen",l:"connector",r:"rectangle",o:"ellipse",t:"text",s:"sticky",i:"image",k:"lock",e:"eraser",m:"mindmap",d:"diagram",u:"audio",w:"video",c:"code",g:"ai"};function e0({data:e,onChange:a,selectedTool:n,onToolChange:o,gridEnabled:l=!0,gridSize:c=20,backgroundColor:u}){let m=(0,s.useRef)(null),[h,x]=(0,s.useState)(!1),[p,g]=(0,s.useState)({x:0,y:0}),[f,b]=(0,s.useState)(null),[y,w]=(0,s.useState)(!1),[v,j]=(0,s.useState)({x:0,y:0}),[N,k]=(0,s.useState)(null),C=(0,s.useRef)(null),S=(0,s.useRef)(null),[M,D]=(0,s.useState)(!1),[T,P]=(0,s.useState)(!1),[E,z]=(0,s.useState)(null),[A,$]=(0,s.useState)({}),[L,R]=(0,s.useState)(!1),[I,B]=(0,s.useState)({x:0,y:0}),F=(0,s.useCallback)((t,s)=>{let a=m.current;if(!a)return{x:0,y:0};let r=a.getBoundingClientRect();return{x:(t-r.left-e.viewport.x)/e.viewport.zoom,y:(s-r.top-e.viewport.y)/e.viewport.zoom}},[e.viewport]),U=(0,s.useCallback)((t,s,r="text")=>{let i={text:{type:"text",width:200,height:40,content:"Click to edit"},sticky:{type:"sticky",width:180,height:140,content:"New note",style:{fill:"#fef08a"}},mindmap:{type:"mindmap",width:160,height:60,content:"New idea",style:{fill:"#c4b5fd"}},shape:{type:"shape",width:100,height:100,content:"rectangle",style:{fill:"#3b82f6",stroke:"#1d4ed8"}},image:{type:"ai_generation",width:200,height:200,content:"Tap to generate with AI"},ai:{type:"ai_generation",width:200,height:200,content:"AI Generation"},audio:{type:"audio",width:280,height:80,content:"Audio node"},"audio-beat-sync":{type:"audio-beat-sync",width:620,height:500,content:JSON.stringify(eZ())},video:{type:"video",width:320,height:180,content:"Video node"},multimodal:{type:"multimodal",width:280,height:200,content:"Multi-modal node"},code:{type:"code",width:300,height:200,content:"// Code here"},"flow-start":{type:"flow-start",width:120,height:50,content:"Start"},"flow-end":{type:"flow-end",width:120,height:50,content:"End"},"flow-process":{type:"flow-process",width:160,height:80,content:"Process"},"flow-decision":{type:"flow-decision",width:120,height:120,content:"Decision?"},"arch-service":{type:"arch-service",width:140,height:80,content:"Service"},"arch-database":{type:"arch-database",width:100,height:120,content:"Database"},"device-frame":{type:"device-frame",width:375,height:812,content:"iPhone 14 Pro"}},n=i[r]||i.text,o={id:`node-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,x:t-(n.width||200)/2,y:s-(n.height||40)/2,...n};return console.log("Adding node:",o),a({...e,nodes:[...e.nodes,o]}),b(o.id),o.id},[e,a]),_=(0,s.useCallback)(async(t,s,r)=>{D(!0);try{let i=new FormData;i.append("file",t);let n=await fetch("/api/canvas/upload",{method:"POST",body:i});if(!n.ok){let e=await n.json();console.error("Upload failed:",e);return}let{url:o,mediaType:l}=await n.json(),c="image"===l?{type:"image",width:300,height:200,content:t.name}:"audio"===l?{type:"audio",width:300,height:100,content:t.name}:{type:"video",width:400,height:225,content:t.name},d={id:`node-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,x:s-(c.width||200)/2,y:r-(c.height||200)/2,mediaUrl:o,mediaType:l,...c};a({...e,nodes:[...e.nodes,d]}),b(d.id)}catch(e){console.error("File upload error:",e)}finally{D(!1)}},[e,a]),O=(0,s.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer.types.includes("Files")&&P(!0)},[]),X=(0,s.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),P(!1)},[]),Y=(0,s.useCallback)(async e=>{e.preventDefault(),e.stopPropagation(),P(!1);let t=Array.from(e.dataTransfer.files);if(0===t.length)return;let s=F(e.clientX,e.clientY);for(let e=0;e<t.length;e++){let a=t[e],r=20*e,i=20*e;await _(a,s.x+r,s.y+i)}},[F,_]);(0,s.useEffect)(()=>{let t=async t=>{if(t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement)return;let s=Array.from(t.clipboardData?.items||[]),r=m.current;if(!r)return;let i=r.getBoundingClientRect(),n=i.width/2,o=i.height/2,l=F(i.left+n,i.top+o),c=s.find(e=>e.type.startsWith("image/"));if(c){t.preventDefault();let e=c.getAsFile();e&&await _(e,l.x,l.y);return}let d=s.find(e=>"text/plain"===e.type);d&&d.getAsString(s=>{if(s&&s.trim()){t.preventDefault();let r={id:`node-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"sticky",x:l.x-90,y:l.y-70,width:180,height:Math.min(140+20*Math.floor(s.length/50),300),content:s.trim().substring(0,500),style:{fill:"#fef08a"}};a({...e,nodes:[...e.nodes,r]}),b(r.id)}})};return window.addEventListener("paste",t),()=>window.removeEventListener("paste",t)},[e,a,F,_]);let H=e=>{if(e.length<2)return 0;let t=e[0].clientX-e[1].clientX,s=e[0].clientY-e[1].clientY;return Math.sqrt(t*t+s*s)},V=e=>e.length<2?{x:e[0].clientX,y:e[0].clientY}:{x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2},q=(0,s.useCallback)(t=>{if(2===t.touches.length){t.preventDefault();let s=H(t.touches),a=V(t.touches);k({initialDistance:s,initialZoom:e.viewport.zoom,initialCenter:a}),S.current=null}else if(1===t.touches.length){let s=t.touches[0],a=Date.now();if(S.current){let e=a-S.current.time,r=Math.sqrt(Math.pow(s.clientX-S.current.x,2)+Math.pow(s.clientY-S.current.y,2));if(e<300&&r<50){if(t.preventDefault(),!t.target.closest("[data-node-id]")){let e=F(s.clientX,s.clientY);U(e.x,e.y,"sticky")}S.current=null;return}}S.current={time:a,x:s.clientX,y:s.clientY},C.current={x:s.clientX,y:s.clientY},g({x:s.clientX-e.viewport.x,y:s.clientY-e.viewport.y}),x(!0)}},[e.viewport,F,U]),G=(0,s.useCallback)(t=>{if(2===t.touches.length&&N){t.preventDefault();let s=H(t.touches)/N.initialDistance,r=Math.min(Math.max(N.initialZoom*s,.25),4),i=m.current;if(!i)return;let n=i.getBoundingClientRect(),o=V(t.touches),l=o.x-n.left,c=o.y-n.top,d=r/e.viewport.zoom,u=l-(l-e.viewport.x)*d,h=c-(c-e.viewport.y)*d,x=Math.max(n.width,n.height)*(2/r);u=Math.max(-x,Math.min(x,u)),h=Math.max(-x,Math.min(x,h)),a({...e,viewport:{x:u,y:h,zoom:r}})}else if(1===t.touches.length&&h){let s=t.touches[0];a({...e,viewport:{...e.viewport,x:s.clientX-p.x,y:s.clientY-p.y}}),C.current={x:s.clientX,y:s.clientY}}},[N,h,p,e,a]),W=(0,s.useCallback)(t=>{if(0===t.touches.length)k(null),x(!1),C.current=null;else if(1===t.touches.length){k(null);let s=t.touches[0];C.current={x:s.clientX,y:s.clientY},g({x:s.clientX-e.viewport.x,y:s.clientY-e.viewport.y})}},[e.viewport]),K=(0,s.useCallback)(t=>{t.preventDefault();let s=m.current;if(!s)return;let r=s.getBoundingClientRect(),i=r.width/2,n=r.height/2,o=t.deltaY>0?.97:1.03,l=Math.min(Math.max(e.viewport.zoom*o,.25),4);if(l===e.viewport.zoom)return;let c=l/e.viewport.zoom,d=i-(i-e.viewport.x)*c,u=n-(n-e.viewport.y)*c,h=Math.max(r.width,r.height)*(2/l);d=Math.max(-h,Math.min(h,d)),u=Math.max(-h,Math.min(h,u)),a({...e,viewport:{x:d,y:u,zoom:l}})},[e,a]),J=(0,s.useCallback)(t=>{t.target.closest("[data-node-id]")||(1===t.button||0===t.button&&("pan"===n||t.shiftKey)?(x(!0),g({x:t.clientX-e.viewport.x,y:t.clientY-e.viewport.y}),t.preventDefault()):0===t.button&&"select"===n&&b(null))},[n,e.viewport]),Z=(0,s.useCallback)(t=>{if(h)a({...e,viewport:{...e.viewport,x:t.clientX-p.x,y:t.clientY-p.y}});else if(y&&f){let s=F(t.clientX,t.clientY);a({...e,nodes:e.nodes.map(e=>e.id===f?{...e,x:s.x-v.x,y:s.y-v.y}:e)})}},[h,y,f,e,p,a,F,v]),Q=(0,s.useCallback)(()=>{x(!1),w(!1)},[]),ee=(0,s.useCallback)(t=>{t.preventDefault(),t.stopPropagation();let s=t.target.closest("[data-node-id]");if(s){let a=s.getAttribute("data-node-id"),r=e.nodes.find(e=>e.id===a);r&&a&&(b(a),z({x:t.clientX,y:t.clientY,type:"node",nodeId:a,nodeType:r.type}))}else b(null),z({x:t.clientX,y:t.clientY,type:"canvas"})},[e.nodes]),et=(0,s.useCallback)(()=>{z(null)},[]),es=(0,s.useCallback)(async()=>{if(!f)return;let t=e.nodes.find(e=>e.id===f);if(t)try{await navigator.clipboard.writeText(JSON.stringify(t)),console.log("[Canvas] Copied node to clipboard:",t.id)}catch(e){console.error("[Canvas] Failed to copy:",e)}},[f,e.nodes]),ea=(0,s.useCallback)(async()=>{if(!f)return;let t=e.nodes.find(e=>e.id===f);if(t)try{await navigator.clipboard.writeText(JSON.stringify(t)),console.log("[Canvas] Cut node to clipboard:",t.id),a({...e,nodes:e.nodes.filter(e=>e.id!==f),edges:e.edges.filter(e=>e.source!==f&&e.target!==f)}),b(null)}catch(e){console.error("[Canvas] Failed to cut:",e)}},[f,e,a]),er=(0,s.useCallback)(()=>{f&&(a({...e,nodes:e.nodes.filter(e=>e.id!==f),edges:e.edges.filter(e=>e.source!==f&&e.target!==f)}),b(null))},[f,e,a]),ei=(0,s.useCallback)(()=>{if(!f)return;let t=e.nodes.find(e=>e.id===f);if(t){let s={...t,id:`node-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,x:t.x+20,y:t.y+20};a({...e,nodes:[...e.nodes,s]}),b(s.id)}},[f,e,a]),en=(0,s.useCallback)(()=>{if(!f)return;let t=e.nodes.findIndex(e=>e.id===f);if(-1===t)return;let s=e.nodes[t],r=[...e.nodes.filter(e=>e.id!==f),s];a({...e,nodes:r})},[f,e,a]),eo=(0,s.useCallback)(()=>{if(!f)return;let t=e.nodes.findIndex(e=>e.id===f);if(-1===t)return;let s=[e.nodes[t],...e.nodes.filter(e=>e.id!==f)];a({...e,nodes:s})},[f,e,a]),el=(0,s.useCallback)(()=>{f&&a({...e,nodes:e.nodes.map(e=>e.id===f?{...e,locked:!e.locked}:e)})},[f,e,a]),ec=(0,s.useCallback)((t,s)=>{if("select"===n||"pan"===n){t.stopPropagation(),b(s);let a=e.nodes.find(e=>e.id===s);if(a&&"select"===n){let e=F(t.clientX,t.clientY);j({x:e.x-a.x,y:e.y-a.y}),w(!0)}}},[n,e.nodes,F]),ed=(0,s.useCallback)((t,s)=>{if(1===t.touches.length&&"select"===n){t.stopPropagation(),b(s);let a=t.touches[0],r=e.nodes.find(e=>e.id===s);if(r){let e=F(a.clientX,a.clientY);j({x:e.x-r.x,y:e.y-r.y}),w(!0)}}},[n,e.nodes,F]),eu=(0,s.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),e.target.closest("[data-node-id]"))return;let t=F(e.clientX,e.clientY);"eraser"!==n&&U(t.x,t.y,{select:"sticky",pan:"sticky",text:"text",sticky:"sticky",mindmap:"mindmap",shape:"shape",rectangle:"shape",ellipse:"shape",image:"image",ai:"ai",audio:"audio",video:"video",code:"code",multimodal:"multimodal",pen:"sticky",connector:"sticky",eraser:"sticky"}[n]||"sticky")},[n,F,U]),em=(0,s.useCallback)(e=>{if(!e.target.closest("[data-node-id]")&&["sticky","mindmap","shape","rectangle","ellipse","image","ai","audio","video","code","multimodal","text"].includes(n)){let t=F(e.clientX,e.clientY),s="rectangle"===n||"ellipse"===n?"shape":n;U(t.x,t.y,s)}},[n,F,U]);(0,s.useEffect)(()=>{let t=t=>{if(t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement)return;let s=t.key.toLowerCase();if(!t.ctrlKey&&!t.metaKey&&eQ[s]){t.preventDefault(),o?.(eQ[s]);return}if(("Delete"===t.key||"Backspace"===t.key)&&f){t.preventDefault(),a({...e,nodes:e.nodes.filter(e=>e.id!==f),edges:e.edges.filter(e=>e.source!==f&&e.target!==f)}),b(null);return}if("Escape"===t.key)return void b(null);if(t.ctrlKey||t.metaKey)switch(s){case"a":t.preventDefault(),e.nodes.length>0&&b(e.nodes[0].id);break;case"d":if(t.preventDefault(),f){let t=e.nodes.find(e=>e.id===f);if(t){let s={...t,id:`node-${Date.now()}`,x:t.x+20,y:t.y+20};a({...e,nodes:[...e.nodes,s]}),b(s.id)}}break;case"0":t.preventDefault(),a({...e,viewport:{x:0,y:0,zoom:1}});break;case"=":case"+":t.preventDefault(),a({...e,viewport:{...e.viewport,zoom:Math.min(1.1*e.viewport.zoom,4)}});break;case"-":t.preventDefault(),a({...e,viewport:{...e.viewport,zoom:Math.max(e.viewport.zoom/1.1,.25)}})}"Space"!==t.code||h||(t.preventDefault(),o?.("pan"))},s=e=>{"Space"===e.code&&o?.("select")};return window.addEventListener("keydown",t),window.addEventListener("keyup",s),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",s)}},[f,e,a,o,h]),(0,s.useEffect)(()=>{let e=m.current;if(!e)return;let t=e=>K(e),s=e=>q(e),a=e=>G(e),r=e=>W(e);return e.addEventListener("wheel",t,{passive:!1}),e.addEventListener("touchstart",s,{passive:!1}),e.addEventListener("touchmove",a,{passive:!1}),e.addEventListener("touchend",r,{passive:!1}),()=>{e.removeEventListener("wheel",t),e.removeEventListener("touchstart",s),e.removeEventListener("touchmove",a),e.removeEventListener("touchend",r)}},[K,q,G,W]);let eh=l?(0,t.jsx)("defs",{children:(0,t.jsx)("pattern",{id:"grid",width:c,height:c,patternUnits:"userSpaceOnUse",children:(0,t.jsx)("circle",{cx:c/2,cy:c/2,r:1,fill:"rgba(150, 150, 150, 0.5)"})})}):null;return(0,t.jsxs)("div",{ref:m,className:(0,d.cn)("w-full h-full overflow-hidden relative touch-none select-none",h?"cursor-grabbing":"pan"===n?"cursor-grab":"cursor-crosshair",T&&"ring-2 ring-primary ring-inset"),onMouseDown:J,onMouseMove:Z,onMouseUp:Q,onMouseLeave:Q,onDoubleClick:eu,onClick:em,onContextMenu:ee,onDragOver:O,onDragLeave:X,onDrop:Y,style:{backgroundColor:u||"hsl(var(--background))"},tabIndex:0,children:[(0,t.jsxs)("div",{className:"absolute will-change-transform",style:{transform:`translate(${e.viewport.x}px, ${e.viewport.y}px) scale(${e.viewport.zoom})`,transformOrigin:"0 0",transition:h||y?"none":"transform 0.1s ease-out",width:"10000px",height:"10000px",marginLeft:"-5000px",marginTop:"-5000px",pointerEvents:"none"},children:[l&&(0,t.jsxs)("svg",{className:"absolute inset-0 pointer-events-none",width:"100%",height:"100%",children:[eh,(0,t.jsx)("rect",{width:"100%",height:"100%",fill:"url(#grid)"})]}),(0,t.jsxs)("svg",{className:"absolute inset-0 pointer-events-none",style:{overflow:"visible"},children:[e.edges.map(s=>{let a=e.nodes.find(e=>e.id===s.source),r=e.nodes.find(e=>e.id===s.target);if(!a||!r)return null;let i=a.x+a.width/2+5e3,n=a.y+a.height/2+5e3,o=r.x+r.width/2+5e3,l=r.y+r.height/2+5e3;return(0,t.jsx)("line",{x1:i,y1:n,x2:o,y2:l,stroke:"#6b7280",strokeWidth:2,markerEnd:"url(#arrowhead)"},s.id)}),(0,t.jsx)("defs",{children:(0,t.jsx)("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"10",refY:"3.5",orient:"auto",children:(0,t.jsx)("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#6b7280"})})})]}),(0,t.jsx)("div",{className:"absolute inset-0",style:{pointerEvents:"auto"},children:e.nodes.map(s=>(0,t.jsx)(e2,{node:s,isSelected:s.id===f,onMouseDown:e=>ec(e,s.id),onTouchStart:e=>ed(e,s.id),onContentChange:t=>{a({...e,nodes:e.nodes.map(e=>e.id===s.id?{...e,content:t}:e)})},onMediaChange:(t,r)=>{a({...e,nodes:e.nodes.map(e=>e.id===s.id?{...e,mediaUrl:t,mediaType:r}:e)})}},s.id))})]}),(0,t.jsxs)("div",{className:"absolute bottom-4 left-4 right-4 sm:right-auto px-3 py-2 bg-background/80 backdrop-blur-sm rounded-lg text-xs text-muted-foreground border flex items-center justify-between sm:justify-start gap-4",children:[(0,t.jsxs)("span",{children:[e.nodes.length," nodes"]}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"|"}),(0,t.jsxs)("span",{children:[Math.round(100*e.viewport.zoom),"%"]}),(0,t.jsx)("span",{className:"sm:hidden text-muted-foreground/50",children:"Pinch to zoom"})]}),(0,t.jsx)("div",{className:"absolute bottom-4 right-4 hidden md:block px-3 py-2 bg-background/80 backdrop-blur-sm rounded-lg text-xs text-muted-foreground border",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)("span",{children:[(0,t.jsx)("kbd",{className:"px-1 bg-muted rounded",children:"V"})," Select"]}),(0,t.jsxs)("span",{children:[(0,t.jsx)("kbd",{className:"px-1 bg-muted rounded",children:"T"})," Text"]}),(0,t.jsxs)("span",{children:[(0,t.jsx)("kbd",{className:"px-1 bg-muted rounded",children:"N"})," Sticky"]}),(0,t.jsxs)("span",{children:[(0,t.jsx)("kbd",{className:"px-1 bg-muted rounded",children:"R"})," Shape"]}),(0,t.jsxs)("span",{children:[(0,t.jsx)("kbd",{className:"px-1 bg-muted rounded",children:"G"})," AI"]}),(0,t.jsxs)("span",{children:[(0,t.jsx)("kbd",{className:"px-1 bg-muted rounded",children:"Space"})," Pan"]})]})}),0===e.nodes.length&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none p-4",children:(0,t.jsxs)("div",{className:"text-center text-muted-foreground max-w-xs",children:[(0,t.jsx)("div",{className:"text-4xl mb-4 opacity-20",children:"+"}),(0,t.jsx)("p",{className:"text-base font-medium mb-2",children:"Start Creating"}),(0,t.jsx)("p",{className:"text-sm mb-1",children:"Double-click or tap to add elements"}),(0,t.jsx)("p",{className:"text-sm mb-1",children:"Scroll to zoom, drag to pan"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground/70",children:["Press ",(0,t.jsx)("kbd",{className:"px-1 bg-muted rounded",children:"G"})," for AI generation"]})]})}),(0,t.jsx)(e1,{node:f?e.nodes.find(e=>e.id===f):void 0,viewport:e.viewport,containerRef:m,onDelete:()=>{f&&(a({...e,nodes:e.nodes.filter(e=>e.id!==f),edges:e.edges.filter(e=>e.source!==f&&e.target!==f)}),b(null))},onColorChange:t=>{f&&a({...e,nodes:e.nodes.map(e=>e.id===f?{...e,style:{...e.style,fill:t}}:e)})},onDuplicate:()=>{if(f){let t=e.nodes.find(e=>e.id===f);if(t){let s={...t,id:`node-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,x:t.x+30,y:t.y+30};a({...e,nodes:[...e.nodes,s]}),b(s.id)}}},onAddBranch:t=>{if(f){let s=e.nodes.find(e=>e.id===f);if(s){let r={right:{x:200,y:0},left:{x:-200,y:0},up:{x:0,y:-120},down:{x:0,y:120}},i=r[t]||r.right,n={id:`node-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:s.type,x:s.x+i.x,y:s.y+i.y,width:s.width,height:s.height,content:"New branch",style:s.style},o={id:`edge-${Date.now()}`,source:f,target:n.id,type:"default"};a({...e,nodes:[...e.nodes,n],edges:[...e.edges,o]}),b(n.id)}}},onEditContent:e=>{let t=document.querySelector(`[data-node-id="${e}"]`);if(t){let e=new window.MouseEvent("dblclick",{bubbles:!0});t.dispatchEvent(e)}},onReplaceMedia:e=>{console.log("[Canvas] Replace media for node:",e)},onCopy:es,onCut:ea,onLock:el,onBringToFront:en,onSendToBack:eo,isLocked:!!f&&e.nodes.find(e=>e.id===f)?.locked}),(0,t.jsx)(i.AnimatePresence,{children:T&&(0,t.jsx)(r.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-primary/10 pointer-events-none flex items-center justify-center z-40",children:(0,t.jsxs)("div",{className:"bg-background/95 backdrop-blur-sm px-6 py-4 rounded-xl border-2 border-dashed border-primary",children:[(0,t.jsx)("p",{className:"text-lg font-medium text-primary",children:"Drop files to add to canvas"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Images, audio, or video"})]})})}),(0,t.jsx)(i.AnimatePresence,{children:M&&(0,t.jsx)(r.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute top-4 left-1/2 -translate-x-1/2 z-50",children:(0,t.jsxs)("div",{className:"bg-background/95 backdrop-blur-sm px-4 py-2 rounded-lg border shadow-lg flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"}),(0,t.jsx)("span",{className:"text-sm",children:"Uploading..."})]})})}),(0,t.jsx)(eE,{position:E,onClose:et,onAddNode:(e,t,s)=>{let a=F(t,s);U(a.x,a.y,e)},onCopy:es,onCut:ea,onPaste:()=>{navigator.clipboard.readText().then(t=>{try{let s=JSON.parse(t);if(s&&s.type){let t={...s,id:`node-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,x:s.x+20,y:s.y+20};a({...e,nodes:[...e.nodes,t]}),b(t.id)}}catch{}})},onDelete:er,onDuplicate:ei,onEdit:()=>{if(f){let e=document.querySelector(`[data-node-id="${f}"]`);if(e){let t=new window.MouseEvent("dblclick",{bubbles:!0});e.dispatchEvent(t)}}},onBringToFront:en,onSendToBack:eo,onZoomToFit:()=>{a({...e,viewport:{x:0,y:0,zoom:1}})},onCenterView:()=>{a({...e,viewport:{...e.viewport,x:0,y:0}})},onSelectAll:()=>{e.nodes.length>0&&b(e.nodes[0].id)},canRegenerate:!!f&&e.nodes.find(e=>e.id===f)?.type==="ai_generation"})]})}function e1({node:e,viewport:a,containerRef:n,onDelete:o,onColorChange:l,onDuplicate:c,onAddBranch:d,onReplaceMedia:u,onEditContent:m,onCopy:h,onCut:I,onLock:B,onBringToFront:F,onSendToBack:U,onRegenerate:_,isLocked:O=!1}){let[X,Y]=(0,s.useState)(!1),[H,V]=(0,s.useState)(!1),[q,G]=(0,s.useState)(!1),[W,K]=(0,s.useState)(!1),J=(0,s.useRef)(null),Z=()=>{Y(!1),V(!1),G(!1),K(!1)};if(!e)return null;let Q=["image","video","audio","ai","ai_generation"].includes(e.type),ee=["text","sticky","code"].includes(e.type),et="ai_generation"===e.type||"ai"===e.type,es=n.current;if(!es)return null;let ea=es.getBoundingClientRect(),er=e.x+5e3+e.width/2,ei=e.y+5e3,en=er*a.zoom+a.x,eo=ei*a.zoom+a.y,el=Math.max(100,Math.min(en,ea.width-100)),ec=Math.max(50,eo-60);Object.entries(R.NODE_COLORS).slice(0,6);let ed="mindmap"===e.type||"sticky"===e.type;return(0,t.jsx)(i.AnimatePresence,{children:(0,t.jsx)(r.motion.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},transition:{duration:.15},className:"absolute z-50 pointer-events-auto",style:{left:el,top:ec,transform:"translateX(-50%)"},children:(0,t.jsxs)("div",{className:"flex items-center gap-1 px-2 py-1.5 bg-background/95 backdrop-blur-md rounded-xl shadow-lg border border-border/50",children:[ee&&(0,t.jsx)("button",{onClick:()=>m?.(e.id),className:"p-2 rounded-lg hover:bg-muted transition-colors",title:"Edit content",children:(0,t.jsx)(v.Edit3,{className:"w-4 h-4"})}),Q&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>J.current?.click(),className:"p-2 rounded-lg hover:bg-muted transition-colors",title:`Replace ${e.type}`,children:"video"===e.type?(0,t.jsx)(p.Video,{className:"w-4 h-4"}):"audio"===e.type?(0,t.jsx)(g.Music,{className:"w-4 h-4"}):(0,t.jsx)(x.Image,{className:"w-4 h-4"})}),(0,t.jsx)("input",{ref:J,type:"file",className:"hidden",accept:"video"===e.type?"video/*":"audio"===e.type?"audio/*":"image/*",onChange:t=>{t.target.files?.[0]&&u?.(e.id)}})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("button",{onClick:()=>{Z(),Y(!X)},className:"p-2 rounded-lg hover:bg-muted transition-colors",title:"Colors",children:(0,t.jsx)(y.Palette,{className:"w-4 h-4"})}),X&&(0,t.jsxs)(r.motion.div,{initial:{opacity:0,y:-5,scale:.95},animate:{opacity:1,y:0,scale:1},className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 p-3 bg-background/95 backdrop-blur-md rounded-xl shadow-lg border z-10",children:[(0,t.jsx)("p",{className:"text-[10px] text-muted-foreground mb-2 font-medium",children:"Colors"}),(0,t.jsx)("div",{className:"grid grid-cols-4 gap-2",children:Object.entries(R.NODE_COLORS).map(([e,s])=>(0,t.jsx)("button",{onClick:()=>{l(s),Y(!1)},className:"w-7 h-7 rounded-lg border-2 border-white/10 hover:scale-110 hover:border-white/30 transition-all",style:{backgroundColor:s},title:e},e))})]})]}),(0,t.jsx)("button",{onClick:()=>{h?.()},className:"p-2 rounded-lg hover:bg-muted transition-colors",title:"Copy (⌘C)",children:(0,t.jsx)(j.Copy,{className:"w-4 h-4"})}),(0,t.jsx)("button",{onClick:c,className:"p-2 rounded-lg hover:bg-muted transition-colors",title:"Duplicate (⌘D)",children:(0,t.jsx)(w.Plus,{className:"w-4 h-4"})}),et&&(0,t.jsx)("button",{onClick:()=>_?.(),className:"p-2 rounded-lg hover:bg-muted transition-colors",title:"Regenerate",children:(0,t.jsx)(A.RefreshCw,{className:"w-4 h-4"})}),ed&&(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("button",{onClick:()=>{Z(),V(!H)},className:"p-2 rounded-lg hover:bg-muted transition-colors",title:"Add branch",children:(0,t.jsx)(f.GitBranch,{className:"w-4 h-4"})}),H&&(0,t.jsxs)(r.motion.div,{initial:{opacity:0,y:-5,scale:.95},animate:{opacity:1,y:0,scale:1},className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 p-2 bg-background/95 backdrop-blur-md rounded-xl shadow-lg border z-10",children:[(0,t.jsx)("p",{className:"text-[10px] text-muted-foreground mb-2 font-medium text-center",children:"Add Branch"}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-1 w-20",children:[(0,t.jsx)("div",{}),(0,t.jsx)("button",{onClick:()=>{d("up"),V(!1)},className:"p-1.5 rounded-lg hover:bg-muted transition-colors flex items-center justify-center",children:(0,t.jsx)(C.ChevronUp,{className:"w-4 h-4"})}),(0,t.jsx)("div",{}),(0,t.jsx)("button",{onClick:()=>{d("left"),V(!1)},className:"p-1.5 rounded-lg hover:bg-muted transition-colors flex items-center justify-center",children:(0,t.jsx)(k.ChevronLeft,{className:"w-4 h-4"})}),(0,t.jsx)("div",{className:"w-6 h-6 rounded-lg bg-muted/50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-primary/50"})}),(0,t.jsx)("button",{onClick:()=>{d("right"),V(!1)},className:"p-1.5 rounded-lg hover:bg-muted transition-colors flex items-center justify-center",children:(0,t.jsx)(N.ChevronRight,{className:"w-4 h-4"})}),(0,t.jsx)("div",{}),(0,t.jsx)("button",{onClick:()=>{d("down"),V(!1)},className:"p-1.5 rounded-lg hover:bg-muted transition-colors flex items-center justify-center",children:(0,t.jsx)(S.ChevronDown,{className:"w-4 h-4"})}),(0,t.jsx)("div",{})]})]})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("button",{onClick:()=>{Z(),G(!q)},className:"p-2 rounded-lg hover:bg-muted transition-colors",title:"Arrange",children:(0,t.jsx)(L.Maximize2,{className:"w-4 h-4"})}),q&&(0,t.jsxs)(r.motion.div,{initial:{opacity:0,y:-5,scale:.95},animate:{opacity:1,y:0,scale:1},className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 p-2 bg-background/95 backdrop-blur-md rounded-xl shadow-lg border z-10 min-w-[140px]",children:[(0,t.jsx)("p",{className:"text-[10px] text-muted-foreground mb-2 font-medium",children:"Arrange"}),(0,t.jsxs)("div",{className:"space-y-0.5",children:[(0,t.jsxs)("button",{onClick:()=>{F?.(),G(!1)},className:"w-full flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-muted transition-colors text-xs",children:[(0,t.jsx)(P.default,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{children:"Bring to Front"})]}),(0,t.jsxs)("button",{onClick:()=>{U?.(),G(!1)},className:"w-full flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-muted transition-colors text-xs",children:[(0,t.jsx)(E.default,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{children:"Send to Back"})]}),(0,t.jsx)("div",{className:"h-px bg-border my-1"}),(0,t.jsxs)("button",{onClick:()=>{B?.(),G(!1)},className:"w-full flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-muted transition-colors text-xs",children:[O?(0,t.jsx)(T.Unlock,{className:"w-3.5 h-3.5"}):(0,t.jsx)(D.Lock,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{children:O?"Unlock":"Lock Position"})]})]})]})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("button",{onClick:()=>{Z(),K(!W)},className:"p-2 rounded-lg hover:bg-muted transition-colors",title:"More actions",children:(0,t.jsx)(z.MoreHorizontal,{className:"w-4 h-4"})}),W&&(0,t.jsxs)(r.motion.div,{initial:{opacity:0,y:-5,scale:.95},animate:{opacity:1,y:0,scale:1},className:"absolute top-full right-0 mt-2 p-2 bg-background/95 backdrop-blur-md rounded-xl shadow-lg border z-10 min-w-[140px]",children:[(0,t.jsx)("p",{className:"text-[10px] text-muted-foreground mb-2 font-medium",children:"More"}),(0,t.jsxs)("div",{className:"space-y-0.5",children:[(0,t.jsxs)("button",{onClick:()=>{I?.(),K(!1)},className:"w-full flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-muted transition-colors text-xs",children:[(0,t.jsx)(M.Scissors,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{children:"Cut"}),(0,t.jsx)("span",{className:"ml-auto text-muted-foreground text-[10px]",children:"⌘X"})]}),(0,t.jsxs)("button",{onClick:()=>{h?.(),K(!1)},className:"w-full flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-muted transition-colors text-xs",children:[(0,t.jsx)(j.Copy,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{children:"Copy"}),(0,t.jsx)("span",{className:"ml-auto text-muted-foreground text-[10px]",children:"⌘C"})]}),(0,t.jsx)("div",{className:"h-px bg-border my-1"}),(0,t.jsxs)("button",{onClick:()=>{m?.(e.id),K(!1)},className:"w-full flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-muted transition-colors text-xs",children:[(0,t.jsx)(v.Edit3,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{children:"Edit"})]}),(0,t.jsxs)("button",{onClick:()=>{K(!1)},className:"w-full flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-muted transition-colors text-xs",children:[(0,t.jsx)($.Link,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{children:"Connect"})]})]})]})]}),(0,t.jsx)("div",{className:"w-px h-5 bg-border mx-0.5"}),(0,t.jsx)("button",{onClick:o,className:"p-2 rounded-lg hover:bg-destructive/10 text-muted-foreground hover:text-destructive transition-colors",title:"Delete (⌫)",children:(0,t.jsx)(b.Trash2,{className:"w-4 h-4"})})]})})})}function e2({node:e,isSelected:a,onMouseDown:i,onTouchStart:n,onContentChange:o}){let[l,c]=(0,s.useState)(!1),[b,y]=(0,s.useState)(e.content),[w,v]=(0,s.useState)(!1),j=(0,s.useRef)(null),N=(0,s.useRef)(null),k=t=>{t.stopPropagation(),("text"===e.type||"sticky"===e.type||"code"===e.type||"multimodal"===e.type)&&(c(!0),y(e.content))},C={position:"absolute",left:e.x+5e3,top:e.y+5e3,width:e.width,height:e.height,touchAction:"none"};if("text"===e.type)return(0,t.jsx)(r.motion.div,{"data-node-id":e.id,style:C,className:(0,d.cn)("flex items-center justify-center rounded-lg px-3 py-2","bg-background border shadow-sm cursor-move",a&&"ring-2 ring-primary ring-offset-2"),onMouseDown:i,onTouchStart:n,onDoubleClick:k,whileHover:{scale:1.02},whileTap:{scale:.98},children:l?(0,t.jsx)(ev.ContextReferenceInput,{className:"w-full bg-transparent text-center outline-none text-sm",value:b,onChange:y,onKeyDown:t=>{"Enter"===t.key&&(c(!1),b!==e.content&&o(b)),t.stopPropagation()},autoFocus:!0,placeholder:"Type @ to reference..."}):(0,t.jsx)("span",{className:"text-sm",children:e.content})});if("sticky"===e.type){let s=e.style?.fill||"#fef08a";return(0,t.jsx)(r.motion.div,{"data-node-id":e.id,style:{...C,backgroundColor:s},className:(0,d.cn)("rounded-lg p-3 shadow-lg cursor-move",a&&"ring-2 ring-primary ring-offset-2"),onMouseDown:i,onTouchStart:n,onDoubleClick:k,whileHover:{scale:1.02,rotate:1},whileTap:{scale:.98},children:l?(0,t.jsx)(ev.ContextReferenceInput,{className:"w-full h-full bg-transparent resize-none outline-none text-sm text-gray-800",value:b,onChange:y,onKeyDown:e=>e.stopPropagation(),multiline:!0,rows:4,autoFocus:!0,placeholder:"Type @ to reference..."}):(0,t.jsx)("p",{className:"text-sm whitespace-pre-wrap text-gray-800",children:e.content})})}if("shape"===e.type){let s=e.style?.fill||"#3b82f6",o=e.style?.stroke||"#1d4ed8";return(0,t.jsx)(r.motion.div,{"data-node-id":e.id,style:{...C,backgroundColor:s,borderColor:o},className:(0,d.cn)("rounded-lg border-2 cursor-move",a&&"ring-2 ring-primary ring-offset-2"),onMouseDown:i,onTouchStart:n,whileHover:{scale:1.02},whileTap:{scale:.98}})}if("ai_generation"===e.type)return(0,t.jsxs)(r.motion.div,{"data-node-id":e.id,style:C,className:(0,d.cn)("flex flex-col items-center justify-center rounded-xl cursor-move","bg-gradient-to-br from-purple-500/10 to-blue-500/10 border-2 border-dashed border-purple-500/30",a&&"ring-2 ring-purple-500 ring-offset-2"),onMouseDown:i,onTouchStart:n,whileHover:{scale:1.02},whileTap:{scale:.98},children:[(0,t.jsx)(u.Sparkles,{className:"h-8 w-8 text-purple-500/50 mb-2"}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground text-center px-2",children:e.content})]});if("image"===e.type)return(0,t.jsx)(r.motion.div,{"data-node-id":e.id,style:C,className:(0,d.cn)("rounded-lg overflow-hidden cursor-move",a&&"ring-2 ring-primary ring-offset-2"),onMouseDown:i,onTouchStart:n,whileHover:{scale:1.02},whileTap:{scale:.98},children:e.mediaUrl?(0,t.jsx)("img",{src:e.mediaUrl,alt:"Canvas image",className:"w-full h-full object-cover",draggable:!1}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-muted",children:(0,t.jsx)(x.Image,{className:"h-8 w-8 text-muted-foreground"})})});if("audio"===e.type){let s={};try{"string"==typeof e.content&&e.content.startsWith("{")&&(s=JSON.parse(e.content))}catch{}let r=e.mediaUrl||s.audioUrl,l=s.audioName||s.title||(s.artist?`${s.title} - ${s.artist}`:e.content);return(0,t.jsx)("div",{"data-node-id":e.id,style:{...C,width:Math.max(e.width,500),height:Math.max(e.height,380)},onMouseDown:i,onTouchStart:n,children:(0,t.jsx)(eJ,{id:e.id,content:{audioUrl:r,audioName:"string"==typeof l?l:"Audio",analyzeStatus:"idle",beats:[],sections:[],syncedNodes:[]},isSelected:a,onContentChange:e=>{o(JSON.stringify(e))},width:Math.max(e.width,500),height:Math.max(e.height,380)})})}if("audio-beat-sync"===e.type){let s;try{let t="string"==typeof e.content?JSON.parse(e.content):e.content;if(t&&"object"==typeof t)if(!t.title||"analyzeStatus"in t)s={audioUrl:t.audioUrl,audioName:t.audioName,analyzeStatus:t.analyzeStatus||"idle",beats:t.beats||[],sections:t.sections||[],syncedNodes:t.syncedNodes||[],bpm:t.bpm,key:t.key,timeSignature:t.timeSignature,waveformData:t.waveformData};else{let e=(t.sections||[]).map((e,t,s)=>({type:e.label.toLowerCase().includes("intro")?"intro":e.label.toLowerCase().includes("verse")?"verse":e.label.toLowerCase().includes("chorus")?"chorus":e.label.toLowerCase().includes("bridge")?"bridge":e.label.toLowerCase().includes("outro")?"outro":"break",startMs:1e3*(e.startTime||0),endMs:s[t+1]?1e3*(s[t+1].startTime||0):((e.startTime||0)+30)*1e3,label:e.label,energy:.7}));s={audioUrl:t.audioUrl,audioName:`${t.title}${t.artist?` - ${t.artist}`:""}`,analyzeStatus:"complete",beats:[],sections:e,syncedNodes:[]}}else s=eZ()}catch{s=eZ()}return(0,t.jsx)(r.motion.div,{"data-node-id":e.id,style:C,className:"cursor-move",onMouseDown:i,onTouchStart:n,children:(0,t.jsx)(eJ,{id:e.id,content:s,isSelected:a,width:e.width,height:e.height,onContentChange:e=>{o(JSON.stringify(e))}})})}if("video"===e.type)return(0,t.jsxs)(r.motion.div,{"data-node-id":e.id,style:C,className:(0,d.cn)("rounded-xl overflow-hidden cursor-move","bg-black",a&&"ring-2 ring-red-500 ring-offset-2"),onMouseDown:i,onTouchStart:n,whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.mediaUrl?(0,t.jsx)("video",{ref:N,src:e.mediaUrl,className:"w-full h-full object-cover",onEnded:()=>v(!1)}):(0,t.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center bg-zinc-900 text-white/50",children:[(0,t.jsx)(p.Video,{className:"h-8 w-8 mb-2"}),(0,t.jsx)("span",{className:"text-xs",children:e.content})]}),(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),"audio"===e.type&&j.current&&(w?j.current.pause():j.current.play(),v(!w)),"video"===e.type&&N.current&&(w?N.current.pause():N.current.play(),v(!w))},className:"absolute inset-0 flex items-center justify-center bg-black/30 opacity-0 hover:opacity-100 transition-opacity",children:w?(0,t.jsx)(h.Pause,{className:"h-8 w-8 text-white"}):(0,t.jsx)(m.Play,{className:"h-8 w-8 text-white"})})]});if("video-composition"===e.type){let s=null;try{s=JSON.parse(e.content)}catch{}return s?(0,t.jsx)("div",{"data-node-id":e.id,style:{...C,pointerEvents:"auto"},onMouseDown:i,onTouchStart:n,children:(0,t.jsx)(eh,{composition:s,isSelected:a,width:e.width})}):(0,t.jsx)(r.motion.div,{"data-node-id":e.id,style:C,className:(0,d.cn)("rounded-xl overflow-hidden cursor-move","bg-zinc-900 border border-red-500/50",a&&"ring-2 ring-red-500 ring-offset-2"),onMouseDown:i,onTouchStart:n,children:(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-red-400 text-sm",children:"Invalid composition data"})})}if("talking-video"===e.type){let s={};try{s=JSON.parse(e.content||"{}")}catch{}return(0,t.jsx)("div",{"data-node-id":e.id,style:{...C,pointerEvents:"auto"},onMouseDown:i,onTouchStart:n,children:(0,t.jsx)(ew,{topic:s.topic,sourcePhotoUrl:s.sourcePhotoUrl,sceneStyle:s.sceneStyle,status:s.status,script:s.script,audioUrl:s.audioUrl,finalVideoUrl:s.finalVideoUrl,isSelected:a,width:e.width||320})})}if("code"===e.type)return(0,t.jsxs)(r.motion.div,{"data-node-id":e.id,style:C,className:(0,d.cn)("rounded-xl overflow-hidden cursor-move","bg-zinc-900 border border-zinc-700",a&&"ring-2 ring-blue-500 ring-offset-2"),onMouseDown:i,onTouchStart:n,onDoubleClick:k,whileHover:{scale:1.02},whileTap:{scale:.98},children:[(0,t.jsxs)("div",{className:"px-3 py-1.5 bg-zinc-800 border-b border-zinc-700 flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"flex gap-1.5",children:[(0,t.jsx)("div",{className:"w-3 h-3 rounded-full bg-red-500"}),(0,t.jsx)("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),(0,t.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-500"})]}),(0,t.jsx)("span",{className:"text-xs text-zinc-400 ml-2",children:"code"})]}),l?(0,t.jsx)(ev.ContextReferenceInput,{className:"w-full h-[calc(100%-32px)] p-3 bg-transparent resize-none outline-none text-sm font-mono text-green-400",value:b,onChange:y,onKeyDown:e=>e.stopPropagation(),multiline:!0,rows:8,autoFocus:!0,placeholder:"Type code or @ to reference..."}):(0,t.jsx)("pre",{className:"p-3 text-sm font-mono text-green-400 overflow-auto h-[calc(100%-32px)]",children:(0,t.jsx)("code",{children:e.content})})]});if("multimodal"===e.type)return(0,t.jsxs)(r.motion.div,{"data-node-id":e.id,style:C,className:(0,d.cn)("rounded-xl p-3 flex flex-col cursor-move","bg-gradient-to-br from-indigo-500/10 via-purple-500/10 to-pink-500/10 border border-purple-500/30",a&&"ring-2 ring-purple-500 ring-offset-2"),onMouseDown:i,onTouchStart:n,onDoubleClick:k,whileHover:{scale:1.02},whileTap:{scale:.98},children:[(0,t.jsx)("div",{className:"flex gap-1 mb-2",children:(0,t.jsx)("span",{className:"px-2 py-0.5 rounded-full bg-purple-500/20 text-purple-500 text-xs",children:"Multi-modal"})}),l?(0,t.jsx)(ev.ContextReferenceInput,{className:"flex-1 bg-transparent resize-none outline-none text-sm",value:b,onChange:y,onKeyDown:e=>e.stopPropagation(),multiline:!0,rows:4,autoFocus:!0,placeholder:"Type @ to reference data..."}):(0,t.jsx)("p",{className:"text-sm flex-1 whitespace-pre-wrap",children:e.content}),(0,t.jsxs)("div",{className:"flex gap-2 mt-2 pt-2 border-t border-purple-500/20",children:[(0,t.jsx)("button",{"aria-label":"Add image",title:"Add image",className:"p-1.5 rounded-lg bg-purple-500/10 hover:bg-purple-500/20 transition-colors",children:(0,t.jsx)(x.Image,{className:"h-4 w-4 text-purple-500"})}),(0,t.jsx)("button",{"aria-label":"Add music",title:"Add music",className:"p-1.5 rounded-lg bg-purple-500/10 hover:bg-purple-500/20 transition-colors",children:(0,t.jsx)(g.Music,{className:"h-4 w-4 text-purple-500"})}),(0,t.jsx)("button",{"aria-label":"Add video",title:"Add video",className:"p-1.5 rounded-lg bg-purple-500/10 hover:bg-purple-500/20 transition-colors",children:(0,t.jsx)(p.Video,{className:"h-4 w-4 text-purple-500"})}),(0,t.jsx)("button",{"aria-label":"AI generate",title:"AI generate",className:"p-1.5 rounded-lg bg-purple-500/10 hover:bg-purple-500/20 transition-colors",children:(0,t.jsx)(u.Sparkles,{className:"h-4 w-4 text-purple-500"})})]})]});if("device-frame"===e.type){let s="string"==typeof e.content?{title:e.content}:e.content;return(0,t.jsx)(r.motion.div,{"data-node-id":e.id,style:{...C,background:"transparent"},className:"cursor-move",onMouseDown:i,onTouchStart:n,children:(0,t.jsx)(U,{deviceType:"iphone-15-pro",screenTitle:s?.title||"Screen",isSelected:a,backgroundColor:e.style?.fill||"#1c1c1e"})})}if(e.type.startsWith("flow-")){let s=e.type;return(0,t.jsx)(r.motion.div,{"data-node-id":e.id,style:{...C,background:"transparent"},className:"cursor-move",onMouseDown:i,onTouchStart:n,children:(0,t.jsx)(et,{type:s,label:"string"==typeof e.content?e.content:"Node",isSelected:a,width:e.width,height:e.height,style:{fill:e.style?.fill,stroke:e.style?.stroke}})})}if(e.type.startsWith("arch-")){let s=e.type,o="string"==typeof e.content?e.content:"",l=e.style?.metadata;return(0,t.jsx)(r.motion.div,{"data-node-id":e.id,style:{...C,background:"transparent"},className:"cursor-move",onMouseDown:i,onTouchStart:n,children:(0,t.jsx)(er,{type:s,label:o,description:l?.description,isSelected:a,width:e.width,height:e.height})})}if(e.type.startsWith("ios-")){let s=e.style?.fill||"#ffffff20";return(0,t.jsx)(r.motion.div,{"data-node-id":e.id,style:{...C,backgroundColor:s},className:(0,d.cn)("rounded-xl p-2 flex items-center justify-center cursor-move","backdrop-blur-sm border border-white/10",a&&"ring-2 ring-blue-500 ring-offset-2"),onMouseDown:i,onTouchStart:n,whileHover:{scale:1.02},whileTap:{scale:.98},children:(0,t.jsx)("span",{className:"text-sm text-white/80",children:e.content})})}if("mindmap"===e.type){let s=e.style?.fill||"#c4b5fd";return(0,t.jsxs)(r.motion.div,{"data-node-id":e.id,style:{...C,backgroundColor:s},className:(0,d.cn)("rounded-2xl p-3 shadow-lg cursor-move relative","border-2 border-white/20",a&&"ring-2 ring-purple-500 ring-offset-2"),onMouseDown:i,onTouchStart:n,onDoubleClick:k,whileHover:{scale:1.03},whileTap:{scale:.97},children:[(0,t.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 rounded-full bg-purple-500 flex items-center justify-center shadow-md",children:(0,t.jsx)(f.GitBranch,{className:"w-3 h-3 text-white"})}),l?(0,t.jsx)(ev.ContextReferenceInput,{className:"w-full h-full bg-transparent resize-none outline-none text-sm text-gray-800 font-medium",value:b,onChange:y,onKeyDown:e=>e.stopPropagation(),multiline:!0,rows:2,autoFocus:!0,placeholder:"Mind map node..."}):(0,t.jsx)("p",{className:"text-sm font-medium whitespace-pre-wrap text-gray-800",children:e.content})]})}return(0,t.jsx)(r.motion.div,{"data-node-id":e.id,style:{...C,backgroundColor:"#e5e7eb"},className:(0,d.cn)("rounded-lg flex items-center justify-center cursor-move",a&&"ring-2 ring-primary ring-offset-2"),onMouseDown:i,onTouchStart:n,whileHover:{scale:1.02},whileTap:{scale:.98},children:(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:e.type})})}var e5=e.i(813464),e4=e.i(317066),e3=e.i(240041),e8=e.i(593136),e6=e.i(320253),e6=e6,e9=e.i(372032),e7=e.i(339420),te=e.i(404775),tt=e.i(619040);let ts=[{id:"select",icon:e5.MousePointer2,label:"Select",shortcut:"V"},{id:"pan",icon:e4.Hand,label:"Pan",shortcut:"H"},{id:"pen",icon:e3.Pencil,label:"Draw",shortcut:"P"},{id:"connector",icon:e6.default,label:"Connect",shortcut:"L"},{id:"rectangle",icon:_.Square,label:"Rectangle",shortcut:"R"},{id:"ellipse",icon:e8.Circle,label:"Ellipse",shortcut:"O"},{id:"text",icon:en.Type,label:"Text",shortcut:"T"},{id:"sticky",icon:ej.StickyNote,label:"Sticky",shortcut:"S"},{id:"image",icon:x.Image,label:"Image",shortcut:"I"},{id:"eraser",icon:e9.Eraser,label:"Eraser",shortcut:"E"}];function ta({selectedTool:e,onToolChange:a,onUndo:i,onRedo:n,canUndo:o=!1,canRedo:l=!1}){let[c,u]=(0,s.useState)({x:16,y:100}),[m,h]=(0,s.useState)(!1),x=(0,s.useRef)({x:0,y:0,posX:0,posY:0}),p=(0,s.useCallback)(e=>{e.preventDefault(),h(!0),x.current={x:"touches"in e?e.touches[0].clientX:e.clientX,y:"touches"in e?e.touches[0].clientY:e.clientY,posX:c.x,posY:c.y};let t=e=>{let t="touches"in e?e.touches[0].clientX:e.clientX,s="touches"in e?e.touches[0].clientY:e.clientY,a=t-x.current.x,r=s-x.current.y;u({x:Math.max(0,Math.min(window.innerWidth-60,x.current.posX+a)),y:Math.max(0,Math.min(window.innerHeight-400,x.current.posY+r))})},s=()=>{h(!1),window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",s),window.removeEventListener("touchmove",t),window.removeEventListener("touchend",s)};window.addEventListener("mousemove",t),window.addEventListener("mouseup",s),window.addEventListener("touchmove",t),window.addEventListener("touchend",s)},[c]);return(0,t.jsx)(r.motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},style:{position:"fixed",left:c.x,top:c.y,zIndex:40,cursor:m?"grabbing":"default"},children:(0,t.jsxs)("div",{className:"bg-background/95 backdrop-blur-xl border rounded-2xl shadow-lg p-1.5 flex flex-col gap-1",children:[(0,t.jsx)("div",{className:"w-10 h-6 rounded-lg flex items-center justify-center cursor-grab active:cursor-grabbing hover:bg-muted transition-colors",onMouseDown:p,onTouchStart:p,children:(0,t.jsx)(e7.GripVertical,{className:"h-4 w-4 text-muted-foreground"})}),(0,t.jsx)("div",{className:"h-px bg-border"}),ts.map(s=>{let r=s.icon,i=e===s.id;return(0,t.jsxs)("button",{onClick:()=>a(s.id),className:(0,d.cn)("relative w-10 h-10 rounded-xl flex items-center justify-center transition-all","hover:bg-muted",i&&"bg-primary text-primary-foreground hover:bg-primary/90"),title:`${s.label}${s.shortcut?` (${s.shortcut})`:""}`,children:[(0,t.jsx)(r,{className:"h-5 w-5"}),s.shortcut&&(0,t.jsx)("span",{className:"absolute -right-0.5 -bottom-0.5 text-[8px] font-medium opacity-50",children:s.shortcut})]},s.id)}),(i||n)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"h-px bg-border my-1"}),(0,t.jsx)("button",{onClick:i,disabled:!o,className:(0,d.cn)("w-10 h-10 rounded-xl flex items-center justify-center transition-all","hover:bg-muted",!o&&"opacity-30 cursor-not-allowed"),title:"Undo (Cmd+Z)",children:(0,t.jsx)(te.Undo,{className:"h-5 w-5"})}),(0,t.jsx)("button",{onClick:n,disabled:!l,className:(0,d.cn)("w-10 h-10 rounded-xl flex items-center justify-center transition-all","hover:bg-muted",!l&&"opacity-30 cursor-not-allowed"),title:"Redo (Cmd+Shift+Z)",children:(0,t.jsx)(tt.Redo,{className:"h-5 w-5"})})]})]})})}var tr=e.i(519455),ti=e.i(487486),tn=e.i(92768),to=e.i(591372),tl=e.i(753266),tc=e.i(75333),td=e.i(272690),tu=e.i(185894),tm=e.i(268122),th=e.i(650425);let tx=[{id:"1",name:"Modern UI Component",description:"Clean, minimalist UI component design",prompt:"A sleek, modern UI component with glass morphism effects, subtle gradients, rounded corners, and a dark theme. Professional and polished.",category:"ui_design",provider:"any",tags:["ui","glassmorphism","modern"],usageCount:150,isFeatured:!0},{id:"2",name:"Abstract Gradient Art",description:"Flowing abstract gradients",prompt:"Abstract flowing gradient art with vibrant colors blending seamlessly, ethereal glow effects, 4K quality, digital art masterpiece",category:"abstract",provider:"any",tags:["abstract","gradient","colorful"],usageCount:120,isFeatured:!0},{id:"3",name:"Product Hero Shot",description:"Professional product photography",prompt:"Professional product photography, studio lighting, clean white background, subtle shadows, commercial quality, 8K resolution",category:"photo",provider:"any",tags:["product","photography","commercial"],usageCount:95,isFeatured:!1},{id:"4",name:"Isometric 3D Scene",description:"Cute isometric illustration",prompt:"Cute isometric 3D illustration, soft pastel colors, minimal design, clean geometric shapes, playful and modern",category:"3d",provider:"any",tags:["3d","isometric","cute"],usageCount:88,isFeatured:!0},{id:"5",name:"App Icon Design",description:"Modern app icon",prompt:"Modern app icon design, bold gradient colors, simple shape, iOS style, glossy finish, professional quality",category:"icon",provider:"any",tags:["icon","app","ios"],usageCount:75,isFeatured:!1},{id:"6",name:"Character Portrait",description:"Stylized character art",prompt:"Stylized character portrait, vibrant colors, expressive eyes, anime-inspired, professional digital art, detailed shading",category:"character",provider:"any",tags:["character","portrait","anime"],usageCount:110,isFeatured:!0},{id:"7",name:"Fantasy Landscape",description:"Magical environment",prompt:"Magical fantasy landscape, ethereal lighting, floating islands, waterfalls, lush vegetation, cinematic composition, concept art quality",category:"landscape",provider:"any",tags:["landscape","fantasy","magical"],usageCount:100,isFeatured:!1},{id:"8",name:"Seamless Pattern",description:"Tileable texture pattern",prompt:"Seamless tileable pattern, geometric shapes, modern design, subtle colors, perfect for backgrounds, high quality texture",category:"texture",provider:"any",tags:["pattern","texture","seamless"],usageCount:65,isFeatured:!1}],tp={ui_design:(0,t.jsx)(tl.Layout,{className:"h-4 w-4"}),illustration:(0,t.jsx)(y.Palette,{className:"h-4 w-4"}),photo:(0,t.jsx)(x.Image,{className:"h-4 w-4"}),"3d":(0,t.jsx)(tc.Box,{className:"h-4 w-4"}),icon:(0,t.jsx)(u.Sparkles,{className:"h-4 w-4"}),texture:(0,t.jsx)(tl.Layout,{className:"h-4 w-4"}),character:(0,t.jsx)(tu.Wand2,{className:"h-4 w-4"}),landscape:(0,t.jsx)(x.Image,{className:"h-4 w-4"}),abstract:(0,t.jsx)(y.Palette,{className:"h-4 w-4"}),code:(0,t.jsx)(td.Code2,{className:"h-4 w-4"}),audio:(0,t.jsx)(g.Music,{className:"h-4 w-4"}),video:(0,t.jsx)(p.Video,{className:"h-4 w-4"}),other:(0,t.jsx)(u.Sparkles,{className:"h-4 w-4"})},tg=[{id:"all",label:"All"},{id:"ui_design",label:"UI"},{id:"illustration",label:"Art"},{id:"photo",label:"Photo"},{id:"3d",label:"3D"},{id:"character",label:"Character"},{id:"landscape",label:"Landscape"}];function tf({onSelectPrompt:e,onClose:a}){let[r,i]=(0,s.useState)(""),[n,o]=(0,s.useState)("all"),[l,c]=(0,s.useState)("featured"),m=tx.filter(e=>{let t=!r||e.name.toLowerCase().includes(r.toLowerCase())||e.prompt.toLowerCase().includes(r.toLowerCase())||e.tags.some(e=>e.toLowerCase().includes(r.toLowerCase())),s="all"===n||e.category===n,a="all"===l||"featured"===l&&e.isFeatured||"popular"===l&&e.usageCount>80;return t&&s&&a});return(0,t.jsxs)("div",{className:"h-full flex flex-col",children:[(0,t.jsxs)("div",{className:"p-4 border-b",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("h3",{className:"font-semibold flex items-center gap-2",children:[(0,t.jsx)(u.Sparkles,{className:"h-4 w-4 text-purple-500"}),"AI Prompt Library"]}),(0,t.jsx)(tr.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:a,children:(0,t.jsx)(to.X,{className:"h-4 w-4"})})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(tn.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)("input",{type:"text",placeholder:"Search prompts...",value:r,onChange:e=>i(e.target.value),className:"w-full pl-9 pr-3 py-2 rounded-lg border bg-background text-sm focus:outline-none focus:ring-2 focus:ring-primary"})]})]}),(0,t.jsx)("div",{className:"px-4 pt-2",children:(0,t.jsx)("div",{className:"flex gap-1 p-1 rounded-lg bg-muted",children:["featured","popular","all"].map(e=>(0,t.jsxs)("button",{onClick:()=>c(e),className:(0,d.cn)("flex-1 py-1.5 px-2 text-xs font-medium rounded-md transition-colors",l===e?"bg-background shadow-sm":"text-muted-foreground hover:text-foreground"),children:["featured"===e&&(0,t.jsx)(tm.Star,{className:"inline h-3 w-3 mr-1"}),"popular"===e&&(0,t.jsx)(th.TrendingUp,{className:"inline h-3 w-3 mr-1"}),e.charAt(0).toUpperCase()+e.slice(1)]},e))})}),(0,t.jsx)("div",{className:"px-4 py-2 flex gap-1 overflow-x-auto",children:tg.map(e=>(0,t.jsx)(tr.Button,{variant:n===e.id?"secondary":"ghost",size:"sm",className:"h-7 text-xs whitespace-nowrap",onClick:()=>o(e.id),children:e.label},e.id))}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:0===m.length?(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(u.Sparkles,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,t.jsx)("p",{className:"text-sm",children:"No prompts found"})]}):m.map(s=>(0,t.jsx)(tb,{prompt:s,onClick:()=>e({prompt:s.prompt,negativePrompt:s.negativePrompt,provider:s.provider,model:s.modelId,category:s.category})},s.id))}),(0,t.jsxs)("div",{className:"p-4 border-t bg-muted/30",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:"Ready for Fal AI, Replicate, and HuggingFace"}),(0,t.jsxs)("div",{className:"flex justify-center gap-2 mt-2",children:[(0,t.jsx)(ti.Badge,{variant:"outline",className:"text-xs",children:"Fal AI"}),(0,t.jsx)(ti.Badge,{variant:"outline",className:"text-xs",children:"Replicate"}),(0,t.jsx)(ti.Badge,{variant:"outline",className:"text-xs",children:"HuggingFace"})]})]})]})}function tb({prompt:e,onClick:s}){return(0,t.jsxs)("button",{className:(0,d.cn)("w-full text-left p-3 rounded-lg border bg-card hover:bg-accent/50 transition-colors",e.isFeatured&&"border-purple-500/30 bg-purple-500/5"),onClick:s,children:[(0,t.jsxs)("div",{className:"flex items-start gap-2 mb-2",children:[(0,t.jsx)("div",{className:"p-1.5 rounded-md bg-muted",children:tp[e.category]||(0,t.jsx)(u.Sparkles,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h4",{className:"font-medium text-sm truncate",children:e.name}),e.description&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:e.description})]}),e.isFeatured&&(0,t.jsx)(tm.Star,{className:"h-4 w-4 text-yellow-500 fill-yellow-500 shrink-0"})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground line-clamp-2 mb-2",children:e.prompt}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"flex gap-1 flex-wrap flex-1",children:e.tags.slice(0,3).map(e=>(0,t.jsx)(ti.Badge,{variant:"secondary",className:"text-xs px-1.5 py-0",children:e},e))}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:[e.usageCount," uses"]})]})]})}var ty=e.i(360797),tw=e.i(422654);let tv={freeform:(0,t.jsx)(tl.Layout,{className:"h-5 w-5"}),wireframe:(0,t.jsx)(V.Layers,{className:"h-5 w-5"}),moodboard:(0,t.jsx)(ty.Map,{className:"h-5 w-5"}),storyboard:(0,t.jsx)(ep.Film,{className:"h-5 w-5"}),mindmap:(0,t.jsx)(f.GitBranch,{className:"h-5 w-5"}),flowchart:(0,t.jsx)(tw.Workflow,{className:"h-5 w-5"})},tj={freeform:"from-blue-500 to-cyan-500",wireframe:"from-gray-500 to-slate-600",moodboard:"from-pink-500 to-rose-500",storyboard:"from-purple-500 to-violet-500",mindmap:"from-green-500 to-emerald-500",flowchart:"from-orange-500 to-amber-500"};function tN({canvases:e,onSelect:s,onCreateNew:a}){return 0===e.length?(0,t.jsx)(tC,{onCreateNew:a}):(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsxs)("section",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Your Canvases"}),(0,t.jsxs)(tr.Button,{onClick:a,size:"sm",children:[(0,t.jsx)(w.Plus,{className:"h-4 w-4 mr-2"}),"New Canvas"]})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:e.map((e,a)=>(0,t.jsx)(tk,{canvas:e,onClick:()=>s(e._id),index:a},e._id))})]})})}function tk({canvas:e,onClick:s,index:a}){var i;let n,o,l,c=tj[e.canvasType]||tj.freeform,u=tv[e.canvasType]||tv.freeform;return(0,t.jsx)(r.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*a},className:"group relative",children:(0,t.jsxs)("button",{onClick:s,className:"w-full text-left rounded-xl border bg-card overflow-hidden hover:shadow-lg transition-all hover:border-primary/50",children:[(0,t.jsxs)("div",{className:(0,d.cn)("aspect-video relative bg-gradient-to-br",c),children:[e.thumbnailUrl?(0,t.jsx)("img",{src:e.thumbnailUrl,alt:e.name,className:"w-full h-full object-cover"}):(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-white/80",children:u}),"template"===e.status&&(0,t.jsx)(ti.Badge,{className:"absolute top-2 left-2 bg-white/20 backdrop-blur-sm text-white",children:"Template"})]}),(0,t.jsxs)("div",{className:"p-3",children:[(0,t.jsx)("h3",{className:"font-medium truncate",children:e.name}),e.description&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground truncate mt-0.5",children:e.description}),(0,t.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,t.jsx)(ti.Badge,{variant:"secondary",className:"text-xs capitalize",children:e.canvasType}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:(i=e.updatedAt,(l=Math.floor((o=Math.floor((n=Math.floor(Math.floor((Date.now()-i)/1e3)/60))/60))/24))>0?`${l}d ago`:o>0?`${o}h ago`:n>0?`${n}m ago`:"just now")})]})]})]})})}function tC({onCreateNew:e}){return(0,t.jsxs)(r.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col items-center justify-center py-16 px-4",children:[(0,t.jsx)("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-purple-500/20 to-blue-500/20 flex items-center justify-center mb-6",children:(0,t.jsx)(tl.Layout,{className:"h-10 w-10 text-purple-500"})}),(0,t.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Start Your First Canvas"}),(0,t.jsx)("p",{className:"text-muted-foreground text-center max-w-md mb-6",children:"Create infinite canvases to explore ideas, design interfaces, plan projects, and generate AI art - all in one place."}),(0,t.jsxs)(tr.Button,{onClick:e,size:"lg",className:"gap-2",children:[(0,t.jsx)(w.Plus,{className:"h-5 w-5"}),"Create Your First Canvas"]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mt-12 max-w-2xl",children:[(0,t.jsx)(tS,{icon:(0,t.jsx)(tl.Layout,{className:"h-5 w-5"}),title:"Infinite Space",description:"Unlimited canvas to explore any idea"}),(0,t.jsx)(tS,{icon:(0,t.jsx)(V.Layers,{className:"h-5 w-5"}),title:"Project Linked",description:"Connect canvases to your projects"}),(0,t.jsx)(tS,{icon:(0,t.jsx)(tl.Layout,{className:"h-5 w-5"}),title:"AI Generation",description:"Generate images, code, and more"})]})]})}function tS({icon:e,title:s,description:a}){return(0,t.jsxs)("div",{className:"text-center p-4 rounded-lg bg-muted/50",children:[(0,t.jsx)("div",{className:"inline-flex p-2 rounded-lg bg-primary/10 text-primary mb-2",children:e}),(0,t.jsx)("h3",{className:"font-medium text-sm",children:s}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:a})]})}var tM=e.i(280028);let tD=[{id:"ep01/style-tests",label:"Style Tests"},{id:"ep01/frames",label:"Frames"},{id:"ep01/storyboard",label:"Storyboard"},{id:"ep01/characters",label:"Characters"}];function tT({isOpen:e,onClose:a,onSelectImage:n}){let[o,l]=(0,s.useState)([]),[c,u]=(0,s.useState)(!1),[m,h]=(0,s.useState)(tD[0].id),[p,g]=(0,s.useState)(null),[f,y]=(0,s.useState)(null),w=async(e,t)=>{if(t.stopPropagation(),confirm(`Delete ${e.filename}?`)){y(e.filename);try{e.url&&await fetch("/api/blob/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e.url})}),await fetch(`/api/content-images/file?path=${encodeURIComponent(`${m}/${e.filename}`)}`,{method:"DELETE"}),l(t=>t.filter(t=>t.filename!==e.filename))}catch(e){console.error("Delete failed:",e)}finally{y(null)}}},v=async e=>{u(!0),g(null);try{let t=await fetch(`/api/content-images?folder=${encodeURIComponent(e)}`),s=await t.json();s.images?l(s.images):(g("No images found"),l([]))}catch(e){g("Failed to load images"),l([])}finally{u(!1)}};return(0,s.useEffect)(()=>{e&&v(m)},[e,m]),(0,t.jsx)(i.AnimatePresence,{children:e&&(0,t.jsxs)(r.motion.div,{initial:{x:"100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"spring",damping:25,stiffness:300},className:"fixed right-0 top-0 bottom-0 w-80 bg-background/95 backdrop-blur-xl border-l shadow-2xl z-50 flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(x.Image,{className:"h-5 w-5 text-primary"}),(0,t.jsx)("h2",{className:"font-semibold",children:"Content Images"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(tr.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>v(m),children:(0,t.jsx)(A.RefreshCw,{className:(0,d.cn)("h-4 w-4",c&&"animate-spin")})}),(0,t.jsx)(tr.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:a,children:(0,t.jsx)(to.X,{className:"h-4 w-4"})})]})]}),(0,t.jsxs)("div",{className:"p-3 border-b bg-muted/30",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2 text-sm text-muted-foreground",children:[(0,t.jsx)(tM.FolderOpen,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Folder"})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:tD.map(e=>(0,t.jsx)(tr.Button,{variant:m===e.id?"secondary":"ghost",size:"sm",className:"text-xs h-7",onClick:()=>h(e.id),children:e.label},e.id))})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-3",children:c?(0,t.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,t.jsx)(A.RefreshCw,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):p?(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:p}):0===o.length?(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No images in this folder"}):(0,t.jsx)("div",{className:"grid grid-cols-2 gap-2",children:o.map(e=>{var s;return(0,t.jsxs)(r.motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"group relative aspect-square rounded-lg overflow-hidden border bg-muted/50 hover:border-primary transition-colors",onClick:()=>n(e.url||e.path,e.filename),children:[(0,t.jsx)("img",{src:e.url||e.path,alt:e.filename,className:"w-full h-full object-cover",loading:"lazy"}),(0,t.jsxs)("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 to-transparent p-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,t.jsx)("p",{className:"text-[10px] text-white truncate",children:e.filename.replace(/\.(png|jpg|jpeg|webp|gif)$/i,"").replace(/_\d+$/,"").replace(/-/g," ").replace(/\b\w/g,e=>e.toUpperCase())}),(0,t.jsx)("p",{className:"text-[8px] text-white/70",children:(s=e.size)<1024?`${s}B`:s<1048576?`${(s/1024).toFixed(1)}KB`:`${(s/1048576).toFixed(1)}MB`})]}),(0,t.jsxs)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1",children:[(0,t.jsx)("button",{onClick:t=>w(e,t),className:"bg-red-500 hover:bg-red-600 text-white rounded-full p-1 transition-colors",disabled:f===e.filename,children:f===e.filename?(0,t.jsx)(A.RefreshCw,{className:"h-3 w-3 animate-spin"}):(0,t.jsx)(b.Trash2,{className:"h-3 w-3"})}),(0,t.jsx)("div",{className:"bg-primary text-primary-foreground rounded-full p-1",children:(0,t.jsx)(N.ChevronRight,{className:"h-3 w-3"})})]})]},e.filename)})})}),(0,t.jsx)("div",{className:"p-3 border-t bg-muted/30 text-xs text-muted-foreground text-center",children:"Click an image to add it to the canvas"})]})})}var tP=e.i(541956);async function tE(e,t=0,s=0){let a=[],r=[],i=new Map,n=e.split("\n").map(e=>e.trim()).filter(e=>e&&!e.startsWith("%%")).filter(e=>!e.match(/^(graph|flowchart|sequenceDiagram|classDiagram|stateDiagram)\s/i)),o=0;for(let e of n){let n;for(let r of[/(\w+)\(\[([^\]]*)\]\)/g,/(\w+)\[\[([^\]]*)\]\]/g,/(\w+)\[\(([^)]*)\)\]/g,/(\w+)\{\{([^}]*)\}\}/g,/(\w+)\{([^}]*)\}/g,/(\w+)\[\/([^/]*)\/\]/g,/(\w+)\(([^)]*)\)/g,/(\w+)\["([^"]*)"\]/g,/(\w+)\[([^\]]*)\]/g]){let n;for(r.lastIndex=0;null!==(n=r.exec(e));){let e=n[1],l=n[2];if(!i.has(e)){let n=o%3,c=Math.floor(o/3),d=`node-mermaid-${Date.now()}-${o}`,u="flow-process";r.source.includes("\\(\\[")?u="flow-start":r.source.includes("\\{\\{")?u="arch-cloud":r.source.includes("\\{")?u="flow-decision":r.source.includes("\\[\\(")?u="arch-database":r.source.includes("\\[\\[")?u="flow-subprocess":r.source.includes("\\/")?u="flow-data":r.source.includes("\\(")&&(u="flow-start"),a.push({id:d,type:u,x:t+250*n,y:s+150*c,width:180,height:80,content:l,style:{fill:{"flow-start":"#22c55e","flow-end":"#ef4444","flow-decision":"#f59e0b","flow-process":"#3b82f6","flow-data":"#8b5cf6","flow-subprocess":"#06b6d4","arch-database":"#6366f1","arch-service":"#3b82f6","arch-api":"#10b981","arch-client":"#f97316","arch-cloud":"#8b5cf6","arch-queue":"#ec4899"}[u]||"#3b82f6"}}),i.set(e,d),o++}}}let l=/(\w+)\s*(-+\.?->?|=+>|--+)\s*(?:\|([^|]*)\|\s*)?(\w+)/g;for(;null!==(n=l.exec(e));){let e=n[1],l=n[3]||void 0,c=n[4];if(!i.has(e)){let r=o%3,n=Math.floor(o/3),l=`node-mermaid-${Date.now()}-${o}`;a.push({id:l,type:"flow-process",x:t+250*r,y:s+150*n,width:180,height:80,content:e,style:{fill:"#3b82f6"}}),i.set(e,l),o++}if(!i.has(c)){let e=o%3,r=Math.floor(o/3),n=`node-mermaid-${Date.now()}-${o}`;a.push({id:n,type:"flow-process",x:t+250*e,y:s+150*r,width:180,height:80,content:c,style:{fill:"#3b82f6"}}),i.set(c,n),o++}let d=i.get(e),u=i.get(c);r.push({id:`edge-mermaid-${Date.now()}-${r.length}`,source:d,target:u,type:"arrow",label:l})}}return r.length>0&&function(e,t,s,a){let r=new Map,i=new Set;for(let e of t)r.has(e.source)||r.set(e.source,[]),r.get(e.source).push(e.target),i.add(e.target);let n=e.filter(e=>!i.has(e.id)).map(e=>e.id);0===n.length&&e.length>0&&n.push(e[0].id);let o=new Map,l=n.map(e=>({id:e,level:0})),c=new Set;for(;l.length>0;){let{id:e,level:t}=l.shift();if(!c.has(e))for(let s of(c.add(e),o.set(e,t),r.get(e)||[]))l.push({id:s,level:t+1})}let d=new Map;for(let[e,t]of o)d.has(t)||d.set(t,[]),d.get(t).push(e);for(let[t,r]of d){let i=-((r.length-1)*250)/2;r.forEach((r,n)=>{let o=e.find(e=>e.id===r);o&&(o.x=s+i+250*n,o.y=a+150*t)})}}(a,r,t,s),{nodes:a,edges:r}}let tz={flowchart:{label:"Flowchart",code:`flowchart TD
    A([Start]) --> B[Process Data]
    B --> C{Valid?}
    C -->|Yes| D[Save to DB]
    C -->|No| E[Show Error]
    D --> F([End])
    E --> B`},sequence:{label:"Sequence Diagram",code:`sequenceDiagram
    participant U as User
    participant S as Server
    participant DB as Database
    U->>S: Request Data
    S->>DB: Query
    DB-->>S: Results
    S-->>U: Response`},architecture:{label:"Architecture",code:`flowchart LR
    Client[Browser Client] --> API[API Gateway]
    API --> Auth[Auth Service]
    API --> Core[Core Service]
    Core --> DB[(PostgreSQL)]
    Core --> Cache[(Redis)]
    Core --> Queue[Message Queue]
    Queue --> Worker[Worker Service]`},state:{label:"State Machine",code:`stateDiagram-v2
    [*] --> Idle
    Idle --> Loading: fetch
    Loading --> Success: resolve
    Loading --> Error: reject
    Success --> Idle: reset
    Error --> Loading: retry
    Error --> Idle: dismiss`},er:{label:"ER Diagram",code:`erDiagram
    USER ||--o{ POST : writes
    USER ||--o{ COMMENT : makes
    POST ||--o{ COMMENT : has
    POST }o--|| CATEGORY : belongs_to
    USER {
      int id
      string name
      string email
    }
    POST {
      int id
      string title
      text content
    }`},gitgraph:{label:"Git Graph",code:`gitGraph
    commit
    branch develop
    checkout develop
    commit
    commit
    checkout main
    merge develop
    commit
    branch feature
    checkout feature
    commit
    checkout develop
    merge feature
    checkout main
    merge develop`}};function tA({open:a,onClose:n,onInsert:o,existingNodes:l,existingEdges:c}){let[h,x]=(0,s.useState)("mermaid"),[p,g]=(0,s.useState)(tz.flowchart.code),[b,y]=(0,s.useState)(""),[w,v]=(0,s.useState)(null),[j,N]=(0,s.useState)(""),[k,C]=(0,s.useState)(!1),[M,D]=(0,s.useState)(!1),[T,P]=(0,s.useState)(!1),E=(0,s.useRef)(null),z=(0,s.useCallback)(async()=>{if(!p.trim()){N(""),v(null);return}C(!0),v(null);try{let t=(await e.A(215515)).default;t.initialize({startOnLoad:!1,theme:"dark",themeVariables:{primaryColor:"#3b82f6",primaryTextColor:"#ffffff",primaryBorderColor:"#1d4ed8",lineColor:"#6b7280",secondaryColor:"#8b5cf6",tertiaryColor:"#22c55e"}});let s=`mermaid-preview-${Date.now()}`,{svg:a}=await t.render(s,p);N(a)}catch(e){v(e instanceof Error?e.message:"Failed to parse Mermaid syntax"),N("")}finally{C(!1)}},[p]);(0,s.useEffect)(()=>{if(!a)return;let e=setTimeout(z,500);return()=>clearTimeout(e)},[p,a,z]);let A=(0,s.useCallback)(async()=>{try{let{nodes:e,edges:t}=await tE(p);if(0===e.length)return void v("No diagram elements found. Check your Mermaid syntax.");o(e,t),n()}catch(e){v("Failed to convert diagram. Please check the syntax.")}},[p,o,n]),$=(0,s.useCallback)(async()=>{if(b.trim()){D(!0),v(null);try{let e=`Generate a Mermaid diagram based on this description. Return ONLY the Mermaid syntax, no explanation or markdown fences.

Description: ${b}

Rules:
- Use "flowchart TD" for top-down flow diagrams
- Use "flowchart LR" for left-right flow diagrams
- Use descriptive node labels
- Use appropriate shapes: [rect], (round), {diamond}, ([stadium]), [[subprocess]]
- Add edge labels where meaningful
- Keep it clean and readable
- Maximum 15 nodes for clarity`,t=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"user",content:e}],model:"claude"})});if(!t.ok)throw Error("AI generation failed");let s=await t.json(),a=(s.content||s.message?.content||"").replace(/```mermaid\n?/g,"").replace(/```\n?/g,"").trim();a?(g(a),x("mermaid")):v("AI could not generate a valid diagram. Try a more specific description.")}catch(e){v("Failed to generate diagram. Please try again.")}finally{D(!1)}}},[b]),L=(0,s.useCallback)(()=>{var e;let t,s;l&&0!==l.length?(g((e=c||[],t=["flowchart TD"],s=new Map,l.forEach((e,a)=>{let r=e.content?.replace(/[[\]{}()|]/g,"")||`Node${a}`,i=`N${a}`;switch(s.set(e.id,i),e.type){case"flow-decision":t.push(`    ${i}{${r}}`);break;case"flow-start":case"flow-end":t.push(`    ${i}([${r}])`);break;case"flow-process":case"arch-service":case"arch-api":t.push(`    ${i}[${r}]`);break;case"flow-data":t.push(`    ${i}[/${r}/]`);break;case"flow-subprocess":t.push(`    ${i}[[${r}]]`);break;case"arch-database":t.push(`    ${i}[(${r})]`);break;case"arch-client":t.push(`    ${i}(${r})`);break;case"arch-queue":t.push(`    ${i}>>${r}]`);break;case"arch-cloud":t.push(`    ${i}{{${r}}}`);break;default:t.push(`    ${i}["${r}"]`)}}),e.forEach(e=>{let a=s.get(e.source),r=s.get(e.target);a&&r&&(e.label?t.push(`    ${a} -->|${e.label}| ${r}`):t.push(`    ${a} --> ${r}`))}),t.join("\n"))),x("mermaid")):v("No canvas elements to reverse engineer.")},[l,c]);return a?(0,t.jsx)(i.AnimatePresence,{children:(0,t.jsx)(r.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",onClick:n,children:(0,t.jsxs)(r.motion.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2},className:"w-full max-w-4xl max-h-[85vh] bg-background border border-border rounded-2xl shadow-2xl flex flex-col overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(f.GitBranch,{className:"w-5 h-5 text-primary"}),(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Text to Diagram"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[l&&l.length>0&&(0,t.jsxs)("button",{onClick:L,className:"px-3 py-1.5 text-sm rounded-lg bg-muted hover:bg-muted/80 transition-colors flex items-center gap-1.5",children:[(0,t.jsx)(tP.Upload,{className:"w-3.5 h-3.5"}),"From Canvas"]}),(0,t.jsx)("button",{onClick:n,className:"p-2 rounded-lg hover:bg-muted transition-colors",children:(0,t.jsx)(to.X,{className:"w-4 h-4"})})]})]}),(0,t.jsxs)("div",{className:"flex border-b px-6",children:[(0,t.jsxs)("button",{onClick:()=>x("mermaid"),className:(0,d.cn)("px-4 py-2.5 text-sm font-medium border-b-2 transition-colors -mb-px","mermaid"===h?"border-primary text-foreground":"border-transparent text-muted-foreground hover:text-foreground"),children:[(0,t.jsx)(td.Code2,{className:"w-4 h-4 inline mr-1.5"}),"Mermaid"]}),(0,t.jsxs)("button",{onClick:()=>x("ai"),className:(0,d.cn)("px-4 py-2.5 text-sm font-medium border-b-2 transition-colors -mb-px","ai"===h?"border-primary text-foreground":"border-transparent text-muted-foreground hover:text-foreground"),children:[(0,t.jsx)(u.Sparkles,{className:"w-4 h-4 inline mr-1.5"}),"AI Generate"]})]}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[(0,t.jsx)("div",{className:"flex-1 flex flex-col border-r min-h-0",children:"mermaid"===h?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"px-4 py-2 border-b",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("button",{onClick:()=>P(!T),className:"flex items-center gap-1.5 text-sm text-muted-foreground hover:text-foreground transition-colors",children:["Templates",(0,t.jsx)(S.ChevronDown,{className:(0,d.cn)("w-3.5 h-3.5 transition-transform",T&&"rotate-180")})]}),T&&(0,t.jsx)("div",{className:"absolute top-full left-0 mt-1 z-10 bg-background border rounded-lg shadow-lg py-1 min-w-[180px]",children:Object.entries(tz).map(([e,s])=>(0,t.jsx)("button",{onClick:()=>{g(s.code),P(!1)},className:"w-full text-left px-3 py-2 text-sm hover:bg-muted transition-colors",children:s.label},e))})]})}),(0,t.jsx)("textarea",{value:p,onChange:e=>g(e.target.value),className:"flex-1 p-4 bg-transparent font-mono text-sm resize-none outline-none min-h-[200px]",placeholder:"Enter Mermaid diagram syntax...",spellCheck:!1})]}):(0,t.jsxs)("div",{className:"flex-1 flex flex-col p-4 gap-4",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Describe your diagram in natural language and AI will generate the Mermaid syntax."}),(0,t.jsx)("textarea",{value:b,onChange:e=>y(e.target.value),className:"flex-1 p-3 bg-muted/30 rounded-lg text-sm resize-none outline-none border focus:border-primary transition-colors min-h-[150px]",placeholder:"e.g., A user authentication flow with login, registration, password reset, and email verification..."}),(0,t.jsxs)("button",{onClick:$,disabled:M||!b.trim(),className:(0,d.cn)("flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors",M?"bg-muted text-muted-foreground cursor-wait":"bg-primary text-primary-foreground hover:bg-primary/90"),children:[(0,t.jsx)(u.Sparkles,{className:(0,d.cn)("w-4 h-4",M&&"animate-spin")}),M?"Generating...":"Generate Diagram"]})]})}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col min-h-0",children:[(0,t.jsxs)("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Preview"}),k&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground animate-pulse",children:"Rendering..."})]}),(0,t.jsx)("div",{ref:E,className:"flex-1 overflow-auto p-4 flex items-center justify-center min-h-[200px]",children:j?(0,t.jsx)("div",{className:"max-w-full [&_svg]:max-w-full [&_svg]:h-auto",dangerouslySetInnerHTML:{__html:j}}):w?(0,t.jsxs)("div",{className:"text-center text-sm",children:[(0,t.jsx)("div",{className:"text-red-400 mb-2",children:"Syntax Error"}),(0,t.jsx)("div",{className:"text-muted-foreground text-xs max-w-xs",children:w})]}):(0,t.jsxs)("div",{className:"text-muted-foreground text-sm text-center",children:[(0,t.jsx)(f.GitBranch,{className:"w-8 h-8 mx-auto mb-2 opacity-30"}),(0,t.jsx)("p",{children:"Enter Mermaid syntax to see preview"})]})})]})]}),w&&"mermaid"===h&&(0,t.jsx)("div",{className:"px-6 py-2 bg-red-500/10 border-t border-red-500/20",children:(0,t.jsx)("p",{className:"text-sm text-red-400",children:w})}),(0,t.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-t",children:[(0,t.jsx)("button",{onClick:n,className:"px-4 py-2 text-sm rounded-lg hover:bg-muted transition-colors",children:"Cancel"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("button",{onClick:z,className:"flex items-center gap-1.5 px-4 py-2 text-sm rounded-lg bg-muted hover:bg-muted/80 transition-colors",children:[(0,t.jsx)(m.Play,{className:"w-3.5 h-3.5"}),"Preview"]}),(0,t.jsxs)("button",{onClick:A,disabled:!p.trim(),className:(0,d.cn)("flex items-center gap-1.5 px-4 py-2 text-sm rounded-lg font-medium transition-colors",p.trim()?"bg-primary text-primary-foreground hover:bg-primary/90":"bg-muted text-muted-foreground cursor-not-allowed"),children:[(0,t.jsx)(ey.Download,{className:"w-3.5 h-3.5"}),"Insert to Canvas"]})]})]})]})})}):null}var t$=e.i(548685),tL=e.i(988221),tR=e.i(300605),tI=e.i(804538),tB=e.i(779921),tB=tB;function tF(){let e=(0,a.useRouter)(),d=(0,a.useSearchParams)(),{user:m,isLoaded:h}=(0,n.useUser)(),{registerCanvas:x,unregisterCanvas:p,setCanvasState:g}=(0,tL.useCanvasContext)(),f=d.get("id"),b=d.get("mode"),[y,v]=(0,s.useState)(f||"import"===b?"editor":"list"),[j,N]=(0,s.useState)(!1),[k,C]=(0,s.useState)(!1),[S,M]=(0,s.useState)(!1),[D,T]=(0,s.useState)(!1),[P,E]=(0,s.useState)(""),[z,A]=(0,s.useState)("freeform"),[$,L]=(0,s.useState)(f||null),[R,I]=(0,s.useState)({nodes:[],edges:[],viewport:{x:0,y:0,zoom:1}}),[B,F]=(0,s.useState)("select"),[U,_]=(0,s.useState)(!1),[O,X]=(0,s.useState)(null),Y=(0,s.useRef)(!1),H=(0,s.useRef)(null),V=(0,o.useQuery)(l.api.designCanvas.getUserCanvases,m?.id?{ownerId:m.id}:"skip"),q=(0,o.useQuery)(l.api.designCanvas.getCanvas,$?{canvasId:$}:"skip"),G=(0,o.useMutation)(l.api.designCanvas.createCanvas),W=(0,o.useMutation)(l.api.designCanvas.updateCanvasData),K=(0,t$.useVoiceChat)({voice:"nova",autoSpeak:!0});(0,s.useEffect)(()=>($&&R.nodes.length>=0&&x($,{nodes:R.nodes,edges:R.edges,viewport:R.viewport}),()=>{p()}),[$,x,p]),(0,s.useEffect)(()=>{$&&g({nodes:R.nodes,edges:R.edges,viewport:R.viewport})},[R,$,g]),(0,s.useEffect)(()=>{if(q?.canvasData)try{let e=JSON.parse(q.canvasData);I(e),_(!1)}catch(e){console.error("[Canvas] Failed to parse canvas data:",e)}},[q]),(0,s.useCallback)(async e=>{if(e.trim()&&!Y.current){Y.current=!0;try{let t=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"system",content:"You are 8gent on the design canvas. Keep responses brief (1-2 sentences). The user is speaking to you while designing. Help them with canvas actions, design suggestions, or answer questions quickly. You can use canvas tools to manipulate the canvas directly."},{role:"user",content:e}],model:"qualification"})});if(t.ok){let e=await t.json(),s=e.message||e.content||"I heard you, but I'm not sure how to help with that.";X(s),K.enableVoice(),K.speakResponse(s)}}catch(e){console.error("[Canvas Voice] Error:",e),K.speakResponse("Sorry, I had trouble processing that. Can you try again?")}finally{Y.current=!1}}},[K]),(0,s.useEffect)(()=>{if("idle"===K.mode&&O){let e=setTimeout(()=>X(null),5e3);return()=>clearTimeout(e)}},[K.mode,O]),(0,s.useEffect)(()=>{if("import"===b&&m?.id)try{let t=sessionStorage.getItem("canvas_import_data");if(t){let s=JSON.parse(t);sessionStorage.removeItem("canvas_import_data");let a=(s.elements||[]).map(e=>({id:e.id,type:e.type,x:e.position.x,y:e.position.y,width:150,height:60,content:e.label,style:e.color?{backgroundColor:e.color}:void 0}));G({name:s.prdTitle||"Imported from PRD",ownerId:m.id,canvasType:"flowchart"}).then(t=>{L(t),I({nodes:a,edges:[],viewport:{x:0,y:0,zoom:1}}),_(!0),e.replace(`/canvas?id=${t}`)})}}catch(e){console.error("[Canvas] Failed to import canvas data:",e)}},[b,m?.id,G,e]);let J=(0,s.useCallback)(t=>{L(t),v("editor"),e.push(`/canvas?id=${t}`)},[e]),Z=(0,s.useCallback)(async()=>{if(P.trim()&&m?.id)try{let e=await G({name:P.trim(),ownerId:m.id,canvasType:z});M(!1),E(""),J(e)}catch(e){console.error("[Canvas] Failed to create canvas:",e)}},[P,z,m?.id,G,J]),Q=(0,s.useCallback)(e=>{I(e),_(!0)},[]),ee=(0,s.useCallback)(async()=>{if($&&U)try{await W({canvasId:$,canvasData:JSON.stringify(R)}),_(!1),console.log("[Canvas] Saved to Convex")}catch(e){console.error("[Canvas] Failed to save:",e)}},[$,R,U,W]),et=(0,s.useCallback)(()=>{ee()},[ee]);(0,s.useEffect)(()=>{if(U&&$)return H.current&&clearTimeout(H.current),H.current=setTimeout(()=>{ee()},2e3),()=>{H.current&&clearTimeout(H.current)}},[U,R,$,ee]);let es=(0,s.useCallback)(()=>{L(null),v("list"),e.push("/canvas")},[e]),ea=(0,s.useCallback)(()=>{I(e=>({...e,viewport:{...e.viewport,zoom:Math.min(1.1*e.viewport.zoom,4)}}))},[]),er=(0,s.useCallback)(()=>{I(e=>({...e,viewport:{...e.viewport,zoom:Math.max(e.viewport.zoom/1.1,.25)}}))},[]),ei=(0,s.useCallback)(()=>{I(e=>({...e,viewport:{x:0,y:0,zoom:1}}))},[]),en=(0,s.useCallback)(e=>{"diagram"===e?T(!0):F(e)},[]),eo=(0,s.useCallback)((e,t)=>{let s=e.map(e=>({...e,x:e.x+R.viewport.x+100,y:e.y+R.viewport.y+100}));I(e=>({...e,nodes:[...e.nodes,...s],edges:[...e.edges,...t]})),_(!0),console.log("[Canvas] Inserted diagram:",e.length,"nodes,",t.length,"edges")},[R.viewport]),el=(0,s.useCallback)((e,t)=>{let s={id:`img-${Date.now()}`,type:"image",x:R.viewport.x+100+200*Math.random(),y:R.viewport.y+100+200*Math.random(),width:300,height:300,content:e,style:{objectFit:"contain"}};I(e=>({...e,nodes:[...e.nodes,s]})),_(!0),console.log("[Canvas] Added content image:",t)},[R.viewport]);if(!h)return(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,t.jsx)("div",{className:"animate-pulse text-muted-foreground",children:"Loading..."})});let ec=void 0===V&&m?.id;return(0,t.jsx)(c.PageTransition,{children:(0,t.jsxs)("div",{className:"min-h-screen bg-background flex flex-col",children:[(0,t.jsx)("header",{className:"sticky top-0 z-40 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:(0,t.jsxs)("div",{className:"flex h-14 items-center px-4 gap-4",children:["editor"===y&&(0,t.jsx)(tr.Button,{variant:"ghost",size:"icon",onClick:es,className:"shrink-0",children:(0,t.jsx)(tR.ArrowLeft,{className:"h-4 w-4"})}),(0,t.jsx)("div",{className:"flex-1 min-w-0",children:"list"===y?(0,t.jsx)("h1",{className:"text-lg font-semibold truncate",children:"Design Canvas"}):(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h1",{className:"text-lg font-semibold truncate",children:q?.name||"Untitled Canvas"}),U&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"(unsaved)"})]})}),"list"===y?(0,t.jsxs)(tr.Button,{onClick:()=>M(!0),size:"sm",children:[(0,t.jsx)(w.Plus,{className:"h-4 w-4 mr-2"}),"New Canvas"]}):(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"hidden sm:flex items-center gap-1 border rounded-lg p-1",children:[(0,t.jsx)(tr.Button,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:er,children:(0,t.jsx)(tI.ZoomOut,{className:"h-3.5 w-3.5"})}),(0,t.jsxs)("span",{className:"text-xs w-12 text-center",children:[Math.round(100*R.viewport.zoom),"%"]}),(0,t.jsx)(tr.Button,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:ea,children:(0,t.jsx)(eD.ZoomIn,{className:"h-3.5 w-3.5"})}),(0,t.jsx)(tr.Button,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:ei,children:(0,t.jsx)(tB.default,{className:"h-3.5 w-3.5"})})]}),(0,t.jsxs)(tr.Button,{variant:k?"secondary":"ghost",size:"sm",onClick:()=>C(!k),children:[(0,t.jsx)(tM.FolderOpen,{className:"h-4 w-4 mr-2"}),"Content"]}),(0,t.jsxs)(tr.Button,{variant:j?"secondary":"ghost",size:"sm",onClick:()=>N(!j),children:[(0,t.jsx)(u.Sparkles,{className:"h-4 w-4 mr-2"}),"AI Prompts"]}),(0,t.jsx)(tr.Button,{variant:"default",size:"sm",onClick:et,disabled:!U,children:"Save"})]})]})}),(0,t.jsx)(i.AnimatePresence,{children:("speaking"===K.mode||O)&&"editor"===y&&(0,t.jsx)(r.motion.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"absolute top-16 left-1/2 -translate-x-1/2 z-50 max-w-md",children:(0,t.jsx)("div",{className:"bg-background/95 backdrop-blur-sm border rounded-2xl px-4 py-3 shadow-lg",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:["speaking"===K.mode&&(0,t.jsx)("div",{className:"flex items-center gap-1",children:[0,.1,.2].map((e,s)=>(0,t.jsx)(r.motion.div,{className:"w-1.5 h-3 rounded-full bg-primary",animate:{scaleY:[1,1.5,1]},transition:{duration:.4,repeat:1/0,delay:e}},s))}),(0,t.jsx)("p",{className:"text-sm",children:O}),"speaking"!==K.mode&&(0,t.jsx)(tr.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 shrink-0",onClick:()=>X(null),children:(0,t.jsx)(to.X,{className:"h-3 w-3"})})]})})})}),(0,t.jsx)("main",{className:"flex-1 relative overflow-hidden",children:(0,t.jsx)(i.AnimatePresence,{mode:"wait",children:"list"===y?(0,t.jsx)(r.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"p-4 md:p-6",children:ec?(0,t.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,t.jsx)(ef.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):(0,t.jsx)(tN,{canvases:(V||[]).map(e=>({_id:e._id,name:e.name,description:e.description,canvasType:e.canvasType,status:e.status,createdAt:e.createdAt,updatedAt:e.updatedAt})),onSelect:e=>J(e),onCreateNew:()=>M(!0)})},"list"):(0,t.jsxs)(r.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"h-full flex",children:[(0,t.jsxs)("div",{className:"flex-1 relative",style:{height:"calc(100vh - 56px)"},children:[(0,t.jsx)(e0,{data:R,onChange:Q,selectedTool:B,onToolChange:en,gridEnabled:!0,gridSize:20,backgroundColor:void 0}),(0,t.jsx)(ta,{selectedTool:B,onToolChange:en})]}),(0,t.jsx)(i.AnimatePresence,{children:j&&(0,t.jsx)(r.motion.div,{initial:{width:0,opacity:0},animate:{width:320,opacity:1},exit:{width:0,opacity:0},className:"border-l bg-background overflow-hidden",children:(0,t.jsx)(tf,{onSelectPrompt:e=>{console.log("Selected prompt:",e)},onClose:()=>N(!1)})})}),(0,t.jsx)(tT,{isOpen:k,onClose:()=>C(!1),onSelectImage:el}),(0,t.jsx)(tA,{open:D,onClose:()=>T(!1),onInsert:eo,existingNodes:R.nodes,existingEdges:R.edges})]},"editor")})}),S&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:(0,t.jsxs)(r.motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-background border rounded-xl shadow-2xl w-full max-w-md mx-4 p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Create New Canvas"}),(0,t.jsx)(tr.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>M(!1),children:(0,t.jsx)(to.X,{className:"h-4 w-4"})})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Start with a blank canvas for infinite exploration"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{htmlFor:"name",className:"text-sm font-medium",children:"Canvas Name"}),(0,t.jsx)("input",{id:"name",type:"text",value:P,onChange:e=>E(e.target.value),placeholder:"My awesome design...",className:"w-full px-3 py-2 rounded-lg border bg-background text-sm focus:outline-none focus:ring-2 focus:ring-primary"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{htmlFor:"type",className:"text-sm font-medium",children:"Canvas Type"}),(0,t.jsxs)("select",{id:"type",value:z,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 rounded-lg border bg-background text-sm focus:outline-none focus:ring-2 focus:ring-primary",children:[(0,t.jsx)("option",{value:"freeform",children:"Freeform - Open exploration"}),(0,t.jsx)("option",{value:"wireframe",children:"Wireframe - UI/UX design"}),(0,t.jsx)("option",{value:"moodboard",children:"Moodboard - Visual inspiration"}),(0,t.jsx)("option",{value:"storyboard",children:"Storyboard - Narrative planning"}),(0,t.jsx)("option",{value:"mindmap",children:"Mindmap - Concept mapping"}),(0,t.jsx)("option",{value:"flowchart",children:"Flowchart - Process diagrams"})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,t.jsx)(tr.Button,{variant:"outline",onClick:()=>M(!1),children:"Cancel"}),(0,t.jsx)(tr.Button,{onClick:Z,disabled:!P.trim(),children:"Create Canvas"})]})]})})]})})}function tU(){return(0,t.jsx)(s.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,t.jsx)("div",{className:"animate-pulse text-muted-foreground",children:"Loading..."})}),children:(0,t.jsx)(tF,{})})}e.s(["CanvasClient",()=>tU],39992)},979779,e=>{e.n(e.i(39992))}]);